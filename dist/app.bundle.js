var qb=Object.defineProperty;var Ub=(t,e)=>()=>(t&&(e=t(t=0)),e);var _b=(t,e)=>{for(var n in e)qb(t,n,{get:e[n],enumerable:!0})};var Jy={};_b(Jy,{generateWordReport:()=>CT});import{Document as yT,Packer as kT,Paragraph as oe,Table as _r,TableCell as Pe,TableRow as hs,TextRun as ie,AlignmentType as Ee,WidthType as Ne,BorderStyle as we,HeadingLevel as jo,ShadingType as Wn}from"https://esm.sh/docx@9.5.1";function ol(t){return t>=75?dt.success:t>=50?dt.primary:t>=25?dt.priority.medium:dt.priority.high}function vT(t,e){let n=new Set(e.filter(a=>a.status!=="done").map(a=>a.projectId).filter(a=>a!==null)),s=e.length,o=e.filter(a=>a.status==="done").length,r=s>0?Math.round(o/s*100):0;return{activeProjectsCount:n.size,totalTasks:s,completedTasks:o,completionPercent:r}}function Vy(t,e){let n=e.filter(c=>c.projectId===t.id),s=n.length,o=n.filter(c=>c.status==="done").length,r=s>0?Math.round(o/s*100):0,a=new Date().toISOString().split("T")[0],i=n.filter(c=>c.status!=="done"&&c.endDate&&c.endDate<a).length,l=n.filter(c=>!c.startDate||!c.endDate).length;return{totalTasks:s,completedTasks:o,completionPercent:r,overdueTasks:i,tasksWithoutDates:l,tasks:n}}function Ky(t){return(t.tags||[]).map(e=>e.toUpperCase())}function wT(t){return(t.tags||[]).map(e=>e.toUpperCase())}function ST(t,e){let n=Ky(t),s=wT(e),o=[...n,...s];for(let r of bT)if(o.includes(r))return r;return null}function ET(t,e){if(!e)return null;let n=Ky(t),s=Wy[e];for(let o of s)if(n.includes(o))return o;return null}function xT(t,e){let n=e.filter(o=>o.projectId===t.id),s={};for(let o of n){let r=ST(o,t);if(!r)continue;s[r]||(s[r]={localities:{},otherTasks:[]});let a=ET(o,r);a?(s[r].localities[a]||(s[r].localities[a]=[]),s[r].localities[a].push(o)):s[r].otherTasks.push(o)}return s}function bu(t){return[...t].sort((e,n)=>!e.startDate&&!n.startDate?0:e.startDate?n.startDate?e.startDate!==n.startDate?e.startDate.localeCompare(n.startDate):!e.endDate&&!n.endDate?0:e.endDate?n.endDate?e.endDate.localeCompare(n.endDate):-1:1:-1:1)}function TT(){let e=new Date().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return[new oe({children:[new ie({text:"REPORTE NAUTILUS",size:36,bold:!0})],heading:jo.TITLE,alignment:Ee.CENTER,spacing:{after:150}}),new oe({children:[new ie({text:"Sistema de Gesti\xF3n de Investigaci\xF3n Marina",size:20,color:"6B7280"})],alignment:Ee.CENTER,spacing:{after:100}}),new oe({children:[new ie({text:e,size:18,color:"9CA3AF"})],alignment:Ee.CENTER,spacing:{after:300}}),new oe({text:"",border:{bottom:{color:"D1D5DB",space:1,style:we.SINGLE,size:3}},spacing:{after:400}})]}function DT(t,e){let n={done:e.filter(r=>r.status==="done").length,progress:e.filter(r=>r.status==="progress").length,review:e.filter(r=>r.status==="review").length,todo:e.filter(r=>r.status==="todo").length},s=new _r({width:{size:100,type:Ne.PERCENTAGE},borders:{top:{style:we.NONE},bottom:{style:we.NONE},left:{style:we.NONE},right:{style:we.NONE},insideHorizontal:{style:we.NONE},insideVertical:{style:we.SINGLE,size:1,color:"E5E7EB"}},rows:[new hs({children:[new Pe({children:[new oe({children:[new ie({text:"Proyectos Activos",size:18,color:"6B7280"})],alignment:Ee.CENTER,spacing:{before:200,after:100}}),new oe({children:[new ie({text:t.activeProjectsCount.toString(),size:48,bold:!0,color:dt.primary})],alignment:Ee.CENTER,spacing:{after:200}})],width:{size:33.33,type:Ne.PERCENTAGE},shading:{fill:"FAFAFA",type:Wn.CLEAR}}),new Pe({children:[new oe({children:[new ie({text:"Tareas Completadas",size:18,color:"6B7280"})],alignment:Ee.CENTER,spacing:{before:200,after:100}}),new oe({children:[new ie({text:`${t.completedTasks}/${t.totalTasks}`,size:48,bold:!0})],alignment:Ee.CENTER,spacing:{after:200}})],width:{size:33.33,type:Ne.PERCENTAGE},shading:{fill:"FAFAFA",type:Wn.CLEAR}}),new Pe({children:[new oe({children:[new ie({text:"Progreso Global",size:18,color:"6B7280"})],alignment:Ee.CENTER,spacing:{before:200,after:100}}),new oe({children:[new ie({text:`${t.completionPercent}%`,size:48,bold:!0,color:ol(t.completionPercent)})],alignment:Ee.CENTER,spacing:{after:200}})],width:{size:33.33,type:Ne.PERCENTAGE},shading:{fill:"FAFAFA",type:Wn.CLEAR}})]})]}),o=new _r({width:{size:100,type:Ne.PERCENTAGE},alignment:Ee.CENTER,borders:{top:{style:we.SINGLE,size:1,color:"E5E7EB"},bottom:{style:we.SINGLE,size:1,color:"E5E7EB"},left:{style:we.NONE},right:{style:we.NONE},insideHorizontal:{style:we.NONE},insideVertical:{style:we.NONE}},rows:[new hs({children:[new Pe({children:[new oe({children:[new ie({text:"Por Hacer",size:18,color:"6B7280"})],alignment:Ee.CENTER,spacing:{before:150,after:50}}),new oe({children:[new ie({text:n.todo.toString(),size:32,bold:!0,color:"9CA3AF"})],alignment:Ee.CENTER,spacing:{after:150}})],width:{size:25,type:Ne.PERCENTAGE}}),new Pe({children:[new oe({children:[new ie({text:"En Progreso",size:18,color:"6B7280"})],alignment:Ee.CENTER,spacing:{before:150,after:50}}),new oe({children:[new ie({text:n.progress.toString(),size:32,bold:!0,color:dt.primary})],alignment:Ee.CENTER,spacing:{after:150}})],width:{size:25,type:Ne.PERCENTAGE}}),new Pe({children:[new oe({children:[new ie({text:"En Revisi\xF3n",size:18,color:"6B7280"})],alignment:Ee.CENTER,spacing:{before:150,after:50}}),new oe({children:[new ie({text:n.review.toString(),size:32,bold:!0,color:dt.priority.medium})],alignment:Ee.CENTER,spacing:{after:150}})],width:{size:25,type:Ne.PERCENTAGE}}),new Pe({children:[new oe({children:[new ie({text:"Completadas",size:18,color:"6B7280"})],alignment:Ee.CENTER,spacing:{before:150,after:50}}),new oe({children:[new ie({text:n.done.toString(),size:32,bold:!0,color:dt.success})],alignment:Ee.CENTER,spacing:{after:150}})],width:{size:25,type:Ne.PERCENTAGE}})]})]});return[new oe({children:[new ie({text:"Resumen Global",size:32,bold:!0})],heading:jo.HEADING_1,spacing:{before:200,after:300}}),s,new oe({text:"",spacing:{before:300,after:200}}),new oe({children:[new ie({text:"Distribuci\xF3n de Tareas",size:22,bold:!0})],spacing:{after:150}}),o,new oe({text:"",spacing:{after:400}})]}function vu(t){let e=new hs({tableHeader:!0,children:[new Pe({children:[new oe({children:[new ie({text:"Tarea",bold:!0,size:20})],alignment:Ee.LEFT})],width:{size:35,type:Ne.PERCENTAGE},shading:{type:Wn.CLEAR,fill:dt.headerBg}}),new Pe({children:[new oe({children:[new ie({text:"Prioridad",bold:!0,size:20})],alignment:Ee.CENTER})],width:{size:13,type:Ne.PERCENTAGE},shading:{type:Wn.CLEAR,fill:dt.headerBg}}),new Pe({children:[new oe({children:[new ie({text:"Estado",bold:!0,size:20})],alignment:Ee.CENTER})],width:{size:17,type:Ne.PERCENTAGE},shading:{type:Wn.CLEAR,fill:dt.headerBg}}),new Pe({children:[new oe({children:[new ie({text:"Inicio",bold:!0,size:20})],alignment:Ee.CENTER})],width:{size:17,type:Ne.PERCENTAGE},shading:{type:Wn.CLEAR,fill:dt.headerBg}}),new Pe({children:[new oe({children:[new ie({text:"Fin",bold:!0,size:20})],alignment:Ee.CENTER})],width:{size:18,type:Ne.PERCENTAGE},shading:{type:Wn.CLEAR,fill:dt.headerBg}})]}),n={low:"Baja",medium:"Media",high:"Alta"},s={todo:"Por Hacer",progress:"En Progreso",review:"En Revisi\xF3n",done:"Completada"},o=t.map(r=>{let a=dt.status[r.status]||"FFFFFF",i=dt.priority[r.priority]||"9CA3AF",l=_y.priority[r.priority]||"",c=_y.status[r.status]||"";return new hs({children:[new Pe({children:[new oe({text:r.title||"Sin t\xEDtulo",spacing:{before:100,after:100}})]}),new Pe({children:[new oe({children:[new ie({text:`${l} `,color:i}),new ie({text:n[r.priority]||r.priority||"-"})],alignment:Ee.CENTER,spacing:{before:100,after:100}})]}),new Pe({children:[new oe({children:[new ie({text:`${c} `}),new ie({text:s[r.status]||r.status||"-",strike:r.status==="done"})],alignment:Ee.CENTER,spacing:{before:100,after:100}})],shading:{type:Wn.CLEAR,fill:a}}),new Pe({children:[new oe({text:r.startDate||"-",alignment:Ee.CENTER,spacing:{before:100,after:100}})]}),new Pe({children:[new oe({text:r.endDate||"-",alignment:Ee.CENTER,spacing:{before:100,after:100}})]})]})});return new _r({rows:[e,...o],width:{size:100,type:Ne.PERCENTAGE},borders:{top:{style:we.SINGLE,size:1},bottom:{style:we.SINGLE,size:1},left:{style:we.SINGLE,size:1},right:{style:we.SINGLE,size:1},insideHorizontal:{style:we.SINGLE,size:1},insideVertical:{style:we.SINGLE,size:1}}})}function IT(t,e,n){let s=[];s.push(new oe({children:[new ie({text:t.name,size:28,bold:!0})],heading:jo.HEADING_1,spacing:{before:600,after:200}}));let o=[`${e.completedTasks}/${e.totalTasks} tareas`,new ie({text:`${e.completionPercent}%`,bold:!0,color:ol(e.completionPercent)})],r=[];r.push(new hs({children:[new Pe({children:[new oe({children:[new ie({text:"\u{1F4CA} Progreso",size:16,color:"4B5563"})]})],width:{size:30,type:Ne.PERCENTAGE},shading:{fill:"F9FAFB"}}),new Pe({children:[new oe({children:[new ie({text:`${e.completionPercent}%`,size:18,bold:!0,color:ol(e.completionPercent)}),new ie({text:`  (${e.completedTasks}/${e.totalTasks} tareas)`,size:14,color:"6B7280"})]})],width:{size:70,type:Ne.PERCENTAGE}})]})),e.overdueTasks>0&&r.push(new hs({children:[new Pe({children:[new oe({children:[new ie({text:"\u26A0\uFE0F Vencidas",size:16,color:"4B5563"})]})],width:{size:30,type:Ne.PERCENTAGE},shading:{fill:"FEF2F2"}}),new Pe({children:[new oe({children:[new ie({text:`${e.overdueTasks} tareas`,size:16,color:dt.priority.high})]})],width:{size:70,type:Ne.PERCENTAGE}})]})),e.tasksWithoutDates>0&&r.push(new hs({children:[new Pe({children:[new oe({children:[new ie({text:"\u{1F4C5} Sin fechas",size:16,color:"4B5563"})]})],width:{size:30,type:Ne.PERCENTAGE},shading:{fill:"FFFBEB"}}),new Pe({children:[new oe({children:[new ie({text:`${e.tasksWithoutDates} tareas`,size:16,color:"6B7280"})]})],width:{size:70,type:Ne.PERCENTAGE}})]}));let a=new _r({width:{size:100,type:Ne.PERCENTAGE},borders:{top:{style:we.SINGLE,size:1,color:"E5E7EB"},bottom:{style:we.SINGLE,size:1,color:"E5E7EB"},left:{style:we.SINGLE,size:1,color:"E5E7EB"},right:{style:we.SINGLE,size:1,color:"E5E7EB"},insideHorizontal:{style:we.SINGLE,size:1,color:"E5E7EB"},insideVertical:{style:we.SINGLE,size:1,color:"E5E7EB"}},rows:r});s.push(a),s.push(new oe({text:"",spacing:{after:200}}));let i=bu(e.tasks);i.length>0&&s.push(vu(i));let l=xT(t,n);if(Object.keys(l).length>0){s.push(new oe({children:[new ie({text:"Desglose Geogr\xE1fico",size:26,bold:!0})],heading:jo.HEADING_2,spacing:{before:400,after:300}}));for(let c of Object.keys(l).sort()){let d=l[c];s.push(new oe({children:[new ie({text:"\u{1F3DD}\uFE0F ",size:24}),new ie({text:c,size:24,bold:!0,color:dt.primary})],heading:jo.HEADING_3,spacing:{before:350,after:200}}));let u=Object.keys(d.localities).sort();for(let p of u){let f=bu(d.localities[p]);s.push(new oe({children:[new ie({text:"\u{1F4CD} ",size:22}),new ie({text:p,size:22,bold:!0,italics:!1})],spacing:{before:250,after:150}})),s.push(vu(f)),s.push(new oe({text:"",spacing:{after:250}}))}if(d.otherTasks.length>0){let p=bu(d.otherTasks);s.push(new oe({children:[new ie({text:"\u{1F4CD} ",size:22}),new ie({text:"Otras Ubicaciones",size:22,bold:!0,italics:!1})],spacing:{before:250,after:150}})),s.push(vu(p)),s.push(new oe({text:"",spacing:{after:250}}))}}}return s}async function CT(t,e){try{let n=vT(t,e),s=[];s.push(...TT()),s.push(...DT(n,e));let o=[...t].sort((p,f)=>p.name.localeCompare(f.name,"es",{sensitivity:"base"}));s.push(new oe({children:[new ie({text:"Proyectos",size:32,bold:!0})],heading:jo.HEADING_1,spacing:{before:600,after:300}}));let r=o.map(p=>{let f=Vy(p,e);return new Pe({children:[new oe({children:[new ie({text:p.name,size:16,bold:!0})],alignment:Ee.CENTER,spacing:{before:150,after:50}}),new oe({children:[new ie({text:`${f.completionPercent}%`,size:28,bold:!0,color:ol(f.completionPercent)})],alignment:Ee.CENTER,spacing:{after:50}}),new oe({children:[new ie({text:`${f.completedTasks}/${f.totalTasks} tareas`,size:14,color:"6B7280"})],alignment:Ee.CENTER,spacing:{after:150}})],width:{size:100/o.length,type:Ne.PERCENTAGE}})}),a=new _r({width:{size:100,type:Ne.PERCENTAGE},borders:{top:{style:we.SINGLE,size:1,color:"E5E7EB"},bottom:{style:we.SINGLE,size:1,color:"E5E7EB"},left:{style:we.NONE},right:{style:we.NONE},insideHorizontal:{style:we.NONE},insideVertical:{style:we.SINGLE,size:1,color:"E5E7EB"}},rows:[new hs({children:r})]});s.push(a),s.push(new oe({text:"",spacing:{after:400}}));for(let p of o){let f=Vy(p,e);s.push(...IT(p,f,e))}let i=new yT({sections:[{properties:{},children:s}]}),l=await kT.toBlob(i),c=URL.createObjectURL(l),d=`Reporte-Nautilus-${new Date().toISOString().split("T")[0]}.docx`,u=document.createElement("a");return u.href=c,u.download=d,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(c),{success:!0,filename:d,insights:n}}catch(n){return console.error("Error generating report:",n),{success:!1,error:n.message}}}var Wy,bT,dt,_y,Gy=Ub(()=>{Wy={TENERIFE:["TAJAO","LOS CRISTIANOS","LAS TERESITAS","EL M\xC9DANO","SAN JUAN","BOCA CANGREJO"],"LA PALMA":["LOS CANCAJOS","LA BOMBILLA","R\xCDO MUERTO"],LANZAROTE:["\xD3RZOLA"],FUERTEVENTURA:["TONELES","JACOMAR","LOBOS","MORRO JABLE"]},bT=Object.keys(Wy),dt={status:{todo:"E5E7EB",progress:"DBEAFE",review:"FEF3C7",done:"D1FAE5"},priorityBg:{low:"F3F4F6",medium:"FEF3C7",high:"FEE2E2"},priority:{low:"9CA3AF",medium:"F59E0B",high:"EF4444"},primary:"0284C7",secondary:"6366F1",success:"10B981",headerBg:"F3F4F6"},_y={priority:{low:"\u25A0",medium:"\u25A0",high:"\u25A0"},status:{todo:"\u2B1C",progress:"\u{1F7E6}",review:"\u{1F7E8}",done:"\u2705"},sections:{project:"\u{1F4C1}",island:"\u{1F3DD}\uFE0F",locality:"\u{1F4CD}",summary:"\u{1F4CA}",tasks:"\u{1F4CB}",metrics:"\u{1F4C8}"},progress:{full:"\u{1F7E9}",high:"\u{1F7E8}",medium:"\u{1F7E7}",low:"\u{1F7E5}"}}});var Ul={en:"en-US",es:"es-ES"},ka={en:{"boot.loading":"Loading Nautilus","lock.welcome":"Welcome back","lock.subtitle":"Enter the access password to continue.","lock.sessionHint":"? Session stays signed-in for 24 hours.","lock.passwordLabel":"Password","lock.passwordPlaceholder":"Enter password","lock.unlock":"Unlock","auth.backToUserLogin":"Back to User Login","auth.login.title":"Welcome to Nautilus","auth.login.subtitle":"Login to access your workspace","auth.login.identifierLabel":"Username or Email","auth.login.identifierPlaceholder":"Enter username or email","auth.login.pinLabel":"PIN (4 digits)","auth.admin.title":"Admin Access","auth.admin.subtitle":"Enter master PIN to access admin dashboard","auth.admin.pinLabel":"Master PIN (4 digits)","auth.setup.title":"Complete Your Setup","auth.setup.subtitle":"Personalize your account","auth.setup.usernameLabel":"Username","auth.setup.usernamePlaceholder":"e.g., alex","auth.setup.usernameHint":"3-20 characters, lowercase letters and numbers only","auth.setup.displayNameLabel":"Display Name","auth.setup.displayNamePlaceholder":"e.g., Alex Morgan","auth.setup.emailLabel":"Email","auth.setup.emailPlaceholder":"your.email@example.com","auth.setup.emailHint":"Required for notifications and account deletion confirmation","auth.setup.newPinLabel":"New PIN (4 digits)","auth.setup.confirmPinLabel":"Confirm PIN","auth.setup.next":"Next","auth.setup.submit":"Complete Setup","admin.title":"User Management","admin.signOut":"Sign Out","admin.usersTitle":"Users","admin.createUserTitle":"Create New User","admin.usernameLabel":"Username","admin.usernamePlaceholder":"e.g., jdoe","admin.usernameHint":"3-20 characters, lowercase letters and numbers only","admin.displayNameLabel":"Display Name","admin.displayNamePlaceholder":"e.g., John Doe","admin.tempPinLabel":"Temporary PIN (4 digits)","admin.createUserButton":"Create User","auth.admin.resetPinPrompt":"Enter new temporary PIN for {userName}:","auth.admin.pinMustBe4Digits":"PIN must be exactly 4 digits","auth.admin.resetPinFailed":"Failed to reset PIN","auth.admin.resetPinSuccess":"PIN reset for {userName}. New temp PIN: {pin}","auth.admin.deleteUserConfirm":'Are you sure you want to delete user "{userName}"? This will also delete all their tasks and projects.',"auth.admin.deleteUserFailed":"Failed to delete user","auth.admin.deleteUserSuccess":'User "{userName}" deleted successfully',"common.cancel":"Cancel","common.delete":"Delete","common.continue":"Continue","common.gotIt":"Got it","common.close":"Close modal","common.done":"Done","common.updating":"Updating...","common.nautilusLogoAlt":"Nautilus logo","common.devBanner":"\u26A0\uFE0F LOCAL DEV - NOT PRODUCTION \u26A0\uFE0F","common.datePlaceholder":"dd/mm/yyyy","crop.title":"Crop Image to Square","crop.instructions":"Drag to adjust the crop area. The image will be cropped to a square.","crop.apply":"Crop & Apply","crop.close":"Close crop modal","dashboard.insights.productivityTitle":"Productivity Trend","dashboard.insights.productivityDesc":"Task completion rate increased 23% compared to last month","dashboard.insights.deadlineTitle":"Deadline Alert","dashboard.insights.deadlineDesc":"3 milestones due within the next 7 days","projects.title":"Projects","projects.subtitle":"Manage your projects","projects.searchPlaceholder":"\u{1F50D} Search projects (title or description)","projects.filters.status":"Status","projects.filters.statusTitle":"Project Status","projects.status.backlog":"BACKLOG","projects.status.planning":"PLANNING","projects.status.active":"ACTIVE","projects.status.completed":"COMPLETED","projects.filters.updated":"Updated","projects.filters.updatedTitle":"Recently Updated","projects.filters.all":"All","projects.filters.last5m":"Last 5 minutes","projects.filters.last30m":"Last 30 minutes","projects.filters.last24h":"Last 24 hours","projects.filters.lastWeek":"Last week","projects.filters.lastMonth":"Last month","projects.filters.hasTasks":"Has tasks","projects.filters.noTasks":"No tasks","projects.filters.tags":"Tags","projects.filters.tagsTitle":"Project Tags","projects.filters.clear":"Clear Filters","projects.noDescription":"No description","projects.tasksBreakdown":"{total} tasks \xB7 {done} done","tasks.card.description":"Description","projects.card.tasksCount":"{count} tasks","projects.card.percentDone":"{count}% done","projects.sort.label":"Sort: Status","projects.sort.status":"Status","projects.sort.name":"Name","projects.sort.newest":"Newest","projects.sort.lastUpdated":"Last Updated","projects.sort.mostTasks":"Most tasks","projects.sort.percentCompleted":"% Completed","projects.sort.prefix":"Sort: {label}","projects.sort.help":"Click the same option again to switch Asc/Desc.","projects.sort.statusLabel":"Status","projects.sort.nameLabel":"Name","projects.sort.newestLabel":"Newest","projects.sort.lastUpdatedLabel":"Last Updated","projects.sort.mostTasksLabel":"Most tasks","projects.sort.percentCompletedLabel":"% Completed","projects.newProjectButton":"+ New Project","projects.openDetailsTitle":"View project details","projects.empty.title":"No projects yet","projects.empty.subtitle":"Create your first project","projects.empty.searchTitle":"No projects found","projects.empty.searchSubtitle":"Create a new project to get started","projects.empty.filteredTitle":"No projects matched","projects.modal.createTitle":"Create New Project","projects.modal.nameLabel":"Project Name","projects.modal.descriptionLabel":"Description","projects.modal.startDateLabel":"Start Date","projects.modal.endDateLabel":"End Date","projects.modal.tagsLabel":"Tags","projects.modal.addTagPlaceholder":"Add tag","projects.modal.createButton":"Create Project","projects.delete.title":"Delete Project","projects.delete.body":"This action cannot be undone. To confirm deletion, type delete below:","projects.delete.deleteTasksLabel":"Delete all tasks in this project","projects.delete.deleteTasksHint":"If unchecked, tasks will be unassigned from the project","projects.delete.inputPlaceholder":"Type delete here","projects.delete.error":'Type "delete" exactly to confirm',"projects.duplicate.title":"Duplicate Project","projects.duplicate.description":"Create a copy of this project with all its settings.","projects.duplicate.includeTasksLabel":"Include all tasks from this project","projects.duplicate.taskNamingTitle":"Task naming:","projects.duplicate.namingNone":"Keep original names","projects.duplicate.namingPrefix":"Add prefix:","projects.duplicate.namingSuffix":"Add suffix:","projects.duplicate.prefixPlaceholder":"e.g., Copy - ","projects.duplicate.suffixPlaceholder":"e.g., (Copy)","projects.duplicate.confirm":"Duplicate Project","projects.duplicate.success":'Project "{name}" duplicated successfully',"projects.duplicate.successWithTasks":'Project "{name}" and its tasks duplicated successfully',"projects.statusInfo.title":"Project Status Logic","projects.statusInfo.subtitle":"Project status updates automatically based on task progress","projects.statusInfo.backlogTitle":"\u2B1B Backlog","projects.statusInfo.backlogDesc":'All tasks are in "Backlog"',"projects.statusInfo.planningTitle":"\u2B1C Planning","projects.statusInfo.planningDesc":'All tasks are in "To Do"',"projects.statusInfo.activeTitle":"\u2705 Active","projects.statusInfo.activeDesc":'At least one task is "In Progress" or "In Review"',"projects.statusInfo.completedTitle":"? Completed","projects.statusInfo.completedDesc":'All tasks are marked as "Done"',"projects.backTo.dashboard":"\u2190 Back to Dashboard","projects.backTo.calendar":"\u2190 Back to Calendar","projects.backTo.projects":"\u2190 Back to Projects","projects.details.tab.details":"Details","projects.details.tab.history":"History","projects.details.startDate":"Start Date","projects.details.endDate":"End Date","projects.details.duration":"Duration","projects.details.durationDays":"{count} days","projects.details.created":"Created","projects.details.calendarColor":"Calendar Color","projects.details.customColor":"Custom color","projects.details.progressOverview":"Progress Overview","projects.details.taskProgress":"Task Progress","projects.details.tasksTitle":"Tasks ({count})","projects.details.changeHistory":"Change History","projects.details.noChanges":"No changes yet for this project","projects.details.noTasksFound":"No tasks found","projects.details.viewTodo":"View To Do tasks for this project","projects.details.viewProgress":"View In Progress tasks for this project","projects.details.viewReview":"View In Review tasks for this project","projects.details.viewCompleted":"View Completed tasks for this project","projects.details.viewBacklog":"View backlog tasks in List view","projects.untitled":"Untitled Project","tasks.title":"All Tasks","tasks.subtitle":"Manage tasks across all projects","tasks.searchPlaceholder":"\u{1F50D} Search tasks (title or description)","tasks.filters.status":"Status","tasks.filters.statusTitle":"Status","tasks.status.backlog":"Backlog","tasks.status.todo":"To Do","tasks.status.progress":"In Progress","tasks.status.review":"In Review","tasks.status.done":"Done","tasks.filters.tags":"Tags","tasks.filters.tagsTitle":"Tags","tasks.filters.searchTags":"Search tags...","tasks.filters.priority":"Priority","tasks.filters.priorityTitle":"Priority","tasks.priority.high":"High","tasks.priority.medium":"Medium","tasks.priority.low":"Low","tasks.filters.project":"Project","tasks.filters.projectTitle":"Project","tasks.filters.selectAll":"Select / Unselect All","tasks.filters.date":"Date","tasks.filters.endDate":"End Date","tasks.filters.startDate":"Start Date","tasks.filters.dateTitle":"Quick Date Filters","tasks.filters.endDateTitle":"End Date Filters","tasks.filters.noDate":"No End Date","tasks.filters.overdue":"Overdue","tasks.filters.endToday":"End Date Today","tasks.filters.endTomorrow":"End Date Tomorrow","tasks.filters.end7Days":"End Date in 7 Days","tasks.filters.endThisWeek":"End Date This Week","tasks.filters.endThisMonth":"End Date This Month","tasks.filters.startDateTitle":"Start Date Filters","tasks.filters.noStartDate":"No Start Date","tasks.filters.alreadyStarted":"Already Started","tasks.filters.startToday":"Start Date Today","tasks.filters.startTomorrow":"Start Date Tomorrow","tasks.filters.start7Days":"Start Date in 7 Days","tasks.filters.startThisWeek":"Start Date This Week","tasks.filters.startThisMonth":"Start Date This Month","tasks.filters.updated":"Updated","tasks.filters.updatedTitle":"Recently Updated","tasks.filters.dateFrom":"Start date","tasks.filters.dateTo":"End date","tasks.filters.clear":"Clear Filters","tasks.filters.presetActive":"Active","tasks.filters.presetNotDone":"Not Done","tasks.filters.presetInProgress":"In Progress","tasks.filters.include":"Include","tasks.filters.exclude":"Exclude","tasks.filters.excluding":"Excluding","filters.noOtherProjects":"No other projects","filters.noTags":"No Tags","filters.noOtherTags":"No other tags","filters.sheet.title":"Options","filters.chip.search":"Search","filters.chip.project":"Project","filters.chip.tag":"Tag","filters.chip.date":"Date","filters.chip.updated":"Updated","filters.chip.removeAria":"Remove {label} filter","filters.dateRange.from":"From","filters.dateRange.until":"Until","filters.updated.week":"Week","filters.updated.month":"Month","tasks.kanban.tipLabel":"Tip:","tasks.kanban.tipTextBefore":"In the Kanban Board hold ","tasks.kanban.tipTextAfter":" (Cmd on Mac) and click to select multiple tasks. Shift-click selects a range, then drag to move them together","tasks.view.kanban":"Kanban","tasks.view.list":"List","tasks.view.calendar":"Calendar","tasks.sort.label":"Sort: Priority","tasks.sort.orderByPriority":"Order by Priority","tasks.kanban.showBacklog":"Show Backlog","tasks.kanban.showProjects":"Show Projects","tasks.kanban.showNoDate":'Show "No Date"',"tasks.addButton":"+ Add Task","tasks.noProject":"No Project","tasks.projectIndicatorNone":"No Project - ","tasks.project.selectPlaceholder":"Select a project","tasks.tags.none":"No tags","tasks.checklist.toggle":"Toggle checkbox","tasks.untitled":"Untitled task","tasks.startDatePrefix":"Start Date: ","tasks.endDatePrefix":"End Date: ","tasks.noDate":"No date","tasks.noDatesSet":"No dates set","tasks.noEndDate":"No End Date","tasks.due.yesterday":"Yesterday","tasks.due.daysOverdue":"{count} days overdue","tasks.due.tomorrow":"Tomorrow","tasks.openTaskDetails":"Open task details","tasks.noTasksInProject":"No tasks in this project","tasks.attachments.open":"Open","tasks.attachments.none":"No attachments","tasks.attachments.remove":"Remove attachment","tasks.attachments.removeTitle":"Remove","tasks.attachments.removeLink":"Remove link","tasks.attachments.googleDoc":"Google Doc","tasks.attachments.googleSheet":"Google Sheet","tasks.attachments.googleSlides":"Google Slides","tasks.attachments.googleDriveFile":"Google Drive File","tasks.attachments.pdf":"PDF Document","tasks.attachments.word":"Word Document","tasks.attachments.excel":"Excel File","tasks.attachments.powerpoint":"PowerPoint","tasks.empty.epic":"No tasks yet. Create your first task for this epic.","tasks.backlogQuickTitle":"Open Backlog tasks in List view","tasks.backlogQuickLabel":"Backlog","tasks.kanban.columnBacklog":"\u{1F9CA} Backlog","tasks.kanban.columnTodo":"\u{1F4CB} To Do","tasks.kanban.columnProgress":"\u{1F504} In Progress","tasks.kanban.columnReview":"\u2611\uFE0F In Review","tasks.kanban.columnDone":"\u2705 Done","tasks.table.task":"Task","tasks.table.priority":"Priority","tasks.table.status":"Status","tasks.table.tags":"Tags","tasks.table.project":"Project","tasks.table.startDate":"Start Date","tasks.table.endDate":"End Date","tasks.table.updated":"Updated","tasks.list.count":"{count} results","tasks.massEdit.title":"Mass Edit","tasks.massEdit.selected":"{count} of {total} tasks selected","tasks.massEdit.selectedHidden":"{count} of {total} selected ({hidden} hidden)","tasks.massEdit.status":"Status","tasks.massEdit.priority":"Priority","tasks.massEdit.dates":"Dates","tasks.massEdit.project":"Project","tasks.massEdit.tags":"Tags","tasks.massEdit.clear":"Clear","tasks.massEdit.applyChanges":"Apply Changes","tasks.massEdit.pendingChanges":"changes pending","tasks.massEdit.changeQueued":"Change queued","tasks.massEdit.apply":"Apply","tasks.massEdit.selectFirst":"Please select a value first","tasks.massEdit.cancel":"Cancel","tasks.massEdit.selectAll":"Select all filtered","tasks.massEdit.startDate":"Start Date","tasks.massEdit.endDate":"End Date","tasks.massEdit.tags.add":"Add tags (keep existing)","tasks.massEdit.tags.replace":"Replace all tags","tasks.massEdit.tags.remove":"Remove specific tags","tasks.massEdit.tags.noExisting":"No existing tags","tasks.massEdit.success":"Updated {count} tasks","tasks.massEdit.confirm.title":"Confirm Mass Edit","tasks.massEdit.confirm.summary":"You are about to update {count} tasks:","tasks.massEdit.confirm.field.status":"Status \u2192 {value}","tasks.massEdit.confirm.field.priority":"Priority \u2192 {value}","tasks.massEdit.confirm.field.startDate":"Start Date \u2192 {value}","tasks.massEdit.confirm.field.endDate":"End Date \u2192 {value}","tasks.massEdit.confirm.field.project":"Project \u2192 {value}","tasks.massEdit.confirm.field.tagsAdd":"Add tags: {value}","tasks.massEdit.confirm.field.tagsReplace":"Replace tags with: {value}","tasks.massEdit.confirm.field.tagsRemove":"Remove tags: {value}","tasks.massEdit.confirm.proceed":"Yes, Update {count} Tasks","tasks.massEdit.confirm.confirm":"Confirm","tasks.massEdit.confirm.movingFrom":"moving from {from} to {to}","tasks.massEdit.confirm.variousTo":"moving from various to {to}","tasks.massEdit.multiple":"Multiple","tasks.modal.editTitle":"Edit Task","tasks.modal.duplicate":"\u{1F4C4} Duplicate Task","tasks.modal.delete":"\u{1F5D1}\uFE0F Delete Task","tasks.modal.tab.general":"General","tasks.modal.tab.details":"Details","tasks.modal.tab.history":"History","tasks.modal.titleLabel":"Task Title","tasks.modal.attachmentsLabel":"Attachments","tasks.modal.attachmentsSupported":"Supported: Images (10MB), PDFs (20MB), Documents (10MB)","tasks.modal.attachmentsDropzoneDefault":"Drag & drop or click to attach file","tasks.modal.attachmentsDropzoneTap":"Click to attach file","tasks.modal.linksLabel":"Links","tasks.modal.attachmentNamePlaceholder":"Name (optional)","tasks.modal.attachmentUrlPlaceholder":"URL","tasks.modal.addLink":"Add Link","tasks.modal.statusLabel":"Status","tasks.modal.priorityLabel":"Priority","tasks.modal.tagsLabel":"Tags","tasks.modal.addTagPlaceholder":"Add tag","tasks.modal.projectLabel":"Project","tasks.modal.projectOpenTitle":"Open project details","tasks.modal.projectSelect":"Select a project","tasks.modal.submitCreate":"Create Task","tasks.modal.listBulleted":"\u2022 List","tasks.modal.listNumbered":"1. List","tasks.modal.insertDivider":"Insert horizontal divider","tasks.modal.insertCheckbox":"Insert checkbox","tasks.history.emptyTitle":"No Changes Yet","tasks.history.emptySubtitle":"Changes to this task will appear here","calendar.title":"Calendar","calendar.today":"Today","calendar.prevMonth":"Previous month","calendar.nextMonth":"Next month","calendar.dayItemsTitle":"Items for {date}","calendar.dayItemsProjects":"Projects","calendar.dayItemsTasks":"Tasks","calendar.dayItems.close":"Close day items","calendar.dayItems.addTask":"+ Add Task","feedback.title":"Feedback & Issues","feedback.subtitle":"Report bugs and suggest features","feedback.saveStatus.saved":"Saved","feedback.saveStatus.saving":"Saving...","feedback.saveStatus.error":"Save failed","feedback.saveStatus.offline":"Offline","feedback.type.bugLabel":"\u{1F41E} Bug","feedback.type.title":"Feedback Type","feedback.type.bugOption":"\u{1F41E} Bug","feedback.type.improvementOption":"\u{1F4A1} Improvement","feedback.descriptionPlaceholder":"Describe the issue or idea. You can paste an image directly into this field.","feedback.descriptionPlaceholderShort":"Describe the issue or idea.","feedback.screenshotAttachTitle":"Attach screenshot from device","feedback.screenshotDropzoneTap":"\u{1F4F7} Tap to attach screenshot","feedback.screenshotDropzoneDefault":"\u{1F4F7} Drag & drop or click to attach screenshot","feedback.screenshotPreviewTitle":"Screenshot attached","feedback.screenshotPreviewSubtitle":"Will be saved with this feedback","feedback.screenshotRemove":"Remove","feedback.screenshotPreviewAlt":"Feedback screenshot preview","feedback.viewScreenshotTitle":"View screenshot","feedback.pagination.first":"First page","feedback.pagination.prev":"Previous page","feedback.pagination.next":"Next page","feedback.pagination.last":"Last page","feedback.pagination.showing":"Showing {start}-{end} of {total}","feedback.pagination.pageOf":"Page {current} of {total}","feedback.addButton":"Add","feedback.pendingTitle":"? Pending","feedback.doneTitle":"? Done","feedback.delete.title":"Delete Feedback","feedback.delete.body":"Are you sure you want to delete this feedback?","feedback.empty.pending":"No pending feedback","feedback.empty.done":"No completed feedback","export.title":"Export Data","export.body":"This will download a complete backup of all your tasks, projects, and settings as a JSON file. Are you sure you want to export your data?","export.confirm":"Export","import.title":"Import Data","import.warningTitle":"WARNING: This is a FULL REPLACEMENT","import.warningBody":"Importing data will <strong>permanently replace</strong> all your current:","import.warningTasks":"All tasks","import.warningProjects":"All projects","import.warningSettings":"All settings and preferences","import.warningHistory":"All history records","import.warningIrreversible":"This action cannot be undone. Your current data will be lost.","import.fileLabel":"Select backup file to import:","import.dropzoneDefault":"Drag & drop or click to select backup file","import.fileHint":"Only JSON files exported from Nautilus are supported","import.previewTitle":"Import Preview:","import.confirmText":"To confirm import and replace all your data, type <strong>import</strong> below:","import.inputPlaceholder":"Type import here","import.error":'Type "import" exactly to confirm',"import.button":"Import Data","import.processing":"Importing data...","import.success":"Data imported successfully! All data has been replaced.","import.errorInvalidFile":"Invalid file type. Please select a JSON file.","import.errorInvalidFormat":"Invalid file format. The file does not appear to be a valid Nautilus backup.","import.errorParseFailed":"Failed to parse file. Please ensure the file is valid JSON.","import.errorReadFailed":"Failed to read file. Please try again.","import.errorNoFile":"Please select a file to import.","import.errorFailed":"Failed to import data","confirm.deleteTask.title":"Delete Task","confirm.deleteTask.body":"This action cannot be undone. To confirm deletion, type delete below:","confirm.deleteTask.inputPlaceholder":"Type delete here","confirm.deleteTask.error":'Type "delete" exactly to confirm',"confirm.unsaved.title":"Unsaved Changes","confirm.unsaved.body":"You have unsaved changes. Are you sure you want to close and lose them?","confirm.unsaved.discard":"Discard Changes","confirm.review.title":'Disable "In Review" Status',"error.saveDataFailed":"Failed to save data. Please try again.","error.saveProjectsFailed":"Failed to save projects. Please try again.","error.saveTasksFailed":"Failed to save tasks. Please try again.","error.saveFeedbackFailed":"Failed to save feedback. Please try again.","error.saveProjectColorsFailed":"Failed to save project colors.","error.saveTaskFailed":"Failed to save task. Please try again.","error.saveChangesFailed":"Failed to save changes. Please try again.","error.saveTaskPositionFailed":"Failed to save task position. Please try again.","error.saveProjectFailed":"Failed to save project. Please try again.","error.notLoggedInResetPin":"You must be logged in to reset your PIN","error.resetPinFailed":"Failed to reset PIN","error.unauthorized":"You are not authorized to perform this action","error.deleteAccountFailed":"Failed to delete account. Please try again.","success.resetPin":"PIN reset successfully! You will need to re-login with your new PIN.","error.resetPinError":"An error occurred while resetting your PIN","error.userNameEmpty":"User name cannot be empty.","error.saveDisplayNameFailed":"Could not save display name. Please try again.","error.invalidEmail":"Please enter a valid email address.","error.saveEmailFailed":"Could not save email. Please try again.","error.saveAvatarFailed":"Could not save avatar. Please try again.","success.settingsSaved":"Settings saved successfully!","error.logoSelectFile":"Please select an image file for the workspace logo.","error.logoTooLarge":"Please use an image smaller than 2MB for the workspace logo.","error.imageReadFailed":"Could not read the selected image.","error.imageLoadFailed":"Could not load the selected image.","error.logoUploadFailed":"Error uploading logo: {message}","error.cropInvalid":"Error: Crop state is invalid.","error.cropTooLarge":"Cropped image is too large. Please select a smaller area or use a smaller source image.","success.cropApplied":"Image cropped and applied successfully!","success.logoCroppedApplied":"Workspace logo cropped and applied successfully!","error.cropFailed":"Error cropping image: {message}","error.avatarSelectFile":"Please select an image file for your avatar.","error.avatarTooLarge":"Please use an image smaller than 2MB for your avatar.","error.avatarUploadFailed":"Failed to upload avatar. Please try again.","error.endDateBeforeStart":"End date cannot be before start date","error.startDateAfterEnd":"Start date cannot be after end date","error.feedbackAttachImage":"Please attach an image file.","error.feedbackReadImage":"Could not read the image file. Please try again.","error.feedbackStatusFailed":"Failed to update feedback status. Please try again.","error.attachmentSaveFailed":"Failed to save attachment. Please try again.","error.attachmentLoadFailed":"Failed to load image: {message}","success.fileDownloaded":"File downloaded!","error.fileDownloadFailed":"Failed to download file: {message}","success.attachmentDeletedFromStorage":"{name} deleted from storage","error.fileDeleteFailed":"Failed to delete file from storage","success.attachmentRemoved":"Attachment removed","error.fileSizeTooLarge":"File size must be less than {maxMB}MB. Please choose a smaller file.","success.fileUploaded":"File uploaded successfully!","error.fileUploadFailed":"Error uploading file: {message}","error.selectFile":"Please select a file","error.saveTagFailed":"Failed to save tag. Please try again.","error.removeTagFailed":"Failed to remove tag. Please try again.","error.openScreenshotFailed":"Could not open screenshot","history.sort.newest":"\u2191 Newest First","history.sort.oldest":"\u2193 Oldest First","history.field.title":"Title","history.field.name":"Name","history.field.description":"Description","history.field.status":"Status","history.field.priority":"Priority","history.field.category":"Category","history.field.startDate":"Start Date","history.field.endDate":"End Date","history.field.link":"Link","history.field.task":"Link","history.field.projectId":"Project","history.field.tags":"Tags","history.field.attachments":"Attachments","history.action.created":"Created","history.action.deleted":"Deleted","history.link.added":"Added","history.link.removed":"Removed","history.entity.task":"task","history.value.empty":"empty","history.value.none":"none","history.change.beforeLabel":"Before:","history.change.afterLabel":"After:","history.change.notSet":"Not set","history.change.removed":"Removed","history.tags.none":"No tags","history.attachments.none":"No attachments","history.attachments.countSingle":"{count} file","history.attachments.countPlural":"{count} files","history.project.fallback":"Project #{id}","history.change.arrow":"\u2192","menu.openMenu":"Open menu","menu.language":"Language","menu.darkMode":"Dark mode","menu.lightMode":"Light mode","menu.settings":"Settings","menu.help":"Help","menu.signOut":"Sign out","nav.overview":"Overview","nav.dashboard":"Dashboard","nav.updates":"Release notes","nav.calendar":"Calendar","nav.work":"Work","nav.projects":"Projects","nav.allTasks":"All Tasks","nav.feedback":"Feedback","updates.title":"Release notes","updates.subtitle":"Latest change log for Nautilus","updates.latestLabel":"Latest release","updates.historyLabel":"Release log","updates.sections.new":"New","updates.sections.improvements":"Improvements","updates.sections.fixes":"Fixes","updates.empty":"No release notes yet.","updates.sectionEmpty":"Nothing listed yet.","updates.historyEmpty":"No previous releases yet.","notifications.title":"Notifications","notifications.toggle":"Notifications","notifications.today":"Today","notifications.yesterday":"Yesterday","notifications.clearAll":"Clear all","notifications.releaseTitle":"New release","notifications.releaseCta":"View updates","notifications.releaseMeta":"Released {date}","notifications.dueTodayTitle":"Due today","notifications.dueTodayCta":"View tasks","notifications.dueTodayMetaOne":"{count} task due today","notifications.dueTodayMetaMany":"{count} tasks due today","notifications.dueTodayMore":"and {count} more tasks","notifications.empty":"You are all caught up.","settings.title":"Settings","settings.subtitle":"Manage your preferences and application settings","settings.section.profile":"Profile","settings.displayName":"Display Name","settings.displayNameHint":"This name is displayed throughout the application","settings.placeholder.displayName":"Enter your display name","settings.email":"Email","settings.emailHint":"Used for your account and deadline notifications","settings.placeholder.email":"Enter your email","settings.avatar":"Avatar","settings.avatarHint":"Upload an image for your avatar (max 2MB). It will be displayed as a circle.","settings.avatarRemoveTitle":"Remove avatar","settings.workspaceLogo":"Workspace Logo","settings.workspaceLogoHint":"Upload a square image to replace the Nautilus logo (max 2MB).","settings.workspaceLogoRemoveTitle":"Remove custom logo","settings.section.application":"Application","settings.enableReviewStatus":"Enable In Review status","settings.enableReviewStatusHint":"Show or hide the IN REVIEW status column and filter option","settings.enableReviewStatusHintPrefix":"Show or hide the","settings.enableReviewStatusHintSuffix":"status column and filter option","settings.calendarIncludeBacklog":"Show backlog in calendar","settings.calendarIncludeBacklogHint":"Display backlog tasks in all calendar views","settings.autoStartDate":"Auto-set start date","settings.autoStartDateHint":'Automatically set Start Date when task status changes to "In Progress" (if empty)',"settings.autoEndDate":"Auto-set end date","settings.autoEndDateHint":'Automatically set End Date when task status changes to "Done" (if empty)',"settings.debugLogs":"Enable debug logs","settings.debugLogsHint":"Capture diagnostic logs in the browser console when enabled","settings.historySortOrder":"History Sort Order","settings.historySortOrderHint":"Default sort order for task and project history timelines","settings.historySortNewest":"Newest First","settings.historySortOldest":"Oldest First","settings.language":"Language","settings.languageHint":"Choose the application language","settings.section.notifications":"Notifications","settings.emailNotifications":"Email notifications","settings.emailNotificationsHint":"Enable or disable deadline reminder emails","settings.weekdaysOnly":"Weekdays only","settings.weekdaysOnlyHint":"Skip emails on Saturday and Sunday","settings.includeStartDates":"Notify when tasks start","settings.includeStartDatesHint":"Send reminders when a task starts (e.g., today)","settings.includeBacklog":"Include backlog tasks","settings.includeBacklogHint":"Include backlog tasks in email and in-app notifications","settings.sendTime":"Send time","settings.sendTimeHint":"Daily time to send reminders (08:00-18:00, 30-minute increments)","settings.timeZone":"Time zone","settings.timeZoneHint":"Keeps the same local time year-round (DST-aware)","settings.timeZone.option.argentina":"Argentina (Buenos Aires)","settings.timeZone.option.canary":"Canary Islands (Atlantic/Canary)","settings.timeZone.option.spain":"Spain mainland (Europe/Madrid)","settings.timeZone.option.utc":"UTC","settings.section.security":"Security","settings.pinManagement":"PIN Management","settings.pinManagementHint":"Reset your PIN to a new 4-digit code","settings.resetPinButton":"Reset PIN","settings.section.dataManagement":"Data Management","settings.exportData":"Export Data","settings.exportDataHint":"Download a complete backup of all your tasks, projects, and settings as a JSON file","settings.exportButton":"Export","settings.importData":"Import Data","settings.importDataHint":"Import a backup file to replace all your current data. This action cannot be undone.","settings.importButton":"Import Data","settings.section.dangerZone":"Danger Zone","settings.deleteAccount":"Delete Account","settings.deleteAccountHint":"Permanently delete your account and all associated data. This action cannot be undone.","settings.deleteAccountButton":"Delete Account","settings.deleteAccount.title":"Delete Account","settings.deleteAccount.warning":"This action <strong>cannot be undone</strong>. You will permanently lose:","settings.deleteAccount.loseTasks":"All your tasks","settings.deleteAccount.loseProjects":"All your projects","settings.deleteAccount.loseData":"All your account data and settings","settings.deleteAccount.confirmText":"To confirm account deletion, type <strong>delete</strong> below:","settings.deleteAccount.inputPlaceholder":"Type delete here","settings.deleteAccount.error":'Type "delete" exactly to confirm',"settings.deleteAccount.button":"Delete Account","settings.deleteAccount.success":"Account deleted successfully. Redirecting to login...","settings.cancelButton":"Cancel","settings.saveButton":"Save Settings","settings.avatarUploadDefault":"Drag & drop or click to upload avatar","settings.avatarUploadChange":"Change avatar","settings.avatarUploadAriaUpload":"Upload avatar","settings.avatarUploadAriaChange":"Change avatar","settings.logoUploadDefault":"Drag & drop or click to upload logo","settings.logoUploadChange":"Change logo","settings.logoUploadAriaUpload":"Upload logo","settings.logoUploadAriaChange":"Change logo","dashboard.title":"Dashboard","dashboard.hero.activeProjectsLabel":"Active Projects","dashboard.hero.completionRateLabel":"Completion Rate","dashboard.hero.tasksCompletionRateLabel":"Tasks Completion","dashboard.hero.projectsCompletionRateLabel":"Projects Completion","dashboard.hero.projectsTrend":"\u{1F4C8} +2 this month","dashboard.hero.completionTrend":"\u{1F3AF} Target: 80%","dashboard.projectAnalytics":"\u{1F4CA} Project Analytics","dashboard.period.week":"Week","dashboard.period.month":"Month","dashboard.period.quarter":"Quarter","dashboard.stat.pendingTasks":"Pending Tasks","dashboard.stat.inProgress":"In Progress","dashboard.stat.highPriority":"High Priority","dashboard.stat.overdue":"Overdue","dashboard.stat.completed":"Completed","dashboard.stat.projects":"Projects","dashboard.highPriorityHint":"High priority tasks due within 7 days (or overdue)","dashboard.projectProgress":"\u{1F30A} Project Progress","dashboard.legend.todo":"To Do","dashboard.legend.progress":"In Progress","dashboard.legend.review":"In Review","dashboard.legend.complete":"Complete","dashboard.viewAll":"View All","dashboard.quickActions":"\u26A1 Quick Actions","dashboard.action.generateReport":"Generate Report","dashboard.action.addTask":"Add Task","dashboard.action.viewCalendar":"View Calendar","dashboard.action.newProject":"New Project","dashboard.recentActivity":"\u{1F504} Recent Activity","dashboard.researchInsights":"\u{1F9E0} Insights","dashboard.activity.emptyTitle":"Welcome to your Dashboard!","dashboard.activity.emptySubtitle":"Start creating projects and tasks to see activity","dashboard.activity.completed":'Completed "{title}" {projectPart}',"dashboard.activity.createdProject":'Created new project "{project}"',"dashboard.activity.addedTask":'Added new task "{title}" {projectPart}',"dashboard.activity.inProject":"in {project}","dashboard.activity.toProject":"to {project}","dashboard.activity.recently":"Recently","dashboard.activity.justNow":"Just now","dashboard.activity.today":"Today","dashboard.activity.yesterday":"Yesterday","dashboard.activity.daysAgoShort":"{count}d ago","dashboard.activity.minuteAgo":"{count} minute ago","dashboard.activity.minutesAgo":"{count} minutes ago","dashboard.activity.hourAgo":"{count} hour ago","dashboard.activity.hoursAgo":"{count} hours ago","dashboard.activity.dayAgo":"{count} day ago","dashboard.activity.daysAgo":"{count} days ago","dashboard.trend.thisWeek":"this week","dashboard.trend.thisMonth":"this month","dashboard.trend.thisQuarter":"this quarter","dashboard.trend.dueTodayOne":"{count} due today","dashboard.trend.dueTodayMany":"{count} due today","dashboard.trend.onTrack":"On track","dashboard.trend.needsAttention":"Needs attention","dashboard.trend.allOnTrack":"All on track","dashboard.trend.criticalOne":"{count} critical","dashboard.trend.criticalMany":"{count} critical","dashboard.trend.completedOne":"{count} completed","dashboard.trend.completedMany":"{count} completed","dashboard.trend.inProgress":"In progress","dashboard.emptyProjects.title":"No projects yet","dashboard.emptyProjects.subtitle":"Create your first project to see progress visualization","dashboard.tasks":"tasks","dashboard.activity.allTitle":"All Recent Activity","dashboard.activity.allSubtitle":"Full history of your recent work","dashboard.activity.backToDashboard":"\u2190 Back to Dashboard","dashboard.insights.excellentTitle":"Excellent Progress","dashboard.insights.excellentDesc":"{percent}% completion rate exceeds target. Great momentum!","dashboard.insights.goodTitle":"Good Progress","dashboard.insights.goodDesc":"{percent}% completion rate is solid. Consider pushing to reach 80% target.","dashboard.insights.opportunityTitle":"Progress Opportunity","dashboard.insights.opportunityDesc":"{percent}% completion rate. Focus on completing current tasks to build momentum.","dashboard.insights.actionTitle":"Action Needed","dashboard.insights.actionDesc":"{percent}% completion rate is low. Break down large tasks and tackle smaller ones first.","dashboard.insights.todayTitle":"Today's Focus","dashboard.insights.todayDescOne":"{count} task is due today. Prioritize it for maximum impact.","dashboard.insights.todayDescMany":"{count} tasks are due today. Prioritize them for maximum impact.","dashboard.insights.overdueTitle":"Overdue Items","dashboard.insights.overdueDescOne":"{count} overdue task needs attention. Address it to prevent delays.","dashboard.insights.overdueDescMany":"{count} overdue tasks need attention. Address these to prevent delays.","dashboard.insights.highPriorityTitle":"High Priority Focus","dashboard.insights.highPriorityDescOne":"{count} high-priority task needs immediate attention.","dashboard.insights.highPriorityDescMany":"{count} high-priority tasks need immediate attention.","dashboard.insights.emptyProjectsTitle":"Empty Projects","dashboard.insights.emptyProjectsDescOne":"{count} project has no tasks yet. Add tasks to track progress.","dashboard.insights.emptyProjectsDescMany":"{count} projects have no tasks yet. Add tasks to track progress.","dashboard.insights.momentumTitle":"Strong Momentum","dashboard.insights.momentumDescOne":"{count} task completed this week. You're in a productive flow!","dashboard.insights.momentumDescMany":"{count} tasks completed this week. You're in a productive flow!","dashboard.insights.readyTitle":"Ready to Start","dashboard.insights.readyDesc":"Create your first project and add some tasks to begin tracking your progress.","dashboard.insights.caughtUpTitle":"All Caught Up","dashboard.insights.caughtUpDesc":"Great work! No urgent items detected. Consider planning your next milestones."},es:{"boot.loading":"Cargando Nautilus","lock.welcome":"Bienvenido de nuevo","lock.subtitle":"Ingresa la contrase\xF1a de acceso para continuar.","lock.sessionHint":"? La sesi\xF3n permanece iniciada por 24 horas.","lock.passwordLabel":"Contrase\xF1a","lock.passwordPlaceholder":"Ingresa la contrase\xF1a","lock.unlock":"Desbloquear","auth.backToUserLogin":"Volver al inicio de sesi\xF3n","auth.login.title":"Bienvenido a Nautilus","auth.login.subtitle":"Inicia sesi\xF3n para acceder a tu espacio","auth.login.identifierLabel":"Usuario o correo","auth.login.identifierPlaceholder":"Ingresa usuario o correo","auth.login.pinLabel":"PIN (4 d\xEDgitos)","auth.admin.title":"Acceso de administraci\xF3n","auth.admin.subtitle":"Ingresa el PIN maestro para acceder al panel de administraci\xF3n","auth.admin.pinLabel":"PIN maestro (4 d\xEDgitos)","auth.setup.title":"Completa tu configuraci\xF3n","auth.setup.subtitle":"Personaliza tu cuenta","auth.setup.usernameLabel":"Usuario","auth.setup.usernamePlaceholder":"p. ej., alex","auth.setup.usernameHint":"3-20 caracteres, solo letras min\xFAsculas y n\xFAmeros","auth.setup.displayNameLabel":"Nombre visible","auth.setup.displayNamePlaceholder":"p. ej., Alex Morgan","auth.setup.emailLabel":"Correo electr\xF3nico","auth.setup.emailPlaceholder":"tu.correo@ejemplo.com","auth.setup.emailHint":"Necesario para notificaciones y confirmaci\xF3n de eliminaci\xF3n de cuenta","auth.setup.newPinLabel":"Nuevo PIN (4 d\xEDgitos)","auth.setup.confirmPinLabel":"Confirmar PIN","auth.setup.next":"Siguiente","auth.setup.submit":"Completar configuraci\xF3n","admin.title":"Gesti\xF3n de usuarios","admin.signOut":"Cerrar sesi\xF3n","admin.usersTitle":"Usuarios","admin.createUserTitle":"Crear nuevo usuario","admin.usernameLabel":"Usuario","admin.usernamePlaceholder":"p. ej., jdoe","admin.usernameHint":"3-20 caracteres, solo letras min\xFAsculas y n\xFAmeros","admin.displayNameLabel":"Nombre visible","admin.displayNamePlaceholder":"p. ej., John Doe","admin.tempPinLabel":"PIN temporal (4 d\xEDgitos)","admin.createUserButton":"Crear usuario","auth.admin.resetPinPrompt":"Ingresa un nuevo PIN temporal para {userName}:","auth.admin.pinMustBe4Digits":"El PIN debe tener exactamente 4 d\xEDgitos","auth.admin.resetPinFailed":"No se pudo restablecer el PIN","auth.admin.resetPinSuccess":"PIN restablecido para {userName}. Nuevo PIN temporal: {pin}","auth.admin.deleteUserConfirm":'\xBFSeguro que deseas eliminar al usuario "{userName}"? Esto tambi\xE9n eliminar\xE1 todas sus tareas y proyectos.',"auth.admin.deleteUserFailed":"No se pudo eliminar el usuario","auth.admin.deleteUserSuccess":'Usuario "{userName}" eliminado correctamente',"common.cancel":"Cancelar","common.delete":"Eliminar","common.continue":"Continuar","common.gotIt":"Entendido","common.close":"Cerrar modal","common.done":"Listo","common.updating":"Actualizando...","common.nautilusLogoAlt":"Logo de Nautilus","common.devBanner":"\u26A0\uFE0F DESARROLLO LOCAL - NO PRODUCCI\xD3N \u26A0\uFE0F","common.datePlaceholder":"dd/mm/yyyy","crop.title":"Recortar imagen a cuadrado","crop.instructions":"Arrastra para ajustar el \xE1rea de recorte. La imagen se recortar\xE1 a un cuadrado.","crop.apply":"Recortar y aplicar","crop.close":"Cerrar recorte","dashboard.insights.productivityTitle":"Tendencia de productividad","dashboard.insights.productivityDesc":"La tasa de finalizaci\xF3n de tareas aument\xF3 un 23% respecto al mes pasado","dashboard.insights.deadlineTitle":"Alerta de plazos","dashboard.insights.deadlineDesc":"3 hitos vencen en los pr\xF3ximos 7 d\xEDas","projects.title":"Proyectos","projects.subtitle":"Gestiona tus proyectos","projects.searchPlaceholder":"\u{1F50D} Buscar proyectos (t\xEDtulo o descripci\xF3n)","projects.filters.status":"Estado","projects.filters.statusTitle":"Estado del proyecto","projects.status.backlog":"BACKLOG","projects.status.planning":"PLANIFICACI\xD3N","projects.status.active":"ACTIVO","projects.status.completed":"COMPLETADO","projects.filters.updated":"Actualizado","projects.filters.updatedTitle":"Actualizados recientemente","projects.filters.all":"Todos","projects.filters.last5m":"\xDAltimos 5 minutos","projects.filters.last30m":"\xDAltimos 30 minutos","projects.filters.last24h":"\xDAltimas 24 horas","projects.filters.lastWeek":"\xDAltima semana","projects.filters.lastMonth":"\xDAltimo mes","projects.filters.hasTasks":"Con tareas","projects.filters.noTasks":"Sin tareas","projects.filters.tags":"Etiquetas","projects.filters.tagsTitle":"Etiquetas de proyectos","projects.filters.clear":"Limpiar filtros","projects.noDescription":"Sin descripcion","projects.tasksBreakdown":"{total} tareas \xB7 {done} hechas","tasks.card.description":"Descripcion","projects.card.tasksCount":"{count} tareas","projects.card.percentDone":"{count}% hecho","projects.sort.label":"Ordenar: Estado","projects.sort.status":"Estado","projects.sort.name":"Nombre","projects.sort.newest":"M\xE1s reciente","projects.sort.lastUpdated":"\xDAltima actualizaci\xF3n","projects.sort.mostTasks":"M\xE1s tareas","projects.sort.percentCompleted":"% completado","projects.sort.prefix":"Ordenar: {label}","projects.sort.help":"Repite la misma opci\xF3n para alternar Asc/Desc.","projects.sort.statusLabel":"Estado","projects.sort.nameLabel":"Nombre","projects.sort.newestLabel":"M\xE1s reciente","projects.sort.lastUpdatedLabel":"\xDAltima actualizaci\xF3n","projects.sort.mostTasksLabel":"M\xE1s tareas","projects.sort.percentCompletedLabel":"% completado","projects.newProjectButton":"+ Nuevo proyecto","projects.openDetailsTitle":"Ver detalles del proyecto","projects.empty.title":"A\xFAn no hay proyectos","projects.empty.subtitle":"Crea tu primer proyecto","projects.empty.searchTitle":"No se encontraron proyectos","projects.empty.searchSubtitle":"Crea un nuevo proyecto para empezar","projects.empty.filteredTitle":"No hubo coincidencias de proyectos","projects.modal.createTitle":"Crear nuevo proyecto","projects.modal.nameLabel":"Nombre del proyecto","projects.modal.descriptionLabel":"Descripci\xF3n","projects.modal.startDateLabel":"Fecha de inicio","projects.modal.endDateLabel":"Fecha de fin","projects.modal.tagsLabel":"Etiquetas","projects.modal.addTagPlaceholder":"A\xF1adir etiqueta","projects.modal.createButton":"Crear proyecto","projects.delete.title":"Eliminar proyecto","projects.delete.body":"Esta acci\xF3n no se puede deshacer. Para confirmar, escribe delete abajo:","projects.delete.deleteTasksLabel":"Eliminar todas las tareas de este proyecto","projects.delete.deleteTasksHint":"Si no se marca, las tareas se desasignar\xE1n del proyecto","projects.delete.inputPlaceholder":"Escribe delete aqu\xED","projects.delete.error":'Escribe "delete" exactamente para confirmar',"projects.duplicate.title":"Duplicar proyecto","projects.duplicate.description":"Crear una copia de este proyecto con toda su configuraci\xF3n.","projects.duplicate.includeTasksLabel":"Incluir todas las tareas de este proyecto","projects.duplicate.taskNamingTitle":"Nomenclatura de tareas:","projects.duplicate.namingNone":"Mantener nombres originales","projects.duplicate.namingPrefix":"Agregar prefijo:","projects.duplicate.namingSuffix":"Agregar sufijo:","projects.duplicate.prefixPlaceholder":"ej., Copia - ","projects.duplicate.suffixPlaceholder":"ej., (Copia)","projects.duplicate.confirm":"Duplicar proyecto","projects.duplicate.success":'Proyecto "{name}" duplicado exitosamente',"projects.duplicate.successWithTasks":'Proyecto "{name}" y sus tareas duplicados exitosamente',"projects.statusInfo.title":"L\xF3gica del estado del proyecto","projects.statusInfo.subtitle":"El estado del proyecto se actualiza autom\xE1ticamente seg\xFAn el progreso de las tareas","projects.statusInfo.backlogTitle":"\u2B1B Backlog","projects.statusInfo.backlogDesc":'Todas las tareas est\xE1n en "Backlog"',"projects.statusInfo.planningTitle":"\u2B1C Planificaci\xF3n","projects.statusInfo.planningDesc":'Todas las tareas est\xE1n en "Por hacer"',"projects.statusInfo.activeTitle":"\u2705 Activo","projects.statusInfo.activeDesc":'Al menos una tarea est\xE1 en "En progreso" o "En revisi\xF3n"',"projects.statusInfo.completedTitle":"? Completado","projects.statusInfo.completedDesc":'Todas las tareas est\xE1n marcadas como "Hecho"',"projects.backTo.dashboard":"\u2190 Volver al panel","projects.backTo.calendar":"\u2190 Volver al calendario","projects.backTo.projects":"\u2190 Volver a proyectos","projects.details.tab.details":"Detalles","projects.details.tab.history":"Historial","projects.details.startDate":"Fecha de inicio","projects.details.endDate":"Fecha de fin","projects.details.duration":"Duraci\xF3n","projects.details.durationDays":"{count} d\xEDas","projects.details.created":"Creado","projects.details.calendarColor":"Color del calendario","projects.details.customColor":"Color personalizado","projects.details.progressOverview":"Resumen de progreso","projects.details.taskProgress":"Progreso de tareas","projects.details.tasksTitle":"Tareas ({count})","projects.details.changeHistory":"Historial de cambios","projects.details.noChanges":"A\xFAn no hay cambios para este proyecto","projects.details.noTasksFound":"No se encontraron tareas","projects.details.viewTodo":"Ver tareas Por hacer de este proyecto","projects.details.viewProgress":"Ver tareas En progreso de este proyecto","projects.details.viewReview":"Ver tareas En revisi\xF3n de este proyecto","projects.details.viewCompleted":"Ver tareas Completadas de este proyecto","projects.details.viewBacklog":"Ver tareas de backlog en vista de lista","projects.untitled":"Proyecto sin t\xEDtulo","tasks.title":"Todas las tareas","tasks.subtitle":"Gestiona tareas de todos los proyectos","tasks.searchPlaceholder":"\u{1F50D} Buscar tareas (t\xEDtulo o descripci\xF3n)","tasks.filters.status":"Estado","tasks.filters.statusTitle":"Estado","tasks.status.backlog":"Backlog","tasks.status.todo":"Por hacer","tasks.status.progress":"En progreso","tasks.status.review":"En revisi\xF3n","tasks.status.done":"Hecho","tasks.filters.tags":"Etiquetas","tasks.filters.tagsTitle":"Etiquetas","tasks.filters.searchTags":"Buscar etiquetas...","tasks.filters.priority":"Prioridad","tasks.filters.priorityTitle":"Prioridad","tasks.priority.high":"Alta","tasks.priority.medium":"Media","tasks.priority.low":"Baja","tasks.filters.project":"Proyecto","tasks.filters.projectTitle":"Proyecto","tasks.filters.selectAll":"Seleccionar / deseleccionar todo","tasks.filters.date":"Fecha","tasks.filters.endDate":"Fecha de Fin","tasks.filters.startDate":"Fecha de Inicio","tasks.filters.dateTitle":"Filtros r\xE1pidos por fecha","tasks.filters.endDateTitle":"Filtros de Fecha de Fin","tasks.filters.noDate":"Sin fecha de fin","tasks.filters.overdue":"Vencidas","tasks.filters.endToday":"Fecha de fin hoy","tasks.filters.endTomorrow":"Fecha de fin ma\xF1ana","tasks.filters.end7Days":"Fecha de fin en 7 d\xEDas","tasks.filters.endThisWeek":"Fecha de fin esta semana","tasks.filters.endThisMonth":"Fecha de fin este mes","tasks.filters.startDateTitle":"Filtros de Fecha de Inicio","tasks.filters.noStartDate":"Sin fecha de inicio","tasks.filters.alreadyStarted":"Ya comenz\xF3","tasks.filters.startToday":"Fecha de inicio hoy","tasks.filters.startTomorrow":"Fecha de inicio ma\xF1ana","tasks.filters.start7Days":"Fecha de inicio en 7 d\xEDas","tasks.filters.startThisWeek":"Fecha de inicio esta semana","tasks.filters.startThisMonth":"Fecha de inicio este mes","tasks.filters.updated":"Actualizado","tasks.filters.updatedTitle":"Actualizados recientemente","tasks.filters.dateFrom":"Fecha de inicio","tasks.filters.dateTo":"Fecha de fin","tasks.filters.clear":"Limpiar filtros","tasks.filters.presetActive":"Activas","tasks.filters.presetNotDone":"No hechas","tasks.filters.presetInProgress":"En progreso","tasks.filters.include":"Incluir","tasks.filters.exclude":"Excluir","tasks.filters.excluding":"Excluyendo","filters.noOtherProjects":"No hay otros proyectos","filters.noTags":"Sin etiquetas","filters.noOtherTags":"No hay otras etiquetas","filters.sheet.title":"Opciones","filters.chip.search":"B\xFAsqueda","filters.chip.project":"Proyecto","filters.chip.tag":"Etiqueta","filters.chip.date":"Fecha","filters.chip.updated":"Actualizado","filters.chip.removeAria":"Quitar filtro {label}","filters.dateRange.from":"Desde","filters.dateRange.until":"Hasta","filters.updated.week":"Semana","filters.updated.month":"Mes","tasks.kanban.tipLabel":"Consejo:","tasks.kanban.tipTextBefore":"En el tablero Kanban manten ","tasks.kanban.tipTextAfter":" (Cmd en Mac) y haz clic para seleccionar varias tareas. Shift + clic selecciona un rango, luego arrastra para moverlas juntas","tasks.view.kanban":"Kanban","tasks.view.list":"Lista","tasks.view.calendar":"Calendario","tasks.sort.label":"Ordenar: Prioridad","tasks.sort.orderByPriority":"Ordenar por prioridad","tasks.kanban.showBacklog":"Mostrar backlog","tasks.kanban.showProjects":"Mostrar proyectos","tasks.kanban.showNoDate":'Mostrar "Sin fecha"',"tasks.addButton":"+ A\xF1adir tarea","tasks.noProject":"Sin proyecto","tasks.projectIndicatorNone":"Sin proyecto - ","tasks.project.selectPlaceholder":"Selecciona un proyecto","tasks.tags.none":"Sin etiquetas","tasks.checklist.toggle":"Alternar casilla","tasks.untitled":"Tarea sin t\xEDtulo","tasks.startDatePrefix":"Fecha de inicio: ","tasks.endDatePrefix":"Fecha de fin: ","tasks.noDate":"Sin fecha","tasks.noDatesSet":"Sin fechas","tasks.noEndDate":"Sin fecha de fin","tasks.due.yesterday":"Ayer","tasks.due.daysOverdue":"{count} d\xEDas de atraso","tasks.due.tomorrow":"Ma\xF1ana","tasks.openTaskDetails":"Abrir detalles de la tarea","tasks.noTasksInProject":"No hay tareas en este proyecto","tasks.attachments.open":"Abrir","tasks.attachments.none":"Sin archivos adjuntos","tasks.attachments.remove":"Quitar archivo adjunto","tasks.attachments.removeTitle":"Quitar","tasks.attachments.removeLink":"Quitar enlace","tasks.attachments.googleDoc":"Documento de Google","tasks.attachments.googleSheet":"Hoja de c\xE1lculo de Google","tasks.attachments.googleSlides":"Presentaci\xF3n de Google","tasks.attachments.googleDriveFile":"Archivo de Google Drive","tasks.attachments.pdf":"Documento PDF","tasks.attachments.word":"Documento de Word","tasks.attachments.excel":"Archivo de Excel","tasks.attachments.powerpoint":"PowerPoint","tasks.empty.epic":"A\xFAn no hay tareas. Crea tu primera tarea para este \xE9pico.","tasks.backlogQuickTitle":"Abrir tareas de backlog en vista de lista","tasks.backlogQuickLabel":"Backlog","tasks.kanban.columnBacklog":"\u{1F9CA} Backlog","tasks.kanban.columnTodo":"\u{1F4CB} Por hacer","tasks.kanban.columnProgress":"\u{1F504} En progreso","tasks.kanban.columnReview":"\u2611\uFE0F En revisi\xF3n","tasks.kanban.columnDone":"\u2705 Hecho","tasks.table.task":"Tarea","tasks.table.priority":"Prioridad","tasks.table.status":"Estado","tasks.table.tags":"Etiquetas","tasks.table.project":"Proyecto","tasks.table.startDate":"Fecha de inicio","tasks.table.endDate":"Fecha de fin","tasks.table.updated":"Actualizado","tasks.list.count":"{count} resultados","tasks.massEdit.title":"Edici\xF3n Masiva","tasks.massEdit.selected":"{count} de {total} tareas seleccionadas","tasks.massEdit.selectedHidden":"{count} de {total} seleccionadas ({hidden} ocultas)","tasks.massEdit.status":"Estado","tasks.massEdit.priority":"Prioridad","tasks.massEdit.dates":"Fechas","tasks.massEdit.project":"Proyecto","tasks.massEdit.tags":"Etiquetas","tasks.massEdit.clear":"Limpiar","tasks.massEdit.applyChanges":"Aplicar cambios","tasks.massEdit.pendingChanges":"cambios pendientes","tasks.massEdit.changeQueued":"Cambio en cola","tasks.massEdit.apply":"Aplicar","tasks.massEdit.selectFirst":"Selecciona un valor primero","tasks.massEdit.cancel":"Cancelar","tasks.massEdit.selectAll":"Seleccionar todo filtrado","tasks.massEdit.startDate":"Fecha de inicio","tasks.massEdit.endDate":"Fecha de fin","tasks.massEdit.tags.add":"Agregar etiquetas (mantener existentes)","tasks.massEdit.tags.replace":"Reemplazar todas las etiquetas","tasks.massEdit.tags.remove":"Eliminar etiquetas espec\xEDficas","tasks.massEdit.tags.noExisting":"No hay etiquetas existentes","tasks.massEdit.success":"Se actualizaron {count} tareas","tasks.massEdit.confirm.title":"Confirmar edici\xF3n masiva","tasks.massEdit.confirm.summary":"Est\xE1s a punto de actualizar {count} tareas:","tasks.massEdit.confirm.field.status":"Estado \u2192 {value}","tasks.massEdit.confirm.field.priority":"Prioridad \u2192 {value}","tasks.massEdit.confirm.field.startDate":"Fecha de inicio \u2192 {value}","tasks.massEdit.confirm.field.endDate":"Fecha de fin \u2192 {value}","tasks.massEdit.confirm.field.project":"Proyecto \u2192 {value}","tasks.massEdit.confirm.field.tagsAdd":"Agregar etiquetas: {value}","tasks.massEdit.confirm.field.tagsReplace":"Reemplazar etiquetas con: {value}","tasks.massEdit.confirm.field.tagsRemove":"Eliminar etiquetas: {value}","tasks.massEdit.confirm.proceed":"S\xED, actualizar {count} tareas","tasks.massEdit.confirm.confirm":"Confirmar","tasks.massEdit.confirm.movingFrom":"de {from} a {to}","tasks.massEdit.confirm.variousTo":"de varios a {to}","tasks.massEdit.multiple":"M\xFAltiples","tasks.modal.editTitle":"Editar tarea","tasks.modal.duplicate":"\u{1F4C4} Duplicar tarea","tasks.modal.delete":"\u{1F5D1}\uFE0F Eliminar tarea","tasks.modal.tab.general":"General","tasks.modal.tab.details":"Detalles","tasks.modal.tab.history":"Historial","tasks.modal.titleLabel":"T\xEDtulo de la tarea","tasks.modal.attachmentsLabel":"Adjuntos","tasks.modal.attachmentsSupported":"Compatible: Im\xE1genes (10MB), PDF (20MB), Documentos (10MB)","tasks.modal.attachmentsDropzoneDefault":"Arrastra y suelta o haz clic para adjuntar","tasks.modal.attachmentsDropzoneTap":"Haz clic para adjuntar","tasks.modal.linksLabel":"Enlaces","tasks.modal.attachmentNamePlaceholder":"Nombre (opcional)","tasks.modal.attachmentUrlPlaceholder":"URL","tasks.modal.addLink":"Agregar enlace","tasks.modal.statusLabel":"Estado","tasks.modal.priorityLabel":"Prioridad","tasks.modal.tagsLabel":"Etiquetas","tasks.modal.addTagPlaceholder":"A\xF1adir etiqueta","tasks.modal.projectLabel":"Proyecto","tasks.modal.projectOpenTitle":"Abrir detalles del proyecto","tasks.modal.projectSelect":"Selecciona un proyecto","tasks.modal.submitCreate":"Crear tarea","tasks.modal.listBulleted":"\u2022 Lista","tasks.modal.listNumbered":"1. Lista","tasks.modal.insertDivider":"Insertar separador horizontal","tasks.modal.insertCheckbox":"Insertar casilla","tasks.history.emptyTitle":"A\xFAn no hay cambios","tasks.history.emptySubtitle":"Los cambios en esta tarea aparecer\xE1n aqu\xED","calendar.title":"Calendario","calendar.today":"Hoy","calendar.prevMonth":"Mes anterior","calendar.nextMonth":"Mes siguiente","calendar.dayItemsTitle":"Elementos para {date}","calendar.dayItemsProjects":"Proyectos","calendar.dayItemsTasks":"Tareas","calendar.dayItems.close":"Cerrar tareas del d\xEDa","calendar.dayItems.addTask":"+ Agregar Tarea","feedback.title":"Comentarios e incidencias","feedback.subtitle":"Reporta errores y sugiere funciones","feedback.saveStatus.saved":"Guardado","feedback.saveStatus.saving":"Guardando...","feedback.saveStatus.error":"No se pudo guardar","feedback.saveStatus.offline":"Sin conexion","feedback.type.bugLabel":"\u{1F41E} Error","feedback.type.title":"Tipo de comentario","feedback.type.bugOption":"\u{1F41E} Error","feedback.type.improvementOption":"\u{1F4A1} Mejora","feedback.descriptionPlaceholder":"Describe el problema o la idea. Puedes pegar una imagen directamente en este campo.","feedback.descriptionPlaceholderShort":"Describe el problema o la idea.","feedback.screenshotAttachTitle":"Adjuntar captura desde el dispositivo","feedback.screenshotDropzoneTap":"\u{1F4F7} Adjuntar captura","feedback.screenshotDropzoneDefault":"\u{1F4F7} Arrastra o haz clic para adjuntar","feedback.screenshotPreviewTitle":"Captura adjunta","feedback.screenshotPreviewSubtitle":"Se guardar\xE1 con este comentario","feedback.screenshotRemove":"Eliminar","feedback.screenshotPreviewAlt":"Vista previa de la captura","feedback.viewScreenshotTitle":"Ver captura","feedback.pagination.first":"Primera p\xE1gina","feedback.pagination.prev":"P\xE1gina anterior","feedback.pagination.next":"P\xE1gina siguiente","feedback.pagination.last":"\xDAltima p\xE1gina","feedback.pagination.showing":"Mostrando {start}-{end} de {total}","feedback.pagination.pageOf":"P\xE1gina {current} de {total}","feedback.addButton":"Agregar","feedback.pendingTitle":"? Pendiente","feedback.doneTitle":"? Hecho","feedback.delete.title":"Eliminar comentario","feedback.delete.body":"\xBFSeguro que deseas eliminar este comentario?","feedback.empty.pending":"No hay feedback pendiente","feedback.empty.done":"No hay feedback completado","export.title":"Exportar datos","export.body":"Esto descargar\xE1 una copia completa de todas tus tareas, proyectos y ajustes como un archivo JSON. \xBFSeguro que deseas exportar tus datos?","export.confirm":"Exportar","import.title":"Importar datos","import.warningTitle":"ADVERTENCIA: Esto es un REEMPLAZO COMPLETO","import.warningBody":"Importar datos <strong>reemplazar\xE1 permanentemente</strong> todos tus datos actuales:","import.warningTasks":"Todas las tareas","import.warningProjects":"Todos los proyectos","import.warningSettings":"Todas las configuraciones y preferencias","import.warningHistory":"Todos los registros de historial","import.warningIrreversible":"Esta acci\xF3n no se puede deshacer. Tus datos actuales se perder\xE1n.","import.fileLabel":"Selecciona el archivo de respaldo para importar:","import.dropzoneDefault":"Arrastra y suelta o haz clic para seleccionar el archivo de respaldo","import.fileHint":"Solo se admiten archivos JSON exportados desde Nautilus","import.previewTitle":"Vista previa de importaci\xF3n:","import.confirmText":"Para confirmar la importaci\xF3n y reemplazar todos tus datos, escribe <strong>import</strong> a continuaci\xF3n:","import.inputPlaceholder":"Escribe import aqu\xED","import.error":'Escribe "import" exactamente para confirmar',"import.button":"Importar datos","import.processing":"Importando datos...","import.success":"\xA1Datos importados exitosamente! Todos los datos han sido reemplazados.","import.errorInvalidFile":"Tipo de archivo inv\xE1lido. Por favor, selecciona un archivo JSON.","import.errorInvalidFormat":"Formato de archivo inv\xE1lido. El archivo no parece ser un respaldo v\xE1lido de Nautilus.","import.errorParseFailed":"Error al analizar el archivo. Por favor, aseg\xFArate de que el archivo sea JSON v\xE1lido.","import.errorReadFailed":"Error al leer el archivo. Por favor, int\xE9ntalo de nuevo.","import.errorNoFile":"Por favor, selecciona un archivo para importar.","import.errorFailed":"Error al importar datos","confirm.deleteTask.title":"Eliminar tarea","confirm.deleteTask.body":"Esta acci\xF3n no se puede deshacer. Para confirmar, escribe delete abajo:","confirm.deleteTask.inputPlaceholder":"Escribe delete aqu\xED","confirm.deleteTask.error":'Escribe "delete" exactamente para confirmar',"confirm.unsaved.title":"Cambios sin guardar","confirm.unsaved.body":"Tienes cambios sin guardar. \xBFSeguro que quieres cerrar y perderlos?","confirm.unsaved.discard":"Descartar cambios","confirm.review.title":'Desactivar estado "En revisi\xF3n"',"error.saveDataFailed":"No se pudieron guardar los datos. Int\xE9ntalo de nuevo.","error.saveProjectsFailed":"No se pudieron guardar los proyectos. Int\xE9ntalo de nuevo.","error.saveTasksFailed":"No se pudieron guardar las tareas. Int\xE9ntalo de nuevo.","error.saveFeedbackFailed":"No se pudo guardar el feedback. Int\xE9ntalo de nuevo.","error.saveProjectColorsFailed":"No se pudieron guardar los colores del proyecto.","error.saveTaskFailed":"No se pudo guardar la tarea. Int\xE9ntalo de nuevo.","error.saveChangesFailed":"No se pudieron guardar los cambios. Int\xE9ntalo de nuevo.","error.saveTaskPositionFailed":"No se pudo guardar la posici\xF3n de la tarea. Int\xE9ntalo de nuevo.","error.saveProjectFailed":"No se pudo guardar el proyecto. Int\xE9ntalo de nuevo.","error.notLoggedInResetPin":"Debes iniciar sesi\xF3n para restablecer tu PIN","error.resetPinFailed":"No se pudo restablecer el PIN","error.unauthorized":"No est\xE1s autorizado para realizar esta acci\xF3n","error.deleteAccountFailed":"No se pudo eliminar la cuenta. Por favor, int\xE9ntalo de nuevo.","success.resetPin":"\xA1PIN restablecido con \xE9xito! Tendr\xE1s que iniciar sesi\xF3n de nuevo con tu nuevo PIN.","error.resetPinError":"Ocurri\xF3 un error al restablecer el PIN","error.userNameEmpty":"El nombre de usuario no puede estar vac\xEDo.","error.saveDisplayNameFailed":"No se pudo guardar el nombre visible. Int\xE9ntalo de nuevo.","error.invalidEmail":"Por favor, introduce un correo v\xE1lido.","error.saveEmailFailed":"No se pudo guardar el correo. Int\xE9ntalo de nuevo.","error.saveAvatarFailed":"No se pudo guardar el avatar. Int\xE9ntalo de nuevo.","success.settingsSaved":"\xA1Ajustes guardados correctamente!","error.logoSelectFile":"Selecciona un archivo de imagen para el logo del espacio de trabajo.","error.logoTooLarge":"Usa una imagen menor de 2 MB para el logo del espacio de trabajo.","error.imageReadFailed":"No se pudo leer la imagen seleccionada.","error.imageLoadFailed":"No se pudo cargar la imagen seleccionada.","error.logoUploadFailed":"Error al subir el logo: {message}","error.cropInvalid":"Error: el estado del recorte no es v\xE1lido.","error.cropTooLarge":"La imagen recortada es demasiado grande. Selecciona un \xE1rea m\xE1s peque\xF1a o usa una imagen m\xE1s peque\xF1a.","success.cropApplied":"\xA1Imagen recortada y aplicada correctamente!","success.logoCroppedApplied":"\xA1Logo del espacio de trabajo recortado y aplicado correctamente!","error.cropFailed":"Error al recortar la imagen: {message}","error.avatarSelectFile":"Selecciona un archivo de imagen para tu avatar.","error.avatarTooLarge":"Usa una imagen menor de 2 MB para tu avatar.","error.avatarUploadFailed":"No se pudo subir el avatar. Int\xE9ntalo de nuevo.","error.endDateBeforeStart":"La fecha de fin no puede ser anterior a la fecha de inicio","error.startDateAfterEnd":"La fecha de inicio no puede ser posterior a la fecha de fin","error.feedbackAttachImage":"Adjunta un archivo de imagen.","error.feedbackReadImage":"No se pudo leer la imagen. Int\xE9ntalo de nuevo.","error.feedbackStatusFailed":"No se pudo actualizar el estado del feedback. Int\xE9ntalo de nuevo.","error.attachmentSaveFailed":"No se pudo guardar el adjunto. Int\xE9ntalo de nuevo.","error.attachmentLoadFailed":"No se pudo cargar la imagen: {message}","success.fileDownloaded":"\xA1Archivo descargado!","error.fileDownloadFailed":"No se pudo descargar el archivo: {message}","success.attachmentDeletedFromStorage":"{name} eliminado del almacenamiento","error.fileDeleteFailed":"No se pudo eliminar el archivo del almacenamiento","success.attachmentRemoved":"Adjunto eliminado","error.fileSizeTooLarge":"El tama\xF1o del archivo debe ser menor de {maxMB} MB. Elige uno m\xE1s peque\xF1o.","success.fileUploaded":"\xA1Archivo subido correctamente!","error.fileUploadFailed":"Error al subir el archivo: {message}","error.selectFile":"Selecciona un archivo","error.saveTagFailed":"No se pudo guardar la etiqueta. Int\xE9ntalo de nuevo.","error.removeTagFailed":"No se pudo eliminar la etiqueta. Int\xE9ntalo de nuevo.","error.openScreenshotFailed":"No se pudo abrir la captura","history.sort.newest":"\u2191 M\xE1s recientes primero","history.sort.oldest":"\u2193 M\xE1s antiguos primero","history.field.title":"T\xEDtulo","history.field.name":"Nombre","history.field.description":"Descripci\xF3n","history.field.status":"Estado","history.field.priority":"Prioridad","history.field.category":"Categor\xEDa","history.field.startDate":"Fecha de inicio","history.field.endDate":"Fecha de fin","history.field.link":"Enlace","history.field.task":"Enlace","history.field.projectId":"Proyecto","history.field.tags":"Etiquetas","history.field.attachments":"Adjuntos","history.action.created":"Creado","history.action.deleted":"Eliminado","history.link.added":"Agregado","history.link.removed":"Eliminado","history.entity.task":"tarea","history.value.empty":"vac\xEDo","history.value.none":"ninguno","history.change.beforeLabel":"Antes:","history.change.afterLabel":"Despu\xE9s:","history.change.notSet":"Sin establecer","history.change.removed":"Eliminado","history.tags.none":"Sin etiquetas","history.attachments.none":"Sin archivos adjuntos","history.attachments.countSingle":"{count} archivo","history.attachments.countPlural":"{count} archivos","history.project.fallback":"Proyecto #{id}","history.change.arrow":"\u2192","menu.openMenu":"Abrir men\xFA","menu.language":"Idioma","menu.darkMode":"Modo oscuro","menu.lightMode":"Modo claro","menu.settings":"Configuraci\xF3n","menu.help":"Ayuda","menu.signOut":"Cerrar sesi\xF3n","nav.overview":"Resumen","nav.dashboard":"Panel","nav.updates":"Notas de versi\xF3n","nav.calendar":"Calendario","nav.work":"Trabajo","nav.projects":"Proyectos","nav.allTasks":"Todas las tareas","nav.feedback":"Comentarios","updates.title":"Notas de versi\xF3n","updates.subtitle":"\xDAltimo registro de cambios en Nautilus","updates.latestLabel":"Ultima version","updates.historyLabel":"Registro de versiones","updates.sections.new":"Novedades","updates.sections.improvements":"Mejoras","updates.sections.fixes":"Correcciones","updates.empty":"Todavia no hay notas de version.","updates.sectionEmpty":"Todav\xEDa no hay entradas.","updates.historyEmpty":"Sin versiones anteriores.","notifications.title":"Notificaciones","notifications.toggle":"Notificaciones","notifications.today":"Hoy","notifications.yesterday":"Ayer","notifications.clearAll":"Limpiar todo","notifications.releaseTitle":"Nueva versi\xF3n","notifications.releaseCta":"Ver actualizaciones","notifications.releaseMeta":"Publicado {date}","notifications.dueTodayTitle":"Vence hoy","notifications.dueTodayCta":"Ver tareas","notifications.dueTodayMetaOne":"{count} tarea vence hoy","notifications.dueTodayMetaMany":"{count} tareas vencen hoy","notifications.dueTodayMore":"y {count} tareas m\xE1s","notifications.empty":"Todo al d\xEDa.","settings.title":"Configuraci\xF3n","settings.subtitle":"Administra tus preferencias y la configuraci\xF3n de la aplicaci\xF3n","settings.section.profile":"Perfil","settings.displayName":"Nombre para mostrar","settings.displayNameHint":"Este nombre se muestra en toda la aplicaci\xF3n","settings.placeholder.displayName":"Escribe tu nombre para mostrar","settings.email":"Correo electr\xF3nico","settings.emailHint":"Se usa para tu cuenta y notificaciones de vencimiento","settings.placeholder.email":"Escribe tu correo","settings.avatar":"Avatar","settings.avatarHint":"Sube una imagen para tu avatar (m\xE1x. 2 MB). Se mostrar\xE1 en forma circular.","settings.avatarRemoveTitle":"Eliminar avatar","settings.workspaceLogo":"Logo del espacio de trabajo","settings.workspaceLogoHint":"Sube una imagen cuadrada para reemplazar el logo de Nautilus (m\xE1x. 2 MB).","settings.workspaceLogoRemoveTitle":"Eliminar logo personalizado","settings.section.application":"Aplicaci\xF3n","settings.enableReviewStatus":"Habilitar estado En revisi\xF3n","settings.enableReviewStatusHint":"Muestra u oculta la columna y el filtro de estado EN REVISI\xD3N","settings.enableReviewStatusHintPrefix":"Muestra u oculta la columna y el filtro del estado","settings.enableReviewStatusHintSuffix":"en la vista de tareas","settings.calendarIncludeBacklog":"Mostrar backlog en calendario","settings.calendarIncludeBacklogHint":"Muestra tareas en backlog en todas las vistas de calendario","settings.autoStartDate":"Autocompletar fecha de inicio","settings.autoStartDateHint":'Establece autom\xE1ticamente la fecha de inicio cuando la tarea pasa a "En progreso" (si est\xE1 vac\xEDa)',"settings.autoEndDate":"Autocompletar fecha de fin","settings.autoEndDateHint":'Establece autom\xE1ticamente la fecha de fin cuando la tarea pasa a "Hecho" (si est\xE1 vac\xEDa)',"settings.debugLogs":"Habilitar logs de depuracion","settings.debugLogsHint":"Guarda logs de diagnostico en la consola del navegador al activarlo","settings.historySortOrder":"Orden de historial","settings.historySortOrderHint":"Orden predeterminado para los historiales de tareas y proyectos","settings.historySortNewest":"M\xE1s reciente primero","settings.historySortOldest":"M\xE1s antiguo primero","settings.language":"Idioma","settings.languageHint":"Elige el idioma de la aplicaci\xF3n","settings.section.notifications":"Notificaciones","settings.emailNotifications":"Notificaciones por correo","settings.emailNotificationsHint":"Activa o desactiva los correos de recordatorio de vencimientos","settings.weekdaysOnly":"Solo d\xEDas laborables","settings.weekdaysOnlyHint":"Omitir correos s\xE1bado y domingo","settings.includeStartDates":"Notificar cuando las tareas comienzan","settings.includeStartDatesHint":"Enviar recordatorios cuando una tarea comienza (ej., hoy)","settings.includeBacklog":"Incluir tareas en backlog","settings.includeBacklogHint":"Incluir tareas en backlog en notificaciones por correo y en la app","settings.sendTime":"Hora de env\xEDo","settings.sendTimeHint":"Hora diaria de env\xEDo (08:00-18:00, intervalos de 30 minutos)","settings.timeZone":"Zona horaria","settings.timeZoneHint":"Mantiene la misma hora local todo el a\xF1o (con horario de verano)","settings.timeZone.option.argentina":"Argentina (Buenos Aires)","settings.timeZone.option.canary":"Islas Canarias (Atlantic/Canary)","settings.timeZone.option.spain":"Espa\xF1a peninsular (Europe/Madrid)","settings.timeZone.option.utc":"UTC","settings.section.security":"Seguridad","settings.pinManagement":"Gesti\xF3n de PIN","settings.pinManagementHint":"Restablece tu PIN a un nuevo c\xF3digo de 4 d\xEDgitos","settings.resetPinButton":"Restablecer PIN","settings.section.dataManagement":"Gesti\xF3n de datos","settings.exportData":"Exportar datos","settings.exportDataHint":"Descarga una copia de seguridad completa de tus tareas, proyectos y configuraci\xF3n en un archivo JSON","settings.exportButton":"Exportar","settings.importData":"Importar datos","settings.importDataHint":"Importa un archivo de copia de seguridad para reemplazar todos tus datos actuales. Esta acci\xF3n no se puede deshacer.","settings.importButton":"Importar datos","settings.section.dangerZone":"Zona de peligro","settings.deleteAccount":"Eliminar cuenta","settings.deleteAccountHint":"Elimina permanentemente tu cuenta y todos los datos asociados. Esta acci\xF3n no se puede deshacer.","settings.deleteAccountButton":"Eliminar cuenta","settings.deleteAccount.title":"Eliminar cuenta","settings.deleteAccount.warning":"Esta acci\xF3n <strong>no se puede deshacer</strong>. Perder\xE1s permanentemente:","settings.deleteAccount.loseTasks":"Todas tus tareas","settings.deleteAccount.loseProjects":"Todos tus proyectos","settings.deleteAccount.loseData":"Todos tus datos de cuenta y configuraci\xF3n","settings.deleteAccount.confirmText":"Para confirmar la eliminaci\xF3n de la cuenta, escribe <strong>delete</strong> a continuaci\xF3n:","settings.deleteAccount.inputPlaceholder":"Escribe delete aqu\xED","settings.deleteAccount.error":'Escribe "delete" exactamente para confirmar',"settings.deleteAccount.button":"Eliminar cuenta","settings.deleteAccount.success":"Cuenta eliminada exitosamente. Redirigiendo al inicio de sesi\xF3n...","settings.cancelButton":"Cancelar","settings.saveButton":"Guardar configuraci\xF3n","settings.avatarUploadDefault":"Arrastra y suelta o haz clic para subir un avatar","settings.avatarUploadChange":"Cambiar avatar","settings.avatarUploadAriaUpload":"Subir avatar","settings.avatarUploadAriaChange":"Cambiar avatar","settings.logoUploadDefault":"Arrastra y suelta o haz clic para subir un logo","settings.logoUploadChange":"Cambiar logo","settings.logoUploadAriaUpload":"Subir logo","settings.logoUploadAriaChange":"Cambiar logo","dashboard.title":"Panel","dashboard.hero.activeProjectsLabel":"Proyectos activos","dashboard.hero.completionRateLabel":"Tasa de finalizaci\xF3n","dashboard.hero.tasksCompletionRateLabel":"Tareas","dashboard.hero.projectsCompletionRateLabel":"Proyectos","dashboard.hero.projectsTrend":"\u{1F4C8} +2 este mes","dashboard.hero.completionTrend":"\u{1F3AF} Objetivo: 80%","dashboard.projectAnalytics":"\u{1F4CA} Anal\xEDtica proyectos","dashboard.period.week":"Semana","dashboard.period.month":"Mes","dashboard.period.quarter":"Trimestre","dashboard.stat.pendingTasks":"Tareas pendientes","dashboard.stat.inProgress":"En progreso","dashboard.stat.highPriority":"Alta prioridad","dashboard.stat.overdue":"Vencidas","dashboard.stat.completed":"Completadas","dashboard.stat.projects":"Proyectos","dashboard.highPriorityHint":"Tareas de alta prioridad con vencimiento en 7 d\xEDas (o vencidas)","dashboard.projectProgress":"\u{1F30A} Progreso del proyecto","dashboard.legend.todo":"Por hacer","dashboard.legend.progress":"En progreso","dashboard.legend.review":"En revisi\xF3n","dashboard.legend.complete":"Completo","dashboard.viewAll":"Ver todo","dashboard.quickActions":"\u26A1 Acciones r\xE1pidas","dashboard.action.generateReport":"Generar informe","dashboard.action.addTask":"Agregar tarea","dashboard.action.viewCalendar":"Ver calendario","dashboard.action.newProject":"Nuevo proyecto","dashboard.recentActivity":"\u{1F504} Actividad reciente","dashboard.researchInsights":"\u{1F9E0} Perspectivas","dashboard.activity.emptyTitle":"Bienvenido a tu panel","dashboard.activity.emptySubtitle":"Empieza a crear proyectos y tareas para ver actividad","dashboard.activity.completed":'Completaste "{title}" {projectPart}',"dashboard.activity.createdProject":'Creaste el nuevo proyecto "{project}"',"dashboard.activity.addedTask":'Agregaste la nueva tarea "{title}" {projectPart}',"dashboard.activity.inProject":"en {project}","dashboard.activity.toProject":"a {project}","dashboard.activity.recently":"Recientemente","dashboard.activity.justNow":"Justo ahora","dashboard.activity.today":"Hoy","dashboard.activity.yesterday":"Ayer","dashboard.activity.daysAgoShort":"hace {count}d","dashboard.activity.minuteAgo":"hace {count} minuto","dashboard.activity.minutesAgo":"hace {count} minutos","dashboard.activity.hourAgo":"hace {count} hora","dashboard.activity.hoursAgo":"hace {count} horas","dashboard.activity.dayAgo":"hace {count} d\xEDa","dashboard.activity.daysAgo":"hace {count} d\xEDas","dashboard.trend.thisWeek":"esta semana","dashboard.trend.thisMonth":"este mes","dashboard.trend.thisQuarter":"este trimestre","dashboard.trend.dueTodayOne":"{count} vence hoy","dashboard.trend.dueTodayMany":"{count} vencen hoy","dashboard.trend.onTrack":"En buen camino","dashboard.trend.needsAttention":"Necesita atenci\xF3n","dashboard.trend.allOnTrack":"Todo en buen camino","dashboard.trend.criticalOne":"{count} cr\xEDtica","dashboard.trend.criticalMany":"{count} cr\xEDticas","dashboard.trend.completedOne":"{count} completada","dashboard.trend.completedMany":"{count} completadas","dashboard.trend.inProgress":"En progreso","dashboard.emptyProjects.title":"A\xFAn no hay proyectos","dashboard.emptyProjects.subtitle":"Crea tu primer proyecto para ver la visualizaci\xF3n de progreso","dashboard.tasks":"tareas","dashboard.activity.allTitle":"Toda la actividad reciente","dashboard.activity.allSubtitle":"Historial completo de tu trabajo reciente","dashboard.activity.backToDashboard":"\u2190 Volver al panel","dashboard.insights.excellentTitle":"Progreso excelente","dashboard.insights.excellentDesc":"{percent}% de finalizaci\xF3n supera el objetivo. Gran impulso.","dashboard.insights.goodTitle":"Buen progreso","dashboard.insights.goodDesc":"{percent}% de finalizaci\xF3n es s\xF3lido. Intenta llegar al objetivo de 80%.","dashboard.insights.opportunityTitle":"Oportunidad de progreso","dashboard.insights.opportunityDesc":"{percent}% de finalizaci\xF3n. Enf\xF3cate en completar tareas actuales para ganar impulso.","dashboard.insights.actionTitle":"Acci\xF3n necesaria","dashboard.insights.actionDesc":"{percent}% de finalizaci\xF3n es bajo. Divide tareas grandes y empieza con las peque\xF1as.","dashboard.insights.todayTitle":"Enfoque de hoy","dashboard.insights.todayDescOne":"{count} tarea vence hoy. Prior\xEDzala para mayor impacto.","dashboard.insights.todayDescMany":"{count} tareas vencen hoy. Prior\xEDzalas para mayor impacto.","dashboard.insights.overdueTitle":"Elementos vencidos","dashboard.insights.overdueDescOne":"{count} tarea vencida necesita atenci\xF3n. Ati\xE9ndela para evitar retrasos.","dashboard.insights.overdueDescMany":"{count} tareas vencidas necesitan atenci\xF3n. Ati\xE9ndelas para evitar retrasos.","dashboard.insights.highPriorityTitle":"Enfoque de alta prioridad","dashboard.insights.highPriorityDescOne":"{count} tarea de alta prioridad necesita atenci\xF3n inmediata.","dashboard.insights.highPriorityDescMany":"{count} tareas de alta prioridad necesitan atenci\xF3n inmediata.","dashboard.insights.emptyProjectsTitle":"Proyectos sin tareas","dashboard.insights.emptyProjectsDescOne":"{count} proyecto no tiene tareas a\xFAn. Agrega tareas para seguir el progreso.","dashboard.insights.emptyProjectsDescMany":"{count} proyectos no tienen tareas a\xFAn. Agrega tareas para seguir el progreso.","dashboard.insights.momentumTitle":"Buen impulso","dashboard.insights.momentumDescOne":"{count} tarea completada esta semana. Vas en buen ritmo.","dashboard.insights.momentumDescMany":"{count} tareas completadas esta semana. Vas en buen ritmo.","dashboard.insights.readyTitle":"Listo para empezar","dashboard.insights.readyDesc":"Crea tu primer proyecto y agrega tareas para comenzar a seguir tu progreso.","dashboard.insights.caughtUpTitle":"Todo al d\xEDa","dashboard.insights.caughtUpDesc":"Buen trabajo. No hay urgencias. Considera planificar tus pr\xF3ximos hitos."}};function Vb(){return localStorage.getItem("authToken")}function _l(){let t=Vb(),e={"Content-Type":"application/json"};return t&&(e.Authorization=`Bearer ${t}`),e}var Wb=2e4;async function Vl(t,e={},n=Wb){let s=new AbortController,o=setTimeout(()=>s.abort(),n);try{return await fetch(t,{...e,signal:s.signal})}finally{clearTimeout(o)}}async function dn(t,e){try{let n=await Vl(`/api/storage?key=${encodeURIComponent(t)}`,{method:"POST",headers:_l(),body:JSON.stringify(e)});if(!n.ok)throw n.status===401?(window.location.hash="#login",new Error("Unauthorized - please login")):new Error(`Failed to save data: ${n.status} ${n.statusText}`);return!0}catch(n){throw console.error(`Error saving data for key "${t}":`,n),n}}async function an(t){try{let e=await Vl(`/api/storage?key=${encodeURIComponent(t)}`,{headers:_l()});if(!e.ok){if(e.status===401)return window.location.hash="#login",null;if(e.status===404)return null;throw new Error(`Failed to load data: ${e.status} ${e.statusText}`)}let n=await e.text();return n&&n!=="null"?JSON.parse(n):null}catch(e){return console.error(`Error loading data for key "${t}":`,e),null}}async function gp(t){try{let e=Array.isArray(t)?t:[],n=encodeURIComponent(e.join(",")),s=await Vl(`/api/storage/batch?keys=${n}`,{headers:_l()});if(!s.ok)return s.status===401&&(window.location.hash="#login"),null;let o=await s.json();return o&&typeof o=="object"?o:null}catch(e){return console.error("Error batch loading data:",e),null}}async function kp(t){let e=ba(Xo);Array.isArray(t)&&co(Xo,t);try{await dn("tasks",t)}catch(n){co(Xo,e);let s=n?.message??String(n),o=n?.stack;throw console.error("[Storage Service] saveTasks failed:",s),o&&console.error("[Storage Service] Stack:",o),n}}async function bp(t){let e=ba(Zo);Array.isArray(t)&&co(Zo,t);try{await dn("projects",t)}catch(n){throw co(Zo,e),console.error("Error saving projects:",n),n}}async function vp(t){let e=Array.isArray(t)?t:[],n=Tp(Ds);Qo(Ds,e);try{await dn("feedbackItems",e)}catch(s){throw Qo(Ds,n),console.error("Error saving feedback items:",s),s}}async function wp(t){try{await dn("projectColors",t)}catch(e){throw console.error("Error saving project colors:",e),e}}async function Sp(t,e){try{await Promise.all([dn("sortMode",t),dn("manualTaskOrder",e)])}catch(n){throw console.error("Error saving sort state:",n),n}}async function Ep(t={}){let e=!!t.preferCache,n=t.feedback||{};try{let s=e?ba(Xo):[],o=e?ba(Zo):[],r=n.preferCache??e,a=await Dp({...n,preferCache:r}),i=s&&s.length>0||o&&o.length>0;if(e&&i){let l=typeof t.onRefresh=="function"?t.onRefresh:null,c={...t,preferCache:!1,feedback:{...n,preferCache:!1}};return yp(c).then(d=>{l&&l(d)}),{tasks:s||[],projects:o||[],feedbackItems:a||[]}}return await yp({...t,feedback:{...n,preferCache:r}})}catch(s){return console.error("Error loading all data:",s),{tasks:[],projects:[],feedbackItems:[]}}}var Ds="feedbackItemsCache:v1",Xo="tasksCache:v1",Zo="projectsCache:v1",Kb="nautilus_cache_token:v1";function xp(t,e){try{let n=e??localStorage.getItem("authToken");return n?`${t}:${n}`:t}catch{return t}}function ba(t){try{let e=localStorage.getItem("authToken"),n=xp(t,e),s=localStorage.getItem(n),o=s?JSON.parse(s):[];return Array.isArray(o)&&o.length>0||Array.isArray(o)?o:[]}catch{return[]}}function co(t,e){try{let n=localStorage.getItem("authToken");localStorage.setItem(xp(t,n),JSON.stringify(e||[])),n&&localStorage.setItem(Kb,n)}catch{}}function Tp(t){let e=t||Ds;try{let n=localStorage.getItem(e),s=n?JSON.parse(n):[];return Array.isArray(s)?s:[]}catch{return[]}}function Qo(t,e){let n=t||Ds;try{localStorage.setItem(n,JSON.stringify(e||[]))}catch{}}function Jb(t,e){let n=e.limitPending,s=e.limitDone;if(!Array.isArray(t)||!Number.isInteger(n)&&!Number.isInteger(s))return t;let o=[],r=[];for(let l of t){if(!l)continue;(l.status==="done"?"done":"open")==="done"?r.push(l):o.push(l)}let a=Number.isInteger(n)?o.slice(0,n):o,i=Number.isInteger(s)?r.slice(0,s):r;return[...a,...i]}async function yp(t={}){let e=t.feedback||{},n=await gp(["tasks","projects","feedbackItems"]),s=n&&Array.isArray(n.tasks)?n.tasks:null,o=n&&Array.isArray(n.projects)?n.projects:null,r=n&&Array.isArray(n.feedbackItems)?n.feedbackItems:null,a=s!==null?Promise.resolve(s):an("tasks"),i=o!==null?Promise.resolve(o):an("projects"),l=r!==null?Promise.resolve(Jb(r,e)):Dp(e),[c,d,u]=await Promise.all([a,i,l]),p=Array.isArray(c)?c:[],f=Array.isArray(d)?d:[],h=Array.isArray(u)?u:[];co(Xo,p),co(Zo,f);let m=e.cacheKey||Ds;return Qo(m,h),{tasks:p,projects:f,feedbackItems:h}}async function Dp(t={}){let e=[];try{let n=t.cacheKey||Ds;if(e=t.useCache===!1?[]:Tp(n),!!(t.preferCache&&e.length>0))return an("feedbackItems").then(r=>{Array.isArray(r)&&r.length>0&&(Qo(n,r),typeof t.onRefresh=="function"&&t.onRefresh({feedbackItems:r}))}).catch(()=>{}),e;let o=await an("feedbackItems");return Array.isArray(o)&&o.length>0?(Qo(n,o),o):e||[]}catch(n){return console.error("Error loading feedback items:",n),e||[]}}async function Ip(){try{let[t,e]=await Promise.all([an("sortMode"),an("manualTaskOrder")]);return{sortMode:t==="auto"||!t?"priority":t,manualTaskOrder:e||{todo:[],progress:[],review:[],done:[]}}}catch(t){return console.error("Error loading sort state:",t),{sortMode:"priority",manualTaskOrder:{todo:[],progress:[],review:[],done:[]}}}}async function Cp(){try{return await an("projectColors")||{}}catch(t){return console.error("Error loading project colors:",t),{}}}async function Ap(t){try{await dn("settings",t)}catch(e){throw console.error("Error saving settings:",e),e}}async function Mp(){try{return await an("settings")||{}}catch(t){return console.error("Error loading settings:",t),{}}}function Wl(t){return t&&t.charAt(0).toUpperCase()+t.slice(1)}function $t(t){return typeof t=="string"&&/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{4}$/.test(t.trim())}function Vt(t){return typeof t=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(t.trim())}function un(t){if(!$t(t))return t||"";let e=t.trim().split(/[\/\-]/),n=parseInt(e[0],10),s=parseInt(e[1],10),o=parseInt(e[2],10);if(!n||!s||!o||n>31||s>12)return"";let r=String(n).padStart(2,"0"),a=String(s).padStart(2,"0");return`${o}-${a}-${r}`}function va(t){if(!Vt(t))return t||"";let[e,n,s]=t.split("-");return`${s}/${n}/${e}`}function xe(t){if(!t)return"No date";if($t(t))return t.replace(/-/g,"/");if(Vt(t)){let[e,n,s]=t.split("-");return`${s}/${n}/${e}`}return"No date"}function wa(t,e=void 0){if(!t)return"No date";try{if(Vt(t)){let[n,s,o]=t.split("-");return new Date(parseInt(n,10),parseInt(s,10)-1,parseInt(o,10)).toLocaleDateString(e,{year:"numeric",month:"short",day:"numeric"})}if($t(t)){let n=t.split(/[\/\-]/),s=parseInt(n[0],10),o=parseInt(n[1],10),r=parseInt(n[2],10);return new Date(r,o-1,s).toLocaleDateString(e,{year:"numeric",month:"short",day:"numeric"})}}catch{}return"No date"}function Lp(t){let e=new Intl.DateTimeFormat(t,{weekday:"short"}),n=new Date(2024,0,1);return Array.from({length:7},(s,o)=>{let r=e.format(new Date(n.getFullYear(),n.getMonth(),n.getDate()+o));return Wl(r)})}function jp(t,e,n){let s=new Intl.DateTimeFormat(t,{month:"long",year:"numeric"});return Wl(s.format(new Date(e,n,1)))}function Pp(t,e,n,s=[]){let o=new Date().toISOString(),r=t.startDate||"",a=t.endDate||"",i={id:n,title:t.title||"",description:t.description||"",projectId:t.projectId?parseInt(t.projectId,10):null,startDate:r,endDate:a,startDateWasEverSet:typeof r=="string"&&r.trim()!=="",endDateWasEverSet:typeof a=="string"&&a.trim()!=="",priority:t.priority||"medium",status:t.status||"todo",tags:t.tags||[],attachments:s.length>0?[...s]:[],createdAt:o,updatedAt:o},l=[...e,i],c=n+1;return{task:i,tasks:l,taskCounter:c}}function Np(t,e,n){let s=n.findIndex(d=>d.id===parseInt(t,10));if(s===-1)return{task:null,tasks:n,oldProjectId:null};let o=n[s],r=o.projectId,a=e.projectId!==void 0?e.projectId?parseInt(e.projectId,10):null:o.projectId,i={...o,title:e.title!==void 0?e.title:o.title,description:e.description!==void 0?e.description:o.description,projectId:a,startDate:e.startDate!==void 0?e.startDate:o.startDate,endDate:e.endDate!==void 0?e.endDate:o.endDate,priority:e.priority!==void 0?e.priority:o.priority,status:e.status!==void 0?e.status:o.status};if(e.startDate!==void 0&&typeof i.startDate=="string"&&i.startDate.trim()!==""&&(i.startDateWasEverSet=!0),e.endDate!==void 0&&typeof i.endDate=="string"&&i.endDate.trim()!==""&&(i.endDateWasEverSet=!0),!(i.title!==o.title||i.description!==o.description||i.projectId!==o.projectId||i.startDate!==o.startDate||i.endDate!==o.endDate||i.priority!==o.priority||i.status!==o.status))return{task:o,tasks:n,oldProjectId:r};i.updatedAt=new Date().toISOString();let c=[...n];return c[s]=i,{task:i,tasks:c,oldProjectId:r}}function Bp(t,e,n,s,o={autoSetStartDateOnStatusChange:!1,autoSetEndDateOnStatusChange:!1}){let r=s.findIndex(h=>h.id===parseInt(t,10));if(r===-1)return{task:null,tasks:s,oldProjectId:null};let a=s[r],i=a.projectId,l={...a},c=a.startDate,d=a.endDate,u=a.completedDate;if(e==="startDate"||e==="endDate"){let h=$t(n)?un(n):Vt(n)?n:"";l[e]=h,h&&(e==="startDate"&&(l.startDateWasEverSet=!0),e==="endDate"&&(l.endDateWasEverSet=!0))}else e==="projectId"?l.projectId=n?parseInt(n,10):null:l[e]=n;if(e==="status"&&(o.autoSetStartDateOnStatusChange||o.autoSetEndDateOnStatusChange)){let h=new Date().toISOString().split("T")[0];o.autoSetStartDateOnStatusChange&&n==="progress"&&!l.startDate&&(l.startDate=h,l.startDateWasEverSet=!0),o.autoSetEndDateOnStatusChange&&n==="done"&&!l.endDate&&(l.endDate=h,l.endDateWasEverSet=!0)}e==="status"&&n==="done"&&!l.completedDate&&(l.completedDate=new Date().toISOString());let p;if(e==="projectId"?p=l.projectId!==a.projectId:p=l[e]!==a[e],e==="status"&&(l.startDate!==c&&(p=!0),l.endDate!==d&&(p=!0),l.completedDate!==u&&(p=!0)),!p)return{task:a,tasks:s,oldProjectId:i};l.updatedAt=new Date().toISOString();let f=[...s];return f[r]=l,{task:l,tasks:f,oldProjectId:i}}function Op(t,e){let n=e.find(r=>r.id===parseInt(t,10));if(!n)return{task:null,tasks:e,projectId:null};let s=n.projectId,o=e.filter(r=>r.id!==parseInt(t,10));return{task:n,tasks:o,projectId:s}}function Rp(t,e,n){let s=e.find(d=>d.id===parseInt(t,10));if(!s)return{task:null,tasks:e,taskCounter:n};let r=`Copy ${s.title||"Untitled"}`,a=new Date().toISOString(),i={id:n,title:r,description:s.description||"",projectId:s.projectId??null,startDate:s.startDate||"",endDate:s.endDate||"",startDateWasEverSet:!!s.startDateWasEverSet||!!s.startDate&&String(s.startDate).trim()!=="",endDateWasEverSet:!!s.endDateWasEverSet||!!s.endDate&&String(s.endDate).trim()!=="",priority:s.priority||"medium",status:s.status||"todo",tags:Array.isArray(s.tags)?[...s.tags]:[],attachments:Array.isArray(s.attachments)?s.attachments.map(d=>({...d})):[],createdAt:a,updatedAt:a},l=[...e,i],c=n+1;return{task:i,tasks:l,taskCounter:c}}function $p(t,e,n){let s={id:n,name:t.name||"",description:t.description||"",startDate:t.startDate||"",endDate:t.endDate||"",tags:t.tags||[],createdAt:new Date().toISOString()},o=[...e,s],r=n+1;return{project:s,projects:o,projectCounter:r}}function Fp(t,e,n,s){let o=s.findIndex(l=>l.id===parseInt(t,10));if(o===-1)return{project:null,projects:s};let a={...s[o]};if(e==="startDate"||e==="endDate"){let l=$t(n)?un(n):Vt(n)?n:"";a[e]=l}else a[e]=n;let i=[...s];return i[o]=a,{project:a,projects:i}}function zp(t,e,n=null,s=!1){let o=e.find(i=>i.id===parseInt(t,10));if(!o)return{project:null,projects:e,tasks:n};let r=e.filter(i=>i.id!==parseInt(t,10)),a=n;return n&&s&&(a=n.map(i=>i.projectId===parseInt(t,10)?{...i,projectId:null}:i)),{project:o,projects:r,tasks:a}}function V(t){return(t||"").replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}var Kl=["#dc2626","#ea580c","#b45309","#ca8a04","#16a34a","#059669","#0ea5a4","#0284c7","#0369a1","#4338ca","#7c3aed","#6b21a8","#be185d","#e11d48","#065f46","#334155"],er=["#6C5CE7","#3742FA","#E84393","#00B894","#74B9FF","#0984E3","#0891b2","#E17055","#9B59B6","#2F3542","#FF3838","#6C5B7B","#C44569","#F8B500","#5758BB"];var Hp={backlog:"Backlog",todo:"To Do",progress:"In Progress",review:"In Review",done:"Done"};var ke={high:3,medium:2,low:1},tr={done:1,progress:2,review:3,todo:4,backlog:5},qp=[{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}],Up={high:"var(--accent-red)",medium:"var(--accent-amber)",low:"var(--accent-green)"};var Jl=[{id:"2026.01.06",version:"2.7.0",title:{en:"Signal and Flow",es:"Se\xF1al y flujo"},date:"2026-01-06",summary:{en:"A focused release that makes changes visible and deadlines clearer.",es:"Una versi\xF3n enfocada que hace visibles los cambios y aclara los plazos."},sections:{new:[{en:"Release Notes page with a clean breakdown of changes.",es:"P\xE1gina de notas de versi\xF3n con un desglose claro de cambios."},{en:"Top bar notification bell for new releases.",es:"Campana de notificaciones en la barra superior para nuevas versiones."},{en:"Due today reminders with quick navigation.",es:"Recordatorios de vencimiento hoy con navegaci\xF3n r\xE1pida."}],improvements:[{en:"Updates page tuned for fast scanning.",es:"P\xE1gina de novedades ajustada para lectura r\xE1pida."},{en:"Notification badge aggregates releases and due today tasks.",es:"La insignia de notificaciones agrupa versiones y tareas que vencen hoy."},{en:"Release dates formatted per locale.",es:"Fechas de versi\xF3n formateadas seg\xFAn la configuraci\xF3n regional."}],fixes:[{en:"Notifications now stay focused on tasks due today.",es:"Las notificaciones ahora se enfocan en tareas que vencen hoy."},{en:"Release history stays consistent across sessions.",es:"El historial de versiones se mantiene consistente entre sesiones."}]}},{id:"2025.12.20",version:"2.6.1",title:{en:"Stability Pass",es:"Pase de estabilidad"},date:"2025-12-20",summary:{en:"Polish across projects, tasks, and reporting.",es:"Pulido en proyectos, tareas y reportes."},sections:{new:[{en:"Task sorting refinements in list view.",es:"Mejoras en el ordenamiento de tareas en vista de lista."},{en:"Improved history timeline labels.",es:"Etiquetas mejoradas en la l\xEDnea de tiempo del historial."}],improvements:[{en:"Cleaner spacing for project detail views.",es:"Espaciado m\xE1s limpio en vistas de detalle de proyecto."},{en:"Faster dashboard rendering on large datasets.",es:"Renderizado del panel m\xE1s r\xE1pido con datos grandes."}],fixes:[{en:"Resolved occasional drag reorder glitches.",es:"Corregidos fallos ocasionales al reordenar arrastrando."},{en:"Fixed missing labels in calendar tooltips.",es:"Corregidas etiquetas faltantes en los tooltips del calendario."}]}},{id:"2025.12.04",version:"2.6.0",title:{en:"Project Clarity",es:"Claridad de proyecto"},date:"2025-12-04",summary:{en:"Better project visibility and smarter filters.",es:"Mejor visibilidad de proyectos y filtros m\xE1s inteligentes."},sections:{new:[{en:"Enhanced project filters for recency.",es:"Filtros de proyectos mejorados por recencia."},{en:"Quick access backlog button in Kanban.",es:"Bot\xF3n de acceso r\xE1pido al backlog en Kanban."}],improvements:[{en:"Refined status badges for contrast.",es:"Insignias de estado refinadas para mejor contraste."},{en:"Clearer labels across filters and chips.",es:"Etiquetas m\xE1s claras en filtros y chips."}],fixes:[{en:"Fixed filter chips not clearing on reset.",es:"Corregido que los chips de filtros no se limpiaban al restablecer."},{en:"Resolved layout shifts in mobile task list.",es:"Corregidos saltos de dise\xF1o en la lista de tareas m\xF3vil."}]}}];var _p="debugLogsEnabled",Gl=new Map,Gb=typeof window<"u"&&typeof window.__pageLoadStart=="number"?window.__pageLoadStart:typeof performance<"u"?performance.now():Date.now();function Yb(){let t=typeof performance<"u"?performance.now():Date.now();return Math.round(t-Gb)}function Ft(t,e){if(!pn())return;let n=Yb();console.log(`[perf] ${t} @ ${n}ms`,e||"")}function nr(t){let e=!!t;window.debugLogsEnabled=e;try{localStorage.setItem(_p,String(e))}catch{}}function pn(){if(typeof window.debugLogsEnabled=="boolean")return window.debugLogsEnabled;try{return localStorage.getItem(_p)==="true"}catch{return!1}}function Sa(t,e,n){pn()&&(n?console.log(`[debug:${t}] ${e}`,n):console.log(`[debug:${t}] ${e}`))}function Fe(t,e,n){if(!pn())return;let s=`${t}:${e}:${Date.now()}-${Math.random().toString(36).slice(2)}`;return Gl.set(s,typeof performance<"u"&&performance.now?performance.now():Date.now()),Sa(t,`${e}:start`,n),s}function Oe(t,e,n){if(!pn())return;let s=Gl.get(e);if(s==null)return;Gl.delete(e);let o=typeof performance<"u"&&performance.now?performance.now():Date.now();Sa(t,"duration",{durationMs:Math.round(o-s),...n})}function rt(t,e="info"){let n=document.createElement("div");n.className=`notification notification-${e}`,n.style.cssText=`
        position: fixed;
        bottom: 24px;
        right: 24px;
        padding: 16px 24px;
        background: ${e==="error"?"var(--accent-red)":e==="success"?"var(--accent-green)":"var(--accent-blue)"};
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10001;
        font-size: 14px;
        font-weight: 500;
        max-width: 400px;
        animation: slideIn 0.3s ease-out;
    `,n.textContent=t,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOut 0.3s ease-out",setTimeout(()=>n.remove(),300)},4e3)}function Y(t){rt(t,"error")}function Et(t){rt(t,"success")}function Vp(t){return new Promise((e,n)=>{let s=new FileReader;s.onload=o=>e(o.target.result),s.onerror=o=>n(o),s.readAsDataURL(t)})}async function Wp(t,e){let n=await fetch(`/api/files?key=${encodeURIComponent(t)}`,{method:"POST",headers:{"Content-Type":"text/plain"},body:e});if(!n.ok){let s=`Failed to upload file: ${n.status} ${n.statusText}`;try{let o=await n.json();o.message&&(s=o.message),o.troubleshooting&&(s+=`

Troubleshooting: `+o.troubleshooting)}catch{}throw new Error(s)}}async function sr(t){let e=await fetch(`/api/files?key=${encodeURIComponent(t)}`);if(!e.ok)throw new Error(`Failed to download file: ${e.status} ${e.statusText}`);return await e.text()}async function Yl(t){let e=await fetch(`/api/files?key=${encodeURIComponent(t)}`,{method:"DELETE"});if(!e.ok)throw new Error(`Failed to delete file: ${e.status} ${e.statusText}`)}function Kp(t){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(t||"").trim())}function or(t){if(!t||typeof t!="string")return"";let e=t.trim().match(/^(\d{1,2}):(\d{2})$/);if(!e)return"";let n=Number(e[1]),s=Number(e[2]);return!Number.isInteger(n)||!Number.isInteger(s)||n<0||n>23||s<0||s>59?"":`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")}`}function Zl(t,e){let n=or(t);if(!n)return"";let[s,o]=n.split(":"),r=Number(s)*60+Number(o),a=Number(e)||1,l=(Math.round(r/a)*a%1440+1440)%1440,c=Math.floor(l/60),d=l%60;return`${String(c).padStart(2,"0")}:${String(d).padStart(2,"0")}`}function Xl(t){let e=or(t);if(!e)return null;let[n,s]=e.split(":");return Number(n)*60+Number(s)}function Jp(t){let e=Math.max(0,Math.min(1439,Number(t))),n=Math.floor(e/60),s=e%60;return`${String(n).padStart(2,"0")}:${String(s).padStart(2,"0")}`}function Ql(t,e,n){let s=Xl(t),o=Xl(e),r=Xl(n);return s==null||o==null||r==null?"":s<o?e:s>r?n:t}function Is(t){let e=Date.now();switch(t){case"5m":return e-300*1e3;case"30m":return e-1800*1e3;case"24h":return e-1440*60*1e3;case"week":return e-10080*60*1e3;case"month":return e-720*60*60*1e3;default:return null}}function Ln(t){let e=t&&(t.updatedAt||t.createdAt||t.createdDate)||"",n=new Date(e).getTime();return Number.isFinite(n)?n:0}function Gp(t){let e=t&&(t.updatedAt||t.createdAt||t.createdDate)||"",n=new Date(e),s=n.getTime();if(!Number.isFinite(s)||s===0)return"";try{return n.toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return n.toISOString().slice(0,16).replace("T"," ")}}function rr(t,e){let n=null;return function(...s){n&&clearTimeout(n),n=setTimeout(()=>t.apply(this,s),e)}}function uo(t,e,n){n?t.add(e):t.delete(e)}function Xb(){return new Date().toISOString().split("T")[0]}function Zb(t,e){return e?t.title&&t.title.toLowerCase().includes(e)||t.description&&t.description.toLowerCase().includes(e):!0}function Qb(t,e,n=!1){return e.size===0?!0:n?!e.has(t.status):e.has(t.status)}function ev(t,e,n=!1){return e.size===0?!0:n?!e.has(t.priority):e.has(t.priority)}function tv(t,e,n=!1){if(e.size===0)return!0;let s=t.projectId&&e.has(t.projectId.toString())||!t.projectId&&e.has("none");return n?!s:s}function nv(t,e,n=!1){if(e.size===0)return!0;let s=t.tags&&t.tags.some(o=>e.has(o))||(!t.tags||t.tags.length===0)&&e.has("none");return n?!s:s}function sv(t,e,n){let s=new Date(n+"T00:00:00");switch(e){case"no-date":return!t.endDate||t.endDate==="";case"overdue":return t.endDate&&t.endDate<n;case"end-today":return t.endDate===n;case"end-tomorrow":{let o=new Date(s);return o.setDate(o.getDate()+1),t.endDate===o.toISOString().split("T")[0]}case"end-7days":{let o=new Date(s);return o.setDate(o.getDate()+7),t.endDate===o.toISOString().split("T")[0]}case"end-week":{let o=new Date(s);o.setDate(o.getDate()+7);let r=o.toISOString().split("T")[0];return t.endDate&&t.endDate>=n&&t.endDate<=r}case"end-month":{let o=new Date(s);o.setDate(o.getDate()+30);let r=o.toISOString().split("T")[0];return t.endDate&&t.endDate>=n&&t.endDate<=r}case"no-start-date":return!t.startDate||t.startDate==="";case"already-started":return t.startDate&&t.startDate<n&&t.status!=="done";case"start-today":return t.startDate===n;case"start-tomorrow":{let o=new Date(s);return o.setDate(o.getDate()+1),t.startDate===o.toISOString().split("T")[0]}case"start-7days":{let o=new Date(s);return o.setDate(o.getDate()+7),t.startDate===o.toISOString().split("T")[0]}case"start-week":{let o=new Date(s);o.setDate(o.getDate()+7);let r=o.toISOString().split("T")[0];return t.startDate&&t.startDate>=n&&t.startDate<=r}case"start-month":{let o=new Date(s);o.setDate(o.getDate()+30);let r=o.toISOString().split("T")[0];return t.startDate&&t.startDate>=n&&t.startDate<=r}default:return!0}}function ov(t,e,n){return e.size===0?!0:Array.from(e).some(s=>sv(t,s,n))}function rv(t,e,n,s="endDate"){if(!e&&!n)return!0;let o=s==="startDate"?t.startDate:t.endDate;return o?e&&n?e===n?o===n:o>=e&&o<=n:e?o>=e:n?o<=n:!0:!1}function Yp(t,e){let{search:n="",statuses:s=new Set,statusExcludeMode:o=!1,priorities:r=new Set,priorityExcludeMode:a=!1,projects:i=new Set,projectExcludeMode:l=!1,tags:c=new Set,tagExcludeMode:d=!1,datePresets:u=new Set,dateFrom:p="",dateTo:f="",dateField:h="endDate"}=e,m=Xb(),y=n.toLowerCase();return t.filter(k=>{if(!Zb(k,y)||!Qb(k,s,o)||!ev(k,r,a)||!tv(k,i,l)||!nv(k,c,d))return!1;if(u.size>0){if(!ov(k,u,m))return!1}else if((p||f)&&!rv(k,p,f,h))return!1;return!0})}function Xp(t,e){let n=new Date().toISOString().split("T")[0],s=t.filter(k=>k.status!=="backlog"),o=s.length,r=s.filter(k=>k.status==="done").length,a=o>0?Math.round(r/o*100):0,i=e.filter(k=>t.filter(T=>T.projectId===k.id&&T.status!=="backlog").length>0),l=i.filter(k=>{let S=t.filter(D=>D.projectId===k.id&&D.status!=="backlog"),T=S.filter(D=>D.status==="done");return S.length>0&&T.length===S.length}).length,c=i.length>0?Math.round(l/i.length*100):0,d=i.length,u=s.filter(k=>k.status==="progress").length,p=s.filter(k=>k.status==="todo").length,f=s.filter(k=>k.status==="review").length,h=s.filter(k=>k.endDate&&k.endDate<n&&k.status!=="done").length,m=s.filter(k=>k.priority==="high"&&k.status!=="done").length,y=e.filter(k=>k.endDate).length;return{activeProjects:e.length,totalTasks:o,completedTasks:r,completionRate:a,tasksCompletionRate:a,projectsCompletionRate:c,completedProjects:l,totalProjectsWithTasks:d,inProgressTasks:u,pendingTasks:p,reviewTasks:f,overdueTasks:h,highPriorityTasks:m,milestones:y}}function Zp(t,e){let n=new Date().toISOString().split("T")[0],s=new Date,o=t.filter(u=>u.status!=="backlog"),r=new Date;r.setDate(r.getDate()-7);let a=o.filter(u=>u.status!=="done"||!u.completedDate?!1:new Date(u.completedDate)>r).length,i=o.filter(u=>!u.endDate||u.status==="done"?!1:new Date(u.endDate).toDateString()===s.toDateString()).length,l=o.filter(u=>u.status!=="done"&&u.endDate&&u.endDate<n).length,c=o.filter(u=>{if(u.status==="done"||u.priority!=="high"||!u.endDate)return!1;let p=new Date(s.getFullYear(),s.getMonth(),s.getDate()),f=new Date(u.endDate),h=new Date(f.getFullYear(),f.getMonth(),f.getDate());return Math.round((h-p)/(1e3*60*60*24))<=7}).length,d=e.filter(u=>{let p=t.filter(h=>h.projectId===u.id),f=p.filter(h=>h.status==="done");return p.length>0&&f.length===p.length}).length;return{thisWeekCompleted:a,dueTodayCount:i,overdueCount:l,criticalHighPriority:c,completedProjects:d,progressChange:Math.max(1,Math.floor(o.length*.1))}}function Qp(t,e,n=5){return t.slice(0,n).map(s=>{let o=Number(s?.id),r=e.filter(u=>Number(u?.projectId)===o&&u.status!=="backlog"),a=r.filter(u=>u.status==="done").length,i=r.filter(u=>u.status==="progress").length,l=r.filter(u=>u.status==="review").length,c=r.filter(u=>u.status==="todo").length,d=r.length;return{id:s.id,name:s.name,completed:a,inProgress:i,review:l,todo:c,total:d,completedPercent:d>0?a/d*100:0,inProgressPercent:d>0?i/d*100:0,reviewPercent:d>0?l/d*100:0,todoPercent:d>0?c/d*100:0}})}function ef(t,e){let{tasksLabel:n}=e;return t.map(s=>`
        <div class="progress-bar-item clickable-project" data-action="showProjectDetails" data-param="${s.id}" style="cursor: pointer; transition: all 0.2s ease;">
            <div class="project-progress-header">
                <span class="project-name">${s.name}</span>
                <span class="task-count">${s.completed}/${s.total} ${n}</span>
            </div>
            <div style="height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; display: flex;">
                <div style="background: var(--accent-green); width: ${s.completedPercent}%; transition: width 0.5s ease;"></div>
                <div style="background: var(--accent-blue); width: ${s.inProgressPercent}%; transition: width 0.5s ease;"></div>
                <div style="background: var(--accent-amber); width: ${s.reviewPercent}%; transition: width 0.5s ease;"></div>
                <div style="background: var(--text-muted); width: ${s.todoPercent}%; transition: width 0.5s ease;"></div>
            </div>
        </div>
    `).join("")}function tf(t,e){return t.map(n=>`
        <div class="activity-item">
            <div class="activity-icon ${n.type}">${n.icon}</div>
            <div class="activity-content">
                <div class="activity-text">${n.text}</div>
            </div>
            <div class="activity-date">${e(n.date)}</div>
        </div>
    `).join("")}function av(t,e){if(!t)return{hasDate:!1,urgency:"none",bgColor:null,textColor:"var(--text-muted)",borderColor:null,icon:"",iconColor:""};let n=new Date;n.setHours(0,0,0,0);let s=new Date(t);s.setHours(0,0,0,0);let o=s-n,r=Math.ceil(o/(1e3*60*60*24));return e==="done"?{hasDate:!0,urgency:"completed",diffDays:r,bgColor:"rgba(148, 163, 184, 0.12)",textColor:"#94a3b8",borderColor:"rgba(148, 163, 184, 0.25)",icon:"",iconColor:""}:r<0?{hasDate:!0,urgency:"overdue",diffDays:r,bgColor:"rgba(249, 115, 22, 0.2)",textColor:"#fb923c",borderColor:"rgba(249, 115, 22, 0.4)",icon:"\u26A0 ",iconColor:"#f97316"}:r<=7?{hasDate:!0,urgency:"soon",diffDays:r,bgColor:"rgba(192, 132, 252, 0.25)",textColor:"#c084fc",borderColor:"rgba(192, 132, 252, 0.5)",icon:"",iconColor:""}:{hasDate:!0,urgency:"normal",diffDays:r,bgColor:"rgba(59, 130, 246, 0.15)",textColor:"#93c5fd",borderColor:"rgba(59, 130, 246, 0.3)",icon:"",iconColor:""}}function nf(t,e){let{escapeHtml:n,formatDate:s,getProjectColor:o,getTagColor:r,getPriorityLabel:a,projects:i,selectedCards:l,showProjects:c=!0,showNoDate:d=!0,noProjectText:u,noDateText:p}=e,f=i.find(w=>w.id===t.projectId),h=f?f.name:u,m=t.endDate?s(t.endDate):p,y=av(t.endDate,t.status),k;if(y.hasDate){let{bgColor:w,textColor:I,borderColor:M,icon:z,iconColor:_}=y;k=`<span style="
            background: ${w};
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            color: ${I};
            border: 1px solid ${M};
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        ">${z?`<span style="color: ${_};">${z}</span>`:""}${n(m)}</span>`}else k=d?`<span style="color: var(--text-muted); font-size: 12px;">${m}</span>`:"";let T=l&&l.has(t.id)?" selected":"",D=t.status==="done"?" is-done":"",E=f?`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${o(f.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`:"",b=`<div style="display: flex; flex-wrap: wrap; align-items: center; gap: 4px; margin-top: 12px;">
        ${t.tags&&t.tags.length>0?t.tags.map(w=>`<span style="background-color: ${r(w)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${n(w.toUpperCase())}</span>`).join(""):""}
        <span style="margin-left: auto;">${k}</span>
    </div>`;return`
        <div class="task-card${T}${D}" draggable="true" data-task-id="${t.id}">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 8px;">
                <div class="task-title" style="flex: 1;">${E}${n(t.title||"")}</div>
                <div class="task-priority priority-${t.priority}" style="flex-shrink: 0;">${a(t.priority||"").toUpperCase()}</div>
            </div>
            ${c?`
            <div style="margin-top:8px; font-size:12px;">
                ${f?`<span style="background-color: ${o(f.id)}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500; display: inline-block; max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${n(f.name)}">${n(f.name)}</span>`:`<span style="color: var(--text-muted);">${u}</span>`}
            </div>
            `:""}
            ${b}
        </div>
    `}function iv(t,e=!1){let n={backlog:[],todo:[],progress:[],review:[],done:[]};return t.forEach(s=>{s.status==="backlog"&&!e||n[s.status]&&n[s.status].push(s)}),n}function sf(t){return[...t].sort((e,n)=>{let s=ke[e.priority]||0;return(ke[n.priority]||0)-s})}function lv(t,e){if(!e||e.length===0)return sf(t);let n=new Map(e.map((s,o)=>[s,o]));return[...t].sort((s,o)=>{let r=n.has(s.id)?n.get(s.id):9999,a=n.has(o.id)?n.get(o.id):9999;if(r!==a)return r-a;let i=ke[s.priority]||0;return(ke[o.priority]||0)-i})}function cv(t,e,n=null){let s={};return Object.keys(t).forEach(o=>{e==="manual"&&n&&n[o]?s[o]=lv(t[o],n[o]):s[o]=sf(t[o])}),s}function dv(t){return{backlog:t.backlog?t.backlog.length:0,todo:t.todo?t.todo.length:0,progress:t.progress?t.progress.length:0,review:t.review?t.review.length:0,done:t.done?t.done.length:0}}function uv(t,e,n){return e===null?t:t.filter(s=>n(s)>=e)}function of(t,e={}){let{showBacklog:n=!1,sortMode:s="priority",manualTaskOrder:o=null,updatedCutoff:r=null,getTaskUpdatedTime:a=null}=e,i=t;r!==null&&a&&(i=uv(t,r,a));let l=iv(i,n),c=cv(l,s,o),d=dv(c);return{byStatus:c,counts:d,totalFiltered:i.length,totalOriginal:t.length}}function rf(t,e){return t.map(n=>nf(n,e)).join("")}function pv(t){return[...t].sort((e,n)=>{let s=ke[e.priority]||0,o=ke[n.priority]||0;if(s!==o)return o-s;let r=e.endDate?new Date(e.endDate):null,a=n.endDate?new Date(n.endDate):null;return r&&a?r-a:r&&!a?-1:!r&&a?1:0})}function af(t,e,n=[],s=null){switch(e){case"title":return(t.title||"").toLowerCase();case"status":return(tr||{backlog:0,todo:1,progress:2,review:3,done:4})[t.status]??0;case"priority":return{low:0,medium:1,high:2}[t.priority]??0;case"project":{let o=n.find(r=>r.id===t.projectId);return o?o.name.toLowerCase():""}case"startDate":return t.startDate||"";case"endDate":return t.endDate||"";case"updatedAt":return s?s(t):0;default:return""}}function fv(t,e,n,s=[],o=null){return e?[...t].sort((r,a)=>{let i=af(r,e,s,o),l=af(a,e,s,o);return i<l?n==="asc"?-1:1:i>l?n==="asc"?1:-1:0}):t}function lf(t,e=null){if(!t)return{text:null,class:"",showPrefix:!1,hasDate:!1};let n=new Date;n.setHours(0,0,0,0);let s=new Date(t);s.setHours(0,0,0,0);let o=s-n,r=Math.ceil(o/(1e3*60*60*24));return r<0?e==="done"?{text:null,class:"",showPrefix:!0,hasDate:!0,diffDays:r,urgency:"completed"}:{text:null,class:"overdue",showPrefix:!0,hasDate:!0,diffDays:r,daysOverdue:Math.abs(r),urgency:"overdue"}:r===0?{text:null,class:"today",showPrefix:!0,hasDate:!0,diffDays:r,urgency:"today"}:r===1?{text:null,class:"soon",showPrefix:!0,hasDate:!0,diffDays:r,urgency:"tomorrow"}:r<=7?{text:null,class:"soon",showPrefix:!0,hasDate:!0,diffDays:r,urgency:"soon"}:{text:null,class:"",showPrefix:!0,hasDate:!0,diffDays:r,urgency:"normal"}}function hv(t,e){let{escapeHtml:n,formatDate:s,getTagColor:o,getProjectColor:r,getPriorityLabel:a,getStatusLabel:i,formatTaskUpdatedDateTime:l,projects:c,noProjectText:d,noDateText:u}=e,p=`status-badge ${t.status}`,f=c.find(b=>b.id===t.projectId),h=f?f.name:d,m=t.startDate?s(t.startDate):u,y=t.endDate?s(t.endDate):u,k=l(t)||"",S=t.priority?a(t.priority):"",T=t.tags&&t.tags.length>0?t.tags.map(b=>`<span style="background-color: ${o(b)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; margin-right: 4px; font-weight: 500;">${n(b.toUpperCase())}</span>`).join(""):"",D=f?`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${r(f.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`:"";return`
        <tr class="task-row${t.status==="done"?" task-row-done":""}" data-task-id="${t.id}">
            <td class="mass-edit-col">
                <input type="checkbox" class="task-select-checkbox" data-task-id="${t.id}" data-action="toggleTaskSelection" data-param="${t.id}">
            </td>
            <td data-action="openTaskDetails" data-param="${t.id}">${D}${n(t.title||"")}</td>
            <td data-action="openTaskDetails" data-param="${t.id}"><span class="priority-badge priority-${t.priority}">${S}</span></td>
            <td data-action="openTaskDetails" data-param="${t.id}"><span class="${p}">${i(t.status).toUpperCase()}</span></td>
            <td data-action="openTaskDetails" data-param="${t.id}">${T||'<span style="color: var(--text-muted); font-size: 12px;">-</span>'}</td>
            <td data-action="openTaskDetails" data-param="${t.id}">${n(h)}</td>
            <td data-action="openTaskDetails" data-param="${t.id}">${m}</td>
            <td data-action="openTaskDetails" data-param="${t.id}">${y}</td>
            <td data-action="openTaskDetails" data-param="${t.id}">${n(k)}</td>
        </tr>
    `}function cf(t,e){return t.map(n=>hv(n,e)).join("")}function df(t,e={}){let{currentSort:n=null,projects:s=[],updatedCutoff:o=null,getTaskUpdatedTime:r=null}=e,a=t;o!==null&&r&&(a=t.filter(l=>r(l)>=o));let i=pv(a);return n&&n.column&&(i=fv(i,n.column,n.direction,s,r)),{tasks:i,count:i.length,totalOriginal:t.length}}function uf(t,e){let n=new Date(t,e,1).getDay();n=(n+6)%7;let s=new Date(t,e+1,0).getDate(),o=new Date(t,e,0).getDate(),r=n+s,a=Math.ceil(r/7)*7,i=a-r;return{firstDayOfWeek:n,daysInMonth:s,daysInPrevMonth:o,totalCells:r,cellsNeeded:a,nextMonthDays:i,totalRows:Math.ceil(a/7)}}function mv(t,e,n={}){let{today:s=new Date}=n,o=uf(t,e),r=[],a=s.getMonth()===e&&s.getFullYear()===t,i=s.getDate(),l=0;for(let c=o.firstDayOfWeek-1;c>=0;c--){let d=o.daysInPrevMonth-c;r.push({day:d,type:"prev-month",row:Math.floor(l/7),column:l%7,isWeekend:l%7>=5,dateStr:null}),l++}for(let c=1;c<=o.daysInMonth;c++){let d=gv(t,e,c),u=a&&c===i,p=l%7;r.push({day:c,type:"current-month",row:Math.floor(l/7),column:p,isWeekend:p>=5,isToday:u,dateStr:d}),l++}for(let c=1;c<=o.nextMonthDays;c++)r.push({day:c,type:"next-month",row:Math.floor(l/7),column:l%7,isWeekend:l%7>=5,dateStr:null}),l++;return r}function gv(t,e,n){return`${t}-${String(e+1).padStart(2,"0")}-${String(n).padStart(2,"0")}`}function yv(t,e){if(!e.startDate)return!1;let n=new Date(t),s=new Date(e.startDate),o=e.endDate?new Date(e.endDate):new Date(e.startDate);return n>=s&&n<=o}function kv(t,e,n=null){return e.filter(s=>n&&!n.has(s.id)?!1:yv(t,s)).length}function bv(t,e,n={}){let{includeBacklog:s=!1,useStartDate:o=!1}=n;return e.filter(r=>!s&&r.status==="backlog"?!1:!!(r.endDate===t||o&&r.startDate===t))}function pf(t,e,n){let s=e+n,o=t;return s<0?(s=11,o--):s>11&&(s=0,o++),{year:o,month:s}}function vv(t,e,n=new Date){return n.getMonth()===e&&n.getFullYear()===t}function ff(t,e,n={}){let{tasks:s=[],projects:o=[],filteredProjectIds:r=null,includeBacklog:a=!1,today:i=new Date}=n,l=uf(t,e),d=mv(t,e,{today:i}).map(u=>{if(u.type!=="current-month")return{...u,taskCount:0,projectCount:0};let p=bv(u.dateStr,s,{includeBacklog:a}),f=kv(u.dateStr,o,r);return{...u,taskCount:p.length,projectCount:f,hasProjects:f>0}});return{year:t,month:e,grid:l,days:d,isCurrentMonth:vv(t,e,i),totalRows:l.totalRows}}function wv(t){return t.map((e,n)=>`<div class="calendar-day-header${n>=5?" weekend":""}">${e}</div>`).join("")}function Sv(t){let{day:e,dateStr:n,type:s,row:o,isToday:r,isWeekend:a,hasProjects:i}=t;return s!=="current-month"?`<div class="calendar-day other-month" data-row="${o}">
            <div class="calendar-day-number">${e}</div>
            <div class="project-spacer" style="height:0px;"></div>
        </div>`:`<div class="calendar-day${r?" today":""}${a?" weekend":""}" data-row="${o}" data-action="showDayTasks" data-param="${n}" data-has-project="${i}">
        <div class="calendar-day-number">${e}</div>
        <div class="project-spacer" style="height:0px;"></div>
        <div class="tasks-container"></div>
    </div>`}function hf(t,e){let{days:n}=t,s=wv(e);return n.forEach((o,r)=>{let a=Math.floor(r/7),i=r%7>=5;s+=Sv({...o,row:a,isWeekend:i})}),s}function Ev(t,e){let n=t.filter(o=>o.projectId===e),s={total:n.length,backlog:0,todo:0,progress:0,review:0,done:0};return n.forEach(o=>{s.hasOwnProperty(o.status)&&s[o.status]++}),s}function xv(t){return[...t].sort((e,n)=>{let s=ke[e.priority||"low"]||1,o=ke[n.priority||"low"]||1;if(s!==o)return o-s;let r=tr[e.status||"todo"]||4,a=tr[n.status||"todo"]||4;return r-a})}function mf(t,e,n){let{escapeHtml:s,formatDatePretty:o,getProjectColor:r,getProjectStatus:a,getProjectStatusLabel:i,getTagColor:l,getPriorityLabel:c,getStatusLabel:d,getLocale:u,t:p}=n,f=e.filter(_=>_.projectId===t.id),h=Ev(e,t.id),{done:m,progress:y,review:k,todo:S,backlog:T,total:D}=h,E=D>0?m/D*100:0,b=D>0?Math.round(m/D*100):0,w=r(t.id),I=a(t.id),M=xv(f),z=M.length>0?M.map(_=>{let x=_.priority||"low",j=_.startDate&&_.startDate!=="",U=_.endDate&&_.endDate!=="",W="";return j&&U?W=`<span class="date-badge">${o(_.startDate,u())}</span><span class="date-arrow">\u2192</span><span class="date-badge">${o(_.endDate,u())}</span>`:U?W=`<span class="date-badge">${o(_.endDate,u())}</span>`:j&&(W=`<span class="date-badge">${o(_.startDate,u())}</span>`),`
                <div class="expanded-task-item" data-action="openTaskDetails" data-param="${_.id}" data-stop-propagation="true">
                    <div class="expanded-task-info">
                        <div class="expanded-task-name">${s(_.title)}</div>
                        ${W||_.tags&&_.tags.length>0?`
                            <div class="expanded-task-meta">
                                ${_.tags&&_.tags.length>0?`
                                    <div class="task-tags">
                                        ${_.tags.map(Z=>`<span style="background-color: ${l(Z)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${s(Z.toUpperCase())}</span>`).join(" ")}
                                    </div>
                                `:""}
                                ${W?`<div class="expanded-task-dates">${W}</div>`:""}
                            </div>
                        `:""}
                    </div>
                    <div class="expanded-task-priority">
                        <div class="priority-chip priority-${x}">${c(x)}</div>
                    </div>
                    <div class="expanded-task-status-col">
                        <div class="expanded-task-status ${_.status}">${d(_.status)}</div>
                    </div>
                </div>
            `}).join(""):`<div class="no-tasks-message">${p("tasks.noTasksInProject")}</div>`;return`
        <div class="project-list-item" id="project-item-${t.id}">
            <div class="project-row" data-action="toggleProjectExpand" data-param="${t.id}">
                <div class="project-chevron">\u25B8</div>
                <div class="project-info">
                    <div class="project-swatch" style="background: ${w};"></div>
                    <div class="project-name-desc">
                        <div class="project-title project-title-link" data-action="showProjectDetails" data-param="${t.id}" data-stop-propagation="true">${s(t.name||p("projects.untitled"))}</div>
                        ${t.tags&&t.tags.length>0?`
                            <div class="project-tags-row">
                                ${t.tags.map(_=>`<span class="project-tag" style="background-color: ${r(t.id)};">${s(_.toUpperCase())}</span>`).join("")}
                            </div>
                        `:""}
                        <div class="project-description">${s(t.description||p("projects.noDescription"))}</div>
                    </div>
                </div>
                <div class="project-status-col">
                    <span class="project-status-badge ${I}">${i(I).toUpperCase()}</span>
                </div>
                <div class="project-progress-col">
                    <div class="progress-bar-wrapper">
                        <div class="progress-segment done" style="width: ${E}%;"></div>
                    </div>
                    <div class="progress-percent">${b}%</div>
                </div>
                <div class="project-tasks-col">
                    <span class="project-tasks-breakdown">${p("projects.tasksBreakdown",{total:D,done:m})}</span>
                </div>
                <div class="project-dates-col">
                    <span class="date-badge">${o(t.startDate,u())}</span>
                    <span class="date-arrow">\u2192</span>
                    <span class="date-badge">${o(t.endDate,u())}</span>
                </div>
            </div>
            <div class="project-tasks-expanded">
                <div class="expanded-tasks-container">
                    <div class="expanded-tasks-header">
                        <span>\u{1F4CB} ${p("projects.details.tasksTitle",{count:D})}</span>
                        <button class="add-btn expanded-add-task-btn" type="button" data-action="openTaskModalForProject" data-param="${t.id}" data-stop-propagation="true">${p("tasks.addButton")}</button>
                    </div>
                    ${z}
                </div>
            </div>
        </div>
    `}function gf(t,e={}){let{startDateWasEverSet:n=!1,endDateWasEverSet:s=!1}=e,o=Array.isArray(t?.tags)&&t.tags.length>0,r=typeof t?.startDate=="string"&&t.startDate.trim()!=="",a=typeof t?.endDate=="string"&&t.endDate.trim()!=="",i=Array.isArray(t?.attachments)&&t.attachments.some(p=>p.type==="link"||p.url&&p.type!=="file");return{hasTags:o,hasStartDate:r,hasEndDate:a,hasLinks:i,startDateInGeneral:n||r,endDateInGeneral:s||a,tagsInGeneral:o,linksInGeneral:i}}function yf(t){return t.hasTags&&t.hasLinks}function Tv(t,e){let{isMobile:n=!1,getTagColor:s,escapeHtml:o}=e,r=n?"3px 6px":"4px 8px",a=n?"11px":"12px",i="4px",l=n?"12px":"14px",c=n?"1.2":"1.4";return`
        <span class="task-tag" style="background-color: ${s(t)}; color: white; padding: ${r}; border-radius: 4px; font-size: ${a}; display: inline-flex; align-items: center; gap: ${i}; line-height: ${c};">
            ${o(t.toUpperCase())}
            <button type="button" data-action="removeTag" data-param="${o(t)}" style="background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${l}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;">\xD7</button>
        </span>
    `}function kf(t,e){let{noTagsText:n="No tags"}=e;return!t||t.length===0?`<span style="color: var(--text-muted); font-size: 13px;">${n}</span>`:t.map(s=>Tv(s,e)).join("")}function bf(t){document.addEventListener("click",e=>{let n=e.target.closest("[data-action]");if(!n)return;let s=n.dataset.action,o=n.dataset.param,r=n.dataset.param2,a={toggleTheme:()=>t.toggleTheme(),showCalendarView:()=>t.showCalendarView(),toggleKanbanSettings:()=>t.toggleKanbanSettings(e),openProjectModal:()=>t.openProjectModal(),openTaskModal:()=>t.openTaskModal(),openSettingsModal:()=>{t.closeUserDropdown(),t.openSettingsModal()},openTaskModalForProject:()=>t.openTaskModalForProject(parseInt(o)),openSelectedProjectFromTask:()=>t.openSelectedProjectFromTask(),closeModal:()=>t.closeModal(o),closeTaskModal:()=>t.closeTaskModal(),closeConfirmModal:()=>t.closeConfirmModal(),closeFeedbackDeleteModal:()=>t.closeFeedbackDeleteModal(),closeProjectConfirmModal:()=>t.closeProjectConfirmModal(),closeUnsavedChangesModal:()=>t.closeUnsavedChangesModal(),closeDayItemsModal:()=>t.closeDayItemsModal(),closeDayItemsModalOnBackdrop:()=>t.closeDayItemsModalOnBackdrop(e),openDeleteAccountModal:()=>t.openDeleteAccountModal(),closeDeleteAccountModal:()=>t.closeDeleteAccountModal(),confirmDeleteAccount:()=>t.confirmDeleteAccount(),openTaskDetails:()=>{n.dataset.stopPropagation&&e.stopPropagation();let i=parseInt(o),l=n.closest("#project-tasks-list");if(l){let d=document.getElementById("project-details");if(d&&d.classList.contains("active")){let p=Array.from(l.querySelectorAll(".project-task-item[data-param]")).map(h=>parseInt(h.dataset.param)),f=p.indexOf(i);if(f!==-1&&p.length>1){let m=window.location.hash.match(/project-(\d+)/),k={projectId:m?parseInt(m[1]):null,taskIds:p,currentIndex:f};t.openTaskDetails(i,k);return}}}let c=n.closest(".expanded-task-item");if(c){let d=c.closest(".project-card-mobile"),u=null;if(d)u=parseInt(d.dataset.projectId);else{let p=c.closest(".project-list-item");if(p&&p.id){let f=p.id.match(/project-item-(\d+)/);f&&(u=parseInt(f[1]))}}if(u){let p=c.closest(".expanded-tasks-container");if(p){let h=Array.from(p.querySelectorAll(".expanded-task-item[data-param]")).map(y=>parseInt(y.dataset.param)),m=h.indexOf(i);if(m!==-1&&h.length>1){let y={projectId:u,taskIds:h,currentIndex:m};t.openTaskDetails(i,y);return}}}}t.openTaskDetails(i)},deleteTask:()=>t.deleteTask(),duplicateTask:()=>t.duplicateTask(),confirmDelete:()=>t.confirmDelete(),showProjectDetails:()=>{n.dataset.stopPropagation&&e.stopPropagation();let l=document.getElementById("dashboard").classList.contains("active")?"dashboard":"projects";t.showProjectDetails(parseInt(o),l)},toggleProjectExpand:()=>t.toggleProjectExpand(parseInt(o)),toggleProjectMenu:()=>t.toggleProjectMenu(e),editProjectTitle:()=>t.editProjectTitle(parseInt(o),r),saveProjectTitle:()=>t.saveProjectTitle(parseInt(o)),cancelProjectTitle:()=>t.cancelProjectTitle(),handleDeleteProject:()=>t.handleDeleteProject(parseInt(o)),handleDuplicateProject:()=>t.handleDuplicateProject(parseInt(o)),toggleProjectColorPicker:()=>t.toggleProjectColorPicker(parseInt(o)),updateProjectColor:()=>t.updateProjectColor(parseInt(o),r),openCustomProjectColorPicker:()=>t.openCustomProjectColorPicker(parseInt(o)),navigateToProjectStatus:()=>t.navigateToProjectStatus(parseInt(o),r),deleteProject:()=>t.deleteProject(),confirmProjectDelete:()=>t.confirmProjectDelete(),closeDuplicateProjectModal:()=>t.closeDuplicateProjectModal(),confirmDuplicateProject:()=>t.confirmDuplicateProject(),addFeedbackItem:()=>t.addFeedbackItem(),deleteFeedbackItem:()=>t.deleteFeedbackItem(parseInt(o)),confirmFeedbackDelete:()=>t.confirmFeedbackDelete(),toggleHistoryEntryInline:()=>t.toggleHistoryEntryInline(parseInt(o)),formatTaskText:()=>t.formatTaskText(o),insertTaskHeading:()=>t.insertTaskHeading(o),insertTaskDivider:()=>t.insertTaskDivider(),insertTaskChecklist:()=>t.insertTaskChecklist(),sortTable:()=>t.sortTable(o),toggleSortMode:()=>t.toggleSortMode(),changeMonth:()=>t.animateCalendarMonthChange(parseInt(o)),goToToday:()=>t.goToToday(),showDayTasks:()=>t.showDayTasks(o),addAttachment:()=>t.addAttachment(),addFileAttachment:()=>t.addFileAttachment(e),addTag:()=>t.addTag(),removeTag:()=>t.removeTag(o),addProjectTag:()=>t.addProjectTag(),removeProjectTag:()=>t.removeProjectTag(o),addProjectDetailsTag:()=>t.addProjectDetailsTag(o),removeProjectDetailsTag:()=>t.removeProjectDetailsTag(o),removeAttachment:()=>{t.removeAttachment(parseInt(o)),e.preventDefault()},openUrlAttachment:()=>{if(o)try{let i=decodeURIComponent(o);window.open(i,"_blank","noopener,noreferrer")}catch(i){console.error("Failed to open URL attachment:",i)}},downloadFileAttachment:()=>t.downloadFileAttachment(o,r,n.dataset.param3),viewFile:()=>t.viewFile(o,r,n.dataset.param3),viewImageLegacy:()=>t.viewImageLegacy(o,r),viewFeedbackScreenshot:()=>{if(o)try{let l=decodeURIComponent(o);t.viewImageLegacy(l,"Feedback Screenshot")}catch(i){console.error("Failed to open feedback screenshot",i),t.showErrorNotification&&t.showErrorNotification(t.t("error.openScreenshotFailed"))}},backToProjects:()=>t.backToProjects(),showAllActivity:()=>t.showAllActivity(),backToDashboard:()=>t.backToDashboard(),backToCalendar:()=>t.backToCalendar(),openUpdatesFromNotification:()=>t.openUpdatesFromNotification(),openDueTodayFromNotification:()=>t.openDueTodayFromNotification(),dismissKanbanTip:()=>t.dismissKanbanTip(),confirmDiscardChanges:()=>t.confirmDiscardChanges(),closeReviewStatusConfirmModal:()=>t.closeReviewStatusConfirmModal(),confirmDisableReviewStatus:()=>t.confirmDisableReviewStatus(),closeCalendarCreateModal:()=>t.closeCalendarCreateModal(),confirmCreateTask:()=>t.confirmCreateTask(),addTaskFromDayItemsModal:()=>t.addTaskFromDayItemsModal(),signOut:()=>t.signOut(),exportDashboardData:()=>t.exportDashboardData(),closeExportDataModal:()=>t.closeExportDataModal(),confirmExportData:()=>t.confirmExportData(),openImportDataModal:()=>t.openImportDataModal(),closeImportDataModal:()=>t.closeImportDataModal(),confirmImportData:()=>t.confirmImportData(),generateReport:()=>t.generateReport(),showStatusInfoModal:()=>{e.stopPropagation(),t.showStatusInfoModal()},stopPropagation:()=>e.stopPropagation(),closeModalOnBackdrop:()=>{e.target===n&&t.closeModal(o)},closeDayItemsAndOpenTask:()=>{t.closeDayItemsModal(),t.openTaskDetails(parseInt(o))},closeDayItemsAndShowProject:()=>{t.closeDayItemsModal(),t.showProjectDetails(parseInt(o),"calendar",{month:t.getCurrentMonth(),year:t.getCurrentYear()})},deleteFeedbackItemWithStop:()=>{t.deleteFeedbackItem(parseInt(o)),e.stopPropagation()},toggleTaskSelection:()=>{e.stopPropagation(),t.toggleTaskSelection(parseInt(o),e)},closeMassEditPopover:()=>t.closeMassEditPopover(),applyMassEdit:()=>{let i=e.target.closest('[data-action="applyMassEdit"]');i&&(i.disabled||i.getAttribute("disabled")!==null)||t.queueMassEditChange()},applyAllMassEditChanges:()=>t.applyAllMassEditChanges(),closeMassEditConfirm:()=>t.closeMassEditConfirm(),applyMassEditConfirmed:()=>t.applyMassEditConfirmed()};a[s]?a[s]():console.warn(`No handler found for action: ${s}`)})}var de={projects:null,tasks:null,feedbackItems:null,feedbackIndex:null,projectCounter:null,taskCounter:null,feedbackCounter:null,projectsSortedView:null,selectedCards:null,lastSelectedCardId:null,projectToDelete:null,tempAttachments:null,projectNavigationReferrer:null,calendarNavigationState:null,previousPage:null,currentFeedbackScreenshotData:null,feedbackPendingPage:null,feedbackDonePage:null,settings:null};function mt(t){this.content=t}mt.prototype={constructor:mt,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return e==-1?void 0:this.content[e+1]},update:function(t,e,n){var s=n&&n!=t?this.remove(n):this,o=s.find(t),r=s.content.slice();return o==-1?r.push(n||t,e):(r[o+1]=e,n&&(r[o]=n)),new mt(r)},remove:function(t){var e=this.find(t);if(e==-1)return this;var n=this.content.slice();return n.splice(e,2),new mt(n)},addToStart:function(t,e){return new mt([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new mt(n)},addBefore:function(t,e,n){var s=this.remove(e),o=s.content.slice(),r=s.find(t);return o.splice(r==-1?o.length:r,0,e,n),new mt(o)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=mt.from(t),t.size?new mt(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=mt.from(t),t.size?new mt(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=mt.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach(function(e,n){t[e]=n}),t},get size(){return this.content.length>>1}};mt.from=function(t){if(t instanceof mt)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new mt(e)};var ec=mt;function Af(t,e,n){for(let s=0;;s++){if(s==t.childCount||s==e.childCount)return t.childCount==e.childCount?null:n;let o=t.child(s),r=e.child(s);if(o==r){n+=o.nodeSize;continue}if(!o.sameMarkup(r))return n;if(o.isText&&o.text!=r.text){for(let a=0;o.text[a]==r.text[a];a++)n++;return n}if(o.content.size||r.content.size){let a=Af(o.content,r.content,n+1);if(a!=null)return a}n+=o.nodeSize}}function Mf(t,e,n,s){for(let o=t.childCount,r=e.childCount;;){if(o==0||r==0)return o==r?null:{a:n,b:s};let a=t.child(--o),i=e.child(--r),l=a.nodeSize;if(a==i){n-=l,s-=l;continue}if(!a.sameMarkup(i))return{a:n,b:s};if(a.isText&&a.text!=i.text){let c=0,d=Math.min(a.text.length,i.text.length);for(;c<d&&a.text[a.text.length-c-1]==i.text[i.text.length-c-1];)c++,n--,s--;return{a:n,b:s}}if(a.content.size||i.content.size){let c=Mf(a.content,i.content,n-1,s-1);if(c)return c}n-=l,s-=l}}var O=class t{constructor(e,n){if(this.content=e,this.size=n||0,n==null)for(let s=0;s<e.length;s++)this.size+=e[s].nodeSize}nodesBetween(e,n,s,o=0,r){for(let a=0,i=0;i<n;a++){let l=this.content[a],c=i+l.nodeSize;if(c>e&&s(l,o+i,r||null,a)!==!1&&l.content.size){let d=i+1;l.nodesBetween(Math.max(0,e-d),Math.min(l.content.size,n-d),s,o+d)}i=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,n,s,o){let r="",a=!0;return this.nodesBetween(e,n,(i,l)=>{let c=i.isText?i.text.slice(Math.max(e,l)-l,n-l):i.isLeaf?o?typeof o=="function"?o(i):o:i.type.spec.leafText?i.type.spec.leafText(i):"":"";i.isBlock&&(i.isLeaf&&c||i.isTextblock)&&s&&(a?a=!1:r+=s),r+=c},0),r}append(e){if(!e.size)return this;if(!this.size)return e;let n=this.lastChild,s=e.firstChild,o=this.content.slice(),r=0;for(n.isText&&n.sameMarkup(s)&&(o[o.length-1]=n.withText(n.text+s.text),r=1);r<e.content.length;r++)o.push(e.content[r]);return new t(o,this.size+e.size)}cut(e,n=this.size){if(e==0&&n==this.size)return this;let s=[],o=0;if(n>e)for(let r=0,a=0;a<n;r++){let i=this.content[r],l=a+i.nodeSize;l>e&&((a<e||l>n)&&(i.isText?i=i.cut(Math.max(0,e-a),Math.min(i.text.length,n-a)):i=i.cut(Math.max(0,e-a-1),Math.min(i.content.size,n-a-1))),s.push(i),o+=i.nodeSize),a=l}return new t(s,o)}cutByIndex(e,n){return e==n?t.empty:e==0&&n==this.content.length?this:new t(this.content.slice(e,n))}replaceChild(e,n){let s=this.content[e];if(s==n)return this;let o=this.content.slice(),r=this.size+n.nodeSize-s.nodeSize;return o[e]=n,new t(o,r)}addToStart(e){return new t([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new t(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let n=0;n<this.content.length;n++)if(!this.content[n].eq(e.content[n]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let n=this.content[e];if(!n)throw new RangeError("Index "+e+" out of range for "+this);return n}maybeChild(e){return this.content[e]||null}forEach(e){for(let n=0,s=0;n<this.content.length;n++){let o=this.content[n];e(o,s,n),s+=o.nodeSize}}findDiffStart(e,n=0){return Af(this,e,n)}findDiffEnd(e,n=this.size,s=e.size){return Mf(this,e,n,s)}findIndex(e){if(e==0)return Ea(0,e);if(e==this.size)return Ea(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,s=0;;n++){let o=this.child(n),r=s+o.nodeSize;if(r>=e)return r==e?Ea(n+1,r):Ea(n,s);s=r}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map(e=>e.toJSON()):null}static fromJSON(e,n){if(!n)return t.empty;if(!Array.isArray(n))throw new RangeError("Invalid input for Fragment.fromJSON");return new t(n.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return t.empty;let n,s=0;for(let o=0;o<e.length;o++){let r=e[o];s+=r.nodeSize,o&&r.isText&&e[o-1].sameMarkup(r)?(n||(n=e.slice(0,o)),n[n.length-1]=r.withText(n[n.length-1].text+r.text)):n&&n.push(r)}return new t(n||e,s)}static from(e){if(!e)return t.empty;if(e instanceof t)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new t([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}};O.empty=new O([],0);var tc={index:0,offset:0};function Ea(t,e){return tc.index=t,tc.offset=e,tc}function Ta(t,e){if(t===e)return!0;if(!(t&&typeof t=="object")||!(e&&typeof e=="object"))return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let s=0;s<t.length;s++)if(!Ta(t[s],e[s]))return!1}else{for(let s in t)if(!(s in e)||!Ta(t[s],e[s]))return!1;for(let s in e)if(!(s in t))return!1}return!0}var be=class t{constructor(e,n){this.type=e,this.attrs=n}addToSet(e){let n,s=!1;for(let o=0;o<e.length;o++){let r=e[o];if(this.eq(r))return e;if(this.type.excludes(r.type))n||(n=e.slice(0,o));else{if(r.type.excludes(this.type))return e;!s&&r.type.rank>this.type.rank&&(n||(n=e.slice(0,o)),n.push(this),s=!0),n&&n.push(r)}}return n||(n=e.slice()),s||n.push(this),n}removeFromSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return e.slice(0,n).concat(e.slice(n+1));return e}isInSet(e){for(let n=0;n<e.length;n++)if(this.eq(e[n]))return!0;return!1}eq(e){return this==e||this.type==e.type&&Ta(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Mark.fromJSON");let s=e.marks[n.type];if(!s)throw new RangeError(`There is no mark type ${n.type} in this schema`);let o=s.create(n.attrs);return s.checkAttrs(o.attrs),o}static sameSet(e,n){if(e==n)return!0;if(e.length!=n.length)return!1;for(let s=0;s<e.length;s++)if(!e[s].eq(n[s]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&e.length==0)return t.none;if(e instanceof t)return[e];let n=e.slice();return n.sort((s,o)=>s.type.rank-o.type.rank),n}};be.none=[];var Ms=class extends Error{},X=class t{constructor(e,n,s){this.content=e,this.openStart=n,this.openEnd=s}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,n){let s=jf(this.content,e+this.openStart,n);return s&&new t(s,this.openStart,this.openEnd)}removeBetween(e,n){return new t(Lf(this.content,e+this.openStart,n+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,n){if(!n)return t.empty;let s=n.openStart||0,o=n.openEnd||0;if(typeof s!="number"||typeof o!="number")throw new RangeError("Invalid input for Slice.fromJSON");return new t(O.fromJSON(e,n.content),s,o)}static maxOpen(e,n=!0){let s=0,o=0;for(let r=e.firstChild;r&&!r.isLeaf&&(n||!r.type.spec.isolating);r=r.firstChild)s++;for(let r=e.lastChild;r&&!r.isLeaf&&(n||!r.type.spec.isolating);r=r.lastChild)o++;return new t(e,s,o)}};X.empty=new X(O.empty,0,0);function Lf(t,e,n){let{index:s,offset:o}=t.findIndex(e),r=t.maybeChild(s),{index:a,offset:i}=t.findIndex(n);if(o==e||r.isText){if(i!=n&&!t.child(a).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(s!=a)throw new RangeError("Removing non-flat range");return t.replaceChild(s,r.copy(Lf(r.content,e-o-1,n-o-1)))}function jf(t,e,n,s){let{index:o,offset:r}=t.findIndex(e),a=t.maybeChild(o);if(r==e||a.isText)return s&&!s.canReplace(o,o,n)?null:t.cut(0,e).append(n).append(t.cut(e));let i=jf(a.content,e-r-1,n,a);return i&&t.replaceChild(o,a.copy(i))}function Dv(t,e,n){if(n.openStart>t.depth)throw new Ms("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new Ms("Inconsistent open depths");return Pf(t,e,n,0)}function Pf(t,e,n,s){let o=t.index(s),r=t.node(s);if(o==e.index(s)&&s<t.depth-n.openStart){let a=Pf(t,e,n,s+1);return r.copy(r.content.replaceChild(o,a))}else if(n.content.size)if(!n.openStart&&!n.openEnd&&t.depth==s&&e.depth==s){let a=t.parent,i=a.content;return As(a,i.cut(0,t.parentOffset).append(n.content).append(i.cut(e.parentOffset)))}else{let{start:a,end:i}=Iv(n,t);return As(r,Bf(t,a,i,e,s))}else return As(r,Da(t,e,s))}function Nf(t,e){if(!e.type.compatibleContent(t.type))throw new Ms("Cannot join "+e.type.name+" onto "+t.type.name)}function sc(t,e,n){let s=t.node(n);return Nf(s,e.node(n)),s}function Cs(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function ar(t,e,n,s){let o=(e||t).node(n),r=0,a=e?e.index(n):o.childCount;t&&(r=t.index(n),t.depth>n?r++:t.textOffset&&(Cs(t.nodeAfter,s),r++));for(let i=r;i<a;i++)Cs(o.child(i),s);e&&e.depth==n&&e.textOffset&&Cs(e.nodeBefore,s)}function As(t,e){return t.type.checkContent(e),t.copy(e)}function Bf(t,e,n,s,o){let r=t.depth>o&&sc(t,e,o+1),a=s.depth>o&&sc(n,s,o+1),i=[];return ar(null,t,o,i),r&&a&&e.index(o)==n.index(o)?(Nf(r,a),Cs(As(r,Bf(t,e,n,s,o+1)),i)):(r&&Cs(As(r,Da(t,e,o+1)),i),ar(e,n,o,i),a&&Cs(As(a,Da(n,s,o+1)),i)),ar(s,null,o,i),new O(i)}function Da(t,e,n){let s=[];if(ar(null,t,n,s),t.depth>n){let o=sc(t,e,n+1);Cs(As(o,Da(t,e,n+1)),s)}return ar(e,null,n,s),new O(s)}function Iv(t,e){let n=e.depth-t.openStart,o=e.node(n).copy(t.content);for(let r=n-1;r>=0;r--)o=e.node(r).copy(O.from(o));return{start:o.resolveNoCache(t.openStart+n),end:o.resolveNoCache(o.content.size-t.openEnd-n)}}var Ia=class t{constructor(e,n,s){this.pos=e,this.path=n,this.parentOffset=s,this.depth=n.length/3-1}resolveDepth(e){return e==null?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[this.resolveDepth(e)*3]}index(e){return this.path[this.resolveDepth(e)*3+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e==this.depth&&!this.textOffset?0:1)}start(e){return e=this.resolveDepth(e),e==0?0:this.path[e*3-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[e*3-1]+this.path[e*3].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,n=this.index(this.depth);if(n==e.childCount)return null;let s=this.pos-this.path[this.path.length-1],o=e.child(n);return s?e.child(n).cut(s):o}get nodeBefore(){let e=this.index(this.depth),n=this.pos-this.path[this.path.length-1];return n?this.parent.child(e).cut(0,n):e==0?null:this.parent.child(e-1)}posAtIndex(e,n){n=this.resolveDepth(n);let s=this.path[n*3],o=n==0?0:this.path[n*3-1]+1;for(let r=0;r<e;r++)o+=s.child(r).nodeSize;return o}marks(){let e=this.parent,n=this.index();if(e.content.size==0)return be.none;if(this.textOffset)return e.child(n).marks;let s=e.maybeChild(n-1),o=e.maybeChild(n);if(!s){let i=s;s=o,o=i}let r=s.marks;for(var a=0;a<r.length;a++)r[a].type.spec.inclusive===!1&&(!o||!r[a].isInSet(o.marks))&&(r=r[a--].removeFromSet(r));return r}marksAcross(e){let n=this.parent.maybeChild(this.index());if(!n||!n.isInline)return null;let s=n.marks,o=e.parent.maybeChild(e.index());for(var r=0;r<s.length;r++)s[r].type.spec.inclusive===!1&&(!o||!s[r].isInSet(o.marks))&&(s=s[r--].removeFromSet(s));return s}sharedDepth(e){for(let n=this.depth;n>0;n--)if(this.start(n)<=e&&this.end(n)>=e)return n;return 0}blockRange(e=this,n){if(e.pos<this.pos)return e.blockRange(this);for(let s=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);s>=0;s--)if(e.pos<=this.end(s)&&(!n||n(this.node(s))))return new Ls(this,e,s);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let n=1;n<=this.depth;n++)e+=(e?"/":"")+this.node(n).type.name+"_"+this.index(n-1);return e+":"+this.parentOffset}static resolve(e,n){if(!(n>=0&&n<=e.content.size))throw new RangeError("Position "+n+" out of range");let s=[],o=0,r=n;for(let a=e;;){let{index:i,offset:l}=a.content.findIndex(r),c=r-l;if(s.push(a,i,o+l),!c||(a=a.child(i),a.isText))break;r=c-1,o+=l+1}return new t(n,s,r)}static resolveCached(e,n){let s=vf.get(e);if(s)for(let r=0;r<s.elts.length;r++){let a=s.elts[r];if(a.pos==n)return a}else vf.set(e,s=new oc);let o=s.elts[s.i]=t.resolve(e,n);return s.i=(s.i+1)%Cv,o}},oc=class{constructor(){this.elts=[],this.i=0}},Cv=12,vf=new WeakMap,Ls=class{constructor(e,n,s){this.$from=e,this.$to=n,this.depth=s}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}},Av=Object.create(null),jt=class t{constructor(e,n,s,o=be.none){this.type=e,this.attrs=n,this.marks=o,this.content=s||O.empty}get children(){return this.content.content}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,n,s,o=0){this.content.nodesBetween(e,n,s,o,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,n,s,o){return this.content.textBetween(e,n,s,o)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,n,s){return this.type==e&&Ta(this.attrs,n||e.defaultAttrs||Av)&&be.sameSet(this.marks,s||be.none)}copy(e=null){return e==this.content?this:new t(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new t(this.type,this.attrs,this.content,e)}cut(e,n=this.content.size){return e==0&&n==this.content.size?this:this.copy(this.content.cut(e,n))}slice(e,n=this.content.size,s=!1){if(e==n)return X.empty;let o=this.resolve(e),r=this.resolve(n),a=s?0:o.sharedDepth(n),i=o.start(a),c=o.node(a).content.cut(o.pos-i,r.pos-i);return new X(c,o.depth-a,r.depth-a)}replace(e,n,s){return Dv(this.resolve(e),this.resolve(n),s)}nodeAt(e){for(let n=this;;){let{index:s,offset:o}=n.content.findIndex(e);if(n=n.maybeChild(s),!n)return null;if(o==e||n.isText)return n;e-=o+1}}childAfter(e){let{index:n,offset:s}=this.content.findIndex(e);return{node:this.content.maybeChild(n),index:n,offset:s}}childBefore(e){if(e==0)return{node:null,index:0,offset:0};let{index:n,offset:s}=this.content.findIndex(e);if(s<e)return{node:this.content.child(n),index:n,offset:s};let o=this.content.child(n-1);return{node:o,index:n-1,offset:s-o.nodeSize}}resolve(e){return Ia.resolveCached(this,e)}resolveNoCache(e){return Ia.resolve(this,e)}rangeHasMark(e,n,s){let o=!1;return n>e&&this.nodesBetween(e,n,r=>(s.isInSet(r.marks)&&(o=!0),!o)),o}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),Of(this.marks,e)}contentMatchAt(e){let n=this.type.contentMatch.matchFragment(this.content,0,e);if(!n)throw new Error("Called contentMatchAt on a node with invalid content");return n}canReplace(e,n,s=O.empty,o=0,r=s.childCount){let a=this.contentMatchAt(e).matchFragment(s,o,r),i=a&&a.matchFragment(this.content,n);if(!i||!i.validEnd)return!1;for(let l=o;l<r;l++)if(!this.type.allowsMarks(s.child(l).marks))return!1;return!0}canReplaceWith(e,n,s,o){if(o&&!this.type.allowsMarks(o))return!1;let r=this.contentMatchAt(e).matchType(s),a=r&&r.matchFragment(this.content,n);return a?a.validEnd:!1}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content),this.type.checkAttrs(this.attrs);let e=be.none;for(let n=0;n<this.marks.length;n++){let s=this.marks[n];s.type.checkAttrs(s.attrs),e=s.addToSet(e)}if(!be.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map(n=>n.type.name)}`);this.content.forEach(n=>n.check())}toJSON(){let e={type:this.type.name};for(let n in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map(n=>n.toJSON())),e}static fromJSON(e,n){if(!n)throw new RangeError("Invalid input for Node.fromJSON");let s;if(n.marks){if(!Array.isArray(n.marks))throw new RangeError("Invalid mark data for Node.fromJSON");s=n.marks.map(e.markFromJSON)}if(n.type=="text"){if(typeof n.text!="string")throw new RangeError("Invalid text node in JSON");return e.text(n.text,s)}let o=O.fromJSON(e,n.content),r=e.nodeType(n.type).create(n.attrs,o,s);return r.type.checkAttrs(r.attrs),r}};jt.prototype.text=void 0;var rc=class t extends jt{constructor(e,n,s,o){if(super(e,n,null,o),!s)throw new RangeError("Empty text nodes are not allowed");this.text=s}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):Of(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,n){return this.text.slice(e,n)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new t(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new t(this.type,this.attrs,e,this.marks)}cut(e=0,n=this.text.length){return e==0&&n==this.text.length?this:this.withText(this.text.slice(e,n))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}};function Of(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}var js=class t{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,n){let s=new ac(e,n);if(s.next==null)return t.empty;let o=Rf(s);s.next&&s.err("Unexpected trailing text");let r=Ov(Bv(o));return Rv(r,s),r}matchType(e){for(let n=0;n<this.next.length;n++)if(this.next[n].type==e)return this.next[n].next;return null}matchFragment(e,n=0,s=e.childCount){let o=this;for(let r=n;o&&r<s;r++)o=o.matchType(e.child(r).type);return o}get inlineContent(){return this.next.length!=0&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:n}=this.next[e];if(!(n.isText||n.hasRequiredAttrs()))return n}return null}compatible(e){for(let n=0;n<this.next.length;n++)for(let s=0;s<e.next.length;s++)if(this.next[n].type==e.next[s].type)return!0;return!1}fillBefore(e,n=!1,s=0){let o=[this];function r(a,i){let l=a.matchFragment(e,s);if(l&&(!n||l.validEnd))return O.from(i.map(c=>c.createAndFill()));for(let c=0;c<a.next.length;c++){let{type:d,next:u}=a.next[c];if(!(d.isText||d.hasRequiredAttrs())&&o.indexOf(u)==-1){o.push(u);let p=r(u,i.concat(d));if(p)return p}}return null}return r(this,[])}findWrapping(e){for(let s=0;s<this.wrapCache.length;s+=2)if(this.wrapCache[s]==e)return this.wrapCache[s+1];let n=this.computeWrapping(e);return this.wrapCache.push(e,n),n}computeWrapping(e){let n=Object.create(null),s=[{match:this,type:null,via:null}];for(;s.length;){let o=s.shift(),r=o.match;if(r.matchType(e)){let a=[];for(let i=o;i.type;i=i.via)a.push(i.type);return a.reverse()}for(let a=0;a<r.next.length;a++){let{type:i,next:l}=r.next[a];!i.isLeaf&&!i.hasRequiredAttrs()&&!(i.name in n)&&(!o.type||l.validEnd)&&(s.push({match:i.contentMatch,type:i,via:o}),n[i.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function n(s){e.push(s);for(let o=0;o<s.next.length;o++)e.indexOf(s.next[o].next)==-1&&n(s.next[o].next)}return n(this),e.map((s,o)=>{let r=o+(s.validEnd?"*":" ")+" ";for(let a=0;a<s.next.length;a++)r+=(a?", ":"")+s.next[a].type.name+"->"+e.indexOf(s.next[a].next);return r}).join(`
`)}};js.empty=new js(!0);var ac=class{constructor(e,n){this.string=e,this.nodeTypes=n,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),this.tokens[this.tokens.length-1]==""&&this.tokens.pop(),this.tokens[0]==""&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}};function Rf(t){let e=[];do e.push(Mv(t));while(t.eat("|"));return e.length==1?e[0]:{type:"choice",exprs:e}}function Mv(t){let e=[];do e.push(Lv(t));while(t.next&&t.next!=")"&&t.next!="|");return e.length==1?e[0]:{type:"seq",exprs:e}}function Lv(t){let e=Nv(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else if(t.eat("{"))e=jv(t,e);else break;return e}function wf(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function jv(t,e){let n=wf(t),s=n;return t.eat(",")&&(t.next!="}"?s=wf(t):s=-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:s,expr:e}}function Pv(t,e){let n=t.nodeTypes,s=n[e];if(s)return[s];let o=[];for(let r in n){let a=n[r];a.isInGroup(e)&&o.push(a)}return o.length==0&&t.err("No node type or group '"+e+"' found"),o}function Nv(t){if(t.eat("(")){let e=Rf(t);return t.eat(")")||t.err("Missing closing paren"),e}else if(/\W/.test(t.next))t.err("Unexpected token '"+t.next+"'");else{let e=Pv(t,t.next).map(n=>(t.inline==null?t.inline=n.isInline:t.inline!=n.isInline&&t.err("Mixing inline and block content"),{type:"name",value:n}));return t.pos++,e.length==1?e[0]:{type:"choice",exprs:e}}}function Bv(t){let e=[[]];return o(r(t,0),n()),e;function n(){return e.push([])-1}function s(a,i,l){let c={term:l,to:i};return e[a].push(c),c}function o(a,i){a.forEach(l=>l.to=i)}function r(a,i){if(a.type=="choice")return a.exprs.reduce((l,c)=>l.concat(r(c,i)),[]);if(a.type=="seq")for(let l=0;;l++){let c=r(a.exprs[l],i);if(l==a.exprs.length-1)return c;o(c,i=n())}else if(a.type=="star"){let l=n();return s(i,l),o(r(a.expr,l),l),[s(l)]}else if(a.type=="plus"){let l=n();return o(r(a.expr,i),l),o(r(a.expr,l),l),[s(l)]}else{if(a.type=="opt")return[s(i)].concat(r(a.expr,i));if(a.type=="range"){let l=i;for(let c=0;c<a.min;c++){let d=n();o(r(a.expr,l),d),l=d}if(a.max==-1)o(r(a.expr,l),l);else for(let c=a.min;c<a.max;c++){let d=n();s(l,d),o(r(a.expr,l),d),l=d}return[s(l)]}else{if(a.type=="name")return[s(i,void 0,a.value)];throw new Error("Unknown expr type")}}}}function $f(t,e){return e-t}function Sf(t,e){let n=[];return s(e),n.sort($f);function s(o){let r=t[o];if(r.length==1&&!r[0].term)return s(r[0].to);n.push(o);for(let a=0;a<r.length;a++){let{term:i,to:l}=r[a];!i&&n.indexOf(l)==-1&&s(l)}}}function Ov(t){let e=Object.create(null);return n(Sf(t,0));function n(s){let o=[];s.forEach(a=>{t[a].forEach(({term:i,to:l})=>{if(!i)return;let c;for(let d=0;d<o.length;d++)o[d][0]==i&&(c=o[d][1]);Sf(t,l).forEach(d=>{c||o.push([i,c=[]]),c.indexOf(d)==-1&&c.push(d)})})});let r=e[s.join(",")]=new js(s.indexOf(t.length-1)>-1);for(let a=0;a<o.length;a++){let i=o[a][1].sort($f);r.next.push({type:o[a][0],next:e[i.join(",")]||n(i)})}return r}}function Rv(t,e){for(let n=0,s=[t];n<s.length;n++){let o=s[n],r=!o.validEnd,a=[];for(let i=0;i<o.next.length;i++){let{type:l,next:c}=o.next[i];a.push(l.name),r&&!(l.isText||l.hasRequiredAttrs())&&(r=!1),s.indexOf(c)==-1&&s.push(c)}r&&e.err("Only non-generatable nodes ("+a.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Ff(t){let e=Object.create(null);for(let n in t){let s=t[n];if(!s.hasDefault)return null;e[n]=s.default}return e}function zf(t,e){let n=Object.create(null);for(let s in t){let o=e&&e[s];if(o===void 0){let r=t[s];if(r.hasDefault)o=r.default;else throw new RangeError("No value supplied for attribute "+s)}n[s]=o}return n}function Hf(t,e,n,s){for(let o in e)if(!(o in t))throw new RangeError(`Unsupported attribute ${o} for ${n} of type ${o}`);for(let o in t){let r=t[o];r.validate&&r.validate(e[o])}}function qf(t,e){let n=Object.create(null);if(e)for(let s in e)n[s]=new ic(t,s,e[s]);return n}var Ca=class t{constructor(e,n,s){this.name=e,this.schema=n,this.spec=s,this.markSet=null,this.groups=s.group?s.group.split(" "):[],this.attrs=qf(e,s.attrs),this.defaultAttrs=Ff(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(s.inline||e=="text"),this.isText=e=="text"}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==js.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}isInGroup(e){return this.groups.indexOf(e)>-1}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:zf(this.attrs,e)}create(e=null,n,s){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new jt(this,this.computeAttrs(e),O.from(n),be.setFrom(s))}createChecked(e=null,n,s){return n=O.from(n),this.checkContent(n),new jt(this,this.computeAttrs(e),n,be.setFrom(s))}createAndFill(e=null,n,s){if(e=this.computeAttrs(e),n=O.from(n),n.size){let a=this.contentMatch.fillBefore(n);if(!a)return null;n=a.append(n)}let o=this.contentMatch.matchFragment(n),r=o&&o.fillBefore(O.empty,!0);return r?new jt(this,e,n.append(r),be.setFrom(s)):null}validContent(e){let n=this.contentMatch.matchFragment(e);if(!n||!n.validEnd)return!1;for(let s=0;s<e.childCount;s++)if(!this.allowsMarks(e.child(s).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}checkAttrs(e){Hf(this.attrs,e,"node",this.name)}allowsMarkType(e){return this.markSet==null||this.markSet.indexOf(e)>-1}allowsMarks(e){if(this.markSet==null)return!0;for(let n=0;n<e.length;n++)if(!this.allowsMarkType(e[n].type))return!1;return!0}allowedMarks(e){if(this.markSet==null)return e;let n;for(let s=0;s<e.length;s++)this.allowsMarkType(e[s].type)?n&&n.push(e[s]):n||(n=e.slice(0,s));return n?n.length?n:be.none:e}static compile(e,n){let s=Object.create(null);e.forEach((r,a)=>s[r]=new t(r,n,a));let o=n.spec.topNode||"doc";if(!s[o])throw new RangeError("Schema is missing its top node type ('"+o+"')");if(!s.text)throw new RangeError("Every schema needs a 'text' type");for(let r in s.text.attrs)throw new RangeError("The text node type should not have attributes");return s}};function $v(t,e,n){let s=n.split("|");return o=>{let r=o===null?"null":typeof o;if(s.indexOf(r)<0)throw new RangeError(`Expected value of type ${s} for attribute ${e} on type ${t}, got ${r}`)}}var ic=class{constructor(e,n,s){this.hasDefault=Object.prototype.hasOwnProperty.call(s,"default"),this.default=s.default,this.validate=typeof s.validate=="string"?$v(e,n,s.validate):s.validate}get isRequired(){return!this.hasDefault}},lr=class t{constructor(e,n,s,o){this.name=e,this.rank=n,this.schema=s,this.spec=o,this.attrs=qf(e,o.attrs),this.excluded=null;let r=Ff(this.attrs);this.instance=r?new be(this,r):null}create(e=null){return!e&&this.instance?this.instance:new be(this,zf(this.attrs,e))}static compile(e,n){let s=Object.create(null),o=0;return e.forEach((r,a)=>s[r]=new t(r,o++,n,a)),s}removeFromSet(e){for(var n=0;n<e.length;n++)e[n].type==this&&(e=e.slice(0,n).concat(e.slice(n+1)),n--);return e}isInSet(e){for(let n=0;n<e.length;n++)if(e[n].type==this)return e[n]}checkAttrs(e){Hf(this.attrs,e,"mark",this.name)}excludes(e){return this.excluded.indexOf(e)>-1}},fo=class{constructor(e){this.linebreakReplacement=null,this.cached=Object.create(null);let n=this.spec={};for(let o in e)n[o]=e[o];n.nodes=ec.from(e.nodes),n.marks=ec.from(e.marks||{}),this.nodes=Ca.compile(this.spec.nodes,this),this.marks=lr.compile(this.spec.marks,this);let s=Object.create(null);for(let o in this.nodes){if(o in this.marks)throw new RangeError(o+" can not be both a node and a mark");let r=this.nodes[o],a=r.spec.content||"",i=r.spec.marks;if(r.contentMatch=s[a]||(s[a]=js.parse(a,this.nodes)),r.inlineContent=r.contentMatch.inlineContent,r.spec.linebreakReplacement){if(this.linebreakReplacement)throw new RangeError("Multiple linebreak nodes defined");if(!r.isInline||!r.isLeaf)throw new RangeError("Linebreak replacement nodes must be inline leaf nodes");this.linebreakReplacement=r}r.markSet=i=="_"?null:i?Ef(this,i.split(" ")):i==""||!r.inlineContent?[]:null}for(let o in this.marks){let r=this.marks[o],a=r.spec.excludes;r.excluded=a==null?[r]:a==""?[]:Ef(this,a.split(" "))}this.nodeFromJSON=o=>jt.fromJSON(this,o),this.markFromJSON=o=>be.fromJSON(this,o),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,n=null,s,o){if(typeof e=="string")e=this.nodeType(e);else if(e instanceof Ca){if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}else throw new RangeError("Invalid node type: "+e);return e.createChecked(n,s,o)}text(e,n){let s=this.nodes.text;return new rc(s,s.defaultAttrs,e,be.setFrom(n))}mark(e,n){return typeof e=="string"&&(e=this.marks[e]),e.create(n)}nodeType(e){let n=this.nodes[e];if(!n)throw new RangeError("Unknown node type: "+e);return n}};function Ef(t,e){let n=[];for(let s=0;s<e.length;s++){let o=e[s],r=t.marks[o],a=r;if(r)n.push(r);else for(let i in t.marks){let l=t.marks[i];(o=="_"||l.spec.group&&l.spec.group.split(" ").indexOf(o)>-1)&&n.push(a=l)}if(!a)throw new SyntaxError("Unknown mark type: '"+e[s]+"'")}return n}function Fv(t){return t.tag!=null}function zv(t){return t.style!=null}var fn=class t{constructor(e,n){this.schema=e,this.rules=n,this.tags=[],this.styles=[];let s=this.matchedStyles=[];n.forEach(o=>{if(Fv(o))this.tags.push(o);else if(zv(o)){let r=/[^=]*/.exec(o.style)[0];s.indexOf(r)<0&&s.push(r),this.styles.push(o)}}),this.normalizeLists=!this.tags.some(o=>{if(!/^(ul|ol)\b/.test(o.tag)||!o.node)return!1;let r=e.nodes[o.node];return r.contentMatch.matchType(r)})}parse(e,n={}){let s=new Aa(this,n,!1);return s.addAll(e,be.none,n.from,n.to),s.finish()}parseSlice(e,n={}){let s=new Aa(this,n,!0);return s.addAll(e,be.none,n.from,n.to),X.maxOpen(s.finish())}matchTag(e,n,s){for(let o=s?this.tags.indexOf(s)+1:0;o<this.tags.length;o++){let r=this.tags[o];if(Uv(e,r.tag)&&(r.namespace===void 0||e.namespaceURI==r.namespace)&&(!r.context||n.matchesContext(r.context))){if(r.getAttrs){let a=r.getAttrs(e);if(a===!1)continue;r.attrs=a||void 0}return r}}}matchStyle(e,n,s,o){for(let r=o?this.styles.indexOf(o)+1:0;r<this.styles.length;r++){let a=this.styles[r],i=a.style;if(!(i.indexOf(e)!=0||a.context&&!s.matchesContext(a.context)||i.length>e.length&&(i.charCodeAt(e.length)!=61||i.slice(e.length+1)!=n))){if(a.getAttrs){let l=a.getAttrs(n);if(l===!1)continue;a.attrs=l||void 0}return a}}}static schemaRules(e){let n=[];function s(o){let r=o.priority==null?50:o.priority,a=0;for(;a<n.length;a++){let i=n[a];if((i.priority==null?50:i.priority)<r)break}n.splice(a,0,o)}for(let o in e.marks){let r=e.marks[o].spec.parseDOM;r&&r.forEach(a=>{s(a=Tf(a)),a.mark||a.ignore||a.clearMark||(a.mark=o)})}for(let o in e.nodes){let r=e.nodes[o].spec.parseDOM;r&&r.forEach(a=>{s(a=Tf(a)),a.node||a.ignore||a.mark||(a.node=o)})}return n}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new t(e,t.schemaRules(e)))}},Uf={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},Hv={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},_f={ol:!0,ul:!0},cr=1,lc=2,ir=4;function xf(t,e,n){return e!=null?(e?cr:0)|(e==="full"?lc:0):t&&t.whitespace=="pre"?cr|lc:n&~ir}var po=class{constructor(e,n,s,o,r,a){this.type=e,this.attrs=n,this.marks=s,this.solid=o,this.options=a,this.content=[],this.activeMarks=be.none,this.match=r||(a&ir?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let n=this.type.contentMatch.fillBefore(O.from(e));if(n)this.match=this.type.contentMatch.matchFragment(n);else{let s=this.type.contentMatch,o;return(o=s.findWrapping(e.type))?(this.match=s,o):null}}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&cr)){let s=this.content[this.content.length-1],o;if(s&&s.isText&&(o=/[ \t\r\n\u000c]+$/.exec(s.text))){let r=s;s.text.length==o[0].length?this.content.pop():this.content[this.content.length-1]=r.withText(r.text.slice(0,r.text.length-o[0].length))}}let n=O.from(this.content);return!e&&this.match&&(n=n.append(this.match.fillBefore(O.empty,!0))),this.type?this.type.create(this.attrs,n,this.marks):n}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!Uf.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}},Aa=class{constructor(e,n,s){this.parser=e,this.options=n,this.isOpen=s,this.open=0,this.localPreserveWS=!1;let o=n.topNode,r,a=xf(null,n.preserveWhitespace,0)|(s?ir:0);o?r=new po(o.type,o.attrs,be.none,!0,n.topMatch||o.type.contentMatch,a):s?r=new po(null,null,be.none,!0,null,a):r=new po(e.schema.topNodeType,null,be.none,!0,null,a),this.nodes=[r],this.find=n.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e,n){e.nodeType==3?this.addTextNode(e,n):e.nodeType==1&&this.addElement(e,n)}addTextNode(e,n){let s=e.nodeValue,o=this.top,r=o.options&lc?"full":this.localPreserveWS||(o.options&cr)>0,{schema:a}=this.parser;if(r==="full"||o.inlineContext(e)||/[^ \t\r\n\u000c]/.test(s)){if(r)if(r==="full")s=s.replace(/\r\n?/g,`
`);else if(a.linebreakReplacement&&/[\r\n]/.test(s)&&this.top.findWrapping(a.linebreakReplacement.create())){let i=s.split(/\r?\n|\r/);for(let l=0;l<i.length;l++)l&&this.insertNode(a.linebreakReplacement.create(),n,!0),i[l]&&this.insertNode(a.text(i[l]),n,!/\S/.test(i[l]));s=""}else s=s.replace(/\r?\n|\r/g," ");else if(s=s.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(s)&&this.open==this.nodes.length-1){let i=o.content[o.content.length-1],l=e.previousSibling;(!i||l&&l.nodeName=="BR"||i.isText&&/[ \t\r\n\u000c]$/.test(i.text))&&(s=s.slice(1))}s&&this.insertNode(a.text(s),n,!/\S/.test(s)),this.findInText(e)}else this.findInside(e)}addElement(e,n,s){let o=this.localPreserveWS,r=this.top;(e.tagName=="PRE"||/pre/.test(e.style&&e.style.whiteSpace))&&(this.localPreserveWS=!0);let a=e.nodeName.toLowerCase(),i;_f.hasOwnProperty(a)&&this.parser.normalizeLists&&qv(e);let l=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(i=this.parser.matchTag(e,this,s));e:if(l?l.ignore:Hv.hasOwnProperty(a))this.findInside(e),this.ignoreFallback(e,n);else if(!l||l.skip||l.closeParent){l&&l.closeParent?this.open=Math.max(0,this.open-1):l&&l.skip.nodeType&&(e=l.skip);let c,d=this.needsBlock;if(Uf.hasOwnProperty(a))r.content.length&&r.content[0].isInline&&this.open&&(this.open--,r=this.top),c=!0,r.type||(this.needsBlock=!0);else if(!e.firstChild){this.leafFallback(e,n);break e}let u=l&&l.skip?n:this.readStyles(e,n);u&&this.addAll(e,u),c&&this.sync(r),this.needsBlock=d}else{let c=this.readStyles(e,n);c&&this.addElementByRule(e,l,c,l.consuming===!1?i:void 0)}this.localPreserveWS=o}leafFallback(e,n){e.nodeName=="BR"&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode(`
`),n)}ignoreFallback(e,n){e.nodeName=="BR"&&(!this.top.type||!this.top.type.inlineContent)&&this.findPlace(this.parser.schema.text("-"),n,!0)}readStyles(e,n){let s=e.style;if(s&&s.length)for(let o=0;o<this.parser.matchedStyles.length;o++){let r=this.parser.matchedStyles[o],a=s.getPropertyValue(r);if(a)for(let i=void 0;;){let l=this.parser.matchStyle(r,a,this,i);if(!l)break;if(l.ignore)return null;if(l.clearMark?n=n.filter(c=>!l.clearMark(c)):n=n.concat(this.parser.schema.marks[l.mark].create(l.attrs)),l.consuming===!1)i=l;else break}}return n}addElementByRule(e,n,s,o){let r,a;if(n.node)if(a=this.parser.schema.nodes[n.node],a.isLeaf)this.insertNode(a.create(n.attrs),s,e.nodeName=="BR")||this.leafFallback(e,s);else{let l=this.enter(a,n.attrs||null,s,n.preserveWhitespace);l&&(r=!0,s=l)}else{let l=this.parser.schema.marks[n.mark];s=s.concat(l.create(n.attrs))}let i=this.top;if(a&&a.isLeaf)this.findInside(e);else if(o)this.addElement(e,s,o);else if(n.getContent)this.findInside(e),n.getContent(e,this.parser.schema).forEach(l=>this.insertNode(l,s,!1));else{let l=e;typeof n.contentElement=="string"?l=e.querySelector(n.contentElement):typeof n.contentElement=="function"?l=n.contentElement(e):n.contentElement&&(l=n.contentElement),this.findAround(e,l,!0),this.addAll(l,s),this.findAround(e,l,!1)}r&&this.sync(i)&&this.open--}addAll(e,n,s,o){let r=s||0;for(let a=s?e.childNodes[s]:e.firstChild,i=o==null?null:e.childNodes[o];a!=i;a=a.nextSibling,++r)this.findAtPoint(e,r),this.addDOM(a,n);this.findAtPoint(e,r)}findPlace(e,n,s){let o,r;for(let a=this.open,i=0;a>=0;a--){let l=this.nodes[a],c=l.findWrapping(e);if(c&&(!o||o.length>c.length+i)&&(o=c,r=l,!c.length))break;if(l.solid){if(s)break;i+=2}}if(!o)return null;this.sync(r);for(let a=0;a<o.length;a++)n=this.enterInner(o[a],null,n,!1);return n}insertNode(e,n,s){if(e.isInline&&this.needsBlock&&!this.top.type){let r=this.textblockFromContext();r&&(n=this.enterInner(r,null,n))}let o=this.findPlace(e,n,s);if(o){this.closeExtra();let r=this.top;r.match&&(r.match=r.match.matchType(e.type));let a=be.none;for(let i of o.concat(e.marks))(r.type?r.type.allowsMarkType(i.type):Df(i.type,e.type))&&(a=i.addToSet(a));return r.content.push(e.mark(a)),!0}return!1}enter(e,n,s,o){let r=this.findPlace(e.create(n),s,!1);return r&&(r=this.enterInner(e,n,s,!0,o)),r}enterInner(e,n,s,o=!1,r){this.closeExtra();let a=this.top;a.match=a.match&&a.match.matchType(e);let i=xf(e,r,a.options);a.options&ir&&a.content.length==0&&(i|=ir);let l=be.none;return s=s.filter(c=>(a.type?a.type.allowsMarkType(c.type):Df(c.type,e))?(l=c.addToSet(l),!1):!0),this.nodes.push(new po(e,n,l,o,null,i)),this.open++,s}closeExtra(e=!1){let n=this.nodes.length-1;if(n>this.open){for(;n>this.open;n--)this.nodes[n-1].content.push(this.nodes[n].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(!!(this.isOpen||this.options.topOpen))}sync(e){for(let n=this.open;n>=0;n--){if(this.nodes[n]==e)return this.open=n,!0;this.localPreserveWS&&(this.nodes[n].options|=cr)}return!1}get currentPos(){this.closeExtra();let e=0;for(let n=this.open;n>=0;n--){let s=this.nodes[n].content;for(let o=s.length-1;o>=0;o--)e+=s[o].nodeSize;n&&e++}return e}findAtPoint(e,n){if(this.find)for(let s=0;s<this.find.length;s++)this.find[s].node==e&&this.find[s].offset==n&&(this.find[s].pos=this.currentPos)}findInside(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].pos==null&&e.nodeType==1&&e.contains(this.find[n].node)&&(this.find[n].pos=this.currentPos)}findAround(e,n,s){if(e!=n&&this.find)for(let o=0;o<this.find.length;o++)this.find[o].pos==null&&e.nodeType==1&&e.contains(this.find[o].node)&&n.compareDocumentPosition(this.find[o].node)&(s?2:4)&&(this.find[o].pos=this.currentPos)}findInText(e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&(this.find[n].pos=this.currentPos-(e.nodeValue.length-this.find[n].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let n=e.split("/"),s=this.options.context,o=!this.isOpen&&(!s||s.parent.type==this.nodes[0].type),r=-(s?s.depth+1:0)+(o?0:1),a=(i,l)=>{for(;i>=0;i--){let c=n[i];if(c==""){if(i==n.length-1||i==0)continue;for(;l>=r;l--)if(a(i-1,l))return!0;return!1}else{let d=l>0||l==0&&o?this.nodes[l].type:s&&l>=r?s.node(l-r).type:null;if(!d||d.name!=c&&!d.isInGroup(c))return!1;l--}}return!0};return a(n.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let n=e.depth;n>=0;n--){let s=e.node(n).contentMatchAt(e.indexAfter(n)).defaultType;if(s&&s.isTextblock&&s.defaultAttrs)return s}for(let n in this.parser.schema.nodes){let s=this.parser.schema.nodes[n];if(s.isTextblock&&s.defaultAttrs)return s}}};function qv(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let s=e.nodeType==1?e.nodeName.toLowerCase():null;s&&_f.hasOwnProperty(s)&&n?(n.appendChild(e),e=n):s=="li"?n=e:s&&(n=null)}}function Uv(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function Tf(t){let e={};for(let n in t)e[n]=t[n];return e}function Df(t,e){let n=e.schema.nodes;for(let s in n){let o=n[s];if(!o.allowsMarkType(t))continue;let r=[],a=i=>{r.push(i);for(let l=0;l<i.edgeCount;l++){let{type:c,next:d}=i.edge(l);if(c==e||r.indexOf(d)<0&&a(d))return!0}};if(a(o.contentMatch))return!0}}var jn=class t{constructor(e,n){this.nodes=e,this.marks=n}serializeFragment(e,n={},s){s||(s=nc(n).createDocumentFragment());let o=s,r=[];return e.forEach(a=>{if(r.length||a.marks.length){let i=0,l=0;for(;i<r.length&&l<a.marks.length;){let c=a.marks[l];if(!this.marks[c.type.name]){l++;continue}if(!c.eq(r[i][0])||c.type.spec.spanning===!1)break;i++,l++}for(;i<r.length;)o=r.pop()[1];for(;l<a.marks.length;){let c=a.marks[l++],d=this.serializeMark(c,a.isInline,n);d&&(r.push([c,o]),o.appendChild(d.dom),o=d.contentDOM||d.dom)}}o.appendChild(this.serializeNodeInner(a,n))}),s}serializeNodeInner(e,n){let{dom:s,contentDOM:o}=xa(nc(n),this.nodes[e.type.name](e),null,e.attrs);if(o){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,n,o)}return s}serializeNode(e,n={}){let s=this.serializeNodeInner(e,n);for(let o=e.marks.length-1;o>=0;o--){let r=this.serializeMark(e.marks[o],e.isInline,n);r&&((r.contentDOM||r.dom).appendChild(s),s=r.dom)}return s}serializeMark(e,n,s={}){let o=this.marks[e.type.name];return o&&xa(nc(s),o(e,n),null,e.attrs)}static renderSpec(e,n,s=null,o){return xa(e,n,s,o)}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new t(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let n=If(e.nodes);return n.text||(n.text=s=>s.text),n}static marksFromSchema(e){return If(e.marks)}};function If(t){let e={};for(let n in t){let s=t[n].spec.toDOM;s&&(e[n]=s)}return e}function nc(t){return t.document||window.document}var Cf=new WeakMap;function _v(t){let e=Cf.get(t);return e===void 0&&Cf.set(t,e=Vv(t)),e}function Vv(t){let e=null;function n(s){if(s&&typeof s=="object")if(Array.isArray(s))if(typeof s[0]=="string")e||(e=[]),e.push(s);else for(let o=0;o<s.length;o++)n(s[o]);else for(let o in s)n(s[o])}return n(t),e}function xa(t,e,n,s){if(typeof e=="string")return{dom:t.createTextNode(e)};if(e.nodeType!=null)return{dom:e};if(e.dom&&e.dom.nodeType!=null)return e;let o=e[0],r;if(typeof o!="string")throw new RangeError("Invalid array passed to renderSpec");if(s&&(r=_v(s))&&r.indexOf(e)>-1)throw new RangeError("Using an array from an attribute object as a DOM spec. This may be an attempted cross site scripting attack.");let a=o.indexOf(" ");a>0&&(n=o.slice(0,a),o=o.slice(a+1));let i,l=n?t.createElementNS(n,o):t.createElement(o),c=e[1],d=1;if(c&&typeof c=="object"&&c.nodeType==null&&!Array.isArray(c)){d=2;for(let u in c)if(c[u]!=null){let p=u.indexOf(" ");p>0?l.setAttributeNS(u.slice(0,p),u.slice(p+1),c[u]):u=="style"&&l.style?l.style.cssText=c[u]:l.setAttribute(u,c[u])}}for(let u=d;u<e.length;u++){let p=e[u];if(p===0){if(u<e.length-1||u>d)throw new RangeError("Content hole must be the only child of its parent node");return{dom:l,contentDOM:l}}else{let{dom:f,contentDOM:h}=xa(t,p,n,s);if(l.appendChild(f),h){if(i)throw new RangeError("Multiple content holes");i=h}}}return{dom:l,contentDOM:i}}var Kf=65535,Jf=Math.pow(2,16);function Wv(t,e){return t+e*Jf}function Vf(t){return t&Kf}function Kv(t){return(t-(t&Kf))/Jf}var Gf=1,Yf=2,Ma=4,Xf=8,pr=class{constructor(e,n,s){this.pos=e,this.delInfo=n,this.recover=s}get deleted(){return(this.delInfo&Xf)>0}get deletedBefore(){return(this.delInfo&(Gf|Ma))>0}get deletedAfter(){return(this.delInfo&(Yf|Ma))>0}get deletedAcross(){return(this.delInfo&Ma)>0}},Pn=class t{constructor(e,n=!1){if(this.ranges=e,this.inverted=n,!e.length&&t.empty)return t.empty}recover(e){let n=0,s=Vf(e);if(!this.inverted)for(let o=0;o<s;o++)n+=this.ranges[o*3+2]-this.ranges[o*3+1];return this.ranges[s*3]+n+Kv(e)}mapResult(e,n=1){return this._map(e,n,!1)}map(e,n=1){return this._map(e,n,!0)}_map(e,n,s){let o=0,r=this.inverted?2:1,a=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let l=this.ranges[i]-(this.inverted?o:0);if(l>e)break;let c=this.ranges[i+r],d=this.ranges[i+a],u=l+c;if(e<=u){let p=c?e==l?-1:e==u?1:n:n,f=l+o+(p<0?0:d);if(s)return f;let h=e==(n<0?l:u)?null:Wv(i/3,e-l),m=e==l?Yf:e==u?Gf:Ma;return(n<0?e!=l:e!=u)&&(m|=Xf),new pr(f,m,h)}o+=d-c}return s?e+o:new pr(e+o,0,null)}touches(e,n){let s=0,o=Vf(n),r=this.inverted?2:1,a=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let l=this.ranges[i]-(this.inverted?s:0);if(l>e)break;let c=this.ranges[i+r],d=l+c;if(e<=d&&i==o*3)return!0;s+=this.ranges[i+a]-c}return!1}forEach(e){let n=this.inverted?2:1,s=this.inverted?1:2;for(let o=0,r=0;o<this.ranges.length;o+=3){let a=this.ranges[o],i=a-(this.inverted?r:0),l=a+(this.inverted?0:r),c=this.ranges[o+n],d=this.ranges[o+s];e(i,i+c,l,l+d),r+=d-c}}invert(){return new t(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return e==0?t.empty:new t(e<0?[0,-e,0]:[0,0,e])}};Pn.empty=new Pn([]);var fr=class t{constructor(e,n,s=0,o=e?e.length:0){this.mirror=n,this.from=s,this.to=o,this._maps=e||[],this.ownData=!(e||n)}get maps(){return this._maps}slice(e=0,n=this.maps.length){return new t(this._maps,this.mirror,e,n)}appendMap(e,n){this.ownData||(this._maps=this._maps.slice(),this.mirror=this.mirror&&this.mirror.slice(),this.ownData=!0),this.to=this._maps.push(e),n!=null&&this.setMirror(this._maps.length-1,n)}appendMapping(e){for(let n=0,s=this._maps.length;n<e._maps.length;n++){let o=e.getMirror(n);this.appendMap(e._maps[n],o!=null&&o<n?s+o:void 0)}}getMirror(e){if(this.mirror){for(let n=0;n<this.mirror.length;n++)if(this.mirror[n]==e)return this.mirror[n+(n%2?-1:1)]}}setMirror(e,n){this.mirror||(this.mirror=[]),this.mirror.push(e,n)}appendMappingInverted(e){for(let n=e.maps.length-1,s=this._maps.length+e._maps.length;n>=0;n--){let o=e.getMirror(n);this.appendMap(e._maps[n].invert(),o!=null&&o>n?s-o-1:void 0)}}invert(){let e=new t;return e.appendMappingInverted(this),e}map(e,n=1){if(this.mirror)return this._map(e,n,!0);for(let s=this.from;s<this.to;s++)e=this._maps[s].map(e,n);return e}mapResult(e,n=1){return this._map(e,n,!1)}_map(e,n,s){let o=0;for(let r=this.from;r<this.to;r++){let a=this._maps[r],i=a.mapResult(e,n);if(i.recover!=null){let l=this.getMirror(r);if(l!=null&&l>r&&l<this.to){r=l,e=this._maps[l].recover(i.recover);continue}}o|=i.delInfo,e=i.pos}return s?e:new pr(e,o,null)}},cc=Object.create(null),tt=class{getMap(){return Pn.empty}merge(e){return null}static fromJSON(e,n){if(!n||!n.stepType)throw new RangeError("Invalid input for Step.fromJSON");let s=cc[n.stepType];if(!s)throw new RangeError(`No step type ${n.stepType} defined`);return s.fromJSON(e,n)}static jsonID(e,n){if(e in cc)throw new RangeError("Duplicate use of step JSON ID "+e);return cc[e]=n,n.prototype.jsonID=e,n}},at=class t{constructor(e,n){this.doc=e,this.failed=n}static ok(e){return new t(e,null)}static fail(e){return new t(null,e)}static fromReplace(e,n,s,o){try{return t.ok(e.replace(n,s,o))}catch(r){if(r instanceof Ms)return t.fail(r.message);throw r}}};function hc(t,e,n){let s=[];for(let o=0;o<t.childCount;o++){let r=t.child(o);r.content.size&&(r=r.copy(hc(r.content,e,r))),r.isInline&&(r=e(r,n,o)),s.push(r)}return O.fromArray(s)}var hr=class t extends tt{constructor(e,n,s){super(),this.from=e,this.to=n,this.mark=s}apply(e){let n=e.slice(this.from,this.to),s=e.resolve(this.from),o=s.node(s.sharedDepth(this.to)),r=new X(hc(n.content,(a,i)=>!a.isAtom||!i.type.allowsMarkType(this.mark.type)?a:a.mark(this.mark.addToSet(a.marks)),o),n.openStart,n.openEnd);return at.fromReplace(e,this.from,this.to,r)}invert(){return new Nn(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new t(n.pos,s.pos,this.mark)}merge(e){return e instanceof t&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new t(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new t(n.from,n.to,e.markFromJSON(n.mark))}};tt.jsonID("addMark",hr);var Nn=class t extends tt{constructor(e,n,s){super(),this.from=e,this.to=n,this.mark=s}apply(e){let n=e.slice(this.from,this.to),s=new X(hc(n.content,o=>o.mark(this.mark.removeFromSet(o.marks)),e),n.openStart,n.openEnd);return at.fromReplace(e,this.from,this.to,s)}invert(){return new hr(this.from,this.to,this.mark)}map(e){let n=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return n.deleted&&s.deleted||n.pos>=s.pos?null:new t(n.pos,s.pos,this.mark)}merge(e){return e instanceof t&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new t(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new t(n.from,n.to,e.markFromJSON(n.mark))}};tt.jsonID("removeMark",Nn);var mr=class t extends tt{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return at.fail("No node at mark step's position");let s=n.type.create(n.attrs,null,this.mark.addToSet(n.marks));return at.fromReplace(e,this.pos,this.pos+1,new X(O.from(s),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);if(n){let s=this.mark.addToSet(n.marks);if(s.length==n.marks.length){for(let o=0;o<n.marks.length;o++)if(!n.marks[o].isInSet(s))return new t(this.pos,n.marks[o]);return new t(this.pos,this.mark)}}return new ho(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new t(n.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new t(n.pos,e.markFromJSON(n.mark))}};tt.jsonID("addNodeMark",mr);var ho=class t extends tt{constructor(e,n){super(),this.pos=e,this.mark=n}apply(e){let n=e.nodeAt(this.pos);if(!n)return at.fail("No node at mark step's position");let s=n.type.create(n.attrs,null,this.mark.removeFromSet(n.marks));return at.fromReplace(e,this.pos,this.pos+1,new X(O.from(s),0,n.isLeaf?0:1))}invert(e){let n=e.nodeAt(this.pos);return!n||!this.mark.isInSet(n.marks)?this:new mr(this.pos,this.mark)}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new t(n.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new t(n.pos,e.markFromJSON(n.mark))}};tt.jsonID("removeNodeMark",ho);var gt=class t extends tt{constructor(e,n,s,o=!1){super(),this.from=e,this.to=n,this.slice=s,this.structure=o}apply(e){return this.structure&&pc(e,this.from,this.to)?at.fail("Structure replace would overwrite content"):at.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new Pn([this.from,this.to-this.from,this.slice.size])}invert(e){return new t(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let n=e.mapResult(this.from,1),s=e.mapResult(this.to,-1);return n.deletedAcross&&s.deletedAcross?null:new t(n.pos,Math.max(n.pos,s.pos),this.slice,this.structure)}merge(e){if(!(e instanceof t)||e.structure||this.structure)return null;if(this.from+this.slice.size==e.from&&!this.slice.openEnd&&!e.slice.openStart){let n=this.slice.size+e.slice.size==0?X.empty:new X(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new t(this.from,this.to+(e.to-e.from),n,this.structure)}else if(e.to==this.from&&!this.slice.openStart&&!e.slice.openEnd){let n=this.slice.size+e.slice.size==0?X.empty:new X(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new t(e.from,this.to,n,this.structure)}else return null}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number")throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new t(n.from,n.to,X.fromJSON(e,n.slice),!!n.structure)}};tt.jsonID("replace",gt);var Je=class t extends tt{constructor(e,n,s,o,r,a,i=!1){super(),this.from=e,this.to=n,this.gapFrom=s,this.gapTo=o,this.slice=r,this.insert=a,this.structure=i}apply(e){if(this.structure&&(pc(e,this.from,this.gapFrom)||pc(e,this.gapTo,this.to)))return at.fail("Structure gap-replace would overwrite content");let n=e.slice(this.gapFrom,this.gapTo);if(n.openStart||n.openEnd)return at.fail("Gap is not a flat range");let s=this.slice.insertAt(this.insert,n.content);return s?at.fromReplace(e,this.from,this.to,s):at.fail("Content does not fit in gap")}getMap(){return new Pn([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let n=this.gapTo-this.gapFrom;return new t(this.from,this.from+this.slice.size+n,this.from+this.insert,this.from+this.insert+n,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let n=e.mapResult(this.from,1),s=e.mapResult(this.to,-1),o=this.from==this.gapFrom?n.pos:e.map(this.gapFrom,-1),r=this.to==this.gapTo?s.pos:e.map(this.gapTo,1);return n.deletedAcross&&s.deletedAcross||o<n.pos||r>s.pos?null:new t(n.pos,s.pos,o,r,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,n){if(typeof n.from!="number"||typeof n.to!="number"||typeof n.gapFrom!="number"||typeof n.gapTo!="number"||typeof n.insert!="number")throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new t(n.from,n.to,n.gapFrom,n.gapTo,X.fromJSON(e,n.slice),n.insert,!!n.structure)}};tt.jsonID("replaceAround",Je);function pc(t,e,n){let s=t.resolve(e),o=n-e,r=s.depth;for(;o>0&&r>0&&s.indexAfter(r)==s.node(r).childCount;)r--,o--;if(o>0){let a=s.node(r).maybeChild(s.indexAfter(r));for(;o>0;){if(!a||a.isLeaf)return!0;a=a.firstChild,o--}}return!1}function Jv(t,e,n,s){let o=[],r=[],a,i;t.doc.nodesBetween(e,n,(l,c,d)=>{if(!l.isInline)return;let u=l.marks;if(!s.isInSet(u)&&d.type.allowsMarkType(s.type)){let p=Math.max(c,e),f=Math.min(c+l.nodeSize,n),h=s.addToSet(u);for(let m=0;m<u.length;m++)u[m].isInSet(h)||(a&&a.to==p&&a.mark.eq(u[m])?a.to=f:o.push(a=new Nn(p,f,u[m])));i&&i.to==p?i.to=f:r.push(i=new hr(p,f,s))}}),o.forEach(l=>t.step(l)),r.forEach(l=>t.step(l))}function Gv(t,e,n,s){let o=[],r=0;t.doc.nodesBetween(e,n,(a,i)=>{if(!a.isInline)return;r++;let l=null;if(s instanceof lr){let c=a.marks,d;for(;d=s.isInSet(c);)(l||(l=[])).push(d),c=d.removeFromSet(c)}else s?s.isInSet(a.marks)&&(l=[s]):l=a.marks;if(l&&l.length){let c=Math.min(i+a.nodeSize,n);for(let d=0;d<l.length;d++){let u=l[d],p;for(let f=0;f<o.length;f++){let h=o[f];h.step==r-1&&u.eq(o[f].style)&&(p=h)}p?(p.to=c,p.step=r):o.push({style:u,from:Math.max(i,e),to:c,step:r})}}}),o.forEach(a=>t.step(new Nn(a.from,a.to,a.style)))}function mc(t,e,n,s=n.contentMatch,o=!0){let r=t.doc.nodeAt(e),a=[],i=e+1;for(let l=0;l<r.childCount;l++){let c=r.child(l),d=i+c.nodeSize,u=s.matchType(c.type);if(!u)a.push(new gt(i,d,X.empty));else{s=u;for(let p=0;p<c.marks.length;p++)n.allowsMarkType(c.marks[p].type)||t.step(new Nn(i,d,c.marks[p]));if(o&&c.isText&&n.whitespace!="pre"){let p,f=/\r?\n|\r/g,h;for(;p=f.exec(c.text);)h||(h=new X(O.from(n.schema.text(" ",n.allowedMarks(c.marks))),0,0)),a.push(new gt(i+p.index,i+p.index+p[0].length,h))}}i=d}if(!s.validEnd){let l=s.fillBefore(O.empty,!0);t.replace(i,i,new X(l,0,0))}for(let l=a.length-1;l>=0;l--)t.step(a[l])}function Yv(t,e,n){return(e==0||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function Bn(t){let n=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let s=t.depth,o=0,r=0;;--s){let a=t.$from.node(s),i=t.$from.index(s)+o,l=t.$to.indexAfter(s)-r;if(s<t.depth&&a.canReplace(i,l,n))return s;if(s==0||a.type.spec.isolating||!Yv(a,i,l))break;i&&(o=1),l<a.childCount&&(r=1)}return null}function Xv(t,e,n){let{$from:s,$to:o,depth:r}=e,a=s.before(r+1),i=o.after(r+1),l=a,c=i,d=O.empty,u=0;for(let h=r,m=!1;h>n;h--)m||s.index(h)>0?(m=!0,d=O.from(s.node(h).copy(d)),u++):l--;let p=O.empty,f=0;for(let h=r,m=!1;h>n;h--)m||o.after(h+1)<o.end(h)?(m=!0,p=O.from(o.node(h).copy(p)),f++):c++;t.step(new Je(l,c,a,i,new X(d.append(p),u,f),d.size-u,!0))}function yo(t,e,n=null,s=t){let o=Zv(t,e),r=o&&Qv(s,e);return r?o.map(Wf).concat({type:e,attrs:n}).concat(r.map(Wf)):null}function Wf(t){return{type:t,attrs:null}}function Zv(t,e){let{parent:n,startIndex:s,endIndex:o}=t,r=n.contentMatchAt(s).findWrapping(e);if(!r)return null;let a=r.length?r[0]:e;return n.canReplaceWith(s,o,a)?r:null}function Qv(t,e){let{parent:n,startIndex:s,endIndex:o}=t,r=n.child(s),a=e.contentMatch.findWrapping(r.type);if(!a)return null;let l=(a.length?a[a.length-1]:e).contentMatch;for(let c=s;l&&c<o;c++)l=l.matchType(n.child(c).type);return!l||!l.validEnd?null:a}function ew(t,e,n){let s=O.empty;for(let a=n.length-1;a>=0;a--){if(s.size){let i=n[a].type.contentMatch.matchFragment(s);if(!i||!i.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=O.from(n[a].type.create(n[a].attrs,s))}let o=e.start,r=e.end;t.step(new Je(o,r,o,r,new X(s,0,0),n.length,!0))}function tw(t,e,n,s,o){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let r=t.steps.length;t.doc.nodesBetween(e,n,(a,i)=>{let l=typeof o=="function"?o(a):o;if(a.isTextblock&&!a.hasMarkup(s,l)&&nw(t.doc,t.mapping.slice(r).map(i),s)){let c=null;if(s.schema.linebreakReplacement){let f=s.whitespace=="pre",h=!!s.contentMatch.matchType(s.schema.linebreakReplacement);f&&!h?c=!1:!f&&h&&(c=!0)}c===!1&&Qf(t,a,i,r),mc(t,t.mapping.slice(r).map(i,1),s,void 0,c===null);let d=t.mapping.slice(r),u=d.map(i,1),p=d.map(i+a.nodeSize,1);return t.step(new Je(u,p,u+1,p-1,new X(O.from(s.create(l,null,a.marks)),0,0),1,!0)),c===!0&&Zf(t,a,i,r),!1}})}function Zf(t,e,n,s){e.forEach((o,r)=>{if(o.isText){let a,i=/\r?\n|\r/g;for(;a=i.exec(o.text);){let l=t.mapping.slice(s).map(n+1+r+a.index);t.replaceWith(l,l+1,e.type.schema.linebreakReplacement.create())}}})}function Qf(t,e,n,s){e.forEach((o,r)=>{if(o.type==o.type.schema.linebreakReplacement){let a=t.mapping.slice(s).map(n+1+r);t.replaceWith(a,a+1,e.type.schema.text(`
`))}})}function nw(t,e,n){let s=t.resolve(e),o=s.index();return s.parent.canReplaceWith(o,o+1,n)}function sw(t,e,n,s,o){let r=t.doc.nodeAt(e);if(!r)throw new RangeError("No node at given position");n||(n=r.type);let a=n.create(s,null,o||r.marks);if(r.isLeaf)return t.replaceWith(e,e+r.nodeSize,a);if(!n.validContent(r.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new Je(e,e+r.nodeSize,e+1,e+r.nodeSize-1,new X(O.from(a),0,0),1,!0))}function zt(t,e,n=1,s){let o=t.resolve(e),r=o.depth-n,a=s&&s[s.length-1]||o.parent;if(r<0||o.parent.type.spec.isolating||!o.parent.canReplace(o.index(),o.parent.childCount)||!a.type.validContent(o.parent.content.cutByIndex(o.index(),o.parent.childCount)))return!1;for(let c=o.depth-1,d=n-2;c>r;c--,d--){let u=o.node(c),p=o.index(c);if(u.type.spec.isolating)return!1;let f=u.content.cutByIndex(p,u.childCount),h=s&&s[d+1];h&&(f=f.replaceChild(0,h.type.create(h.attrs)));let m=s&&s[d]||u;if(!u.canReplace(p+1,u.childCount)||!m.type.validContent(f))return!1}let i=o.indexAfter(r),l=s&&s[0];return o.node(r).canReplaceWith(i,i,l?l.type:o.node(r+1).type)}function ow(t,e,n=1,s){let o=t.doc.resolve(e),r=O.empty,a=O.empty;for(let i=o.depth,l=o.depth-n,c=n-1;i>l;i--,c--){r=O.from(o.node(i).copy(r));let d=s&&s[c];a=O.from(d?d.type.create(d.attrs,a):o.node(i).copy(a))}t.step(new gt(e,e,new X(r.append(a),n,n),!0))}function Wt(t,e){let n=t.resolve(e),s=n.index();return eh(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(s,s+1)}function rw(t,e){e.content.size||t.type.compatibleContent(e.type);let n=t.contentMatchAt(t.childCount),{linebreakReplacement:s}=t.type.schema;for(let o=0;o<e.childCount;o++){let r=e.child(o),a=r.type==s?t.type.schema.nodes.text:r.type;if(n=n.matchType(a),!n||!t.type.allowsMarks(r.marks))return!1}return n.validEnd}function eh(t,e){return!!(t&&e&&!t.isLeaf&&rw(t,e))}function Ps(t,e,n=-1){let s=t.resolve(e);for(let o=s.depth;;o--){let r,a,i=s.index(o);if(o==s.depth?(r=s.nodeBefore,a=s.nodeAfter):n>0?(r=s.node(o+1),i++,a=s.node(o).maybeChild(i)):(r=s.node(o).maybeChild(i-1),a=s.node(o+1)),r&&!r.isTextblock&&eh(r,a)&&s.node(o).canReplace(i,i+1))return e;if(o==0)break;e=n<0?s.before(o):s.after(o)}}function aw(t,e,n){let s=null,{linebreakReplacement:o}=t.doc.type.schema,r=t.doc.resolve(e-n),a=r.node().type;if(o&&a.inlineContent){let d=a.whitespace=="pre",u=!!a.contentMatch.matchType(o);d&&!u?s=!1:!d&&u&&(s=!0)}let i=t.steps.length;if(s===!1){let d=t.doc.resolve(e+n);Qf(t,d.node(),d.before(),i)}a.inlineContent&&mc(t,e+n-1,a,r.node().contentMatchAt(r.index()),s==null);let l=t.mapping.slice(i),c=l.map(e-n);if(t.step(new gt(c,l.map(e+n,-1),X.empty,!0)),s===!0){let d=t.doc.resolve(c);Zf(t,d.node(),d.before(),t.steps.length)}return t}function iw(t,e,n){let s=t.resolve(e);if(s.parent.canReplaceWith(s.index(),s.index(),n))return e;if(s.parentOffset==0)for(let o=s.depth-1;o>=0;o--){let r=s.index(o);if(s.node(o).canReplaceWith(r,r,n))return s.before(o+1);if(r>0)return null}if(s.parentOffset==s.parent.content.size)for(let o=s.depth-1;o>=0;o--){let r=s.indexAfter(o);if(s.node(o).canReplaceWith(r,r,n))return s.after(o+1);if(r<s.node(o).childCount)return null}return null}function Pa(t,e,n){let s=t.resolve(e);if(!n.content.size)return e;let o=n.content;for(let r=0;r<n.openStart;r++)o=o.firstChild.content;for(let r=1;r<=(n.openStart==0&&n.size?2:1);r++)for(let a=s.depth;a>=0;a--){let i=a==s.depth?0:s.pos<=(s.start(a+1)+s.end(a+1))/2?-1:1,l=s.index(a)+(i>0?1:0),c=s.node(a),d=!1;if(r==1)d=c.canReplace(l,l,o);else{let u=c.contentMatchAt(l).findWrapping(o.firstChild.type);d=u&&c.canReplaceWith(l,l,u[0])}if(d)return i==0?s.pos:i<0?s.before(a+1):s.after(a+1)}return null}function gr(t,e,n=e,s=X.empty){if(e==n&&!s.size)return null;let o=t.resolve(e),r=t.resolve(n);return th(o,r,s)?new gt(e,n,s):new fc(o,r,s).fit()}function th(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}var fc=class{constructor(e,n,s){this.$from=e,this.$to=n,this.unplaced=s,this.frontier=[],this.placed=O.empty;for(let o=0;o<=e.depth;o++){let r=e.node(o);this.frontier.push({type:r.type,match:r.contentMatchAt(e.indexAfter(o))})}for(let o=e.depth;o>0;o--)this.placed=O.from(e.node(o).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let c=this.findFittable();c?this.placeNodes(c):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),n=this.placed.size-this.depth-this.$from.depth,s=this.$from,o=this.close(e<0?this.$to:s.doc.resolve(e));if(!o)return null;let r=this.placed,a=s.depth,i=o.depth;for(;a&&i&&r.childCount==1;)r=r.firstChild.content,a--,i--;let l=new X(r,a,i);return e>-1?new Je(s.pos,e,this.$to.pos,this.$to.end(),l,n):l.size||s.pos!=this.$to.pos?new gt(s.pos,o.pos,l):null}findFittable(){let e=this.unplaced.openStart;for(let n=this.unplaced.content,s=0,o=this.unplaced.openEnd;s<e;s++){let r=n.firstChild;if(n.childCount>1&&(o=0),r.type.spec.isolating&&o<=s){e=s;break}n=r.content}for(let n=1;n<=2;n++)for(let s=n==1?e:this.unplaced.openStart;s>=0;s--){let o,r=null;s?(r=dc(this.unplaced.content,s-1).firstChild,o=r.content):o=this.unplaced.content;let a=o.firstChild;for(let i=this.depth;i>=0;i--){let{type:l,match:c}=this.frontier[i],d,u=null;if(n==1&&(a?c.matchType(a.type)||(u=c.fillBefore(O.from(a),!1)):r&&l.compatibleContent(r.type)))return{sliceDepth:s,frontierDepth:i,parent:r,inject:u};if(n==2&&a&&(d=c.findWrapping(a.type)))return{sliceDepth:s,frontierDepth:i,parent:r,wrap:d};if(r&&c.matchType(r.type))break}}}openMore(){let{content:e,openStart:n,openEnd:s}=this.unplaced,o=dc(e,n);return!o.childCount||o.firstChild.isLeaf?!1:(this.unplaced=new X(e,n+1,Math.max(s,o.size+n>=e.size-s?n+1:0)),!0)}dropNode(){let{content:e,openStart:n,openEnd:s}=this.unplaced,o=dc(e,n);if(o.childCount<=1&&n>0){let r=e.size-n<=n+o.size;this.unplaced=new X(dr(e,n-1,1),n-1,r?n-1:s)}else this.unplaced=new X(dr(e,n,1),n,s)}placeNodes({sliceDepth:e,frontierDepth:n,parent:s,inject:o,wrap:r}){for(;this.depth>n;)this.closeFrontierNode();if(r)for(let m=0;m<r.length;m++)this.openFrontierNode(r[m]);let a=this.unplaced,i=s?s.content:a.content,l=a.openStart-e,c=0,d=[],{match:u,type:p}=this.frontier[n];if(o){for(let m=0;m<o.childCount;m++)d.push(o.child(m));u=u.matchFragment(o)}let f=i.size+e-(a.content.size-a.openEnd);for(;c<i.childCount;){let m=i.child(c),y=u.matchType(m.type);if(!y)break;c++,(c>1||l==0||m.content.size)&&(u=y,d.push(nh(m.mark(p.allowedMarks(m.marks)),c==1?l:0,c==i.childCount?f:-1)))}let h=c==i.childCount;h||(f=-1),this.placed=ur(this.placed,n,O.from(d)),this.frontier[n].match=u,h&&f<0&&s&&s.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let m=0,y=i;m<f;m++){let k=y.lastChild;this.frontier.push({type:k.type,match:k.contentMatchAt(k.childCount)}),y=k.content}this.unplaced=h?e==0?X.empty:new X(dr(a.content,e-1,1),e-1,f<0?a.openEnd:e-1):new X(dr(a.content,e,c),a.openStart,a.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e=this.frontier[this.depth],n;if(!e.type.isTextblock||!uc(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(n=this.findCloseLevel(this.$to))&&n.depth==this.depth)return-1;let{depth:s}=this.$to,o=this.$to.after(s);for(;s>1&&o==this.$to.end(--s);)++o;return o}findCloseLevel(e){e:for(let n=Math.min(this.depth,e.depth);n>=0;n--){let{match:s,type:o}=this.frontier[n],r=n<e.depth&&e.end(n+1)==e.pos+(e.depth-(n+1)),a=uc(e,n,o,s,r);if(a){for(let i=n-1;i>=0;i--){let{match:l,type:c}=this.frontier[i],d=uc(e,i,c,l,!0);if(!d||d.childCount)continue e}return{depth:n,fit:a,move:r?e.doc.resolve(e.after(n+1)):e}}}}close(e){let n=this.findCloseLevel(e);if(!n)return null;for(;this.depth>n.depth;)this.closeFrontierNode();n.fit.childCount&&(this.placed=ur(this.placed,n.depth,n.fit)),e=n.move;for(let s=n.depth+1;s<=e.depth;s++){let o=e.node(s),r=o.type.contentMatch.fillBefore(o.content,!0,e.index(s));this.openFrontierNode(o.type,o.attrs,r)}return e}openFrontierNode(e,n=null,s){let o=this.frontier[this.depth];o.match=o.match.matchType(e),this.placed=ur(this.placed,this.depth,O.from(e.create(n,s))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let n=this.frontier.pop().match.fillBefore(O.empty,!0);n.childCount&&(this.placed=ur(this.placed,this.frontier.length,n))}};function dr(t,e,n){return e==0?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(dr(t.firstChild.content,e-1,n)))}function ur(t,e,n){return e==0?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(ur(t.lastChild.content,e-1,n)))}function dc(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function nh(t,e,n){if(e<=0)return t;let s=t.content;return e>1&&(s=s.replaceChild(0,nh(s.firstChild,e-1,s.childCount==1?n-1:0))),e>0&&(s=t.type.contentMatch.fillBefore(s).append(s),n<=0&&(s=s.append(t.type.contentMatch.matchFragment(s).fillBefore(O.empty,!0)))),t.copy(s)}function uc(t,e,n,s,o){let r=t.node(e),a=o?t.indexAfter(e):t.index(e);if(a==r.childCount&&!n.compatibleContent(r.type))return null;let i=s.fillBefore(r.content,!0,a);return i&&!lw(n,r.content,a)?i:null}function lw(t,e,n){for(let s=n;s<e.childCount;s++)if(!t.allowsMarks(e.child(s).marks))return!0;return!1}function cw(t){return t.spec.defining||t.spec.definingForContent}function dw(t,e,n,s){if(!s.size)return t.deleteRange(e,n);let o=t.doc.resolve(e),r=t.doc.resolve(n);if(th(o,r,s))return t.step(new gt(e,n,s));let a=oh(o,r);a[a.length-1]==0&&a.pop();let i=-(o.depth+1);a.unshift(i);for(let p=o.depth,f=o.pos-1;p>0;p--,f--){let h=o.node(p).type.spec;if(h.defining||h.definingAsContext||h.isolating)break;a.indexOf(p)>-1?i=p:o.before(p)==f&&a.splice(1,0,-p)}let l=a.indexOf(i),c=[],d=s.openStart;for(let p=s.content,f=0;;f++){let h=p.firstChild;if(c.push(h),f==s.openStart)break;p=h.content}for(let p=d-1;p>=0;p--){let f=c[p],h=cw(f.type);if(h&&!f.sameMarkup(o.node(Math.abs(i)-1)))d=p;else if(h||!f.type.isTextblock)break}for(let p=s.openStart;p>=0;p--){let f=(p+d+1)%(s.openStart+1),h=c[f];if(h)for(let m=0;m<a.length;m++){let y=a[(m+l)%a.length],k=!0;y<0&&(k=!1,y=-y);let S=o.node(y-1),T=o.index(y-1);if(S.canReplaceWith(T,T,h.type,h.marks))return t.replace(o.before(y),k?r.after(y):n,new X(sh(s.content,0,s.openStart,f),f,s.openEnd))}}let u=t.steps.length;for(let p=a.length-1;p>=0&&(t.replace(e,n,s),!(t.steps.length>u));p--){let f=a[p];f<0||(e=o.before(f),n=r.after(f))}}function sh(t,e,n,s,o){if(e<n){let r=t.firstChild;t=t.replaceChild(0,r.copy(sh(r.content,e+1,n,s,r)))}if(e>s){let r=o.contentMatchAt(0),a=r.fillBefore(t).append(t);t=a.append(r.matchFragment(a).fillBefore(O.empty,!0))}return t}function uw(t,e,n,s){if(!s.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let o=iw(t.doc,e,s.type);o!=null&&(e=n=o)}t.replaceRange(e,n,new X(O.from(s),0,0))}function pw(t,e,n){let s=t.doc.resolve(e),o=t.doc.resolve(n),r=oh(s,o);for(let a=0;a<r.length;a++){let i=r[a],l=a==r.length-1;if(l&&i==0||s.node(i).type.contentMatch.validEnd)return t.delete(s.start(i),o.end(i));if(i>0&&(l||s.node(i-1).canReplace(s.index(i-1),o.indexAfter(i-1))))return t.delete(s.before(i),o.after(i))}for(let a=1;a<=s.depth&&a<=o.depth;a++)if(e-s.start(a)==s.depth-a&&n>s.end(a)&&o.end(a)-n!=o.depth-a&&s.start(a-1)==o.start(a-1)&&s.node(a-1).canReplace(s.index(a-1),o.index(a-1)))return t.delete(s.before(a),n);t.delete(e,n)}function oh(t,e){let n=[],s=Math.min(t.depth,e.depth);for(let o=s;o>=0;o--){let r=t.start(o);if(r<t.pos-(t.depth-o)||e.end(o)>e.pos+(e.depth-o)||t.node(o).type.spec.isolating||e.node(o).type.spec.isolating)break;(r==e.start(o)||o==t.depth&&o==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&o&&e.start(o-1)==r-1)&&n.push(o)}return n}var La=class t extends tt{constructor(e,n,s){super(),this.pos=e,this.attr=n,this.value=s}apply(e){let n=e.nodeAt(this.pos);if(!n)return at.fail("No node at attribute step's position");let s=Object.create(null);for(let r in n.attrs)s[r]=n.attrs[r];s[this.attr]=this.value;let o=n.type.create(s,null,n.marks);return at.fromReplace(e,this.pos,this.pos+1,new X(O.from(o),0,n.isLeaf?0:1))}getMap(){return Pn.empty}invert(e){return new t(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let n=e.mapResult(this.pos,1);return n.deletedAfter?null:new t(n.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.pos!="number"||typeof n.attr!="string")throw new RangeError("Invalid input for AttrStep.fromJSON");return new t(n.pos,n.attr,n.value)}};tt.jsonID("attr",La);var ja=class t extends tt{constructor(e,n){super(),this.attr=e,this.value=n}apply(e){let n=Object.create(null);for(let o in e.attrs)n[o]=e.attrs[o];n[this.attr]=this.value;let s=e.type.create(n,e.content,e.marks);return at.ok(s)}getMap(){return Pn.empty}invert(e){return new t(this.attr,e.attrs[this.attr])}map(e){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(e,n){if(typeof n.attr!="string")throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new t(n.attr,n.value)}};tt.jsonID("docAttr",ja);var mo=class extends Error{};mo=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n};mo.prototype=Object.create(Error.prototype);mo.prototype.constructor=mo;mo.prototype.name="TransformError";var go=class{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new fr}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let n=this.maybeStep(e);if(n.failed)throw new mo(n.failed);return this}maybeStep(e){let n=e.apply(this.doc);return n.failed||this.addStep(e,n.doc),n}get docChanged(){return this.steps.length>0}changedRange(){let e=1e9,n=-1e9;for(let s=0;s<this.mapping.maps.length;s++){let o=this.mapping.maps[s];s&&(e=o.map(e,1),n=o.map(n,-1)),o.forEach((r,a,i,l)=>{e=Math.min(e,i),n=Math.max(n,l)})}return e==1e9?null:{from:e,to:n}}addStep(e,n){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=n}replace(e,n=e,s=X.empty){let o=gr(this.doc,e,n,s);return o&&this.step(o),this}replaceWith(e,n,s){return this.replace(e,n,new X(O.from(s),0,0))}delete(e,n){return this.replace(e,n,X.empty)}insert(e,n){return this.replaceWith(e,e,n)}replaceRange(e,n,s){return dw(this,e,n,s),this}replaceRangeWith(e,n,s){return uw(this,e,n,s),this}deleteRange(e,n){return pw(this,e,n),this}lift(e,n){return Xv(this,e,n),this}join(e,n=1){return aw(this,e,n),this}wrap(e,n){return ew(this,e,n),this}setBlockType(e,n=e,s,o=null){return tw(this,e,n,s,o),this}setNodeMarkup(e,n,s=null,o){return sw(this,e,n,s,o),this}setNodeAttribute(e,n,s){return this.step(new La(e,n,s)),this}setDocAttribute(e,n){return this.step(new ja(e,n)),this}addNodeMark(e,n){return this.step(new mr(e,n)),this}removeNodeMark(e,n){let s=this.doc.nodeAt(e);if(!s)throw new RangeError("No node at position "+e);if(n instanceof be)n.isInSet(s.marks)&&this.step(new ho(e,n));else{let o=s.marks,r,a=[];for(;r=n.isInSet(o);)a.push(new ho(e,r)),o=r.removeFromSet(o);for(let i=a.length-1;i>=0;i--)this.step(a[i])}return this}split(e,n=1,s){return ow(this,e,n,s),this}addMark(e,n,s){return Jv(this,e,n,s),this}removeMark(e,n,s){return Gv(this,e,n,s),this}clearIncompatible(e,n,s){return mc(this,e,n,s),this}};var gc=Object.create(null),re=class{constructor(e,n,s){this.$anchor=e,this.$head=n,this.ranges=s||[new Ba(e.min(n),e.max(n))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let n=0;n<e.length;n++)if(e[n].$from.pos!=e[n].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,n=X.empty){let s=n.content.lastChild,o=null;for(let i=0;i<n.openEnd;i++)o=s,s=s.lastChild;let r=e.steps.length,a=this.ranges;for(let i=0;i<a.length;i++){let{$from:l,$to:c}=a[i],d=e.mapping.slice(r);e.replaceRange(d.map(l.pos),d.map(c.pos),i?X.empty:n),i==0&&ih(e,r,(s?s.isInline:o&&o.isTextblock)?-1:1)}}replaceWith(e,n){let s=e.steps.length,o=this.ranges;for(let r=0;r<o.length;r++){let{$from:a,$to:i}=o[r],l=e.mapping.slice(s),c=l.map(a.pos),d=l.map(i.pos);r?e.deleteRange(c,d):(e.replaceRangeWith(c,d,n),ih(e,s,n.isInline?-1:1))}}static findFrom(e,n,s=!1){let o=e.parent.inlineContent?new te(e):ko(e.node(0),e.parent,e.pos,e.index(),n,s);if(o)return o;for(let r=e.depth-1;r>=0;r--){let a=n<0?ko(e.node(0),e.node(r),e.before(r+1),e.index(r),n,s):ko(e.node(0),e.node(r),e.after(r+1),e.index(r)+1,n,s);if(a)return a}return null}static near(e,n=1){return this.findFrom(e,n)||this.findFrom(e,-n)||new xt(e.node(0))}static atStart(e){return ko(e,e,0,0,1)||new xt(e)}static atEnd(e){return ko(e,e,e.content.size,e.childCount,-1)||new xt(e)}static fromJSON(e,n){if(!n||!n.type)throw new RangeError("Invalid input for Selection.fromJSON");let s=gc[n.type];if(!s)throw new RangeError(`No selection type ${n.type} defined`);return s.fromJSON(e,n)}static jsonID(e,n){if(e in gc)throw new RangeError("Duplicate use of selection JSON ID "+e);return gc[e]=n,n.prototype.jsonID=e,n}getBookmark(){return te.between(this.$anchor,this.$head).getBookmark()}};re.prototype.visible=!0;var Ba=class{constructor(e,n){this.$from=e,this.$to=n}},rh=!1;function ah(t){!rh&&!t.parent.inlineContent&&(rh=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}var te=class t extends re{constructor(e,n=e){ah(e),ah(n),super(e,n)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,n){let s=e.resolve(n.map(this.head));if(!s.parent.inlineContent)return re.near(s);let o=e.resolve(n.map(this.anchor));return new t(o.parent.inlineContent?o:s,s)}replace(e,n=X.empty){if(super.replace(e,n),n==X.empty){let s=this.$from.marksAcross(this.$to);s&&e.ensureMarks(s)}}eq(e){return e instanceof t&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new Oa(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,n){if(typeof n.anchor!="number"||typeof n.head!="number")throw new RangeError("Invalid input for TextSelection.fromJSON");return new t(e.resolve(n.anchor),e.resolve(n.head))}static create(e,n,s=n){let o=e.resolve(n);return new this(o,s==n?o:e.resolve(s))}static between(e,n,s){let o=e.pos-n.pos;if((!s||o)&&(s=o>=0?1:-1),!n.parent.inlineContent){let r=re.findFrom(n,s,!0)||re.findFrom(n,-s,!0);if(r)n=r.$head;else return re.near(n,s)}return e.parent.inlineContent||(o==0?e=n:(e=(re.findFrom(e,-s,!0)||re.findFrom(e,s,!0)).$anchor,e.pos<n.pos!=o<0&&(e=n))),new t(e,n)}};re.jsonID("text",te);var Oa=class t{constructor(e,n){this.anchor=e,this.head=n}map(e){return new t(e.map(this.anchor),e.map(this.head))}resolve(e){return te.between(e.resolve(this.anchor),e.resolve(this.head))}},Q=class t extends re{constructor(e){let n=e.nodeAfter,s=e.node(0).resolve(e.pos+n.nodeSize);super(e,s),this.node=n}map(e,n){let{deleted:s,pos:o}=n.mapResult(this.anchor),r=e.resolve(o);return s?re.near(r):new t(r)}content(){return new X(O.from(this.node),0,0)}eq(e){return e instanceof t&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new kc(this.anchor)}static fromJSON(e,n){if(typeof n.anchor!="number")throw new RangeError("Invalid input for NodeSelection.fromJSON");return new t(e.resolve(n.anchor))}static create(e,n){return new t(e.resolve(n))}static isSelectable(e){return!e.isText&&e.type.spec.selectable!==!1}};Q.prototype.visible=!1;re.jsonID("node",Q);var kc=class t{constructor(e){this.anchor=e}map(e){let{deleted:n,pos:s}=e.mapResult(this.anchor);return n?new Oa(s,s):new t(s)}resolve(e){let n=e.resolve(this.anchor),s=n.nodeAfter;return s&&Q.isSelectable(s)?new Q(n):re.near(n)}},xt=class t extends re{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,n=X.empty){if(n==X.empty){e.delete(0,e.doc.content.size);let s=re.atStart(e.doc);s.eq(e.selection)||e.setSelection(s)}else super.replace(e,n)}toJSON(){return{type:"all"}}static fromJSON(e){return new t(e)}map(e){return new t(e)}eq(e){return e instanceof t}getBookmark(){return fw}};re.jsonID("all",xt);var fw={map(){return this},resolve(t){return new xt(t)}};function ko(t,e,n,s,o,r=!1){if(e.inlineContent)return te.create(t,n);for(let a=s-(o>0?0:1);o>0?a<e.childCount:a>=0;a+=o){let i=e.child(a);if(i.isAtom){if(!r&&Q.isSelectable(i))return Q.create(t,n-(o<0?i.nodeSize:0))}else{let l=ko(t,i,n+o,o<0?i.childCount:0,o,r);if(l)return l}n+=i.nodeSize*o}return null}function ih(t,e,n){let s=t.steps.length-1;if(s<e)return;let o=t.steps[s];if(!(o instanceof gt||o instanceof Je))return;let r=t.mapping.maps[s],a;r.forEach((i,l,c,d)=>{a==null&&(a=d)}),t.setSelection(re.near(t.doc.resolve(a),n))}var lh=1,Na=2,ch=4,bc=class extends go{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|lh)&~Na,this.storedMarks=null,this}get selectionSet(){return(this.updated&lh)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=Na,this}ensureMarks(e){return be.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&Na)>0}addStep(e,n){super.addStep(e,n),this.updated=this.updated&~Na,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,n=!0){let s=this.selection;return n&&(e=e.mark(this.storedMarks||(s.empty?s.$from.marks():s.$from.marksAcross(s.$to)||be.none))),s.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,n,s){let o=this.doc.type.schema;if(n==null)return e?this.replaceSelectionWith(o.text(e),!0):this.deleteSelection();{if(s==null&&(s=n),!e)return this.deleteRange(n,s);let r=this.storedMarks;if(!r){let a=this.doc.resolve(n);r=s==n?a.marks():a.marksAcross(this.doc.resolve(s))}return this.replaceRangeWith(n,s,o.text(e,r)),!this.selection.empty&&this.selection.to==n+e.length&&this.setSelection(re.near(this.selection.$to)),this}}setMeta(e,n){return this.meta[typeof e=="string"?e:e.key]=n,this}getMeta(e){return this.meta[typeof e=="string"?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=ch,this}get scrolledIntoView(){return(this.updated&ch)>0}};function dh(t,e){return!e||!t?t:t.bind(e)}var Ns=class{constructor(e,n,s){this.name=e,this.init=dh(n.init,s),this.apply=dh(n.apply,s)}},hw=[new Ns("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new Ns("selection",{init(t,e){return t.selection||re.atStart(e.doc)},apply(t){return t.selection}}),new Ns("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,s){return s.selection.$cursor?t.storedMarks:null}}),new Ns("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})],yr=class{constructor(e,n){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=hw.slice(),n&&n.forEach(s=>{if(this.pluginsByKey[s.key])throw new RangeError("Adding different instances of a keyed plugin ("+s.key+")");this.plugins.push(s),this.pluginsByKey[s.key]=s,s.spec.state&&this.fields.push(new Ns(s.key,s.spec.state,s))})}},Ra=class t{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,n=-1){for(let s=0;s<this.config.plugins.length;s++)if(s!=n){let o=this.config.plugins[s];if(o.spec.filterTransaction&&!o.spec.filterTransaction.call(o,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let n=[e],s=this.applyInner(e),o=null;for(;;){let r=!1;for(let a=0;a<this.config.plugins.length;a++){let i=this.config.plugins[a];if(i.spec.appendTransaction){let l=o?o[a].n:0,c=o?o[a].state:this,d=l<n.length&&i.spec.appendTransaction.call(i,l?n.slice(l):n,c,s);if(d&&s.filterTransaction(d,a)){if(d.setMeta("appendedTransaction",e),!o){o=[];for(let u=0;u<this.config.plugins.length;u++)o.push(u<a?{state:s,n:n.length}:{state:this,n:0})}n.push(d),s=s.applyInner(d),r=!0}o&&(o[a]={state:s,n:n.length})}}if(!r)return{state:s,transactions:n}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let n=new t(this.config),s=this.config.fields;for(let o=0;o<s.length;o++){let r=s[o];n[r.name]=r.apply(e,this[r.name],this,n)}return n}get tr(){return new bc(this)}static create(e){let n=new yr(e.doc?e.doc.type.schema:e.schema,e.plugins),s=new t(n);for(let o=0;o<n.fields.length;o++)s[n.fields[o].name]=n.fields[o].init(e,s);return s}reconfigure(e){let n=new yr(this.schema,e.plugins),s=n.fields,o=new t(n);for(let r=0;r<s.length;r++){let a=s[r].name;o[a]=this.hasOwnProperty(a)?this[a]:s[r].init(e,o)}return o}toJSON(e){let n={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(n.storedMarks=this.storedMarks.map(s=>s.toJSON())),e&&typeof e=="object")for(let s in e){if(s=="doc"||s=="selection")throw new RangeError("The JSON fields `doc` and `selection` are reserved");let o=e[s],r=o.spec.state;r&&r.toJSON&&(n[s]=r.toJSON.call(o,this[o.key]))}return n}static fromJSON(e,n,s){if(!n)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let o=new yr(e.schema,e.plugins),r=new t(o);return o.fields.forEach(a=>{if(a.name=="doc")r.doc=jt.fromJSON(e.schema,n.doc);else if(a.name=="selection")r.selection=re.fromJSON(r.doc,n.selection);else if(a.name=="storedMarks")n.storedMarks&&(r.storedMarks=n.storedMarks.map(e.schema.markFromJSON));else{if(s)for(let i in s){let l=s[i],c=l.spec.state;if(l.key==a.name&&c&&c.fromJSON&&Object.prototype.hasOwnProperty.call(n,i)){r[a.name]=c.fromJSON.call(l,e,n[i],r);return}}r[a.name]=a.init(e,r)}}),r}};function uh(t,e,n){for(let s in t){let o=t[s];o instanceof Function?o=o.bind(e):s=="handleDOMEvents"&&(o=uh(o,e,{})),n[s]=o}return n}var ae=class{constructor(e){this.spec=e,this.props={},e.props&&uh(e.props,this,this.props),this.key=e.key?e.key.key:ph("plugin")}getState(e){return e[this.key]}},yc=Object.create(null);function ph(t){return t in yc?t+"$"+ ++yc[t]:(yc[t]=0,t+"$")}var pe=class{constructor(e="key"){this.key=ph(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}};var $a=(t,e)=>t.selection.empty?!1:(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function hh(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}var wc=(t,e,n)=>{let s=hh(t,n);if(!s)return!1;let o=Ec(s);if(!o){let a=s.blockRange(),i=a&&Bn(a);return i==null?!1:(e&&e(t.tr.lift(a,i).scrollIntoView()),!0)}let r=o.nodeBefore;if(Eh(t,o,e,-1))return!0;if(s.parent.content.size==0&&(bo(r,"end")||Q.isSelectable(r)))for(let a=s.depth;;a--){let i=gr(t.doc,s.before(a),s.after(a),X.empty);if(i&&i.slice.size<i.to-i.from){if(e){let l=t.tr.step(i);l.setSelection(bo(r,"end")?re.findFrom(l.doc.resolve(l.mapping.map(o.pos,-1)),-1):Q.create(l.doc,o.pos-r.nodeSize)),e(l.scrollIntoView())}return!0}if(a==1||s.node(a-1).childCount>1)break}return r.isAtom&&o.depth==s.depth-1?(e&&e(t.tr.delete(o.pos-r.nodeSize,o.pos).scrollIntoView()),!0):!1},mh=(t,e,n)=>{let s=hh(t,n);if(!s)return!1;let o=Ec(s);return o?yh(t,o,e):!1},gh=(t,e,n)=>{let s=kh(t,n);if(!s)return!1;let o=Dc(s);return o?yh(t,o,e):!1};function yh(t,e,n){let s=e.nodeBefore,o=s,r=e.pos-1;for(;!o.isTextblock;r--){if(o.type.spec.isolating)return!1;let d=o.lastChild;if(!d)return!1;o=d}let a=e.nodeAfter,i=a,l=e.pos+1;for(;!i.isTextblock;l++){if(i.type.spec.isolating)return!1;let d=i.firstChild;if(!d)return!1;i=d}let c=gr(t.doc,r,l,X.empty);if(!c||c.from!=r||c instanceof gt&&c.slice.size>=l-r)return!1;if(n){let d=t.tr.step(c);d.setSelection(te.create(d.doc,r)),n(d.scrollIntoView())}return!0}function bo(t,e,n=!1){for(let s=t;s;s=e=="start"?s.firstChild:s.lastChild){if(s.isTextblock)return!0;if(n&&s.childCount!=1)return!1}return!1}var Sc=(t,e,n)=>{let{$head:s,empty:o}=t.selection,r=s;if(!o)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):s.parentOffset>0)return!1;r=Ec(s)}let a=r&&r.nodeBefore;return!a||!Q.isSelectable(a)?!1:(e&&e(t.tr.setSelection(Q.create(t.doc,r.pos-a.nodeSize)).scrollIntoView()),!0)};function Ec(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function kh(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}var xc=(t,e,n)=>{let s=kh(t,n);if(!s)return!1;let o=Dc(s);if(!o)return!1;let r=o.nodeAfter;if(Eh(t,o,e,1))return!0;if(s.parent.content.size==0&&(bo(r,"start")||Q.isSelectable(r))){let a=gr(t.doc,s.before(),s.after(),X.empty);if(a&&a.slice.size<a.to-a.from){if(e){let i=t.tr.step(a);i.setSelection(bo(r,"start")?re.findFrom(i.doc.resolve(i.mapping.map(o.pos)),1):Q.create(i.doc,i.mapping.map(o.pos))),e(i.scrollIntoView())}return!0}}return r.isAtom&&o.depth==s.depth-1?(e&&e(t.tr.delete(o.pos,o.pos+r.nodeSize).scrollIntoView()),!0):!1},Tc=(t,e,n)=>{let{$head:s,empty:o}=t.selection,r=s;if(!o)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):s.parentOffset<s.parent.content.size)return!1;r=Dc(s)}let a=r&&r.nodeAfter;return!a||!Q.isSelectable(a)?!1:(e&&e(t.tr.setSelection(Q.create(t.doc,r.pos)).scrollIntoView()),!0)};function Dc(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}var bh=(t,e)=>{let n=t.selection,s=n instanceof Q,o;if(s){if(n.node.isTextblock||!Wt(t.doc,n.from))return!1;o=n.from}else if(o=Ps(t.doc,n.from,-1),o==null)return!1;if(e){let r=t.tr.join(o);s&&r.setSelection(Q.create(r.doc,o-t.doc.resolve(o).nodeBefore.nodeSize)),e(r.scrollIntoView())}return!0},vh=(t,e)=>{let n=t.selection,s;if(n instanceof Q){if(n.node.isTextblock||!Wt(t.doc,n.to))return!1;s=n.to}else if(s=Ps(t.doc,n.to,1),s==null)return!1;return e&&e(t.tr.join(s).scrollIntoView()),!0},wh=(t,e)=>{let{$from:n,$to:s}=t.selection,o=n.blockRange(s),r=o&&Bn(o);return r==null?!1:(e&&e(t.tr.lift(o,r).scrollIntoView()),!0)},Ic=(t,e)=>{let{$head:n,$anchor:s}=t.selection;return!n.parent.type.spec.code||!n.sameParent(s)?!1:(e&&e(t.tr.insertText(`
`).scrollIntoView()),!0)};function Cc(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}var Ac=(t,e)=>{let{$head:n,$anchor:s}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(s))return!1;let o=n.node(-1),r=n.indexAfter(-1),a=Cc(o.contentMatchAt(r));if(!a||!o.canReplaceWith(r,r,a))return!1;if(e){let i=n.after(),l=t.tr.replaceWith(i,i,a.createAndFill());l.setSelection(re.near(l.doc.resolve(i),1)),e(l.scrollIntoView())}return!0},Mc=(t,e)=>{let n=t.selection,{$from:s,$to:o}=n;if(n instanceof xt||s.parent.inlineContent||o.parent.inlineContent)return!1;let r=Cc(o.parent.contentMatchAt(o.indexAfter()));if(!r||!r.isTextblock)return!1;if(e){let a=(!s.parentOffset&&o.index()<o.parent.childCount?s:o).pos,i=t.tr.insert(a,r.createAndFill());i.setSelection(te.create(i.doc,a+1)),e(i.scrollIntoView())}return!0},Lc=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if(zt(t.doc,r))return e&&e(t.tr.split(r).scrollIntoView()),!0}let s=n.blockRange(),o=s&&Bn(s);return o==null?!1:(e&&e(t.tr.lift(s,o).scrollIntoView()),!0)};function mw(t){return(e,n)=>{let{$from:s,$to:o}=e.selection;if(e.selection instanceof Q&&e.selection.node.isBlock)return!s.parentOffset||!zt(e.doc,s.pos)?!1:(n&&n(e.tr.split(s.pos).scrollIntoView()),!0);if(!s.depth)return!1;let r=[],a,i,l=!1,c=!1;for(let f=s.depth;;f--)if(s.node(f).isBlock){l=s.end(f)==s.pos+(s.depth-f),c=s.start(f)==s.pos-(s.depth-f),i=Cc(s.node(f-1).contentMatchAt(s.indexAfter(f-1)));let m=t&&t(o.parent,l,s);r.unshift(m||(l&&i?{type:i}:null)),a=f;break}else{if(f==1)return!1;r.unshift(null)}let d=e.tr;(e.selection instanceof te||e.selection instanceof xt)&&d.deleteSelection();let u=d.mapping.map(s.pos),p=zt(d.doc,u,r.length,r);if(p||(r[0]=i?{type:i}:null,p=zt(d.doc,u,r.length,r)),!p)return!1;if(d.split(u,r.length,r),!l&&c&&s.node(a).type!=i){let f=d.mapping.map(s.before(a)),h=d.doc.resolve(f);i&&s.node(a-1).canReplaceWith(h.index(),h.index()+1,i)&&d.setNodeMarkup(d.mapping.map(s.before(a)),i)}return n&&n(d.scrollIntoView()),!0}}var gw=mw();var Sh=(t,e)=>{let{$from:n,to:s}=t.selection,o,r=n.sharedDepth(s);return r==0?!1:(o=n.before(r),e&&e(t.tr.setSelection(Q.create(t.doc,o))),!0)},yw=(t,e)=>(e&&e(t.tr.setSelection(new xt(t.doc))),!0);function kw(t,e,n){let s=e.nodeBefore,o=e.nodeAfter,r=e.index();return!s||!o||!s.type.compatibleContent(o.type)?!1:!s.content.size&&e.parent.canReplace(r-1,r)?(n&&n(t.tr.delete(e.pos-s.nodeSize,e.pos).scrollIntoView()),!0):!e.parent.canReplace(r,r+1)||!(o.isTextblock||Wt(t.doc,e.pos))?!1:(n&&n(t.tr.join(e.pos).scrollIntoView()),!0)}function Eh(t,e,n,s){let o=e.nodeBefore,r=e.nodeAfter,a,i,l=o.type.spec.isolating||r.type.spec.isolating;if(!l&&kw(t,e,n))return!0;let c=!l&&e.parent.canReplace(e.index(),e.index()+1);if(c&&(a=(i=o.contentMatchAt(o.childCount)).findWrapping(r.type))&&i.matchType(a[0]||r.type).validEnd){if(n){let f=e.pos+r.nodeSize,h=O.empty;for(let k=a.length-1;k>=0;k--)h=O.from(a[k].create(null,h));h=O.from(o.copy(h));let m=t.tr.step(new Je(e.pos-1,f,e.pos,f,new X(h,1,0),a.length,!0)),y=m.doc.resolve(f+2*a.length);y.nodeAfter&&y.nodeAfter.type==o.type&&Wt(m.doc,y.pos)&&m.join(y.pos),n(m.scrollIntoView())}return!0}let d=r.type.spec.isolating||s>0&&l?null:re.findFrom(e,1),u=d&&d.$from.blockRange(d.$to),p=u&&Bn(u);if(p!=null&&p>=e.depth)return n&&n(t.tr.lift(u,p).scrollIntoView()),!0;if(c&&bo(r,"start",!0)&&bo(o,"end")){let f=o,h=[];for(;h.push(f),!f.isTextblock;)f=f.lastChild;let m=r,y=1;for(;!m.isTextblock;m=m.firstChild)y++;if(f.canReplace(f.childCount,f.childCount,m.content)){if(n){let k=O.empty;for(let T=h.length-1;T>=0;T--)k=O.from(h[T].copy(k));let S=t.tr.step(new Je(e.pos-h.length,e.pos+r.nodeSize,e.pos+y,e.pos+r.nodeSize-y,new X(k,h.length,0),0,!0));n(S.scrollIntoView())}return!0}}return!1}function xh(t){return function(e,n){let s=e.selection,o=t<0?s.$from:s.$to,r=o.depth;for(;o.node(r).isInline;){if(!r)return!1;r--}return o.node(r).isTextblock?(n&&n(e.tr.setSelection(te.create(e.doc,t<0?o.start(r):o.end(r)))),!0):!1}}var jc=xh(-1),Pc=xh(1);function Th(t,e=null){return function(n,s){let{$from:o,$to:r}=n.selection,a=o.blockRange(r),i=a&&yo(a,t,e);return i?(s&&s(n.tr.wrap(a,i).scrollIntoView()),!0):!1}}function Nc(t,e=null){return function(n,s){let o=!1;for(let r=0;r<n.selection.ranges.length&&!o;r++){let{$from:{pos:a},$to:{pos:i}}=n.selection.ranges[r];n.doc.nodesBetween(a,i,(l,c)=>{if(o)return!1;if(!(!l.isTextblock||l.hasMarkup(t,e)))if(l.type==t)o=!0;else{let d=n.doc.resolve(c),u=d.index();o=d.parent.canReplaceWith(u,u+1,t)}})}if(!o)return!1;if(s){let r=n.tr;for(let a=0;a<n.selection.ranges.length;a++){let{$from:{pos:i},$to:{pos:l}}=n.selection.ranges[a];r.setBlockType(i,l,t,e)}s(r.scrollIntoView())}return!0}}function Bc(...t){return function(e,n,s){for(let o=0;o<t.length;o++)if(t[o](e,n,s))return!0;return!1}}var vc=Bc($a,wc,Sc),fh=Bc($a,xc,Tc),ns={Enter:Bc(Ic,Mc,Lc,gw),"Mod-Enter":Ac,Backspace:vc,"Mod-Backspace":vc,"Shift-Backspace":vc,Delete:fh,"Mod-Delete":fh,"Mod-a":yw},bw={"Ctrl-h":ns.Backspace,"Alt-Backspace":ns["Mod-Backspace"],"Ctrl-d":ns.Delete,"Ctrl-Alt-Backspace":ns["Mod-Delete"],"Alt-Delete":ns["Mod-Delete"],"Alt-d":ns["Mod-Delete"],"Ctrl-a":jc,"Ctrl-e":Pc};for(let t in ns)bw[t]=ns[t];var M1=typeof navigator<"u"?/Mac|iP(hone|[oa]d)/.test(navigator.platform):typeof os<"u"&&os.platform?os.platform()=="darwin":!1;function Dh(t,e=null){return function(n,s){let{$from:o,$to:r}=n.selection,a=o.blockRange(r);if(!a)return!1;let i=s?n.tr:null;return vw(i,a,t,e)?(s&&s(i.scrollIntoView()),!0):!1}}function vw(t,e,n,s=null){let o=!1,r=e,a=e.$from.doc;if(e.depth>=2&&e.$from.node(e.depth-1).type.compatibleContent(n)&&e.startIndex==0){if(e.$from.index(e.depth-1)==0)return!1;let l=a.resolve(e.start-2);r=new Ls(l,l,e.depth),e.endIndex<e.parent.childCount&&(e=new Ls(e.$from,a.resolve(e.$to.end(e.depth)),e.depth)),o=!0}let i=yo(r,n,s,e);return i?(t&&ww(t,e,i,o,n),!0):!1}function ww(t,e,n,s,o){let r=O.empty;for(let d=n.length-1;d>=0;d--)r=O.from(n[d].type.create(n[d].attrs,r));t.step(new Je(e.start-(s?2:0),e.end,e.start,e.end,new X(r,0,0),n.length,!0));let a=0;for(let d=0;d<n.length;d++)n[d].type==o&&(a=d+1);let i=n.length-a,l=e.start+n.length-(s?2:0),c=e.parent;for(let d=e.startIndex,u=e.endIndex,p=!0;d<u;d++,p=!1)!p&&zt(t.doc,l,i)&&(t.split(l,i),l+=2*i),l+=c.child(d).nodeSize;return t}function Ih(t){return function(e,n){let{$from:s,$to:o}=e.selection,r=s.blockRange(o,a=>a.childCount>0&&a.firstChild.type==t);return r?n?s.node(r.depth-1).type==t?Sw(e,n,t,r):Ew(e,n,r):!0:!1}}function Sw(t,e,n,s){let o=t.tr,r=s.end,a=s.$to.end(s.depth);r<a&&(o.step(new Je(r-1,a,r,a,new X(O.from(n.create(null,s.parent.copy())),1,0),1,!0)),s=new Ls(o.doc.resolve(s.$from.pos),o.doc.resolve(a),s.depth));let i=Bn(s);if(i==null)return!1;o.lift(s,i);let l=o.doc.resolve(o.mapping.map(r,-1)-1);return Wt(o.doc,l.pos)&&l.nodeBefore.type==l.nodeAfter.type&&o.join(l.pos),e(o.scrollIntoView()),!0}function Ew(t,e,n){let s=t.tr,o=n.parent;for(let f=n.end,h=n.endIndex-1,m=n.startIndex;h>m;h--)f-=o.child(h).nodeSize,s.delete(f-1,f+1);let r=s.doc.resolve(n.start),a=r.nodeAfter;if(s.mapping.map(n.end)!=n.start+r.nodeAfter.nodeSize)return!1;let i=n.startIndex==0,l=n.endIndex==o.childCount,c=r.node(-1),d=r.index(-1);if(!c.canReplace(d+(i?0:1),d+1,a.content.append(l?O.empty:O.from(o))))return!1;let u=r.pos,p=u+a.nodeSize;return s.step(new Je(u-(i?1:0),p+(l?1:0),u+1,p-1,new X((i?O.empty:O.from(o.copy(O.empty))).append(l?O.empty:O.from(o.copy(O.empty))),i?0:1,l?0:1),i?0:1)),e(s.scrollIntoView()),!0}function Ch(t){return function(e,n){let{$from:s,$to:o}=e.selection,r=s.blockRange(o,c=>c.childCount>0&&c.firstChild.type==t);if(!r)return!1;let a=r.startIndex;if(a==0)return!1;let i=r.parent,l=i.child(a-1);if(l.type!=t)return!1;if(n){let c=l.lastChild&&l.lastChild.type==i.type,d=O.from(c?t.create():null),u=new X(O.from(t.create(null,O.from(i.type.create(null,d)))),c?3:1,0),p=r.start,f=r.end;n(e.tr.step(new Je(p-(c?3:1),f,p,f,u,1,!0)).scrollIntoView())}return!0}}var it=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},xo=function(t){let e=t.assignedSlot||t.parentNode;return e&&e.nodeType==11?e.host:e},Hc=null,Rn=function(t,e,n){let s=Hc||(Hc=document.createRange());return s.setEnd(t,n??t.nodeValue.length),s.setStart(t,e||0),s},xw=function(){Hc=null},Hs=function(t,e,n,s){return n&&(Ah(t,e,n,s,-1)||Ah(t,e,n,s,1))},Tw=/^(img|br|input|textarea|hr)$/i;function Ah(t,e,n,s,o){for(var r;;){if(t==n&&e==s)return!0;if(e==(o<0?0:Jt(t))){let a=t.parentNode;if(!a||a.nodeType!=1||Tr(t)||Tw.test(t.nodeName)||t.contentEditable=="false")return!1;e=it(t)+(o<0?0:1),t=a}else if(t.nodeType==1){let a=t.childNodes[e+(o<0?-1:0)];if(a.nodeType==1&&a.contentEditable=="false")if(!((r=a.pmViewDesc)===null||r===void 0)&&r.ignoreForSelection)e+=o;else return!1;else t=a,e=o<0?Jt(t):0}else return!1}}function Jt(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function Dw(t,e){for(;;){if(t.nodeType==3&&e)return t;if(t.nodeType==1&&e>0){if(t.contentEditable=="false")return null;t=t.childNodes[e-1],e=Jt(t)}else if(t.parentNode&&!Tr(t))e=it(t),t=t.parentNode;else return null}}function Iw(t,e){for(;;){if(t.nodeType==3&&e<t.nodeValue.length)return t;if(t.nodeType==1&&e<t.childNodes.length){if(t.contentEditable=="false")return null;t=t.childNodes[e],e=0}else if(t.parentNode&&!Tr(t))e=it(t)+1,t=t.parentNode;else return null}}function Cw(t,e,n){for(let s=e==0,o=e==Jt(t);s||o;){if(t==n)return!0;let r=it(t);if(t=t.parentNode,!t)return!1;s=s&&r==0,o=o&&r==Jt(t)}}function Tr(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}var Ga=function(t){return t.focusNode&&Hs(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function Bs(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function Aw(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function Mw(t,e,n){if(t.caretPositionFromPoint)try{let s=t.caretPositionFromPoint(e,n);if(s)return{node:s.offsetNode,offset:Math.min(Jt(s.offsetNode),s.offset)}}catch{}if(t.caretRangeFromPoint){let s=t.caretRangeFromPoint(e,n);if(s)return{node:s.startContainer,offset:Math.min(Jt(s.startContainer),s.startOffset)}}}var hn=typeof navigator<"u"?navigator:null,Mh=typeof document<"u"?document:null,cs=hn&&hn.userAgent||"",qc=/Edge\/(\d+)/.exec(cs),lm=/MSIE \d/.exec(cs),Uc=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(cs),Pt=!!(lm||Uc||qc),is=lm?document.documentMode:Uc?+Uc[1]:qc?+qc[1]:0,Gt=!Pt&&/gecko\/(\d+)/i.test(cs);Gt&&+(/Firefox\/(\d+)/.exec(cs)||[0,0])[1];var _c=!Pt&&/Chrome\/(\d+)/.exec(cs),lt=!!_c,cm=_c?+_c[1]:0,kt=!Pt&&!!hn&&/Apple Computer/.test(hn.vendor),To=kt&&(/Mobile\/\w+/.test(cs)||!!hn&&hn.maxTouchPoints>2),Kt=To||(hn?/Mac/.test(hn.platform):!1),dm=hn?/Win/.test(hn.platform):!1,$n=/Android \d/.test(cs),Dr=!!Mh&&"webkitFontSmoothing"in Mh.documentElement.style,Lw=Dr?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function jw(t){let e=t.defaultView&&t.defaultView.visualViewport;return e?{left:0,right:e.width,top:0,bottom:e.height}:{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function On(t,e){return typeof t=="number"?t:t[e]}function Pw(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,s=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*s}}function Lh(t,e,n){let s=t.someProp("scrollThreshold")||0,o=t.someProp("scrollMargin")||5,r=t.dom.ownerDocument;for(let a=n||t.dom;a;){if(a.nodeType!=1){a=xo(a);continue}let i=a,l=i==r.body,c=l?jw(r):Pw(i),d=0,u=0;if(e.top<c.top+On(s,"top")?u=-(c.top-e.top+On(o,"top")):e.bottom>c.bottom-On(s,"bottom")&&(u=e.bottom-e.top>c.bottom-c.top?e.top+On(o,"top")-c.top:e.bottom-c.bottom+On(o,"bottom")),e.left<c.left+On(s,"left")?d=-(c.left-e.left+On(o,"left")):e.right>c.right-On(s,"right")&&(d=e.right-c.right+On(o,"right")),d||u)if(l)r.defaultView.scrollBy(d,u);else{let f=i.scrollLeft,h=i.scrollTop;u&&(i.scrollTop+=u),d&&(i.scrollLeft+=d);let m=i.scrollLeft-f,y=i.scrollTop-h;e={left:e.left-m,top:e.top-y,right:e.right-m,bottom:e.bottom-y}}let p=l?"fixed":getComputedStyle(a).position;if(/^(fixed|sticky)$/.test(p))break;a=p=="absolute"?a.offsetParent:xo(a)}}function Nw(t){let e=t.dom.getBoundingClientRect(),n=Math.max(0,e.top),s,o;for(let r=(e.left+e.right)/2,a=n+1;a<Math.min(innerHeight,e.bottom);a+=5){let i=t.root.elementFromPoint(r,a);if(!i||i==t.dom||!t.dom.contains(i))continue;let l=i.getBoundingClientRect();if(l.top>=n-20){s=i,o=l.top;break}}return{refDOM:s,refTop:o,stack:um(t.dom)}}function um(t){let e=[],n=t.ownerDocument;for(let s=t;s&&(e.push({dom:s,top:s.scrollTop,left:s.scrollLeft}),t!=n);s=xo(s));return e}function Bw({refDOM:t,refTop:e,stack:n}){let s=t?t.getBoundingClientRect().top:0;pm(n,s==0?0:s-e)}function pm(t,e){for(let n=0;n<t.length;n++){let{dom:s,top:o,left:r}=t[n];s.scrollTop!=o+e&&(s.scrollTop=o+e),s.scrollLeft!=r&&(s.scrollLeft=r)}}var vo=null;function Ow(t){if(t.setActive)return t.setActive();if(vo)return t.focus(vo);let e=um(t);t.focus(vo==null?{get preventScroll(){return vo={preventScroll:!0},!0}}:void 0),vo||(vo=!1,pm(e,0))}function fm(t,e){let n,s=2e8,o,r=0,a=e.top,i=e.top,l,c;for(let d=t.firstChild,u=0;d;d=d.nextSibling,u++){let p;if(d.nodeType==1)p=d.getClientRects();else if(d.nodeType==3)p=Rn(d).getClientRects();else continue;for(let f=0;f<p.length;f++){let h=p[f];if(h.top<=a&&h.bottom>=i){a=Math.max(h.bottom,a),i=Math.min(h.top,i);let m=h.left>e.left?h.left-e.left:h.right<e.left?e.left-h.right:0;if(m<s){n=d,s=m,o=m&&n.nodeType==3?{left:h.right<e.left?h.right:h.left,top:e.top}:e,d.nodeType==1&&m&&(r=u+(e.left>=(h.left+h.right)/2?1:0));continue}}else h.top>e.top&&!l&&h.left<=e.left&&h.right>=e.left&&(l=d,c={left:Math.max(h.left,Math.min(h.right,e.left)),top:h.top});!n&&(e.left>=h.right&&e.top>=h.top||e.left>=h.left&&e.top>=h.bottom)&&(r=u+1)}}return!n&&l&&(n=l,o=c,s=0),n&&n.nodeType==3?Rw(n,o):!n||s&&n.nodeType==1?{node:t,offset:r}:fm(n,o)}function Rw(t,e){let n=t.nodeValue.length,s=document.createRange(),o;for(let r=0;r<n;r++){s.setEnd(t,r+1),s.setStart(t,r);let a=ss(s,1);if(a.top!=a.bottom&&rd(e,a)){o={node:t,offset:r+(e.left>=(a.left+a.right)/2?1:0)};break}}return s.detach(),o||{node:t,offset:0}}function rd(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function $w(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function Fw(t,e,n){let{node:s,offset:o}=fm(e,n),r=-1;if(s.nodeType==1&&!s.firstChild){let a=s.getBoundingClientRect();r=a.left!=a.right&&n.left>(a.left+a.right)/2?1:-1}return t.docView.posFromDOM(s,o,r)}function zw(t,e,n,s){let o=-1;for(let r=e,a=!1;r!=t.dom;){let i=t.docView.nearestDesc(r,!0),l;if(!i)return null;if(i.dom.nodeType==1&&(i.node.isBlock&&i.parent||!i.contentDOM)&&((l=i.dom.getBoundingClientRect()).width||l.height)&&(i.node.isBlock&&i.parent&&!/^T(R|BODY|HEAD|FOOT)$/.test(i.dom.nodeName)&&(!a&&l.left>s.left||l.top>s.top?o=i.posBefore:(!a&&l.right<s.left||l.bottom<s.top)&&(o=i.posAfter),a=!0),!i.contentDOM&&o<0&&!i.node.isText))return(i.node.isBlock?s.top<(l.top+l.bottom)/2:s.left<(l.left+l.right)/2)?i.posBefore:i.posAfter;r=i.dom.parentNode}return o>-1?o:t.docView.posFromDOM(e,n,-1)}function hm(t,e,n){let s=t.childNodes.length;if(s&&n.top<n.bottom)for(let o=Math.max(0,Math.min(s-1,Math.floor(s*(e.top-n.top)/(n.bottom-n.top))-2)),r=o;;){let a=t.childNodes[r];if(a.nodeType==1){let i=a.getClientRects();for(let l=0;l<i.length;l++){let c=i[l];if(rd(e,c))return hm(a,e,c)}}if((r=(r+1)%s)==o)break}return t}function Hw(t,e){let n=t.dom.ownerDocument,s,o=0,r=Mw(n,e.left,e.top);r&&({node:s,offset:o}=r);let a=(t.root.elementFromPoint?t.root:n).elementFromPoint(e.left,e.top),i;if(!a||!t.dom.contains(a.nodeType!=1?a.parentNode:a)){let c=t.dom.getBoundingClientRect();if(!rd(e,c)||(a=hm(t.dom,e,c),!a))return null}if(kt)for(let c=a;s&&c;c=xo(c))c.draggable&&(s=void 0);if(a=$w(a,e),s){if(Gt&&s.nodeType==1&&(o=Math.min(o,s.childNodes.length),o<s.childNodes.length)){let d=s.childNodes[o],u;d.nodeName=="IMG"&&(u=d.getBoundingClientRect()).right<=e.left&&u.bottom>e.top&&o++}let c;Dr&&o&&s.nodeType==1&&(c=s.childNodes[o-1]).nodeType==1&&c.contentEditable=="false"&&c.getBoundingClientRect().top>=e.top&&o--,s==t.dom&&o==s.childNodes.length-1&&s.lastChild.nodeType==1&&e.top>s.lastChild.getBoundingClientRect().bottom?i=t.state.doc.content.size:(o==0||s.nodeType!=1||s.childNodes[o-1].nodeName!="BR")&&(i=zw(t,s,o,e))}i==null&&(i=Fw(t,a,e));let l=t.docView.nearestDesc(a,!0);return{pos:i,inside:l?l.posAtStart-l.border:-1}}function jh(t){return t.top<t.bottom||t.left<t.right}function ss(t,e){let n=t.getClientRects();if(n.length){let s=n[e<0?0:n.length-1];if(jh(s))return s}return Array.prototype.find.call(n,jh)||t.getBoundingClientRect()}var qw=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function mm(t,e,n){let{node:s,offset:o,atom:r}=t.docView.domFromPos(e,n<0?-1:1),a=Dr||Gt;if(s.nodeType==3)if(a&&(qw.test(s.nodeValue)||(n<0?!o:o==s.nodeValue.length))){let l=ss(Rn(s,o,o),n);if(Gt&&o&&/\s/.test(s.nodeValue[o-1])&&o<s.nodeValue.length){let c=ss(Rn(s,o-1,o-1),-1);if(c.top==l.top){let d=ss(Rn(s,o,o+1),-1);if(d.top!=l.top)return kr(d,d.left<c.left)}}return l}else{let l=o,c=o,d=n<0?1:-1;return n<0&&!o?(c++,d=-1):n>=0&&o==s.nodeValue.length?(l--,d=1):n<0?l--:c++,kr(ss(Rn(s,l,c),d),d<0)}if(!t.state.doc.resolve(e-(r||0)).parent.inlineContent){if(r==null&&o&&(n<0||o==Jt(s))){let l=s.childNodes[o-1];if(l.nodeType==1)return Oc(l.getBoundingClientRect(),!1)}if(r==null&&o<Jt(s)){let l=s.childNodes[o];if(l.nodeType==1)return Oc(l.getBoundingClientRect(),!0)}return Oc(s.getBoundingClientRect(),n>=0)}if(r==null&&o&&(n<0||o==Jt(s))){let l=s.childNodes[o-1],c=l.nodeType==3?Rn(l,Jt(l)-(a?0:1)):l.nodeType==1&&(l.nodeName!="BR"||!l.nextSibling)?l:null;if(c)return kr(ss(c,1),!1)}if(r==null&&o<Jt(s)){let l=s.childNodes[o];for(;l.pmViewDesc&&l.pmViewDesc.ignoreForCoords;)l=l.nextSibling;let c=l?l.nodeType==3?Rn(l,0,a?0:1):l.nodeType==1?l:null:null;if(c)return kr(ss(c,-1),!0)}return kr(ss(s.nodeType==3?Rn(s):s,-n),n>=0)}function kr(t,e){if(t.width==0)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function Oc(t,e){if(t.height==0)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function gm(t,e,n){let s=t.state,o=t.root.activeElement;s!=e&&t.updateState(e),o!=t.dom&&t.focus();try{return n()}finally{s!=e&&t.updateState(s),o!=t.dom&&o&&o.focus()}}function Uw(t,e,n){let s=e.selection,o=n=="up"?s.$from:s.$to;return gm(t,e,()=>{let{node:r}=t.docView.domFromPos(o.pos,n=="up"?-1:1);for(;;){let i=t.docView.nearestDesc(r,!0);if(!i)break;if(i.node.isBlock){r=i.contentDOM||i.dom;break}r=i.dom.parentNode}let a=mm(t,o.pos,1);for(let i=r.firstChild;i;i=i.nextSibling){let l;if(i.nodeType==1)l=i.getClientRects();else if(i.nodeType==3)l=Rn(i,0,i.nodeValue.length).getClientRects();else continue;for(let c=0;c<l.length;c++){let d=l[c];if(d.bottom>d.top+1&&(n=="up"?a.top-d.top>(d.bottom-a.top)*2:d.bottom-a.bottom>(a.bottom-d.top)*2))return!1}}return!0})}var _w=/[\u0590-\u08ac]/;function Vw(t,e,n){let{$head:s}=e.selection;if(!s.parent.isTextblock)return!1;let o=s.parentOffset,r=!o,a=o==s.parent.content.size,i=t.domSelection();return i?!_w.test(s.parent.textContent)||!i.modify?n=="left"||n=="backward"?r:a:gm(t,e,()=>{let{focusNode:l,focusOffset:c,anchorNode:d,anchorOffset:u}=t.domSelectionRange(),p=i.caretBidiLevel;i.modify("move",n,"character");let f=s.depth?t.docView.domAfterPos(s.before()):t.dom,{focusNode:h,focusOffset:m}=t.domSelectionRange(),y=h&&!f.contains(h.nodeType==1?h:h.parentNode)||l==h&&c==m;try{i.collapse(d,u),l&&(l!=d||c!=u)&&i.extend&&i.extend(l,c)}catch{}return p!=null&&(i.caretBidiLevel=p),y}):s.pos==s.start()||s.pos==s.end()}var Ph=null,Nh=null,Bh=!1;function Ww(t,e,n){return Ph==e&&Nh==n?Bh:(Ph=e,Nh=n,Bh=n=="up"||n=="down"?Uw(t,e,n):Vw(t,e,n))}var Yt=0,Oh=1,Os=2,mn=3,qs=class{constructor(e,n,s,o){this.parent=e,this.children=n,this.dom=s,this.contentDOM=o,this.dirty=Yt,s.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,n,s){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let n=0;n<this.children.length;n++)e+=this.children[n].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let n=0,s=this.posAtStart;;n++){let o=this.children[n];if(o==e)return s;s+=o.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,n,s){if(this.contentDOM&&this.contentDOM.contains(e.nodeType==1?e:e.parentNode))if(s<0){let r,a;if(e==this.contentDOM)r=e.childNodes[n-1];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;r=e.previousSibling}for(;r&&!((a=r.pmViewDesc)&&a.parent==this);)r=r.previousSibling;return r?this.posBeforeChild(a)+a.size:this.posAtStart}else{let r,a;if(e==this.contentDOM)r=e.childNodes[n];else{for(;e.parentNode!=this.contentDOM;)e=e.parentNode;r=e.nextSibling}for(;r&&!((a=r.pmViewDesc)&&a.parent==this);)r=r.nextSibling;return r?this.posBeforeChild(a):this.posAtEnd}let o;if(e==this.dom&&this.contentDOM)o=n>it(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))o=e.compareDocumentPosition(this.contentDOM)&2;else if(this.dom.firstChild){if(n==0)for(let r=e;;r=r.parentNode){if(r==this.dom){o=!1;break}if(r.previousSibling)break}if(o==null&&n==e.childNodes.length)for(let r=e;;r=r.parentNode){if(r==this.dom){o=!0;break}if(r.nextSibling)break}}return o??s>0?this.posAtEnd:this.posAtStart}nearestDesc(e,n=!1){for(let s=!0,o=e;o;o=o.parentNode){let r=this.getDesc(o),a;if(r&&(!n||r.node))if(s&&(a=r.nodeDOM)&&!(a.nodeType==1?a.contains(e.nodeType==1?e:e.parentNode):a==e))s=!1;else return r}}getDesc(e){let n=e.pmViewDesc;for(let s=n;s;s=s.parent)if(s==this)return n}posFromDOM(e,n,s){for(let o=e;o;o=o.parentNode){let r=this.getDesc(o);if(r)return r.localPosFromDOM(e,n,s)}return-1}descAt(e){for(let n=0,s=0;n<this.children.length;n++){let o=this.children[n],r=s+o.size;if(s==e&&r!=s){for(;!o.border&&o.children.length;)for(let a=0;a<o.children.length;a++){let i=o.children[a];if(i.size){o=i;break}}return o}if(e<r)return o.descAt(e-s-o.border);s=r}}domFromPos(e,n){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let s=0,o=0;for(let r=0;s<this.children.length;s++){let a=this.children[s],i=r+a.size;if(i>e||a instanceof Ha){o=e-r;break}r=i}if(o)return this.children[s].domFromPos(o-this.children[s].border,n);for(let r;s&&!(r=this.children[s-1]).size&&r instanceof Fa&&r.side>=0;s--);if(n<=0){let r,a=!0;for(;r=s?this.children[s-1]:null,!(!r||r.dom.parentNode==this.contentDOM);s--,a=!1);return r&&n&&a&&!r.border&&!r.domAtom?r.domFromPos(r.size,n):{node:this.contentDOM,offset:r?it(r.dom)+1:0}}else{let r,a=!0;for(;r=s<this.children.length?this.children[s]:null,!(!r||r.dom.parentNode==this.contentDOM);s++,a=!1);return r&&a&&!r.border&&!r.domAtom?r.domFromPos(0,n):{node:this.contentDOM,offset:r?it(r.dom):this.contentDOM.childNodes.length}}}parseRange(e,n,s=0){if(this.children.length==0)return{node:this.contentDOM,from:e,to:n,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let o=-1,r=-1;for(let a=s,i=0;;i++){let l=this.children[i],c=a+l.size;if(o==-1&&e<=c){let d=a+l.border;if(e>=d&&n<=c-l.border&&l.node&&l.contentDOM&&this.contentDOM.contains(l.contentDOM))return l.parseRange(e,n,d);e=a;for(let u=i;u>0;u--){let p=this.children[u-1];if(p.size&&p.dom.parentNode==this.contentDOM&&!p.emptyChildAt(1)){o=it(p.dom)+1;break}e-=p.size}o==-1&&(o=0)}if(o>-1&&(c>n||i==this.children.length-1)){n=c;for(let d=i+1;d<this.children.length;d++){let u=this.children[d];if(u.size&&u.dom.parentNode==this.contentDOM&&!u.emptyChildAt(-1)){r=it(u.dom);break}n+=u.size}r==-1&&(r=this.contentDOM.childNodes.length);break}a=c}return{node:this.contentDOM,from:e,to:n,fromOffset:o,toOffset:r}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let n=this.children[e<0?0:this.children.length-1];return n.size==0||n.emptyChildAt(e)}domAfterPos(e){let{node:n,offset:s}=this.domFromPos(e,0);if(n.nodeType!=1||s==n.childNodes.length)throw new RangeError("No node after pos "+e);return n.childNodes[s]}setSelection(e,n,s,o=!1){let r=Math.min(e,n),a=Math.max(e,n);for(let f=0,h=0;f<this.children.length;f++){let m=this.children[f],y=h+m.size;if(r>h&&a<y)return m.setSelection(e-h-m.border,n-h-m.border,s,o);h=y}let i=this.domFromPos(e,e?-1:1),l=n==e?i:this.domFromPos(n,n?-1:1),c=s.root.getSelection(),d=s.domSelectionRange(),u=!1;if((Gt||kt)&&e==n){let{node:f,offset:h}=i;if(f.nodeType==3){if(u=!!(h&&f.nodeValue[h-1]==`
`),u&&h==f.nodeValue.length)for(let m=f,y;m;m=m.parentNode){if(y=m.nextSibling){y.nodeName=="BR"&&(i=l={node:y.parentNode,offset:it(y)+1});break}let k=m.pmViewDesc;if(k&&k.node&&k.node.isBlock)break}}else{let m=f.childNodes[h-1];u=m&&(m.nodeName=="BR"||m.contentEditable=="false")}}if(Gt&&d.focusNode&&d.focusNode!=l.node&&d.focusNode.nodeType==1){let f=d.focusNode.childNodes[d.focusOffset];f&&f.contentEditable=="false"&&(o=!0)}if(!(o||u&&kt)&&Hs(i.node,i.offset,d.anchorNode,d.anchorOffset)&&Hs(l.node,l.offset,d.focusNode,d.focusOffset))return;let p=!1;if((c.extend||e==n)&&!(u&&Gt)){c.collapse(i.node,i.offset);try{e!=n&&c.extend(l.node,l.offset),p=!0}catch{}}if(!p){if(e>n){let h=i;i=l,l=h}let f=document.createRange();f.setEnd(l.node,l.offset),f.setStart(i.node,i.offset),c.removeAllRanges(),c.addRange(f)}}ignoreMutation(e){return!this.contentDOM&&e.type!="selection"}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,n){for(let s=0,o=0;o<this.children.length;o++){let r=this.children[o],a=s+r.size;if(s==a?e<=a&&n>=s:e<a&&n>s){let i=s+r.border,l=a-r.border;if(e>=i&&n<=l){this.dirty=e==s||n==a?Os:Oh,e==i&&n==l&&(r.contentLost||r.dom.parentNode!=this.contentDOM)?r.dirty=mn:r.markDirty(e-i,n-i);return}else r.dirty=r.dom==r.contentDOM&&r.dom.parentNode==this.contentDOM&&!r.children.length?Os:mn}s=a}this.dirty=Os}markParentsDirty(){let e=1;for(let n=this.parent;n;n=n.parent,e++){let s=e==1?Os:Oh;n.dirty<s&&(n.dirty=s)}}get domAtom(){return!1}get ignoreForCoords(){return!1}get ignoreForSelection(){return!1}isText(e){return!1}},Fa=class extends qs{constructor(e,n,s,o){let r,a=n.type.toDOM;if(typeof a=="function"&&(a=a(s,()=>{if(!r)return o;if(r.parent)return r.parent.posBeforeChild(r)})),!n.type.spec.raw){if(a.nodeType!=1){let i=document.createElement("span");i.appendChild(a),a=i}a.contentEditable="false",a.classList.add("ProseMirror-widget")}super(e,[],a,null),this.widget=n,this.widget=n,r=this}matchesWidget(e){return this.dirty==Yt&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let n=this.widget.spec.stopEvent;return n?n(e):!1}ignoreMutation(e){return e.type!="selection"||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get ignoreForSelection(){return!!this.widget.type.spec.relaxedSide}get side(){return this.widget.type.side}},Vc=class extends qs{constructor(e,n,s,o){super(e,[],n,null),this.textDOM=s,this.text=o}get size(){return this.text.length}localPosFromDOM(e,n){return e!=this.textDOM?this.posAtStart+(n?this.size:0):this.posAtStart+n}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return e.type==="characterData"&&e.target.nodeValue==e.oldValue}},Do=class t extends qs{constructor(e,n,s,o,r){super(e,[],s,o),this.mark=n,this.spec=r}static create(e,n,s,o){let r=o.nodeViews[n.type.name],a=r&&r(n,o,s);return(!a||!a.dom)&&(a=jn.renderSpec(document,n.type.spec.toDOM(n,s),null,n.attrs)),new t(e,n,a.dom,a.contentDOM||a.dom,a)}parseRule(){return this.dirty&mn||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(e){return this.dirty!=mn&&this.mark.eq(e)}markDirty(e,n){if(super.markDirty(e,n),this.dirty!=Yt){let s=this.parent;for(;!s.node;)s=s.parent;s.dirty<this.dirty&&(s.dirty=this.dirty),this.dirty=Yt}}slice(e,n,s){let o=t.create(this.parent,this.mark,!0,s),r=this.children,a=this.size;n<a&&(r=Gc(r,n,a,s)),e>0&&(r=Gc(r,0,e,s));for(let i=0;i<r.length;i++)r[i].parent=o;return o.children=r,o}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}},ls=class t extends qs{constructor(e,n,s,o,r,a,i,l,c){super(e,[],r,a),this.node=n,this.outerDeco=s,this.innerDeco=o,this.nodeDOM=i}static create(e,n,s,o,r,a){let i=r.nodeViews[n.type.name],l,c=i&&i(n,r,()=>{if(!l)return a;if(l.parent)return l.parent.posBeforeChild(l)},s,o),d=c&&c.dom,u=c&&c.contentDOM;if(n.isText){if(!d)d=document.createTextNode(n.text);else if(d.nodeType!=3)throw new RangeError("Text must be rendered as a DOM text node")}else d||({dom:d,contentDOM:u}=jn.renderSpec(document,n.type.spec.toDOM(n),null,n.attrs));!u&&!n.isText&&d.nodeName!="BR"&&(d.hasAttribute("contenteditable")||(d.contentEditable="false"),n.type.spec.draggable&&(d.draggable=!0));let p=d;return d=bm(d,s,n),c?l=new Wc(e,n,s,o,d,u||null,p,c,r,a+1):n.isText?new za(e,n,s,o,d,p,r):new t(e,n,s,o,d,u||null,p,r,a+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if(this.node.type.whitespace=="pre"&&(e.preserveWhitespace="full"),!this.contentDOM)e.getContent=()=>this.node.content;else if(!this.contentLost)e.contentElement=this.contentDOM;else{for(let n=this.children.length-1;n>=0;n--){let s=this.children[n];if(this.dom.contains(s.dom.parentNode)){e.contentElement=s.dom.parentNode;break}}e.contentElement||(e.getContent=()=>O.empty)}return e}matchesNode(e,n,s){return this.dirty==Yt&&e.eq(this.node)&&qa(n,this.outerDeco)&&s.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,n){let s=this.node.inlineContent,o=n,r=e.composing?this.localCompositionInfo(e,n):null,a=r&&r.pos>-1?r:null,i=r&&r.pos<0,l=new Jc(this,a&&a.node,e);Yw(this.node,this.innerDeco,(c,d,u)=>{c.spec.marks?l.syncToMarks(c.spec.marks,s,e,d):c.type.side>=0&&!u&&l.syncToMarks(d==this.node.childCount?be.none:this.node.child(d).marks,s,e,d),l.placeWidget(c,e,o)},(c,d,u,p)=>{l.syncToMarks(c.marks,s,e,p);let f;l.findNodeMatch(c,d,u,p)||i&&e.state.selection.from>o&&e.state.selection.to<o+c.nodeSize&&(f=l.findIndexWithChild(r.node))>-1&&l.updateNodeAt(c,d,u,f,e)||l.updateNextNode(c,d,u,e,p,o)||l.addNode(c,d,u,e,o),o+=c.nodeSize}),l.syncToMarks([],s,e,0),this.node.isTextblock&&l.addTextblockHacks(),l.destroyRest(),(l.changed||this.dirty==Os)&&(a&&this.protectLocalComposition(e,a),ym(this.contentDOM,this.children,e),To&&Xw(this.dom))}localCompositionInfo(e,n){let{from:s,to:o}=e.state.selection;if(!(e.state.selection instanceof te)||s<n||o>n+this.node.content.size)return null;let r=e.input.compositionNode;if(!r||!this.dom.contains(r.parentNode))return null;if(this.node.inlineContent){let a=r.nodeValue,i=Zw(this.node.content,a,s-n,o-n);return i<0?null:{node:r,pos:i,text:a}}else return{node:r,pos:-1,text:""}}protectLocalComposition(e,{node:n,pos:s,text:o}){if(this.getDesc(n))return;let r=n;for(;r.parentNode!=this.contentDOM;r=r.parentNode){for(;r.previousSibling;)r.parentNode.removeChild(r.previousSibling);for(;r.nextSibling;)r.parentNode.removeChild(r.nextSibling);r.pmViewDesc&&(r.pmViewDesc=void 0)}let a=new Vc(this,r,n,o);e.input.compositionNodes.push(a),this.children=Gc(this.children,s,s+o.length,e,a)}update(e,n,s,o){return this.dirty==mn||!e.sameMarkup(this.node)?!1:(this.updateInner(e,n,s,o),!0)}updateInner(e,n,s,o){this.updateOuterDeco(n),this.node=e,this.innerDeco=s,this.contentDOM&&this.updateChildren(o,this.posAtStart),this.dirty=Yt}updateOuterDeco(e){if(qa(e,this.outerDeco))return;let n=this.nodeDOM.nodeType!=1,s=this.dom;this.dom=km(this.dom,this.nodeDOM,Kc(this.outerDeco,this.node,n),Kc(e,this.node,n)),this.dom!=s&&(s.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.add("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&(this.nodeDOM.draggable=!0))}deselectNode(){this.nodeDOM.nodeType==1&&(this.nodeDOM.classList.remove("ProseMirror-selectednode"),(this.contentDOM||!this.node.type.spec.draggable)&&this.nodeDOM.removeAttribute("draggable"))}get domAtom(){return this.node.isAtom}};function Rh(t,e,n,s,o){bm(s,e,t);let r=new ls(void 0,t,e,n,s,s,s,o,0);return r.contentDOM&&r.updateChildren(o,0),r}var za=class t extends ls{constructor(e,n,s,o,r,a,i){super(e,n,s,o,r,null,a,i,0)}parseRule(){let e=this.nodeDOM.parentNode;for(;e&&e!=this.dom&&!e.pmIsDeco;)e=e.parentNode;return{skip:e||!0}}update(e,n,s,o){return this.dirty==mn||this.dirty!=Yt&&!this.inParent()||!e.sameMarkup(this.node)?!1:(this.updateOuterDeco(n),(this.dirty!=Yt||e.text!=this.node.text)&&e.text!=this.nodeDOM.nodeValue&&(this.nodeDOM.nodeValue=e.text,o.trackWrites==this.nodeDOM&&(o.trackWrites=null)),this.node=e,this.dirty=Yt,!0)}inParent(){let e=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,n,s){return e==this.nodeDOM?this.posAtStart+Math.min(n,this.node.text.length):super.localPosFromDOM(e,n,s)}ignoreMutation(e){return e.type!="characterData"&&e.type!="selection"}slice(e,n,s){let o=this.node.cut(e,n),r=document.createTextNode(o.text);return new t(this.parent,o,this.outerDeco,this.innerDeco,r,r,s)}markDirty(e,n){super.markDirty(e,n),this.dom!=this.nodeDOM&&(e==0||n==this.nodeDOM.nodeValue.length)&&(this.dirty=mn)}get domAtom(){return!1}isText(e){return this.node.text==e}},Ha=class extends qs{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==Yt&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return this.dom.nodeName=="IMG"}},Wc=class extends ls{constructor(e,n,s,o,r,a,i,l,c,d){super(e,n,s,o,r,a,i,c,d),this.spec=l}update(e,n,s,o){if(this.dirty==mn)return!1;if(this.spec.update&&(this.node.type==e.type||this.spec.multiType)){let r=this.spec.update(e,n,s);return r&&this.updateInner(e,n,s,o),r}else return!this.contentDOM&&!e.isLeaf?!1:super.update(e,n,s,o)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,n,s,o){this.spec.setSelection?this.spec.setSelection(e,n,s.root):super.setSelection(e,n,s,o)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return this.spec.stopEvent?this.spec.stopEvent(e):!1}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}};function ym(t,e,n){let s=t.firstChild,o=!1;for(let r=0;r<e.length;r++){let a=e[r],i=a.dom;if(i.parentNode==t){for(;i!=s;)s=$h(s),o=!0;s=s.nextSibling}else o=!0,t.insertBefore(i,s);if(a instanceof Do){let l=s?s.previousSibling:t.lastChild;ym(a.contentDOM,a.children,n),s=l?l.nextSibling:t.firstChild}}for(;s;)s=$h(s),o=!0;o&&n.trackWrites==t&&(n.trackWrites=null)}var br=function(t){t&&(this.nodeName=t)};br.prototype=Object.create(null);var Rs=[new br];function Kc(t,e,n){if(t.length==0)return Rs;let s=n?Rs[0]:new br,o=[s];for(let r=0;r<t.length;r++){let a=t[r].type.attrs;if(a){a.nodeName&&o.push(s=new br(a.nodeName));for(let i in a){let l=a[i];l!=null&&(n&&o.length==1&&o.push(s=new br(e.isInline?"span":"div")),i=="class"?s.class=(s.class?s.class+" ":"")+l:i=="style"?s.style=(s.style?s.style+";":"")+l:i!="nodeName"&&(s[i]=l))}}}return o}function km(t,e,n,s){if(n==Rs&&s==Rs)return e;let o=e;for(let r=0;r<s.length;r++){let a=s[r],i=n[r];if(r){let l;i&&i.nodeName==a.nodeName&&o!=t&&(l=o.parentNode)&&l.nodeName.toLowerCase()==a.nodeName||(l=document.createElement(a.nodeName),l.pmIsDeco=!0,l.appendChild(o),i=Rs[0]),o=l}Kw(o,i||Rs[0],a)}return o}function Kw(t,e,n){for(let s in e)s!="class"&&s!="style"&&s!="nodeName"&&!(s in n)&&t.removeAttribute(s);for(let s in n)s!="class"&&s!="style"&&s!="nodeName"&&n[s]!=e[s]&&t.setAttribute(s,n[s]);if(e.class!=n.class){let s=e.class?e.class.split(" ").filter(Boolean):[],o=n.class?n.class.split(" ").filter(Boolean):[];for(let r=0;r<s.length;r++)o.indexOf(s[r])==-1&&t.classList.remove(s[r]);for(let r=0;r<o.length;r++)s.indexOf(o[r])==-1&&t.classList.add(o[r]);t.classList.length==0&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let s=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g,o;for(;o=s.exec(e.style);)t.style.removeProperty(o[1])}n.style&&(t.style.cssText+=n.style)}}function bm(t,e,n){return km(t,t,Rs,Kc(e,n,t.nodeType!=1))}function qa(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function $h(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}var Jc=class{constructor(e,n,s){this.lock=n,this.view=s,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Jw(e.node.content,e)}destroyBetween(e,n){if(e!=n){for(let s=e;s<n;s++)this.top.children[s].destroy();this.top.children.splice(e,n-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,n,s,o){let r=0,a=this.stack.length>>1,i=Math.min(a,e.length);for(;r<i&&(r==a-1?this.top:this.stack[r+1<<1]).matchesMark(e[r])&&e[r].type.spec.spanning!==!1;)r++;for(;r<a;)this.destroyRest(),this.top.dirty=Yt,this.index=this.stack.pop(),this.top=this.stack.pop(),a--;for(;a<e.length;){this.stack.push(this.top,this.index+1);let l=-1,c=this.top.children.length;o<this.preMatch.index&&(c=Math.min(this.index+3,c));for(let d=this.index;d<c;d++){let u=this.top.children[d];if(u.matchesMark(e[a])&&!this.isLocked(u.dom)){l=d;break}}if(l>-1)l>this.index&&(this.changed=!0,this.destroyBetween(this.index,l)),this.top=this.top.children[this.index];else{let d=Do.create(this.top,e[a],n,s);this.top.children.splice(this.index,0,d),this.top=d,this.changed=!0}this.index=0,a++}}findNodeMatch(e,n,s,o){let r=-1,a;if(o>=this.preMatch.index&&(a=this.preMatch.matches[o-this.preMatch.index]).parent==this.top&&a.matchesNode(e,n,s))r=this.top.children.indexOf(a,this.index);else for(let i=this.index,l=Math.min(this.top.children.length,i+5);i<l;i++){let c=this.top.children[i];if(c.matchesNode(e,n,s)&&!this.preMatch.matched.has(c)){r=i;break}}return r<0?!1:(this.destroyBetween(this.index,r),this.index++,!0)}updateNodeAt(e,n,s,o,r){let a=this.top.children[o];return a.dirty==mn&&a.dom==a.contentDOM&&(a.dirty=Os),a.update(e,n,s,r)?(this.destroyBetween(this.index,o),this.index++,!0):!1}findIndexWithChild(e){for(;;){let n=e.parentNode;if(!n)return-1;if(n==this.top.contentDOM){let s=e.pmViewDesc;if(s){for(let o=this.index;o<this.top.children.length;o++)if(this.top.children[o]==s)return o}return-1}e=n}}updateNextNode(e,n,s,o,r,a){for(let i=this.index;i<this.top.children.length;i++){let l=this.top.children[i];if(l instanceof ls){let c=this.preMatch.matched.get(l);if(c!=null&&c!=r)return!1;let d=l.dom,u,p=this.isLocked(d)&&!(e.isText&&l.node&&l.node.isText&&l.nodeDOM.nodeValue==e.text&&l.dirty!=mn&&qa(n,l.outerDeco));if(!p&&l.update(e,n,s,o))return this.destroyBetween(this.index,i),l.dom!=d&&(this.changed=!0),this.index++,!0;if(!p&&(u=this.recreateWrapper(l,e,n,s,o,a)))return this.destroyBetween(this.index,i),this.top.children[this.index]=u,u.contentDOM&&(u.dirty=Os,u.updateChildren(o,a+1),u.dirty=Yt),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(e,n,s,o,r,a){if(e.dirty||n.isAtom||!e.children.length||!e.node.content.eq(n.content)||!qa(s,e.outerDeco)||!o.eq(e.innerDeco))return null;let i=ls.create(this.top,n,s,o,r,a);if(i.contentDOM){i.children=e.children,e.children=[];for(let l of i.children)l.parent=i}return e.destroy(),i}addNode(e,n,s,o,r){let a=ls.create(this.top,e,n,s,o,r);a.contentDOM&&a.updateChildren(o,r+1),this.top.children.splice(this.index++,0,a),this.changed=!0}placeWidget(e,n,s){let o=this.index<this.top.children.length?this.top.children[this.index]:null;if(o&&o.matchesWidget(e)&&(e==o.widget||!o.widget.type.toDOM.parentNode))this.index++;else{let r=new Fa(this.top,e,n,s);this.top.children.splice(this.index++,0,r),this.changed=!0}}addTextblockHacks(){let e=this.top.children[this.index-1],n=this.top;for(;e instanceof Do;)n=e,e=n.children[n.children.length-1];(!e||!(e instanceof za)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((kt||lt)&&e&&e.dom.contentEditable=="false"&&this.addHackNode("IMG",n),this.addHackNode("BR",this.top))}addHackNode(e,n){if(n==this.top&&this.index<n.children.length&&n.children[this.index].matchesHack(e))this.index++;else{let s=document.createElement(e);e=="IMG"&&(s.className="ProseMirror-separator",s.alt=""),e=="BR"&&(s.className="ProseMirror-trailingBreak");let o=new Ha(this.top,[],s,null);n!=this.top?n.children.push(o):n.children.splice(this.index++,0,o),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||e.nodeType==1&&e.contains(this.lock.parentNode))}};function Jw(t,e){let n=e,s=n.children.length,o=t.childCount,r=new Map,a=[];e:for(;o>0;){let i;for(;;)if(s){let c=n.children[s-1];if(c instanceof Do)n=c,s=c.children.length;else{i=c,s--;break}}else{if(n==e)break e;s=n.parent.children.indexOf(n),n=n.parent}let l=i.node;if(l){if(l!=t.child(o-1))break;--o,r.set(i,o),a.push(i)}}return{index:o,matched:r,matches:a.reverse()}}function Gw(t,e){return t.type.side-e.type.side}function Yw(t,e,n,s){let o=e.locals(t),r=0;if(o.length==0){for(let c=0;c<t.childCount;c++){let d=t.child(c);s(d,o,e.forChild(r,d),c),r+=d.nodeSize}return}let a=0,i=[],l=null;for(let c=0;;){let d,u;for(;a<o.length&&o[a].to==r;){let y=o[a++];y.widget&&(d?(u||(u=[d])).push(y):d=y)}if(d)if(u){u.sort(Gw);for(let y=0;y<u.length;y++)n(u[y],c,!!l)}else n(d,c,!!l);let p,f;if(l)f=-1,p=l,l=null;else if(c<t.childCount)f=c,p=t.child(c++);else break;for(let y=0;y<i.length;y++)i[y].to<=r&&i.splice(y--,1);for(;a<o.length&&o[a].from<=r&&o[a].to>r;)i.push(o[a++]);let h=r+p.nodeSize;if(p.isText){let y=h;a<o.length&&o[a].from<y&&(y=o[a].from);for(let k=0;k<i.length;k++)i[k].to<y&&(y=i[k].to);y<h&&(l=p.cut(y-r),p=p.cut(0,y-r),h=y,f=-1)}else for(;a<o.length&&o[a].to<h;)a++;let m=p.isInline&&!p.isLeaf?i.filter(y=>!y.inline):i.slice();s(p,m,e.forChild(r,p),f),r=h}}function Xw(t){if(t.nodeName=="UL"||t.nodeName=="OL"){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Zw(t,e,n,s){for(let o=0,r=0;o<t.childCount&&r<=s;){let a=t.child(o++),i=r;if(r+=a.nodeSize,!a.isText)continue;let l=a.text;for(;o<t.childCount;){let c=t.child(o++);if(r+=c.nodeSize,!c.isText)break;l+=c.text}if(r>=n){if(r>=s&&l.slice(s-e.length-i,s-i)==e)return s-e.length;let c=i<s?l.lastIndexOf(e,s-i-1):-1;if(c>=0&&c+e.length+i>=n)return i+c;if(n==s&&l.length>=s+e.length-i&&l.slice(s-i,s-i+e.length)==e)return s}}return-1}function Gc(t,e,n,s,o){let r=[];for(let a=0,i=0;a<t.length;a++){let l=t[a],c=i,d=i+=l.size;c>=n||d<=e?r.push(l):(c<e&&r.push(l.slice(0,e-c,s)),o&&(r.push(o),o=void 0),d>n&&r.push(l.slice(n-c,l.size,s)))}return r}function ad(t,e=null){let n=t.domSelectionRange(),s=t.state.doc;if(!n.focusNode)return null;let o=t.docView.nearestDesc(n.focusNode),r=o&&o.size==0,a=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(a<0)return null;let i=s.resolve(a),l,c;if(Ga(n)){for(l=a;o&&!o.node;)o=o.parent;let u=o.node;if(o&&u.isAtom&&Q.isSelectable(u)&&o.parent&&!(u.isInline&&Cw(n.focusNode,n.focusOffset,o.dom))){let p=o.posBefore;c=new Q(a==p?i:s.resolve(p))}}else{if(n instanceof t.dom.ownerDocument.defaultView.Selection&&n.rangeCount>1){let u=a,p=a;for(let f=0;f<n.rangeCount;f++){let h=n.getRangeAt(f);u=Math.min(u,t.docView.posFromDOM(h.startContainer,h.startOffset,1)),p=Math.max(p,t.docView.posFromDOM(h.endContainer,h.endOffset,-1))}if(u<0)return null;[l,a]=p==t.state.selection.anchor?[p,u]:[u,p],i=s.resolve(a)}else l=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(l<0)return null}let d=s.resolve(l);if(!c){let u=e=="pointer"||t.state.selection.head<i.pos&&!r?1:-1;c=id(t,d,i,u)}return c}function vm(t){return t.editable?t.hasFocus():Sm(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Fn(t,e=!1){let n=t.state.selection;if(wm(t,n),!!vm(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&lt){let s=t.domSelectionRange(),o=t.domObserver.currentSelection;if(s.anchorNode&&o.anchorNode&&Hs(s.anchorNode,s.anchorOffset,o.anchorNode,o.anchorOffset)){t.input.mouseDown.delayedSelectionSync=!0,t.domObserver.setCurSelection();return}}if(t.domObserver.disconnectSelection(),t.cursorWrapper)eS(t);else{let{anchor:s,head:o}=n,r,a;Fh&&!(n instanceof te)&&(n.$from.parent.inlineContent||(r=zh(t,n.from)),!n.empty&&!n.$from.parent.inlineContent&&(a=zh(t,n.to))),t.docView.setSelection(s,o,t,e),Fh&&(r&&Hh(r),a&&Hh(a)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Qw(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}var Fh=kt||lt&&cm<63;function zh(t,e){let{node:n,offset:s}=t.docView.domFromPos(e,0),o=s<n.childNodes.length?n.childNodes[s]:null,r=s?n.childNodes[s-1]:null;if(kt&&o&&o.contentEditable=="false")return Rc(o);if((!o||o.contentEditable=="false")&&(!r||r.contentEditable=="false")){if(o)return Rc(o);if(r)return Rc(r)}}function Rc(t){return t.contentEditable="true",kt&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Hh(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Qw(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),s=n.anchorNode,o=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{(n.anchorNode!=s||n.anchorOffset!=o)&&(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout(()=>{(!vm(t)||t.state.selection.visible)&&t.dom.classList.remove("ProseMirror-hideselection")},20))})}function eS(t){let e=t.domSelection();if(!e)return;let n=t.cursorWrapper.dom,s=n.nodeName=="IMG";s?e.collapse(n.parentNode,it(n)+1):e.collapse(n,0),!s&&!t.state.selection.visible&&Pt&&is<=11&&(n.disabled=!0,n.disabled=!1)}function wm(t,e){if(e instanceof Q){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(qh(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else qh(t)}function qh(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function id(t,e,n,s){return t.someProp("createSelectionBetween",o=>o(t,e,n))||te.between(e,n,s)}function Uh(t){return t.editable&&!t.hasFocus()?!1:Sm(t)}function Sm(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(e.anchorNode.nodeType==3?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(e.focusNode.nodeType==3?e.focusNode.parentNode:e.focusNode))}catch{return!1}}function tS(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return Hs(e.node,e.offset,n.anchorNode,n.anchorOffset)}function Yc(t,e){let{$anchor:n,$head:s}=t.selection,o=e>0?n.max(s):n.min(s),r=o.parent.inlineContent?o.depth?t.doc.resolve(e>0?o.after():o.before()):null:o;return r&&re.findFrom(r,e)}function rs(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function _h(t,e,n){let s=t.state.selection;if(s instanceof te)if(n.indexOf("s")>-1){let{$head:o}=s,r=o.textOffset?null:e<0?o.nodeBefore:o.nodeAfter;if(!r||r.isText||!r.isLeaf)return!1;let a=t.state.doc.resolve(o.pos+r.nodeSize*(e<0?-1:1));return rs(t,new te(s.$anchor,a))}else if(s.empty){if(t.endOfTextblock(e>0?"forward":"backward")){let o=Yc(t.state,e);return o&&o instanceof Q?rs(t,o):!1}else if(!(Kt&&n.indexOf("m")>-1)){let o=s.$head,r=o.textOffset?null:e<0?o.nodeBefore:o.nodeAfter,a;if(!r||r.isText)return!1;let i=e<0?o.pos-r.nodeSize:o.pos;return r.isAtom||(a=t.docView.descAt(i))&&!a.contentDOM?Q.isSelectable(r)?rs(t,new Q(e<0?t.state.doc.resolve(o.pos-r.nodeSize):o)):Dr?rs(t,new te(t.state.doc.resolve(e<0?i:i+r.nodeSize))):!1:!1}}else return!1;else{if(s instanceof Q&&s.node.isInline)return rs(t,new te(e>0?s.$to:s.$from));{let o=Yc(t.state,e);return o?rs(t,o):!1}}}function Ua(t){return t.nodeType==3?t.nodeValue.length:t.childNodes.length}function vr(t,e){let n=t.pmViewDesc;return n&&n.size==0&&(e<0||t.nextSibling||t.nodeName!="BR")}function wo(t,e){return e<0?nS(t):sS(t)}function nS(t){let e=t.domSelectionRange(),n=e.focusNode,s=e.focusOffset;if(!n)return;let o,r,a=!1;for(Gt&&n.nodeType==1&&s<Ua(n)&&vr(n.childNodes[s],-1)&&(a=!0);;)if(s>0){if(n.nodeType!=1)break;{let i=n.childNodes[s-1];if(vr(i,-1))o=n,r=--s;else if(i.nodeType==3)n=i,s=n.nodeValue.length;else break}}else{if(Em(n))break;{let i=n.previousSibling;for(;i&&vr(i,-1);)o=n.parentNode,r=it(i),i=i.previousSibling;if(i)n=i,s=Ua(n);else{if(n=n.parentNode,n==t.dom)break;s=0}}}a?Xc(t,n,s):o&&Xc(t,o,r)}function sS(t){let e=t.domSelectionRange(),n=e.focusNode,s=e.focusOffset;if(!n)return;let o=Ua(n),r,a;for(;;)if(s<o){if(n.nodeType!=1)break;let i=n.childNodes[s];if(vr(i,1))r=n,a=++s;else break}else{if(Em(n))break;{let i=n.nextSibling;for(;i&&vr(i,1);)r=i.parentNode,a=it(i)+1,i=i.nextSibling;if(i)n=i,s=0,o=Ua(n);else{if(n=n.parentNode,n==t.dom)break;s=o=0}}}r&&Xc(t,r,a)}function Em(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function oS(t,e){for(;t&&e==t.childNodes.length&&!Tr(t);)e=it(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=0}}function rS(t,e){for(;t&&!e&&!Tr(t);)e=it(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(n.nodeType==3)return n;if(n.nodeType==1&&n.contentEditable=="false")break;t=n,e=t.childNodes.length}}function Xc(t,e,n){if(e.nodeType!=3){let r,a;(a=oS(e,n))?(e=a,n=0):(r=rS(e,n))&&(e=r,n=r.nodeValue.length)}let s=t.domSelection();if(!s)return;if(Ga(s)){let r=document.createRange();r.setEnd(e,n),r.setStart(e,n),s.removeAllRanges(),s.addRange(r)}else s.extend&&s.extend(e,n);t.domObserver.setCurSelection();let{state:o}=t;setTimeout(()=>{t.state==o&&Fn(t)},50)}function Vh(t,e){let n=t.state.doc.resolve(e);if(!(lt||dm)&&n.parent.inlineContent){let o=t.coordsAtPos(e);if(e>n.start()){let r=t.coordsAtPos(e-1),a=(r.top+r.bottom)/2;if(a>o.top&&a<o.bottom&&Math.abs(r.left-o.left)>1)return r.left<o.left?"ltr":"rtl"}if(e<n.end()){let r=t.coordsAtPos(e+1),a=(r.top+r.bottom)/2;if(a>o.top&&a<o.bottom&&Math.abs(r.left-o.left)>1)return r.left>o.left?"ltr":"rtl"}}return getComputedStyle(t.dom).direction=="rtl"?"rtl":"ltr"}function Wh(t,e,n){let s=t.state.selection;if(s instanceof te&&!s.empty||n.indexOf("s")>-1||Kt&&n.indexOf("m")>-1)return!1;let{$from:o,$to:r}=s;if(!o.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let a=Yc(t.state,e);if(a&&a instanceof Q)return rs(t,a)}if(!o.parent.inlineContent){let a=e<0?o:r,i=s instanceof xt?re.near(a,e):re.findFrom(a,e);return i?rs(t,i):!1}return!1}function Kh(t,e){if(!(t.state.selection instanceof te))return!0;let{$head:n,$anchor:s,empty:o}=t.state.selection;if(!n.sameParent(s))return!0;if(!o)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let r=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(r&&!r.isText){let a=t.state.tr;return e<0?a.delete(n.pos-r.nodeSize,n.pos):a.delete(n.pos,n.pos+r.nodeSize),t.dispatch(a),!0}return!1}function Jh(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function aS(t){if(!kt||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&e.nodeType==1&&n==0&&e.firstChild&&e.firstChild.contentEditable=="false"){let s=e.firstChild;Jh(t,s,"true"),setTimeout(()=>Jh(t,s,"false"),20)}return!1}function iS(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function lS(t,e){let n=e.keyCode,s=iS(e);if(n==8||Kt&&n==72&&s=="c")return Kh(t,-1)||wo(t,-1);if(n==46&&!e.shiftKey||Kt&&n==68&&s=="c")return Kh(t,1)||wo(t,1);if(n==13||n==27)return!0;if(n==37||Kt&&n==66&&s=="c"){let o=n==37?Vh(t,t.state.selection.from)=="ltr"?-1:1:-1;return _h(t,o,s)||wo(t,o)}else if(n==39||Kt&&n==70&&s=="c"){let o=n==39?Vh(t,t.state.selection.from)=="ltr"?1:-1:1;return _h(t,o,s)||wo(t,o)}else{if(n==38||Kt&&n==80&&s=="c")return Wh(t,-1,s)||wo(t,-1);if(n==40||Kt&&n==78&&s=="c")return aS(t)||Wh(t,1,s)||wo(t,1);if(s==(Kt?"m":"c")&&(n==66||n==73||n==89||n==90))return!0}return!1}function ld(t,e){t.someProp("transformCopied",f=>{e=f(e,t)});let n=[],{content:s,openStart:o,openEnd:r}=e;for(;o>1&&r>1&&s.childCount==1&&s.firstChild.childCount==1;){o--,r--;let f=s.firstChild;n.push(f.type.name,f.attrs!=f.type.defaultAttrs?f.attrs:null),s=f.content}let a=t.someProp("clipboardSerializer")||jn.fromSchema(t.state.schema),i=Am(),l=i.createElement("div");l.appendChild(a.serializeFragment(s,{document:i}));let c=l.firstChild,d,u=0;for(;c&&c.nodeType==1&&(d=Cm[c.nodeName.toLowerCase()]);){for(let f=d.length-1;f>=0;f--){let h=i.createElement(d[f]);for(;l.firstChild;)h.appendChild(l.firstChild);l.appendChild(h),u++}c=l.firstChild}c&&c.nodeType==1&&c.setAttribute("data-pm-slice",`${o} ${r}${u?` -${u}`:""} ${JSON.stringify(n)}`);let p=t.someProp("clipboardTextSerializer",f=>f(e,t))||e.content.textBetween(0,e.content.size,`

`);return{dom:l,text:p,slice:e}}function xm(t,e,n,s,o){let r=o.parent.type.spec.code,a,i;if(!n&&!e)return null;let l=!!e&&(s||r||!n);if(l){if(t.someProp("transformPastedText",p=>{e=p(e,r||s,t)}),r)return i=new X(O.from(t.state.schema.text(e.replace(/\r\n?/g,`
`))),0,0),t.someProp("transformPasted",p=>{i=p(i,t,!0)}),i;let u=t.someProp("clipboardTextParser",p=>p(e,o,s,t));if(u)i=u;else{let p=o.marks(),{schema:f}=t.state,h=jn.fromSchema(f);a=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach(m=>{let y=a.appendChild(document.createElement("p"));m&&y.appendChild(h.serializeNode(f.text(m,p)))})}}else t.someProp("transformPastedHTML",u=>{n=u(n,t)}),a=pS(n),Dr&&fS(a);let c=a&&a.querySelector("[data-pm-slice]"),d=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(d&&d[3])for(let u=+d[3];u>0;u--){let p=a.firstChild;for(;p&&p.nodeType!=1;)p=p.nextSibling;if(!p)break;a=p}if(i||(i=(t.someProp("clipboardParser")||t.someProp("domParser")||fn.fromSchema(t.state.schema)).parseSlice(a,{preserveWhitespace:!!(l||d),context:o,ruleFromNode(p){return p.nodeName=="BR"&&!p.nextSibling&&p.parentNode&&!cS.test(p.parentNode.nodeName)?{ignore:!0}:null}})),d)i=hS(Gh(i,+d[1],+d[2]),d[4]);else if(i=X.maxOpen(dS(i.content,o),!0),i.openStart||i.openEnd){let u=0,p=0;for(let f=i.content.firstChild;u<i.openStart&&!f.type.spec.isolating;u++,f=f.firstChild);for(let f=i.content.lastChild;p<i.openEnd&&!f.type.spec.isolating;p++,f=f.lastChild);i=Gh(i,u,p)}return t.someProp("transformPasted",u=>{i=u(i,t,l)}),i}var cS=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function dS(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let o=e.node(n).contentMatchAt(e.index(n)),r,a=[];if(t.forEach(i=>{if(!a)return;let l=o.findWrapping(i.type),c;if(!l)return a=null;if(c=a.length&&r.length&&Dm(l,r,i,a[a.length-1],0))a[a.length-1]=c;else{a.length&&(a[a.length-1]=Im(a[a.length-1],r.length));let d=Tm(i,l);a.push(d),o=o.matchType(d.type),r=l}}),a)return O.from(a)}return t}function Tm(t,e,n=0){for(let s=e.length-1;s>=n;s--)t=e[s].create(null,O.from(t));return t}function Dm(t,e,n,s,o){if(o<t.length&&o<e.length&&t[o]==e[o]){let r=Dm(t,e,n,s.lastChild,o+1);if(r)return s.copy(s.content.replaceChild(s.childCount-1,r));if(s.contentMatchAt(s.childCount).matchType(o==t.length-1?n.type:t[o+1]))return s.copy(s.content.append(O.from(Tm(n,t,o+1))))}}function Im(t,e){if(e==0)return t;let n=t.content.replaceChild(t.childCount-1,Im(t.lastChild,e-1)),s=t.contentMatchAt(t.childCount).fillBefore(O.empty,!0);return t.copy(n.append(s))}function Zc(t,e,n,s,o,r){let a=e<0?t.firstChild:t.lastChild,i=a.content;return t.childCount>1&&(r=0),o<s-1&&(i=Zc(i,e,n,s,o+1,r)),o>=n&&(i=e<0?a.contentMatchAt(0).fillBefore(i,r<=o).append(i):i.append(a.contentMatchAt(a.childCount).fillBefore(O.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,a.copy(i))}function Gh(t,e,n){return e<t.openStart&&(t=new X(Zc(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new X(Zc(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}var Cm={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]},Yh=null;function Am(){return Yh||(Yh=document.implementation.createHTMLDocument("title"))}var $c=null;function uS(t){let e=window.trustedTypes;return e?($c||($c=e.defaultPolicy||e.createPolicy("ProseMirrorClipboard",{createHTML:n=>n})),$c.createHTML(t)):t}function pS(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n=Am().createElement("div"),s=/<([a-z][^>\s]+)/i.exec(t),o;if((o=s&&Cm[s[1].toLowerCase()])&&(t=o.map(r=>"<"+r+">").join("")+t+o.map(r=>"</"+r+">").reverse().join("")),n.innerHTML=uS(t),o)for(let r=0;r<o.length;r++)n=n.querySelector(o[r])||n;return n}function fS(t){let e=t.querySelectorAll(lt?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let s=e[n];s.childNodes.length==1&&s.textContent=="\xA0"&&s.parentNode&&s.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),s)}}function hS(t,e){if(!t.size)return t;let n=t.content.firstChild.type.schema,s;try{s=JSON.parse(e)}catch{return t}let{content:o,openStart:r,openEnd:a}=t;for(let i=s.length-2;i>=0;i-=2){let l=n.nodes[s[i]];if(!l||l.hasRequiredAttrs())break;o=O.from(l.create(s[i+1],o)),r++,a++}return new X(o,r,a)}var Tt={},Dt={},mS={touchstart:!0,touchmove:!0},Qc=class{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:"",button:0},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastChromeDelete=0,this.composing=!1,this.compositionNode=null,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.badSafariComposition=!1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}};function gS(t){for(let e in Tt){let n=Tt[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=s=>{kS(t,s)&&!cd(t,s)&&(t.editable||!(s.type in Dt))&&n(t,s)},mS[e]?{passive:!0}:void 0)}kt&&t.dom.addEventListener("input",()=>null),ed(t)}function as(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function yS(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function ed(t){t.someProp("handleDOMEvents",e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=s=>cd(t,s))})}function cd(t,e){return t.someProp("handleDOMEvents",n=>{let s=n[e.type];return s?s(t,e)||e.defaultPrevented:!1})}function kS(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||n.nodeType==11||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function bS(t,e){!cd(t,e)&&Tt[e.type]&&(t.editable||!(e.type in Dt))&&Tt[e.type](t,e)}Dt.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=n.keyCode==16||n.shiftKey,!Lm(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!($n&&lt&&n.keyCode==13)))if(n.keyCode!=229&&t.domObserver.forceFlush(),To&&n.keyCode==13&&!n.ctrlKey&&!n.altKey&&!n.metaKey){let s=Date.now();t.input.lastIOSEnter=s,t.input.lastIOSEnterFallbackTimeout=setTimeout(()=>{t.input.lastIOSEnter==s&&(t.someProp("handleKeyDown",o=>o(t,Bs(13,"Enter"))),t.input.lastIOSEnter=0)},200)}else t.someProp("handleKeyDown",s=>s(t,n))||lS(t,n)?n.preventDefault():as(t,"key")};Dt.keyup=(t,e)=>{e.keyCode==16&&(t.input.shiftKey=!1)};Dt.keypress=(t,e)=>{let n=e;if(Lm(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||Kt&&n.metaKey)return;if(t.someProp("handleKeyPress",o=>o(t,n))){n.preventDefault();return}let s=t.state.selection;if(!(s instanceof te)||!s.$from.sameParent(s.$to)){let o=String.fromCharCode(n.charCode),r=()=>t.state.tr.insertText(o).scrollIntoView();!/[\r\n]/.test(o)&&!t.someProp("handleTextInput",a=>a(t,s.$from.pos,s.$to.pos,o,r))&&t.dispatch(r()),n.preventDefault()}};function Ya(t){return{left:t.clientX,top:t.clientY}}function vS(t,e){let n=e.x-t.clientX,s=e.y-t.clientY;return n*n+s*s<100}function dd(t,e,n,s,o){if(s==-1)return!1;let r=t.state.doc.resolve(s);for(let a=r.depth+1;a>0;a--)if(t.someProp(e,i=>a>r.depth?i(t,n,r.nodeAfter,r.before(a),o,!0):i(t,n,r.node(a),r.before(a),o,!1)))return!0;return!1}function Eo(t,e,n){if(t.focused||t.focus(),t.state.selection.eq(e))return;let s=t.state.tr.setSelection(e);n=="pointer"&&s.setMeta("pointer",!0),t.dispatch(s)}function wS(t,e){if(e==-1)return!1;let n=t.state.doc.resolve(e),s=n.nodeAfter;return s&&s.isAtom&&Q.isSelectable(s)?(Eo(t,new Q(n),"pointer"),!0):!1}function SS(t,e){if(e==-1)return!1;let n=t.state.selection,s,o;n instanceof Q&&(s=n.node);let r=t.state.doc.resolve(e);for(let a=r.depth+1;a>0;a--){let i=a>r.depth?r.nodeAfter:r.node(a);if(Q.isSelectable(i)){s&&n.$from.depth>0&&a>=n.$from.depth&&r.before(n.$from.depth+1)==n.$from.pos?o=r.before(n.$from.depth):o=r.before(a);break}}return o!=null?(Eo(t,Q.create(t.state.doc,o),"pointer"),!0):!1}function ES(t,e,n,s,o){return dd(t,"handleClickOn",e,n,s)||t.someProp("handleClick",r=>r(t,e,s))||(o?SS(t,n):wS(t,n))}function xS(t,e,n,s){return dd(t,"handleDoubleClickOn",e,n,s)||t.someProp("handleDoubleClick",o=>o(t,e,s))}function TS(t,e,n,s){return dd(t,"handleTripleClickOn",e,n,s)||t.someProp("handleTripleClick",o=>o(t,e,s))||DS(t,n,s)}function DS(t,e,n){if(n.button!=0)return!1;let s=t.state.doc;if(e==-1)return s.inlineContent?(Eo(t,te.create(s,0,s.content.size),"pointer"),!0):!1;let o=s.resolve(e);for(let r=o.depth+1;r>0;r--){let a=r>o.depth?o.nodeAfter:o.node(r),i=o.before(r);if(a.inlineContent)Eo(t,te.create(s,i+1,i+1+a.content.size),"pointer");else if(Q.isSelectable(a))Eo(t,Q.create(s,i),"pointer");else continue;return!0}}function ud(t){return _a(t)}var Mm=Kt?"metaKey":"ctrlKey";Tt.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let s=ud(t),o=Date.now(),r="singleClick";o-t.input.lastClick.time<500&&vS(n,t.input.lastClick)&&!n[Mm]&&t.input.lastClick.button==n.button&&(t.input.lastClick.type=="singleClick"?r="doubleClick":t.input.lastClick.type=="doubleClick"&&(r="tripleClick")),t.input.lastClick={time:o,x:n.clientX,y:n.clientY,type:r,button:n.button};let a=t.posAtCoords(Ya(n));a&&(r=="singleClick"?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new td(t,a,n,!!s)):(r=="doubleClick"?xS:TS)(t,a.pos,a.inside,n)?n.preventDefault():as(t,"pointer"))};var td=class{constructor(e,n,s,o){this.view=e,this.pos=n,this.event=s,this.flushed=o,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!s[Mm],this.allowDefault=s.shiftKey;let r,a;if(n.inside>-1)r=e.state.doc.nodeAt(n.inside),a=n.inside;else{let d=e.state.doc.resolve(n.pos);r=d.parent,a=d.depth?d.before():0}let i=o?null:s.target,l=i?e.docView.nearestDesc(i,!0):null;this.target=l&&l.nodeDOM.nodeType==1?l.nodeDOM:null;let{selection:c}=e.state;(s.button==0&&r.type.spec.draggable&&r.type.spec.selectable!==!1||c instanceof Q&&c.from<=a&&c.to>a)&&(this.mightDrag={node:r,pos:a,addAttr:!!(this.target&&!this.target.draggable),setUneditable:!!(this.target&&Gt&&!this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout(()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")},20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),as(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout(()=>Fn(this.view)),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let n=this.pos;this.view.state.doc!=this.startDoc&&(n=this.view.posAtCoords(Ya(e))),this.updateAllowDefault(e),this.allowDefault||!n?as(this.view,"pointer"):ES(this.view,n.pos,n.inside,e,this.selectNode)?e.preventDefault():e.button==0&&(this.flushed||kt&&this.mightDrag&&!this.mightDrag.node.isAtom||lt&&!this.view.state.selection.visible&&Math.min(Math.abs(n.pos-this.view.state.selection.from),Math.abs(n.pos-this.view.state.selection.to))<=2)?(Eo(this.view,re.near(this.view.state.doc.resolve(n.pos)),"pointer"),e.preventDefault()):as(this.view,"pointer")}move(e){this.updateAllowDefault(e),as(this.view,"pointer"),e.buttons==0&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}};Tt.touchstart=t=>{t.input.lastTouch=Date.now(),ud(t),as(t,"pointer")};Tt.touchmove=t=>{t.input.lastTouch=Date.now(),as(t,"pointer")};Tt.contextmenu=t=>ud(t);function Lm(t,e){return t.composing?!0:kt&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500?(t.input.compositionEndedAt=-2e8,!0):!1}var IS=$n?5e3:-1;Dt.compositionstart=Dt.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$to;if(e.selection instanceof te&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some(s=>s.type.spec.inclusive===!1)||lt&&dm&&CS(t)))t.markCursor=t.state.storedMarks||n.marks(),_a(t,!0),t.markCursor=null;else if(_a(t,!e.selection.empty),Gt&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let s=t.domSelectionRange();for(let o=s.focusNode,r=s.focusOffset;o&&o.nodeType==1&&r!=0;){let a=r<0?o.lastChild:o.childNodes[r-1];if(!a)break;if(a.nodeType==3){let i=t.domSelection();i&&i.collapse(a,a.nodeValue.length);break}else o=a,r=-1}}t.input.composing=!0}jm(t,IS)};function CS(t){let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(!e||e.nodeType!=1||n>=e.childNodes.length)return!1;let s=e.childNodes[n];return s.nodeType==1&&s.contentEditable=="false"}Dt.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionNode=null,t.input.badSafariComposition?t.domObserver.forceFlush():t.input.compositionPendingChanges&&Promise.resolve().then(()=>t.domObserver.flush()),t.input.compositionID++,jm(t,20))};function jm(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout(()=>_a(t),e))}function Pm(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=MS());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function AS(t){let e=t.domSelectionRange();if(!e.focusNode)return null;let n=Dw(e.focusNode,e.focusOffset),s=Iw(e.focusNode,e.focusOffset);if(n&&s&&n!=s){let o=s.pmViewDesc,r=t.domObserver.lastChangedTextNode;if(n==r||s==r)return r;if(!o||!o.isText(s.nodeValue))return s;if(t.input.compositionNode==s){let a=n.pmViewDesc;if(!(!a||!a.isText(n.nodeValue)))return s}}return n||s}function MS(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function _a(t,e=!1){if(!($n&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),Pm(t),e||t.docView&&t.docView.dirty){let n=ad(t),s=t.state.selection;return n&&!n.eq(s)?t.dispatch(t.state.tr.setSelection(n)):(t.markCursor||e)&&!s.$from.node(s.$from.sharedDepth(s.to)).inlineContent?t.dispatch(t.state.tr.deleteSelection()):t.updateState(t.state),!0}return!1}}function LS(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let s=getSelection(),o=document.createRange();o.selectNodeContents(e),t.dom.blur(),s.removeAllRanges(),s.addRange(o),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()},50)}var wr=Pt&&is<15||To&&Lw<604;Tt.copy=Dt.cut=(t,e)=>{let n=e,s=t.state.selection,o=n.type=="cut";if(s.empty)return;let r=wr?null:n.clipboardData,a=s.content(),{dom:i,text:l}=ld(t,a);r?(n.preventDefault(),r.clearData(),r.setData("text/html",i.innerHTML),r.setData("text/plain",l)):LS(t,i),o&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))};function jS(t){return t.openStart==0&&t.openEnd==0&&t.content.childCount==1?t.content.firstChild:null}function PS(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,s=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(s.contentEditable="true"),s.style.cssText="position: fixed; left: -10000px; top: 10px",s.focus();let o=t.input.shiftKey&&t.input.lastKeyCode!=45;setTimeout(()=>{t.focus(),s.parentNode&&s.parentNode.removeChild(s),n?Sr(t,s.value,null,o,e):Sr(t,s.textContent,s.innerHTML,o,e)},50)}function Sr(t,e,n,s,o){let r=xm(t,e,n,s,t.state.selection.$from);if(t.someProp("handlePaste",l=>l(t,o,r||X.empty)))return!0;if(!r)return!1;let a=jS(r),i=a?t.state.tr.replaceSelectionWith(a,s):t.state.tr.replaceSelection(r);return t.dispatch(i.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function Nm(t){let e=t.getData("text/plain")||t.getData("Text");if(e)return e;let n=t.getData("text/uri-list");return n?n.replace(/\r?\n/g," "):""}Dt.paste=(t,e)=>{let n=e;if(t.composing&&!$n)return;let s=wr?null:n.clipboardData,o=t.input.shiftKey&&t.input.lastKeyCode!=45;s&&Sr(t,Nm(s),s.getData("text/html"),o,n)?n.preventDefault():PS(t,n)};var Va=class{constructor(e,n,s){this.slice=e,this.move=n,this.node=s}},NS=Kt?"altKey":"ctrlKey";function Bm(t,e){let n=t.someProp("dragCopies",s=>!s(e));return n??!e[NS]}Tt.dragstart=(t,e)=>{let n=e,s=t.input.mouseDown;if(s&&s.done(),!n.dataTransfer)return;let o=t.state.selection,r=o.empty?null:t.posAtCoords(Ya(n)),a;if(!(r&&r.pos>=o.from&&r.pos<=(o instanceof Q?o.to-1:o.to))){if(s&&s.mightDrag)a=Q.create(t.state.doc,s.mightDrag.pos);else if(n.target&&n.target.nodeType==1){let u=t.docView.nearestDesc(n.target,!0);u&&u.node.type.spec.draggable&&u!=t.docView&&(a=Q.create(t.state.doc,u.posBefore))}}let i=(a||t.state.selection).content(),{dom:l,text:c,slice:d}=ld(t,i);(!n.dataTransfer.files.length||!lt||cm>120)&&n.dataTransfer.clearData(),n.dataTransfer.setData(wr?"Text":"text/html",l.innerHTML),n.dataTransfer.effectAllowed="copyMove",wr||n.dataTransfer.setData("text/plain",c),t.dragging=new Va(d,Bm(t,n),a)};Tt.dragend=t=>{let e=t.dragging;window.setTimeout(()=>{t.dragging==e&&(t.dragging=null)},50)};Dt.dragover=Dt.dragenter=(t,e)=>e.preventDefault();Dt.drop=(t,e)=>{try{BS(t,e,t.dragging)}finally{t.dragging=null}};function BS(t,e,n){if(!e.dataTransfer)return;let s=t.posAtCoords(Ya(e));if(!s)return;let o=t.state.doc.resolve(s.pos),r=n&&n.slice;r?t.someProp("transformPasted",f=>{r=f(r,t,!1)}):r=xm(t,Nm(e.dataTransfer),wr?null:e.dataTransfer.getData("text/html"),!1,o);let a=!!(n&&Bm(t,e));if(t.someProp("handleDrop",f=>f(t,e,r||X.empty,a))){e.preventDefault();return}if(!r)return;e.preventDefault();let i=r?Pa(t.state.doc,o.pos,r):o.pos;i==null&&(i=o.pos);let l=t.state.tr;if(a){let{node:f}=n;f?f.replace(l):l.deleteSelection()}let c=l.mapping.map(i),d=r.openStart==0&&r.openEnd==0&&r.content.childCount==1,u=l.doc;if(d?l.replaceRangeWith(c,c,r.content.firstChild):l.replaceRange(c,c,r),l.doc.eq(u))return;let p=l.doc.resolve(c);if(d&&Q.isSelectable(r.content.firstChild)&&p.nodeAfter&&p.nodeAfter.sameMarkup(r.content.firstChild))l.setSelection(new Q(p));else{let f=l.mapping.map(i);l.mapping.maps[l.mapping.maps.length-1].forEach((h,m,y,k)=>f=k),l.setSelection(id(t,p,l.doc.resolve(f)))}t.focus(),t.dispatch(l.setMeta("uiEvent","drop"))}Tt.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout(()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Fn(t)},20))};Tt.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)};Tt.beforeinput=(t,e)=>{if(lt&&$n&&e.inputType=="deleteContentBackward"){t.domObserver.flushSoon();let{domChangeCount:s}=t.input;setTimeout(()=>{if(t.input.domChangeCount!=s||(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",r=>r(t,Bs(8,"Backspace")))))return;let{$cursor:o}=t.state.selection;o&&o.pos>0&&t.dispatch(t.state.tr.delete(o.pos-1,o.pos).scrollIntoView())},50)}};for(let t in Dt)Tt[t]=Dt[t];function Er(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}var Wa=class t{constructor(e,n){this.toDOM=e,this.spec=n||Fs,this.side=this.spec.side||0}map(e,n,s,o){let{pos:r,deleted:a}=e.mapResult(n.from+o,this.side<0?-1:1);return a?null:new bt(r-s,r-s,this)}valid(){return!0}eq(e){return this==e||e instanceof t&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&Er(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}},$s=class t{constructor(e,n){this.attrs=e,this.spec=n||Fs}map(e,n,s,o){let r=e.map(n.from+o,this.spec.inclusiveStart?-1:1)-s,a=e.map(n.to+o,this.spec.inclusiveEnd?1:-1)-s;return r>=a?null:new bt(r,a,this)}valid(e,n){return n.from<n.to}eq(e){return this==e||e instanceof t&&Er(this.attrs,e.attrs)&&Er(this.spec,e.spec)}static is(e){return e.type instanceof t}destroy(){}},nd=class t{constructor(e,n){this.attrs=e,this.spec=n||Fs}map(e,n,s,o){let r=e.mapResult(n.from+o,1);if(r.deleted)return null;let a=e.mapResult(n.to+o,-1);return a.deleted||a.pos<=r.pos?null:new bt(r.pos-s,a.pos-s,this)}valid(e,n){let{index:s,offset:o}=e.content.findIndex(n.from),r;return o==n.from&&!(r=e.child(s)).isText&&o+r.nodeSize==n.to}eq(e){return this==e||e instanceof t&&Er(this.attrs,e.attrs)&&Er(this.spec,e.spec)}destroy(){}},bt=class t{constructor(e,n,s){this.from=e,this.to=n,this.type=s}copy(e,n){return new t(e,n,this.type)}eq(e,n=0){return this.type.eq(e.type)&&this.from+n==e.from&&this.to+n==e.to}map(e,n,s){return this.type.map(e,this,n,s)}static widget(e,n,s){return new t(e,e,new Wa(n,s))}static inline(e,n,s,o){return new t(e,n,new $s(s,o))}static node(e,n,s,o){return new t(e,n,new nd(s,o))}get spec(){return this.type.spec}get inline(){return this.type instanceof $s}get widget(){return this.type instanceof Wa}},So=[],Fs={},We=class t{constructor(e,n){this.local=e.length?e:So,this.children=n.length?n:So}static create(e,n){return n.length?Ja(n,e,0,Fs):yt}find(e,n,s){let o=[];return this.findInner(e??0,n??1e9,o,0,s),o}findInner(e,n,s,o,r){for(let a=0;a<this.local.length;a++){let i=this.local[a];i.from<=n&&i.to>=e&&(!r||r(i.spec))&&s.push(i.copy(i.from+o,i.to+o))}for(let a=0;a<this.children.length;a+=3)if(this.children[a]<n&&this.children[a+1]>e){let i=this.children[a]+1;this.children[a+2].findInner(e-i,n-i,s,o+i,r)}}map(e,n,s){return this==yt||e.maps.length==0?this:this.mapInner(e,n,0,0,s||Fs)}mapInner(e,n,s,o,r){let a;for(let i=0;i<this.local.length;i++){let l=this.local[i].map(e,s,o);l&&l.type.valid(n,l)?(a||(a=[])).push(l):r.onRemove&&r.onRemove(this.local[i].spec)}return this.children.length?OS(this.children,a||[],e,n,s,o,r):a?new t(a.sort(zs),So):yt}add(e,n){return n.length?this==yt?t.create(e,n):this.addInner(e,n,0):this}addInner(e,n,s){let o,r=0;e.forEach((i,l)=>{let c=l+s,d;if(d=Rm(n,i,c)){for(o||(o=this.children.slice());r<o.length&&o[r]<l;)r+=3;o[r]==l?o[r+2]=o[r+2].addInner(i,d,c+1):o.splice(r,0,l,l+i.nodeSize,Ja(d,i,c+1,Fs)),r+=3}});let a=Om(r?$m(n):n,-s);for(let i=0;i<a.length;i++)a[i].type.valid(e,a[i])||a.splice(i--,1);return new t(a.length?this.local.concat(a).sort(zs):this.local,o||this.children)}remove(e){return e.length==0||this==yt?this:this.removeInner(e,0)}removeInner(e,n){let s=this.children,o=this.local;for(let r=0;r<s.length;r+=3){let a,i=s[r]+n,l=s[r+1]+n;for(let d=0,u;d<e.length;d++)(u=e[d])&&u.from>i&&u.to<l&&(e[d]=null,(a||(a=[])).push(u));if(!a)continue;s==this.children&&(s=this.children.slice());let c=s[r+2].removeInner(a,i+1);c!=yt?s[r+2]=c:(s.splice(r,3),r-=3)}if(o.length){for(let r=0,a;r<e.length;r++)if(a=e[r])for(let i=0;i<o.length;i++)o[i].eq(a,n)&&(o==this.local&&(o=this.local.slice()),o.splice(i--,1))}return s==this.children&&o==this.local?this:o.length||s.length?new t(o,s):yt}forChild(e,n){if(this==yt)return this;if(n.isLeaf)return t.empty;let s,o;for(let i=0;i<this.children.length;i+=3)if(this.children[i]>=e){this.children[i]==e&&(s=this.children[i+2]);break}let r=e+1,a=r+n.content.size;for(let i=0;i<this.local.length;i++){let l=this.local[i];if(l.from<a&&l.to>r&&l.type instanceof $s){let c=Math.max(r,l.from)-r,d=Math.min(a,l.to)-r;c<d&&(o||(o=[])).push(l.copy(c,d))}}if(o){let i=new t(o.sort(zs),So);return s?new Ka([i,s]):i}return s||yt}eq(e){if(this==e)return!0;if(!(e instanceof t)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let n=0;n<this.local.length;n++)if(!this.local[n].eq(e.local[n]))return!1;for(let n=0;n<this.children.length;n+=3)if(this.children[n]!=e.children[n]||this.children[n+1]!=e.children[n+1]||!this.children[n+2].eq(e.children[n+2]))return!1;return!0}locals(e){return pd(this.localsInner(e))}localsInner(e){if(this==yt)return So;if(e.inlineContent||!this.local.some($s.is))return this.local;let n=[];for(let s=0;s<this.local.length;s++)this.local[s].type instanceof $s||n.push(this.local[s]);return n}forEachSet(e){e(this)}};We.empty=new We([],[]);We.removeOverlap=pd;var yt=We.empty,Ka=class t{constructor(e){this.members=e}map(e,n){let s=this.members.map(o=>o.map(e,n,Fs));return t.from(s)}forChild(e,n){if(n.isLeaf)return We.empty;let s=[];for(let o=0;o<this.members.length;o++){let r=this.members[o].forChild(e,n);r!=yt&&(r instanceof t?s=s.concat(r.members):s.push(r))}return t.from(s)}eq(e){if(!(e instanceof t)||e.members.length!=this.members.length)return!1;for(let n=0;n<this.members.length;n++)if(!this.members[n].eq(e.members[n]))return!1;return!0}locals(e){let n,s=!0;for(let o=0;o<this.members.length;o++){let r=this.members[o].localsInner(e);if(r.length)if(!n)n=r;else{s&&(n=n.slice(),s=!1);for(let a=0;a<r.length;a++)n.push(r[a])}}return n?pd(s?n:n.sort(zs)):So}static from(e){switch(e.length){case 0:return yt;case 1:return e[0];default:return new t(e.every(n=>n instanceof We)?e:e.reduce((n,s)=>n.concat(s instanceof We?s:s.members),[]))}}forEachSet(e){for(let n=0;n<this.members.length;n++)this.members[n].forEachSet(e)}};function OS(t,e,n,s,o,r,a){let i=t.slice();for(let c=0,d=r;c<n.maps.length;c++){let u=0;n.maps[c].forEach((p,f,h,m)=>{let y=m-h-(f-p);for(let k=0;k<i.length;k+=3){let S=i[k+1];if(S<0||p>S+d-u)continue;let T=i[k]+d-u;f>=T?i[k+1]=p<=T?-2:-1:p>=d&&y&&(i[k]+=y,i[k+1]+=y)}u+=y}),d=n.maps[c].map(d,-1)}let l=!1;for(let c=0;c<i.length;c+=3)if(i[c+1]<0){if(i[c+1]==-2){l=!0,i[c+1]=-1;continue}let d=n.map(t[c]+r),u=d-o;if(u<0||u>=s.content.size){l=!0;continue}let p=n.map(t[c+1]+r,-1),f=p-o,{index:h,offset:m}=s.content.findIndex(u),y=s.maybeChild(h);if(y&&m==u&&m+y.nodeSize==f){let k=i[c+2].mapInner(n,y,d+1,t[c]+r+1,a);k!=yt?(i[c]=u,i[c+1]=f,i[c+2]=k):(i[c+1]=-2,l=!0)}else l=!0}if(l){let c=RS(i,t,e,n,o,r,a),d=Ja(c,s,0,a);e=d.local;for(let u=0;u<i.length;u+=3)i[u+1]<0&&(i.splice(u,3),u-=3);for(let u=0,p=0;u<d.children.length;u+=3){let f=d.children[u];for(;p<i.length&&i[p]<f;)p+=3;i.splice(p,0,d.children[u],d.children[u+1],d.children[u+2])}}return new We(e.sort(zs),i)}function Om(t,e){if(!e||!t.length)return t;let n=[];for(let s=0;s<t.length;s++){let o=t[s];n.push(new bt(o.from+e,o.to+e,o.type))}return n}function RS(t,e,n,s,o,r,a){function i(l,c){for(let d=0;d<l.local.length;d++){let u=l.local[d].map(s,o,c);u?n.push(u):a.onRemove&&a.onRemove(l.local[d].spec)}for(let d=0;d<l.children.length;d+=3)i(l.children[d+2],l.children[d]+c+1)}for(let l=0;l<t.length;l+=3)t[l+1]==-1&&i(t[l+2],e[l]+r+1);return n}function Rm(t,e,n){if(e.isLeaf)return null;let s=n+e.nodeSize,o=null;for(let r=0,a;r<t.length;r++)(a=t[r])&&a.from>n&&a.to<s&&((o||(o=[])).push(a),t[r]=null);return o}function $m(t){let e=[];for(let n=0;n<t.length;n++)t[n]!=null&&e.push(t[n]);return e}function Ja(t,e,n,s){let o=[],r=!1;e.forEach((i,l)=>{let c=Rm(t,i,l+n);if(c){r=!0;let d=Ja(c,i,n+l+1,s);d!=yt&&o.push(l,l+i.nodeSize,d)}});let a=Om(r?$m(t):t,-n).sort(zs);for(let i=0;i<a.length;i++)a[i].type.valid(e,a[i])||(s.onRemove&&s.onRemove(a[i].spec),a.splice(i--,1));return a.length||o.length?new We(a,o):yt}function zs(t,e){return t.from-e.from||t.to-e.to}function pd(t){let e=t;for(let n=0;n<e.length-1;n++){let s=e[n];if(s.from!=s.to)for(let o=n+1;o<e.length;o++){let r=e[o];if(r.from==s.from){r.to!=s.to&&(e==t&&(e=t.slice()),e[o]=r.copy(r.from,s.to),Xh(e,o+1,r.copy(s.to,r.to)));continue}else{r.from<s.to&&(e==t&&(e=t.slice()),e[n]=s.copy(s.from,r.from),Xh(e,o,s.copy(r.from,s.to)));break}}}return e}function Xh(t,e,n){for(;e<t.length&&zs(n,t[e])>0;)e++;t.splice(e,0,n)}function Fc(t){let e=[];return t.someProp("decorations",n=>{let s=n(t.state);s&&s!=yt&&e.push(s)}),t.cursorWrapper&&e.push(We.create(t.state.doc,[t.cursorWrapper.deco])),Ka.from(e)}var $S={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},FS=Pt&&is<=11,sd=class{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}},od=class{constructor(e,n){this.view=e,this.handleDOMChange=n,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new sd,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.lastChangedTextNode=null,this.observer=window.MutationObserver&&new window.MutationObserver(s=>{for(let o=0;o<s.length;o++)this.queue.push(s[o]);Pt&&is<=11&&s.some(o=>o.type=="childList"&&o.removedNodes.length||o.type=="characterData"&&o.oldValue.length>o.target.nodeValue.length)?this.flushSoon():kt&&e.composing&&s.some(o=>o.type=="childList"&&o.target.nodeName=="TR")?(e.input.badSafariComposition=!0,this.flushSoon()):this.flush()}),FS&&(this.onCharData=s=>{this.queue.push({target:s.target,type:"characterData",oldValue:s.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout(()=>{this.flushingSoon=-1,this.flush()},20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,$S)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let n=0;n<e.length;n++)this.queue.push(e[n]);window.setTimeout(()=>this.flush(),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout(()=>this.suppressingSelectionUpdates=!1,50)}onSelectionChange(){if(Uh(this.view)){if(this.suppressingSelectionUpdates)return Fn(this.view);if(Pt&&is<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&Hs(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let n=new Set,s;for(let r=e.focusNode;r;r=xo(r))n.add(r);for(let r=e.anchorNode;r;r=xo(r))if(n.has(r)){s=r;break}let o=s&&this.view.docView.nearestDesc(s);if(o&&o.ignoreMutation({type:"selection",target:s.nodeType==3?s.parentNode:s}))return this.setCurSelection(),!0}pendingRecords(){if(this.observer)for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let n=this.pendingRecords();n.length&&(this.queue=[]);let s=e.domSelectionRange(),o=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(s)&&Uh(e)&&!this.ignoreSelectionChange(s),r=-1,a=-1,i=!1,l=[];if(e.editable)for(let d=0;d<n.length;d++){let u=this.registerMutation(n[d],l);u&&(r=r<0?u.from:Math.min(u.from,r),a=a<0?u.to:Math.max(u.to,a),u.typeOver&&(i=!0))}if(l.some(d=>d.nodeName=="BR")&&(e.input.lastKeyCode==8||e.input.lastKeyCode==46)){for(let d of l)if(d.nodeName=="BR"&&d.parentNode){let u=d.nextSibling;u&&u.nodeType==1&&u.contentEditable=="false"&&d.parentNode.removeChild(d)}}else if(Gt&&l.length){let d=l.filter(u=>u.nodeName=="BR");if(d.length==2){let[u,p]=d;u.parentNode&&u.parentNode.parentNode==p.parentNode?p.remove():u.remove()}else{let{focusNode:u}=this.currentSelection;for(let p of d){let f=p.parentNode;f&&f.nodeName=="LI"&&(!u||qS(e,u)!=f)&&p.remove()}}}let c=null;r<0&&o&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&Ga(s)&&(c=ad(e))&&c.eq(re.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,Fn(e),this.currentSelection.set(s),e.scrollToSelection()):(r>-1||o)&&(r>-1&&(e.docView.markDirty(r,a),zS(e)),e.input.badSafariComposition&&(e.input.badSafariComposition=!1,US(e,l)),this.handleDOMChange(r,a,i,l),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(s)||Fn(e),this.currentSelection.set(s))}registerMutation(e,n){if(n.indexOf(e.target)>-1)return null;let s=this.view.docView.nearestDesc(e.target);if(e.type=="attributes"&&(s==this.view.docView||e.attributeName=="contenteditable"||e.attributeName=="style"&&!e.oldValue&&!e.target.getAttribute("style"))||!s||s.ignoreMutation(e))return null;if(e.type=="childList"){for(let d=0;d<e.addedNodes.length;d++){let u=e.addedNodes[d];n.push(u),u.nodeType==3&&(this.lastChangedTextNode=u)}if(s.contentDOM&&s.contentDOM!=s.dom&&!s.contentDOM.contains(e.target))return{from:s.posBefore,to:s.posAfter};let o=e.previousSibling,r=e.nextSibling;if(Pt&&is<=11&&e.addedNodes.length)for(let d=0;d<e.addedNodes.length;d++){let{previousSibling:u,nextSibling:p}=e.addedNodes[d];(!u||Array.prototype.indexOf.call(e.addedNodes,u)<0)&&(o=u),(!p||Array.prototype.indexOf.call(e.addedNodes,p)<0)&&(r=p)}let a=o&&o.parentNode==e.target?it(o)+1:0,i=s.localPosFromDOM(e.target,a,-1),l=r&&r.parentNode==e.target?it(r):e.target.childNodes.length,c=s.localPosFromDOM(e.target,l,1);return{from:i,to:c}}else return e.type=="attributes"?{from:s.posAtStart-s.border,to:s.posAtEnd+s.border}:(this.lastChangedTextNode=e.target,{from:s.posAtStart,to:s.posAtEnd,typeOver:e.target.nodeValue==e.oldValue})}},Zh=new WeakMap,Qh=!1;function zS(t){if(!Zh.has(t)&&(Zh.set(t,null),["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)!==-1)){if(t.requiresGeckoHackNode=Gt,Qh)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Qh=!0}}function em(t,e){let n=e.startContainer,s=e.startOffset,o=e.endContainer,r=e.endOffset,a=t.domAtPos(t.state.selection.anchor);return Hs(a.node,a.offset,o,r)&&([n,s,o,r]=[o,r,n,s]),{anchorNode:n,anchorOffset:s,focusNode:o,focusOffset:r}}function HS(t,e){if(e.getComposedRanges){let o=e.getComposedRanges(t.root)[0];if(o)return em(t,o)}let n;function s(o){o.preventDefault(),o.stopImmediatePropagation(),n=o.getTargetRanges()[0]}return t.dom.addEventListener("beforeinput",s,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",s,!0),n?em(t,n):null}function qS(t,e){for(let n=e.parentNode;n&&n!=t.dom;n=n.parentNode){let s=t.docView.nearestDesc(n,!0);if(s&&s.node.isBlock)return n}return null}function US(t,e){var n;let{focusNode:s,focusOffset:o}=t.domSelectionRange();for(let r of e)if(((n=r.parentNode)===null||n===void 0?void 0:n.nodeName)=="TR"){let a=r.nextSibling;for(;a&&a.nodeName!="TD"&&a.nodeName!="TH";)a=a.nextSibling;if(a){let i=a;for(;;){let l=i.firstChild;if(!l||l.nodeType!=1||l.contentEditable=="false"||/^(BR|IMG)$/.test(l.nodeName))break;i=l}i.insertBefore(r,i.firstChild),s==r&&t.domSelection().collapse(r,o)}else r.parentNode.removeChild(r)}}function _S(t,e,n){let{node:s,fromOffset:o,toOffset:r,from:a,to:i}=t.docView.parseRange(e,n),l=t.domSelectionRange(),c,d=l.anchorNode;if(d&&t.dom.contains(d.nodeType==1?d:d.parentNode)&&(c=[{node:d,offset:l.anchorOffset}],Ga(l)||c.push({node:l.focusNode,offset:l.focusOffset})),lt&&t.input.lastKeyCode===8)for(let y=r;y>o;y--){let k=s.childNodes[y-1],S=k.pmViewDesc;if(k.nodeName=="BR"&&!S){r=y;break}if(!S||S.size)break}let u=t.state.doc,p=t.someProp("domParser")||fn.fromSchema(t.state.schema),f=u.resolve(a),h=null,m=p.parse(s,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:o,to:r,preserveWhitespace:f.parent.type.whitespace=="pre"?"full":!0,findPositions:c,ruleFromNode:VS,context:f});if(c&&c[0].pos!=null){let y=c[0].pos,k=c[1]&&c[1].pos;k==null&&(k=y),h={anchor:y+a,head:k+a}}return{doc:m,sel:h,from:a,to:i}}function VS(t){let e=t.pmViewDesc;if(e)return e.parseRule();if(t.nodeName=="BR"&&t.parentNode){if(kt&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let n=document.createElement("div");return n.appendChild(document.createElement("li")),{skip:n}}else if(t.parentNode.lastChild==t||kt&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if(t.nodeName=="IMG"&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}var WS=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|img|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function KS(t,e,n,s,o){let r=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let w=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,I=ad(t,w);if(I&&!t.state.selection.eq(I)){if(lt&&$n&&t.input.lastKeyCode===13&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",z=>z(t,Bs(13,"Enter"))))return;let M=t.state.tr.setSelection(I);w=="pointer"?M.setMeta("pointer",!0):w=="key"&&M.scrollIntoView(),r&&M.setMeta("composition",r),t.dispatch(M)}return}let a=t.state.doc.resolve(e),i=a.sharedDepth(n);e=a.before(i+1),n=t.state.doc.resolve(n).after(i+1);let l=t.state.selection,c=_S(t,e,n),d=t.state.doc,u=d.slice(c.from,c.to),p,f;t.input.lastKeyCode===8&&Date.now()-100<t.input.lastKeyCodeTime?(p=t.state.selection.to,f="end"):(p=t.state.selection.from,f="start"),t.input.lastKeyCode=null;let h=YS(u.content,c.doc.content,c.from,p,f);if(h&&t.input.domChangeCount++,(To&&t.input.lastIOSEnter>Date.now()-225||$n)&&o.some(w=>w.nodeType==1&&!WS.test(w.nodeName))&&(!h||h.endA>=h.endB)&&t.someProp("handleKeyDown",w=>w(t,Bs(13,"Enter")))){t.input.lastIOSEnter=0;return}if(!h)if(s&&l instanceof te&&!l.empty&&l.$head.sameParent(l.$anchor)&&!t.composing&&!(c.sel&&c.sel.anchor!=c.sel.head))h={start:l.from,endA:l.to,endB:l.to};else{if(c.sel){let w=tm(t,t.state.doc,c.sel);if(w&&!w.eq(t.state.selection)){let I=t.state.tr.setSelection(w);r&&I.setMeta("composition",r),t.dispatch(I)}}return}t.state.selection.from<t.state.selection.to&&h.start==h.endB&&t.state.selection instanceof te&&(h.start>t.state.selection.from&&h.start<=t.state.selection.from+2&&t.state.selection.from>=c.from?h.start=t.state.selection.from:h.endA<t.state.selection.to&&h.endA>=t.state.selection.to-2&&t.state.selection.to<=c.to&&(h.endB+=t.state.selection.to-h.endA,h.endA=t.state.selection.to)),Pt&&is<=11&&h.endB==h.start+1&&h.endA==h.start&&h.start>c.from&&c.doc.textBetween(h.start-c.from-1,h.start-c.from+1)==" \xA0"&&(h.start--,h.endA--,h.endB--);let m=c.doc.resolveNoCache(h.start-c.from),y=c.doc.resolveNoCache(h.endB-c.from),k=d.resolve(h.start),S=m.sameParent(y)&&m.parent.inlineContent&&k.end()>=h.endA;if((To&&t.input.lastIOSEnter>Date.now()-225&&(!S||o.some(w=>w.nodeName=="DIV"||w.nodeName=="P"))||!S&&m.pos<c.doc.content.size&&(!m.sameParent(y)||!m.parent.inlineContent)&&m.pos<y.pos&&!/\S/.test(c.doc.textBetween(m.pos,y.pos,"","")))&&t.someProp("handleKeyDown",w=>w(t,Bs(13,"Enter")))){t.input.lastIOSEnter=0;return}if(t.state.selection.anchor>h.start&&GS(d,h.start,h.endA,m,y)&&t.someProp("handleKeyDown",w=>w(t,Bs(8,"Backspace")))){$n&&lt&&t.domObserver.suppressSelectionUpdates();return}lt&&h.endB==h.start&&(t.input.lastChromeDelete=Date.now()),$n&&!S&&m.start()!=y.start()&&y.parentOffset==0&&m.depth==y.depth&&c.sel&&c.sel.anchor==c.sel.head&&c.sel.head==h.endA&&(h.endB-=2,y=c.doc.resolveNoCache(h.endB-c.from),setTimeout(()=>{t.someProp("handleKeyDown",function(w){return w(t,Bs(13,"Enter"))})},20));let T=h.start,D=h.endA,E=w=>{let I=w||t.state.tr.replace(T,D,c.doc.slice(h.start-c.from,h.endB-c.from));if(c.sel){let M=tm(t,I.doc,c.sel);M&&!(lt&&t.composing&&M.empty&&(h.start!=h.endB||t.input.lastChromeDelete<Date.now()-100)&&(M.head==T||M.head==I.mapping.map(D)-1)||Pt&&M.empty&&M.head==T)&&I.setSelection(M)}return r&&I.setMeta("composition",r),I.scrollIntoView()},b;if(S)if(m.pos==y.pos){Pt&&is<=11&&m.parentOffset==0&&(t.domObserver.suppressSelectionUpdates(),setTimeout(()=>Fn(t),20));let w=E(t.state.tr.delete(T,D)),I=d.resolve(h.start).marksAcross(d.resolve(h.endA));I&&w.ensureMarks(I),t.dispatch(w)}else if(h.endA==h.endB&&(b=JS(m.parent.content.cut(m.parentOffset,y.parentOffset),k.parent.content.cut(k.parentOffset,h.endA-k.start())))){let w=E(t.state.tr);b.type=="add"?w.addMark(T,D,b.mark):w.removeMark(T,D,b.mark),t.dispatch(w)}else if(m.parent.child(m.index()).isText&&m.index()==y.index()-(y.textOffset?0:1)){let w=m.parent.textBetween(m.parentOffset,y.parentOffset),I=()=>E(t.state.tr.insertText(w,T,D));t.someProp("handleTextInput",M=>M(t,T,D,w,I))||t.dispatch(I())}else t.dispatch(E());else t.dispatch(E())}function tm(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:id(t,e.resolve(n.anchor),e.resolve(n.head))}function JS(t,e){let n=t.firstChild.marks,s=e.firstChild.marks,o=n,r=s,a,i,l;for(let d=0;d<s.length;d++)o=s[d].removeFromSet(o);for(let d=0;d<n.length;d++)r=n[d].removeFromSet(r);if(o.length==1&&r.length==0)i=o[0],a="add",l=d=>d.mark(i.addToSet(d.marks));else if(o.length==0&&r.length==1)i=r[0],a="remove",l=d=>d.mark(i.removeFromSet(d.marks));else return null;let c=[];for(let d=0;d<e.childCount;d++)c.push(l(e.child(d)));if(O.from(c).eq(t))return{mark:i,type:a}}function GS(t,e,n,s,o){if(n-e<=o.pos-s.pos||zc(s,!0,!1)<o.pos)return!1;let r=t.resolve(e);if(!s.parent.isTextblock){let i=r.nodeAfter;return i!=null&&n==e+i.nodeSize}if(r.parentOffset<r.parent.content.size||!r.parent.isTextblock)return!1;let a=t.resolve(zc(r,!0,!0));return!a.parent.isTextblock||a.pos>n||zc(a,!0,!1)<n?!1:s.parent.content.cut(s.parentOffset).eq(a.parent.content)}function zc(t,e,n){let s=t.depth,o=e?t.end():t.pos;for(;s>0&&(e||t.indexAfter(s)==t.node(s).childCount);)s--,o++,e=!1;if(n){let r=t.node(s).maybeChild(t.indexAfter(s));for(;r&&!r.isLeaf;)r=r.firstChild,o++}return o}function YS(t,e,n,s,o){let r=t.findDiffStart(e,n);if(r==null)return null;let{a,b:i}=t.findDiffEnd(e,n+t.size,n+e.size);if(o=="end"){let l=Math.max(0,r-Math.min(a,i));s-=a+l-r}if(a<r&&t.size<e.size){let l=s<=r&&s>=a?r-s:0;r-=l,r&&r<e.size&&nm(e.textBetween(r-1,r+1))&&(r+=l?1:-1),i=r+(i-a),a=r}else if(i<r){let l=s<=r&&s>=i?r-s:0;r-=l,r&&r<t.size&&nm(t.textBetween(r-1,r+1))&&(r+=l?1:-1),a=r+(a-i),i=r}return{start:r,endA:a,endB:i}}function nm(t){if(t.length!=2)return!1;let e=t.charCodeAt(0),n=t.charCodeAt(1);return e>=56320&&e<=57343&&n>=55296&&n<=56319}var xr=class{constructor(e,n){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Qc,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=n,this.state=n.state,this.directPlugins=n.plugins||[],this.directPlugins.forEach(im),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):typeof e=="function"?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=rm(this),om(this),this.nodeViews=am(this),this.docView=Rh(this.state.doc,sm(this),Fc(this),this.dom,this),this.domObserver=new od(this,(s,o,r,a)=>KS(this,s,o,r,a)),this.domObserver.start(),gS(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let n in e)this._props[n]=e[n];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&ed(this);let n=this._props;this._props=e,e.plugins&&(e.plugins.forEach(im),this.directPlugins=e.plugins),this.updateStateInner(e.state,n)}setProps(e){let n={};for(let s in this._props)n[s]=this._props[s];n.state=this.state;for(let s in e)n[s]=e[s];this.update(n)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,n){var s;let o=this.state,r=!1,a=!1;e.storedMarks&&this.composing&&(Pm(this),a=!0),this.state=e;let i=o.plugins!=e.plugins||this._props.plugins!=n.plugins;if(i||this._props.plugins!=n.plugins||this._props.nodeViews!=n.nodeViews){let f=am(this);ZS(f,this.nodeViews)&&(this.nodeViews=f,r=!0)}(i||n.handleDOMEvents!=this._props.handleDOMEvents)&&ed(this),this.editable=rm(this),om(this);let l=Fc(this),c=sm(this),d=o.plugins!=e.plugins&&!o.doc.eq(e.doc)?"reset":e.scrollToSelection>o.scrollToSelection?"to selection":"preserve",u=r||!this.docView.matchesNode(e.doc,c,l);(u||!e.selection.eq(o.selection))&&(a=!0);let p=d=="preserve"&&a&&this.dom.style.overflowAnchor==null&&Nw(this);if(a){this.domObserver.stop();let f=u&&(Pt||lt)&&!this.composing&&!o.selection.empty&&!e.selection.empty&&XS(o.selection,e.selection);if(u){let h=lt?this.trackWrites=this.domSelectionRange().focusNode:null;this.composing&&(this.input.compositionNode=AS(this)),(r||!this.docView.update(e.doc,c,l,this))&&(this.docView.updateOuterDeco(c),this.docView.destroy(),this.docView=Rh(e.doc,c,l,this.dom,this)),h&&(!this.trackWrites||!this.dom.contains(this.trackWrites))&&(f=!0)}f||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&tS(this))?Fn(this,f):(wm(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(o),!((s=this.dragging)===null||s===void 0)&&s.node&&!o.doc.eq(e.doc)&&this.updateDraggedNode(this.dragging,o),d=="reset"?this.dom.scrollTop=0:d=="to selection"?this.scrollToSelection():p&&Bw(p)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(!(!e||!this.dom.contains(e.nodeType==1?e:e.parentNode))){if(!this.someProp("handleScrollToSelection",n=>n(this)))if(this.state.selection instanceof Q){let n=this.docView.domAfterPos(this.state.selection.from);n.nodeType==1&&Lh(this,n.getBoundingClientRect(),e)}else Lh(this,this.coordsAtPos(this.state.selection.head,1),e)}}destroyPluginViews(){let e;for(;e=this.pluginViews.pop();)e.destroy&&e.destroy()}updatePluginViews(e){if(!e||e.plugins!=this.state.plugins||this.directPlugins!=this.prevDirectPlugins){this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let n=0;n<this.directPlugins.length;n++){let s=this.directPlugins[n];s.spec.view&&this.pluginViews.push(s.spec.view(this))}for(let n=0;n<this.state.plugins.length;n++){let s=this.state.plugins[n];s.spec.view&&this.pluginViews.push(s.spec.view(this))}}else for(let n=0;n<this.pluginViews.length;n++){let s=this.pluginViews[n];s.update&&s.update(this,e)}}updateDraggedNode(e,n){let s=e.node,o=-1;if(this.state.doc.nodeAt(s.from)==s.node)o=s.from;else{let r=s.from+(this.state.doc.content.size-n.doc.content.size);(r>0&&this.state.doc.nodeAt(r))==s.node&&(o=r)}this.dragging=new Va(e.slice,e.move,o<0?void 0:Q.create(this.state.doc,o))}someProp(e,n){let s=this._props&&this._props[e],o;if(s!=null&&(o=n?n(s):s))return o;for(let a=0;a<this.directPlugins.length;a++){let i=this.directPlugins[a].props[e];if(i!=null&&(o=n?n(i):i))return o}let r=this.state.plugins;if(r)for(let a=0;a<r.length;a++){let i=r[a].props[e];if(i!=null&&(o=n?n(i):i))return o}}hasFocus(){if(Pt){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;for(;e&&this.dom!=e&&this.dom.contains(e);){if(e.contentEditable=="false")return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&Ow(this.dom),Fn(this),this.domObserver.start()}get root(){let e=this._root;if(e==null){for(let n=this.dom.parentNode;n;n=n.parentNode)if(n.nodeType==9||n.nodeType==11&&n.host)return n.getSelection||(Object.getPrototypeOf(n).getSelection=()=>n.ownerDocument.getSelection()),this._root=n}return e||document}updateRoot(){this._root=null}posAtCoords(e){return Hw(this,e)}coordsAtPos(e,n=1){return mm(this,e,n)}domAtPos(e,n=0){return this.docView.domFromPos(e,n)}nodeDOM(e){let n=this.docView.descAt(e);return n?n.nodeDOM:null}posAtDOM(e,n,s=-1){let o=this.docView.posFromDOM(e,n,s);if(o==null)throw new RangeError("DOM position not inside the editor");return o}endOfTextblock(e,n){return Ww(this,n||this.state,e)}pasteHTML(e,n){return Sr(this,"",e,!1,n||new ClipboardEvent("paste"))}pasteText(e,n){return Sr(this,e,null,!0,n||new ClipboardEvent("paste"))}serializeForClipboard(e){return ld(this,e)}destroy(){this.docView&&(yS(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Fc(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,xw())}get isDestroyed(){return this.docView==null}dispatchEvent(e){return bS(this,e)}domSelectionRange(){let e=this.domSelection();return e?kt&&this.root.nodeType===11&&Aw(this.dom.ownerDocument)==this.dom&&HS(this,e)||e:{focusNode:null,focusOffset:0,anchorNode:null,anchorOffset:0}}domSelection(){return this.root.getSelection()}};xr.prototype.dispatch=function(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))};function sm(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",n=>{if(typeof n=="function"&&(n=n(t.state)),n)for(let s in n)s=="class"?e.class+=" "+n[s]:s=="style"?e.style=(e.style?e.style+";":"")+n[s]:!e[s]&&s!="contenteditable"&&s!="nodeName"&&(e[s]=String(n[s]))}),e.translate||(e.translate="no"),[bt.node(0,t.state.doc.content.size,e)]}function om(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:bt.widget(t.state.selection.from,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function rm(t){return!t.someProp("editable",e=>e(t.state)===!1)}function XS(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function am(t){let e=Object.create(null);function n(s){for(let o in s)Object.prototype.hasOwnProperty.call(e,o)||(e[o]=s[o])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function ZS(t,e){let n=0,s=0;for(let o in t){if(t[o]!=e[o])return!0;n++}for(let o in e)s++;return n!=s}function im(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}var zn={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Za={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},QS=typeof navigator<"u"&&/Mac/.test(navigator.platform),e0=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(Ge=0;Ge<10;Ge++)zn[48+Ge]=zn[96+Ge]=String(Ge);var Ge;for(Ge=1;Ge<=24;Ge++)zn[Ge+111]="F"+Ge;var Ge;for(Ge=65;Ge<=90;Ge++)zn[Ge]=String.fromCharCode(Ge+32),Za[Ge]=String.fromCharCode(Ge);var Ge;for(Xa in zn)Za.hasOwnProperty(Xa)||(Za[Xa]=zn[Xa]);var Xa;function Fm(t){var e=QS&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||e0&&t.shiftKey&&t.key&&t.key.length==1||t.key=="Unidentified",n=!e&&t.key||(t.shiftKey?Za:zn)[t.keyCode]||t.key||"Unidentified";return n=="Esc"&&(n="Escape"),n=="Del"&&(n="Delete"),n=="Left"&&(n="ArrowLeft"),n=="Up"&&(n="ArrowUp"),n=="Right"&&(n="ArrowRight"),n=="Down"&&(n="ArrowDown"),n}var t0=typeof navigator<"u"&&/Mac|iP(hone|[oa]d)/.test(navigator.platform),n0=typeof navigator<"u"&&/Win/.test(navigator.platform);function s0(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n=="Space"&&(n=" ");let s,o,r,a;for(let i=0;i<e.length-1;i++){let l=e[i];if(/^(cmd|meta|m)$/i.test(l))a=!0;else if(/^a(lt)?$/i.test(l))s=!0;else if(/^(c|ctrl|control)$/i.test(l))o=!0;else if(/^s(hift)?$/i.test(l))r=!0;else if(/^mod$/i.test(l))t0?a=!0:o=!0;else throw new Error("Unrecognized modifier name: "+l)}return s&&(n="Alt-"+n),o&&(n="Ctrl-"+n),a&&(n="Meta-"+n),r&&(n="Shift-"+n),n}function o0(t){let e=Object.create(null);for(let n in t)e[s0(n)]=t[n];return e}function fd(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function zm(t){return new ae({props:{handleKeyDown:hd(t)}})}function hd(t){let e=o0(t);return function(n,s){let o=Fm(s),r,a=e[fd(o,s)];if(a&&a(n.state,n.dispatch,n))return!0;if(o.length==1&&o!=" "){if(s.shiftKey){let i=e[fd(o,s,!1)];if(i&&i(n.state,n.dispatch,n))return!0}if((s.altKey||s.metaKey||s.ctrlKey)&&!(n0&&s.ctrlKey&&s.altKey)&&(r=zn[s.keyCode])&&r!=o){let i=e[fd(r,s)];if(i&&i(n.state,n.dispatch,n))return!0}}return!1}}var r0=Object.defineProperty,bd=(t,e)=>{for(var n in e)r0(t,n,{get:e[n],enumerable:!0})};function li(t){let{state:e,transaction:n}=t,{selection:s}=n,{doc:o}=n,{storedMarks:r}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return r},get selection(){return s},get doc(){return o},get tr(){return s=n.selection,o=n.doc,r=n.storedMarks,n}}}var ci=class{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){let{rawCommands:t,editor:e,state:n}=this,{view:s}=e,{tr:o}=n,r=this.buildProps(o);return Object.fromEntries(Object.entries(t).map(([a,i])=>[a,(...c)=>{let d=i(...c)(r);return!o.getMeta("preventDispatch")&&!this.hasCustomState&&s.dispatch(o),d}]))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){let{rawCommands:n,editor:s,state:o}=this,{view:r}=s,a=[],i=!!t,l=t||o.tr,c=()=>(!i&&e&&!l.getMeta("preventDispatch")&&!this.hasCustomState&&r.dispatch(l),a.every(u=>u===!0)),d={...Object.fromEntries(Object.entries(n).map(([u,p])=>[u,(...h)=>{let m=this.buildProps(l,e),y=p(...h)(m);return a.push(y),d}])),run:c};return d}createCan(t){let{rawCommands:e,state:n}=this,s=!1,o=t||n.tr,r=this.buildProps(o,s);return{...Object.fromEntries(Object.entries(e).map(([i,l])=>[i,(...c)=>l(...c)({...r,dispatch:void 0})])),chain:()=>this.createChain(o,s)}}buildProps(t,e=!0){let{rawCommands:n,editor:s,state:o}=this,{view:r}=s,a={tr:t,editor:s,view:r,state:li({state:o,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t,e),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map(([i,l])=>[i,(...c)=>l(...c)(a)]))}};return a}},Ym={};bd(Ym,{blur:()=>a0,clearContent:()=>i0,clearNodes:()=>l0,command:()=>c0,createParagraphNear:()=>d0,cut:()=>u0,deleteCurrentNode:()=>p0,deleteNode:()=>f0,deleteRange:()=>h0,deleteSelection:()=>m0,enter:()=>g0,exitCode:()=>y0,extendMarkRange:()=>k0,first:()=>b0,focus:()=>w0,forEach:()=>S0,insertContent:()=>E0,insertContentAt:()=>D0,joinBackward:()=>A0,joinDown:()=>C0,joinForward:()=>M0,joinItemBackward:()=>L0,joinItemForward:()=>j0,joinTextblockBackward:()=>P0,joinTextblockForward:()=>N0,joinUp:()=>I0,keyboardShortcut:()=>O0,lift:()=>R0,liftEmptyBlock:()=>$0,liftListItem:()=>F0,newlineInCode:()=>z0,resetAttributes:()=>H0,scrollIntoView:()=>q0,selectAll:()=>U0,selectNodeBackward:()=>_0,selectNodeForward:()=>V0,selectParentNode:()=>W0,selectTextblockEnd:()=>K0,selectTextblockStart:()=>J0,setContent:()=>G0,setMark:()=>uE,setMeta:()=>pE,setNode:()=>fE,setNodeSelection:()=>hE,setTextDirection:()=>mE,setTextSelection:()=>gE,sinkListItem:()=>yE,splitBlock:()=>kE,splitListItem:()=>bE,toggleList:()=>vE,toggleMark:()=>wE,toggleNode:()=>SE,toggleWrap:()=>EE,undoInputRule:()=>xE,unsetAllMarks:()=>TE,unsetMark:()=>DE,unsetTextDirection:()=>IE,updateAttributes:()=>CE,wrapIn:()=>AE,wrapInList:()=>ME});var a0=()=>({editor:t,view:e})=>(requestAnimationFrame(()=>{var n;t.isDestroyed||(e.dom.blur(),(n=window?.getSelection())==null||n.removeAllRanges())}),!0),i0=(t=!0)=>({commands:e})=>e.setContent("",{emitUpdate:t}),l0=()=>({state:t,tr:e,dispatch:n})=>{let{selection:s}=e,{ranges:o}=s;return n&&o.forEach(({$from:r,$to:a})=>{t.doc.nodesBetween(r.pos,a.pos,(i,l)=>{if(i.type.isText)return;let{doc:c,mapping:d}=e,u=c.resolve(d.map(l)),p=c.resolve(d.map(l+i.nodeSize)),f=u.blockRange(p);if(!f)return;let h=Bn(f);if(i.type.isTextblock){let{defaultType:m}=u.parent.contentMatchAt(u.index());e.setNodeMarkup(f.start,m)}(h||h===0)&&e.lift(f,h)})}),!0},c0=t=>e=>t(e),d0=()=>({state:t,dispatch:e})=>Mc(t,e),u0=(t,e)=>({editor:n,tr:s})=>{let{state:o}=n,r=o.doc.slice(t.from,t.to);s.deleteRange(t.from,t.to);let a=s.mapping.map(e);return s.insert(a,r.content),s.setSelection(new te(s.doc.resolve(Math.max(a-1,0)))),!0},p0=()=>({tr:t,dispatch:e})=>{let{selection:n}=t,s=n.$anchor.node();if(s.content.size>0)return!1;let o=t.selection.$anchor;for(let r=o.depth;r>0;r-=1)if(o.node(r).type===s.type){if(e){let i=o.before(r),l=o.after(r);t.delete(i,l).scrollIntoView()}return!0}return!1};function ze(t,e){if(typeof t=="string"){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}var f0=t=>({tr:e,state:n,dispatch:s})=>{let o=ze(t,n.schema),r=e.selection.$anchor;for(let a=r.depth;a>0;a-=1)if(r.node(a).type===o){if(s){let l=r.before(a),c=r.after(a);e.delete(l,c).scrollIntoView()}return!0}return!1},h0=t=>({tr:e,dispatch:n})=>{let{from:s,to:o}=t;return n&&e.delete(s,o),!0},m0=()=>({state:t,dispatch:e})=>$a(t,e),g0=()=>({commands:t})=>t.keyboardShortcut("Enter"),y0=()=>({state:t,dispatch:e})=>Ac(t,e);function vd(t){return Object.prototype.toString.call(t)==="[object RegExp]"}function ri(t,e,n={strict:!0}){let s=Object.keys(e);return s.length?s.every(o=>n.strict?e[o]===t[o]:vd(e[o])?e[o].test(t[o]):e[o]===t[o]):!0}function Xm(t,e,n={}){return t.find(s=>s.type===e&&ri(Object.fromEntries(Object.keys(n).map(o=>[o,s.attrs[o]])),n))}function Hm(t,e,n={}){return!!Xm(t,e,n)}function wd(t,e,n){var s;if(!t||!e)return;let o=t.parent.childAfter(t.parentOffset);if((!o.node||!o.node.marks.some(d=>d.type===e))&&(o=t.parent.childBefore(t.parentOffset)),!o.node||!o.node.marks.some(d=>d.type===e)||(n=n||((s=o.node.marks[0])==null?void 0:s.attrs),!Xm([...o.node.marks],e,n)))return;let a=o.index,i=t.start()+o.offset,l=a+1,c=i+o.node.nodeSize;for(;a>0&&Hm([...t.parent.child(a-1).marks],e,n);)a-=1,i-=t.parent.child(a).nodeSize;for(;l<t.parent.childCount&&Hm([...t.parent.child(l).marks],e,n);)c+=t.parent.child(l).nodeSize,l+=1;return{from:i,to:c}}function Hn(t,e){if(typeof t=="string"){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}var k0=(t,e={})=>({tr:n,state:s,dispatch:o})=>{let r=Hn(t,s.schema),{doc:a,selection:i}=n,{$from:l,from:c,to:d}=i;if(o){let u=wd(l,r,e);if(u&&u.from<=c&&u.to>=d){let p=te.create(a,u.from,u.to);n.setSelection(p)}}return!0},b0=t=>e=>{let n=typeof t=="function"?t(e):t;for(let s=0;s<n.length;s+=1)if(n[s](e))return!0;return!1};function Zm(t){return t instanceof te}function Us(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function Qm(t,e=null){if(!e)return null;let n=re.atStart(t),s=re.atEnd(t);if(e==="start"||e===!0)return n;if(e==="end")return s;let o=n.from,r=s.to;return e==="all"?te.create(t,Us(0,o,r),Us(t.content.size,o,r)):te.create(t,Us(e,o,r),Us(e,o,r))}function qm(){return navigator.platform==="Android"||/android/i.test(navigator.userAgent)}function ai(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}function v0(){return typeof navigator<"u"?/^((?!chrome|android).)*safari/i.test(navigator.userAgent):!1}var w0=(t=null,e={})=>({editor:n,view:s,tr:o,dispatch:r})=>{e={scrollIntoView:!0,...e};let a=()=>{(ai()||qm())&&s.dom.focus(),v0()&&!ai()&&!qm()&&s.dom.focus({preventScroll:!0}),requestAnimationFrame(()=>{n.isDestroyed||(s.focus(),e?.scrollIntoView&&n.commands.scrollIntoView())})};try{if(s.hasFocus()&&t===null||t===!1)return!0}catch{return!1}if(r&&t===null&&!Zm(n.state.selection))return a(),!0;let i=Qm(o.doc,t)||n.state.selection,l=n.state.selection.eq(i);return r&&(l||o.setSelection(i),l&&o.storedMarks&&o.setStoredMarks(o.storedMarks),a()),!0},S0=(t,e)=>n=>t.every((s,o)=>e(s,{...n,index:o})),E0=(t,e)=>({tr:n,commands:s})=>s.insertContentAt({from:n.selection.from,to:n.selection.to},t,e),eg=t=>{let e=t.childNodes;for(let n=e.length-1;n>=0;n-=1){let s=e[n];s.nodeType===3&&s.nodeValue&&/^(\n\s\s|\n)$/.test(s.nodeValue)?t.removeChild(s):s.nodeType===1&&eg(s)}return t};function Qa(t){if(typeof window>"u")throw new Error("[tiptap error]: there is no window object available, so this function cannot be used");let e=`<body>${t}</body>`,n=new window.DOMParser().parseFromString(e,"text/html").body;return eg(n)}function Cr(t,e,n){if(t instanceof jt||t instanceof O)return t;n={slice:!0,parseOptions:{},...n};let s=typeof t=="object"&&t!==null,o=typeof t=="string";if(s)try{if(Array.isArray(t)&&t.length>0)return O.fromArray(t.map(i=>e.nodeFromJSON(i)));let a=e.nodeFromJSON(t);return n.errorOnInvalidContent&&a.check(),a}catch(r){if(n.errorOnInvalidContent)throw new Error("[tiptap error]: Invalid JSON content",{cause:r});return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",r),Cr("",e,n)}if(o){if(n.errorOnInvalidContent){let a=!1,i="",l=new fo({topNode:e.spec.topNode,marks:e.spec.marks,nodes:e.spec.nodes.append({__tiptap__private__unknown__catch__all__node:{content:"inline*",group:"block",parseDOM:[{tag:"*",getAttrs:c=>(a=!0,i=typeof c=="string"?c:c.outerHTML,null)}]}})});if(n.slice?fn.fromSchema(l).parseSlice(Qa(t),n.parseOptions):fn.fromSchema(l).parse(Qa(t),n.parseOptions),n.errorOnInvalidContent&&a)throw new Error("[tiptap error]: Invalid HTML content",{cause:new Error(`Invalid element found: ${i}`)})}let r=fn.fromSchema(e);return n.slice?r.parseSlice(Qa(t),n.parseOptions).content:r.parse(Qa(t),n.parseOptions)}return Cr("",e,n)}function x0(t,e,n){let s=t.steps.length-1;if(s<e)return;let o=t.steps[s];if(!(o instanceof gt||o instanceof Je))return;let r=t.mapping.maps[s],a=0;r.forEach((i,l,c,d)=>{a===0&&(a=d)}),t.setSelection(re.near(t.doc.resolve(a),n))}var T0=t=>!("type"in t),D0=(t,e,n)=>({tr:s,dispatch:o,editor:r})=>{var a;if(o){n={parseOptions:r.options.parseOptions,updateSelection:!0,applyInputRules:!1,applyPasteRules:!1,...n};let i,l=y=>{r.emit("contentError",{editor:r,error:y,disableCollaboration:()=>{"collaboration"in r.storage&&typeof r.storage.collaboration=="object"&&r.storage.collaboration&&(r.storage.collaboration.isDisabled=!0)}})},c={preserveWhitespace:"full",...n.parseOptions};if(!n.errorOnInvalidContent&&!r.options.enableContentCheck&&r.options.emitContentError)try{Cr(e,r.schema,{parseOptions:c,errorOnInvalidContent:!0})}catch(y){l(y)}try{i=Cr(e,r.schema,{parseOptions:c,errorOnInvalidContent:(a=n.errorOnInvalidContent)!=null?a:r.options.enableContentCheck})}catch(y){return l(y),!1}let{from:d,to:u}=typeof t=="number"?{from:t,to:t}:{from:t.from,to:t.to},p=!0,f=!0;if((T0(i)?i:[i]).forEach(y=>{y.check(),p=p?y.isText&&y.marks.length===0:!1,f=f?y.isBlock:!1}),d===u&&f){let{parent:y}=s.doc.resolve(d);y.isTextblock&&!y.type.spec.code&&!y.childCount&&(d-=1,u+=1)}let m;if(p){if(Array.isArray(e))m=e.map(y=>y.text||"").join("");else if(e instanceof O){let y="";e.forEach(k=>{k.text&&(y+=k.text)}),m=y}else typeof e=="object"&&e&&e.text?m=e.text:m=e;s.insertText(m,d,u)}else{m=i;let y=s.doc.resolve(d),k=y.node(),S=y.parentOffset===0,T=k.isText||k.isTextblock,D=k.content.size>0;S&&T&&D&&(d=Math.max(0,d-1)),s.replaceWith(d,u,m)}n.updateSelection&&x0(s,s.steps.length-1,-1),n.applyInputRules&&s.setMeta("applyInputRules",{from:d,text:m}),n.applyPasteRules&&s.setMeta("applyPasteRules",{from:d,text:m})}return!0},I0=()=>({state:t,dispatch:e})=>bh(t,e),C0=()=>({state:t,dispatch:e})=>vh(t,e),A0=()=>({state:t,dispatch:e})=>wc(t,e),M0=()=>({state:t,dispatch:e})=>xc(t,e),L0=()=>({state:t,dispatch:e,tr:n})=>{try{let s=Ps(t.doc,t.selection.$from.pos,-1);return s==null?!1:(n.join(s,2),e&&e(n),!0)}catch{return!1}},j0=()=>({state:t,dispatch:e,tr:n})=>{try{let s=Ps(t.doc,t.selection.$from.pos,1);return s==null?!1:(n.join(s,2),e&&e(n),!0)}catch{return!1}},P0=()=>({state:t,dispatch:e})=>mh(t,e),N0=()=>({state:t,dispatch:e})=>gh(t,e);function tg(){return typeof navigator<"u"?/Mac/.test(navigator.platform):!1}function B0(t){let e=t.split(/-(?!$)/),n=e[e.length-1];n==="Space"&&(n=" ");let s,o,r,a;for(let i=0;i<e.length-1;i+=1){let l=e[i];if(/^(cmd|meta|m)$/i.test(l))a=!0;else if(/^a(lt)?$/i.test(l))s=!0;else if(/^(c|ctrl|control)$/i.test(l))o=!0;else if(/^s(hift)?$/i.test(l))r=!0;else if(/^mod$/i.test(l))ai()||tg()?a=!0:o=!0;else throw new Error(`Unrecognized modifier name: ${l}`)}return s&&(n=`Alt-${n}`),o&&(n=`Ctrl-${n}`),a&&(n=`Meta-${n}`),r&&(n=`Shift-${n}`),n}var O0=t=>({editor:e,view:n,tr:s,dispatch:o})=>{let r=B0(t).split(/-(?!$)/),a=r.find(c=>!["Alt","Ctrl","Meta","Shift"].includes(c)),i=new KeyboardEvent("keydown",{key:a==="Space"?" ":a,altKey:r.includes("Alt"),ctrlKey:r.includes("Ctrl"),metaKey:r.includes("Meta"),shiftKey:r.includes("Shift"),bubbles:!0,cancelable:!0}),l=e.captureTransaction(()=>{n.someProp("handleKeyDown",c=>c(n,i))});return l?.steps.forEach(c=>{let d=c.map(s.mapping);d&&o&&s.maybeStep(d)}),!0};function gn(t,e,n={}){let{from:s,to:o,empty:r}=t.selection,a=e?ze(e,t.schema):null,i=[];t.doc.nodesBetween(s,o,(u,p)=>{if(u.isText)return;let f=Math.max(s,p),h=Math.min(o,p+u.nodeSize);i.push({node:u,from:f,to:h})});let l=o-s,c=i.filter(u=>a?a.name===u.node.type.name:!0).filter(u=>ri(u.node.attrs,n,{strict:!1}));return r?!!c.length:c.reduce((u,p)=>u+p.to-p.from,0)>=l}var R0=(t,e={})=>({state:n,dispatch:s})=>{let o=ze(t,n.schema);return gn(n,o,e)?wh(n,s):!1},$0=()=>({state:t,dispatch:e})=>Lc(t,e),F0=t=>({state:e,dispatch:n})=>{let s=ze(t,e.schema);return Ih(s)(e,n)},z0=()=>({state:t,dispatch:e})=>Ic(t,e);function di(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function Um(t,e){let n=typeof e=="string"?[e]:e;return Object.keys(t).reduce((s,o)=>(n.includes(o)||(s[o]=t[o]),s),{})}var H0=(t,e)=>({tr:n,state:s,dispatch:o})=>{let r=null,a=null,i=di(typeof t=="string"?t:t.name,s.schema);if(!i)return!1;i==="node"&&(r=ze(t,s.schema)),i==="mark"&&(a=Hn(t,s.schema));let l=!1;return n.selection.ranges.forEach(c=>{s.doc.nodesBetween(c.$from.pos,c.$to.pos,(d,u)=>{r&&r===d.type&&(l=!0,o&&n.setNodeMarkup(u,void 0,Um(d.attrs,e))),a&&d.marks.length&&d.marks.forEach(p=>{a===p.type&&(l=!0,o&&n.addMark(u,u+d.nodeSize,a.create(Um(p.attrs,e))))})})}),l},q0=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),U0=()=>({tr:t,dispatch:e})=>{if(e){let n=new xt(t.doc);t.setSelection(n)}return!0},_0=()=>({state:t,dispatch:e})=>Sc(t,e),V0=()=>({state:t,dispatch:e})=>Tc(t,e),W0=()=>({state:t,dispatch:e})=>Sh(t,e),K0=()=>({state:t,dispatch:e})=>Pc(t,e),J0=()=>({state:t,dispatch:e})=>jc(t,e);function yd(t,e,n={},s={}){return Cr(t,e,{slice:!1,parseOptions:n,errorOnInvalidContent:s.errorOnInvalidContent})}var G0=(t,{errorOnInvalidContent:e,emitUpdate:n=!0,parseOptions:s={}}={})=>({editor:o,tr:r,dispatch:a,commands:i})=>{let{doc:l}=r;if(s.preserveWhitespace!=="full"){let c=yd(t,o.schema,s,{errorOnInvalidContent:e??o.options.enableContentCheck});return a&&r.replaceWith(0,l.content.size,c).setMeta("preventUpdate",!n),!0}return a&&r.setMeta("preventUpdate",!n),i.insertContentAt({from:0,to:l.content.size},t,{parseOptions:s,errorOnInvalidContent:e??o.options.enableContentCheck})};function ng(t,e){let n=Hn(e,t.schema),{from:s,to:o,empty:r}=t.selection,a=[];r?(t.storedMarks&&a.push(...t.storedMarks),a.push(...t.selection.$head.marks())):t.doc.nodesBetween(s,o,l=>{a.push(...l.marks)});let i=a.find(l=>l.type.name===n.name);return i?{...i.attrs}:{}}function Sd(t,e){let n=new go(t);return e.forEach(s=>{s.steps.forEach(o=>{n.step(o)})}),n}function Y0(t){for(let e=0;e<t.edgeCount;e+=1){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function sg(t,e,n){let s=[];return t.nodesBetween(e.from,e.to,(o,r)=>{n(o)&&s.push({node:o,pos:r})}),s}function X0(t,e){for(let n=t.depth;n>0;n-=1){let s=t.node(n);if(e(s))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:s}}}function ui(t){return e=>X0(e.$from,t)}function ee(t,e,n){return t.config[e]===void 0&&t.parent?ee(t.parent,e,n):typeof t.config[e]=="function"?t.config[e].bind({...n,parent:t.parent?ee(t.parent,e,n):null}):t.config[e]}function Ed(t){return t.map(e=>{let n={name:e.name,options:e.options,storage:e.storage},s=ee(e,"addExtensions",n);return s?[e,...Ed(s())]:e}).flat(10)}function xd(t,e){let n=jn.fromSchema(e).serializeFragment(t),o=document.implementation.createHTMLDocument().createElement("div");return o.appendChild(n),o.innerHTML}function og(t){return typeof t=="function"}function Se(t,e=void 0,...n){return og(t)?e?t.bind(e)(...n):t(...n):t}function Z0(t={}){return Object.keys(t).length===0&&t.constructor===Object}function Io(t){let e=t.filter(o=>o.type==="extension"),n=t.filter(o=>o.type==="node"),s=t.filter(o=>o.type==="mark");return{baseExtensions:e,nodeExtensions:n,markExtensions:s}}function rg(t){let e=[],{nodeExtensions:n,markExtensions:s}=Io(t),o=[...n,...s],r={default:null,validate:void 0,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach(a=>{let i={name:a.name,options:a.options,storage:a.storage,extensions:o},l=ee(a,"addGlobalAttributes",i);if(!l)return;l().forEach(d=>{d.types.forEach(u=>{Object.entries(d.attributes).forEach(([p,f])=>{e.push({type:u,name:p,attribute:{...r,...f}})})})})}),o.forEach(a=>{let i={name:a.name,options:a.options,storage:a.storage},l=ee(a,"addAttributes",i);if(!l)return;let c=l();Object.entries(c).forEach(([d,u])=>{let p={...r,...u};typeof p?.default=="function"&&(p.default=p.default()),p?.isRequired&&p?.default===void 0&&delete p.default,e.push({type:a.name,name:d,attribute:p})})}),e}function fe(...t){return t.filter(e=>!!e).reduce((e,n)=>{let s={...e};return Object.entries(n).forEach(([o,r])=>{if(!s[o]){s[o]=r;return}if(o==="class"){let i=r?String(r).split(" "):[],l=s[o]?s[o].split(" "):[],c=i.filter(d=>!l.includes(d));s[o]=[...l,...c].join(" ")}else if(o==="style"){let i=r?r.split(";").map(d=>d.trim()).filter(Boolean):[],l=s[o]?s[o].split(";").map(d=>d.trim()).filter(Boolean):[],c=new Map;l.forEach(d=>{let[u,p]=d.split(":").map(f=>f.trim());c.set(u,p)}),i.forEach(d=>{let[u,p]=d.split(":").map(f=>f.trim());c.set(u,p)}),s[o]=Array.from(c.entries()).map(([d,u])=>`${d}: ${u}`).join("; ")}else s[o]=r}),s},{})}function Co(t,e){return e.filter(n=>n.type===t.type.name).filter(n=>n.attribute.rendered).map(n=>n.attribute.renderHTML?n.attribute.renderHTML(t.attrs)||{}:{[n.name]:t.attrs[n.name]}).reduce((n,s)=>fe(n,s),{})}function Q0(t){return typeof t!="string"?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):t==="true"?!0:t==="false"?!1:t}function _m(t,e){return"style"in t?t:{...t,getAttrs:n=>{let s=t.getAttrs?t.getAttrs(n):t.attrs;if(s===!1)return!1;let o=e.reduce((r,a)=>{let i=a.attribute.parseHTML?a.attribute.parseHTML(n):Q0(n.getAttribute(a.name));return i==null?r:{...r,[a.name]:i}},{});return{...s,...o}}}}function Vm(t){return Object.fromEntries(Object.entries(t).filter(([e,n])=>e==="attrs"&&Z0(n)?!1:n!=null))}function Wm(t){var e,n;let s={};return!((e=t?.attribute)!=null&&e.isRequired)&&"default"in(t?.attribute||{})&&(s.default=t.attribute.default),((n=t?.attribute)==null?void 0:n.validate)!==void 0&&(s.validate=t.attribute.validate),[t.name,s]}function eE(t,e){var n;let s=rg(t),{nodeExtensions:o,markExtensions:r}=Io(t),a=(n=o.find(c=>ee(c,"topNode")))==null?void 0:n.name,i=Object.fromEntries(o.map(c=>{let d=s.filter(k=>k.type===c.name),u={name:c.name,options:c.options,storage:c.storage,editor:e},p=t.reduce((k,S)=>{let T=ee(S,"extendNodeSchema",u);return{...k,...T?T(c):{}}},{}),f=Vm({...p,content:Se(ee(c,"content",u)),marks:Se(ee(c,"marks",u)),group:Se(ee(c,"group",u)),inline:Se(ee(c,"inline",u)),atom:Se(ee(c,"atom",u)),selectable:Se(ee(c,"selectable",u)),draggable:Se(ee(c,"draggable",u)),code:Se(ee(c,"code",u)),whitespace:Se(ee(c,"whitespace",u)),linebreakReplacement:Se(ee(c,"linebreakReplacement",u)),defining:Se(ee(c,"defining",u)),isolating:Se(ee(c,"isolating",u)),attrs:Object.fromEntries(d.map(Wm))}),h=Se(ee(c,"parseHTML",u));h&&(f.parseDOM=h.map(k=>_m(k,d)));let m=ee(c,"renderHTML",u);m&&(f.toDOM=k=>m({node:k,HTMLAttributes:Co(k,d)}));let y=ee(c,"renderText",u);return y&&(f.toText=y),[c.name,f]})),l=Object.fromEntries(r.map(c=>{let d=s.filter(y=>y.type===c.name),u={name:c.name,options:c.options,storage:c.storage,editor:e},p=t.reduce((y,k)=>{let S=ee(k,"extendMarkSchema",u);return{...y,...S?S(c):{}}},{}),f=Vm({...p,inclusive:Se(ee(c,"inclusive",u)),excludes:Se(ee(c,"excludes",u)),group:Se(ee(c,"group",u)),spanning:Se(ee(c,"spanning",u)),code:Se(ee(c,"code",u)),attrs:Object.fromEntries(d.map(Wm))}),h=Se(ee(c,"parseHTML",u));h&&(f.parseDOM=h.map(y=>_m(y,d)));let m=ee(c,"renderHTML",u);return m&&(f.toDOM=y=>m({mark:y,HTMLAttributes:Co(y,d)})),[c.name,f]}));return new fo({topNode:a,nodes:i,marks:l})}function tE(t){let e=t.filter((n,s)=>t.indexOf(n)!==s);return Array.from(new Set(e))}function ii(t){return t.sort((n,s)=>{let o=ee(n,"priority")||100,r=ee(s,"priority")||100;return o>r?-1:o<r?1:0})}function ag(t){let e=ii(Ed(t)),n=tE(e.map(s=>s.name));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map(s=>`'${s}'`).join(", ")}]. This can lead to issues.`),e}function ig(t,e,n){let{from:s,to:o}=e,{blockSeparator:r=`

`,textSerializers:a={}}=n||{},i="";return t.nodesBetween(s,o,(l,c,d,u)=>{var p;l.isBlock&&c>s&&(i+=r);let f=a?.[l.type.name];if(f)return d&&(i+=f({node:l,pos:c,parent:d,index:u,range:e})),!1;l.isText&&(i+=(p=l?.text)==null?void 0:p.slice(Math.max(s,c)-c,o-c))}),i}function nE(t,e){let n={from:0,to:t.content.size};return ig(t,n,e)}function lg(t){return Object.fromEntries(Object.entries(t.nodes).filter(([,e])=>e.spec.toText).map(([e,n])=>[e,n.spec.toText]))}function sE(t,e){let n=ze(e,t.schema),{from:s,to:o}=t.selection,r=[];t.doc.nodesBetween(s,o,i=>{r.push(i)});let a=r.reverse().find(i=>i.type.name===n.name);return a?{...a.attrs}:{}}function Td(t,e){let n=di(typeof e=="string"?e:e.name,t.schema);return n==="node"?sE(t,e):n==="mark"?ng(t,e):{}}function oE(t,e=JSON.stringify){let n={};return t.filter(s=>{let o=e(s);return Object.prototype.hasOwnProperty.call(n,o)?!1:n[o]=!0})}function rE(t){let e=oE(t);return e.length===1?e:e.filter((n,s)=>!e.filter((r,a)=>a!==s).some(r=>n.oldRange.from>=r.oldRange.from&&n.oldRange.to<=r.oldRange.to&&n.newRange.from>=r.newRange.from&&n.newRange.to<=r.newRange.to))}function Dd(t){let{mapping:e,steps:n}=t,s=[];return e.maps.forEach((o,r)=>{let a=[];if(o.ranges.length)o.forEach((i,l)=>{a.push({from:i,to:l})});else{let{from:i,to:l}=n[r];if(i===void 0||l===void 0)return;a.push({from:i,to:l})}a.forEach(({from:i,to:l})=>{let c=e.slice(r).map(i,-1),d=e.slice(r).map(l),u=e.invert().map(c,-1),p=e.invert().map(d);s.push({oldRange:{from:u,to:p},newRange:{from:c,to:d}})})}),rE(s)}function pi(t,e,n){let s=[];return t===e?n.resolve(t).marks().forEach(o=>{let r=n.resolve(t),a=wd(r,o.type);a&&s.push({mark:o,...a})}):n.nodesBetween(t,e,(o,r)=>{!o||o?.nodeSize===void 0||s.push(...o.marks.map(a=>({from:r,to:r+o.nodeSize,mark:a})))}),s}var cg=(t,e,n,s=20)=>{let o=t.doc.resolve(n),r=s,a=null;for(;r>0&&a===null;){let i=o.node(r);i?.type.name===e?a=i:r-=1}return[a,r]};function ei(t,e){return e.nodes[t]||e.marks[t]||null}function oi(t,e,n){return Object.fromEntries(Object.entries(n).filter(([s])=>{let o=t.find(r=>r.type===e&&r.name===s);return o?o.attribute.keepOnSplit:!1}))}var aE=(t,e=500)=>{let n="",s=t.parentOffset;return t.parent.nodesBetween(Math.max(0,s-e),s,(o,r,a,i)=>{var l,c;let d=((c=(l=o.type.spec).toText)==null?void 0:c.call(l,{node:o,pos:r,parent:a,index:i}))||o.textContent||"%leaf%";n+=o.isAtom&&!o.isText?d:d.slice(0,Math.max(0,s-r))}),n};function kd(t,e,n={}){let{empty:s,ranges:o}=t.selection,r=e?Hn(e,t.schema):null;if(s)return!!(t.storedMarks||t.selection.$from.marks()).filter(u=>r?r.name===u.type.name:!0).find(u=>ri(u.attrs,n,{strict:!1}));let a=0,i=[];if(o.forEach(({$from:u,$to:p})=>{let f=u.pos,h=p.pos;t.doc.nodesBetween(f,h,(m,y)=>{if(!m.isText&&!m.marks.length)return;let k=Math.max(f,y),S=Math.min(h,y+m.nodeSize),T=S-k;a+=T,i.push(...m.marks.map(D=>({mark:D,from:k,to:S})))})}),a===0)return!1;let l=i.filter(u=>r?r.name===u.mark.type.name:!0).filter(u=>ri(u.mark.attrs,n,{strict:!1})).reduce((u,p)=>u+p.to-p.from,0),c=i.filter(u=>r?u.mark.type!==r&&u.mark.type.excludes(r):!0).reduce((u,p)=>u+p.to-p.from,0);return(l>0?l+c:l)>=a}function iE(t,e,n={}){if(!e)return gn(t,null,n)||kd(t,null,n);let s=di(e,t.schema);return s==="node"?gn(t,e,n):s==="mark"?kd(t,e,n):!1}var dg=(t,e)=>{let{$from:n,$to:s,$anchor:o}=t.selection;if(e){let r=ui(i=>i.type.name===e)(t.selection);if(!r)return!1;let a=t.doc.resolve(r.pos+1);return o.pos+1===a.end()}return!(s.parentOffset<s.parent.nodeSize-2||n.pos!==s.pos)},ug=t=>{let{$from:e,$to:n}=t.selection;return!(e.parentOffset>0||e.pos!==n.pos)};function Km(t,e){return Array.isArray(e)?e.some(n=>(typeof n=="string"?n:n.name)===t.name):e}function Jm(t,e){let{nodeExtensions:n}=Io(e),s=n.find(a=>a.name===t);if(!s)return!1;let o={name:s.name,options:s.options,storage:s.storage},r=Se(ee(s,"group",o));return typeof r!="string"?!1:r.split(" ").includes("list")}function Ar(t,{checkChildren:e=!0,ignoreWhitespace:n=!1}={}){var s;if(n){if(t.type.name==="hardBreak")return!0;if(t.isText)return/^\s*$/m.test((s=t.text)!=null?s:"")}if(t.isText)return!t.text;if(t.isAtom||t.isLeaf)return!1;if(t.content.childCount===0)return!0;if(e){let o=!0;return t.content.forEach(r=>{o!==!1&&(Ar(r,{ignoreWhitespace:n,checkChildren:e})||(o=!1))}),o}return!1}function fi(t){return t instanceof Q}var pg=class fg{constructor(e){this.position=e}static fromJSON(e){return new fg(e.position)}toJSON(){return{position:this.position}}};function lE(t,e){let n=e.mapping.mapResult(t.position);return{position:new pg(n.pos),mapResult:n}}function cE(t){return new pg(t)}function dE(t,e,n){var s;let{selection:o}=e,r=null;if(Zm(o)&&(r=o.$cursor),r){let i=(s=t.storedMarks)!=null?s:r.marks();return r.parent.type.allowsMarkType(n)&&(!!n.isInSet(i)||!i.some(c=>c.type.excludes(n)))}let{ranges:a}=o;return a.some(({$from:i,$to:l})=>{let c=i.depth===0?t.doc.inlineContent&&t.doc.type.allowsMarkType(n):!1;return t.doc.nodesBetween(i.pos,l.pos,(d,u,p)=>{if(c)return!1;if(d.isInline){let f=!p||p.type.allowsMarkType(n),h=!!n.isInSet(d.marks)||!d.marks.some(m=>m.type.excludes(n));c=f&&h}return!c}),c})}var uE=(t,e={})=>({tr:n,state:s,dispatch:o})=>{let{selection:r}=n,{empty:a,ranges:i}=r,l=Hn(t,s.schema);if(o)if(a){let c=ng(s,l);n.addStoredMark(l.create({...c,...e}))}else i.forEach(c=>{let d=c.$from.pos,u=c.$to.pos;s.doc.nodesBetween(d,u,(p,f)=>{let h=Math.max(f,d),m=Math.min(f+p.nodeSize,u);p.marks.find(k=>k.type===l)?p.marks.forEach(k=>{l===k.type&&n.addMark(h,m,l.create({...k.attrs,...e}))}):n.addMark(h,m,l.create(e))})});return dE(s,n,l)},pE=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),fE=(t,e={})=>({state:n,dispatch:s,chain:o})=>{let r=ze(t,n.schema),a;return n.selection.$anchor.sameParent(n.selection.$head)&&(a=n.selection.$anchor.parent.attrs),r.isTextblock?o().command(({commands:i})=>Nc(r,{...a,...e})(n)?!0:i.clearNodes()).command(({state:i})=>Nc(r,{...a,...e})(i,s)).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},hE=t=>({tr:e,dispatch:n})=>{if(n){let{doc:s}=e,o=Us(t,0,s.content.size),r=Q.create(s,o);e.setSelection(r)}return!0},mE=(t,e)=>({tr:n,state:s,dispatch:o})=>{let{selection:r}=s,a,i;return typeof e=="number"?(a=e,i=e):e&&"from"in e&&"to"in e?(a=e.from,i=e.to):(a=r.from,i=r.to),o&&n.doc.nodesBetween(a,i,(l,c)=>{l.isText||n.setNodeMarkup(c,void 0,{...l.attrs,dir:t})}),!0},gE=t=>({tr:e,dispatch:n})=>{if(n){let{doc:s}=e,{from:o,to:r}=typeof t=="number"?{from:t,to:t}:t,a=te.atStart(s).from,i=te.atEnd(s).to,l=Us(o,a,i),c=Us(r,a,i),d=te.create(s,l,c);e.setSelection(d)}return!0},yE=t=>({state:e,dispatch:n})=>{let s=ze(t,e.schema);return Ch(s)(e,n)};function Gm(t,e){let n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){let s=n.filter(o=>e?.includes(o.type.name));t.tr.ensureMarks(s)}}var kE=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:s,editor:o})=>{let{selection:r,doc:a}=e,{$from:i,$to:l}=r,c=o.extensionManager.attributes,d=oi(c,i.node().type.name,i.node().attrs);if(r instanceof Q&&r.node.isBlock)return!i.parentOffset||!zt(a,i.pos)?!1:(s&&(t&&Gm(n,o.extensionManager.splittableMarks),e.split(i.pos).scrollIntoView()),!0);if(!i.parent.isBlock)return!1;let u=l.parentOffset===l.parent.content.size,p=i.depth===0?void 0:Y0(i.node(-1).contentMatchAt(i.indexAfter(-1))),f=u&&p?[{type:p,attrs:d}]:void 0,h=zt(e.doc,e.mapping.map(i.pos),1,f);if(!f&&!h&&zt(e.doc,e.mapping.map(i.pos),1,p?[{type:p}]:void 0)&&(h=!0,f=p?[{type:p,attrs:d}]:void 0),s){if(h&&(r instanceof te&&e.deleteSelection(),e.split(e.mapping.map(i.pos),1,f),p&&!u&&!i.parentOffset&&i.parent.type!==p)){let m=e.mapping.map(i.before()),y=e.doc.resolve(m);i.node(-1).canReplaceWith(y.index(),y.index()+1,p)&&e.setNodeMarkup(e.mapping.map(i.before()),p)}t&&Gm(n,o.extensionManager.splittableMarks),e.scrollIntoView()}return h},bE=(t,e={})=>({tr:n,state:s,dispatch:o,editor:r})=>{var a;let i=ze(t,s.schema),{$from:l,$to:c}=s.selection,d=s.selection.node;if(d&&d.isBlock||l.depth<2||!l.sameParent(c))return!1;let u=l.node(-1);if(u.type!==i)return!1;let p=r.extensionManager.attributes;if(l.parent.content.size===0&&l.node(-1).childCount===l.indexAfter(-1)){if(l.depth===2||l.node(-3).type!==i||l.index(-2)!==l.node(-2).childCount-1)return!1;if(o){let k=O.empty,S=l.index(-1)?1:l.index(-2)?2:3;for(let I=l.depth-S;I>=l.depth-3;I-=1)k=O.from(l.node(I).copy(k));let T=l.indexAfter(-1)<l.node(-2).childCount?1:l.indexAfter(-2)<l.node(-3).childCount?2:3,D={...oi(p,l.node().type.name,l.node().attrs),...e},E=((a=i.contentMatch.defaultType)==null?void 0:a.createAndFill(D))||void 0;k=k.append(O.from(i.createAndFill(null,E)||void 0));let b=l.before(l.depth-(S-1));n.replace(b,l.after(-T),new X(k,4-S,0));let w=-1;n.doc.nodesBetween(b,n.doc.content.size,(I,M)=>{if(w>-1)return!1;I.isTextblock&&I.content.size===0&&(w=M+1)}),w>-1&&n.setSelection(te.near(n.doc.resolve(w))),n.scrollIntoView()}return!0}let f=c.pos===l.end()?u.contentMatchAt(0).defaultType:null,h={...oi(p,u.type.name,u.attrs),...e},m={...oi(p,l.node().type.name,l.node().attrs),...e};n.delete(l.pos,c.pos);let y=f?[{type:i,attrs:h},{type:f,attrs:m}]:[{type:i,attrs:h}];if(!zt(n.doc,l.pos,2))return!1;if(o){let{selection:k,storedMarks:S}=s,{splittableMarks:T}=r.extensionManager,D=S||k.$to.parentOffset&&k.$from.marks();if(n.split(l.pos,2,y).scrollIntoView(),!D||!o)return!0;let E=D.filter(b=>T.includes(b.type.name));n.ensureMarks(E)}return!0},md=(t,e)=>{let n=ui(a=>a.type===e)(t.selection);if(!n)return!0;let s=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(s===void 0)return!0;let o=t.doc.nodeAt(s);return n.node.type===o?.type&&Wt(t.doc,n.pos)&&t.join(n.pos),!0},gd=(t,e)=>{let n=ui(a=>a.type===e)(t.selection);if(!n)return!0;let s=t.doc.resolve(n.start).after(n.depth);if(s===void 0)return!0;let o=t.doc.nodeAt(s);return n.node.type===o?.type&&Wt(t.doc,s)&&t.join(s),!0},vE=(t,e,n,s={})=>({editor:o,tr:r,state:a,dispatch:i,chain:l,commands:c,can:d})=>{let{extensions:u,splittableMarks:p}=o.extensionManager,f=ze(t,a.schema),h=ze(e,a.schema),{selection:m,storedMarks:y}=a,{$from:k,$to:S}=m,T=k.blockRange(S),D=y||m.$to.parentOffset&&m.$from.marks();if(!T)return!1;let E=ui(b=>Jm(b.type.name,u))(m);if(T.depth>=1&&E&&T.depth-E.depth<=1){if(E.node.type===f)return c.liftListItem(h);if(Jm(E.node.type.name,u)&&f.validContent(E.node.content)&&i)return l().command(()=>(r.setNodeMarkup(E.pos,f),!0)).command(()=>md(r,f)).command(()=>gd(r,f)).run()}return!n||!D||!i?l().command(()=>d().wrapInList(f,s)?!0:c.clearNodes()).wrapInList(f,s).command(()=>md(r,f)).command(()=>gd(r,f)).run():l().command(()=>{let b=d().wrapInList(f,s),w=D.filter(I=>p.includes(I.type.name));return r.ensureMarks(w),b?!0:c.clearNodes()}).wrapInList(f,s).command(()=>md(r,f)).command(()=>gd(r,f)).run()},wE=(t,e={},n={})=>({state:s,commands:o})=>{let{extendEmptyMarkRange:r=!1}=n,a=Hn(t,s.schema);return kd(s,a,e)?o.unsetMark(a,{extendEmptyMarkRange:r}):o.setMark(a,e)},SE=(t,e,n={})=>({state:s,commands:o})=>{let r=ze(t,s.schema),a=ze(e,s.schema),i=gn(s,r,n),l;return s.selection.$anchor.sameParent(s.selection.$head)&&(l=s.selection.$anchor.parent.attrs),i?o.setNode(a,l):o.setNode(r,{...l,...n})},EE=(t,e={})=>({state:n,commands:s})=>{let o=ze(t,n.schema);return gn(n,o,e)?s.lift(o):s.wrapIn(o,e)},xE=()=>({state:t,dispatch:e})=>{let n=t.plugins;for(let s=0;s<n.length;s+=1){let o=n[s],r;if(o.spec.isInputRules&&(r=o.getState(t))){if(e){let a=t.tr,i=r.transform;for(let l=i.steps.length-1;l>=0;l-=1)a.step(i.steps[l].invert(i.docs[l]));if(r.text){let l=a.doc.resolve(r.from).marks();a.replaceWith(r.from,r.to,t.schema.text(r.text,l))}else a.delete(r.from,r.to)}return!0}}return!1},TE=()=>({tr:t,dispatch:e})=>{let{selection:n}=t,{empty:s,ranges:o}=n;return s||e&&o.forEach(r=>{t.removeMark(r.$from.pos,r.$to.pos)}),!0},DE=(t,e={})=>({tr:n,state:s,dispatch:o})=>{var r;let{extendEmptyMarkRange:a=!1}=e,{selection:i}=n,l=Hn(t,s.schema),{$from:c,empty:d,ranges:u}=i;if(!o)return!0;if(d&&a){let{from:p,to:f}=i,h=(r=c.marks().find(y=>y.type===l))==null?void 0:r.attrs,m=wd(c,l,h);m&&(p=m.from,f=m.to),n.removeMark(p,f,l)}else u.forEach(p=>{n.removeMark(p.$from.pos,p.$to.pos,l)});return n.removeStoredMark(l),!0},IE=t=>({tr:e,state:n,dispatch:s})=>{let{selection:o}=n,r,a;return typeof t=="number"?(r=t,a=t):t&&"from"in t&&"to"in t?(r=t.from,a=t.to):(r=o.from,a=o.to),s&&e.doc.nodesBetween(r,a,(i,l)=>{if(i.isText)return;let c={...i.attrs};delete c.dir,e.setNodeMarkup(l,void 0,c)}),!0},CE=(t,e={})=>({tr:n,state:s,dispatch:o})=>{let r=null,a=null,i=di(typeof t=="string"?t:t.name,s.schema);if(!i)return!1;i==="node"&&(r=ze(t,s.schema)),i==="mark"&&(a=Hn(t,s.schema));let l=!1;return n.selection.ranges.forEach(c=>{let d=c.$from.pos,u=c.$to.pos,p,f,h,m;n.selection.empty?s.doc.nodesBetween(d,u,(y,k)=>{r&&r===y.type&&(l=!0,h=Math.max(k,d),m=Math.min(k+y.nodeSize,u),p=k,f=y)}):s.doc.nodesBetween(d,u,(y,k)=>{k<d&&r&&r===y.type&&(l=!0,h=Math.max(k,d),m=Math.min(k+y.nodeSize,u),p=k,f=y),k>=d&&k<=u&&(r&&r===y.type&&(l=!0,o&&n.setNodeMarkup(k,void 0,{...y.attrs,...e})),a&&y.marks.length&&y.marks.forEach(S=>{if(a===S.type&&(l=!0,o)){let T=Math.max(k,d),D=Math.min(k+y.nodeSize,u);n.addMark(T,D,a.create({...S.attrs,...e}))}}))}),f&&(p!==void 0&&o&&n.setNodeMarkup(p,void 0,{...f.attrs,...e}),a&&f.marks.length&&f.marks.forEach(y=>{a===y.type&&o&&n.addMark(h,m,a.create({...y.attrs,...e}))}))}),l},AE=(t,e={})=>({state:n,dispatch:s})=>{let o=ze(t,n.schema);return Th(o,e)(n,s)},ME=(t,e={})=>({state:n,dispatch:s})=>{let o=ze(t,n.schema);return Dh(o,e)(n,s)},LE=class{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){let n=this.callbacks[t];return n&&n.forEach(s=>s.apply(this,e)),this}off(t,e){let n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter(s=>s!==e):delete this.callbacks[t]),this}once(t,e){let n=(...s)=>{this.off(t,n),e.apply(this,s)};return this.on(t,n)}removeAllListeners(){this.callbacks={}}},hi=class{constructor(t){var e;this.find=t.find,this.handler=t.handler,this.undoable=(e=t.undoable)!=null?e:!0}},jE=(t,e)=>{if(vd(e))return e.exec(t);let n=e(t);if(!n)return null;let s=[n.text];return s.index=n.index,s.input=t,s.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),s.push(n.replaceWith)),s};function ti(t){var e;let{editor:n,from:s,to:o,text:r,rules:a,plugin:i}=t,{view:l}=n;if(l.composing)return!1;let c=l.state.doc.resolve(s);if(c.parent.type.spec.code||(e=c.nodeBefore||c.nodeAfter)!=null&&e.marks.find(p=>p.type.spec.code))return!1;let d=!1,u=aE(c)+r;return a.forEach(p=>{if(d)return;let f=jE(u,p.find);if(!f)return;let h=l.state.tr,m=li({state:l.state,transaction:h}),y={from:s-(f[0].length-r.length),to:o},{commands:k,chain:S,can:T}=new ci({editor:n,state:m});p.handler({state:m,range:y,match:f,commands:k,chain:S,can:T})===null||!h.steps.length||(p.undoable&&h.setMeta(i,{transform:h,from:s,to:o,text:r}),l.dispatch(h),d=!0)}),d}function PE(t){let{editor:e,rules:n}=t,s=new ae({state:{init(){return null},apply(o,r,a){let i=o.getMeta(s);if(i)return i;let l=o.getMeta("applyInputRules");return l&&setTimeout(()=>{let{text:d}=l;typeof d=="string"?d=d:d=xd(O.from(d),a.schema);let{from:u}=l,p=u+d.length;ti({editor:e,from:u,to:p,text:d,rules:n,plugin:s})}),o.selectionSet||o.docChanged?null:r}},props:{handleTextInput(o,r,a,i){return ti({editor:e,from:r,to:a,text:i,rules:n,plugin:s})},handleDOMEvents:{compositionend:o=>(setTimeout(()=>{let{$cursor:r}=o.state.selection;r&&ti({editor:e,from:r.pos,to:r.pos,text:"",rules:n,plugin:s})}),!1)},handleKeyDown(o,r){if(r.key!=="Enter")return!1;let{$cursor:a}=o.state.selection;return a?ti({editor:e,from:a.pos,to:a.pos,text:`
`,rules:n,plugin:s}):!1}},isInputRules:!0});return s}function NE(t){return Object.prototype.toString.call(t).slice(8,-1)}function ni(t){return NE(t)!=="Object"?!1:t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype}function hg(t,e){let n={...t};return ni(t)&&ni(e)&&Object.keys(e).forEach(s=>{ni(e[s])&&ni(t[s])?n[s]=hg(t[s],e[s]):n[s]=e[s]}),n}var Id=class{constructor(t={}){this.type="extendable",this.parent=null,this.child=null,this.name="",this.config={name:this.name},this.config={...this.config,...t},this.name=this.config.name}get options(){return{...Se(ee(this,"addOptions",{name:this.name}))||{}}}get storage(){return{...Se(ee(this,"addStorage",{name:this.name,options:this.options}))||{}}}configure(t={}){let e=this.extend({...this.config,addOptions:()=>hg(this.options,t)});return e.name=this.name,e.parent=this.parent,e}extend(t={}){let e=new this.constructor({...this.config,...t});return e.parent=this,this.child=e,e.name="name"in t?t.name:e.parent.name,e}},Ht=class mg extends Id{constructor(){super(...arguments),this.type="mark"}static create(e={}){let n=typeof e=="function"?e():e;return new mg(n)}static handleExit({editor:e,mark:n}){let{tr:s}=e.state,o=e.state.selection.$from;if(o.pos===o.end()){let a=o.marks();if(!!!a.find(c=>c?.type.name===n.name))return!1;let l=a.find(c=>c?.type.name===n.name);return l&&s.removeStoredMark(l),s.insertText(" ",o.pos),e.view.dispatch(s),!0}return!1}configure(e){return super.configure(e)}extend(e){let n=typeof e=="function"?e():e;return super.extend(n)}};function BE(t){return typeof t=="number"}var OE=class{constructor(t){this.find=t.find,this.handler=t.handler}},RE=(t,e,n)=>{if(vd(e))return[...t.matchAll(e)];let s=e(t,n);return s?s.map(o=>{let r=[o.text];return r.index=o.index,r.input=t,r.data=o.data,o.replaceWith&&(o.text.includes(o.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),r.push(o.replaceWith)),r}):[]};function $E(t){let{editor:e,state:n,from:s,to:o,rule:r,pasteEvent:a,dropEvent:i}=t,{commands:l,chain:c,can:d}=new ci({editor:e,state:n}),u=[];return n.doc.nodesBetween(s,o,(f,h)=>{var m,y,k,S,T;if((y=(m=f.type)==null?void 0:m.spec)!=null&&y.code||!(f.isText||f.isTextblock||f.isInline))return;let D=(T=(S=(k=f.content)==null?void 0:k.size)!=null?S:f.nodeSize)!=null?T:0,E=Math.max(s,h),b=Math.min(o,h+D);if(E>=b)return;let w=f.isText?f.text||"":f.textBetween(E-h,b-h,void 0,"\uFFFC");RE(w,r.find,a).forEach(M=>{if(M.index===void 0)return;let z=E+M.index+1,_=z+M[0].length,x={from:n.tr.mapping.map(z),to:n.tr.mapping.map(_)},j=r.handler({state:n,range:x,match:M,commands:l,chain:c,can:d,pasteEvent:a,dropEvent:i});u.push(j)})}),u.every(f=>f!==null)}var si=null,FE=t=>{var e;let n=new ClipboardEvent("paste",{clipboardData:new DataTransfer});return(e=n.clipboardData)==null||e.setData("text/html",t),n};function zE(t){let{editor:e,rules:n}=t,s=null,o=!1,r=!1,a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,i;try{i=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{i=null}let l=({state:d,from:u,to:p,rule:f,pasteEvt:h})=>{let m=d.tr,y=li({state:d,transaction:m});if(!(!$E({editor:e,state:y,from:Math.max(u-1,0),to:p.b-1,rule:f,pasteEvent:h,dropEvent:i})||!m.steps.length)){try{i=typeof DragEvent<"u"?new DragEvent("drop"):null}catch{i=null}return a=typeof ClipboardEvent<"u"?new ClipboardEvent("paste"):null,m}};return n.map(d=>new ae({view(u){let p=h=>{var m;s=(m=u.dom.parentElement)!=null&&m.contains(h.target)?u.dom.parentElement:null,s&&(si=e)},f=()=>{si&&(si=null)};return window.addEventListener("dragstart",p),window.addEventListener("dragend",f),{destroy(){window.removeEventListener("dragstart",p),window.removeEventListener("dragend",f)}}},props:{handleDOMEvents:{drop:(u,p)=>{if(r=s===u.dom.parentElement,i=p,!r){let f=si;f?.isEditable&&setTimeout(()=>{let h=f.state.selection;h&&f.commands.deleteRange({from:h.from,to:h.to})},10)}return!1},paste:(u,p)=>{var f;let h=(f=p.clipboardData)==null?void 0:f.getData("text/html");return a=p,o=!!h?.includes("data-pm-slice"),!1}}},appendTransaction:(u,p,f)=>{let h=u[0],m=h.getMeta("uiEvent")==="paste"&&!o,y=h.getMeta("uiEvent")==="drop"&&!r,k=h.getMeta("applyPasteRules"),S=!!k;if(!m&&!y&&!S)return;if(S){let{text:E}=k;typeof E=="string"?E=E:E=xd(O.from(E),f.schema);let{from:b}=k,w=b+E.length,I=FE(E);return l({rule:d,state:f,from:b,to:{b:w},pasteEvt:I})}let T=p.doc.content.findDiffStart(f.doc.content),D=p.doc.content.findDiffEnd(f.doc.content);if(!(!BE(T)||!D||T===D.b))return l({rule:d,state:f,from:T,to:D,pasteEvt:a})}}))}var mi=class{constructor(t,e){this.splittableMarks=[],this.editor=e,this.baseExtensions=t,this.extensions=ag(t),this.schema=eE(this.extensions,e),this.setupExtensions()}get commands(){return this.extensions.reduce((t,e)=>{let n={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:ei(e.name,this.schema)},s=ee(e,"addCommands",n);return s?{...t,...s()}:t},{})}get plugins(){let{editor:t}=this;return ii([...this.extensions].reverse()).flatMap(s=>{let o={name:s.name,options:s.options,storage:this.editor.extensionStorage[s.name],editor:t,type:ei(s.name,this.schema)},r=[],a=ee(s,"addKeyboardShortcuts",o),i={};if(s.type==="mark"&&ee(s,"exitable",o)&&(i.ArrowRight=()=>Ht.handleExit({editor:t,mark:s})),a){let p=Object.fromEntries(Object.entries(a()).map(([f,h])=>[f,()=>h({editor:t})]));i={...i,...p}}let l=zm(i);r.push(l);let c=ee(s,"addInputRules",o);if(Km(s,t.options.enableInputRules)&&c){let p=c();if(p&&p.length){let f=PE({editor:t,rules:p}),h=Array.isArray(f)?f:[f];r.push(...h)}}let d=ee(s,"addPasteRules",o);if(Km(s,t.options.enablePasteRules)&&d){let p=d();if(p&&p.length){let f=zE({editor:t,rules:p});r.push(...f)}}let u=ee(s,"addProseMirrorPlugins",o);if(u){let p=u();r.push(...p)}return r})}get attributes(){return rg(this.extensions)}get nodeViews(){let{editor:t}=this,{nodeExtensions:e}=Io(this.extensions);return Object.fromEntries(e.filter(n=>!!ee(n,"addNodeView")).map(n=>{let s=this.attributes.filter(l=>l.type===n.name),o={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:ze(n.name,this.schema)},r=ee(n,"addNodeView",o);if(!r)return[];let a=r();if(!a)return[];let i=(l,c,d,u,p)=>{let f=Co(l,s);return a({node:l,view:c,getPos:d,decorations:u,innerDecorations:p,editor:t,extension:n,HTMLAttributes:f})};return[n.name,i]}))}dispatchTransaction(t){let{editor:e}=this;return ii([...this.extensions].reverse()).reduceRight((s,o)=>{let r={name:o.name,options:o.options,storage:this.editor.extensionStorage[o.name],editor:e,type:ei(o.name,this.schema)},a=ee(o,"dispatchTransaction",r);return a?i=>{a.call(r,{transaction:i,next:s})}:s},t)}get markViews(){let{editor:t}=this,{markExtensions:e}=Io(this.extensions);return Object.fromEntries(e.filter(n=>!!ee(n,"addMarkView")).map(n=>{let s=this.attributes.filter(i=>i.type===n.name),o={name:n.name,options:n.options,storage:this.editor.extensionStorage[n.name],editor:t,type:Hn(n.name,this.schema)},r=ee(n,"addMarkView",o);if(!r)return[];let a=(i,l,c)=>{let d=Co(i,s);return r()({mark:i,view:l,inline:c,editor:t,extension:n,HTMLAttributes:d,updateAttributes:u=>{XE(i,t,u)}})};return[n.name,a]}))}setupExtensions(){let t=this.extensions;this.editor.extensionStorage=Object.fromEntries(t.map(e=>[e.name,e.storage])),t.forEach(e=>{var n;let s={name:e.name,options:e.options,storage:this.editor.extensionStorage[e.name],editor:this.editor,type:ei(e.name,this.schema)};e.type==="mark"&&((n=Se(ee(e,"keepOnSplit",s)))==null||n)&&this.splittableMarks.push(e.name);let o=ee(e,"onBeforeCreate",s),r=ee(e,"onCreate",s),a=ee(e,"onUpdate",s),i=ee(e,"onSelectionUpdate",s),l=ee(e,"onTransaction",s),c=ee(e,"onFocus",s),d=ee(e,"onBlur",s),u=ee(e,"onDestroy",s);o&&this.editor.on("beforeCreate",o),r&&this.editor.on("create",r),a&&this.editor.on("update",a),i&&this.editor.on("selectionUpdate",i),l&&this.editor.on("transaction",l),c&&this.editor.on("focus",c),d&&this.editor.on("blur",d),u&&this.editor.on("destroy",u)})}};mi.resolve=ag;mi.sort=ii;mi.flatten=Ed;var HE={};bd(HE,{ClipboardTextSerializer:()=>yg,Commands:()=>kg,Delete:()=>bg,Drop:()=>vg,Editable:()=>wg,FocusEvents:()=>Eg,Keymap:()=>xg,Paste:()=>Tg,Tabindex:()=>Dg,TextDirection:()=>Ig,focusEventsPluginKey:()=>Sg});var ve=class gg extends Id{constructor(){super(...arguments),this.type="extension"}static create(e={}){let n=typeof e=="function"?e():e;return new gg(n)}configure(e){return super.configure(e)}extend(e){let n=typeof e=="function"?e():e;return super.extend(n)}},yg=ve.create({name:"clipboardTextSerializer",addOptions(){return{blockSeparator:void 0}},addProseMirrorPlugins(){return[new ae({key:new pe("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{let{editor:t}=this,{state:e,schema:n}=t,{doc:s,selection:o}=e,{ranges:r}=o,a=Math.min(...r.map(d=>d.$from.pos)),i=Math.max(...r.map(d=>d.$to.pos)),l=lg(n);return ig(s,{from:a,to:i},{...this.options.blockSeparator!==void 0?{blockSeparator:this.options.blockSeparator}:{},textSerializers:l})}}})]}}),kg=ve.create({name:"commands",addCommands(){return{...Ym}}}),bg=ve.create({name:"delete",onUpdate({transaction:t,appendedTransactions:e}){var n,s,o;let r=()=>{var a,i,l,c;if((c=(l=(i=(a=this.editor.options.coreExtensionOptions)==null?void 0:a.delete)==null?void 0:i.filterTransaction)==null?void 0:l.call(i,t))!=null?c:t.getMeta("y-sync$"))return;let d=Sd(t.before,[t,...e]);Dd(d).forEach(f=>{d.mapping.mapResult(f.oldRange.from).deletedAfter&&d.mapping.mapResult(f.oldRange.to).deletedBefore&&d.before.nodesBetween(f.oldRange.from,f.oldRange.to,(h,m)=>{let y=m+h.nodeSize-2,k=f.oldRange.from<=m&&y<=f.oldRange.to;this.editor.emit("delete",{type:"node",node:h,from:m,to:y,newFrom:d.mapping.map(m),newTo:d.mapping.map(y),deletedRange:f.oldRange,newRange:f.newRange,partial:!k,editor:this.editor,transaction:t,combinedTransform:d})})});let p=d.mapping;d.steps.forEach((f,h)=>{var m,y;if(f instanceof Nn){let k=p.slice(h).map(f.from,-1),S=p.slice(h).map(f.to),T=p.invert().map(k,-1),D=p.invert().map(S),E=(m=d.doc.nodeAt(k-1))==null?void 0:m.marks.some(w=>w.eq(f.mark)),b=(y=d.doc.nodeAt(S))==null?void 0:y.marks.some(w=>w.eq(f.mark));this.editor.emit("delete",{type:"mark",mark:f.mark,from:f.from,to:f.to,deletedRange:{from:T,to:D},newRange:{from:k,to:S},partial:!!(b||E),editor:this.editor,transaction:t,combinedTransform:d})}})};(o=(s=(n=this.editor.options.coreExtensionOptions)==null?void 0:n.delete)==null?void 0:s.async)==null||o?setTimeout(r,0):r()}}),vg=ve.create({name:"drop",addProseMirrorPlugins(){return[new ae({key:new pe("tiptapDrop"),props:{handleDrop:(t,e,n,s)=>{this.editor.emit("drop",{editor:this.editor,event:e,slice:n,moved:s})}}})]}}),wg=ve.create({name:"editable",addProseMirrorPlugins(){return[new ae({key:new pe("editable"),props:{editable:()=>this.editor.options.editable}})]}}),Sg=new pe("focusEvents"),Eg=ve.create({name:"focusEvents",addProseMirrorPlugins(){let{editor:t}=this;return[new ae({key:Sg,props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;let s=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(s),!1},blur:(e,n)=>{t.isFocused=!1;let s=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(s),!1}}}})]}}),xg=ve.create({name:"keymap",addKeyboardShortcuts(){let t=()=>this.editor.commands.first(({commands:a})=>[()=>a.undoInputRule(),()=>a.command(({tr:i})=>{let{selection:l,doc:c}=i,{empty:d,$anchor:u}=l,{pos:p,parent:f}=u,h=u.parent.isTextblock&&p>0?i.doc.resolve(p-1):u,m=h.parent.type.spec.isolating,y=u.pos-u.parentOffset,k=m&&h.parent.childCount===1?y===u.pos:re.atStart(c).from===p;return!d||!f.type.isTextblock||f.textContent.length||!k||k&&u.parent.type.name==="paragraph"?!1:a.clearNodes()}),()=>a.deleteSelection(),()=>a.joinBackward(),()=>a.selectNodeBackward()]),e=()=>this.editor.commands.first(({commands:a})=>[()=>a.deleteSelection(),()=>a.deleteCurrentNode(),()=>a.joinForward(),()=>a.selectNodeForward()]),s={Enter:()=>this.editor.commands.first(({commands:a})=>[()=>a.newlineInCode(),()=>a.createParagraphNear(),()=>a.liftEmptyBlock(),()=>a.splitBlock()]),"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},o={...s},r={...s,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return ai()||tg()?r:o},addProseMirrorPlugins(){return[new ae({key:new pe("clearDocument"),appendTransaction:(t,e,n)=>{if(t.some(m=>m.getMeta("composition")))return;let s=t.some(m=>m.docChanged)&&!e.doc.eq(n.doc),o=t.some(m=>m.getMeta("preventClearDocument"));if(!s||o)return;let{empty:r,from:a,to:i}=e.selection,l=re.atStart(e.doc).from,c=re.atEnd(e.doc).to;if(r||!(a===l&&i===c)||!Ar(n.doc))return;let p=n.tr,f=li({state:n,transaction:p}),{commands:h}=new ci({editor:this.editor,state:f});if(h.clearNodes(),!!p.steps.length)return p}})]}}),Tg=ve.create({name:"paste",addProseMirrorPlugins(){return[new ae({key:new pe("tiptapPaste"),props:{handlePaste:(t,e,n)=>{this.editor.emit("paste",{editor:this.editor,event:e,slice:n})}}})]}}),Dg=ve.create({name:"tabindex",addProseMirrorPlugins(){return[new ae({key:new pe("tabindex"),props:{attributes:()=>this.editor.isEditable?{tabindex:"0"}:{}}})]}}),Ig=ve.create({name:"textDirection",addOptions(){return{direction:void 0}},addGlobalAttributes(){if(!this.options.direction)return[];let{nodeExtensions:t}=Io(this.extensions);return[{types:t.filter(e=>e.name!=="text").map(e=>e.name),attributes:{dir:{default:this.options.direction,parseHTML:e=>{let n=e.getAttribute("dir");return n&&(n==="ltr"||n==="rtl"||n==="auto")?n:this.options.direction},renderHTML:e=>e.dir?{dir:e.dir}:{}}}}]},addProseMirrorPlugins(){return[new ae({key:new pe("textDirection"),props:{attributes:()=>{let t=this.options.direction;return t?{dir:t}:{}}}})]}}),qE=class Ir{constructor(e,n,s=!1,o=null){this.currentNode=null,this.actualDepth=null,this.isBlock=s,this.resolvedPos=e,this.editor=n,this.currentNode=o}get name(){return this.node.type.name}get node(){return this.currentNode||this.resolvedPos.node()}get element(){return this.editor.view.domAtPos(this.pos).node}get depth(){var e;return(e=this.actualDepth)!=null?e:this.resolvedPos.depth}get pos(){return this.resolvedPos.pos}get content(){return this.node.content}set content(e){let n=this.from,s=this.to;if(this.isBlock){if(this.content.size===0){console.error(`You can\u2019t set content on a block node. Tried to set content on ${this.name} at ${this.pos}`);return}n=this.from+1,s=this.to-1}this.editor.commands.insertContentAt({from:n,to:s},e)}get attributes(){return this.node.attrs}get textContent(){return this.node.textContent}get size(){return this.node.nodeSize}get from(){return this.isBlock?this.pos:this.resolvedPos.start(this.resolvedPos.depth)}get range(){return{from:this.from,to:this.to}}get to(){return this.isBlock?this.pos+this.size:this.resolvedPos.end(this.resolvedPos.depth)+(this.node.isText?0:1)}get parent(){if(this.depth===0)return null;let e=this.resolvedPos.start(this.resolvedPos.depth-1),n=this.resolvedPos.doc.resolve(e);return new Ir(n,this.editor)}get before(){let e=this.resolvedPos.doc.resolve(this.from-(this.isBlock?1:2));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.from-3)),new Ir(e,this.editor)}get after(){let e=this.resolvedPos.doc.resolve(this.to+(this.isBlock?2:1));return e.depth!==this.depth&&(e=this.resolvedPos.doc.resolve(this.to+3)),new Ir(e,this.editor)}get children(){let e=[];return this.node.content.forEach((n,s)=>{let o=n.isBlock&&!n.isTextblock,r=n.isAtom&&!n.isText,a=n.isInline,i=this.pos+s+(r?0:1);if(i<0||i>this.resolvedPos.doc.nodeSize-2)return;let l=this.resolvedPos.doc.resolve(i);if(!o&&!a&&l.depth<=this.depth)return;let c=new Ir(l,this.editor,o,o||a?n:null);o&&(c.actualDepth=this.depth+1),e.push(c)}),e}get firstChild(){return this.children[0]||null}get lastChild(){let e=this.children;return e[e.length-1]||null}closest(e,n={}){let s=null,o=this.parent;for(;o&&!s;){if(o.node.type.name===e)if(Object.keys(n).length>0){let r=o.node.attrs,a=Object.keys(n);for(let i=0;i<a.length;i+=1){let l=a[i];if(r[l]!==n[l])break}}else s=o;o=o.parent}return s}querySelector(e,n={}){return this.querySelectorAll(e,n,!0)[0]||null}querySelectorAll(e,n={},s=!1){let o=[];if(!this.children||this.children.length===0)return o;let r=Object.keys(n);return this.children.forEach(a=>{s&&o.length>0||(a.node.type.name===e&&r.every(l=>n[l]===a.node.attrs[l])&&o.push(a),!(s&&o.length>0)&&(o=o.concat(a.querySelectorAll(e,n,s))))}),o}setAttribute(e){let{tr:n}=this.editor.state;n.setNodeMarkup(this.from,void 0,{...this.node.attrs,...e}),this.editor.view.dispatch(n)}},UE=`.ProseMirror {
  position: relative;
}

.ProseMirror {
  word-wrap: break-word;
  white-space: pre-wrap;
  white-space: break-spaces;
  -webkit-font-variant-ligatures: none;
  font-variant-ligatures: none;
  font-feature-settings: "liga" 0; /* the above doesn't seem to work in Edge */
}

.ProseMirror [contenteditable="false"] {
  white-space: normal;
}

.ProseMirror [contenteditable="false"] [contenteditable="true"] {
  white-space: pre-wrap;
}

.ProseMirror pre {
  white-space: pre-wrap;
}

img.ProseMirror-separator {
  display: inline !important;
  border: none !important;
  margin: 0 !important;
  width: 0 !important;
  height: 0 !important;
}

.ProseMirror-gapcursor {
  display: none;
  pointer-events: none;
  position: absolute;
  margin: 0;
}

.ProseMirror-gapcursor:after {
  content: "";
  display: block;
  position: absolute;
  top: -2px;
  width: 20px;
  border-top: 1px solid black;
  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
}

@keyframes ProseMirror-cursor-blink {
  to {
    visibility: hidden;
  }
}

.ProseMirror-hideselection *::selection {
  background: transparent;
}

.ProseMirror-hideselection *::-moz-selection {
  background: transparent;
}

.ProseMirror-hideselection * {
  caret-color: transparent;
}

.ProseMirror-focused .ProseMirror-gapcursor {
  display: block;
}`;function _E(t,e,n){let s=document.querySelector(`style[data-tiptap-style${n?`-${n}`:""}]`);if(s!==null)return s;let o=document.createElement("style");return e&&o.setAttribute("nonce",e),o.setAttribute(`data-tiptap-style${n?`-${n}`:""}`,""),o.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(o),o}var Cg=class extends LE{constructor(t={}){super(),this.css=null,this.className="tiptap",this.editorView=null,this.isFocused=!1,this.isInitialized=!1,this.extensionStorage={},this.instanceId=Math.random().toString(36).slice(2,9),this.options={element:typeof document<"u"?document.createElement("div"):null,content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,textDirection:void 0,editorProps:{},parseOptions:{},coreExtensionOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,enableContentCheck:!1,emitContentError:!1,onBeforeCreate:()=>null,onCreate:()=>null,onMount:()=>null,onUnmount:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null,onContentError:({error:s})=>{throw s},onPaste:()=>null,onDrop:()=>null,onDelete:()=>null,enableExtensionDispatchTransaction:!0},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.utils={getUpdatedPosition:lE,createMappablePosition:cE},this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.on("mount",this.options.onMount),this.on("unmount",this.options.onUnmount),this.on("contentError",this.options.onContentError),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),this.on("drop",({event:s,slice:o,moved:r})=>this.options.onDrop(s,o,r)),this.on("paste",({event:s,slice:o})=>this.options.onPaste(s,o)),this.on("delete",this.options.onDelete);let e=this.createDoc(),n=Qm(e,this.options.autofocus);this.editorState=Ra.create({doc:e,schema:this.schema,selection:n||void 0}),this.options.element&&this.mount(this.options.element)}mount(t){if(typeof document>"u")throw new Error("[tiptap error]: The editor cannot be mounted because there is no 'document' defined in this environment.");this.createView(t),this.emit("mount",{editor:this}),this.css&&!document.head.contains(this.css)&&document.head.appendChild(this.css),window.setTimeout(()=>{this.isDestroyed||(this.options.autofocus!==!1&&this.options.autofocus!==null&&this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}),this.isInitialized=!0)},0)}unmount(){if(this.editorView){let t=this.editorView.dom;t?.editor&&delete t.editor,this.editorView.destroy()}if(this.editorView=null,this.isInitialized=!1,this.css&&!document.querySelectorAll(`.${this.className}`).length)try{typeof this.css.remove=="function"?this.css.remove():this.css.parentNode&&this.css.parentNode.removeChild(this.css)}catch(t){console.warn("Failed to remove CSS element:",t)}this.css=null,this.emit("unmount",{editor:this})}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&typeof document<"u"&&(this.css=_E(UE,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},!(!this.editorView||!this.state||this.isDestroyed)&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr,appendedTransactions:[]})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get view(){return this.editorView?this.editorView:new Proxy({state:this.editorState,updateState:t=>{this.editorState=t},dispatch:t=>{this.dispatchTransaction(t)},composing:!1,dragging:null,editable:!0,isDestroyed:!1},{get:(t,e)=>{if(this.editorView)return this.editorView[e];if(e==="state")return this.editorState;if(e in t)return Reflect.get(t,e);throw new Error(`[tiptap error]: The editor view is not available. Cannot access view['${e}']. The editor may not be mounted yet.`)}})}get state(){return this.editorView&&(this.editorState=this.view.state),this.editorState}registerPlugin(t,e){let n=og(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}unregisterPlugin(t){if(this.isDestroyed)return;let e=this.state.plugins,n=e;if([].concat(t).forEach(o=>{let r=typeof o=="string"?`${o}$`:o.key;n=n.filter(a=>!a.key.startsWith(r))}),e.length===n.length)return;let s=this.state.reconfigure({plugins:n});return this.view.updateState(s),s}createExtensionManager(){var t,e;let s=[...this.options.enableCoreExtensions?[wg,yg.configure({blockSeparator:(e=(t=this.options.coreExtensionOptions)==null?void 0:t.clipboardTextSerializer)==null?void 0:e.blockSeparator}),kg,Eg,xg,Dg,vg,Tg,bg,Ig.configure({direction:this.options.textDirection})].filter(o=>typeof this.options.enableCoreExtensions=="object"?this.options.enableCoreExtensions[o.name]!==!1:!0):[],...this.options.extensions].filter(o=>["extension","node","mark"].includes(o?.type));this.extensionManager=new mi(s,this)}createCommandManager(){this.commandManager=new ci({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createDoc(){let t;try{t=yd(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:this.options.enableContentCheck})}catch(e){if(!(e instanceof Error)||!["[tiptap error]: Invalid JSON content","[tiptap error]: Invalid HTML content"].includes(e.message))throw e;this.emit("contentError",{editor:this,error:e,disableCollaboration:()=>{"collaboration"in this.storage&&typeof this.storage.collaboration=="object"&&this.storage.collaboration&&(this.storage.collaboration.isDisabled=!0),this.options.extensions=this.options.extensions.filter(n=>n.name!=="collaboration"),this.createExtensionManager()}}),t=yd(this.options.content,this.schema,this.options.parseOptions,{errorOnInvalidContent:!1})}return t}createView(t){let{editorProps:e,enableExtensionDispatchTransaction:n}=this.options,s=e.dispatchTransaction||this.dispatchTransaction.bind(this),o=n?this.extensionManager.dispatchTransaction(s):s;this.editorView=new xr(t,{...e,attributes:{role:"textbox",...e?.attributes},dispatchTransaction:o,state:this.editorState,markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews});let r=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(r),this.prependClass(),this.injectCSS();let a=this.view.dom;a.editor=this}createNodeViews(){this.view.isDestroyed||this.view.setProps({markViews:this.extensionManager.markViews,nodeViews:this.extensionManager.nodeViews})}prependClass(){this.view.dom.className=`${this.className} ${this.view.dom.className}`}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;let e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction){if(!this.capturedTransaction){this.capturedTransaction=t;return}t.steps.forEach(c=>{var d;return(d=this.capturedTransaction)==null?void 0:d.step(c)});return}let{state:e,transactions:n}=this.state.applyTransaction(t),s=!this.state.selection.eq(e.selection),o=n.includes(t),r=this.state;if(this.emit("beforeTransaction",{editor:this,transaction:t,nextState:e}),!o)return;this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t,appendedTransactions:n.slice(1)}),s&&this.emit("selectionUpdate",{editor:this,transaction:t});let a=n.findLast(c=>c.getMeta("focus")||c.getMeta("blur")),i=a?.getMeta("focus"),l=a?.getMeta("blur");i&&this.emit("focus",{editor:this,event:i.event,transaction:a}),l&&this.emit("blur",{editor:this,event:l.event,transaction:a}),!(t.getMeta("preventUpdate")||!n.some(c=>c.docChanged)||r.doc.eq(e.doc))&&this.emit("update",{editor:this,transaction:t,appendedTransactions:n.slice(1)})}getAttributes(t){return Td(this.state,t)}isActive(t,e){let n=typeof t=="string"?t:null,s=typeof t=="string"?e:t;return iE(this.state,n,s)}getJSON(){return this.state.doc.toJSON()}getHTML(){return xd(this.state.doc.content,this.schema)}getText(t){let{blockSeparator:e=`

`,textSerializers:n={}}=t||{};return nE(this.state.doc,{blockSeparator:e,textSerializers:{...lg(this.schema),...n}})}get isEmpty(){return Ar(this.state.doc)}destroy(){this.emit("destroy"),this.unmount(),this.removeAllListeners()}get isDestroyed(){var t,e;return(e=(t=this.editorView)==null?void 0:t.isDestroyed)!=null?e:!0}$node(t,e){var n;return((n=this.$doc)==null?void 0:n.querySelector(t,e))||null}$nodes(t,e){var n;return((n=this.$doc)==null?void 0:n.querySelectorAll(t,e))||null}$pos(t){let e=this.state.doc.resolve(t);return new qE(e,this)}get $doc(){return this.$pos(0)}};function yn(t){return new hi({find:t.find,handler:({state:e,range:n,match:s})=>{let o=Se(t.getAttributes,void 0,s);if(o===!1||o===null)return null;let{tr:r}=e,a=s[s.length-1],i=s[0];if(a){let l=i.search(/\S/),c=n.from+i.indexOf(a),d=c+a.length;if(pi(n.from,n.to,e.doc).filter(f=>f.mark.type.excluded.find(m=>m===t.type&&m!==f.mark.type)).filter(f=>f.to>c).length)return null;d<n.to&&r.delete(d,n.to),c>n.from&&r.delete(n.from+l,c);let p=n.from+l+a.length;r.addMark(n.from+l,p,t.type.create(o||{})),r.removeStoredMark(t.type)}},undoable:t.undoable})}function Ag(t){return new hi({find:t.find,handler:({state:e,range:n,match:s})=>{let o=Se(t.getAttributes,void 0,s)||{},{tr:r}=e,a=n.from,i=n.to,l=t.type.create(o);if(s[1]){let c=s[0].lastIndexOf(s[1]),d=a+c;d>i?d=i:i=d+s[1].length;let u=s[0][s[0].length-1];r.insertText(u,a+s[0].length-1),r.replaceWith(d,i,l)}else if(s[0]){let c=t.type.isInline?a:a-1;r.insert(c,t.type.create(o)).delete(r.mapping.map(a),r.mapping.map(i))}r.scrollIntoView()},undoable:t.undoable})}function Mr(t){return new hi({find:t.find,handler:({state:e,range:n,match:s})=>{let o=e.doc.resolve(n.from),r=Se(t.getAttributes,void 0,s)||{};if(!o.node(-1).canReplaceWith(o.index(-1),o.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,r)},undoable:t.undoable})}function kn(t){return new hi({find:t.find,handler:({state:e,range:n,match:s,chain:o})=>{let r=Se(t.getAttributes,void 0,s)||{},a=e.tr.delete(n.from,n.to),l=a.doc.resolve(n.from).blockRange(),c=l&&yo(l,t.type,r);if(!c)return null;if(a.wrap(l,c),t.keepMarks&&t.editor){let{selection:u,storedMarks:p}=e,{splittableMarks:f}=t.editor.extensionManager,h=p||u.$to.parentOffset&&u.$from.marks();if(h){let m=h.filter(y=>f.includes(y.type.name));a.ensureMarks(m)}}if(t.keepAttributes){let u=t.type.name==="bulletList"||t.type.name==="orderedList"?"listItem":"taskList";o().updateAttributes(u,r).run()}let d=a.doc.resolve(n.from-1).nodeBefore;d&&d.type===t.type&&Wt(a.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(s,d))&&a.join(n.from-1)},undoable:t.undoable})}function Mg(t,e){let{selection:n}=t,{$from:s}=n;if(n instanceof Q){let r=s.index();return s.parent.canReplaceWith(r,r+1,e)}let o=s.depth;for(;o>=0;){let r=s.index(o);if(s.node(o).contentMatchAt(r).matchType(e))return!0;o-=1}return!1}var VE={};bd(VE,{createAtomBlockMarkdownSpec:()=>WE,createBlockMarkdownSpec:()=>KE,createInlineMarkdownSpec:()=>YE,parseAttributes:()=>Cd,parseIndentedBlocks:()=>gi,renderNestedMarkdownContent:()=>Lr,serializeAttributes:()=>Ad});function Cd(t){if(!t?.trim())return{};let e={},n=[],s=t.replace(/["']([^"']*)["']/g,c=>(n.push(c),`__QUOTED_${n.length-1}__`)),o=s.match(/(?:^|\s)\.([a-zA-Z][\w-]*)/g);if(o){let c=o.map(d=>d.trim().slice(1));e.class=c.join(" ")}let r=s.match(/(?:^|\s)#([a-zA-Z][\w-]*)/);r&&(e.id=r[1]);let a=/([a-zA-Z][\w-]*)\s*=\s*(__QUOTED_\d+__)/g;Array.from(s.matchAll(a)).forEach(([,c,d])=>{var u;let p=parseInt(((u=d.match(/__QUOTED_(\d+)__/))==null?void 0:u[1])||"0",10),f=n[p];f&&(e[c]=f.slice(1,-1))});let l=s.replace(/(?:^|\s)\.([a-zA-Z][\w-]*)/g,"").replace(/(?:^|\s)#([a-zA-Z][\w-]*)/g,"").replace(/([a-zA-Z][\w-]*)\s*=\s*__QUOTED_\d+__/g,"").trim();return l&&l.split(/\s+/).filter(Boolean).forEach(d=>{d.match(/^[a-zA-Z][\w-]*$/)&&(e[d]=!0)}),e}function Ad(t){if(!t||Object.keys(t).length===0)return"";let e=[];return t.class&&String(t.class).split(/\s+/).filter(Boolean).forEach(s=>e.push(`.${s}`)),t.id&&e.push(`#${t.id}`),Object.entries(t).forEach(([n,s])=>{n==="class"||n==="id"||(s===!0?e.push(n):s!==!1&&s!=null&&e.push(`${n}="${String(s)}"`))}),e.join(" ")}function WE(t){let{nodeName:e,name:n,parseAttributes:s=Cd,serializeAttributes:o=Ad,defaultAttributes:r={},requiredAttributes:a=[],allowedAttributes:i}=t,l=n||e,c=d=>{if(!i)return d;let u={};return i.forEach(p=>{p in d&&(u[p]=d[p])}),u};return{parseMarkdown:(d,u)=>{let p={...r,...d.attributes};return u.createNode(e,p,[])},markdownTokenizer:{name:e,level:"block",start(d){var u;let p=new RegExp(`^:::${l}(?:\\s|$)`,"m"),f=(u=d.match(p))==null?void 0:u.index;return f!==void 0?f:-1},tokenize(d,u,p){let f=new RegExp(`^:::${l}(?:\\s+\\{([^}]*)\\})?\\s*:::(?:\\n|$)`),h=d.match(f);if(!h)return;let m=h[1]||"",y=s(m);if(!a.find(S=>!(S in y)))return{type:e,raw:h[0],attributes:y}}},renderMarkdown:d=>{let u=c(d.attrs||{}),p=o(u),f=p?` {${p}}`:"";return`:::${l}${f} :::`}}}function KE(t){let{nodeName:e,name:n,getContent:s,parseAttributes:o=Cd,serializeAttributes:r=Ad,defaultAttributes:a={},content:i="block",allowedAttributes:l}=t,c=n||e,d=u=>{if(!l)return u;let p={};return l.forEach(f=>{f in u&&(p[f]=u[f])}),p};return{parseMarkdown:(u,p)=>{let f;if(s){let m=s(u);f=typeof m=="string"?[{type:"text",text:m}]:m}else i==="block"?f=p.parseChildren(u.tokens||[]):f=p.parseInline(u.tokens||[]);let h={...a,...u.attributes};return p.createNode(e,h,f)},markdownTokenizer:{name:e,level:"block",start(u){var p;let f=new RegExp(`^:::${c}`,"m"),h=(p=u.match(f))==null?void 0:p.index;return h!==void 0?h:-1},tokenize(u,p,f){var h;let m=new RegExp(`^:::${c}(?:\\s+\\{([^}]*)\\})?\\s*\\n`),y=u.match(m);if(!y)return;let[k,S=""]=y,T=o(S),D=1,E=k.length,b="",w=/^:::([\w-]*)(\s.*)?/gm,I=u.slice(E);for(w.lastIndex=0;;){let M=w.exec(I);if(M===null)break;let z=M.index,_=M[1];if(!((h=M[2])!=null&&h.endsWith(":::"))){if(_)D+=1;else if(D-=1,D===0){let x=I.slice(0,z);b=x.trim();let j=u.slice(0,E+z+M[0].length),U=[];if(b)if(i==="block")for(U=f.blockTokens(x),U.forEach(W=>{W.text&&(!W.tokens||W.tokens.length===0)&&(W.tokens=f.inlineTokens(W.text))});U.length>0;){let W=U[U.length-1];if(W.type==="paragraph"&&(!W.text||W.text.trim()===""))U.pop();else break}else U=f.inlineTokens(b);return{type:e,raw:j,attributes:T,content:b,tokens:U}}}}}},renderMarkdown:(u,p)=>{let f=d(u.attrs||{}),h=r(f),m=h?` {${h}}`:"",y=p.renderChildren(u.content||[],`

`);return`:::${c}${m}

${y}

:::`}}}function JE(t){if(!t.trim())return{};let e={},n=/(\w+)=(?:"([^"]*)"|'([^']*)')/g,s=n.exec(t);for(;s!==null;){let[,o,r,a]=s;e[o]=r||a,s=n.exec(t)}return e}function GE(t){return Object.entries(t).filter(([,e])=>e!=null).map(([e,n])=>`${e}="${n}"`).join(" ")}function YE(t){let{nodeName:e,name:n,getContent:s,parseAttributes:o=JE,serializeAttributes:r=GE,defaultAttributes:a={},selfClosing:i=!1,allowedAttributes:l}=t,c=n||e,d=p=>{if(!l)return p;let f={};return l.forEach(h=>{let m=typeof h=="string"?h:h.name,y=typeof h=="string"?void 0:h.skipIfDefault;if(m in p){let k=p[m];if(y!==void 0&&k===y)return;f[m]=k}}),f},u=c.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");return{parseMarkdown:(p,f)=>{let h={...a,...p.attributes};if(i)return f.createNode(e,h);let m=s?s(p):p.content||"";return m?f.createNode(e,h,[f.createTextNode(m)]):f.createNode(e,h,[])},markdownTokenizer:{name:e,level:"inline",start(p){let f=i?new RegExp(`\\[${u}\\s*[^\\]]*\\]`):new RegExp(`\\[${u}\\s*[^\\]]*\\][\\s\\S]*?\\[\\/${u}\\]`),h=p.match(f),m=h?.index;return m!==void 0?m:-1},tokenize(p,f,h){let m=i?new RegExp(`^\\[${u}\\s*([^\\]]*)\\]`):new RegExp(`^\\[${u}\\s*([^\\]]*)\\]([\\s\\S]*?)\\[\\/${u}\\]`),y=p.match(m);if(!y)return;let k="",S="";if(i){let[,D]=y;S=D}else{let[,D,E]=y;S=D,k=E||""}let T=o(S.trim());return{type:e,raw:y[0],content:k.trim(),attributes:T}}},renderMarkdown:p=>{let f="";s?f=s(p):p.content&&p.content.length>0&&(f=p.content.filter(k=>k.type==="text").map(k=>k.text).join(""));let h=d(p.attrs||{}),m=r(h),y=m?` ${m}`:"";return i?`[${c}${y}]`:`[${c}${y}]${f}[/${c}]`}}}function gi(t,e,n){var s,o,r,a;let i=t.split(`
`),l=[],c="",d=0,u=e.baseIndentSize||2;for(;d<i.length;){let p=i[d],f=p.match(e.itemPattern);if(!f){if(l.length>0)break;if(p.trim()===""){d+=1,c=`${c}${p}
`;continue}else return}let h=e.extractItemData(f),{indentLevel:m,mainContent:y}=h;c=`${c}${p}
`;let k=[y];for(d+=1;d<i.length;){let E=i[d];if(E.trim()===""){let w=i.slice(d+1).findIndex(z=>z.trim()!=="");if(w===-1)break;if((((o=(s=i[d+1+w].match(/^(\s*)/))==null?void 0:s[1])==null?void 0:o.length)||0)>m){k.push(E),c=`${c}${E}
`,d+=1;continue}else break}if((((a=(r=E.match(/^(\s*)/))==null?void 0:r[1])==null?void 0:a.length)||0)>m)k.push(E),c=`${c}${E}
`,d+=1;else break}let S,T=k.slice(1);if(T.length>0){let E=T.map(b=>b.slice(m+u)).join(`
`);E.trim()&&(e.customNestedParser?S=e.customNestedParser(E):S=n.blockTokens(E))}let D=e.createToken(h,S);l.push(D)}if(l.length!==0)return{items:l,raw:c}}function Lr(t,e,n,s){if(!t||!Array.isArray(t.content))return"";let o=typeof n=="function"?n(s):n,[r,...a]=t.content,i=e.renderChildren([r]),l=[`${o}${i}`];return a&&a.length>0&&a.forEach(c=>{let d=e.renderChildren([c]);if(d){let u=d.split(`
`).map(p=>p?e.indent(p):"").join(`
`);l.push(u)}}),l.join(`
`)}function XE(t,e,n={}){let{state:s}=e,{doc:o,tr:r}=s,a=t;o.descendants((i,l)=>{let c=r.mapping.map(l),d=r.mapping.map(l)+i.nodeSize,u=null;if(i.marks.forEach(f=>{if(f!==a)return!1;u=f}),!u)return;let p=!1;if(Object.keys(n).forEach(f=>{n[f]!==u.attrs[f]&&(p=!0)}),p){let f=t.type.create({...t.attrs,...n});r.removeMark(c,d,t.type),r.addMark(c,d,f)}}),r.docChanged&&e.view.dispatch(r)}var Ae=class Lg extends Id{constructor(){super(...arguments),this.type="node"}static create(e={}){let n=typeof e=="function"?e():e;return new Lg(n)}configure(e){return super.configure(e)}extend(e){let n=typeof e=="function"?e():e;return super.extend(n)}};function Xt(t){return new OE({find:t.find,handler:({state:e,range:n,match:s,pasteEvent:o})=>{let r=Se(t.getAttributes,void 0,s,o);if(r===!1||r===null)return null;let{tr:a}=e,i=s[s.length-1],l=s[0],c=n.to;if(i){let d=l.search(/\S/),u=n.from+l.indexOf(i),p=u+i.length;if(pi(n.from,n.to,e.doc).filter(h=>h.mark.type.excluded.find(y=>y===t.type&&y!==h.mark.type)).filter(h=>h.to>u).length)return null;p<n.to&&a.delete(p,n.to),u>n.from&&a.delete(n.from+d,u),c=n.from+d+i.length,a.addMark(n.from+d,c,t.type.create(r||{})),a.removeStoredMark(t.type)}}})}var Ao=(t,e)=>{if(t==="slot")return 0;if(t instanceof Function)return t(e);let{children:n,...s}=e??{};if(t==="svg")throw new Error("SVG elements are not supported in the JSX syntax, use the array syntax instead");return[t,s,n]};var ZE=/^\s*>\s$/,jg=Ae.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return Ao("blockquote",{...fe(this.options.HTMLAttributes,t),children:Ao("slot",{})})},parseMarkdown:(t,e)=>e.createNode("blockquote",void 0,e.parseChildren(t.tokens||[])),renderMarkdown:(t,e)=>{if(!t.content)return"";let n=">",s=[];return t.content.forEach(o=>{let i=e.renderChildren([o]).split(`
`).map(l=>l.trim()===""?n:`${n} ${l}`);s.push(i.join(`
`))}),s.join(`
${n}
`)},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[kn({find:ZE,type:this.type})]}});var QE=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))$/,ex=/(?:^|\s)(\*\*(?!\s+\*\*)((?:[^*]+))\*\*(?!\s+\*\*))/g,tx=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))$/,nx=/(?:^|\s)(__(?!\s+__)((?:[^_]+))__(?!\s+__))/g,Pg=Ht.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>t.style.fontWeight!=="normal"&&null},{style:"font-weight=400",clearMark:t=>t.type.name===this.name},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return Ao("strong",{...fe(this.options.HTMLAttributes,t),children:Ao("slot",{})})},markdownTokenName:"strong",parseMarkdown:(t,e)=>e.applyMark("bold",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`**${e.renderChildren(t)}**`,addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[yn({find:QE,type:this.type}),yn({find:tx,type:this.type})]},addPasteRules(){return[Xt({find:ex,type:this.type}),Xt({find:nx,type:this.type})]}});var sx=/(^|[^`])`([^`]+)`(?!`)$/,ox=/(^|[^`])`([^`]+)`(?!`)/g,Ng=Ht.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",fe(this.options.HTMLAttributes,t),0]},markdownTokenName:"codespan",parseMarkdown:(t,e)=>e.applyMark("code",[{type:"text",text:t.text||""}]),renderMarkdown:(t,e)=>t.content?`\`${e.renderChildren(t.content)}\``:"",addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[yn({find:sx,type:this.type})]},addPasteRules(){return[Xt({find:ox,type:this.type})]}});var Md=4,rx=/^```([a-z]+)?[\s\n]$/,ax=/^~~~([a-z]+)?[\s\n]$/,Bg=Ae.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,defaultLanguage:null,enableTabIndentation:!1,tabSize:Md,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:this.options.defaultLanguage,parseHTML:t=>{var e;let{languageClassPrefix:n}=this.options;if(!n)return null;let r=[...((e=t.firstElementChild)==null?void 0:e.classList)||[]].filter(a=>a.startsWith(n)).map(a=>a.replace(n,""))[0];return r||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",fe(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},markdownTokenName:"code",parseMarkdown:(t,e)=>{var n;return((n=t.raw)==null?void 0:n.startsWith("```"))===!1&&t.codeBlockStyle!=="indented"?[]:e.createNode("codeBlock",{language:t.lang||null},t.text?[e.createTextNode(t.text)]:[])},renderMarkdown:(t,e)=>{var n;let s="",o=((n=t.attrs)==null?void 0:n.language)||"";return t.content?s=[`\`\`\`${o}`,e.renderChildren(t.content),"```"].join(`
`):s=`\`\`\`${o}

\`\`\``,s},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{let{empty:t,$anchor:e}=this.editor.state.selection,n=e.pos===1;return!t||e.parent.type.name!==this.name?!1:n||!e.parent.textContent.length?this.editor.commands.clearNodes():!1},Tab:({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;let n=(e=this.options.tabSize)!=null?e:Md,{state:s}=t,{selection:o}=s,{$from:r,empty:a}=o;if(r.parent.type!==this.type)return!1;let i=" ".repeat(n);return a?t.commands.insertContent(i):t.commands.command(({tr:l})=>{let{from:c,to:d}=o,f=s.doc.textBetween(c,d,`
`,`
`).split(`
`).map(h=>i+h).join(`
`);return l.replaceWith(c,d,s.schema.text(f)),!0})},"Shift-Tab":({editor:t})=>{var e;if(!this.options.enableTabIndentation)return!1;let n=(e=this.options.tabSize)!=null?e:Md,{state:s}=t,{selection:o}=s,{$from:r,empty:a}=o;return r.parent.type!==this.type?!1:a?t.commands.command(({tr:i})=>{var l;let{pos:c}=r,d=r.start(),u=r.end(),f=s.doc.textBetween(d,u,`
`,`
`).split(`
`),h=0,m=0,y=c-d;for(let b=0;b<f.length;b+=1){if(m+f[b].length>=y){h=b;break}m+=f[b].length+1}let S=((l=f[h].match(/^ */))==null?void 0:l[0])||"",T=Math.min(S.length,n);if(T===0)return!0;let D=d;for(let b=0;b<h;b+=1)D+=f[b].length+1;return i.delete(D,D+T),c-D<=T&&i.setSelection(te.create(i.doc,D)),!0}):t.commands.command(({tr:i})=>{let{from:l,to:c}=o,p=s.doc.textBetween(l,c,`
`,`
`).split(`
`).map(f=>{var h;let m=((h=f.match(/^ */))==null?void 0:h[0])||"",y=Math.min(m.length,n);return f.slice(y)}).join(`
`);return i.replaceWith(l,c,s.schema.text(p)),!0})},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;let{state:e}=t,{selection:n}=e,{$from:s,empty:o}=n;if(!o||s.parent.type!==this.type)return!1;let r=s.parentOffset===s.parent.nodeSize-2,a=s.parent.textContent.endsWith(`

`);return!r||!a?!1:t.chain().command(({tr:i})=>(i.delete(s.pos-2,s.pos),!0)).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;let{state:e}=t,{selection:n,doc:s}=e,{$from:o,empty:r}=n;if(!r||o.parent.type!==this.type||!(o.parentOffset===o.parent.nodeSize-2))return!1;let i=o.after();return i===void 0?!1:s.nodeAt(i)?t.commands.command(({tr:c})=>(c.setSelection(re.near(s.resolve(i))),!0)):t.commands.exitCode()}}},addInputRules(){return[Mr({find:rx,type:this.type,getAttributes:t=>({language:t[1]})}),Mr({find:ax,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new ae({key:new pe("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData||this.editor.isActive(this.type.name))return!1;let n=e.clipboardData.getData("text/plain"),s=e.clipboardData.getData("vscode-editor-data"),o=s?JSON.parse(s):void 0,r=o?.mode;if(!n||!r)return!1;let{tr:a,schema:i}=t.state,l=i.text(n.replace(/\r\n?/g,`
`));return a.replaceSelectionWith(this.type.create({language:r},l)),a.selection.$from.parent.type!==this.type&&a.setSelection(te.near(a.doc.resolve(Math.max(0,a.selection.from-2)))),a.setMeta("paste",!0),t.dispatch(a),!0}}})]}});var Og=Ae.create({name:"doc",topNode:!0,content:"block+",renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`

`):""});var Rg=Ae.create({name:"hardBreak",markdownTokenName:"br",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,linebreakReplacement:!0,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",fe(this.options.HTMLAttributes,t)]},renderText(){return`
`},renderMarkdown:()=>`  
`,parseMarkdown:()=>({type:"hardBreak"}),addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:s})=>t.first([()=>t.exitCode(),()=>t.command(()=>{let{selection:o,storedMarks:r}=n;if(o.$from.parent.type.spec.isolating)return!1;let{keepMarks:a}=this.options,{splittableMarks:i}=s.extensionManager,l=r||o.$to.parentOffset&&o.$from.marks();return e().insertContent({type:this.name}).command(({tr:c,dispatch:d})=>{if(d&&l&&a){let u=l.filter(p=>i.includes(p.type.name));c.ensureMarks(u)}return!0}).run()})])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}});var $g=Ae.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map(t=>({tag:`h${t}`,attrs:{level:t}}))},renderHTML({node:t,HTMLAttributes:e}){return[`h${this.options.levels.includes(t.attrs.level)?t.attrs.level:this.options.levels[0]}`,fe(this.options.HTMLAttributes,e),0]},parseMarkdown:(t,e)=>e.createNode("heading",{level:t.depth||1},e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>{var n;let s=(n=t.attrs)!=null&&n.level?parseInt(t.attrs.level,10):1,o="#".repeat(s);return t.content?`${o} ${e.renderChildren(t.content)}`:""},addCommands(){return{setHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.setNode(this.name,t):!1,toggleHeading:t=>({commands:e})=>this.options.levels.includes(t.level)?e.toggleNode(this.name,"paragraph",t):!1}},addKeyboardShortcuts(){return this.options.levels.reduce((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})}),{})},addInputRules(){return this.options.levels.map(t=>Mr({find:new RegExp(`^(#{${Math.min(...this.options.levels)},${t}})\\s$`),type:this.type,getAttributes:{level:t}}))}});var Fg=Ae.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{},nextNodeType:"paragraph"}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",fe(this.options.HTMLAttributes,t)]},markdownTokenName:"hr",parseMarkdown:(t,e)=>e.createNode("horizontalRule"),renderMarkdown:()=>"---",addCommands(){return{setHorizontalRule:()=>({chain:t,state:e})=>{if(!Mg(e,e.schema.nodes[this.name]))return!1;let{selection:n}=e,{$to:s}=n,o=t();return fi(n)?o.insertContentAt(s.pos,{type:this.name}):o.insertContent({type:this.name}),o.command(({state:r,tr:a,dispatch:i})=>{if(i){let{$to:l}=a.selection,c=l.end();if(l.nodeAfter)l.nodeAfter.isTextblock?a.setSelection(te.create(a.doc,l.pos+1)):l.nodeAfter.isBlock?a.setSelection(Q.create(a.doc,l.pos)):a.setSelection(te.create(a.doc,l.pos));else{let d=r.schema.nodes[this.options.nextNodeType]||l.parent.type.contentMatch.defaultType,u=d?.create();u&&(a.insert(c,u),a.setSelection(te.create(a.doc,c+1)))}a.scrollIntoView()}return!0}).run()}}},addInputRules(){return[Ag({find:/^(?:---|-|___\s|\*\*\*\s)$/,type:this.type})]}});var ix=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))$/,lx=/(?:^|\s)(\*(?!\s+\*)((?:[^*]+))\*(?!\s+\*))/g,cx=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))$/,dx=/(?:^|\s)(_(?!\s+_)((?:[^_]+))_(?!\s+_))/g,zg=Ht.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>t.style.fontStyle!=="normal"&&null},{style:"font-style=normal",clearMark:t=>t.type.name===this.name},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",fe(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},markdownTokenName:"em",parseMarkdown:(t,e)=>e.applyMark("italic",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`*${e.renderChildren(t)}*`,addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[yn({find:ix,type:this.type}),yn({find:cx,type:this.type})]},addPasteRules(){return[Xt({find:lx,type:this.type}),Xt({find:dx,type:this.type})]}});var ux="aaa1rp3bb0ott3vie4c1le2ogado5udhabi7c0ademy5centure6ountant0s9o1tor4d0s1ult4e0g1ro2tna4f0l1rica5g0akhan5ency5i0g1rbus3force5tel5kdn3l0ibaba4pay4lfinanz6state5y2sace3tom5m0azon4ericanexpress7family11x2fam3ica3sterdam8nalytics7droid5quan4z2o0l2partments8p0le4q0uarelle8r0ab1mco4chi3my2pa2t0e3s0da2ia2sociates9t0hleta5torney7u0ction5di0ble3o3spost5thor3o0s4w0s2x0a2z0ure5ba0by2idu3namex4d1k2r0celona5laycard4s5efoot5gains6seball5ketball8uhaus5yern5b0c1t1va3cg1n2d1e0ats2uty4er2rlin4st0buy5t2f1g1h0arti5i0ble3d1ke2ng0o3o1z2j1lack0friday9ockbuster8g1omberg7ue3m0s1w2n0pparibas9o0ats3ehringer8fa2m1nd2o0k0ing5sch2tik2on4t1utique6x2r0adesco6idgestone9oadway5ker3ther5ussels7s1t1uild0ers6siness6y1zz3v1w1y1z0h3ca0b1fe2l0l1vinklein9m0era3p2non3petown5ital0one8r0avan4ds2e0er0s4s2sa1e1h1ino4t0ering5holic7ba1n1re3c1d1enter4o1rn3f0a1d2g1h0anel2nel4rity4se2t2eap3intai5ristmas6ome4urch5i0priani6rcle4sco3tadel4i0c2y3k1l0aims4eaning6ick2nic1que6othing5ud3ub0med6m1n1o0ach3des3ffee4llege4ogne5m0mbank4unity6pany2re3uter5sec4ndos3struction8ulting7tact3ractors9oking4l1p2rsica5untry4pon0s4rses6pa2r0edit0card4union9icket5own3s1uise0s6u0isinella9v1w1x1y0mru3ou3z2dad1nce3ta1e1ing3sun4y2clk3ds2e0al0er2s3gree4livery5l1oitte5ta3mocrat6ntal2ist5si0gn4v2hl2iamonds6et2gital5rect0ory7scount3ver5h2y2j1k1m1np2o0cs1tor4g1mains5t1wnload7rive4tv2ubai3nlop4pont4rban5vag2r2z2earth3t2c0o2deka3u0cation8e1g1mail3erck5nergy4gineer0ing9terprises10pson4quipment8r0icsson6ni3s0q1tate5t1u0rovision8s2vents5xchange6pert3osed4ress5traspace10fage2il1rwinds6th3mily4n0s2rm0ers5shion4t3edex3edback6rrari3ero6i0delity5o2lm2nal1nce1ial7re0stone6mdale6sh0ing5t0ness6j1k1lickr3ghts4r2orist4wers5y2m1o0o0d1tball6rd1ex2sale4um3undation8x2r0ee1senius7l1ogans4ntier7tr2ujitsu5n0d2rniture7tbol5yi3ga0l0lery3o1up4me0s3p1rden4y2b0iz3d0n2e0a1nt0ing5orge5f1g0ee3h1i0ft0s3ves2ing5l0ass3e1obal2o4m0ail3bh2o1x2n1odaddy5ld0point6f2o0dyear5g0le4p1t1v2p1q1r0ainger5phics5tis4een3ipe3ocery4up4s1t1u0cci3ge2ide2tars5ru3w1y2hair2mburg5ngout5us3bo2dfc0bank7ealth0care8lp1sinki6re1mes5iphop4samitsu7tachi5v2k0t2m1n1ockey4ldings5iday5medepot5goods5s0ense7nda3rse3spital5t0ing5t0els3mail5use3w2r1sbc3t1u0ghes5yatt3undai7ibm2cbc2e1u2d1e0ee3fm2kano4l1m0amat4db2mo0bilien9n0c1dustries8finiti5o2g1k1stitute6urance4e4t0ernational10uit4vestments10o1piranga7q1r0ish4s0maili5t0anbul7t0au2v3jaguar4va3cb2e0ep2tzt3welry6io2ll2m0p2nj2o0bs1urg4t1y2p0morgan6rs3uegos4niper7kaufen5ddi3e0rryhotels6properties14fh2g1h1i0a1ds2m1ndle4tchen5wi3m1n1oeln3matsu5sher5p0mg2n2r0d1ed3uokgroup8w1y0oto4z2la0caixa5mborghini8er3nd0rover6xess5salle5t0ino3robe5w0yer5b1c1ds2ease3clerc5frak4gal2o2xus4gbt3i0dl2fe0insurance9style7ghting6ke2lly3mited4o2ncoln4k2ve1ing5k1lc1p2oan0s3cker3us3l1ndon4tte1o3ve3pl0financial11r1s1t0d0a3u0ndbeck6xe1ury5v1y2ma0drid4if1son4keup4n0agement7go3p1rket0ing3s4riott5shalls7ttel5ba2c0kinsey7d1e0d0ia3et2lbourne7me1orial6n0u2rckmsd7g1h1iami3crosoft7l1ni1t2t0subishi9k1l0b1s2m0a2n1o0bi0le4da2e1i1m1nash3ey2ster5rmon3tgage6scow4to0rcycles9v0ie4p1q1r1s0d2t0n1r2u0seum3ic4v1w1x1y1z2na0b1goya4me2vy3ba2c1e0c1t0bank4flix4work5ustar5w0s2xt0direct7us4f0l2g0o2hk2i0co2ke1on3nja3ssan1y5l1o0kia3rton4w0ruz3tv4p1r0a1w2tt2u1yc2z2obi1server7ffice5kinawa6layan0group9lo3m0ega4ne1g1l0ine5oo2pen3racle3nge4g0anic5igins6saka4tsuka4t2vh3pa0ge2nasonic7ris2s1tners4s1y3y2ccw3e0t2f0izer5g1h0armacy6d1ilips5one2to0graphy6s4ysio5ics1tet2ures6d1n0g1k2oneer5zza4k1l0ace2y0station9umbing5s3m1n0c2ohl2ker3litie5rn2st3r0axi3ess3ime3o0d0uctions8f1gressive8mo2perties3y5tection8u0dential9s1t1ub2w0c2y2qa1pon3uebec3st5racing4dio4e0ad1lestate6tor2y4cipes5d0stone5umbrella9hab3ise0n3t2liance6n0t0als5pair3ort3ublican8st0aurant8view0s5xroth6ich0ardli6oh3l1o1p2o0cks3deo3gers4om3s0vp3u0gby3hr2n2w0e2yukyu6sa0arland6fe0ty4kura4le1on3msclub4ung5ndvik0coromant12ofi4p1rl2s1ve2xo3b0i1s2c0b1haeffler7midt4olarships8ol3ule3warz5ience5ot3d1e0arch3t2cure1ity6ek2lect4ner3rvices6ven3w1x0y3fr2g1h0angrila6rp3ell3ia1ksha5oes2p0ping5uji3w3i0lk2na1gles5te3j1k0i0n2y0pe4l0ing4m0art3ile4n0cf3o0ccer3ial4ftbank4ware6hu2lar2utions7ng1y2y2pa0ce3ort2t3r0l2s1t0ada2ples4r1tebank4farm7c0group6ockholm6rage3e3ream4udio2y3yle4u0cks3pplies3y2ort5rf1gery5zuki5v1watch4iss4x1y0dney4stems6z2tab1ipei4lk2obao4rget4tamotors6r2too4x0i3c0i2d0k2eam2ch0nology8l1masek5nnis4va3f1g1h0d1eater2re6iaa2ckets5enda4ps2res2ol4j0maxx4x2k0maxx5l1m0all4n1o0day3kyo3ols3p1ray3shiba5tal3urs3wn2yota3s3r0ade1ing4ining5vel0ers0insurance16ust3v2t1ube2i1nes3shu4v0s2w1z2ua1bank3s2g1k1nicom3versity8o2ol2ps2s1y1z2va0cations7na1guard7c1e0gas3ntures6risign5m\xF6gensberater2ung14sicherung10t2g1i0ajes4deo3g1king4llas4n1p1rgin4sa1ion4va1o3laanderen9n1odka3lvo3te1ing3o2yage5u2wales2mart4ter4ng0gou5tch0es6eather0channel12bcam3er2site5d0ding5ibo2r3f1hoswho6ien2ki2lliamhill9n0dows4e1ners6me2olterskluwer11odside6rk0s2ld3w2s1tc1f3xbox3erox4ihuan4n2xx2yz3yachts4hoo3maxun5ndex5e1odobashi7ga2kohama6u0tube6t1un3za0ppos4ra3ero3ip2m1one3uerich6w2",px="\u03B5\u03BB1\u03C52\u0431\u04331\u0435\u043B3\u0434\u0435\u0442\u04384\u0435\u044E2\u043A\u0430\u0442\u043E\u043B\u0438\u043A6\u043E\u043C3\u043C\u043A\u04342\u043E\u043D1\u0441\u043A\u0432\u04306\u043E\u043D\u043B\u0430\u0439\u043D5\u0440\u04333\u0440\u0443\u04412\u04442\u0441\u0430\u0439\u04423\u0440\u04313\u0443\u043A\u04403\u049B\u0430\u04373\u0570\u0561\u05753\u05D9\u05E9\u05E8\u05D0\u05DC5\u05E7\u05D5\u05DD3\u0627\u0628\u0648\u0638\u0628\u064A5\u0631\u0627\u0645\u0643\u06485\u0644\u0627\u0631\u062F\u06464\u0628\u062D\u0631\u064A\u06465\u062C\u0632\u0627\u0626\u06315\u0633\u0639\u0648\u062F\u064A\u06296\u0639\u0644\u064A\u0627\u06465\u0645\u063A\u0631\u06285\u0645\u0627\u0631\u0627\u062A5\u06CC\u0631\u0627\u06465\u0628\u0627\u0631\u062A2\u0632\u0627\u06314\u064A\u062A\u06433\u06BE\u0627\u0631\u062A5\u062A\u0648\u0646\u06334\u0633\u0648\u062F\u0627\u06463\u0631\u064A\u06295\u0634\u0628\u0643\u06294\u0639\u0631\u0627\u06422\u06282\u0645\u0627\u06464\u0641\u0644\u0633\u0637\u064A\u06466\u0642\u0637\u06313\u0643\u0627\u062B\u0648\u0644\u064A\u06436\u0648\u06453\u0645\u0635\u06312\u0644\u064A\u0633\u064A\u06275\u0648\u0631\u064A\u062A\u0627\u0646\u064A\u06277\u0642\u06394\u0647\u0645\u0631\u0627\u06475\u067E\u0627\u06A9\u0633\u062A\u0627\u06467\u0680\u0627\u0631\u062A4\u0915\u0949\u092E3\u0928\u0947\u091F3\u092D\u093E\u0930\u09240\u092E\u094D3\u094B\u09245\u0938\u0902\u0917\u0920\u09285\u09AC\u09BE\u0982\u09B2\u09BE5\u09AD\u09BE\u09B0\u09A42\u09F0\u09A44\u0A2D\u0A3E\u0A30\u0A244\u0AAD\u0ABE\u0AB0\u0AA44\u0B2D\u0B3E\u0B30\u0B244\u0B87\u0BA8\u0BCD\u0BA4\u0BBF\u0BAF\u0BBE6\u0BB2\u0B99\u0BCD\u0B95\u0BC86\u0B9A\u0BBF\u0B99\u0BCD\u0B95\u0BAA\u0BCD\u0BAA\u0BC2\u0BB0\u0BCD11\u0C2D\u0C3E\u0C30\u0C24\u0C4D5\u0CAD\u0CBE\u0CB0\u0CA44\u0D2D\u0D3E\u0D30\u0D24\u0D025\u0DBD\u0D82\u0D9A\u0DCF4\u0E04\u0E2D\u0E213\u0E44\u0E17\u0E223\u0EA5\u0EB2\u0EA73\u10D2\u10D42\u307F\u3093\u306A3\u30A2\u30DE\u30BE\u30F34\u30AF\u30E9\u30A6\u30C94\u30B0\u30FC\u30B0\u30EB4\u30B3\u30E02\u30B9\u30C8\u30A23\u30BB\u30FC\u30EB3\u30D5\u30A1\u30C3\u30B7\u30E7\u30F36\u30DD\u30A4\u30F3\u30C84\u4E16\u754C2\u4E2D\u4FE11\u56FD1\u570B1\u6587\u7F513\u4E9A\u9A6C\u900A3\u4F01\u4E1A2\u4F5B\u5C712\u4FE1\u606F2\u5065\u5EB72\u516B\u53662\u516C\u53F81\u76CA2\u53F0\u6E7E1\u70632\u5546\u57CE1\u5E971\u68072\u5609\u91CC0\u5927\u9152\u5E975\u5728\u7EBF2\u5927\u62FF2\u5929\u4E3B\u65593\u5A31\u4E502\u5BB6\u96FB2\u5E7F\u4E1C2\u5FAE\u535A2\u6148\u55842\u6211\u7231\u4F603\u624B\u673A2\u62DB\u80582\u653F\u52A11\u5E9C2\u65B0\u52A0\u57612\u95FB2\u65F6\u5C1A2\u66F8\u7C4D2\u673A\u67842\u6DE1\u9A6C\u95213\u6E38\u620F2\u6FB3\u95802\u70B9\u770B2\u79FB\u52A82\u7EC4\u7EC7\u673A\u67844\u7F51\u57401\u5E971\u7AD91\u7EDC2\u8054\u901A2\u8C37\u6B4C2\u8D2D\u72692\u901A\u8CA92\u96C6\u56E22\u96FB\u8A0A\u76C8\u79D14\u98DE\u5229\u6D663\u98DF\u54C12\u9910\u53852\u9999\u683C\u91CC\u62C93\u6E2F2\uB2F7\uB1371\uCEF42\uC0BC\uC1312\uD55C\uAD6D2",Rd="numeric",$d="ascii",Fd="alpha",Nr="asciinumeric",Pr="alphanumeric",zd="domain",Kg="emoji",fx="scheme",hx="slashscheme",Ld="whitespace";function mx(t,e){return t in e||(e[t]=[]),e[t]}function _s(t,e,n){e[Rd]&&(e[Nr]=!0,e[Pr]=!0),e[$d]&&(e[Nr]=!0,e[Fd]=!0),e[Nr]&&(e[Pr]=!0),e[Fd]&&(e[Pr]=!0),e[Pr]&&(e[zd]=!0),e[Kg]&&(e[zd]=!0);for(let s in e){let o=mx(s,n);o.indexOf(t)<0&&o.push(t)}}function gx(t,e){let n={};for(let s in e)e[s].indexOf(t)>=0&&(n[s]=!0);return n}function Nt(t=null){this.j={},this.jr=[],this.jd=null,this.t=t}Nt.groups={};Nt.prototype={accepts(){return!!this.t},go(t){let e=this,n=e.j[t];if(n)return n;for(let s=0;s<e.jr.length;s++){let o=e.jr[s][0],r=e.jr[s][1];if(r&&o.test(t))return r}return e.jd},has(t,e=!1){return e?t in this.j:!!this.go(t)},ta(t,e,n,s){for(let o=0;o<t.length;o++)this.tt(t[o],e,n,s)},tr(t,e,n,s){s=s||Nt.groups;let o;return e&&e.j?o=e:(o=new Nt(e),n&&s&&_s(e,n,s)),this.jr.push([t,o]),o},ts(t,e,n,s){let o=this,r=t.length;if(!r)return o;for(let a=0;a<r-1;a++)o=o.tt(t[a]);return o.tt(t[r-1],e,n,s)},tt(t,e,n,s){s=s||Nt.groups;let o=this;if(e&&e.j)return o.j[t]=e,e;let r=e,a,i=o.go(t);if(i?(a=new Nt,Object.assign(a.j,i.j),a.jr.push.apply(a.jr,i.jr),a.jd=i.jd,a.t=i.t):a=new Nt,r){if(s)if(a.t&&typeof a.t=="string"){let l=Object.assign(gx(a.t,s),n);_s(r,l,s)}else n&&_s(r,n,s);a.t=r}return o.j[t]=a,a}};var ue=(t,e,n,s,o)=>t.ta(e,n,s,o),He=(t,e,n,s,o)=>t.tr(e,n,s,o),Hg=(t,e,n,s,o)=>t.ts(e,n,s,o),$=(t,e,n,s,o)=>t.tt(e,n,s,o),_n="WORD",Hd="UWORD",Jg="ASCIINUMERICAL",Gg="ALPHANUMERICAL",zr="LOCALHOST",qd="TLD",Ud="UTLD",vi="SCHEME",Mo="SLASH_SCHEME",Vd="NUM",_d="WS",Wd="NL",Br="OPENBRACE",Or="CLOSEBRACE",wi="OPENBRACKET",Si="CLOSEBRACKET",Ei="OPENPAREN",xi="CLOSEPAREN",Ti="OPENANGLEBRACKET",Di="CLOSEANGLEBRACKET",Ii="FULLWIDTHLEFTPAREN",Ci="FULLWIDTHRIGHTPAREN",Ai="LEFTCORNERBRACKET",Mi="RIGHTCORNERBRACKET",Li="LEFTWHITECORNERBRACKET",ji="RIGHTWHITECORNERBRACKET",Pi="FULLWIDTHLESSTHAN",Ni="FULLWIDTHGREATERTHAN",Bi="AMPERSAND",Oi="APOSTROPHE",Ri="ASTERISK",us="AT",$i="BACKSLASH",Fi="BACKTICK",zi="CARET",ps="COLON",Kd="COMMA",Hi="DOLLAR",bn="DOT",qi="EQUALS",Jd="EXCLAMATION",Qt="HYPHEN",Rr="PERCENT",Ui="PIPE",_i="PLUS",Vi="POUND",$r="QUERY",Gd="QUOTE",Yg="FULLWIDTHMIDDLEDOT",Yd="SEMI",vn="SLASH",Fr="TILDE",Wi="UNDERSCORE",Xg="EMOJI",Ki="SYM",Zg=Object.freeze({__proto__:null,ALPHANUMERICAL:Gg,AMPERSAND:Bi,APOSTROPHE:Oi,ASCIINUMERICAL:Jg,ASTERISK:Ri,AT:us,BACKSLASH:$i,BACKTICK:Fi,CARET:zi,CLOSEANGLEBRACKET:Di,CLOSEBRACE:Or,CLOSEBRACKET:Si,CLOSEPAREN:xi,COLON:ps,COMMA:Kd,DOLLAR:Hi,DOT:bn,EMOJI:Xg,EQUALS:qi,EXCLAMATION:Jd,FULLWIDTHGREATERTHAN:Ni,FULLWIDTHLEFTPAREN:Ii,FULLWIDTHLESSTHAN:Pi,FULLWIDTHMIDDLEDOT:Yg,FULLWIDTHRIGHTPAREN:Ci,HYPHEN:Qt,LEFTCORNERBRACKET:Ai,LEFTWHITECORNERBRACKET:Li,LOCALHOST:zr,NL:Wd,NUM:Vd,OPENANGLEBRACKET:Ti,OPENBRACE:Br,OPENBRACKET:wi,OPENPAREN:Ei,PERCENT:Rr,PIPE:Ui,PLUS:_i,POUND:Vi,QUERY:$r,QUOTE:Gd,RIGHTCORNERBRACKET:Mi,RIGHTWHITECORNERBRACKET:ji,SCHEME:vi,SEMI:Yd,SLASH:vn,SLASH_SCHEME:Mo,SYM:Ki,TILDE:Fr,TLD:qd,UNDERSCORE:Wi,UTLD:Ud,UWORD:Hd,WORD:_n,WS:_d}),qn=/[a-z]/,jr=/\p{L}/u,jd=/\p{Emoji}/u;var Un=/\d/,Pd=/\s/;var qg="\r",Nd=`
`,yx="\uFE0F",kx="\u200D",Bd="\uFFFC",yi=null,ki=null;function bx(t=[]){let e={};Nt.groups=e;let n=new Nt;yi==null&&(yi=Ug(ux)),ki==null&&(ki=Ug(px)),$(n,"'",Oi),$(n,"{",Br),$(n,"}",Or),$(n,"[",wi),$(n,"]",Si),$(n,"(",Ei),$(n,")",xi),$(n,"<",Ti),$(n,">",Di),$(n,"\uFF08",Ii),$(n,"\uFF09",Ci),$(n,"\u300C",Ai),$(n,"\u300D",Mi),$(n,"\u300E",Li),$(n,"\u300F",ji),$(n,"\uFF1C",Pi),$(n,"\uFF1E",Ni),$(n,"&",Bi),$(n,"*",Ri),$(n,"@",us),$(n,"`",Fi),$(n,"^",zi),$(n,":",ps),$(n,",",Kd),$(n,"$",Hi),$(n,".",bn),$(n,"=",qi),$(n,"!",Jd),$(n,"-",Qt),$(n,"%",Rr),$(n,"|",Ui),$(n,"+",_i),$(n,"#",Vi),$(n,"?",$r),$(n,'"',Gd),$(n,"/",vn),$(n,";",Yd),$(n,"~",Fr),$(n,"_",Wi),$(n,"\\",$i),$(n,"\u30FB",Yg);let s=He(n,Un,Vd,{[Rd]:!0});He(s,Un,s);let o=He(s,qn,Jg,{[Nr]:!0}),r=He(s,jr,Gg,{[Pr]:!0}),a=He(n,qn,_n,{[$d]:!0});He(a,Un,o),He(a,qn,a),He(o,Un,o),He(o,qn,o);let i=He(n,jr,Hd,{[Fd]:!0});He(i,qn),He(i,Un,r),He(i,jr,i),He(r,Un,r),He(r,qn),He(r,jr,r);let l=$(n,Nd,Wd,{[Ld]:!0}),c=$(n,qg,_d,{[Ld]:!0}),d=He(n,Pd,_d,{[Ld]:!0});$(n,Bd,d),$(c,Nd,l),$(c,Bd,d),He(c,Pd,d),$(d,qg),$(d,Nd),He(d,Pd,d),$(d,Bd,d);let u=He(n,jd,Xg,{[Kg]:!0});$(u,"#"),He(u,jd,u),$(u,yx,u);let p=$(u,kx);$(p,"#"),He(p,jd,u);let f=[[qn,a],[Un,o]],h=[[qn,null],[jr,i],[Un,r]];for(let m=0;m<yi.length;m++)ds(n,yi[m],qd,_n,f);for(let m=0;m<ki.length;m++)ds(n,ki[m],Ud,Hd,h);_s(qd,{tld:!0,ascii:!0},e),_s(Ud,{utld:!0,alpha:!0},e),ds(n,"file",vi,_n,f),ds(n,"mailto",vi,_n,f),ds(n,"http",Mo,_n,f),ds(n,"https",Mo,_n,f),ds(n,"ftp",Mo,_n,f),ds(n,"ftps",Mo,_n,f),_s(vi,{scheme:!0,ascii:!0},e),_s(Mo,{slashscheme:!0,ascii:!0},e),t=t.sort((m,y)=>m[0]>y[0]?1:-1);for(let m=0;m<t.length;m++){let y=t[m][0],S=t[m][1]?{[fx]:!0}:{[hx]:!0};y.indexOf("-")>=0?S[zd]=!0:qn.test(y)?Un.test(y)?S[Nr]=!0:S[$d]=!0:S[Rd]=!0,Hg(n,y,y,S)}return Hg(n,"localhost",zr,{ascii:!0}),n.jd=new Nt(Ki),{start:n,tokens:Object.assign({groups:e},Zg)}}function Qg(t,e){let n=vx(e.replace(/[A-Z]/g,i=>i.toLowerCase())),s=n.length,o=[],r=0,a=0;for(;a<s;){let i=t,l=null,c=0,d=null,u=-1,p=-1;for(;a<s&&(l=i.go(n[a]));)i=l,i.accepts()?(u=0,p=0,d=i):u>=0&&(u+=n[a].length,p++),c+=n[a].length,r+=n[a].length,a++;r-=u,a-=p,c-=u,o.push({t:d.t,v:e.slice(r-c,r),s:r-c,e:r})}return o}function vx(t){let e=[],n=t.length,s=0;for(;s<n;){let o=t.charCodeAt(s),r,a=o<55296||o>56319||s+1===n||(r=t.charCodeAt(s+1))<56320||r>57343?t[s]:t.slice(s,s+2);e.push(a),s+=a.length}return e}function ds(t,e,n,s,o){let r,a=e.length;for(let i=0;i<a-1;i++){let l=e[i];t.j[l]?r=t.j[l]:(r=new Nt(s),r.jr=o.slice(),t.j[l]=r),t=r}return r=new Nt(n),r.jr=o.slice(),t.j[e[a-1]]=r,r}function Ug(t){let e=[],n=[],s=0,o="0123456789";for(;s<t.length;){let r=0;for(;o.indexOf(t[s+r])>=0;)r++;if(r>0){e.push(n.join(""));for(let a=parseInt(t.substring(s,s+r),10);a>0;a--)n.pop();s+=r}else n.push(t[s]),s++}return e}var Hr={defaultProtocol:"http",events:null,format:_g,formatHref:_g,nl2br:!1,tagName:"a",target:null,rel:null,validate:!0,truncate:1/0,className:null,attributes:null,ignoreTags:[],render:null};function Xd(t,e=null){let n=Object.assign({},Hr);t&&(n=Object.assign(n,t instanceof Xd?t.o:t));let s=n.ignoreTags,o=[];for(let r=0;r<s.length;r++)o.push(s[r].toUpperCase());this.o=n,e&&(this.defaultRender=e),this.ignoreTags=o}Xd.prototype={o:Hr,ignoreTags:[],defaultRender(t){return t},check(t){return this.get("validate",t.toString(),t)},get(t,e,n){let s=e!=null,o=this.o[t];return o&&(typeof o=="object"?(o=n.t in o?o[n.t]:Hr[t],typeof o=="function"&&s&&(o=o(e,n))):typeof o=="function"&&s&&(o=o(e,n.t,n)),o)},getObj(t,e,n){let s=this.o[t];return typeof s=="function"&&e!=null&&(s=s(e,n.t,n)),s},render(t){let e=t.render(this);return(this.get("render",null,t)||this.defaultRender)(e,t.t,t)}};function _g(t){return t}function ey(t,e){this.t="token",this.v=t,this.tk=e}ey.prototype={isLink:!1,toString(){return this.v},toHref(t){return this.toString()},toFormattedString(t){let e=this.toString(),n=t.get("truncate",e,this),s=t.get("format",e,this);return n&&s.length>n?s.substring(0,n)+"\u2026":s},toFormattedHref(t){return t.get("formatHref",this.toHref(t.get("defaultProtocol")),this)},startIndex(){return this.tk[0].s},endIndex(){return this.tk[this.tk.length-1].e},toObject(t=Hr.defaultProtocol){return{type:this.t,value:this.toString(),isLink:this.isLink,href:this.toHref(t),start:this.startIndex(),end:this.endIndex()}},toFormattedObject(t){return{type:this.t,value:this.toFormattedString(t),isLink:this.isLink,href:this.toFormattedHref(t),start:this.startIndex(),end:this.endIndex()}},validate(t){return t.get("validate",this.toString(),this)},render(t){let e=this,n=this.toHref(t.get("defaultProtocol")),s=t.get("formatHref",n,this),o=t.get("tagName",n,e),r=this.toFormattedString(t),a={},i=t.get("className",n,e),l=t.get("target",n,e),c=t.get("rel",n,e),d=t.getObj("attributes",n,e),u=t.getObj("events",n,e);return a.href=s,i&&(a.class=i),l&&(a.target=l),c&&(a.rel=c),d&&Object.assign(a,d),{tagName:o,attributes:a,content:r,eventListeners:u}}};function Ji(t,e){class n extends ey{constructor(o,r){super(o,r),this.t=t}}for(let s in e)n.prototype[s]=e[s];return n.t=t,n}var Vg=Ji("email",{isLink:!0,toHref(){return"mailto:"+this.toString()}}),Wg=Ji("text"),wx=Ji("nl"),bi=Ji("url",{isLink:!0,toHref(t=Hr.defaultProtocol){return this.hasProtocol()?this.v:`${t}://${this.v}`},hasProtocol(){let t=this.tk;return t.length>=2&&t[0].t!==zr&&t[1].t===ps}});var Zt=t=>new Nt(t);function Sx({groups:t}){let e=t.domain.concat([Bi,Ri,us,$i,Fi,zi,Hi,qi,Qt,Vd,Rr,Ui,_i,Vi,vn,Ki,Fr,Wi]),n=[Oi,ps,Kd,bn,Jd,Rr,$r,Gd,Yd,Ti,Di,Br,Or,Si,wi,Ei,xi,Ii,Ci,Ai,Mi,Li,ji,Pi,Ni],s=[Bi,Oi,Ri,$i,Fi,zi,Hi,qi,Qt,Br,Or,Rr,Ui,_i,Vi,$r,vn,Ki,Fr,Wi],o=Zt(),r=$(o,Fr);ue(r,s,r),ue(r,t.domain,r);let a=Zt(),i=Zt(),l=Zt();ue(o,t.domain,a),ue(o,t.scheme,i),ue(o,t.slashscheme,l),ue(a,s,r),ue(a,t.domain,a);let c=$(a,us);$(r,us,c),$(i,us,c),$(l,us,c);let d=$(r,bn);ue(d,s,r),ue(d,t.domain,r);let u=Zt();ue(c,t.domain,u),ue(u,t.domain,u);let p=$(u,bn);ue(p,t.domain,u);let f=Zt(Vg);ue(p,t.tld,f),ue(p,t.utld,f),$(c,zr,f);let h=$(u,Qt);$(h,Qt,h),ue(h,t.domain,u),ue(f,t.domain,u),$(f,bn,p),$(f,Qt,h);let m=$(f,ps);ue(m,t.numeric,Vg);let y=$(a,Qt),k=$(a,bn);$(y,Qt,y),ue(y,t.domain,a),ue(k,s,r),ue(k,t.domain,a);let S=Zt(bi);ue(k,t.tld,S),ue(k,t.utld,S),ue(S,t.domain,a),ue(S,s,r),$(S,bn,k),$(S,Qt,y),$(S,us,c);let T=$(S,ps),D=Zt(bi);ue(T,t.numeric,D);let E=Zt(bi),b=Zt();ue(E,e,E),ue(E,n,b),ue(b,e,E),ue(b,n,b),$(S,vn,E),$(D,vn,E);let w=$(i,ps),I=$(l,ps),M=$(I,vn),z=$(M,vn);ue(i,t.domain,a),$(i,bn,k),$(i,Qt,y),ue(l,t.domain,a),$(l,bn,k),$(l,Qt,y),ue(w,t.domain,E),$(w,vn,E),$(w,$r,E),ue(z,t.domain,E),ue(z,e,E),$(z,vn,E);let _=[[Br,Or],[wi,Si],[Ei,xi],[Ti,Di],[Ii,Ci],[Ai,Mi],[Li,ji],[Pi,Ni]];for(let x=0;x<_.length;x++){let[j,U]=_[x],W=$(E,j);$(b,j,W),$(W,U,E);let Z=Zt(bi);ue(W,e,Z);let F=Zt();ue(W,n),ue(Z,e,Z),ue(Z,n,F),ue(F,e,Z),ue(F,n,F),$(Z,U,E),$(F,U,E)}return $(o,zr,S),$(o,Wd,wx),{start:o,tokens:Zg}}function Ex(t,e,n){let s=n.length,o=0,r=[],a=[];for(;o<s;){let i=t,l=null,c=null,d=0,u=null,p=-1;for(;o<s&&!(l=i.go(n[o].t));)a.push(n[o++]);for(;o<s&&(c=l||i.go(n[o].t));)l=null,i=c,i.accepts()?(p=0,u=i):p>=0&&p++,o++,d++;if(p<0)o-=d,o<s&&(a.push(n[o]),o++);else{a.length>0&&(r.push(Od(Wg,e,a)),a=[]),o-=p,d-=p;let f=u.t,h=n.slice(o-d,o);r.push(Od(f,e,h))}}return a.length>0&&r.push(Od(Wg,e,a)),r}function Od(t,e,n){let s=n[0].s,o=n[n.length-1].e,r=e.slice(s,o);return new t(r,n)}var xx=typeof console<"u"&&console&&console.warn||(()=>{}),Tx="until manual call of linkify.init(). Register all schemes and plugins before invoking linkify the first time.",Le={scanner:null,parser:null,tokenQueue:[],pluginQueue:[],customSchemes:[],initialized:!1};function ty(){return Nt.groups={},Le.scanner=null,Le.parser=null,Le.tokenQueue=[],Le.pluginQueue=[],Le.customSchemes=[],Le.initialized=!1,Le}function Zd(t,e=!1){if(Le.initialized&&xx(`linkifyjs: already initialized - will not register custom scheme "${t}" ${Tx}`),!/^[0-9a-z]+(-[0-9a-z]+)*$/.test(t))throw new Error(`linkifyjs: incorrect scheme format.
1. Must only contain digits, lowercase ASCII letters or "-"
2. Cannot start or end with "-"
3. "-" cannot repeat`);Le.customSchemes.push([t,e])}function Dx(){Le.scanner=bx(Le.customSchemes);for(let t=0;t<Le.tokenQueue.length;t++)Le.tokenQueue[t][1]({scanner:Le.scanner});Le.parser=Sx(Le.scanner.tokens);for(let t=0;t<Le.pluginQueue.length;t++)Le.pluginQueue[t][1]({scanner:Le.scanner,parser:Le.parser});return Le.initialized=!0,Le}function Gi(t){return Le.initialized||Dx(),Ex(Le.parser.start,t,Qg(Le.scanner.start,t))}Gi.scan=Qg;function Yi(t,e=null,n=null){if(e&&typeof e=="object"){if(n)throw Error(`linkifyjs: Invalid link type ${e}; must be a string`);n=e,e=null}let s=new Xd(n),o=Gi(t),r=[];for(let a=0;a<o.length;a++){let i=o[a];i.isLink&&(!e||i.t===e)&&s.check(i)&&r.push(i.toFormattedObject(s))}return r}var Qd="[\0- \xA0\u1680\u180E\u2000-\u2029\u205F\u3000]",Ix=new RegExp(Qd),Cx=new RegExp(`${Qd}$`),Ax=new RegExp(Qd,"g");function Mx(t){return t.length===1?t[0].isLink:t.length===3&&t[1].isLink?["()","[]"].includes(t[0].value+t[2].value):!1}function Lx(t){return new ae({key:new pe("autolink"),appendTransaction:(e,n,s)=>{let o=e.some(c=>c.docChanged)&&!n.doc.eq(s.doc),r=e.some(c=>c.getMeta("preventAutolink"));if(!o||r)return;let{tr:a}=s,i=Sd(n.doc,[...e]);if(Dd(i).forEach(({newRange:c})=>{let d=sg(s.doc,c,f=>f.isTextblock),u,p;if(d.length>1)u=d[0],p=s.doc.textBetween(u.pos,u.pos+u.node.nodeSize,void 0," ");else if(d.length){let f=s.doc.textBetween(c.from,c.to," "," ");if(!Cx.test(f))return;u=d[0],p=s.doc.textBetween(u.pos,c.to,void 0," ")}if(u&&p){let f=p.split(Ix).filter(Boolean);if(f.length<=0)return!1;let h=f[f.length-1],m=u.pos+p.lastIndexOf(h);if(!h)return!1;let y=Gi(h).map(k=>k.toObject(t.defaultProtocol));if(!Mx(y))return!1;y.filter(k=>k.isLink).map(k=>({...k,from:m+k.start+1,to:m+k.end+1})).filter(k=>s.schema.marks.code?!s.doc.rangeHasMark(k.from,k.to,s.schema.marks.code):!0).filter(k=>t.validate(k.value)).filter(k=>t.shouldAutoLink(k.value)).forEach(k=>{pi(k.from,k.to,s.doc).some(S=>S.mark.type===t.type)||a.addMark(k.from,k.to,t.type.create({href:k.href}))})}}),!!a.steps.length)return a}})}function jx(t){return new ae({key:new pe("handleClickLink"),props:{handleClick:(e,n,s)=>{var o,r;if(s.button!==0||!e.editable)return!1;let a=null;if(s.target instanceof HTMLAnchorElement)a=s.target;else{let l=s.target;if(!l)return!1;let c=t.editor.view.dom;a=l.closest("a"),a&&!c.contains(a)&&(a=null)}if(!a)return!1;let i=!1;if(t.enableClickSelection&&(i=t.editor.commands.extendMarkRange(t.type.name)),t.openOnClick){let l=Td(e.state,t.type.name),c=(o=a.href)!=null?o:l.href,d=(r=a.target)!=null?r:l.target;c&&(window.open(c,d),i=!0)}return i}}})}function Px(t){return new ae({key:new pe("handlePasteLink"),props:{handlePaste:(e,n,s)=>{let{shouldAutoLink:o}=t,{state:r}=e,{selection:a}=r,{empty:i}=a;if(i)return!1;let l="";s.content.forEach(d=>{l+=d.textContent});let c=Yi(l,{defaultProtocol:t.defaultProtocol}).find(d=>d.isLink&&d.value===l);return!l||!c||o!==void 0&&!o(c.value)?!1:t.editor.commands.setMark(t.type,{href:c.href})}}})}function Vs(t,e){let n=["http","https","ftp","ftps","mailto","tel","callto","sms","cid","xmpp"];return e&&e.forEach(s=>{let o=typeof s=="string"?s:s.scheme;o&&n.push(o)}),!t||t.replace(Ax,"").match(new RegExp(`^(?:(?:${n.join("|")}):|[^a-z]|[a-z0-9+.-]+(?:[^a-z+.-:]|$))`,"i"))}var eu=Ht.create({name:"link",priority:1e3,keepOnSplit:!1,exitable:!0,onCreate(){this.options.validate&&!this.options.shouldAutoLink&&(this.options.shouldAutoLink=this.options.validate,console.warn("The `validate` option is deprecated. Rename to the `shouldAutoLink` option instead.")),this.options.protocols.forEach(t=>{if(typeof t=="string"){Zd(t);return}Zd(t.scheme,t.optionalSlashes)})},onDestroy(){ty()},inclusive(){return this.options.autolink},addOptions(){return{openOnClick:!0,enableClickSelection:!1,linkOnPaste:!0,autolink:!0,protocols:[],defaultProtocol:"http",HTMLAttributes:{target:"_blank",rel:"noopener noreferrer nofollow",class:null},isAllowedUri:(t,e)=>!!Vs(t,e.protocols),validate:t=>!!t,shouldAutoLink:t=>{let e=/^[a-z][a-z0-9+.-]*:\/\//i.test(t),n=/^[a-z][a-z0-9+.-]*:/i.test(t);if(e||n&&!t.includes("@"))return!0;let o=(t.includes("@")?t.split("@").pop():t).split(/[/?#:]/)[0];return!(/^\d{1,3}(\.\d{1,3}){3}$/.test(o)||!/\./.test(o))}}},addAttributes(){return{href:{default:null,parseHTML(t){return t.getAttribute("href")}},target:{default:this.options.HTMLAttributes.target},rel:{default:this.options.HTMLAttributes.rel},class:{default:this.options.HTMLAttributes.class},title:{default:null}}},parseHTML(){return[{tag:"a[href]",getAttrs:t=>{let e=t.getAttribute("href");return!e||!this.options.isAllowedUri(e,{defaultValidate:n=>!!Vs(n,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:null}}]},renderHTML({HTMLAttributes:t}){return this.options.isAllowedUri(t.href,{defaultValidate:e=>!!Vs(e,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?["a",fe(this.options.HTMLAttributes,t),0]:["a",fe(this.options.HTMLAttributes,{...t,href:""}),0]},markdownTokenName:"link",parseMarkdown:(t,e)=>e.applyMark("link",e.parseInline(t.tokens||[]),{href:t.href,title:t.title||null}),renderMarkdown:(t,e)=>{var n,s,o,r;let a=(s=(n=t.attrs)==null?void 0:n.href)!=null?s:"",i=(r=(o=t.attrs)==null?void 0:o.title)!=null?r:"",l=e.renderChildren(t);return i?`[${l}](${a} "${i}")`:`[${l}](${a})`},addCommands(){return{setLink:t=>({chain:e})=>{let{href:n}=t;return this.options.isAllowedUri(n,{defaultValidate:s=>!!Vs(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?e().setMark(this.name,t).setMeta("preventAutolink",!0).run():!1},toggleLink:t=>({chain:e})=>{let{href:n}=t||{};return n&&!this.options.isAllowedUri(n,{defaultValidate:s=>!!Vs(s,this.options.protocols),protocols:this.options.protocols,defaultProtocol:this.options.defaultProtocol})?!1:e().toggleMark(this.name,t,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()},unsetLink:()=>({chain:t})=>t().unsetMark(this.name,{extendEmptyMarkRange:!0}).setMeta("preventAutolink",!0).run()}},addPasteRules(){return[Xt({find:t=>{let e=[];if(t){let{protocols:n,defaultProtocol:s}=this.options,o=Yi(t).filter(r=>r.isLink&&this.options.isAllowedUri(r.value,{defaultValidate:a=>!!Vs(a,n),protocols:n,defaultProtocol:s}));o.length&&o.forEach(r=>{this.options.shouldAutoLink(r.value)&&e.push({text:r.value,data:{href:r.href},index:r.start})})}return e},type:this.type,getAttributes:t=>{var e;return{href:(e=t.data)==null?void 0:e.href}}})]},addProseMirrorPlugins(){let t=[],{protocols:e,defaultProtocol:n}=this.options;return this.options.autolink&&t.push(Lx({type:this.type,defaultProtocol:this.options.defaultProtocol,validate:s=>this.options.isAllowedUri(s,{defaultValidate:o=>!!Vs(o,e),protocols:e,defaultProtocol:n}),shouldAutoLink:this.options.shouldAutoLink})),t.push(jx({type:this.type,editor:this.editor,openOnClick:this.options.openOnClick==="whenNotEditable"?!0:this.options.openOnClick,enableClickSelection:this.options.enableClickSelection})),this.options.linkOnPaste&&t.push(Px({editor:this.editor,defaultProtocol:this.options.defaultProtocol,type:this.type,shouldAutoLink:this.options.shouldAutoLink})),t}}),ny=eu;var Nx=Object.defineProperty,Bx=(t,e)=>{for(var n in e)Nx(t,n,{get:e[n],enumerable:!0})},Ox="listItem",sy="textStyle",oy=/^\s*([-+*])\s$/,su=Ae.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",fe(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>t.type!=="list"||t.ordered?[]:{type:"bulletList",content:t.items?e.parseChildren(t.items):[]},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownOptions:{indentsContent:!0},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(Ox,this.editor.getAttributes(sy)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=kn({find:oy,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=kn({find:oy,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(sy),editor:this.editor})),[t]}}),ou=Ae.create({name:"listItem",addOptions(){return{HTMLAttributes:{},bulletListTypeName:"bulletList",orderedListTypeName:"orderedList"}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",fe(this.options.HTMLAttributes,t),0]},markdownTokenName:"list_item",parseMarkdown:(t,e)=>{if(t.type!=="list_item")return[];let n=[];if(t.tokens&&t.tokens.length>0)if(t.tokens.some(o=>o.type==="paragraph"))n=e.parseChildren(t.tokens);else{let o=t.tokens[0];if(o&&o.type==="text"&&o.tokens&&o.tokens.length>0){if(n=[{type:"paragraph",content:e.parseInline(o.tokens)}],t.tokens.length>1){let a=t.tokens.slice(1),i=e.parseChildren(a);n.push(...i)}}else n=e.parseChildren(t.tokens)}return n.length===0&&(n=[{type:"paragraph",content:[]}]),{type:"listItem",content:n}},renderMarkdown:(t,e,n)=>Lr(t,e,s=>{var o,r;return s.parentType==="bulletList"?"- ":s.parentType==="orderedList"?`${(((r=(o=s.meta)==null?void 0:o.parentAttrs)==null?void 0:r.start)||1)+s.index}. `:"- "},n),addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Rx={};Bx(Rx,{findListItemPos:()=>qr,getNextListDepth:()=>ru,handleBackspace:()=>tu,handleDelete:()=>nu,hasListBefore:()=>ly,hasListItemAfter:()=>$x,hasListItemBefore:()=>cy,listItemHasSubList:()=>dy,nextListIsDeeper:()=>uy,nextListIsHigher:()=>py});var qr=(t,e)=>{let{$from:n}=e.selection,s=ze(t,e.schema),o=null,r=n.depth,a=n.pos,i=null;for(;r>0&&i===null;)o=n.node(r),o.type===s?i=r:(r-=1,a-=1);return i===null?null:{$pos:e.doc.resolve(a),depth:i}},ru=(t,e)=>{let n=qr(t,e);if(!n)return!1;let[,s]=cg(e,t,n.$pos.pos+4);return s},ly=(t,e,n)=>{let{$anchor:s}=t.selection,o=Math.max(0,s.pos-2),r=t.doc.resolve(o).node();return!(!r||!n.includes(r.type.name))},cy=(t,e)=>{var n;let{$anchor:s}=e.selection,o=e.doc.resolve(s.pos-2);return!(o.index()===0||((n=o.nodeBefore)==null?void 0:n.type.name)!==t)},dy=(t,e,n)=>{if(!n)return!1;let s=ze(t,e.schema),o=!1;return n.descendants(r=>{r.type===s&&(o=!0)}),o},tu=(t,e,n)=>{if(t.commands.undoInputRule())return!0;if(t.state.selection.from!==t.state.selection.to)return!1;if(!gn(t.state,e)&&ly(t.state,e,n)){let{$anchor:i}=t.state.selection,l=t.state.doc.resolve(i.before()-1),c=[];l.node().descendants((p,f)=>{p.type.name===e&&c.push({node:p,pos:f})});let d=c.at(-1);if(!d)return!1;let u=t.state.doc.resolve(l.start()+d.pos+1);return t.chain().cut({from:i.start()-1,to:i.end()+1},u.end()).joinForward().run()}if(!gn(t.state,e)||!ug(t.state))return!1;let s=qr(e,t.state);if(!s)return!1;let r=t.state.doc.resolve(s.$pos.pos-2).node(s.depth),a=dy(e,t.state,r);return cy(e,t.state)&&!a?t.commands.joinItemBackward():t.chain().liftListItem(e).run()},uy=(t,e)=>{let n=ru(t,e),s=qr(t,e);return!s||!n?!1:n>s.depth},py=(t,e)=>{let n=ru(t,e),s=qr(t,e);return!s||!n?!1:n<s.depth},nu=(t,e)=>{if(!gn(t.state,e)||!dg(t.state,e))return!1;let{selection:n}=t.state,{$from:s,$to:o}=n;return!n.empty&&s.sameParent(o)?!1:uy(e,t.state)?t.chain().focus(t.state.selection.from+4).lift(e).joinBackward().run():py(e,t.state)?t.chain().joinForward().joinBackward().run():t.commands.joinItemForward()},$x=(t,e)=>{var n;let{$anchor:s}=e.selection,o=e.doc.resolve(s.pos-s.parentOffset-2);return!(o.index()===o.parent.childCount-1||((n=o.nodeAfter)==null?void 0:n.type.name)!==t)},au=ve.create({name:"listKeymap",addOptions(){return{listTypes:[{itemName:"listItem",wrapperNames:["bulletList","orderedList"]},{itemName:"taskItem",wrapperNames:["taskList"]}]}},addKeyboardShortcuts(){return{Delete:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&nu(t,n)&&(e=!0)}),e},"Mod-Delete":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n})=>{t.state.schema.nodes[n]!==void 0&&nu(t,n)&&(e=!0)}),e},Backspace:({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:s})=>{t.state.schema.nodes[n]!==void 0&&tu(t,n,s)&&(e=!0)}),e},"Mod-Backspace":({editor:t})=>{let e=!1;return this.options.listTypes.forEach(({itemName:n,wrapperNames:s})=>{t.state.schema.nodes[n]!==void 0&&tu(t,n,s)&&(e=!0)}),e}}}}),ry=/^(\s*)(\d+)\.\s+(.*)$/,Fx=/^\s/;function zx(t){let e=[],n=0,s=0;for(;n<t.length;){let o=t[n],r=o.match(ry);if(!r)break;let[,a,i,l]=r,c=a.length,d=l,u=n+1,p=[o];for(;u<t.length;){let f=t[u];if(f.match(ry))break;if(f.trim()==="")p.push(f),d+=`
`,u+=1;else if(f.match(Fx))p.push(f),d+=`
${f.slice(c+2)}`,u+=1;else break}e.push({indent:c,number:parseInt(i,10),content:d.trim(),raw:p.join(`
`)}),s=u,n=u}return[e,s]}function fy(t,e,n){var s;let o=[],r=0;for(;r<t.length;){let a=t[r];if(a.indent===e){let i=a.content.split(`
`),l=((s=i[0])==null?void 0:s.trim())||"",c=[];l&&c.push({type:"paragraph",raw:l,tokens:n.inlineTokens(l)});let d=i.slice(1).join(`
`).trim();if(d){let f=n.blockTokens(d);c.push(...f)}let u=r+1,p=[];for(;u<t.length&&t[u].indent>e;)p.push(t[u]),u+=1;if(p.length>0){let f=Math.min(...p.map(m=>m.indent)),h=fy(p,f,n);c.push({type:"list",ordered:!0,start:p[0].number,items:h,raw:p.map(m=>m.raw).join(`
`)})}o.push({type:"list_item",raw:a.raw,tokens:c}),r=u}else r+=1}return o}function Hx(t,e){return t.map(n=>{if(n.type!=="list_item")return e.parseChildren([n])[0];let s=[];return n.tokens&&n.tokens.length>0&&n.tokens.forEach(o=>{if(o.type==="paragraph"||o.type==="list"||o.type==="blockquote"||o.type==="code")s.push(...e.parseChildren([o]));else if(o.type==="text"&&o.tokens){let r=e.parseChildren([o]);s.push({type:"paragraph",content:r})}else{let r=e.parseChildren([o]);r.length>0&&s.push(...r)}}),{type:"listItem",content:s}})}var qx="listItem",ay="textStyle",iy=/^(\d+)\.\s$/,iu=Ae.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1},type:{default:null,parseHTML:t=>t.getAttribute("type")}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){let{start:e,...n}=t;return e===1?["ol",fe(this.options.HTMLAttributes,n),0]:["ol",fe(this.options.HTMLAttributes,t),0]},markdownTokenName:"list",parseMarkdown:(t,e)=>{if(t.type!=="list"||!t.ordered)return[];let n=t.start||1,s=t.items?Hx(t.items,e):[];return n!==1?{type:"orderedList",attrs:{start:n},content:s}:{type:"orderedList",content:s}},renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"orderedList",level:"block",start:t=>{let e=t.match(/^(\s*)(\d+)\.\s+/),n=e?.index;return n!==void 0?n:-1},tokenize:(t,e,n)=>{var s;let o=t.split(`
`),[r,a]=zx(o);if(r.length===0)return;let i=fy(r,0,n);return i.length===0?void 0:{type:"list",ordered:!0,start:((s=r[0])==null?void 0:s.number)||1,items:i,raw:o.slice(0,a).join(`
`)}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(qx,this.editor.getAttributes(ay)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=kn({find:iy,type:this.type,getAttributes:e=>({start:+e[1]}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1]});return(this.options.keepMarks||this.options.keepAttributes)&&(t=kn({find:iy,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:e=>({start:+e[1],...this.editor.getAttributes(ay)}),joinPredicate:(e,n)=>n.childCount+n.attrs.start===+e[1],editor:this.editor})),[t]}}),Ux=/^\s*(\[([( |x])?\])\s$/,Xi=Ae.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{},taskListTypeName:"taskList",a11y:void 0}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>{let e=t.getAttribute("data-checked");return e===""||e==="true"},renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",fe(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},parseMarkdown:(t,e)=>{let n=[];if(t.tokens&&t.tokens.length>0?n.push(e.createNode("paragraph",{},e.parseInline(t.tokens))):t.text?n.push(e.createNode("paragraph",{},[e.createNode("text",{text:t.text})])):n.push(e.createNode("paragraph",{},[])),t.nestedTokens&&t.nestedTokens.length>0){let s=e.parseChildren(t.nestedTokens);n.push(...s)}return e.createNode("taskItem",{checked:t.checked||!1},n)},renderMarkdown:(t,e)=>{var n;let o=`- [${(n=t.attrs)!=null&&n.checked?"x":" "}] `;return Lr(t,e,o)},addKeyboardShortcuts(){let t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:s})=>{let o=document.createElement("li"),r=document.createElement("label"),a=document.createElement("span"),i=document.createElement("input"),l=document.createElement("div"),c=u=>{var p,f;i.ariaLabel=((f=(p=this.options.a11y)==null?void 0:p.checkboxLabel)==null?void 0:f.call(p,u,i.checked))||`Task item checkbox for ${u.textContent||"empty task item"}`};c(t),r.contentEditable="false",i.type="checkbox",i.addEventListener("mousedown",u=>u.preventDefault()),i.addEventListener("change",u=>{if(!s.isEditable&&!this.options.onReadOnlyChecked){i.checked=!i.checked;return}let{checked:p}=u.target;s.isEditable&&typeof n=="function"&&s.chain().focus(void 0,{scrollIntoView:!1}).command(({tr:f})=>{let h=n();if(typeof h!="number")return!1;let m=f.doc.nodeAt(h);return f.setNodeMarkup(h,void 0,{...m?.attrs,checked:p}),!0}).run(),!s.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,p)||(i.checked=!i.checked))}),Object.entries(this.options.HTMLAttributes).forEach(([u,p])=>{o.setAttribute(u,p)}),o.dataset.checked=t.attrs.checked,i.checked=t.attrs.checked,r.append(i,a),o.append(r,l),Object.entries(e).forEach(([u,p])=>{o.setAttribute(u,p)});let d=new Set(Object.keys(e));return{dom:o,contentDOM:l,update:u=>{if(u.type!==this.type)return!1;o.dataset.checked=u.attrs.checked,i.checked=u.attrs.checked,c(u);let p=s.extensionManager.attributes,f=Co(u,p),h=new Set(Object.keys(f)),m=this.options.HTMLAttributes;return d.forEach(y=>{h.has(y)||(y in m?o.setAttribute(y,m[y]):o.removeAttribute(y))}),Object.entries(f).forEach(([y,k])=>{k==null?y in m?o.setAttribute(y,m[y]):o.removeAttribute(y):o.setAttribute(y,k)}),d=h,!0}}}},addInputRules(){return[kn({find:Ux,type:this.type,getAttributes:t=>({checked:t[t.length-1]==="x"})})]}}),Zi=Ae.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",fe(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},parseMarkdown:(t,e)=>e.createNode("taskList",{},e.parseChildren(t.items||[])),renderMarkdown:(t,e)=>t.content?e.renderChildren(t.content,`
`):"",markdownTokenizer:{name:"taskList",level:"block",start(t){var e;let n=(e=t.match(/^\s*[-+*]\s+\[([ xX])\]\s+/))==null?void 0:e.index;return n!==void 0?n:-1},tokenize(t,e,n){let s=r=>{let a=gi(r,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:i=>({indentLevel:i[1].length,mainContent:i[4],checked:i[3].toLowerCase()==="x"}),createToken:(i,l)=>({type:"taskItem",raw:"",mainContent:i.mainContent,indentLevel:i.indentLevel,checked:i.checked,text:i.mainContent,tokens:n.inlineTokens(i.mainContent),nestedTokens:l}),customNestedParser:s},n);return a?[{type:"taskList",raw:a.raw,items:a.items}]:n.blockTokens(r)},o=gi(t,{itemPattern:/^(\s*)([-+*])\s+\[([ xX])\]\s+(.*)$/,extractItemData:r=>({indentLevel:r[1].length,mainContent:r[4],checked:r[3].toLowerCase()==="x"}),createToken:(r,a)=>({type:"taskItem",raw:"",mainContent:r.mainContent,indentLevel:r.indentLevel,checked:r.checked,text:r.mainContent,tokens:n.inlineTokens(r.mainContent),nestedTokens:a}),customNestedParser:s},n);if(o)return{type:"taskList",raw:o.raw,items:o.items}}},markdownOptions:{indentsContent:!0},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}}),pL=ve.create({name:"listKit",addExtensions(){let t=[];return this.options.bulletList!==!1&&t.push(su.configure(this.options.bulletList)),this.options.listItem!==!1&&t.push(ou.configure(this.options.listItem)),this.options.listKeymap!==!1&&t.push(au.configure(this.options.listKeymap)),this.options.orderedList!==!1&&t.push(iu.configure(this.options.orderedList)),this.options.taskItem!==!1&&t.push(Xi.configure(this.options.taskItem)),this.options.taskList!==!1&&t.push(Zi.configure(this.options.taskList)),t}});var hy="&nbsp;",_x="\xA0",my=Ae.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",fe(this.options.HTMLAttributes,t),0]},parseMarkdown:(t,e)=>{let n=t.tokens||[];if(n.length===1&&n[0].type==="image")return e.parseChildren([n[0]]);let s=e.parseInline(n);return s.length===1&&s[0].type==="text"&&(s[0].text===hy||s[0].text===_x)?e.createNode("paragraph",void 0,[]):e.createNode("paragraph",void 0,s)},renderMarkdown:(t,e)=>{if(!t)return"";let n=Array.isArray(t.content)?t.content:[];return n.length===0?hy:e.renderChildren(n)},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}});var Vx=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))$/,Wx=/(?:^|\s)(~~(?!\s+~~)((?:[^~]+))~~(?!\s+~~))/g,gy=Ht.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("line-through")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["s",fe(this.options.HTMLAttributes,t),0]},markdownTokenName:"del",parseMarkdown:(t,e)=>e.applyMark("strike",e.parseInline(t.tokens||[])),renderMarkdown:(t,e)=>`~~${e.renderChildren(t)}~~`,addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-s":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[yn({find:Vx,type:this.type})]},addPasteRules(){return[Xt({find:Wx,type:this.type})]}});var yy=Ae.create({name:"text",group:"inline",parseMarkdown:t=>({type:"text",text:t.text||""}),renderMarkdown:t=>t.text||""});var lu=Ht.create({name:"underline",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"u"},{style:"text-decoration",consuming:!1,getAttrs:t=>t.includes("underline")?{}:!1}]},renderHTML({HTMLAttributes:t}){return["u",fe(this.options.HTMLAttributes,t),0]},parseMarkdown(t,e){return e.applyMark(this.name||"underline",e.parseInline(t.tokens||[]))},renderMarkdown(t,e){return`++${e.renderChildren(t)}++`},markdownTokenizer:{name:"underline",level:"inline",start(t){return t.indexOf("++")},tokenize(t,e,n){let o=/^(\+\+)([\s\S]+?)(\+\+)/.exec(t);if(!o)return;let r=o[2].trim();return{type:"underline",raw:o[0],text:r,tokens:n.inlineTokens(r)}}},addCommands(){return{setUnderline:()=>({commands:t})=>t.setMark(this.name),toggleUnderline:()=>({commands:t})=>t.toggleMark(this.name),unsetUnderline:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-u":()=>this.editor.commands.toggleUnderline(),"Mod-U":()=>this.editor.commands.toggleUnderline()}}}),ky=lu;function by(t={}){return new ae({view(e){return new cu(e,t)}})}var cu=class{constructor(e,n){var s;this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=(s=n.width)!==null&&s!==void 0?s:1,this.color=n.color===!1?void 0:n.color||"black",this.class=n.class,this.handlers=["dragover","dragend","drop","dragleave"].map(o=>{let r=a=>{this[o](a)};return e.dom.addEventListener(o,r),{name:o,handler:r}})}destroy(){this.handlers.forEach(({name:e,handler:n})=>this.editorView.dom.removeEventListener(e,n))}update(e,n){this.cursorPos!=null&&n.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,e==null?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent,s,o=this.editorView.dom,r=o.getBoundingClientRect(),a=r.width/o.offsetWidth,i=r.height/o.offsetHeight;if(n){let u=e.nodeBefore,p=e.nodeAfter;if(u||p){let f=this.editorView.nodeDOM(this.cursorPos-(u?u.nodeSize:0));if(f){let h=f.getBoundingClientRect(),m=u?h.bottom:h.top;u&&p&&(m=(m+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2);let y=this.width/2*i;s={left:h.left,right:h.right,top:m-y,bottom:m+y}}}}if(!s){let u=this.editorView.coordsAtPos(this.cursorPos),p=this.width/2*a;s={left:u.left-p,right:u.left+p,top:u.top,bottom:u.bottom}}let l=this.editorView.dom.offsetParent;this.element||(this.element=l.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n);let c,d;if(!l||l==document.body&&getComputedStyle(l).position=="static")c=-pageXOffset,d=-pageYOffset;else{let u=l.getBoundingClientRect(),p=u.width/l.offsetWidth,f=u.height/l.offsetHeight;c=u.left-l.scrollLeft*p,d=u.top-l.scrollTop*f}this.element.style.left=(s.left-c)/a+"px",this.element.style.top=(s.top-d)/i+"px",this.element.style.width=(s.right-s.left)/a+"px",this.element.style.height=(s.bottom-s.top)/i+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.setCursor(null),e)}dragover(e){if(!this.editorView.editable)return;let n=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),s=n&&n.inside>=0&&this.editorView.state.doc.nodeAt(n.inside),o=s&&s.type.spec.disableDropCursor,r=typeof o=="function"?o(this.editorView,n,e):o;if(n&&!r){let a=n.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let i=Pa(this.editorView.state.doc,a,this.editorView.dragging.slice);i!=null&&(a=i)}this.setCursor(a),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}};var vt=class t extends re{constructor(e){super(e,e)}map(e,n){let s=e.resolve(n.map(this.head));return t.valid(s)?new t(s):re.near(s)}content(){return X.empty}eq(e){return e instanceof t&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,n){if(typeof n.pos!="number")throw new RangeError("Invalid input for GapCursor.fromJSON");return new t(e.resolve(n.pos))}getBookmark(){return new du(this.anchor)}static valid(e){let n=e.parent;if(n.isTextblock||!Kx(e)||!Jx(e))return!1;let s=n.type.spec.allowGapCursor;if(s!=null)return s;let o=n.contentMatchAt(e.index()).defaultType;return o&&o.isTextblock}static findGapCursorFrom(e,n,s=!1){e:for(;;){if(!s&&t.valid(e))return e;let o=e.pos,r=null;for(let a=e.depth;;a--){let i=e.node(a);if(n>0?e.indexAfter(a)<i.childCount:e.index(a)>0){r=i.child(n>0?e.indexAfter(a):e.index(a)-1);break}else if(a==0)return null;o+=n;let l=e.doc.resolve(o);if(t.valid(l))return l}for(;;){let a=n>0?r.firstChild:r.lastChild;if(!a){if(r.isAtom&&!r.isText&&!Q.isSelectable(r)){e=e.doc.resolve(o+r.nodeSize*n),s=!1;continue e}break}r=a,o+=n;let i=e.doc.resolve(o);if(t.valid(i))return i}return null}}};vt.prototype.visible=!1;vt.findFrom=vt.findGapCursorFrom;re.jsonID("gapcursor",vt);var du=class t{constructor(e){this.pos=e}map(e){return new t(e.map(this.pos))}resolve(e){let n=e.resolve(this.pos);return vt.valid(n)?new vt(n):re.near(n)}};function vy(t){return t.isAtom||t.spec.isolating||t.spec.createGapCursor}function Kx(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),s=t.node(e);if(n==0){if(s.type.spec.isolating)return!0;continue}for(let o=s.child(n-1);;o=o.lastChild){if(o.childCount==0&&!o.inlineContent||vy(o.type))return!0;if(o.inlineContent)return!1}}return!0}function Jx(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),s=t.node(e);if(n==s.childCount){if(s.type.spec.isolating)return!0;continue}for(let o=s.child(n);;o=o.firstChild){if(o.childCount==0&&!o.inlineContent||vy(o.type))return!0;if(o.inlineContent)return!1}}return!0}function wy(){return new ae({props:{decorations:Zx,createSelectionBetween(t,e,n){return e.pos==n.pos&&vt.valid(n)?new vt(n):null},handleClick:Yx,handleKeyDown:Gx,handleDOMEvents:{beforeinput:Xx}}})}var Gx=hd({ArrowLeft:Qi("horiz",-1),ArrowRight:Qi("horiz",1),ArrowUp:Qi("vert",-1),ArrowDown:Qi("vert",1)});function Qi(t,e){let n=t=="vert"?e>0?"down":"up":e>0?"right":"left";return function(s,o,r){let a=s.selection,i=e>0?a.$to:a.$from,l=a.empty;if(a instanceof te){if(!r.endOfTextblock(n)||i.depth==0)return!1;l=!1,i=s.doc.resolve(e>0?i.after():i.before())}let c=vt.findGapCursorFrom(i,e,l);return c?(o&&o(s.tr.setSelection(new vt(c))),!0):!1}}function Yx(t,e,n){if(!t||!t.editable)return!1;let s=t.state.doc.resolve(e);if(!vt.valid(s))return!1;let o=t.posAtCoords({left:n.clientX,top:n.clientY});return o&&o.inside>-1&&Q.isSelectable(t.state.doc.nodeAt(o.inside))?!1:(t.dispatch(t.state.tr.setSelection(new vt(s))),!0)}function Xx(t,e){if(e.inputType!="insertCompositionText"||!(t.state.selection instanceof vt))return!1;let{$from:n}=t.state.selection,s=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!s)return!1;let o=O.empty;for(let a=s.length-1;a>=0;a--)o=O.from(s[a].createAndFill(null,o));let r=t.state.tr.replace(n.pos,n.pos,new X(o,0,0));return r.setSelection(te.near(r.doc.resolve(n.pos+1))),t.dispatch(r),!1}function Zx(t){if(!(t.selection instanceof vt))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",We.create(t.doc,[bt.widget(t.selection.head,e,{key:"gapcursor"})])}var el=200,ct=function(){};ct.prototype.append=function(e){return e.length?(e=ct.from(e),!this.length&&e||e.length<el&&this.leafAppend(e)||this.length<el&&e.leafPrepend(this)||this.appendInner(e)):this};ct.prototype.prepend=function(e){return e.length?ct.from(e).append(this):this};ct.prototype.appendInner=function(e){return new Qx(this,e)};ct.prototype.slice=function(e,n){return e===void 0&&(e=0),n===void 0&&(n=this.length),e>=n?ct.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,n))};ct.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)};ct.prototype.forEach=function(e,n,s){n===void 0&&(n=0),s===void 0&&(s=this.length),n<=s?this.forEachInner(e,n,s,0):this.forEachInvertedInner(e,n,s,0)};ct.prototype.map=function(e,n,s){n===void 0&&(n=0),s===void 0&&(s=this.length);var o=[];return this.forEach(function(r,a){return o.push(e(r,a))},n,s),o};ct.from=function(e){return e instanceof ct?e:e&&e.length?new Sy(e):ct.empty};var Sy=(function(t){function e(s){t.call(this),this.values=s}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(o,r){return o==0&&r==this.length?this:new e(this.values.slice(o,r))},e.prototype.getInner=function(o){return this.values[o]},e.prototype.forEachInner=function(o,r,a,i){for(var l=r;l<a;l++)if(o(this.values[l],i+l)===!1)return!1},e.prototype.forEachInvertedInner=function(o,r,a,i){for(var l=r-1;l>=a;l--)if(o(this.values[l],i+l)===!1)return!1},e.prototype.leafAppend=function(o){if(this.length+o.length<=el)return new e(this.values.concat(o.flatten()))},e.prototype.leafPrepend=function(o){if(this.length+o.length<=el)return new e(o.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e})(ct);ct.empty=new Sy([]);var Qx=(function(t){function e(n,s){t.call(this),this.left=n,this.right=s,this.length=n.length+s.length,this.depth=Math.max(n.depth,s.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(s){return s<this.left.length?this.left.get(s):this.right.get(s-this.left.length)},e.prototype.forEachInner=function(s,o,r,a){var i=this.left.length;if(o<i&&this.left.forEachInner(s,o,Math.min(r,i),a)===!1||r>i&&this.right.forEachInner(s,Math.max(o-i,0),Math.min(this.length,r)-i,a+i)===!1)return!1},e.prototype.forEachInvertedInner=function(s,o,r,a){var i=this.left.length;if(o>i&&this.right.forEachInvertedInner(s,o-i,Math.max(r,i)-i,a+i)===!1||r<i&&this.left.forEachInvertedInner(s,Math.min(o,i),r,a)===!1)return!1},e.prototype.sliceInner=function(s,o){if(s==0&&o==this.length)return this;var r=this.left.length;return o<=r?this.left.slice(s,o):s>=r?this.right.slice(s-r,o-r):this.left.slice(s,r).append(this.right.slice(0,o-r))},e.prototype.leafAppend=function(s){var o=this.right.leafAppend(s);if(o)return new e(this.left,o)},e.prototype.leafPrepend=function(s){var o=this.left.leafPrepend(s);if(o)return new e(o,this.right)},e.prototype.appendInner=function(s){return this.left.depth>=Math.max(this.right.depth,s.depth)+1?new e(this.left,new e(this.right,s)):new e(this,s)},e})(ct),uu=ct;var eT=500,Ks=class t{constructor(e,n){this.items=e,this.eventCount=n}popEvent(e,n){if(this.eventCount==0)return null;let s=this.items.length;for(;;s--)if(this.items.get(s-1).selection){--s;break}let o,r;n&&(o=this.remapping(s,this.items.length),r=o.maps.length);let a=e.tr,i,l,c=[],d=[];return this.items.forEach((u,p)=>{if(!u.step){o||(o=this.remapping(s,p+1),r=o.maps.length),r--,d.push(u);return}if(o){d.push(new wn(u.map));let f=u.step.map(o.slice(r)),h;f&&a.maybeStep(f).doc&&(h=a.mapping.maps[a.mapping.maps.length-1],c.push(new wn(h,void 0,void 0,c.length+d.length))),r--,h&&o.appendMap(h,r)}else a.maybeStep(u.step);if(u.selection)return i=o?u.selection.map(o.slice(r)):u.selection,l=new t(this.items.slice(0,s).append(d.reverse().concat(c)),this.eventCount-1),!1},this.items.length,0),{remaining:l,transform:a,selection:i}}addTransform(e,n,s,o){let r=[],a=this.eventCount,i=this.items,l=!o&&i.length?i.get(i.length-1):null;for(let d=0;d<e.steps.length;d++){let u=e.steps[d].invert(e.docs[d]),p=new wn(e.mapping.maps[d],u,n),f;(f=l&&l.merge(p))&&(p=f,d?r.pop():i=i.slice(0,i.length-1)),r.push(p),n&&(a++,n=void 0),o||(l=p)}let c=a-s.depth;return c>nT&&(i=tT(i,c),a-=c),new t(i.append(r),a)}remapping(e,n){let s=new fr;return this.items.forEach((o,r)=>{let a=o.mirrorOffset!=null&&r-o.mirrorOffset>=e?s.maps.length-o.mirrorOffset:void 0;s.appendMap(o.map,a)},e,n),s}addMaps(e){return this.eventCount==0?this:new t(this.items.append(e.map(n=>new wn(n))),this.eventCount)}rebased(e,n){if(!this.eventCount)return this;let s=[],o=Math.max(0,this.items.length-n),r=e.mapping,a=e.steps.length,i=this.eventCount;this.items.forEach(p=>{p.selection&&i--},o);let l=n;this.items.forEach(p=>{let f=r.getMirror(--l);if(f==null)return;a=Math.min(a,f);let h=r.maps[f];if(p.step){let m=e.steps[f].invert(e.docs[f]),y=p.selection&&p.selection.map(r.slice(l+1,f));y&&i++,s.push(new wn(h,m,y))}else s.push(new wn(h))},o);let c=[];for(let p=n;p<a;p++)c.push(new wn(r.maps[p]));let d=this.items.slice(0,o).append(c).append(s),u=new t(d,i);return u.emptyItemCount()>eT&&(u=u.compress(this.items.length-s.length)),u}emptyItemCount(){let e=0;return this.items.forEach(n=>{n.step||e++}),e}compress(e=this.items.length){let n=this.remapping(0,e),s=n.maps.length,o=[],r=0;return this.items.forEach((a,i)=>{if(i>=e)o.push(a),a.selection&&r++;else if(a.step){let l=a.step.map(n.slice(s)),c=l&&l.getMap();if(s--,c&&n.appendMap(c,s),l){let d=a.selection&&a.selection.map(n.slice(s));d&&r++;let u=new wn(c.invert(),l,d),p,f=o.length-1;(p=o.length&&o[f].merge(u))?o[f]=p:o.push(u)}}else a.map&&s--},this.items.length,0),new t(uu.from(o.reverse()),r)}};Ks.empty=new Ks(uu.empty,0);function tT(t,e){let n;return t.forEach((s,o)=>{if(s.selection&&e--==0)return n=o,!1}),t.slice(n)}var wn=class t{constructor(e,n,s,o){this.map=e,this.step=n,this.selection=s,this.mirrorOffset=o}merge(e){if(this.step&&e.step&&!e.selection){let n=e.step.merge(this.step);if(n)return new t(n.getMap().invert(),n,this.selection)}}},Sn=class{constructor(e,n,s,o,r){this.done=e,this.undone=n,this.prevRanges=s,this.prevTime=o,this.prevComposition=r}},nT=20;function sT(t,e,n,s){let o=n.getMeta(Ws),r;if(o)return o.historyState;n.getMeta(aT)&&(t=new Sn(t.done,t.undone,null,0,-1));let a=n.getMeta("appendedTransaction");if(n.steps.length==0)return t;if(a&&a.getMeta(Ws))return a.getMeta(Ws).redo?new Sn(t.done.addTransform(n,void 0,s,tl(e)),t.undone,Ey(n.mapping.maps),t.prevTime,t.prevComposition):new Sn(t.done,t.undone.addTransform(n,void 0,s,tl(e)),null,t.prevTime,t.prevComposition);if(n.getMeta("addToHistory")!==!1&&!(a&&a.getMeta("addToHistory")===!1)){let i=n.getMeta("composition"),l=t.prevTime==0||!a&&t.prevComposition!=i&&(t.prevTime<(n.time||0)-s.newGroupDelay||!oT(n,t.prevRanges)),c=a?pu(t.prevRanges,n.mapping):Ey(n.mapping.maps);return new Sn(t.done.addTransform(n,l?e.selection.getBookmark():void 0,s,tl(e)),Ks.empty,c,n.time,i??t.prevComposition)}else return(r=n.getMeta("rebased"))?new Sn(t.done.rebased(n,r),t.undone.rebased(n,r),pu(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new Sn(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),pu(t.prevRanges,n.mapping),t.prevTime,t.prevComposition)}function oT(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach((s,o)=>{for(let r=0;r<e.length;r+=2)s<=e[r+1]&&o>=e[r]&&(n=!0)}),n}function Ey(t){let e=[];for(let n=t.length-1;n>=0&&e.length==0;n--)t[n].forEach((s,o,r,a)=>e.push(r,a));return e}function pu(t,e){if(!t)return null;let n=[];for(let s=0;s<t.length;s+=2){let o=e.map(t[s],1),r=e.map(t[s+1],-1);o<=r&&n.push(o,r)}return n}function rT(t,e,n){let s=tl(e),o=Ws.get(e).spec.config,r=(n?t.undone:t.done).popEvent(e,s);if(!r)return null;let a=r.selection.resolve(r.transform.doc),i=(n?t.done:t.undone).addTransform(r.transform,e.selection.getBookmark(),o,s),l=new Sn(n?i:r.remaining,n?r.remaining:i,null,0,-1);return r.transform.setSelection(a).setMeta(Ws,{redo:n,historyState:l})}var fu=!1,xy=null;function tl(t){let e=t.plugins;if(xy!=e){fu=!1,xy=e;for(let n=0;n<e.length;n++)if(e[n].spec.historyPreserveItems){fu=!0;break}}return fu}var Ws=new pe("history"),aT=new pe("closeHistory");function Ty(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new ae({key:Ws,state:{init(){return new Sn(Ks.empty,Ks.empty,null,0,-1)},apply(e,n,s){return sT(n,s,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(e,n){let s=n.inputType,o=s=="historyUndo"?hu:s=="historyRedo"?mu:null;return!o||!e.editable?!1:(n.preventDefault(),o(e.state,e.dispatch))}}}})}function nl(t,e){return(n,s)=>{let o=Ws.getState(n);if(!o||(t?o.undone:o.done).eventCount==0)return!1;if(s){let r=rT(o,n,t);r&&s(e?r.scrollIntoView():r)}return!0}}var hu=nl(!1,!0),mu=nl(!0,!0),$L=nl(!1,!1),FL=nl(!0,!1);var VL=ve.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize",textCounter:t=>t.length,wordCounter:t=>t.split(" ").filter(e=>e!=="").length}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{let e=t?.node||this.editor.state.doc;if((t?.mode||this.options.mode)==="textSize"){let s=e.textBetween(0,e.content.size,void 0," ");return this.options.textCounter(s)}return e.nodeSize},this.storage.words=t=>{let e=t?.node||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," ");return this.options.wordCounter(n)}},addProseMirrorPlugins(){let t=!1;return[new ae({key:new pe("characterCount"),appendTransaction:(e,n,s)=>{if(t)return;let o=this.options.limit;if(o==null||o===0){t=!0;return}let r=this.storage.characters({node:s.doc});if(r>o){let a=r-o,i=0,l=a;console.warn(`[CharacterCount] Initial content exceeded limit of ${o} characters. Content was automatically trimmed.`);let c=s.tr.deleteRange(i,l);return t=!0,c}t=!0},filterTransaction:(e,n)=>{let s=this.options.limit;if(!e.docChanged||s===0||s===null||s===void 0)return!0;let o=this.storage.characters({node:n.doc}),r=this.storage.characters({node:e.doc});if(r<=s||o>s&&r>s&&r<=o)return!0;if(o>s&&r>s&&r>o||!e.getMeta("paste"))return!1;let i=e.selection.$head.pos,l=r-s,c=i-l,d=i;return e.deleteRange(c,d),!(this.storage.characters({node:e.doc})>s)}})]}}),Cy=ve.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[by(this.options)]}}),XL=ve.create({name:"focus",addOptions(){return{className:"has-focus",mode:"all"}},addProseMirrorPlugins(){return[new ae({key:new pe("focus"),props:{decorations:({doc:t,selection:e})=>{let{isEditable:n,isFocused:s}=this.editor,{anchor:o}=e,r=[];if(!n||!s)return We.create(t,[]);let a=0;this.options.mode==="deepest"&&t.descendants((l,c)=>{if(l.isText)return;if(!(o>=c&&o<=c+l.nodeSize-1))return!1;a+=1});let i=0;return t.descendants((l,c)=>{if(l.isText||!(o>=c&&o<=c+l.nodeSize-1))return!1;if(i+=1,this.options.mode==="deepest"&&a-i>0||this.options.mode==="shallowest"&&i>1)return this.options.mode==="deepest";r.push(bt.node(c,c+l.nodeSize,{class:this.options.className}))}),We.create(t,r)}}})]}}),Ay=ve.create({name:"gapCursor",addProseMirrorPlugins(){return[wy()]},extendNodeSchema(t){var e;let n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:(e=Se(ee(t,"allowGapCursor",n)))!=null?e:null}}}),Dy="placeholder";function iT(t){return t.replace(/\s+/g,"-").replace(/[^a-zA-Z0-9-]/g,"").replace(/^[0-9-]+/,"").replace(/^-+/,"").toLowerCase()}var gu=ve.create({name:"placeholder",addOptions(){return{emptyEditorClass:"is-editor-empty",emptyNodeClass:"is-empty",dataAttribute:Dy,placeholder:"Write something \u2026",showOnlyWhenEditable:!0,showOnlyCurrent:!0,includeChildren:!1}},addProseMirrorPlugins(){let t=this.options.dataAttribute?`data-${iT(this.options.dataAttribute)}`:`data-${Dy}`;return[new ae({key:new pe("placeholder"),props:{decorations:({doc:e,selection:n})=>{let s=this.editor.isEditable||!this.options.showOnlyWhenEditable,{anchor:o}=n,r=[];if(!s)return null;let a=this.editor.isEmpty;return e.descendants((i,l)=>{let c=o>=l&&o<=l+i.nodeSize,d=!i.isLeaf&&Ar(i);if((c||!this.options.showOnlyCurrent)&&d){let u=[this.options.emptyNodeClass];a&&u.push(this.options.emptyEditorClass);let p=bt.node(l,l+i.nodeSize,{class:u.join(" "),[t]:typeof this.options.placeholder=="function"?this.options.placeholder({editor:this.editor,node:i,pos:l,hasAnchor:c}):this.options.placeholder});r.push(p)}return this.options.includeChildren}),We.create(e,r)}}})]}}),aj=ve.create({name:"selection",addOptions(){return{className:"selection"}},addProseMirrorPlugins(){let{editor:t,options:e}=this;return[new ae({key:new pe("selection"),props:{decorations(n){return n.selection.empty||t.isFocused||!t.isEditable||fi(n.selection)||t.view.dragging?null:We.create(n.doc,[bt.inline(n.selection.from,n.selection.to,{class:e.className})])}}})]}});function Iy({types:t,node:e}){return e&&Array.isArray(t)&&t.includes(e.type)||e?.type===t}var My=ve.create({name:"trailingNode",addOptions(){return{node:void 0,notAfter:[]}},addProseMirrorPlugins(){var t;let e=new pe(this.name),n=this.options.node||((t=this.editor.schema.topNodeType.contentMatch.defaultType)==null?void 0:t.name)||"paragraph",s=Object.entries(this.editor.schema.nodes).map(([,o])=>o).filter(o=>(this.options.notAfter||[]).concat(n).includes(o.name));return[new ae({key:e,appendTransaction:(o,r,a)=>{let{doc:i,tr:l,schema:c}=a,d=e.getState(a),u=i.content.size,p=c.nodes[n];if(d)return l.insert(u,p.create())},state:{init:(o,r)=>{let a=r.tr.doc.lastChild;return!Iy({node:a,types:s})},apply:(o,r)=>{if(!o.docChanged||o.getMeta("__uniqueIDTransaction"))return r;let a=o.doc.lastChild;return!Iy({node:a,types:s})}}})]}}),Ly=ve.create({name:"undoRedo",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>hu(t,e),redo:()=>({state:t,dispatch:e})=>mu(t,e)}},addProseMirrorPlugins(){return[Ty(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-y":()=>this.editor.commands.redo(),"Mod-\u044F":()=>this.editor.commands.undo(),"Shift-Mod-\u044F":()=>this.editor.commands.redo()}}});var lT=ve.create({name:"starterKit",addExtensions(){var t,e,n,s;let o=[];return this.options.bold!==!1&&o.push(Pg.configure(this.options.bold)),this.options.blockquote!==!1&&o.push(jg.configure(this.options.blockquote)),this.options.bulletList!==!1&&o.push(su.configure(this.options.bulletList)),this.options.code!==!1&&o.push(Ng.configure(this.options.code)),this.options.codeBlock!==!1&&o.push(Bg.configure(this.options.codeBlock)),this.options.document!==!1&&o.push(Og.configure(this.options.document)),this.options.dropcursor!==!1&&o.push(Cy.configure(this.options.dropcursor)),this.options.gapcursor!==!1&&o.push(Ay.configure(this.options.gapcursor)),this.options.hardBreak!==!1&&o.push(Rg.configure(this.options.hardBreak)),this.options.heading!==!1&&o.push($g.configure(this.options.heading)),this.options.undoRedo!==!1&&o.push(Ly.configure(this.options.undoRedo)),this.options.horizontalRule!==!1&&o.push(Fg.configure(this.options.horizontalRule)),this.options.italic!==!1&&o.push(zg.configure(this.options.italic)),this.options.listItem!==!1&&o.push(ou.configure(this.options.listItem)),this.options.listKeymap!==!1&&o.push(au.configure((t=this.options)==null?void 0:t.listKeymap)),this.options.link!==!1&&o.push(eu.configure((e=this.options)==null?void 0:e.link)),this.options.orderedList!==!1&&o.push(iu.configure(this.options.orderedList)),this.options.paragraph!==!1&&o.push(my.configure(this.options.paragraph)),this.options.strike!==!1&&o.push(gy.configure(this.options.strike)),this.options.text!==!1&&o.push(yy.configure(this.options.text)),this.options.underline!==!1&&o.push(lu.configure((n=this.options)==null?void 0:n.underline)),this.options.trailingNode!==!1&&o.push(My.configure((s=this.options)==null?void 0:s.trailingNode)),o}}),jy=lT;var Py=Zi;var Ny=Xi;var By=gu;var he=null,It=null,Js=null,Gs=null,Vn={onFocus:null,onBlur:null,onUpdate:null};function yu(t){return typeof t=="string"?t:""}function fs(t){let e=yu(t).trim();return e==="<p></p>"||e==="<p><br></p>"?"":e}function sl(t){Js&&(Js.value=fs(t))}function cT(){if(typeof document>"u")return null;let e=window.getSelection()?.anchorNode||null;if(e&&It){let n=e.nodeType===Node.ELEMENT_NODE?e:e.parentElement;if(n&&typeof n.closest=="function"){let s=n.closest('li[data-type="taskItem"]');if(s)return s}}return It?It.querySelector('li[data-type="taskItem"].ProseMirror-selectednode'):null}function dT(t){if(!t)return!1;let e=t.querySelector("div");return e?(e.textContent||"").replace(/\u200B/g,"").trim().length===0:!1}function uT(t){let e=t?.closest('ul[data-type="taskList"]');return e?Array.from(e.children).filter(n=>n&&n.nodeType===Node.ELEMENT_NODE&&n.matches('li[data-type="taskItem"]')).length:0}function pT(t){if(!he||!It||!he.isActive("taskItem"))return!1;let e=cT();if(!e)return!1;let n=dT(e),s=he.state?.selection,r=!!s?.empty&&s.$from.parentOffset===0;return!((t==="Backspace"||t==="Delete"||t==="Enter")&&n)&&!(t==="Backspace"&&r)?!1:uT(e)<=1?he.chain().focus().toggleTaskList().run():he.chain().focus().liftListItem("taskItem").run()}function fT(){It&&(Gs&&It.removeEventListener("keydown",Gs),Gs=t=>{if(!he)return;let e=t.key;e!=="Backspace"&&e!=="Delete"&&e!=="Enter"||!pT(e)||(t.preventDefault(),t.stopPropagation())},It.addEventListener("keydown",Gs))}function hT(){!It||!Gs||(It.removeEventListener("keydown",Gs),Gs=null)}function Oy(t){let e=yu(t);if(!e||typeof document>"u")return e;let n=e.includes('class="cb-item"'),s=e.includes("checkbox-row");if(!n&&!s)return e;let o=document.createElement("div");return o.innerHTML=e,Array.from(o.querySelectorAll(".cb-item, .checkbox-row")).forEach(i=>{let l=i.classList.contains("checkbox-row"),c=l?!!i.querySelector('.checkbox-toggle.checked, .checkbox-toggle[aria-pressed="true"]'):i.getAttribute("data-checked")==="true",d="";if(l){let m=i.querySelector(".check-text");d=m?m.innerHTML:""}else d=i.innerHTML;let u=document.createElement("ul");u.setAttribute("data-type","taskList");let p=document.createElement("li");p.setAttribute("data-type","taskItem"),p.setAttribute("data-checked",c?"true":"false");let f=document.createElement("p"),h=(d||"").trim();f.innerHTML=h.length>0?h:"<br>",p.appendChild(f),u.appendChild(p),i.replaceWith(u)}),Array.from(o.querySelectorAll('ul[data-type="taskList"]')).forEach(i=>{let l=i.nextElementSibling;for(;l&&l.matches('ul[data-type="taskList"]');){for(;l.firstElementChild;)i.appendChild(l.firstElementChild);let c=l;l=l.nextElementSibling,c.remove()}}),o.innerHTML}function Ry(){return It||(typeof document>"u"?null:(It=document.querySelector("#task-description-editor"),It))}function mT(){return Js||(typeof document>"u"?null:(Js=document.querySelector("#task-description-hidden"),Js))}function gT(t){let e=(t?.className||"").split(/\s+/).map(n=>n.trim()).filter(Boolean).filter(n=>n!=="tiptap"&&!n.startsWith("ProseMirror"));return e.includes("editor-content")||e.push("editor-content"),e.includes("focus:outline-none")||e.push("focus:outline-none"),e.join(" ")}function $y({editorSelector:t="#task-description-editor",hiddenSelector:e="#task-description-hidden",placeholder:n="",onFocus:s=null,onBlur:o=null,onUpdate:r=null}={}){if(typeof document>"u")return null;let a=typeof t=="string"?document.querySelector(t):t,i=typeof e=="string"?document.querySelector(e):e;if(!a)return null;Vn={onFocus:typeof s=="function"?s:null,onBlur:typeof o=="function"?o:null,onUpdate:typeof r=="function"?r:null},It=a,Js=i||null;let l=a.id||"task-description-editor",c=gT(a);return he&&It===a?(sl(he.getHTML()),he):(he&&(hT(),he.destroy(),he=null),he=new Cg({element:a,editorProps:{attributes:{id:l,class:c}},extensions:[jy,ky,Py,Ny.configure({nested:!1}),ny.configure({autolink:!0,linkOnPaste:!0,openOnClick:!0,HTMLAttributes:{target:"_blank",rel:"noopener noreferrer"}}),By.configure({placeholder:n})],content:Oy(a.innerHTML||""),onCreate:({editor:d})=>{let u=fs(d.getHTML());sl(u),Vn.onUpdate&&Vn.onUpdate(u)},onUpdate:({editor:d})=>{let u=fs(d.getHTML());sl(u),Vn.onUpdate&&Vn.onUpdate(u)},onFocus:({editor:d})=>{Vn.onFocus&&Vn.onFocus(fs(d.getHTML()))},onBlur:({editor:d})=>{Vn.onBlur&&Vn.onBlur(fs(d.getHTML()))}}),fT(),he)}function Ur(){return he?he.commands.focus():!1}function Lo(){if(he)return fs(he.getHTML());let t=Ry();return t?fs(t.innerHTML):""}function ku(t=""){let e=Oy(yu(t));if(he){he.commands.setContent(e,{emitUpdate:!1}),sl(he.getHTML());return}let n=Ry();n&&(n.innerHTML=e);let s=mT();s&&(s.value=fs(e))}function Fy(){ku("")}function zy(t){if(!he)return!1;switch(t){case"bold":return he.chain().focus().toggleBold().run();case"italic":return he.chain().focus().toggleItalic().run();case"underline":return he.chain().focus().toggleUnderline().run();case"strikeThrough":return he.chain().focus().toggleStrike().run();case"insertUnorderedList":return he.chain().focus().toggleBulletList().run();case"insertOrderedList":return he.chain().focus().toggleOrderedList().run();default:return!1}}function Hy(t){if(!he)return!1;let e=Number.parseInt(String(t).replace("h",""),10);return!Number.isFinite(e)||e<1||e>3?!1:he.chain().focus().toggleHeading({level:e}).run()}function qy(){return he?he.chain().focus().setHorizontalRule().run():!1}function Uy(){return he?(he.isActive("taskItem")||he.isActive("taskList"))&&he.chain().focus().liftListItem("taskItem").run()?!0:he.chain().focus().toggleTaskList().run():!1}var AT=typeof performance<"u"?performance.now():Date.now(),Bu=new Set;typeof performance<"u"&&typeof performance.mark=="function"&&(performance.mark("app_start"),Bu.add("app_start"));var Po=null,wu=0;function MT(){return typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches||window.matchMedia("(pointer: coarse)").matches:window.innerWidth<=768}function $e(){return Po===null&&(Po=MT(),!wu&&typeof requestAnimationFrame=="function"&&(wu=requestAnimationFrame(()=>{Po=null,wu=0}))),Po}var LT="2.7.1",jT=`v${LT}`;function PT(){Object.entries({projects:()=>B,tasks:()=>A,feedbackItems:()=>Ve,projectCounter:()=>Ot,taskCounter:()=>St,feedbackCounter:()=>to,projectsSortedView:()=>dl,selectedCards:()=>ul,lastSelectedCardId:()=>pl,projectToDelete:()=>Ss,tempAttachments:()=>et,massEditState:()=>ce,projectNavigationReferrer:()=>st,calendarNavigationState:()=>Tn,previousPage:()=>en,currentFeedbackScreenshotData:()=>no,feedbackPendingPage:()=>In,feedbackDonePage:()=>Kn,settings:()=>R}).forEach(([e,n])=>{Object.defineProperty(de,e,{get:n,set:s=>{switch(e){case"projects":B=s;break;case"tasks":A=s;break;case"feedbackItems":Ve=s;break;case"feedbackIndex":feedbackIndex=s;break;case"projectCounter":Ot=s;break;case"taskCounter":St=s;break;case"feedbackCounter":to=s;break;case"projectsSortedView":dl=s;break;case"selectedCards":ul=s;break;case"lastSelectedCardId":pl=s;break;case"projectToDelete":Ss=s;break;case"tempAttachments":et=s;break;case"massEditState":ce=s;break;case"projectNavigationReferrer":st=s;break;case"calendarNavigationState":Tn=s;break;case"previousPage":en=s;break;case"currentFeedbackScreenshotData":no=s;break;case"feedbackPendingPage":In=s;break;case"feedbackDonePage":Kn=s;break;case"settings":R=s;break}},configurable:!0,enumerable:!0})})}PT();function Su(){de.selectedCards.clear(),de.lastSelectedCardId=null,document.querySelectorAll(".task-card.selected").forEach(t=>{t.classList.remove("selected")})}var NT=["en","es"];function Ku(t){return NT.includes(t)?t:"en"}function gs(){return Ku(R.language||"en")}function Qn(){let t=gs();return Ul[t]||Ul.en}function g(t,e){let n=gs(),o=(ka[n]||ka.en)[t]||ka.en[t]||t;return e?o.replace(/\{(\w+)\}/g,(r,a)=>Object.prototype.hasOwnProperty.call(e,a)?String(e[a]):r):o}function Il(t=document){t.querySelectorAll("[data-i18n]").forEach(n=>{let s=n.getAttribute("data-i18n");if(!s)return;let o=n.getAttribute("data-i18n-attr");o?o.split(",").map(r=>r.trim()).filter(Boolean).forEach(r=>{n.setAttribute(r,g(s))}):n.textContent=g(s)})}window.i18n={t:g,applyTranslations:Il,getCurrentLanguage:gs};function pt(t){return{backlog:g("tasks.status.backlog"),todo:g("tasks.status.todo"),progress:g("tasks.status.progress"),review:g("tasks.status.review"),done:g("tasks.status.done")}[t]||Hp[t]||t||""}function da(t){return{backlog:g("projects.status.backlog"),planning:g("projects.status.planning"),active:g("projects.status.active"),completed:g("projects.status.completed")}[t]||t||""}function At(t){return{high:g("tasks.priority.high"),medium:g("tasks.priority.medium"),low:g("tasks.priority.low")}[t]||At(t)||t||""}function bk(){R.language=gs(),document.documentElement.lang=R.language,Il(),oD();let t=document.getElementById("email-notification-timezone"),e=document.getElementById("email-notification-timezone-value");t&&e&&(e.textContent=t.options?.[t.selectedIndex]?.textContent||t.value||"");let n=document.getElementById("user-avatar-dropzone");n&&(n.dataset.defaultText=g("settings.avatarUploadDefault"),n.dataset.changeText=g("settings.avatarUploadChange"));let s=document.getElementById("workspace-logo-dropzone");s&&(s.dataset.defaultText=g("settings.logoUploadDefault"),s.dataset.changeText=g("settings.logoUploadChange"));let o=document.getElementById("attachment-file-dropzone");if(o){let l=$e(),c=g(l?"tasks.modal.attachmentsDropzoneTap":"tasks.modal.attachmentsDropzoneDefault");o.dataset.defaultText=c;let d=o.querySelector(".task-attachment-dropzone-text");d&&(d.textContent=c)}let r=document.getElementById("feedback-screenshot-url");if(r){let l=typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:$e(),c=g(l?"feedback.screenshotDropzoneTap":"feedback.screenshotDropzoneDefault");r.dataset.defaultText=c,r.dataset.hasInlineImage||(r.textContent=c)}cp(),zo(),document.dispatchEvent(new CustomEvent("refresh-workspace-logo-ui")),Uk();try{Jn()}catch{}try{ca()}catch{}try{$l()}catch{}try{$b()}catch{}_k(),Qu(),Zu(),ys(),Wk();try{yD()}catch{}let a=document.querySelector(".filter-chip.active")?.dataset?.period||"week";Hk(a);let i=document.getElementById("activity-page");i&&i.classList.contains("active")&&Vk();try{document.getElementById("projects")?.classList.contains("active")&&Mt(),document.getElementById("tasks")?.classList.contains("active")&&(ft(),document.getElementById("list-view")?.classList.contains("active")&&on()),document.getElementById("calendar")?.classList.contains("active")&&ye(),document.getElementById("feedback")?.classList.contains("active")&&(xs(),Gn())}catch{}}var Ut={hasPendingChange:!1,dataUrl:null},_t={hasPendingChange:!1,dataUrl:null},q={originalImage:null,originalDataUrl:null,canvas:null,ctx:null,selection:{x:0,y:0,size:0},isDragging:!1,isResizing:!1,dragStartX:0,dragStartY:0,activeHandle:null,shape:"square",outputMimeType:"image/jpeg",outputMaxSize:null,onApply:null,successMessage:null},Eu=null,BT=typeof performance<"u"?performance.now():Date.now(),OT=typeof window<"u"&&typeof window.__pageLoadStart=="number"?window.__pageLoadStart:AT;Ft("app-js-executed",{sinceNavStartMs:Math.round(BT-OT)});try{window.addEventListener("resize",rr(()=>{Po=null},150)),window.addEventListener("orientationchange",()=>{Po=null})}catch{}var RT="debugPerf",vk=!1;function $T(){try{let e=new URL(window.location.href).searchParams.get(RT);return e==="1"||e==="true"}catch{return!1}}function Vr(t,e){Bu.has(t)||(Bu.add(t),typeof performance<"u"&&typeof performance.mark=="function"&&performance.mark(t),Ft(t,e))}var B=[],A=[],Ve=[],Ot=1,St=1,to=1,dl=null,ul=new Set,pl=null,Ss=null,et=[],ce={selectedTaskIds:new Set,lastSelectedId:null,isToolbarVisible:!1,pendingChanges:[]},st="projects",Tn=null,en="",no="",In=1,Kn=1,xn=10,wk="feedbackItemsCache:v1",R={autoSetStartDateOnStatusChange:!1,autoSetEndDateOnStatusChange:!1,enableReviewStatus:!0,calendarIncludeBacklog:!1,debugLogsEnabled:!1,historySortOrder:"newest",language:"en",customWorkspaceLogo:null,notificationEmail:"",emailNotificationsEnabled:!0,emailNotificationsWeekdaysOnly:!1,emailNotificationsIncludeStartDates:!1,emailNotificationsIncludeBacklog:!1,emailNotificationTime:"09:00",emailNotificationTimeZone:(()=>{try{let t=Intl.DateTimeFormat().resolvedOptions().timeZone;if(["America/Argentina/Buenos_Aires","Atlantic/Canary","Europe/Madrid","UTC"].includes(t))return t}catch{}return"Atlantic/Canary"})()};$T()&&(vk=!0,R.debugLogsEnabled=!0,nr(!0));["projects","tasks","feedbackItems","projectCounter","taskCounter","feedbackCounter","projectsSortedView","selectedCards","lastSelectedCardId","projectToDelete","tempAttachments","projectNavigationReferrer","calendarNavigationState","previousPage","currentFeedbackScreenshotData","feedbackPendingPage","feedbackDonePage","settings"].forEach(t=>{Object.defineProperty(de,t,{get:()=>{switch(t){case"projects":return B;case"tasks":return A;case"feedbackItems":return Ve;case"projectCounter":return Ot;case"taskCounter":return St;case"feedbackCounter":return to;case"projectsSortedView":return dl;case"selectedCards":return ul;case"lastSelectedCardId":return pl;case"projectToDelete":return Ss;case"tempAttachments":return et;case"projectNavigationReferrer":return st;case"calendarNavigationState":return Tn;case"previousPage":return en;case"currentFeedbackScreenshotData":return no;case"feedbackPendingPage":return In;case"feedbackDonePage":return Kn;case"settings":return R}},set:e=>{switch(t){case"projects":B=e;break;case"tasks":A=e;break;case"feedbackItems":Ve=e;break;case"projectCounter":Ot=e;break;case"taskCounter":St=e;break;case"feedbackCounter":to=e;break;case"projectsSortedView":dl=e;break;case"selectedCards":ul=e;break;case"lastSelectedCardId":pl=e;break;case"projectToDelete":Ss=e;break;case"tempAttachments":et=e;break;case"projectNavigationReferrer":st=e;break;case"calendarNavigationState":Tn=e;break;case"previousPage":en=e;break;case"currentFeedbackScreenshotData":no=e;break;case"feedbackPendingPage":In=e;break;case"feedbackDonePage":Kn=e;break;case"settings":R=e;break}},configurable:!0,enumerable:!0})});window.saveData=dn;window.loadData=an;var Qr=!1,Yn=0,Jr=new Map;function Yy(t,e,n,s){let o=s||{},r=Number.isFinite(o.delayMs)?o.delayMs:500,a=`${t}:${e}`,i=Jr.get(a);i&&clearTimeout(i);let l=setTimeout(()=>{Jr.delete(a),oo(t,e,n,o)},r);Jr.set(a,l)}function Xy(t,e,n,s){let o=`${t}:${e}`,r=Jr.get(o);r&&(clearTimeout(r),Jr.delete(o)),oo(t,e,n,s||{})}var Sk="nautilusLastSeenReleaseId";var Ek="nautilusNotificationHistory",FT=30,zT=3e4,Ju="nautilusNotificationPendingSeen",Ko=!0,Xe={timestamp:0,data:null},xu=!1;function Zy(t){if(!t)return 0;let e=$t(t)?un(t):t,n=Date.parse(e);return Number.isNaN(n)?0:n}function Wr(t){if(!t)return"";if(typeof t=="string")return t;if(typeof t=="object"){let e=Qn(),n=e&&e.startsWith("es")?"es":"en";return t[n]||t.en||t.es||""}return String(t)}function xk(){return(Array.isArray(Jl)?[...Jl]:[]).sort((e,n)=>Zy(n.date)-Zy(e.date))}function Gu(){return xk()[0]||null}function HT(){try{return localStorage.getItem(Sk)||""}catch{return""}}function Tk(t){if(t)try{localStorage.setItem(Sk,t)}catch{}}function Qy(t){return t?wa(t,Qn()):""}function No(t){return t?Vt(t)?t:$t(t)?un(t):"":""}function Jo(){try{let t=localStorage.getItem(Ek);if(!t)return{notifications:[],lastChecked:null};let e=JSON.parse(t);return{notifications:Array.isArray(e.notifications)?e.notifications:[],lastChecked:e.lastChecked||null}}catch{return{notifications:[],lastChecked:null}}}function ua(t){try{localStorage.setItem(Ek,JSON.stringify(t))}catch{}}function rl(t,e,n){return`notif_${n}_${t}_${e}`}function qT(){if(!Array.isArray(A)||A.length===0)return;let t=Fe("notifications","create-due-today",{taskCount:A.length}),e=new Date().toISOString().split("T")[0],n=Jo(),s=new Set(n.notifications.map(l=>l.id)),o=[],r=R.emailNotificationsIncludeStartDates!==!1,a=!!R.emailNotificationsIncludeBacklog;A.forEach(l=>{if(!l||l.status==="done"||!l.id||l.status==="backlog"&&!a)return;let c=No(l.startDate||""),d=No(l.endDate||"");if(r&&c===e){let u=rl("task_starting",l.id,e);s.has(u)||o.push({id:u,type:"task_starting",taskId:l.id,date:e,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}if(d===e){let u=rl("task_due",l.id,e);s.has(u)||o.push({id:u,type:"task_due",taskId:l.id,date:e,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}});let i=7;for(let l=1;l<=i;l++){let c=new Date;c.setDate(c.getDate()-l);let d=c.toISOString().split("T")[0];A.forEach(u=>{if(!u||u.status==="done"||!u.id)return;let p=No(u.startDate||""),f=No(u.endDate||"");if(r&&p===d){let h=rl("task_starting",u.id,d);s.has(h)||o.push({id:h,type:"task_starting",taskId:u.id,date:d,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}if(f===d){let h=rl("task_due",u.id,d);s.has(h)||o.push({id:h,type:"task_due",taskId:u.id,date:d,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}})}o.length>0&&n.notifications.push(...o),n.lastChecked=new Date().toISOString(),ua(n),Oe("notifications",t,{newCount:o.length,totalCount:n.notifications.length})}function UT(){let t=Jo();t.notifications.forEach(e=>{e.dismissed||(e.read=!0)}),ua(t)}function _T(t){let e=Jo();e.notifications.forEach(n=>{n.date===t&&(n.dismissed=!0)}),ua(e)}function VT(){let t=Jo();t.notifications.forEach(e=>{e.dismissed=!0}),ua(t)}function WT(){let t=Fe("notifications","cleanup"),e=Jo(),n=e.notifications.length,s=new Date;s.setDate(s.getDate()-FT);let o=s.toISOString().split("T")[0];e.notifications=e.notifications.filter(r=>r.date>=o),ua(e),Oe("notifications",t,{beforeCount:n,afterCount:e.notifications.length})}function Dk(){return Jo().notifications.filter(e=>!e.dismissed)}function KT(){return Dk().filter(e=>!e.read).length}function JT(){let e=Dk().filter(o=>o.type==="task_due"||o.type==="task_starting"),n=new Map;return e.forEach(o=>{n.has(o.date)||n.set(o.date,[]),n.get(o.date).push(o)}),Array.from(n.entries()).sort((o,r)=>r[0].localeCompare(o[0]))}function Ro(){let t=Fe("notifications","build-state"),e=Gu(),n=HT(),s=!1,o=JT(),r=KT(),a={latest:e,releaseUnseen:s,taskNotificationsByDate:o,unreadCount:r};return Oe("notifications",t,{unreadCount:r,taskGroups:o.length}),a}function Cl(){return window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken")}function Ik(){let t=localStorage.getItem(Ju);if(!t)return null;try{let e=JSON.parse(t);return!e||!e.seenAt?null:e}catch{return null}}function Gr(t){!t||!t.seenAt||localStorage.setItem(Ju,JSON.stringify(t))}function Tu(t,e=!1){let n=Ik();if(!n){Gr({seenAt:t,clearAll:!!e});return}let s=new Date(n.seenAt).getTime(),o=new Date(t).getTime(),r={seenAt:Number.isFinite(s)&&Number.isFinite(o)&&s>o?n.seenAt:t,clearAll:!!(n.clearAll||e)};Gr(r)}async function GT(){if(!Ko||xu)return;let t=Ik();if(!t)return;let e=Cl();if(e){xu=!0;try{let n={seenAt:t.seenAt,clearAll:!!t.clearAll};t.dismissDate&&(n.dismissDate=t.dismissDate),(await fetch("/api/notifications/state",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify(n)})).ok&&localStorage.removeItem(Ju)}catch(n){console.warn("[notifications] failed to flush pending seen",n)}finally{xu=!1}}}async function fl({force:t=!1}={}){if(Ko){await GT();let e=Date.now();if(!t&&Xe.data&&e-Xe.timestamp<zT)return Xe.data;let n=Cl();if(n)try{let s=await fetch("/api/notifications/state",{headers:{Authorization:`Bearer ${n}`}});if(s.ok){let o=await s.json(),i={latest:Gu(),releaseUnseen:!1,taskNotificationsByDate:Array.isArray(o.taskNotificationsByDate)?o.taskNotificationsByDate:[],unreadCount:Number(o.unreadCount)||0};return Xe={timestamp:e,data:i},i}}catch(s){console.warn("[notifications] failed to fetch server state",s)}}return Ro()}function $o(t=Ro()){let e=document.getElementById("notification-count");if(!e)return;let s=(t.releaseUnseen&&t.latest?1:0)+t.unreadCount;s>0?(e.textContent=s>99?"99+":String(s),e.classList.add("is-visible")):(e.textContent="",e.classList.remove("is-visible"))}function YT(t){let e=new Date().toISOString().split("T")[0],n=new Date;n.setDate(n.getDate()-1);let s=n.toISOString().split("T")[0];return t===e?g("notifications.today")||"Today":t===s?g("notifications.yesterday")||"Yesterday":wa(t,Qn())}function ea(t=Ro()){let e=document.getElementById("notification-list");if(!e)return;let n=Fe("notifications","render-dropdown",{taskGroups:t.taskNotificationsByDate.length,unreadCount:t.unreadCount}),s=[],o=new Map(B.map(i=>[i.id,i])),r=new Map(A.map(i=>[i.id,i])),a=!!R.emailNotificationsIncludeBacklog;t.taskNotificationsByDate.forEach(([i,l])=>{let c=YT(i),d=l.filter(E=>E.type==="task_starting").map(E=>r.get(E.taskId)).filter(E=>E&&E.status!=="done"&&(a||E.status!=="backlog")).filter(E=>No(E.startDate||"")===i),u=l.filter(E=>E.type==="task_due").map(E=>r.get(E.taskId)).filter(E=>E&&E.status!=="done"&&(a||E.status!=="backlog")).filter(E=>No(E.endDate||"")===i);if(d.length===0&&u.length===0)return;let p=E=>[...E].sort((b,w)=>{let I=ke[b.priority||"low"]||0,M=ke[w.priority||"low"]||0;return I!==M?M-I:String(b.title||"").localeCompare(String(w.title||""))}),f=p(d),h=p(u),m=E=>E.slice(0,3).map(b=>{let w=b.projectId?o.get(b.projectId):null,I=w?w.name:"",M=w?Ke(w.id):"",z=(b.priority||"low").toLowerCase(),_=["high","medium","low"].includes(z)?At(z):z||"";return`
                    <div class="notify-task" data-task-id="${b.id}">
                        <div class="notify-task-header">
                            <div class="notify-task-title">${V(b.title||g("tasks.untitled"))}</div>
                            <span class="notify-priority notify-priority--${z}">${V(_)}</span>
                        </div>
                    </div>
                `}).join(""),y="",k=0,S=0;if(f.length>0){let E=f.slice(0,3),b=Math.max(f.length-E.length,0);k+=f.length,S+=b,y+=`<div class="notify-section-subheader notify-section-subheader--starting">\u{1F680} STARTING <span class="notify-section-count notify-section-count--starting" aria-label="${f.length} starting tasks">${f.length}</span></div>`,y+=m(E),b>0&&(y+=`<div class="notify-task-overflow">+${b} more starting</div>`,y+=`<button type="button" class="notify-link notify-link--starting notify-link--full" data-action="openDueTodayFromNotification" data-date="${i}" data-date-field="startDate">View ${f.length} starting</button>`)}if(h.length>0){let E=h.slice(0,3),b=Math.max(h.length-E.length,0);k+=h.length,S+=b,f.length>0&&(y+='<div style="height: 1px; background: var(--border); margin: 10px 0;"></div>'),y+=`<div class="notify-section-subheader notify-section-subheader--due">\u{1F3AF} DUE <span class="notify-section-count notify-section-count--due" aria-label="${h.length} due tasks">${h.length}</span></div>`,y+=m(E),b>0&&(y+=`<div class="notify-task-overflow">+${b} more due</div>`,y+=`<button type="button" class="notify-link notify-link--due notify-link--full" data-action="openDueTodayFromNotification" data-date="${i}" data-date-field="endDate">View ${h.length} due</button>`)}let T=new Date().toISOString().split("T")[0],D=i===T;s.push(`
            <div class="notify-section notify-section--due" data-date="${i}">
                <div class="notify-section-heading">
                    <div class="notify-section-title">
                        <span class="notify-section-title-text">${c}</span>
                        ${D?"":`<div class="notify-section-title-actions"><button type="button" class="notify-dismiss-btn" data-action="dismissDate" data-date="${i}" aria-label="Dismiss" title="Dismiss">x</button></div>`}
                    </div>
                </div>
                <div class="notify-task-list">
                    ${y}
                </div>
            </div>
        `)}),s.length===0&&s.push(`<div class="notify-empty">${g("notifications.empty")}</div>`),e.innerHTML=s.join(""),Oe("notifications",n,{sections:s.length,taskGroups:t.taskNotificationsByDate.length})}var al=null;function ys({force:t=!1}={}){al&&clearTimeout(al),al=setTimeout(async()=>{let e=await fl({force:t});$o(e);let n=document.getElementById("notification-dropdown");n&&n.classList.contains("active")&&ea(e),al=null},100)}async function Ou(t=null,{clearAll:e=!1}={}){if(t&&t.latest&&t.latest.id&&Tk(t.latest.id),Ko){let s=new Date().toISOString(),o=Cl();if(!o){Tu(s,e);let a={...t||Xe.data||Ro(),unreadCount:0};Xe={timestamp:Date.now(),data:a},$o(a);return}if(o)try{if((await fetch("/api/notifications/state",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({seenAt:s,clearAll:!!e})})).ok){let i={...t||Xe.data||Ro(),unreadCount:0};Xe={timestamp:Date.now(),data:i},$o(i);return}Tu(s,e)}catch(r){console.warn("[notifications] failed to mark seen",r),Tu(new Date().toISOString(),e)}}UT();let n=Ro();$o(n)}async function XT(t){if(Ko){let e=new Date().toISOString(),n=Cl();if(!n){if(Gr({seenAt:e,dismissDate:t}),Xe.data&&Xe.data.taskNotificationsByDate){let s={...Xe.data,taskNotificationsByDate:Xe.data.taskNotificationsByDate.filter(([o])=>o!==t)};Xe={timestamp:Date.now(),data:s},$o(s),ea(s)}return}try{if((await fetch("/api/notifications/state",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({seenAt:e,dismissDate:t})})).ok){if(Xe.data&&Xe.data.taskNotificationsByDate){let o={...Xe.data,taskNotificationsByDate:Xe.data.taskNotificationsByDate.filter(([r])=>r!==t)};Xe={timestamp:Date.now(),data:o},$o(o),ea(o)}return}Gr({seenAt:e,dismissDate:t})}catch(s){console.warn("[notifications] failed to dismiss date",s),Gr({seenAt:e,dismissDate:t})}}else _T(t),ys()}function ZT(){let t=Gu();!t||!t.id||(Tk(t.id),ys())}function ks(){let t=document.getElementById("notification-dropdown"),e=document.getElementById("notification-toggle");t&&t.classList.remove("active"),e&&e.classList.remove("active"),Ck(!1)}function Ck(t){typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 768px)").matches&&document.body.classList.toggle("notify-scroll-lock",!!t)}function QT(){let t=document.getElementById("notification-toggle"),e=document.getElementById("notification-dropdown");!t||!e||t.dataset.bound||(t.dataset.bound="true",t.addEventListener("click",async n=>{if(n.stopPropagation(),e.classList.contains("active")){ks();return}ma();let o=await fl({force:!0});ea(o),e.classList.add("active"),t.classList.add("active"),Ck(!0),await Ou(o)}),e.dataset.outsideListener||(e.dataset.outsideListener="true",document.addEventListener("click",n=>{if(!e.classList.contains("active"))return;let s=n.target;s&&(e.contains(s)||t.contains(s)||ks())})),e.dataset.actionListener||(e.dataset.actionListener="true",e.addEventListener("click",async n=>{let s=n.target;if(!s)return;let o=s.closest(".notify-task");if(o&&o.dataset.taskId){n.preventDefault(),n.stopPropagation();let l=parseInt(o.dataset.taskId,10);isNaN(l)||(ks(),ao(l));return}let r=s.closest("[data-action]");if(!r)return;n.preventDefault(),n.stopPropagation();let a=r.dataset.action,i=r.dataset.date;if(a==="dismissDate"&&i)await XT(i);else if(a==="dismissAll")if(Ko){let l=Xe.data||await fl({force:!0});await Ou(l,{clearAll:!0}),ys({force:!0})}else VT(),ys();else if(a==="openUpdatesFromNotification")Ak();else if(a==="openDueTodayFromNotification"&&i){let l=r.getAttribute("data-date-field")||"endDate";Mk(i,l)}})),ys())}function Ak(){if(ks(),window.location.hash.replace("#","")==="updates"){Ze("updates");return}window.location.hash="updates"}function Mk(t,e="endDate"){ks();let n=new Date().toISOString().split("T")[0],s=t===n,r=!!R.emailNotificationsIncludeBacklog?"backlog,todo,progress,review":"todo,progress,review",a;if(s?a=`#tasks?view=list&datePreset=${e==="startDate"?"start-today":"end-today"}&status=${r}`:a=`#tasks?view=list&dateFrom=${t}&dateTo=${t}&dateField=${e}&status=${r}`,window.location.hash===a){Ze("tasks");return}window.location.hash=a.replace("#","")}var wt="priority",Me={};function eD(){wt="priority",Me={};let t=document.getElementById("sort-btn"),e=document.getElementById("sort-label"),n=document.getElementById("sort-icon");t&&t.classList.remove("manual"),e&&(e.textContent=g("tasks.sort.orderByPriority")),n&&(n.textContent="\u2B06\uFE0F"),ft(),Kr()}async function Kr(){try{await Sp(wt,Me)}catch{try{localStorage.setItem("sortMode",wt),localStorage.setItem("manualTaskOrder",JSON.stringify(Me))}catch{}}}function Jn(){let t=document.getElementById("sort-toggle"),e=document.getElementById("sort-btn"),n=document.getElementById("sort-label"),s=document.getElementById("sort-icon"),o=document.getElementById("group-kanban-updated");if(!t||!e)return;let r=document.querySelector(".kanban-board"),a=r&&!r.classList.contains("hidden");t.style.display=a?"flex":"none";let i=document.getElementById("list-view")?.classList.contains("active"),l=document.getElementById("calendar-view")?.classList.contains("active"),c=a||i||l;o&&(o.style.display=c?"":"none");try{$l()}catch{}try{e.classList.remove("manual")}catch{}n&&(n.textContent=g("tasks.sort.orderByPriority")),s&&(s.textContent="\u21C5");try{let d=window.kanbanShowBacklog===!0?["backlog","todo","progress","review","done"]:["todo","progress","review","done"],u=typeof ln=="function"?ln():A.slice(),p=Is(window.kanbanUpdatedFilter);p!==null&&(u=u.filter(m=>Ln(m)>=p));let f=(m,y)=>{if(m.length!==y.length)return!1;for(let k=0;k<m.length;k++)if(m[k]!==y[k])return!1;return!0},h=!0;for(let m of d){let k=Array.from(document.querySelectorAll(`#${m}-tasks .task-card`)).map(T=>parseInt(T.dataset.taskId,10)).filter(T=>!Number.isNaN(T)),S=u.filter(T=>T.status===m).slice().sort((T,D)=>(ke[D.priority]||0)-(ke[T.priority]||0)).map(T=>T.id);if(!f(k,S)){h=!1;break}}h?(e.disabled=!0,e.classList.add("disabled"),e.setAttribute("aria-disabled","true")):(e.disabled=!1,e.classList.remove("disabled"),e.removeAttribute("aria-disabled"))}catch{e.disabled=!1,e.classList.remove("disabled")}}async function Rt(){if(Qr)return;Yn++;let t=Fe("storage","save-projects",{projectCount:B.length}),e=!1;try{await bp(B),e=!0}catch(n){throw console.error("Error saving projects:",n),Y(g("error.saveProjectsFailed")),n}finally{Oe("storage",t,{success:e,projectCount:B.length}),Yn--}}async function ot(){if(Qr)return;Yn++;let t=Fe("storage","save-tasks",{taskCount:A.length}),e=!1;try{await kp(A),e=!0}catch(n){let s=n?.message??String(n),o=n?.stack;throw console.error("[Storage] Save tasks failed:",s),o&&console.error("[Storage] Stack:",o),Y(g("error.saveTasksFailed")),n}finally{Oe("storage",t,{success:e,taskCount:A.length}),Yn--}}var Yr=!1,hl=!1,Yu=!1,ll=null,ek=3,tD=1e3;function Al(){try{localStorage.setItem(wk,JSON.stringify(Ve))}catch{}}async function pa(t=1){if(!Yr){if(!navigator.onLine){Gn();return}Yr=!0,Yn++,Gn();try{await vp(Ve),hl=!1,rD()}catch(e){if(console.error("Feedback save error:",e),hl=!0,Gn(),t<ek){let n=tD*Math.pow(2,t-1);setTimeout(()=>{pa(t+1)},n)}else console.error(`Feedback save failed after ${ek} attempts`),Y(g("error.saveFeedbackFailed"))}finally{Yr=!1,Yn=Math.max(0,Yn-1),Gn()}}}function nD(){ll!==null&&(clearTimeout(ll),ll=null)}function sD(){nD(),ll=setTimeout(()=>{let t=document.getElementById("feedback-save-status");if(!t)return;t.classList.add("is-hidden"),Yu=!1;let e=t.querySelector(".feedback-save-text");e&&(e.textContent="")},1600)}function Gn(){let t=document.getElementById("feedback-save-status");if(!t)return;let e=t.querySelector(".feedback-save-text")||t,n="saved";Yr?navigator.onLine?n="saving":n="offline":hl&&(n="error");let s={saved:"feedback.saveStatus.saved",saving:"feedback.saveStatus.saving",error:"feedback.saveStatus.error",offline:"feedback.saveStatus.offline"}[n];e.textContent=g(s);let o=n!=="saved"||Yu;t.classList.toggle("is-hidden",!o),t.classList.toggle("is-saving",n==="saving"),t.classList.toggle("is-error",n==="error"),t.classList.toggle("is-offline",n==="offline"),t.classList.toggle("is-saved",n==="saved")}function oD(){let t=document.getElementById("feedback-description");if(!t)return;let n=window.matchMedia("(max-width: 768px)").matches?"feedback.descriptionPlaceholderShort":"feedback.descriptionPlaceholder";t.setAttribute("placeholder",g(n))}function rD(){hl=!1,Yu=!0,Gn(),sD()}async function Lk(){if(!Qr)try{await wp(Dn)}catch(t){console.error("Error saving project colors:",t),Y(g("error.saveProjectColorsFailed"))}}async function Ml(){let t=Fe("settings","save"),e=!1;try{await Ap(R),e=!0}catch(n){console.error("Error saving settings:",n)}finally{Oe("settings",t,{success:e})}window.initialSettingsFormState=null,window.settingsFormIsDirty=!1}var _e=null,bs=null,Re=null,vs=null;function aD(t){let o=String(t||""),r=[];for(let a=480;a<=1080;a+=30){let i=Jp(a),l=i===o?" selected":"";r.push(`<div class="time-option${l}" role="option" data-value="${i}">${i}</div>`)}return r.join("")}function iD(t){if(!t||!t.options)return"";let e=String(t.value||""),n=[];return Array.from(t.options).forEach(s=>{let o=String(s.value||""),r=String(s.textContent||o),a=o===e?" selected":"";n.push(`<div class="tz-option${a}" role="option" data-value="${V(o)}">${V(r)}</div>`)}),n.join("")}function lD(t,e,n){if(!t||!e)return;Re||(Re=document.createElement("div"),Re.className="tz-options-portal",document.body.appendChild(Re)),Re.innerHTML=iD(e),Re.style.display="block",vs=t,Ru(t,Re),requestAnimationFrame(()=>Ru(t,Re)),t.setAttribute("aria-expanded","true");let s=o=>{o.stopPropagation();let r=o.target.closest(".tz-option");if(!r)return;let a=r.dataset.value;if(a){if(e.value=a,n){let i=e.options?.[e.selectedIndex]?.textContent||a;n.textContent=i}e.dispatchEvent(new Event("change",{bubbles:!0})),Ho()}};Re.onclick=s,setTimeout(()=>document.addEventListener("click",jk,!0),0),window.addEventListener("scroll",ml,!0),window.addEventListener("resize",ml,!0),document.addEventListener("keydown",Pk,!0)}function Ho(){Re&&(Re.style.display="none",Re.innerHTML="",Re.onclick=null,vs&&vs.setAttribute("aria-expanded","false"),vs=null,document.removeEventListener("click",jk,!0),window.removeEventListener("scroll",ml,!0),window.removeEventListener("resize",ml,!0),document.removeEventListener("keydown",Pk,!0))}function jk(t){let e=t.target;!Re||Re.style.display==="none"||Re.contains(e)||vs&&vs.contains(e)||Ho()}function ml(){!vs||!Re||Re.style.display==="none"||Ru(vs,Re)}function Pk(t){t.key==="Escape"&&(!Re||Re.style.display==="none"||(t.preventDefault(),Ho()))}function Ru(t,e){let n=t.getBoundingClientRect();e.style.width=`${n.width}px`;let s=window.innerHeight,o=Math.min(e.scrollHeight,240),i=s-n.bottom<o+12?Math.max(8,n.top-o-4):n.bottom+4,l=window.innerWidth,c=e.getBoundingClientRect().width||n.width,d=n.left,u=Math.min(Math.max(8,d),Math.max(8,l-c-8));e.style.left=`${u}px`,e.style.top=`${i}px`}function cD(t,e,n){if(!t||!e)return;_e||(_e=document.createElement("div"),_e.className="time-options-portal",document.body.appendChild(_e));let s=String(e.value||"").trim();_e.innerHTML=aD(s),_e.style.display="block",bs=t,$u(t,_e),requestAnimationFrame(()=>$u(t,_e)),t.setAttribute("aria-expanded","true");let o=r=>{r.stopPropagation();let a=r.target.closest(".time-option");if(!a)return;let i=a.dataset.value;i&&(e.value=i,n&&(n.textContent=i),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded(),qo())};_e.addEventListener("click",o),setTimeout(()=>document.addEventListener("click",Nk,!0),0),window.addEventListener("scroll",gl,!0),window.addEventListener("resize",gl,!0),document.addEventListener("keydown",Bk,!0)}function qo(){_e&&(_e.style.display="none",_e.innerHTML="",bs&&bs.setAttribute("aria-expanded","false"),bs=null,document.removeEventListener("click",Nk,!0),window.removeEventListener("scroll",gl,!0),window.removeEventListener("resize",gl,!0),document.removeEventListener("keydown",Bk,!0))}function Nk(t){let e=t.target;!_e||_e.style.display==="none"||_e.contains(e)||bs&&bs.contains(e)||qo()}function gl(){!bs||!_e||_e.style.display==="none"||$u(bs,_e)}function Bk(t){t.key==="Escape"&&(!_e||_e.style.display==="none"||(t.preventDefault(),qo()))}function $u(t,e){let n=t.getBoundingClientRect();e.style.width=`${n.width}px`;let s=window.innerHeight,o=Math.min(e.scrollHeight,260),i=s-n.bottom<o+12?Math.max(8,n.top-o-4):n.bottom+4,l=window.innerWidth,c=e.getBoundingClientRect().width||n.width,d=n.left,u=Math.min(Math.max(8,d),Math.max(8,l-c-8));e.style.left=`${u}px`,e.style.top=`${i}px`}function Ok(){let t=document.querySelector(".workspace-icon");t&&(Eu===null&&(Eu=t.textContent||""),R.customWorkspaceLogo?(t.style.backgroundImage=`url(${R.customWorkspaceLogo})`,t.textContent=""):(t.style.backgroundImage="",t.textContent=Eu))}function tk({tasks:t,projects:e,feedbackItems:n}={}){B=e||[],A=t||[],Ve=n||[],B.forEach(s=>{s&&s.id!=null&&(s.id=parseInt(s.id,10)),Array.isArray(s.tags)||(s.tags=[])}),A.forEach(s=>{s&&(s.id!=null&&(s.id=parseInt(s.id,10)),s.projectId!=null&&s.projectId!=="null"?s.projectId=parseInt(s.projectId,10):s.projectId=null,(s.startDate===void 0||s.startDate===null)&&(s.startDate=""),(s.endDate===void 0||s.endDate===null)&&(s.endDate=""),typeof s.startDate!="string"&&(s.startDate=String(s.startDate||"")),typeof s.endDate!="string"&&(s.endDate=String(s.endDate||"")),Array.isArray(s.tags)||(typeof s.tags=="string"&&s.tags.trim()!==""?s.tags=s.tags.split(",").map(o=>o.trim()).filter(Boolean):s.tags=[]),Array.isArray(s.attachments)||(s.attachments=[]),s.startDateWasEverSet===void 0&&(s.startDateWasEverSet=s.startDate.trim()!==""),s.endDateWasEverSet===void 0&&(s.endDateWasEverSet=s.endDate.trim()!==""),s.dueDate&&!s.endDate&&(s.endDate=s.dueDate,s.endDateWasEverSet=!0),delete s.dueDate)}),Ve.forEach(s=>{s&&s.id!=null&&(s.id=parseInt(s.id,10))}),Al(),B.length>0?Ot=Math.max(...B.map(s=>s.id||0))+1:Ot=1,A.length>0?St=Math.max(...A.map(s=>s.id||0))+1:St=1,Ve.length>0?to=Math.max(...Ve.map(s=>s.id||0))+1:to=1}var Du={},Dn={},nk=0;function sn(t){return Du[t]||(Du[t]=Kl[nk%Kl.length],nk++),Du[t]}function Ke(t){if(!Dn[t]){let e=new Set(Object.values(Dn)),n=er.filter(s=>!e.has(s));Dn[t]=n.length>0?n[0]:er[Object.keys(Dn).length%er.length]}return Dn[t]}function Rk(t,e){Dn[t]=e,Lk(),document.getElementById("calendar-view").classList.contains("active")&&ye()}function dD(t){let e=document.getElementById(`color-picker-${t}`);if(e){let n=e.style.display!=="none";document.querySelectorAll(".color-picker-dropdown").forEach(s=>s.style.display="none"),e.style.display=n?"none":"block"}}function uD(t,e){Rk(t,e);let n=document.querySelector(`#color-picker-${t}`).previousElementSibling;n&&(n.style.backgroundColor=e);let s=document.getElementById(`color-picker-${t}`);if(s){s.querySelectorAll(".color-option").forEach(a=>{let c="#"+a.style.backgroundColor.replace(/rgb\(|\)|\s/g,"").split(",").map(d=>parseInt(d,10).toString(16).padStart(2,"0")).join("");a.style.border=c.toUpperCase()===e.toUpperCase()?"2px solid white":"2px solid transparent"});let r=s.querySelector(".custom-color-swatch");r&&(r.style.border="2px solid transparent")}let o=B.find(r=>r.id===t);o&&o.tags&&ga(o.tags,t),document.getElementById("projects")?.classList.contains("active")&&(de.projectsSortedView=null,Mt())}function pD(t,e){if(!e)return;Rk(t,e);let n=document.getElementById(`color-picker-${t}`);if(n){let r=n.previousElementSibling;r&&(r.style.backgroundColor=e);let a=n.querySelector(".custom-color-swatch");a&&(a.style.backgroundColor=e)}let s=document.getElementById(`color-picker-${t}`);if(s){s.querySelectorAll(".color-option").forEach(a=>{a.style.border="2px solid transparent"});let r=s.querySelector(".custom-color-swatch");r&&(r.style.border="2px solid white")}let o=B.find(r=>r.id===t);o&&o.tags&&ga(o.tags,t),document.getElementById("projects")?.classList.contains("active")&&(de.projectsSortedView=null,Mt())}function fD(t){let e=document.getElementById(`project-color-input-${t}`);e&&(zu=!0,e.click())}var v={search:"",statuses:new Set,statusExcludeMode:!1,priorities:new Set,priorityExcludeMode:!1,projects:new Set,projectExcludeMode:!1,tags:new Set,tagExcludeMode:!1,datePresets:new Set,dateFrom:"",dateTo:""},K={search:"",statuses:new Set,taskFilter:"",updatedFilter:"all",tags:new Set},ut={lastSort:"",direction:"asc"},sk=!1;function hD(){sk||(sk=!0,fa(),Go(),io(),mD())}function fa(){let t=document.getElementById("project-options");if(t){let e=new Set(v.projects);if(t.innerHTML="",A.some(s=>!s.projectId)){let s=document.createElement("li"),o=e.has("none")?"checked":"";s.innerHTML=`<label><input type="checkbox" id="proj-none" value="none" data-filter="project" ${o}> ${g("tasks.noProject")}</label>`,t.appendChild(s)}else e.has("none")&&(v.projects.delete("none"),De());if(B.length===0){let s=document.createElement("li");s.textContent=g("filters.noOtherProjects"),s.style.color="var(--text-muted)",s.style.padding="8px 12px",t.appendChild(s)}else B.slice().sort((s,o)=>(s.name||"").localeCompare(o.name||"",void 0,{sensitivity:"base"})).forEach(s=>{let o=document.createElement("li"),r=`proj-${s.id}`,a=e.has(String(s.id))?"checked":"";o.innerHTML=`<label><input type="checkbox" id="${r}" value="${s.id}" data-filter="project" ${a}> ${s.name}</label>`,t.appendChild(o)});t.querySelectorAll('input[type="checkbox"][data-filter="project"]').forEach(s=>{s.addEventListener("change",()=>{uo(v.projects,s.value,s.checked),De(),Be(),document.getElementById("calendar-view")&&ye(),Ye()})})}}function Go(){let t=document.getElementById("tag-options");if(t){let e=new Set(v.tags),n=new Set;if(A.forEach(r=>{r.tags&&r.tags.length>0&&r.tags.forEach(a=>n.add(a))}),t.innerHTML="",A.some(r=>!r.tags||r.tags.length===0)){let r=document.createElement("li"),a=e.has("none")?"checked":"";r.innerHTML=`<label><input type="checkbox" id="tag-none" value="none" data-filter="tag" ${a}> ${g("filters.noTags")}</label>`,t.appendChild(r)}else e.has("none")&&(v.tags.delete("none"),De());if(n.size===0){let r=document.createElement("li");r.textContent=g("filters.noOtherTags"),r.style.color="var(--text-muted)",r.style.padding="8px 12px",t.appendChild(r)}else Array.from(n).sort().forEach(r=>{let a=document.createElement("li"),i=`tag-${r}`,l=e.has(r)?"checked":"";a.innerHTML=`<label><input type="checkbox" id="${i}" value="${r}" data-filter="tag" ${l}> ${r.toUpperCase()}</label>`,t.appendChild(a)});t.querySelectorAll('input[type="checkbox"]').forEach(r=>{r.addEventListener("change",()=>{r.dataset.filter==="tag"&&uo(v.tags,r.value,r.checked),De(),Be(),document.getElementById("calendar-view")&&ye(),Ye()})});let o=document.getElementById("tag-filter-search-input");o&&(o.value="",$k(""))}}function $k(t){let e=document.getElementById("tag-options");if(!e)return;let n=(t||"").toLowerCase().trim();e.querySelectorAll("li").forEach(s=>{let o=(s.textContent||"").toLowerCase(),r=!n||o.includes(n);s.style.display=r?"":"none"})}function mD(){let t=!!(window.matchMedia&&(window.matchMedia("(max-width: 768px)").matches||window.matchMedia("(pointer: coarse)").matches)),e=document.getElementById("project-select-all");e&&e.parentElement.parentElement&&(B.length>1?e.parentElement.parentElement.style.display="block":e.parentElement.parentElement.style.display="none");let n=[document.getElementById("group-status"),document.getElementById("group-priority"),document.getElementById("group-project"),document.getElementById("group-tags"),document.getElementById("group-end-date"),document.getElementById("group-start-date"),document.getElementById("group-kanban-updated"),document.getElementById("group-project-status"),document.getElementById("group-project-updated"),document.getElementById("group-project-tags")].filter(Boolean),s=()=>{let p=document.getElementById("dropdown-backdrop");return p||(p=document.createElement("div"),p.id="dropdown-backdrop",p.setAttribute("aria-hidden","true"),p.addEventListener("click",()=>o()),document.body.appendChild(p)),p},o=()=>{n.forEach(f=>f.classList.remove("open")),document.body.classList.remove("dropdown-sheet-open");let p=document.getElementById("dropdown-backdrop");p&&p.classList.remove("open")},r=p=>{let f=p.querySelector(".dropdown-panel");if(f){if(f.classList.add("has-sheet-header"),t){try{let h=p.getBoundingClientRect(),m=12,y=8,k=window.innerHeight||document.documentElement.clientHeight||0,S=Math.max(0,k-h.bottom-m),T=Math.max(0,h.top-m),D=Math.min(460,Math.floor(k*.6)),E=S>=260||S>=T,b=Math.min(D,E?S:T),w=b<220;if(f.classList.toggle("sheet-bottom",w),f.classList.toggle("sheet-anchored",!w),w)f.style.removeProperty("--sheet-top"),f.style.removeProperty("--sheet-maxh");else{b<240&&(b=Math.min(240,Math.max(0,E?S:T)));let I=E?h.bottom+y:h.top-y-b;I=Math.max(m,Math.min(I,k-m-140)),f.style.setProperty("--sheet-top",`${Math.round(I)}px`),f.style.setProperty("--sheet-maxh",`${Math.round(b)}px`)}}catch{f.classList.add("sheet-bottom"),f.classList.remove("sheet-anchored")}s().classList.add("open"),document.body.classList.add("dropdown-sheet-open")}if(!f.querySelector(".dropdown-sheet-header")){let h=f.querySelector(".dropdown-section-title")?.textContent?.trim()||p.querySelector(".filter-button")?.textContent?.trim()||g("filters.sheet.title"),m=document.createElement("div");m.className="dropdown-sheet-header";let y=document.createElement("div");y.className="dropdown-sheet-handle";let k=document.createElement("div");k.className="dropdown-sheet-title",k.textContent=h.toUpperCase();let S=document.createElement("button");S.type="button",S.className="dropdown-sheet-done",S.textContent=g("common.done"),S.addEventListener("click",()=>o()),m.appendChild(y),m.appendChild(k),m.appendChild(S),f.insertBefore(m,f.firstChild)}}};n.forEach(p=>{p.querySelector(".filter-button").addEventListener("click",m=>{m.stopPropagation();let y=p.classList.contains("open");if(o(),!y){if(p.id==="group-status"&&typeof ws=="function")try{ws()}catch{}p.classList.add("open"),r(p)}});let h=p.querySelector(".dropdown-panel");h&&h.addEventListener("click",m=>m.stopPropagation())}),document.addEventListener("click",()=>o()),document.addEventListener("keydown",p=>{p.key==="Escape"&&o()}),document.querySelectorAll('.dropdown-panel input[type="checkbox"][data-filter="status"],.dropdown-panel input[type="checkbox"][data-filter="priority"],.dropdown-panel input[type="checkbox"][data-filter="project"]').forEach(p=>{p.addEventListener("change",()=>{let f=p.dataset.filter;f==="status"&&uo(v.statuses,p.value,p.checked),f==="priority"&&uo(v.priorities,p.value,p.checked),f==="project"&&uo(v.projects,p.value,p.checked),De(),Be(),document.getElementById("calendar-view")&&ye(),Ye()})});let a=document.getElementById("tag-filter-search-input");a&&a.addEventListener("input",()=>$k(a.value)),document.querySelectorAll(".filter-mode-toggle").forEach(p=>{let f=p.dataset.filterType,h=p.querySelector('.filter-mode-btn[data-mode="include"]'),m=p.querySelector('.filter-mode-btn[data-mode="exclude"]');h&&h.addEventListener("click",y=>{y.stopPropagation();let S=`${f==="tags"?"tag":f}ExcludeMode`;v[S]&&(v[S]=!1,Fu(f),De(),Be(),document.getElementById("calendar-view")&&ye(),Ye())}),m&&m.addEventListener("click",y=>{y.stopPropagation();let S=`${f==="tags"?"tag":f}ExcludeMode`;v[S]||(v[S]=!0,Fu(f),De(),Be(),document.getElementById("calendar-view")&&ye(),Ye())})}),document.querySelectorAll('input[type="checkbox"][data-filter="date-preset"]').forEach(p=>{p.addEventListener("change",()=>{let f=p.value;if(p.checked){if(v.datePresets.add(f),v.datePresets.size>0){v.dateFrom="",v.dateTo="";let m=document.getElementById("filter-date-from"),y=document.getElementById("filter-date-to");m&&(m.value=""),y&&(y.value="")}}else v.datePresets.delete(f);De(),Be(),document.getElementById("calendar-view")&&ye(),Ye()})});let i=document.getElementById("project-select-all");i&&i.addEventListener("change",()=>{let p=document.querySelectorAll('.dropdown-panel input[type="checkbox"][data-filter="project"]'),f=i.checked;p.forEach(m=>{m.checked=f,f?v.projects.add(m.value):v.projects.delete(m.value)}),De(),Be(),document.getElementById("calendar-view")&&ye(),Ye()});let l=document.getElementById("filter-search");l&&(l.addEventListener("keydown",p=>{p.key==="Enter"&&(p.preventDefault(),l.blur())}),l.addEventListener("input",()=>{v.search=(l.value||"").trim().toLowerCase(),De(),Be(),document.getElementById("calendar-view")&&ye(),Ye()})),document.querySelectorAll('input[type="radio"][data-filter="kanban-updated"][name="kanban-updated-filter"]').forEach(p=>{p.addEventListener("change",()=>{p.checked&&(ia(p.value),Ye())})});let c=document.getElementById("filter-date-from"),d=document.getElementById("filter-date-to");c?c.addEventListener("change",()=>{v.dateFrom=c.value,De(),Be(),document.getElementById("calendar-view")&&ye(),Ye()}):console.error("[Filter] Date From element not found!"),d?d.addEventListener("change",()=>{v.dateTo=d.value,De(),Be(),document.getElementById("calendar-view")&&ye(),Ye()}):console.error("[Filter] Date To element not found!");let u=document.getElementById("btn-clear-filters");u&&u.addEventListener("click",()=>{v.search="",v.statuses.clear(),v.statusExcludeMode=!1,v.priorities.clear(),v.priorityExcludeMode=!1,v.projects.clear(),v.projectExcludeMode=!1,v.tags.clear(),v.tagExcludeMode=!1,v.datePresets.clear(),v.dateFrom="",v.dateTo="";try{ia("all",{render:!1})}catch{}if(document.querySelectorAll('.dropdown-panel input[type="checkbox"]').forEach(f=>f.checked=!1),l&&(l.value=""),c){c.value="";let f=c.closest(".date-input-wrapper");if(f){let h=f.querySelector(".date-display");h&&h._flatpickr&&h._flatpickr.clear()}}if(d){d.value="";let f=d.closest(".date-input-wrapper");if(f){let h=f.querySelector(".date-display");h&&h._flatpickr&&h._flatpickr.clear()}}De(),Be(),document.getElementById("calendar-view")&&ye(),Ye()}),De(),ha(),$l(),Ye()}function gD(t){let e=t==="tags"?"tag":t;document.querySelectorAll(`input[type="checkbox"][data-filter="${e}"]`).forEach(n=>{let s=v[t==="status"?"statuses":t==="priority"?"priorities":t==="project"?"projects":"tags"];n.checked=s.has(n.value)})}function Fu(t){let e=document.querySelector(`.filter-mode-toggle[data-filter-type="${t}"]`);if(!e)return;let s=`${t==="tags"?"tag":t}ExcludeMode`,o=v[s]||!1,r=e.querySelector('.filter-mode-btn[data-mode="include"]'),a=e.querySelector('.filter-mode-btn[data-mode="exclude"]');r&&r.classList.toggle("active",!o),a&&a.classList.toggle("active",!!o),gD(t)}function Fk(){["status","priority","tags","project"].forEach(t=>Fu(t))}function Ye(){let t=document.getElementById("btn-clear-filters");if(!t)return;let e=document.querySelector(".kanban-board"),n=e&&!e.classList.contains("hidden"),s=document.getElementById("list-view")?.classList.contains("active"),o=document.getElementById("calendar-view")?.classList.contains("active"),a=(n||s||o)&&window.kanbanUpdatedFilter&&window.kanbanUpdatedFilter!=="all",i=v.search&&v.search.trim()!==""||v.statuses.size>0||v.priorities.size>0||v.projects.size>0||v.tags.size>0||v.datePresets.size>0||v.dateFrom&&v.dateFrom!==""||v.dateTo&&v.dateTo!==""||a;t.style.display=i?"inline-flex":"none"}function De(){let t=document.getElementById("badge-status"),e=document.getElementById("badge-priority"),n=document.getElementById("badge-project"),s=document.getElementById("badge-tags"),o=document.getElementById("badge-end-date"),r=document.getElementById("badge-start-date");t&&(t.textContent=v.statuses.size===0?"":v.statuses.size),e&&(e.textContent=v.priorities.size===0?"":v.priorities.size),n&&(n.textContent=v.projects.size===0?"":v.projects.size),s&&(s.textContent=v.tags.size===0?"":v.tags.size);let a=["no-date","overdue","end-today","end-tomorrow","end-7days","end-week","end-month"],i=["no-start-date","already-started","start-today","start-tomorrow","start-7days","start-week","start-month"],l=0,c=0;v.datePresets.forEach(u=>{a.includes(u)?l++:i.includes(u)&&c++}),o&&(o.textContent=l===0?"":l),r&&(r.textContent=c===0?"":c);let d=(u,p)=>{let f=document.getElementById(u);if(f){let h=f.closest(".filter-button");h&&(p?h.classList.add("active"):h.classList.remove("active"))}};d("badge-status",v.statuses.size>0),d("badge-priority",v.priorities.size>0),d("badge-project",v.projects.size>0),d("badge-tags",v.tags.size>0),d("badge-end-date",l>0),d("badge-start-date",c>0),Fk(),ha(),Ye(),Sa("filters","badges",{statusCount:v.statuses.size,priorityCount:v.priorities.size,projectCount:v.projects.size,tagCount:v.tags.size,endDateCount:l,startDateCount:c})}function ha(){let t=document.getElementById("active-filters");if(!t)return;let e=Fe("filters","chips");t.innerHTML="";let n=(i,l,c,d,u)=>{let p=document.createElement("span");p.className="filter-chip",d==="status"?p.classList.add("chip-status"):d==="priority"&&p.classList.add("chip-priority");let f=document.createElement("span");if(f.className="chip-text",d==="status"&&u){let m=document.createElement("span");m.className=`dot ${u}`,f.appendChild(m),f.appendChild(document.createTextNode(` ${i}: ${l}`))}else f.textContent=`${i}: ${l}`;let h=document.createElement("button");h.type="button",h.className="chip-remove",h.setAttribute("aria-label",g("filters.chip.removeAria",{label:i})),h.textContent="\xD7",h.addEventListener("click",c),p.appendChild(f),p.appendChild(h),t.appendChild(p)};v.search&&n(g("filters.chip.search"),v.search,()=>{v.search="";let i=document.getElementById("filter-search");i&&(i.value=""),De(),Ye(),Be()});let s=v.statusExcludeMode?g("tasks.filters.excluding"):g("tasks.filters.status");v.statuses.forEach(i=>n(s,pt(i),()=>{v.statuses.delete(i);let l=document.querySelector(`input[type="checkbox"][data-filter="status"][value="${i}"]`);l&&(l.checked=!1),De(),Be()},"status",i));let o=v.priorityExcludeMode?g("tasks.filters.excluding"):g("tasks.filters.priority");v.priorities.forEach(i=>n(o,At(i),()=>{v.priorities.delete(i);let l=document.querySelector(`input[type="checkbox"][data-filter="priority"][value="${i}"]`);l&&(l.checked=!1),De(),Be()},"priority",i));let r=v.projectExcludeMode?g("tasks.filters.excluding"):g("filters.chip.project");v.projects.forEach(i=>{let l=B.find(c=>c.id.toString()===i.toString());n(r,l?l.name:i,()=>{v.projects.delete(i);let c=document.querySelector(`input[type="checkbox"][data-filter="project"][value="${i}"]`);c&&(c.checked=!1),De(),Be()})});let a=v.tagExcludeMode?g("tasks.filters.excluding"):g("filters.chip.tag");v.tags.forEach(i=>n(a,i,()=>{v.tags.delete(i);let l=document.querySelector(`input[type="checkbox"][data-filter="tag"][value="${i}"]`);l&&(l.checked=!1),De(),Be()})),v.datePresets.forEach(i=>{let c={"no-date":g("tasks.filters.noDate"),overdue:g("tasks.filters.overdue"),"end-today":g("tasks.filters.endToday"),"end-tomorrow":g("tasks.filters.endTomorrow"),"end-7days":g("tasks.filters.end7Days"),"end-week":g("tasks.filters.endThisWeek"),"end-month":g("tasks.filters.endThisMonth"),"no-start-date":g("tasks.filters.noStartDate"),"already-started":g("tasks.filters.alreadyStarted"),"start-today":g("tasks.filters.startToday"),"start-tomorrow":g("tasks.filters.startTomorrow"),"start-7days":g("tasks.filters.start7Days"),"start-week":g("tasks.filters.startThisWeek"),"start-month":g("tasks.filters.startThisMonth")}[i]||i;n(g("filters.chip.date"),c,()=>{v.datePresets.delete(i);let d=document.querySelector(`input[type="checkbox"][data-filter="date-preset"][value="${i}"]`);d&&(d.checked=!1),De(),Be()})});try{let i=document.querySelector(".kanban-board"),l=i&&!i.classList.contains("hidden"),c=document.getElementById("list-view")?.classList.contains("active"),d=document.getElementById("calendar-view")?.classList.contains("active");(l||c||d)&&window.kanbanUpdatedFilter&&window.kanbanUpdatedFilter!=="all"&&n(g("filters.chip.updated"),Db(window.kanbanUpdatedFilter),()=>{ia("all"),Ye()})}catch{}if(v.dateFrom||v.dateTo){let i="";v.dateFrom&&v.dateTo?i=`${xe(v.dateFrom)} - ${xe(v.dateTo)}`:v.dateFrom?i=`${g("filters.dateRange.from")} ${xe(v.dateFrom)}`:v.dateTo&&(i=`${g("filters.dateRange.until")} ${xe(v.dateTo)}`),n(g("filters.chip.date"),i,()=>{v.dateFrom="",v.dateTo="";let l=document.getElementById("filter-date-from"),c=document.getElementById("filter-date-to");if(l){l.value="";let d=l.closest(".date-input-wrapper");if(d){let u=d.querySelector(".date-display");u&&u._flatpickr&&u._flatpickr.clear()}}if(c){c.value="";let d=c.closest(".date-input-wrapper");if(d){let u=d.querySelector(".date-display");u&&u._flatpickr&&u._flatpickr.clear()}}Be()})}Oe("filters",e,{chipCount:t.children.length})}function Xr(){let t=new URLSearchParams,e=document.getElementById("list-view")?.classList.contains("active"),n=document.getElementById("calendar-view")?.classList.contains("active");e?t.set("view","list"):n&&t.set("view","calendar"),v.search&&v.search.trim()!==""&&t.set("search",v.search.trim()),v.statuses.size>0&&(t.set("status",Array.from(v.statuses).join(",")),v.statusExcludeMode&&t.set("statusExclude","1")),v.priorities.size>0&&(t.set("priority",Array.from(v.priorities).join(",")),v.priorityExcludeMode&&t.set("priorityExclude","1")),v.projects.size>0&&(t.set("project",Array.from(v.projects).join(",")),v.projectExcludeMode&&t.set("projectExclude","1")),v.tags.size>0&&(t.set("tags",Array.from(v.tags).join(",")),v.tagExcludeMode&&t.set("tagExclude","1")),v.datePresets.size>0&&t.set("datePreset",Array.from(v.datePresets).join(",")),v.dateFrom&&v.dateFrom!==""&&(t.set("dateFrom",v.dateFrom),v.dateField&&v.dateField!=="endDate"&&t.set("dateField",v.dateField)),v.dateTo&&v.dateTo!==""&&t.set("dateTo",v.dateTo),window.kanbanUpdatedFilter&&window.kanbanUpdatedFilter!=="all"&&t.set("updated",window.kanbanUpdatedFilter);let s=t.toString(),o=s?`#tasks?${s}`:"#tasks";window.location.hash!==o&&window.history.replaceState(null,"",o)}function Be(){Xr(),ha(),ft(),($e()||document.getElementById("list-view").classList.contains("active"))&&on(),document.getElementById("calendar-view").classList.contains("active")&&ye()}function ln(){let t=Fe("filters","tasks",{totalTasks:A.length,hasSearch:!!v.search,statusCount:v.statuses.size,priorityCount:v.priorities.size,projectCount:v.projects.size,tagCount:v.tags.size,datePresetCount:v.datePresets.size,hasDateRange:!!(v.dateFrom||v.dateTo)}),e=Yp(A,{search:v.search,statuses:v.statuses,statusExcludeMode:v.statusExcludeMode,priorities:v.priorities,priorityExcludeMode:v.priorityExcludeMode,projects:v.projects,projectExcludeMode:v.projectExcludeMode,tags:v.tags,tagExcludeMode:v.tagExcludeMode,datePresets:v.datePresets,dateFrom:v.dateFrom,dateTo:v.dateTo,dateField:v.dateField||"endDate"});return Oe("filters",t,{totalTasks:A.length,filteredCount:e.length}),e}function Xn(){let t=window.flatpickr;if(typeof t!="function"){let a=(Xn.__retryCount||0)+1;Xn.__retryCount=a,a<=50?setTimeout(Xn,100):console.warn("flatpickr is not available; date pickers disabled");return}let n={dateFormat:"d/m/Y",altInput:!1,allowInput:!0,locale:Xu(),disableMobile:!0};function s(a,i){let l=!1;a.addEventListener("keydown",function(c){!l&&a.value.match(/^\d{2}\/\d{2}\/\d{4}$/)&&c.key.length===1&&/\d/.test(c.key)&&(a.value="",l=!0),c.key==="Backspace"&&a.selectionStart===0&&a.selectionEnd===0&&(a.value="",l=!0,c.preventDefault())}),a.addEventListener("input",function(c){let d=c.target.value,u=d.replace(/\D/g,""),p="";if(u.length>=1){let f=u.substring(0,2);parseInt(f,10)>31&&(f="31"),p=f}if(u.length>=3){let f=u.substring(2,4);parseInt(f,10)>12&&(f="12"),p+="/"+f}if(u.length>=5&&(p+="/"+u.substring(4,8)),d!==p&&(c.target.value=p),p.match(/^\d{2}\/\d{2}\/\d{4}$/)){let[f,h,m]=p.split("/"),y=new Date(+m,+h-1,+f);if(i&&i.config)try{i.__suppressChange=!0,i.setDate(y,!1),setTimeout(()=>i.__suppressChange=!1,0)}catch{}}}),a.addEventListener("keypress",function(c){let d=String.fromCharCode(c.which);!/[\d\/]/.test(d)&&c.which!==8&&c.which!==46&&c.preventDefault()}),a.addEventListener("blur",function(){l=!1}),i&&i.config.onChange.push(()=>l=!1)}function o(a){if(a.__patchedProgrammaticGuards)return;a.__patchedProgrammaticGuards=!0;let i=a.clear.bind(a);a.clear=function(){a.__suppressChange=!0;let c=i();return setTimeout(()=>a.__suppressChange=!1,0),c};let l=a.setDate.bind(a);a.__origSetDate=l,a.setDate=function(c,d,...u){a.__suppressChange=!0;let p=l(c,d,...u);return setTimeout(()=>a.__suppressChange=!1,0),p}}function r(a){if(!a||!a.calendarContainer||a.calendarContainer.querySelector(".flatpickr-today-btn"))return;let i=document.createElement("div");i.className="flatpickr-today-footer";let l=document.createElement("button");l.type="button",l.className="flatpickr-today-btn",l.textContent=g("calendar.today")||"Today",l.addEventListener("click",c=>{c.preventDefault(),c.stopPropagation();let d=new Date;a.jumpToDate(d),a.__suppressChange=!1,typeof a.__origSetDate=="function"?a.__origSetDate(d,!0):a.setDate(d,!0)}),i.appendChild(l),a.calendarContainer.appendChild(i)}document.querySelectorAll('input[type="date"], input.datepicker').forEach(a=>{if(!a._flatpickrInstance)if(a.type==="date"){if(a._wrapped)return;a._wrapped=!0;let i=document.createElement("div");i.className="date-input-wrapper";let l=document.createElement("input");l.type="text",l.className="form-input date-display",l.placeholder=g("common.datePlaceholder"),l.maxLength="10",a.style.display="none",a.type="hidden",a.parentNode.insertBefore(i,a),i.appendChild(a),i.appendChild(l);let c=a.value&&Vt(a.value)?a.value:"";c?l.value=va(c):l.value="";let d=t(l,{...n,defaultDate:c?new Date(c):null,onReady(f,h,m){r(m)},onOpen(f,h,m){!a.value&&!m.selectedDates.length&&m.jumpToDate(new Date)},onChange:function(f){let h=a.value||"",m="";if(f.length>0){let D=f[0];m=`${D.getFullYear()}-${String(D.getMonth()+1).padStart(2,"0")}-${String(D.getDate()).padStart(2,"0")}`}a.value=m;let y=document.getElementById("task-form");if(y&&(a.name==="startDate"||a.name==="endDate")){let D=document.querySelector(".modal.active");if(D){let E=D.querySelector('input[name="startDate"]'),b=D.querySelector('input[name="endDate"]');if(E&&b){let w=(E.value||"").trim(),I=(b.value||"").trim();if(w&&I&&I<w){a.value=h,h?l._flatpickr.setDate(new Date(h),!1):l._flatpickr.clear();let M=l.closest(".date-input-wrapper"),z=M?M.closest(".form-group"):null;if(z){let _=z.querySelector(".date-validation-error");_&&_.remove();let x=document.createElement("div");x.className="date-validation-error",x.style.cssText="color: var(--error); font-size: 12px; margin-top: 6px; padding: 8px 12px; background: var(--bg-error, rgba(239, 68, 68, 0.08)); border-left: 3px solid var(--error); border-radius: 4px;",x.innerHTML="\u26A0\uFE0F "+(a.name==="endDate"?"End Date cannot be before Start Date":"Start Date cannot be after End Date"),M.parentNode.insertBefore(x,M.nextSibling),setTimeout(()=>{x.parentElement&&x.remove()},5e3)}return}else{let M=l.closest(".date-input-wrapper"),z=M?M.closest(".form-group"):null;if(z){let _=z.querySelector(".date-validation-error");_&&_.remove()}}}}}if(a.id==="filter-date-from"){v.dateFrom=m,De(),Be(),document.getElementById("calendar-view")&&ye(),Ye();return}else if(a.id==="filter-date-to"){v.dateTo=m,De(),Be(),document.getElementById("calendar-view")&&ye(),Ye();return}let k=!!(y&&y.dataset.editingTaskId),S=a.name;if(k&&(S==="startDate"||S==="endDate")&&!d.__suppressChange){cn(S,m);return}if(l.classList.contains("editable-date")&&!d.__suppressChange){let D=l.getAttribute("onchange");if(D&&D.includes("updateProjectField")){let E=D.match(/updateProjectField\((\d+),\s*['"](\w+)['"]/);if(E){let b=parseInt(E[1],10),w=E[2];oo(b,w,l.value)}}}}});o(d),s(l,d),a._flatpickrInstance=d;let u=!!l.closest("#task-form"),p=a.name==="startDate"||a.name==="endDate";if(u&&p){let f=document.createElement("button");f.type="button",f.textContent="Clear",f.style.padding="6px 10px",f.style.border="1px solid var(--border)",f.style.background="var(--bg-tertiary)",f.style.color="var(--text-secondary)",f.style.borderRadius="6px",f.style.cursor="pointer",f.style.flex="0 0 auto";let h=l.parentElement;h&&(h.style.display="flex",h.style.gap="8px"),h.appendChild(f),f.addEventListener("click",()=>{l.value="",a.value="",d&&(d.__suppressChange=!0,d.clear(),setTimeout(()=>d.__suppressChange=!1,0));let m=document.getElementById("task-form");m&&m.dataset.editingTaskId&&cn(a.name,"")})}}else{a.maxLength="10";let i=t(a,{...n,defaultDate:null,onReady(l,c,d){r(d)},onChange:function(l,c){if(i.__suppressChange)return;let d=a.dataset.projectId,u=a.dataset.field;d&&u&&oo(parseInt(d,10),u,c)}});o(i),s(a,i),a._flatpickrInstance=i}})}function Xu(){let t=gs(),e=window.flatpickr?.l10ns,n=null;return t==="es"&&e?.es?n=e.es:n=e?.default||e?.en||e?.es||null,n?{...n,firstDayOfWeek:1}:{firstDayOfWeek:1}}function yD(){let t=Xu();document.querySelectorAll("input").forEach(e=>{let n=e._flatpickrInstance;n&&typeof n.set=="function"&&(n.set("locale",t),typeof n.redraw=="function"&&n.redraw())})}var ok=null,Bo=null,Xs=null;function Iu(t,e){let n=0,s=Array.isArray(t)?t:[];for(let o of s){let r=e?e(o):Date.parse(o?.updatedAt||o?.createdAt||o?.createdDate||"")||0;Number.isFinite(r)&&r>n&&(n=r)}return n}function Cu(t){let e=0,n=Array.isArray(t)?t:[];for(let s of n){let o=Number(s?.id);Number.isNaN(o)||(e+=o)}return e}function Au(t){let e=Array.isArray(t?.tasks)?t.tasks:[],n=Array.isArray(t?.projects)?t.projects:[],s=Array.isArray(t?.feedbackItems)?t.feedbackItems:[],o=Iu(e,typeof Ln=="function"?Ln:null),r=Iu(n,i=>Date.parse(i?.updatedAt||i?.createdAt||"")||0),a=Iu(s,i=>Date.parse(i?.updatedAt||i?.createdAt||i?.createdDate||"")||0);return`t:${e.length}:${o}:${Cu(e)}|p:${n.length}:${r}:${Cu(n)}|f:${s.length}:${a}:${Cu(s)}`}function yl(t=A,e=B){let n=!!R.calendarIncludeBacklog,s=v?.projects,o=s&&s.size>0?new Set(Array.from(s).map(u=>parseInt(u,10))):null,r=0,a=0,i=Array.isArray(t)?t:[];for(let u of i){if(!u||!n&&u.status==="backlog"||o&&!o.has(Number(u.projectId)))continue;let p=u.startDate||"",f=u.endDate||"",h=typeof p=="string"&&p.length===10&&p.includes("-"),m=typeof f=="string"&&f.length===10&&f.includes("-");if(!h&&!m)continue;a++;let y=Number(u.id)||0,k=u.status?String(u.status):"",S=Number(u.projectId)||0,T=u.title?String(u.title):"",D=Date.parse(u.updatedAt||u.createdAt||u.createdDate||"")||0;r=r*31+y+S+D|0;for(let E=0;E<p.length;E++)r=r*31+p.charCodeAt(E)|0;for(let E=0;E<f.length;E++)r=r*31+f.charCodeAt(E)|0;for(let E=0;E<k.length;E++)r=r*31+k.charCodeAt(E)|0;for(let E=0;E<T.length;E++)r=r*31+T.charCodeAt(E)|0}let l=Array.isArray(e)?e:[],c=0,d=0;for(let u of l){if(!u||o&&!o.has(Number(u.id)))continue;d++;let p=Number(u.id)||0,f=u.name?String(u.name):"",h=u.startDate?String(u.startDate):"",m=u.endDate?String(u.endDate):"",y=Date.parse(u.updatedAt||u.createdAt||"")||0;c=c*31+p+y|0;for(let k=0;k<f.length;k++)c=c*31+f.charCodeAt(k)|0;for(let k=0;k<h.length;k++)c=c*31+h.charCodeAt(k)|0;for(let k=0;k<m.length;k++)c=c*31+m.charCodeAt(k)|0}return`m:${Ue}-${qe+1}|b:${n?1:0}|pf:${o?o.size:0}|c:${a}|h:${r}|pc:${d}|ph:${c}`}function kD(t=500){Xs!==null&&clearTimeout(Xs),Xs=setTimeout(()=>{Xs=null,ye(),Bo=yl()},t)}function ta(){let t=document.querySelector(".page.active");return t?t.id:null}function bD(){let t=window.location.hash.slice(1);if(!t)return;let e=["dashboard","projects","tasks","updates","feedback","calendar"],n="dashboard";if(t==="dashboard/recent_activity")n="dashboard";else if(t.startsWith("project-"))n="projects";else if(e.includes(t))n=t==="calendar"?"tasks":t;else return;document.querySelectorAll(".page").forEach(s=>s.classList.remove("active")),document.getElementById(n)?.classList.add("active"),document.getElementById("project-details")?.classList.remove("active"),document.querySelectorAll(".nav-item").forEach(s=>s.classList.remove("active")),t==="calendar"?document.querySelector(".nav-item.calendar-nav")?.classList.add("active"):document.querySelector(`.nav-item[data-page="${n}"]`)?.classList.add("active")}function kl(t={}){let e=!!t.calendarChanged,n=!!t.calendarImmediate;Ct(),TD();let s=ta();if(s==="dashboard"){qk();return}if(s==="projects"){Mt();return}if(s==="tasks"){try{ws()}catch{}let r=document.querySelector(".kanban-board");r&&!r.classList.contains("hidden")&&ft(),($e()||document.getElementById("list-view")?.classList.contains("active"))&&on(),document.getElementById("calendar-view")?.classList.contains("active")&&(e||n?n?(Xs!==null&&(clearTimeout(Xs),Xs=null),ye(),Bo=yl()):(Ft("calendar-refresh-debounced",{reason:"data-changed"}),kD(500)):Ft("calendar-refresh-skipped",{reason:"fingerprint-match"}));return}if(s==="updates"){Zu();return}s==="feedback"&&xs();let o=document.getElementById("project-details");if(o&&o.classList.contains("active")){let r=window.location.hash.slice(1);if(r.startsWith("project-")){let a=parseInt(r.replace("project-",""),10);Number.isNaN(a)||Qe(a)}}}var Mu=!1;async function vD(t={}){if(Mu)return;Mu=!0;let e=!!t.skipCache;Ft("init-start",{hasAuth:!!localStorage.getItem("authToken"),hasAdmin:!!localStorage.getItem("adminToken")});let n=Fe("init","init",{hasAuth:!!localStorage.getItem("authToken"),hasAdmin:!!localStorage.getItem("adminToken")});if(!localStorage.getItem("authToken")&&!localStorage.getItem("adminToken")){console.log("Waiting for authentication before initializing app..."),Mu=!1;return}typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(10),B=[],A=[],Ve=[],Ot=1,St=1,Qr=!0,typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(20),bD(),Vr("first_skeleton_paint",{reason:"route-shell"});let o=Ep({preferCache:!e,onRefresh:e?null:k=>{if(!k)return;let S=Au(k),T=Au({tasks:A,projects:B,feedbackItems:Ve});if(S===T)return;tk(k);let D=yl(k.tasks||A,k.projects||B),E=Bo&&D!==Bo;ok=S,Bo=D,kl({calendarChanged:E})},feedback:{limitPending:xn,limitDone:xn,cacheKey:wk,preferCache:!e}}),r=Ip().catch(()=>null),a=Cp().catch(()=>({})),i=Mp().catch(()=>({})),l=window.historyService?.loadHistory?window.historyService.loadHistory().catch(()=>null):Promise.resolve(null),c=Fe("init","load-data"),d=await o;typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(50),tk(d),kl();let[u,p,f]=await Promise.all([r,a,i,l]);if(Oe("init",c,{taskCount:d?.tasks?.length||0,projectCount:d?.projects?.length||0,feedbackCount:d?.feedbackItems?.length||0}),Ft("init-data-loaded",{taskCount:d?.tasks?.length||0,projectCount:d?.projects?.length||0,feedbackCount:d?.feedbackItems?.length||0}),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(60),u&&typeof u=="object"){let k=u.sortMode,S=u.manualTaskOrder;k&&(wt=k),S&&(Me=S)}else try{let k=localStorage.getItem("sortMode"),S=localStorage.getItem("manualTaskOrder");k&&(wt=k),S&&(Me=JSON.parse(S))}catch{}(wt==="auto"||wt!=="priority"&&wt!=="manual")&&(wt="priority"),Jn(),Dn=p&&typeof p=="object"?p:{},f&&typeof f=="object"&&(R={...R,...f}),R.language=Ku(R.language),nr(R.debugLogsEnabled),vk&&(R.debugLogsEnabled=!0,nr(!0)),Ok(),typeof R.enableReviewStatus<"u"&&(window.enableReviewStatus=R.enableReviewStatus,localStorage.setItem("enableReviewStatus",String(R.enableReviewStatus))),pp(),fC(),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(75),ED(),gI(),kI(),vI(),mb(),QT(),GI(),Xn(),hD(),eC(),bk(),Ft("init-ui-ready"),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(90),Qr=!1,v.search="",v.statuses.clear(),v.priorities.clear(),v.projects.clear(),v.tags.clear(),v.datePresets.clear(),v.dateFrom="",v.dateTo="",K.search="",K.statuses.clear(),K.taskFilter="",K.updatedFilter="all";try{localStorage.removeItem("projectsViewState")}catch{}try{localStorage.removeItem("kanbanUpdatedFilter")}catch{}window.kanbanUpdatedFilter="all";let h=window.location.hash.slice(1),m=["dashboard","projects","tasks","updates","feedback","calendar"];if(document.querySelectorAll(".nav-item").forEach(k=>k.classList.remove("active")),h==="calendar")oa();else if(h==="dashboard/recent_activity")document.querySelector('.nav-item[data-page="dashboard"]')?.classList.add("active"),Ze("dashboard/recent_activity");else if(h.startsWith("project-")){let k=parseInt(h.replace("project-",""));document.querySelector('.nav-item[data-page="projects"]')?.classList.add("active"),Qe(k)}else{let k=m.includes(h)?h==="calendar"?"tasks":h:"dashboard",S=document.querySelector(`.nav-item[data-page="${k}"]`);if(h==="calendar"?document.querySelector(".nav-item.calendar-nav")?.classList.add("active"):S&&S.classList.add("active"),document.querySelectorAll(".page").forEach(T=>T.classList.remove("active")),document.getElementById(k).classList.add("active"),h==="calendar"){document.querySelector(".kanban-board")?.classList.add("hidden"),document.getElementById("list-view")?.classList.remove("active"),document.getElementById("calendar-view")?.classList.add("active");let T=document.querySelector(".view-toggle");T&&T.classList.add("hidden");let D=document.getElementById("global-filters");D&&(D.style.display="none"),ye()}}typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(100),Ko||(qT(),WT()),Ft("init-notifications-ready"),Oe("init",n,{taskCount:A.length,projectCount:B.length,feedbackCount:Ve.length,pendingSaves:Yn}),Ft("init-complete",{taskCount:A.length,projectCount:B.length,feedbackCount:Ve.length}),Vr("interactive_ready",{taskCount:A.length,projectCount:B.length});function y(){let k=window.location.hash.slice(1),[S,T]=k.split("?"),D=new URLSearchParams(T||"");if(!(S==="login"||S==="admin-login"||S==="setup"))if(document.querySelectorAll(".nav-item").forEach(E=>E.classList.remove("active")),S==="dashboard/recent_activity")st="projects",document.querySelector('.nav-item[data-page="dashboard"]')?.classList.add("active"),Ze("dashboard/recent_activity"),en=S;else if(S.startsWith("project-")){let E=parseInt(S.replace("project-",""));document.querySelector('.nav-item[data-page="projects"]')?.classList.add("active"),Qe(E),en=S}else if(S==="calendar")st="projects",document.querySelector(".nav-item.calendar-nav")?.classList.add("active"),oa(),en=S;else if(S==="tasks"){if(st="projects",document.querySelector('.nav-item[data-page="tasks"]')?.classList.add("active"),D.has("search")?v.search=(D.get("search")||"").trim().toLowerCase():v.search="",D.has("status")){let E=D.get("status").split(",").filter(Boolean);v.statuses.clear(),E.forEach(b=>v.statuses.add(b.trim())),v.statusExcludeMode=D.get("statusExclude")==="1"}else v.statuses.clear(),v.statusExcludeMode=!1;if(D.has("priority")){let E=D.get("priority").split(",").filter(Boolean);v.priorities.clear(),E.forEach(b=>v.priorities.add(b.trim())),v.priorityExcludeMode=D.get("priorityExclude")==="1"}else v.priorities.clear(),v.priorityExcludeMode=!1;if(D.has("project")){let E=D.get("project").split(",").filter(Boolean);v.projects.clear(),E.forEach(b=>v.projects.add(b.trim())),v.projectExcludeMode=D.get("projectExclude")==="1"}else v.projects.clear(),v.projectExcludeMode=!1;if(D.has("tags")){let E=D.get("tags").split(",").filter(Boolean);v.tags.clear(),E.forEach(b=>v.tags.add(b.trim())),v.tagExcludeMode=D.get("tagExclude")==="1"}else v.tags.clear(),v.tagExcludeMode=!1;if(D.has("datePreset")){let b=(D.get("datePreset")||"").split(",").filter(Boolean);v.datePresets.clear(),b.forEach(w=>v.datePresets.add(w.trim())),v.dateFrom="",v.dateTo="",v.dateField="endDate"}else if(D.has("dateFrom")||D.has("dateTo")){let E=D.get("dateFrom")||"",b=D.get("dateTo")||"";v.dateFrom=E,v.dateTo=b,v.dateField=D.get("dateField")||"endDate",v.datePresets.clear()}else v.datePresets.clear(),v.dateFrom="",v.dateTo="",v.dateField="endDate";if(D.has("updated")){let E=D.get("updated");if(new Set(["all","5m","30m","24h","week","month"]).has(E))try{ia(E,{render:!1})}catch(w){console.error("Failed to set kanbanUpdatedFilter from URL:",w)}}if(D.has("view")){let E=D.get("view");(E==="list"||E==="kanban"||E==="calendar")&&setTimeout(()=>{let b=document.querySelectorAll(".view-btn"),w=Array.from(b).find(I=>I.dataset.view===E);w&&!w.classList.contains("active")&&w.click()},100)}Ze("tasks"),setTimeout(()=>{let E=document.getElementById("filter-search");E&&(E.value=v.search),document.querySelectorAll('input[data-filter="status"]').forEach(I=>{I.checked=v.statuses.has(I.value)}),document.querySelectorAll('input[data-filter="priority"]').forEach(I=>{I.checked=v.priorities.has(I.value)}),document.querySelectorAll('input[data-filter="project"]').forEach(I=>{I.checked=v.projects.has(I.value)}),document.querySelectorAll('input[data-filter="tag"]').forEach(I=>{I.checked=v.tags.has(I.value)}),document.querySelectorAll('input[data-filter="date-preset"]').forEach(I=>{I.checked=v.datePresets.has(I.value)});let b=document.getElementById("filter-date-from"),w=document.getElementById("filter-date-to");if(b&&v.dateFrom){b.value=v.dateFrom;let I=b.closest(".date-input-wrapper")?.querySelector(".date-display");I&&(I.value=xe(v.dateFrom))}if(w&&v.dateTo){w.value=v.dateTo;let I=w.closest(".date-input-wrapper")?.querySelector(".date-display");I&&(I.value=xe(v.dateTo))}Fk(),De(),ha(),Ye()},100),en=S}else if(S==="projects"){st="projects",document.querySelector('.nav-item[data-page="projects"]')?.classList.add("active");let E={};if(D.has("search")&&(E.search=D.get("search")),D.has("status")){let b=D.get("status").split(",").filter(Boolean),w=["backlog","planning","active","completed"];E.statuses=b.filter(I=>w.includes(I.trim()))}if(D.has("filter")){let b=D.get("filter");["has-tasks","no-tasks"].includes(b)&&(E.filter=b)}if(D.has("sort")){let b=D.get("sort");["default","name","created-desc","updated-desc","tasks-desc","completion-desc"].includes(b)&&(E.sort=b)}if(D.has("sortDirection")){let b=D.get("sortDirection");(b==="asc"||b==="desc")&&(E.sortDirection=b)}if(D.has("updatedFilter")){let b=D.get("updatedFilter");["all","5m","30m","24h","week","month"].includes(b)&&(E.updatedFilter=b)}window.urlProjectFilters=E,Ze("projects"),en=S}else S==="updates"?(st="projects",document.querySelector('.nav-item[data-page="updates"]')?.classList.add("active"),Ze("updates"),en=S):S==="feedback"?(st="projects",document.querySelector('.nav-item[data-page="feedback"]')?.classList.add("active"),Ze("feedback"),en=S):(S===""||S==="dashboard")&&(st="projects",document.querySelector('.nav-item[data-page="dashboard"]')?.classList.add("active"),Ze("dashboard"),en=S||"dashboard")}y(),Vr("first_contentful_page_ready",{page:document.querySelector(".page.active")?.id||"unknown"}),ok=Au({tasks:A,projects:B,feedbackItems:Ve}),Bo=yl(A,B),Vr("init-render-complete"),await new Promise(requestAnimationFrame),await new Promise(requestAnimationFrame),Vr("init-first-paint"),window.addEventListener("hashchange",y),document.querySelectorAll(".view-btn").forEach(k=>{k.addEventListener("click",S=>{document.querySelectorAll(".view-btn").forEach(b=>b.classList.remove("active"));let T=S.currentTarget;T.classList.add("active");let D=(T.dataset.view||"").toLowerCase();try{let b=document.getElementById("backlog-quick-btn");b&&(b.style.display=D==="kanban"?"inline-flex":"none")}catch{}document.querySelector(".kanban-board").classList.add("hidden"),document.getElementById("list-view").classList.remove("active"),document.getElementById("calendar-view").classList.remove("active");let E=document.querySelector("#tasks .page-title");if(E&&(E.textContent=g("tasks.title")),D==="list"){let b=document.getElementById("global-filters");b&&(b.style.display=""),document.getElementById("list-view").classList.add("active"),on(),Jn();try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}let w=document.getElementById("kanban-settings-btn")?.parentElement;w&&(w.style.display="none"),Xr();try{ws()}catch{}}else if(D==="kanban"){let b=document.getElementById("backlog-quick-btn");b&&(b.style.display="inline-flex");let w=document.getElementById("global-filters");w&&(w.style.display=""),document.querySelector(".kanban-board").classList.remove("hidden"),ft(),Jn();try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}let I=document.getElementById("kanban-settings-btn")?.parentElement;I&&(I.style.display=""),Xr();try{ws()}catch{}}else if(D==="calendar"){let b=document.getElementById("calendar-view");if(!b)return;let w=document.getElementById("backlog-quick-btn");w&&(w.style.display="none");let I=document.getElementById("kanban-settings-btn")?.parentElement;I&&(I.style.display="none"),b.classList.add("preparing"),ye(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{na(),b.classList.remove("preparing"),b.classList.add("active"),Jn(),Xr();try{ws()}catch{}})})}})});try{let k=document.getElementById("backlog-quick-btn"),S=document.querySelector(".kanban-header .view-toggle");if(!k&&S&&S.parentElement){let T=document.createElement("button");T.type="button",T.id="backlog-quick-btn",T.className="backlog-quick-btn",T.title=g("tasks.backlogQuickTitle"),T.textContent=g("tasks.backlogQuickLabel"),T.addEventListener("click",E=>{E.preventDefault(),window.location.hash="#tasks?view=list&status=backlog"}),S.insertAdjacentElement("afterend",T);let D=(document.querySelector(".view-btn.active")?.dataset.view||"").trim().toLowerCase();T.style.display=D==="kanban"?"inline-flex":"none"}}catch{}wD()}function wD(){let t=document.querySelectorAll(".filter-chip");t.forEach(r=>{r.addEventListener("click",function(){t.forEach(i=>i.classList.remove("active")),this.classList.add("active");let a=this.dataset.period;Hk(a)})}),document.querySelectorAll(".enhanced-stat-card").forEach(r=>{r.addEventListener("mouseenter",function(){this.style.transform="translateY(-4px) scale(1.02)"}),r.addEventListener("mouseleave",function(){this.style.transform="translateY(0) scale(1)"}),r.addEventListener("click",function(){let a=this.dataset.filter,i=this.dataset.value;a&&i&&zk(a,i)})}),document.querySelectorAll(".quick-action").forEach(r=>{r.addEventListener("click",function(){this.style.transform="scale(0.95)",setTimeout(()=>{this.style.transform="scale(1)"},150)})});let s=document.getElementById("tasks-completion-ring");s&&s.addEventListener("click",function(){window.location.hash="tasks",document.querySelectorAll(".nav-item").forEach(a=>a.classList.remove("active"));let r=document.querySelector('.nav-item[data-page="tasks"]');r&&r.classList.add("active"),Ze("tasks")});let o=document.getElementById("projects-completion-ring");o&&o.addEventListener("click",function(){window.location.hash="projects",document.querySelectorAll(".nav-item").forEach(a=>a.classList.remove("active"));let r=document.querySelector('.nav-item[data-page="projects"]');r&&r.classList.add("active"),Ze("projects")})}function zk(t,e){window.location.hash="tasks",document.querySelectorAll(".nav-item").forEach(l=>l.classList.remove("active"));let n=document.querySelector('.nav-item[data-page="tasks"]');n&&n.classList.add("active"),Ze("tasks");let s=document.querySelector(".view-toggle");s&&s.classList.remove("hidden"),document.querySelectorAll(".view-btn").forEach(l=>l.classList.remove("active"));let o=document.querySelector(".view-btn:first-child");o&&o.classList.add("active");let r=document.querySelector(".kanban-board"),a=document.getElementById("list-view"),i=document.getElementById("calendar-view");r&&r.classList.remove("hidden"),i&&i.classList.remove("active"),a&&a.classList.remove("active");try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}EC(),setTimeout(()=>{SD(t,e),ft()},100)}function SD(t,e){if(t==="status")v.statuses.clear(),v.statuses.add(e),v.statusExcludeMode=!1,v.priorityExcludeMode=!1,v.projectExcludeMode=!1,v.tagExcludeMode=!1,document.querySelectorAll('input[data-filter="status"]').forEach(s=>{s.checked=s.value===e});else if(t==="priority")v.priorities.clear(),v.priorities.add(e),v.priorityExcludeMode=!1,v.projectExcludeMode=!1,v.tagExcludeMode=!1,v.statuses.clear(),v.statuses.add("todo"),v.statuses.add("progress"),v.statuses.add("review"),v.statusExcludeMode=!1,document.querySelectorAll('input[data-filter="priority"]').forEach(o=>{o.checked=o.value===e}),document.querySelectorAll('input[data-filter="status"]').forEach(o=>{o.checked=["todo","progress","review"].includes(o.value)});else if(t==="overdue"){let n=new Date().toISOString().split("T")[0];v.dateTo=n;let s=document.getElementById("filter-date-to");s&&(s.value=n),v.statuses.clear(),v.statuses.add("todo"),v.statuses.add("progress"),v.statuses.add("review"),v.statusExcludeMode=!1,v.priorityExcludeMode=!1,v.projectExcludeMode=!1,v.tagExcludeMode=!1,document.querySelectorAll('input[data-filter="status"]').forEach(r=>{r.checked=["todo","progress","review"].includes(r.value)})}De(),Be()}function Hk(t){let n={week:g("dashboard.trend.thisWeek"),month:g("dashboard.trend.thisMonth"),quarter:g("dashboard.trend.thisQuarter")}[t]||g("dashboard.trend.thisWeek"),s=document.getElementById("progress-change"),o=document.getElementById("completed-change");s&&(s.textContent=`+${Math.max(1,Math.floor(A.length*.1))} ${n}`),o&&(o.textContent=`+${A.filter(r=>r.status==="done").length} ${n}`)}function ED(){document.querySelectorAll(".nav-item").forEach(t=>{t.addEventListener("click",()=>{let e=t.dataset.page;if(e){if(e==="calendar"){oa(),document.querySelectorAll(".nav-item").forEach(s=>s.classList.remove("active")),t.classList.add("active");return}if(e==="tasks"&&(document.getElementById("calendar-view")?.classList.remove("active"),document.getElementById("list-view")?.classList.remove("active")),window.location.hash=e,e==="tasks"){let s=window.location.hash.slice(1),[o,r]=s.split("?"),a=new URLSearchParams(r||"");if(o==="tasks"&&a.toString()===""){v.search="",v.statuses.clear(),v.priorities.clear(),v.projects.clear(),v.tags.clear(),v.datePresets.clear(),v.dateFrom="",v.dateTo="";try{ia("all",{render:!1})}catch{}let i=document.getElementById("filter-search");i&&(i.value=""),document.querySelectorAll('#global-filters input[type="checkbox"]').forEach(l=>l.checked=!1)}}document.querySelectorAll(".nav-item").forEach(s=>s.classList.remove("active")),t.classList.add("active"),Ze(e);let n=document.querySelector(".view-toggle");n&&(e==="tasks"?n.classList.remove("hidden"):n.classList.add("hidden"))}})})}function Ze(t){if(t.includes("/")){let[r,a]=t.split("/");if(r==="dashboard"&&a==="recent_activity"){MD();return}}$e()&&window.scrollTo({top:0,behavior:"smooth"}),document.querySelectorAll(".page").forEach(r=>r.classList.remove("active")),document.getElementById("project-details").classList.remove("active");let e=document.getElementById("activity-page");e&&(e.style.display="none");let n=document.querySelector(".dashboard-grid");n&&(n.style.display="grid");let s=document.querySelector(".insights-card");s&&(s.style.display="");let o=document.querySelector(".user-menu");if(o&&(o.style.display=""),document.getElementById(t).classList.add("active"),t==="dashboard")Ct(),ak?ak=!1:qk();else if(t==="projects"){Ct();try{ya(),IC()}catch{}}else if(t==="tasks"){Ct();let r=window.location.hash.slice(1),[,a]=r.split("?");if(!new URLSearchParams(a||"").has("view")){document.querySelectorAll(".view-btn").forEach(p=>p.classList.remove("active")),document.querySelector(".view-btn:nth-child(1)").classList.add("active"),document.querySelector(".kanban-board").classList.remove("hidden"),document.getElementById("list-view").classList.remove("active"),document.getElementById("calendar-view").classList.remove("active");let c=document.querySelector("#tasks .page-title");c&&(c.textContent=g("tasks.title"));try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}let d=document.getElementById("kanban-settings-btn")?.parentElement;d&&(d.style.display="");let u=document.getElementById("backlog-quick-btn");u&&(u.style.display="inline-flex")}ft(),on()}else t==="updates"?(Ct(),Zu(),ZT()):t==="feedback"&&xs()}var Lu=0,ju=!1,rk=!1;function xD(){Lu+=1,Lu>1&&!rk&&pn()&&(rk=!0,console.warn("[perf] render called multiple times in the same tick",new Error().stack)),ju||(ju=!0,queueMicrotask(()=>{Lu=0,ju=!1}))}function so(){xD(),kl()}function TD(){let t=jT;document.querySelectorAll(".app-version").forEach(e=>e.textContent=t),document.querySelectorAll(".mobile-version").forEach(e=>e.textContent=t)}function DD(t){let e=(t||[]).map(n=>Wr(n)).filter(Boolean);return e.length?`
        <ul class="release-list">
            ${e.map(n=>`<li><span class="release-point-icon" aria-hidden="true"></span><span>${V(n)}</span></li>`).join("")}
        </ul>
    `:`<div class="release-section-empty">${g("updates.sectionEmpty")}</div>`}function Zu(){let t=document.getElementById("updates-content");if(!t)return;let e=xk();if(e.length===0){t.innerHTML=`<div class="updates-empty">${g("updates.empty")}</div>`;return}let n=e[0],s=e.slice(1),o=[n.version,Wr(n.title)].filter(Boolean).join(" - "),r=g("notifications.releaseMeta",{date:Qy(n.date)}),a=n.summary?V(Wr(n.summary)):"",i=n.sections||{},c=[{key:"new",label:g("updates.sections.new")},{key:"improvements",label:g("updates.sections.improvements")},{key:"fixes",label:g("updates.sections.fixes")}].map(u=>{let p=i[u.key]||[];return`
            <div class="release-section-card release-section-card--${u.key}">
                <div class="release-section-card-header">
                    <span class="release-section-icon" data-kind="${u.key}" aria-hidden="true"></span>
                    <div>
                        <div class="release-section-title">${u.label}</div>
                    </div>
                </div>
                ${DD(p)}
            </div>
        `}).join(""),d=s.length?s.map(u=>{let p=[u.version,Wr(u.title)].filter(Boolean).join(" - "),f=Qy(u.date),h=u.summary?V(Wr(u.summary)):"";return`
                <div class="release-history-item">
                    <div class="release-history-title">${V(p)}</div>
                    <div class="release-history-meta">${f}</div>
                    ${h?`<div class="release-history-summary">${h}</div>`:""}
                </div>
            `}).join(""):`<div class="release-history-empty">${g("updates.historyEmpty")}</div>`;t.innerHTML=`
        <div class="release-notes-stack">
            <article class="release-hero" data-release-id="${n.id}" aria-label="${g("updates.latestLabel")}">
                <div class="release-hero-top">
                    <span class="release-badge">${g("updates.latestLabel")}</span>
                    <span class="release-hero-meta">${r}</span>
                </div>
                <div class="release-hero-title">${V(o)}</div>
                ${a?`<p class="release-hero-summary">${a}</p>`:""}
            </article>
            <div class="release-section-stack">
                ${c}
            </div>
            <section class="release-history-block" aria-label="${g("updates.historyLabel")}">
                <div class="release-history-header">
                    <div>
                        <div class="release-history-label">${g("updates.historyLabel")}</div>
                        <div class="release-history-subtitle">${g("updates.subtitle")}</div>
                    </div>
                </div>
                <div class="release-history-list">
                    ${d}
                </div>
            </section>
        </div>
    `}var ak=!1,ik=!1;function qk(){if(ik)return;ik=!0;let t=Fe("render","dashboard",{taskCount:A.length,projectCount:B.length});ID(),_k(),Qu(),Wk(),jD();let e=document.getElementById("projects-stat-card");e&&(e.onclick=()=>{window.location.hash="projects"}),Oe("render",t,{taskCount:A.length,projectCount:B.length})}function ID(){let t=Fe("render","dashboard-stats",{taskCount:A.length,projectCount:B.length}),e=Xp(A,B);document.getElementById("hero-active-projects").textContent=e.activeProjects;let n=document.querySelector(".tasks-progress-circle");if(n){let l=2*Math.PI*45,c=l-e.tasksCompletionRate/100*l;n.style.strokeDashoffset=c}let s=document.getElementById("tasks-ring-percentage");s&&(s.textContent=`${e.tasksCompletionRate}%`);let o=document.getElementById("tasks-completion-count");if(o){let l=o.querySelector(".count-numerator"),c=o.querySelector(".count-denominator");l&&(l.textContent=e.completedTasks),c&&(c.textContent=e.totalTasks)}let r=document.querySelector(".projects-progress-circle");if(r){let l=2*Math.PI*45,c=l-e.projectsCompletionRate/100*l;r.style.strokeDashoffset=c}let a=document.getElementById("projects-ring-percentage");a&&(a.textContent=`${e.projectsCompletionRate}%`);let i=document.getElementById("projects-completion-count");if(i){let l=i.querySelector(".count-numerator"),c=i.querySelector(".count-denominator");l&&(l.textContent=e.completedProjects),c&&(c.textContent=e.totalProjectsWithTasks)}document.getElementById("in-progress-tasks").textContent=e.inProgressTasks,document.getElementById("pending-tasks-new").textContent=e.pendingTasks,document.getElementById("completed-tasks-new").textContent=e.completedTasks,document.getElementById("overdue-tasks").textContent=e.overdueTasks,document.getElementById("high-priority-tasks").textContent=e.highPriorityTasks,document.getElementById("research-milestones").textContent=e.milestones,Uk(),Oe("render",t,{activeProjects:e.activeProjects,totalTasks:e.totalTasks,tasksCompletionRate:e.tasksCompletionRate,projectsCompletionRate:e.projectsCompletionRate})}function Uk(){let t=Zp(A,B);document.getElementById("progress-change").textContent=`+${t.progressChange} ${g("dashboard.trend.thisWeek")}`,document.getElementById("pending-change").textContent=t.dueTodayCount>0?g(t.dueTodayCount===1?"dashboard.trend.dueTodayOne":"dashboard.trend.dueTodayMany",{count:t.dueTodayCount}):g("dashboard.trend.onTrack"),document.getElementById("completed-change").textContent=`+${t.thisWeekCompleted} ${g("dashboard.trend.thisWeek")}`;let e=document.getElementById("overdue-change");e&&(e.textContent=t.overdueCount>0?g("dashboard.trend.needsAttention"):g("dashboard.trend.allOnTrack"),e.classList.toggle("negative",t.overdueCount>0),e.classList.toggle("positive",t.overdueCount===0),e.classList.remove("neutral")),document.getElementById("priority-change").textContent=t.criticalHighPriority>0?g(t.criticalHighPriority===1?"dashboard.trend.criticalOne":"dashboard.trend.criticalMany",{count:t.criticalHighPriority}):g("dashboard.trend.onTrack"),document.getElementById("milestones-change").textContent=t.completedProjects>0?g(t.completedProjects===1?"dashboard.trend.completedOne":"dashboard.trend.completedMany",{count:t.completedProjects}):g("dashboard.trend.inProgress")}function _k(){let t=document.getElementById("project-progress-bars");if(!t)return;let e=B.filter(s=>An(s.id)==="active");if(e.length===0){t.innerHTML=`
            <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                <div style="font-size: 48px; margin-bottom: 16px;">\u{1F30A}</div>
                <div style="font-size: 16px; margin-bottom: 8px;">${g("dashboard.emptyProjects.title")}</div>
                <div style="font-size: 14px;">${g("dashboard.emptyProjects.subtitle")}</div>
            </div>
        `;return}let n=Qp(e,A,5);t.innerHTML=ef(n,{tasksLabel:g("dashboard.tasks")})}function Qu(){let t=document.getElementById("activity-feed");if(!t)return;let e=[];if(A.filter(r=>r.status==="done").sort((r,a)=>new Date(a.completedDate||a.createdAt||a.createdDate)-new Date(r.completedDate||r.createdAt||r.createdDate)).slice(0,3).forEach(r=>{let a=B.find(c=>c.id===r.projectId),i=r.completedDate||r.createdAt||r.createdDate,l=a?g("dashboard.activity.inProject",{project:a.name}):"";e.push({type:"completed",text:g("dashboard.activity.completed",{title:r.title,projectPart:l}).trim(),timeText:Pu(i),date:i,icon:"\u2705"})}),B.sort((r,a)=>new Date(a.createdAt||a.createdDate)-new Date(r.createdAt||r.createdDate)).slice(0,2).forEach(r=>{let a=r.createdAt||r.createdDate;e.push({type:"created",text:g("dashboard.activity.createdProject",{project:r.name}),timeText:Pu(a),date:a,icon:"\u{1F680}"})}),A.filter(r=>r.status!=="done").sort((r,a)=>new Date(a.createdAt||a.createdDate)-new Date(r.createdAt||r.createdDate)).slice(0,2).forEach(r=>{let a=r.createdAt||r.createdDate,i=B.find(c=>c.id===r.projectId),l=i?g("dashboard.activity.toProject",{project:i.name}):"";e.push({type:"created",text:g("dashboard.activity.addedTask",{title:r.title,projectPart:l}).trim(),timeText:Pu(a),date:a,icon:"\u{1F4DD}"})}),e.sort((r,a)=>new Date(a.date)-new Date(r.date)),e.length===0){t.innerHTML=`
            <div class="activity-item">
                <div class="activity-icon completed">\u{1F30A}</div>
                <div class="activity-content">
                    <div class="activity-text">${g("dashboard.activity.emptyTitle")}</div>
                    <div class="activity-time">${g("dashboard.activity.emptySubtitle")}</div>
                </div>
            </div>
        `;return}t.innerHTML=tf(e.slice(0,4),PD)}function CD(){window.location.hash="dashboard/recent_activity"}function AD(){window.location.hash="dashboard"}function MD(){document.querySelectorAll(".page").forEach(e=>{e.classList.remove("active")});let t=document.getElementById("activity-page");if(!t){t=document.createElement("div"),t.id="activity-page",t.className="page",t.innerHTML=`
            <div class="page-header">
                <div>
                    <h1 class="page-title" data-i18n="dashboard.activity.allTitle">${g("dashboard.activity.allTitle")}</h1>
                    <p class="page-subtitle" data-i18n="dashboard.activity.allSubtitle">${g("dashboard.activity.allSubtitle")}</p>
                </div>
                <button class="view-all-btn back-btn" data-action="backToDashboard" data-i18n="dashboard.activity.backToDashboard">${g("dashboard.activity.backToDashboard")}</button>
            </div>
            <div class="page-content">
                <div id="all-activity-list" class="all-activity-list"></div>
            </div>
        `;let e=document.querySelector(".main-content");e&&e.appendChild(t)}t.classList.add("active"),t.style.display="flex",Vk();try{t.scrollIntoView({behavior:"auto",block:"start"})}catch{window.scrollTo(0,0)}document.querySelectorAll(".nav-item").forEach(e=>e.classList.remove("active")),document.querySelector('.nav-item[data-page="dashboard"]').classList.add("active")}function Vk(){let t=[];A.filter(o=>o.status==="done").sort((o,r)=>new Date(r.completedDate||r.createdAt||r.createdDate)-new Date(o.completedDate||o.createdAt||o.createdDate)).forEach(o=>{let r=B.find(l=>l.id===o.projectId),a=o.completedDate||o.createdAt||o.createdDate,i=r?g("dashboard.activity.inProject",{project:r.name}):"";t.push({type:"completed",text:g("dashboard.activity.completed",{title:o.title,projectPart:i}).trim(),date:a,icon:"\u2705"})}),B.sort((o,r)=>new Date(r.createdAt||r.createdDate)-new Date(o.createdAt||o.createdDate)).forEach(o=>{t.push({type:"created",text:g("dashboard.activity.createdProject",{project:o.name}),date:o.createdAt||o.createdDate,icon:"\u{1F680}"})}),A.sort((o,r)=>new Date(r.createdAt||r.createdDate)-new Date(o.createdAt||o.createdDate)).forEach(o=>{let r=B.find(i=>i.id===o.projectId),a=r?g("dashboard.activity.toProject",{project:r.name}):"";t.push({type:"created",text:g("dashboard.activity.addedTask",{title:o.title,projectPart:a}).trim(),date:o.createdAt||o.createdDate,icon:"\u{1F4DD}"})}),t.sort((o,r)=>new Date(r.date)-new Date(o.date));let n=document.getElementById("all-activity-list");if(!n)return;let s=t.map(o=>`
        <div class="activity-item-full">
            <div class="activity-icon ${o.type}">${o.icon}</div>
            <div class="activity-content">
                <div class="activity-text">${o.text}</div>
            </div>
            <div class="activity-full-date">${new Date(o.date).toLocaleDateString(Qn(),{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}</div>
        </div>
    `).join("");n.innerHTML=s}function Wk(){let t=document.getElementById("insights-list");if(!t)return;let n=LD().map(s=>`
        <div class="insight-item ${s.type}">
            <div class="insight-icon">${s.icon}</div>
            <div class="insight-content">
                <div class="insight-title">${s.title}</div>
                <div class="insight-desc">${s.description}</div>
            </div>
        </div>
    `).join("");t.innerHTML=n}function LD(){let t=[],e=A.length,n=A.filter(i=>i.status==="done").length,s=new Date().toISOString().split("T")[0],o=A.filter(i=>i.endDate&&i.endDate<s&&i.status!=="done").length,r=A.filter(i=>i.priority==="high").length,a=A.filter(i=>{if(!i.endDate)return!1;let l=new Date().toDateString();return new Date(i.endDate).toDateString()===l&&i.status!=="done"}).length;if(e>0){let i=n/e*100;i>=80?t.push({type:"success",icon:"\u{1F3AF}",title:g("dashboard.insights.excellentTitle"),description:g("dashboard.insights.excellentDesc",{percent:i.toFixed(0)})}):i>=60?t.push({type:"success",icon:"\u{1F4C8}",title:g("dashboard.insights.goodTitle"),description:g("dashboard.insights.goodDesc",{percent:i.toFixed(0)})}):i>=30?t.push({type:"warning",icon:"\u26A1",title:g("dashboard.insights.opportunityTitle"),description:g("dashboard.insights.opportunityDesc",{percent:i.toFixed(0)})}):t.push({type:"priority",icon:"\u{1F6A8}",title:g("dashboard.insights.actionTitle"),description:g("dashboard.insights.actionDesc",{percent:i.toFixed(0)})})}if(a>0&&t.push({type:"priority",icon:"\u{1F4C5}",title:g("dashboard.insights.todayTitle"),description:g(a===1?"dashboard.insights.todayDescOne":"dashboard.insights.todayDescMany",{count:a})}),o>0&&a===0&&t.push({type:"warning",icon:"\u23F0",title:g("dashboard.insights.overdueTitle"),description:g(o===1?"dashboard.insights.overdueDescOne":"dashboard.insights.overdueDescMany",{count:o})}),r>0){let i=A.filter(l=>l.priority==="high"&&l.status!=="done").length;i>0&&t.push({type:"priority",icon:"\u{1F525}",title:g("dashboard.insights.highPriorityTitle"),description:g(i===1?"dashboard.insights.highPriorityDescOne":"dashboard.insights.highPriorityDescMany",{count:i})})}if(B.length>1){let i=B.filter(c=>A.some(d=>d.projectId===c.id)).length,l=B.length-i;l>0&&t.push({type:"warning",icon:"\uFFFD",title:g("dashboard.insights.emptyProjectsTitle"),description:g(l===1?"dashboard.insights.emptyProjectsDescOne":"dashboard.insights.emptyProjectsDescMany",{count:l})})}if(e>=5){let i=A.filter(l=>{if(l.status!=="done"||!l.completedDate)return!1;let c=new Date;return c.setDate(c.getDate()-7),new Date(l.completedDate)>c}).length;i>=3&&t.push({type:"success",icon:"\u{1F680}",title:g("dashboard.insights.momentumTitle"),description:g(i===1?"dashboard.insights.momentumDescOne":"dashboard.insights.momentumDescMany",{count:i})})}return t.length===0&&(e===0?t.push({type:"priority",icon:"\u{1F30A}",title:g("dashboard.insights.readyTitle"),description:g("dashboard.insights.readyDesc")}):t.push({type:"success",icon:"\u2705",title:g("dashboard.insights.caughtUpTitle"),description:g("dashboard.insights.caughtUpDesc")})),t.slice(0,3)}function jD(){document.querySelectorAll(".enhanced-stat-card").forEach((n,s)=>{n.style.opacity="0",n.style.transform="translateY(20px)",setTimeout(()=>{n.style.transition="all 0.4s ease",n.style.opacity="1",n.style.transform="translateY(0)"},s*100)}),document.querySelectorAll(".hero-stat-card").forEach((n,s)=>{n.style.opacity="0",n.style.transform="translateX(-30px)",setTimeout(()=>{n.style.transition="all 0.6s ease",n.style.opacity="1",n.style.transform="translateX(0)"},s*200)})}function Pu(t){if(!t)return g("dashboard.activity.recently");let e=new Date(t),s=Math.floor((new Date-e)/1e3);if(s<60)return g("dashboard.activity.justNow");if(s<3600){let o=Math.floor(s/60);return g(o===1?"dashboard.activity.minuteAgo":"dashboard.activity.minutesAgo",{count:o})}if(s<86400){let o=Math.floor(s/3600);return g(o===1?"dashboard.activity.hourAgo":"dashboard.activity.hoursAgo",{count:o})}if(s<604800){let o=Math.floor(s/86400);return g(o===1?"dashboard.activity.dayAgo":"dashboard.activity.daysAgo",{count:o})}return e.toLocaleDateString(Qn())}function PD(t){if(!t)return"";let e=new Date(t),s=Math.floor((new Date-e)/(1e3*60*60*24));return s===0?g("dashboard.activity.today"):s===1?g("dashboard.activity.yesterday"):s<7?g("dashboard.activity.daysAgoShort",{count:s}):e.toLocaleDateString(Qn(),{month:"short",day:"numeric"})}function ND(){window.authSystem&&window.authSystem.logout&&window.authSystem.logout()}function BD(){document.getElementById("export-data-modal").classList.add("active")}function Kk(){document.getElementById("export-data-modal").classList.remove("active")}function OD(){Kk();let t=window.authSystem?window.authSystem.getCurrentUser():null,e={user:t?{id:t.id,username:t.username,name:t.name,email:t.email}:null,projects:B,tasks:A,projectColors:Dn,sortMode:wt,manualTaskOrder:Me,settings:R,history:window.historyService?window.historyService.getHistory():[],projectCounter:Ot,taskCounter:St,statistics:{totalProjects:B.length,totalTasks:A.length,completedTasks:A.filter(i=>i.status==="done").length,completionRate:A.length>0?(A.filter(i=>i.status==="done").length/A.length*100).toFixed(1):0},exportDate:new Date().toISOString(),exportVersion:"2.0",sourceSystem:"Nautilus Multi-User"},n=JSON.stringify(e,null,2),s="data:application/json;charset=utf-8,"+encodeURIComponent(n),r=`nautilus-complete-backup-${t?.username||"user"}-${new Date().toISOString().split("T")[0]}.json`,a=document.createElement("a");a.setAttribute("href",s),a.setAttribute("download",r),a.click(),rt("Complete backup exported successfully! All data, settings, and history included.","success")}var tn=null;function RD(){let t=document.getElementById("import-data-modal");t.classList.add("active"),tn=null,document.getElementById("import-file-input").value="",document.getElementById("import-confirm-input").value="",document.getElementById("import-confirm-error").classList.remove("show"),document.getElementById("import-preview").style.display="none";let e=t.querySelector('[data-i18n="import.warningBody"]'),n=t.querySelector('[data-i18n="import.confirmText"]');e&&e.removeAttribute("data-i18n"),n&&n.removeAttribute("data-i18n"),Il(t),e&&(e.innerHTML=g("import.warningBody")),n&&(n.innerHTML=g("import.confirmText"));let s=document.getElementById("import-file-dropzone"),o=document.getElementById("import-file-input"),r=s.querySelector(".import-dropzone-text");r&&(r.textContent=g("import.dropzoneDefault")),s.addEventListener("click",()=>o.click()),s.addEventListener("keydown",c=>{(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),o.click())}),o.addEventListener("change",$D,{once:!0});let a=0;s.addEventListener("dragenter",c=>{c.preventDefault(),a++,s.classList.add("import-dropzone-dragover"),s.style.borderColor="var(--accent-blue)",s.style.background="var(--hover-bg)"}),s.addEventListener("dragover",c=>{c.preventDefault(),s.classList.add("import-dropzone-dragover"),s.style.borderColor="var(--accent-blue)",s.style.background="var(--hover-bg)"}),s.addEventListener("dragleave",c=>{c.preventDefault(),a=Math.max(0,a-1),a===0&&(s.classList.remove("import-dropzone-dragover"),s.style.borderColor="var(--border-primary)",s.style.background="var(--bg-secondary)")}),s.addEventListener("drop",c=>{c.preventDefault(),a=0,s.classList.remove("import-dropzone-dragover"),s.style.borderColor="var(--border-primary)",s.style.background="var(--bg-secondary)";let d=c.dataTransfer?.files;if(d&&d.length>0){let u=d[0];u.name.endsWith(".json")||u.type==="application/json"?Jk(u,r):Y(g("import.errorInvalidFile"))}}),s.addEventListener("dragend",()=>{a=0,s.classList.remove("import-dropzone-dragover"),s.style.borderColor="var(--border-primary)",s.style.background="var(--bg-secondary)"});let i=document.getElementById("import-confirm-input"),l=function(c){let d=c.target.selectionStart,u=c.target.selectionEnd;c.target.value=c.target.value.toLowerCase(),c.target.setSelectionRange(d,u)};i.addEventListener("input",l),i.addEventListener("keydown",function(c){c.key==="Enter"&&(c.preventDefault(),Yk())},{once:!0}),i.focus()}function ep(){document.getElementById("import-data-modal").classList.remove("active"),tn=null;let e=document.getElementById("import-file-input");e.value="",ms(null);let n=document.getElementById("import-file-dropzone");n&&(n.classList.remove("import-dropzone-dragover"),n.style.borderColor="var(--border-primary)",n.style.background="var(--bg-secondary)");let s=document.getElementById("import-confirm-input"),o=s.cloneNode(!0);s.parentNode.replaceChild(o,s),document.getElementById("import-confirm-error").classList.remove("show"),document.getElementById("import-preview").style.display="none"}function $D(t){let e=t.target.files[0];if(!e){tn=null,document.getElementById("import-preview").style.display="none",ms(null);return}Jk(e)}function Jk(t,e=null){if(!t){tn=null,document.getElementById("import-preview").style.display="none",ms(null);return}if(!t.name.endsWith(".json")&&t.type!=="application/json"){Y(g("import.errorInvalidFile"));let s=document.getElementById("import-file-input");s&&(s.value=""),tn=null,document.getElementById("import-preview").style.display="none",ms(null);return}ms(t.name,e);let n=new FileReader;n.onload=function(s){try{let o=JSON.parse(s.target.result);if(!Gk(o)){Y(g("import.errorInvalidFormat"));let r=document.getElementById("import-file-input");r&&(r.value=""),tn=null,document.getElementById("import-preview").style.display="none",ms(null);return}tn=o,FD(o)}catch(o){console.error("Import file parse error:",o),Y(g("import.errorParseFailed"));let r=document.getElementById("import-file-input");r&&(r.value=""),tn=null,document.getElementById("import-preview").style.display="none",ms(null)}},n.onerror=function(){Y(g("import.errorReadFailed"));let s=document.getElementById("import-file-input");s&&(s.value=""),tn=null,document.getElementById("import-preview").style.display="none",ms(null)},n.readAsText(t)}function ms(t,e=null){let n=document.getElementById("import-file-dropzone");if(!n)return;let s=e||n.querySelector(".import-dropzone-text");s&&(t?(s.textContent=t,s.style.fontWeight="500",s.style.color="var(--text-primary)"):(s.textContent=g("import.dropzoneDefault"),s.style.fontWeight="normal",s.style.color="var(--text-secondary)"))}function Gk(t){if(!t||typeof t!="object"||!Array.isArray(t.tasks)||!Array.isArray(t.projects))return!1;for(let e of t.tasks)if(!e||typeof e!="object"||!e.id||!e.title)return!1;for(let e of t.projects)if(!e||typeof e!="object"||!e.id||!e.name)return!1;return!0}function FD(t){let e=document.getElementById("import-preview"),n=document.getElementById("import-preview-content"),s={projects:t.projects?.length||0,tasks:t.tasks?.length||0,exportDate:t.exportDate||"Unknown",exportVersion:t.exportVersion||"Unknown"};n.innerHTML=`
        <div style="margin-bottom: 8px;">
            <strong>${s.projects}</strong> ${s.projects===1?"project":"projects"}
        </div>
        <div style="margin-bottom: 8px;">
            <strong>${s.tasks}</strong> ${s.tasks===1?"task":"tasks"}
        </div>
        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-primary); color: var(--text-muted); font-size: 12px;">
            Exported: ${new Date(s.exportDate).toLocaleDateString()} (v${s.exportVersion})
        </div>
    `,e.style.display="block"}async function Yk(){let t=document.getElementById("import-confirm-input"),e=document.getElementById("import-confirm-error");if(t.value.trim().toLowerCase()!=="import"){e.classList.add("show"),t.focus();return}if(!tn){Y(g("import.errorNoFile"));return}if(!Gk(tn)){Y(g("import.errorInvalidFormat"));return}try{rt(g("import.processing"),"info");let s=tn;if(Array.isArray(s.tasks)&&(A=s.tasks,s.taskCounter&&typeof s.taskCounter=="number"?St=s.taskCounter:St=(A.length>0?Math.max(...A.map(r=>r.id||0)):0)+1),Array.isArray(s.projects)&&(B=s.projects,s.projectCounter&&typeof s.projectCounter=="number"?Ot=s.projectCounter:Ot=(B.length>0?Math.max(...B.map(r=>r.id||0)):0)+1),s.projectColors&&typeof s.projectColors=="object"&&(Dn=s.projectColors),s.sortMode&&(wt=s.sortMode),s.manualTaskOrder&&typeof s.manualTaskOrder=="object"&&(Me=s.manualTaskOrder),s.settings&&typeof s.settings=="object"){let o=R.language,r=document.documentElement.getAttribute("data-theme");R={...R,...s.settings},R.language=o,r&&document.documentElement.setAttribute("data-theme",r)}if(s.history&&window.historyService&&Array.isArray(s.history))try{typeof window.historyService.importHistory=="function"?window.historyService.importHistory(s.history):console.warn("History import not available - historyService.importHistory not found")}catch(o){console.warn("Failed to import history:",o)}if(await Promise.all([ot().catch(o=>{throw console.error("Failed to save imported tasks:",o),new Error("Failed to save tasks")}),Rt().catch(o=>{throw console.error("Failed to save imported projects:",o),new Error("Failed to save projects")}),Ml().catch(o=>{console.error("Failed to save imported settings:",o)})]),s.projectColors)try{await Lk()}catch(o){console.warn("Failed to save project colors:",o)}ep(),Et(g("import.success")),so(),window.location.hash="#dashboard",Ze("dashboard")}catch(s){console.error("Import error:",s),Y(g("import.errorFailed")+": "+(s.message||"Unknown error"))}}async function zD(){rt("Generando reporte...","info");try{let{generateWordReport:t}=await Promise.resolve().then(()=>(Gy(),Jy)),e=await t(B,A);if(e.success)rt(`\u2705 Reporte generado: ${e.filename}`,"success"),console.log("Report Summary:",{activeProjects:e.insights.activeProjectsCount,completedTasks:`${e.insights.completedTasks}/${e.insights.totalTasks}`,progress:`${e.insights.completionPercent}%`});else throw new Error(e.error)}catch(t){console.error("Error generating report:",t),rt("\u274C Error al generar el reporte: "+t.message,"error")}}function Ct(){document.getElementById("projects-count").textContent=B.length,document.getElementById("tasks-count").textContent=A.length;let t=document.getElementById("active-projects"),e=document.getElementById("pending-tasks"),n=document.getElementById("completed-tasks");t&&(t.textContent=B.length),e&&(e.textContent=A.filter(c=>c.status!=="done").length),n&&(n.textContent=A.filter(c=>c.status==="done").length);let s=document.getElementById("todo-count"),o=document.getElementById("progress-count"),r=document.getElementById("review-count"),a=document.getElementById("done-count");s&&(s.textContent=A.filter(c=>c.status==="todo").length),o&&(o.textContent=A.filter(c=>c.status==="progress").length),r&&(r.textContent=A.filter(c=>c.status==="review").length),a&&(a.textContent=A.filter(c=>c.status==="done").length);let i=Ve.filter(c=>c.status==="open").length,l=document.getElementById("feedback-count");l&&(l.textContent=i),ys()}var Ys={column:null,direction:"asc"};function HD(t){Ys.column===t?Ys.direction=Ys.direction==="asc"?"desc":"asc":(Ys.column=t,Ys.direction="asc"),document.querySelectorAll(".tasks-table th .sort-indicator").forEach(n=>{n.textContent="\u2195",n.style.opacity="0.5"});let e=document.getElementById(`sort-${t}`);e&&(e.textContent=Ys.direction==="asc"?"\u2191":"\u2193",e.style.opacity="1"),on()}function on(){let t=document.getElementById("tasks-table-body"),e=typeof ln=="function"?ln():A.slice(),n=Is(window.kanbanUpdatedFilter),o=df(e,{currentSort:Ys,projects:B,updatedCutoff:n,getTaskUpdatedTime:Ln}).tasks,r=g("tasks.list.count",{count:o.length})||`${o.length} results`,a=document.getElementById("tasks-list-count");a&&(a.textContent=r);let i=document.getElementById("tasks-list-count-bottom");if(i&&(i.textContent=r),t){let l={escapeHtml:V,formatDate:xe,getTagColor:sn,getProjectColor:Ke,getPriorityLabel:At,getStatusLabel:pt,formatTaskUpdatedDateTime:Gp,projects:B,noProjectText:g("tasks.noProject"),noDateText:g("tasks.noDate")};t.innerHTML=cf(o,l)}QD(o),Ll(),qD()}var lk=!1;function qD(){if(lk)return;lk=!0,[{id:"mass-edit-status-btn",field:"status"},{id:"mass-edit-priority-btn",field:"priority"},{id:"mass-edit-dates-btn",field:"dates"},{id:"mass-edit-project-btn",field:"project"},{id:"mass-edit-tags-btn",field:"tags"}].forEach(({id:e,field:n})=>{let s=document.getElementById(e);s&&s.addEventListener("click",o=>{o.stopPropagation(),Xk(n,s)})})}function UD(t,e){let n=e?.shiftKey,s=e?.ctrlKey||e?.metaKey;n&&ce.lastSelectedId!==null?_D(ce.lastSelectedId,t):s?ce.selectedTaskIds.has(t)?ce.selectedTaskIds.delete(t):(ce.selectedTaskIds.add(t),ce.lastSelectedId=t):ce.selectedTaskIds.has(t)?(ce.selectedTaskIds.delete(t),ce.lastSelectedId===t&&(ce.lastSelectedId=null)):(ce.selectedTaskIds.add(t),ce.lastSelectedId=t),Ll()}function _D(t,e){let n=ro(),s=n.findIndex(i=>i.id===t),o=n.findIndex(i=>i.id===e);if(s===-1||o===-1)return;let[r,a]=s<o?[s,o]:[o,s];for(let i=r;i<=a;i++)ce.selectedTaskIds.add(n[i].id);ce.lastSelectedId=e}function ro(){let t=ln(),e=Is(window.kanbanUpdatedFilter);return e!==null&&(t=t.filter(n=>Ln(n)>=e)),t}function ck(){let t=ro();ce.selectedTaskIds.clear(),t.forEach(e=>ce.selectedTaskIds.add(e.id)),t.length>0&&(ce.lastSelectedId=t[0].id),Ll()}function cl(){ce.selectedTaskIds.clear(),ce.lastSelectedId=null,ce.pendingChanges=[],Ll(),Pl()}function Ll(){let t=ro(),e=t.length,n=new Set;t.forEach(c=>{ce.selectedTaskIds.has(c.id)&&n.add(c.id)});let s=n.size,o=document.getElementById("mass-edit-toolbar");o&&(o.style.display=s>0?"flex":"none");let r=document.getElementById("mass-edit-count");r&&(r.textContent=g("tasks.massEdit.selected",{count:s,total:e}));let a=document.getElementById("mass-edit-select-all");a&&(s===0?(a.checked=!1,a.indeterminate=!1):s===e?(a.checked=!0,a.indeterminate=!1):(a.checked=!1,a.indeterminate=!0));let i=document.getElementById("table-select-all");if(i){let c=t.filter(d=>ce.selectedTaskIds.has(d.id)).length;c===0?(i.checked=!1,i.indeterminate=!1):c===e?(i.checked=!0,i.indeterminate=!1):(i.checked=!1,i.indeterminate=!0)}let l=document.getElementById("tasks-table-body");l&&l.querySelectorAll("tr[data-task-id]").forEach(d=>{let u=parseInt(d.dataset.taskId,10),p=d.querySelector(".task-select-checkbox"),f=ce.selectedTaskIds.has(u);p&&(p.checked=f),f?d.classList.add("mass-edit-selected"):d.classList.remove("mass-edit-selected")}),Pl()}function Xk(t,e){Uo();let n=VD(t);document.body.appendChild(n);let s=e.getBoundingClientRect();n.style.left=`${s.left}px`,n.style.top=`${s.bottom+8}px`;let o=n.getBoundingClientRect();o.right>window.innerWidth&&(n.style.left=`${window.innerWidth-o.width-20}px`),o.bottom>window.innerHeight&&(n.style.top=`${s.top-o.height-8}px`),n.dataset.field=t;let r=ce.pendingChanges.find(a=>a.field===t);if(r){if(t==="status"&&r.value){let a=n.querySelector(`input[name="mass-edit-status"][value="${r.value}"]`);a&&(a.checked=!0)}else if(t==="priority"&&r.value){let a=n.querySelector(`input[name="mass-edit-priority"][value="${r.value}"]`);a&&(a.checked=!0)}else if(t==="project"&&r.value!==void 0){let a=r.value===null?"none":r.value,i=n.querySelector(`input[name="mass-edit-project"][value="${a}"]`);i&&(i.checked=!0)}else if(t!=="dates"){if(t==="tags"&&r.tags&&r.tags.length>0){let a=n.querySelector(`input[name="mass-edit-tags-mode"][value="${r.mode}"]`);a&&(a.checked=!0,n.querySelectorAll(".mass-edit-tags-mode-option").forEach(c=>c.classList.remove("active")),a.closest(".mass-edit-tags-mode-option")?.classList.add("active"));let i=n.querySelector("#mass-edit-tags-list");i&&(i.innerHTML="",r.tags.forEach(l=>{let c=sn(l),d=document.createElement("div");d.className="mass-edit-tag-item",d.dataset.tagName=l,d.style.background=c,d.innerHTML=`<span>${V(l.toUpperCase())}</span><button class="mass-edit-tag-remove">\xD7</button>`,d.querySelector(".mass-edit-tag-remove").addEventListener("click",()=>{d.remove();let u=Array.from(n.querySelectorAll(".mass-edit-existing-tag")).find(p=>p.dataset.tag===l);u&&u.classList.remove("selected"),Fo(n)}),i.appendChild(d)}),r.tags.forEach(l=>{let c=Array.from(n.querySelectorAll(".mass-edit-existing-tag")).find(d=>d.dataset.tag===l);c&&c.classList.add("selected")}))}}}if(t==="dates"){let a=window.flatpickr;if(typeof a=="function"){let l={dateFormat:"d/m/Y",locale:Xu(),allowInput:!0,disableMobile:!0},c=n.querySelector("#mass-edit-start-date"),d=n.querySelector("#mass-edit-end-date"),u=(p,f)=>{p.addEventListener("input",h=>{let m=h.target.value,y=m.replace(/\D/g,""),k="";if(y.length>=1){let S=y.substring(0,2);parseInt(S,10)>31&&(S="31"),k=S}if(y.length>=3){let S=y.substring(2,4);parseInt(S,10)>12&&(S="12"),k+="/"+S}if(y.length>=5&&(k+="/"+y.substring(4,8)),m!==k&&(h.target.value=k),k.match(/^\d{2}\/\d{2}\/\d{4}$/)){let[S,T,D]=k.split("/"),E=new Date(+D,+T-1,+S);f&&f.setDate(E,!1),p.dataset.isoValue=`${D}-${T}-${S}`}})};if(c){let p=a(c,{...l,defaultDate:r?.startDate?new Date(r.startDate):null,onChange:f=>{if(f.length>0){let h=f[0];c.dataset.isoValue=`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-${String(h.getDate()).padStart(2,"0")}`}else c.dataset.isoValue=""}});u(c,p),r?.startDate&&(c.dataset.isoValue=r.startDate)}if(d){let p=a(d,{...l,defaultDate:r?.endDate?new Date(r.endDate):null,onChange:f=>{if(f.length>0){let h=f[0];d.dataset.isoValue=`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-${String(h.getDate()).padStart(2,"0")}`}else d.dataset.isoValue=""}});u(d,p),r?.endDate&&(d.dataset.isoValue=r.endDate)}}}n.dataset.initialStateJson=jl(n),Fo(n),requestAnimationFrame(()=>Fo(n))}function VD(t){let e=document.createElement("div");e.id="mass-edit-popover",e.className="mass-edit-popover",e.dataset.field=t;let n="";if(t==="status")n=`
            <div class="mass-edit-option">
                <input type="radio" name="mass-edit-status" value="backlog" id="mass-status-backlog">
                <label for="mass-status-backlog" class="mass-edit-option-label">
                    <span class="status-badge backlog">${g("tasks.status.backlog")}</span>
                </label>
            </div>
            <div class="mass-edit-option">
                <input type="radio" name="mass-edit-status" value="todo" id="mass-status-todo">
                <label for="mass-status-todo" class="mass-edit-option-label">
                    <span class="status-badge todo">${g("tasks.status.todo")}</span>
                </label>
            </div>
            <div class="mass-edit-option">
                <input type="radio" name="mass-edit-status" value="progress" id="mass-status-progress">
                <label for="mass-status-progress" class="mass-edit-option-label">
                    <span class="status-badge progress">${g("tasks.status.progress")}</span>
                </label>
            </div>
            ${R.enableReviewStatus?`
            <div class="mass-edit-option">
                <input type="radio" name="mass-edit-status" value="review" id="mass-status-review">
                <label for="mass-status-review" class="mass-edit-option-label">
                    <span class="status-badge review">${g("tasks.status.review")}</span>
                </label>
            </div>
            `:""}
            <div class="mass-edit-option">
                <input type="radio" name="mass-edit-status" value="done" id="mass-status-done">
                <label for="mass-status-done" class="mass-edit-option-label">
                    <span class="status-badge done">${g("tasks.status.done")}</span>
                </label>
            </div>
        `;else if(t==="priority")n=`
            <div class="mass-edit-option">
                <input type="radio" name="mass-edit-priority" value="high" id="mass-priority-high">
                <label for="mass-priority-high" class="mass-edit-option-label">
                    <span class="priority-pill priority-high">HIGH</span>
                </label>
            </div>
            <div class="mass-edit-option">
                <input type="radio" name="mass-edit-priority" value="medium" id="mass-priority-medium">
                <label for="mass-priority-medium" class="mass-edit-option-label">
                    <span class="priority-pill priority-medium">MEDIUM</span>
                </label>
            </div>
            <div class="mass-edit-option">
                <input type="radio" name="mass-edit-priority" value="low" id="mass-priority-low">
                <label for="mass-priority-low" class="mass-edit-option-label">
                    <span class="priority-pill priority-low">LOW</span>
                </label>
            </div>
        `;else if(t==="dates")n=`
            <div class="mass-edit-date-group">
                <label class="mass-edit-date-label" for="mass-edit-start-date">
                    ${g("tasks.massEdit.startDate")}
                </label>
                <input type="text" id="mass-edit-start-date" class="mass-edit-date-input" placeholder="dd/mm/yyyy" autocomplete="off">
            </div>
            <div class="mass-edit-date-group">
                <label class="mass-edit-date-label" for="mass-edit-end-date">
                    ${g("tasks.massEdit.endDate")}
                </label>
                <input type="text" id="mass-edit-end-date" class="mass-edit-date-input" placeholder="dd/mm/yyyy" autocomplete="off">
            </div>
        `;else if(t==="project"){let i=B.map(l=>`
            <div class="mass-edit-option">
                <input type="radio" name="mass-edit-project" value="${l.id}" id="mass-project-${l.id}">
                <label for="mass-project-${l.id}" class="mass-edit-option-label">
                    <span class="project-dot" style="background: ${Ke(l.id)};"></span>
                    ${V(l.name)}
                </label>
            </div>
        `).join("");n=`
            <div class="mass-edit-option">
                <input type="radio" name="mass-edit-project" value="none" id="mass-project-none">
                <label for="mass-project-none" class="mass-edit-option-label">
                    ${g("tasks.noProject")}
                </label>
            </div>
            ${i}
        `}else if(t==="tags"){let l=ro().filter(p=>ce.selectedTaskIds.has(p.id)),c=new Set;l.forEach(p=>{p.tags&&Array.isArray(p.tags)&&p.tags.forEach(f=>c.add(f))});let d=[...c].sort(),u=d.length>0?d.map(p=>`
                <div class="mass-edit-existing-tag" data-tag="${V(p)}">
                    <span class="tag-badge" style="background: ${sn(p)};">${V(p.toUpperCase())}</span>
                </div>
            `).join(""):`<div class="mass-edit-no-tags">${g("tasks.massEdit.tags.noExisting")||"No existing tags"}</div>`;n=`
            <div class="mass-edit-tags-mode">
                <div class="mass-edit-tags-mode-option active" data-mode="add">
                    <input type="radio" name="mass-edit-tags-mode" value="add" id="mass-tags-mode-add" checked>
                    <label for="mass-tags-mode-add" class="mass-edit-option-label">
                        ${g("tasks.massEdit.tags.add")}
                    </label>
                </div>
                <div class="mass-edit-tags-mode-option" data-mode="replace">
                    <input type="radio" name="mass-edit-tags-mode" value="replace" id="mass-tags-mode-replace">
                    <label for="mass-tags-mode-replace" class="mass-edit-option-label">
                        ${g("tasks.massEdit.tags.replace")}
                    </label>
                </div>
                <div class="mass-edit-tags-mode-option" data-mode="remove">
                    <input type="radio" name="mass-edit-tags-mode" value="remove" id="mass-tags-mode-remove">
                    <label for="mass-tags-mode-remove" class="mass-edit-option-label">
                        ${g("tasks.massEdit.tags.remove")}
                    </label>
                </div>
            </div>
            <div class="mass-edit-existing-tags-section">
                <div class="mass-edit-existing-tags-label">Click to select:</div>
                <div class="mass-edit-existing-tags" id="mass-edit-existing-tags">
                    ${u}
                </div>
            </div>
            <div class="mass-edit-tags-input">
                <input type="text" id="mass-edit-tag-input" placeholder="Add tag">
                <button class="btn btn-secondary" id="mass-edit-add-tag-btn">Add</button>
            </div>
            <div class="mass-edit-selected-label">Selected:</div>
            <div class="mass-edit-tags-list" id="mass-edit-tags-list"></div>
        `}e.innerHTML=`
        <div class="mass-edit-popover-header">
            <h3 class="mass-edit-popover-title">${WD(t)}</h3>
            <button type="button" class="mass-edit-popover-done">${g("common.done")}</button>
        </div>
        <div class="mass-edit-popover-body">
            ${n}
        </div>
        <div class="mass-edit-popover-footer">
            <button class="btn btn-outline" id="mass-edit-popover-clear-btn" disabled>Clear</button>
            <button class="btn btn-primary" id="mass-edit-apply-btn" data-action="applyMassEdit" disabled>${g("tasks.massEdit.apply")}</button>
        </div>
    `;let s=e.querySelector("#mass-edit-popover-clear-btn"),o=e.querySelector("#mass-edit-apply-btn");s&&s.addEventListener("click",()=>{Qk(),Fo(e)});let r=e.querySelector(".mass-edit-popover-done");if(r&&r.addEventListener("click",()=>Uo()),e.addEventListener("change",()=>Fo(e)),e.addEventListener("click",()=>Fo(e)),e.querySelectorAll(".mass-edit-option").forEach(i=>{i.addEventListener("click",l=>{if(l.target.tagName==="INPUT")return;let c=i.querySelector('input[type="radio"]');c&&(c.checked=!0,c.dispatchEvent(new Event("change",{bubbles:!0})))})}),t==="tags"){let i=e.querySelectorAll(".mass-edit-tags-mode-option");i.forEach(u=>{u.addEventListener("click",()=>{i.forEach(p=>p.classList.remove("active")),u.classList.add("active"),u.querySelector("input").checked=!0})});let l=e.querySelector("#mass-edit-add-tag-btn"),c=e.querySelector("#mass-edit-tag-input");l.addEventListener("click",()=>{let u=c.value.trim().toLowerCase();if(!u)return;let p=e.querySelector("#mass-edit-tags-list");if(!Array.from(p.querySelectorAll(".mass-edit-tag-item")).map(h=>h.dataset.tagName).includes(u)){let h=sn(u),m=document.createElement("div");m.className="mass-edit-tag-item",m.dataset.tagName=u,m.style.background=h,m.innerHTML=`
                    <span>${V(u.toUpperCase())}</span>
                    <button class="mass-edit-tag-remove" onclick="this.parentElement.remove()">\xD7</button>
                `,p.appendChild(m),c.value=""}}),c.addEventListener("keypress",u=>{u.key==="Enter"&&(u.preventDefault(),l.click())});let d=e.querySelector("#mass-edit-existing-tags");d&&d.addEventListener("click",u=>{let p=u.target.closest(".mass-edit-existing-tag");if(!p)return;let f=p.dataset.tag;if(!f)return;p.classList.toggle("selected");let h=e.querySelector("#mass-edit-tags-list"),m=Array.from(h.querySelectorAll(".mass-edit-tag-item")).map(y=>y.dataset.tagName);if(p.classList.contains("selected")){if(!m.includes(f)){let y=sn(f),k=document.createElement("div");k.className="mass-edit-tag-item",k.dataset.tagName=f,k.style.background=y,k.innerHTML=`
                            <span>${V(f.toUpperCase())}</span>
                            <button class="mass-edit-tag-remove">\xD7</button>
                        `,k.querySelector(".mass-edit-tag-remove").addEventListener("click",()=>{k.remove(),p.classList.remove("selected")}),h.appendChild(k)}}else{let y=Array.from(h.querySelectorAll(".mass-edit-tag-item")).find(k=>k.dataset.tagName===f);y&&y.remove()}})}return e}function WD(t){let e=ce.selectedTaskIds.size;return{status:`${g("tasks.massEdit.status")} (${e} tasks)`,priority:`${g("tasks.massEdit.priority")} (${e} tasks)`,dates:`${g("tasks.massEdit.dates")} (${e} tasks)`,project:`${g("tasks.massEdit.project")} (${e} tasks)`,tags:`${g("tasks.massEdit.tags")} (${e} tasks)`}[t]||""}function Uo(){let t=document.getElementById("mass-edit-popover");t&&t.remove()}function Zk(t){if(!t)return!1;let e=t.dataset.field;if(!e)return!1;if(e==="status")return!!t.querySelector('input[name="mass-edit-status"]:checked');if(e==="priority")return!!t.querySelector('input[name="mass-edit-priority"]:checked');if(e==="project")return t.querySelector('input[name="mass-edit-project"]:checked')!=null;if(e==="dates"){let n=document.getElementById("mass-edit-start-date")?.dataset?.isoValue??"",s=document.getElementById("mass-edit-end-date")?.dataset?.isoValue??"";return!!(n||s)}return e==="tags"?t.querySelectorAll(".mass-edit-tag-item").length>0?!0:t.querySelectorAll(".mass-edit-existing-tag.selected").length>0:!1}function Fo(t){if(!t)return;let e=t.querySelector("#mass-edit-popover-clear-btn"),n=t.querySelector("#mass-edit-apply-btn"),s=Zk(t);e&&(e.disabled=!s);let o=t.dataset.initialStateJson??"",a=jl(t)!==o;n&&(s&&a?(n.removeAttribute("disabled"),n.disabled=!1,n.setAttribute("aria-disabled","false")):(n.setAttribute("disabled",""),n.disabled=!0,n.setAttribute("aria-disabled","true")))}function jl(t){if(!t)return"";let e=t.dataset.field;if(e==="status")return t.querySelector('input[name="mass-edit-status"]:checked')?.value??"";if(e==="priority")return t.querySelector('input[name="mass-edit-priority"]:checked')?.value??"";if(e==="project"){let n=t.querySelector('input[name="mass-edit-project"]:checked')?.value;return n===void 0?"":String(n)}if(e==="dates"){let n=document.getElementById("mass-edit-start-date")?.dataset?.isoValue??"",s=document.getElementById("mass-edit-end-date")?.dataset?.isoValue??"";return`${n}|${s}`}if(e==="tags"){let n=t.querySelector('input[name="mass-edit-tags-mode"]:checked')?.value??"",s=Array.from(t.querySelectorAll("#mass-edit-tags-list .mass-edit-tag-item")).map(r=>r.dataset.tagName).sort().join(","),o=Array.from(t.querySelectorAll(".mass-edit-existing-tag.selected")).map(r=>r.dataset.tag).sort().join(",");return`${n}|${s}|${o}`}return""}function Qk(){let t=document.getElementById("mass-edit-popover");if(!t)return;let e=t.dataset.field;ce.pendingChanges=ce.pendingChanges.filter(l=>l.field!==e),Pl(),t.querySelectorAll('input[type="radio"]').forEach(l=>l.checked=!1),t.querySelectorAll(".mass-edit-date-input").forEach(l=>{l.value="",l.dataset.isoValue="",l._flatpickr&&l._flatpickr.clear()});let o=t.querySelector("#mass-edit-tags-list");o&&(o.innerHTML=""),t.querySelectorAll(".mass-edit-existing-tag").forEach(l=>l.classList.remove("selected"));let a=t.querySelector("#mass-edit-tag-input");a&&(a.value=""),t.querySelectorAll(".mass-edit-tags-mode-option").forEach((l,c)=>{l.classList.toggle("active",c===0);let d=l.querySelector('input[type="radio"]');d&&(d.checked=c===0)}),t.dataset.initialStateJson=jl(t)}function KD(){let t=document.getElementById("mass-edit-popover");if(!t)return;let e=Zk(t),n=t.dataset.initialStateJson??"",o=jl(t)!==n;if(!e||!o){rt(g("tasks.massEdit.selectFirst"),"info");return}let r=t.dataset.field,a=null;if(r==="status"){let i=t.querySelector('input[name="mass-edit-status"]:checked')?.value;if(!i){rt(g("tasks.massEdit.selectFirst"),"info");return}a={field:"status",value:i}}else if(r==="priority"){let i=t.querySelector('input[name="mass-edit-priority"]:checked')?.value;if(!i){rt(g("tasks.massEdit.selectFirst"),"info");return}a={field:"priority",value:i}}else if(r==="dates"){let i=document.getElementById("mass-edit-start-date"),l=document.getElementById("mass-edit-end-date"),c=i?.dataset.isoValue||null,d=l?.dataset.isoValue||null;if(!c&&!d){rt(g("tasks.massEdit.selectFirst"),"info");return}a={field:"dates",startDate:c,endDate:d}}else if(r==="project"){let i=t.querySelector('input[name="mass-edit-project"]:checked')?.value;if(i===void 0){rt(g("tasks.massEdit.selectFirst"),"info");return}a={field:"project",value:i==="none"?null:parseInt(i,10)}}else if(r==="tags"){let i=t.querySelector('input[name="mass-edit-tags-mode"]:checked')?.value,l=t.querySelectorAll("#mass-edit-tags-list .mass-edit-tag-item"),c=Array.from(l).map(d=>d.dataset.tagName);if(c.length===0){rt(g("tasks.massEdit.selectFirst"),"info");return}a={field:"tags",mode:i,tags:c}}a&&(ce.pendingChanges=ce.pendingChanges.filter(i=>i.field!==r),ce.pendingChanges.push(a),Uo(),Pl(),rt(g("tasks.massEdit.changeQueued"),"info"))}function Pl(){let t=document.getElementById("mass-edit-pending"),e=document.getElementById("mass-edit-pending-count"),n=document.getElementById("mass-edit-apply-all-btn"),s=ce.pendingChanges.length,o=ce.selectedTaskIds.size>0;t&&e&&(s>0?(t.style.display="flex",e.textContent=s):t.style.display="none"),n&&(n.disabled=!(s>0&&o));let r={status:document.getElementById("mass-edit-status-btn"),priority:document.getElementById("mass-edit-priority-btn"),dates:document.getElementById("mass-edit-dates-btn"),project:document.getElementById("mass-edit-project-btn"),tags:document.getElementById("mass-edit-tags-btn")},a=new Set(ce.pendingChanges.map(i=>i.field));Object.entries(r).forEach(([i,l])=>{l&&(a.has(i)?l.classList.add("has-pending"):l.classList.remove("has-pending"))})}function JD(){let t=ce.pendingChanges;t.length===0||ro().filter(s=>ce.selectedTaskIds.has(s.id)).map(s=>s.id).length===0||GD(t)}function GD(t){let e=document.getElementById("mass-edit-confirm-modal"),n=document.getElementById("mass-edit-confirm-summary"),s=document.getElementById("mass-edit-confirm-changes"),o=document.getElementById("mass-edit-confirm-apply-btn"),a=ro().filter(u=>ce.selectedTaskIds.has(u.id)),i=a.length;n.textContent=g("tasks.massEdit.confirm.summary",{count:i}).replace(/:\s*$/,".");let l=(u,p,f)=>{let h=a.map(y=>p(y)),m=[...new Set(h)];return m.length===1?f(m[0]):'<span class="mass-edit-various">Various</span>'},c="";t.forEach(u=>{if(u.field==="status"){let p=pt(u.value),f=[...new Set(a.map(m=>m.status))],h=f.length===1?`<span class="status-badge ${f[0]}">${pt(f[0])}</span>`:`<span class="mass-edit-multiple">${g("tasks.massEdit.multiple")}</span>`;c+=`
                <div class="mass-edit-visual-row">
                    <span class="mass-edit-row-label">${g("tasks.massEdit.status")}</span>
                    <span class="mass-edit-row-from">${h}</span>
                    <span class="mass-edit-row-arrow">\u2192</span>
                    <span class="mass-edit-row-to"><span class="status-badge ${u.value}">${p}</span></span>
                </div>
            `}else if(u.field==="priority"){let p=At(u.value).toUpperCase(),f=[...new Set(a.map(m=>m.priority))],h=f.length===1?`<span class="priority-pill priority-${f[0]}">${At(f[0]).toUpperCase()}</span>`:`<span class="mass-edit-multiple">${g("tasks.massEdit.multiple")}</span>`;c+=`
                <div class="mass-edit-visual-row">
                    <span class="mass-edit-row-label">${g("tasks.massEdit.priority")}</span>
                    <span class="mass-edit-row-from">${h}</span>
                    <span class="mass-edit-row-arrow">\u2192</span>
                    <span class="mass-edit-row-to"><span class="priority-pill priority-${u.value}">${p}</span></span>
                </div>
            `}else if(u.field==="dates"){let p=g("tasks.noDate")||"No Date";if(u.startDate){let f=[...new Set(a.map(m=>m.startDate||""))],h;f.length===1?h=f[0]?xe(f[0]):`<span class="mass-edit-multiple">${p}</span>`:h=`<span class="mass-edit-multiple">${g("tasks.massEdit.multiple")}</span>`,c+=`
                    <div class="mass-edit-visual-row">
                        <span class="mass-edit-row-label">${g("tasks.massEdit.startDate")}</span>
                        <span class="mass-edit-row-from">${h}</span>
                        <span class="mass-edit-row-arrow">\u2192</span>
                        <span class="mass-edit-row-to">${xe(u.startDate)}</span>
                    </div>
                `}if(u.endDate){let f=[...new Set(a.map(m=>m.endDate||""))],h;f.length===1?h=f[0]?xe(f[0]):`<span class="mass-edit-multiple">${p}</span>`:h=`<span class="mass-edit-multiple">${g("tasks.massEdit.multiple")}</span>`,c+=`
                    <div class="mass-edit-visual-row">
                        <span class="mass-edit-row-label">${g("tasks.massEdit.endDate")}</span>
                        <span class="mass-edit-row-from">${h}</span>
                        <span class="mass-edit-row-arrow">\u2192</span>
                        <span class="mass-edit-row-to">${xe(u.endDate)}</span>
                    </div>
                `}}else if(u.field==="project"){let p=u.value===null?g("tasks.noProject"):B.find(k=>k.id===u.value)?.name||"",f=g("tasks.noProject"),h=a.map(k=>{if(!k.projectId)return f;let S=B.find(T=>T.id===k.projectId);return S?S.name:""}),m=[...new Set(h)],y=m.length===1&&m[0]?V(m[0]):'<span class="mass-edit-various">Various</span>';c+=`
                <div class="mass-edit-visual-row">
                    <span class="mass-edit-row-label">${g("tasks.massEdit.project")}</span>
                    <span class="mass-edit-row-from">${y}</span>
                    <span class="mass-edit-row-arrow">\u2192</span>
                    <span class="mass-edit-row-to">${V(p)}</span>
                </div>
            `}else if(u.field==="tags"){let p={add:g("tasks.massEdit.tags.add"),replace:g("tasks.massEdit.tags.replace"),remove:g("tasks.massEdit.tags.remove")}[u.mode],f=u.tags.map(h=>`<span class="tag-badge" style="background: ${sn(h)}; font-size: 10px; padding: 2px 6px;">${V(h.toUpperCase())}</span>`).join(" ");c+=`
                <div class="mass-edit-visual-row">
                    <span class="mass-edit-row-label">${p}</span>
                    <span class="mass-edit-row-from"></span>
                    <span class="mass-edit-row-arrow"></span>
                    <span class="mass-edit-row-to">${f}</span>
                </div>
            `}}),s.innerHTML=c;let d=o.querySelector("[data-i18n]");d&&(d.textContent=g("tasks.massEdit.confirm.confirm")),e.style.display="",e.classList.add("active")}function tp(){let t=document.getElementById("mass-edit-confirm-modal");t.classList.remove("active"),setTimeout(()=>{t.style.display="none"},300)}function YD(t){t.target.id==="mass-edit-confirm-modal"&&tp()}async function XD(){console.log("[Mass Edit] applyMassEditConfirmed() called");let t=ce.pendingChanges;if(!t||t.length===0){console.warn("[Mass Edit] No pending changes, exiting");return}let n=ro().filter(a=>ce.selectedTaskIds.has(a.id)).map(a=>a.id),s=n.length;console.log("[Mass Edit] Starting mass edit:",{count:s,changes:t});let o=document.getElementById("mass-edit-confirm-apply-btn"),r=o?o.innerHTML:"";o&&(o.disabled=!0,o.innerHTML='<span class="spinner"></span> '+(g("common.updating")||"Updating..."));try{let a=n;a.forEach(i=>{let l=A.find(d=>d.id===i);if(!l)return;let c={...l,tags:[...l.tags||[]]};t.forEach(d=>{if(d.field==="status")l.status=d.value;else if(d.field==="priority")l.priority=d.value;else if(d.field==="dates")d.startDate&&(l.startDate=d.startDate),d.endDate&&(l.endDate=d.endDate);else if(d.field==="project")l.projectId=d.value;else if(d.field==="tags"){let u=[...l.tags||[]];if(d.mode==="add"){let p=new Set([...u,...d.tags]);l.tags=Array.from(p)}else d.mode==="replace"?l.tags=[...d.tags]:d.mode==="remove"&&(l.tags=u.filter(p=>!d.tags.includes(p)))}}),l.updatedAt=new Date().toISOString(),window.historyService&&window.historyService.recordTaskUpdated(c,l)}),console.log("[Mass Edit] Calling saveTasks()..."),await ot(),console.log("[Mass Edit] saveTasks() completed successfully"),rt(g("tasks.massEdit.success",{count:a.length}),"success"),tp(),ce.pendingChanges=[],cl(),ft(),on(),document.getElementById("projects")?.classList.contains("active")&&Mt()}catch(a){let i=a?.message??String(a),l=a?.stack,c=a?.cause;console.error("[Mass Edit] Save failed:",i),l&&console.error("[Mass Edit] Stack:",l),c&&console.error("[Mass Edit] Cause:",c?.message??c),rt(g("error.saveChangesFailed"),"error")}finally{o&&(o.disabled=!1,o.innerHTML=r)}}function ZD(t,e=null){let n=lf(t,e);if(!n.hasDate)return{text:g("tasks.noEndDate"),class:"",showPrefix:!1};let s;switch(n.urgency){case"overdue":s=n.daysOverdue===1?g("tasks.due.yesterday"):g("tasks.due.daysOverdue",{count:n.daysOverdue});break;case"tomorrow":s=g("tasks.due.tomorrow");break;default:s=xe(t)}return{text:s,class:n.class,showPrefix:n.showPrefix}}function QD(t){let e=document.getElementById("tasks-list-mobile");if(!e)return;let n=new Set(Array.from(e.querySelectorAll(".task-card-mobile.expanded")).map(o=>parseInt(o.dataset.taskId,10)).filter(Number.isFinite)),s=o=>{let r=document.createElement("div");r.innerHTML=o||"";let a=Array.from(r.querySelectorAll('ul[data-type="taskList"] > li[data-checked]')),i=Array.from(r.querySelectorAll(".cb-item")),l=Array.from(r.querySelectorAll(".checkbox-row")),c=[];a.forEach(p=>{let f=p.getAttribute("data-checked")==="true",h=(p.textContent||"").replace(/\s+/g," ").trim();h&&c.push(`${f?"\u2713":"\u2610"} ${h}`)}),i.forEach(p=>{let f=p.getAttribute("data-checked")==="true",h=(p.textContent||"").trim();h&&c.push(`${f?"\u2713":"\u2610"} ${h}`)}),l.forEach(p=>{let f=p.querySelector(".checkbox-toggle"),h=f?.getAttribute("aria-pressed")==="true"||f?.classList?.contains("checked"),m=(p.querySelector(".check-text")?.textContent||"").trim();m&&c.push(`${h?"\u2713":"\u2610"} ${m}`)}),Array.from(r.querySelectorAll('ul[data-type="taskList"]')).forEach(p=>p.remove()),i.forEach(p=>p.remove()),l.forEach(p=>p.remove());let d=(r.textContent||r.innerText||"").replace(/\s+/g," ").trim(),u=c.join(`
`).trim();return d&&u?`${d}
${u}`:d||u};if(t.length===0){e.innerHTML=`
            <div class="tasks-list-mobile-empty">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
                <h3>${g("projects.details.noTasksFound")}</h3>
                <p>Try adjusting your filters or create a new task</p>
            </div>
        `;return}e.innerHTML=t.map(o=>{let r=B.find(p=>p.id===o.projectId),a=r?Ke(r.id):"#999",i=ZD(o.endDate,o.status),l=s(o.description),c=o.tags&&o.tags.length>0?o.tags.map(p=>{let f=sn(p);return`<span class="card-tag-premium" style="background:${f}; border-color:${f}; color:#ffffff;">${V(p.toUpperCase())}</span>`}).join(""):"",d=o.attachments&&o.attachments.length>0?o.attachments.length:0;return`
            <div class="task-card-mobile${o.status==="done"?" is-done":""}" data-priority="${o.priority}" data-task-id="${o.id}">
                <!-- Header (always visible) -->
                <div class="card-header-premium">
                    <div class="card-header-content" data-card-action="toggle">
                        <h3 class="card-title-premium">${V(o.title||g("tasks.untitled"))}</h3>
                        <div class="card-meta-premium">
                            <span class="status-badge-mobile ${o.status}">${pt(o.status)}</span>
                            ${i.text?`<span class="card-date-smart ${i.class}">${i.showPrefix?g("tasks.endDatePrefix"):""}${i.text}</span>`:""}
                        </div>
                    </div>
                    <div class="card-actions-premium">
                        <button class="card-open-btn-premium" data-card-action="open" title="${g("tasks.openTaskDetails")}">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </button>
                        <svg class="card-chevron-premium" data-card-action="toggle" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </div>

                <!-- Expandable body -->
                <div class="card-body-premium">
                    ${l?`
                    <div class="card-description-premium">
                        <div class="card-description-premium-label">${g("tasks.card.description")}</div>
                        <div class="card-description-premium-text">${V(l)}</div>
                    </div>
                    `:""}

                    ${c?`
                    <div class="card-tags-premium">${c}</div>
                    `:""}

                    ${r?`
                    <div class="card-project-premium">
                        <span class="card-project-dot-premium" style="background-color: ${a};"></span>
                        <span class="card-project-name-premium">${V(r.name)}</span>
                    </div>
                    `:""}

                    <div class="card-footer-premium">
                        ${o.startDate?`
                        <div class="card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${g("tasks.startDatePrefix")}${xe(o.startDate)}</span>
                        </div>
                        `:""}
                        ${o.endDate?`
                        <div class="card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${g("tasks.endDatePrefix")}${xe(o.endDate)}</span>
                        </div>
                        `:""}
                        ${d>0?`
                        <div class="card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                            </svg>
                            <span>${d}</span>
                        </div>
                        `:""}
                    </div>
                </div>
            </div>
        `}).join(""),eI(),n.size>0&&n.forEach(o=>{let r=e.querySelector(`.task-card-mobile[data-task-id="${o}"]`);r&&r.classList.add("expanded")})}function eI(){document.querySelectorAll(".task-card-mobile").forEach(e=>{let n=parseInt(e.dataset.taskId),s=e.querySelectorAll('[data-card-action="toggle"]'),o=e.querySelector('[data-card-action="open"]');s.forEach(r=>{r.addEventListener("click",a=>{a.stopPropagation(),document.querySelectorAll(".task-card-mobile.expanded").forEach(i=>{i!==e&&i.classList.remove("expanded")}),e.classList.toggle("expanded")})}),o&&o.addEventListener("click",r=>{r.stopPropagation(),ao(n)})})}document.addEventListener("click",function(t){t.target.closest(".multi-select-wrapper")||document.querySelectorAll(".multi-select.active").forEach(e=>e.classList.remove("active"))});function np(t){return mf(t,A,{escapeHtml:V,formatDatePretty:wa,getProjectColor:Ke,getProjectStatus:An,getProjectStatusLabel:da,getTagColor:sn,getPriorityLabel:At,getStatusLabel:pt,getLocale:Qn,t:g})}var il=null;function tI(t=document){(t.querySelectorAll?.(".expanded-task-item")||[]).forEach(n=>{if(n.offsetParent===null)return;n.classList.remove("expanded-task-item--stacked");let s=n.querySelector(".expanded-task-meta");if(!s)return;let o=s.querySelector(".task-tags"),r=s.querySelector(".expanded-task-dates"),a=l=>l&&l.clientWidth>0&&l.scrollWidth>l.clientWidth+1;(a(n)||a(s)||a(o)||a(r))&&n.classList.add("expanded-task-item--stacked")})}function Nl(t=document){il!==null&&cancelAnimationFrame(il),il=requestAnimationFrame(()=>{il=null,tI(t)})}function Mt(){let t=Fe("render","projects",{projectCount:B.length}),e=document.getElementById("projects-list");if(B.length===0){e.innerHTML=`<div class="empty-state"><h3>${g("projects.empty.title")}</h3><p>${g("projects.empty.subtitle")}</p></div>`;let o=document.getElementById("projects-list-mobile");o&&(o.innerHTML=""),Oe("render",t,{projectCount:B.length,rendered:0});return}let n=new Set;e.querySelectorAll(".project-list-item.expanded").forEach(o=>{let r=o.id.replace("project-item-","");n.add(r)});let s=de.projectsSortedView||B;e.innerHTML=s.map(np).join(""),n.forEach(o=>{let r=document.getElementById(`project-item-${o}`);r&&r.classList.add("expanded")}),bl(s),Nl(e),Oe("render",t,{projectCount:B.length,rendered:s.length})}function eb(t){let e=document.getElementById(`project-item-${t}`);e&&(e.classList.toggle("expanded"),Nl(e))}window.toggleProjectExpand=eb;function bl(t){let e=document.getElementById("projects-list-mobile");if(e){if(t.length===0){e.innerHTML=`
            <div class="projects-list-mobile-empty">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                </svg>
                <h3>${g("projects.empty.searchTitle")}</h3>
                <p>${g("projects.empty.searchSubtitle")}</p>
            </div>
        `;return}e.innerHTML=t.map(n=>{let s=A.filter(f=>f.projectId===n.id),o=s.filter(f=>f.status==="done").length,r=s.filter(f=>f.status==="progress").length,a=s.filter(f=>f.status==="review").length,i=s.filter(f=>f.status==="todo").length,l=s.filter(f=>f.status==="backlog").length,c=s.length,d=c>0?Math.round(o/c*100):0,u=Ke(n.id),p=An(n.id);return`
            <div class="project-card-mobile" data-project-id="${n.id}">
                <!-- Header (always visible) -->
                <div class="project-card-header-premium">
                    <div class="project-card-header-content" data-card-action="toggle">
                        <div class="project-card-title-row">
                            <span class="project-swatch-mobile" style="background: ${u};"></span>
                            <h3 class="project-card-title-premium">${V(n.name||"Untitled Project")}</h3>
                        </div>
                        <div class="project-card-meta-premium">
                            <span class="project-status-badge-mobile ${p}">${da(p)}</span>
                            <span class="project-card-tasks-count">${g("projects.card.tasksCount",{count:c})}</span>
                            ${d>0?`<span class="project-card-completion">${g("projects.card.percentDone",{count:d})}</span>`:""}
                        </div>
                    </div>
                    <div class="project-card-actions-premium">
                        <button class="project-card-open-btn-premium" data-action="showProjectDetails" data-param="${n.id}" title="${g("projects.openDetailsTitle")}">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </button>
                        <svg class="project-card-chevron-premium" data-card-action="toggle" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </div>

                <!-- Expandable body -->
                <div class="project-card-body-premium">
                    ${n.tags&&n.tags.length>0?`
                    <div class="project-card-tags-premium" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px;">
                        ${n.tags.map(f=>`<span style="background-color: ${Ke(n.id)}; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: 500;">${V(f.toUpperCase())}</span>`).join("")}
                    </div>
                    `:""}

                    ${n.description?`
                    <div class="project-card-description-premium">
                        <div class="project-card-description-label">${g("tasks.card.description")}</div>
                        <div class="project-card-description-text">${V(n.description)}</div>
                    </div>
                    `:""}

                    <div class="project-card-footer-premium">
                        ${n.startDate?`
                        <div class="project-card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${g("projects.details.startDate")}: ${xe(n.startDate)}</span>
                        </div>
                        `:""}
                        ${n.endDate?`
                        <div class="project-card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${g("tasks.endDatePrefix")}${xe(n.endDate)}</span>
                        </div>
                        `:""}
                    </div>

                    ${c>0?`
                    <div class="project-card-progress-premium">
                        <div class="project-card-progress-label">${g("projects.details.taskProgress")}</div>
                        <div class="project-card-progress-bar">
                            <div class="progress-segment done" style="width: ${o/c*100}%;"></div>
                            <div class="progress-segment progress" style="width: ${r/c*100}%;"></div>
                            <div class="progress-segment review" style="width: ${a/c*100}%;"></div>
                            <div class="progress-segment todo" style="width: ${i/c*100}%;"></div>
                            <div class="progress-segment backlog" style="width: ${l/c*100}%;"></div>
                        </div>
                        <div class="project-card-breakdown">
                            ${o>0?`<span class="breakdown-item done">${o} ${g("tasks.status.done")}</span>`:""}
                            ${r>0?`<span class="breakdown-item progress">${r} ${g("tasks.status.progress")}</span>`:""}
                            ${a>0?`<span class="breakdown-item review">${a} ${g("tasks.status.review")}</span>`:""}
                            ${i>0?`<span class="breakdown-item todo">${i} ${g("tasks.status.todo")}</span>`:""}
                            ${l>0?`<span class="breakdown-item backlog">${l} ${g("tasks.status.backlog")}</span>`:""}
                        </div>
                    </div>
                    `:""}
                </div>
            </div>
        `}).join(""),nI()}}function nI(){document.querySelectorAll(".project-card-mobile").forEach(e=>{let n=parseInt(e.dataset.projectId),s=e.querySelectorAll('[data-card-action="toggle"]'),o=e.querySelector('[data-action="showProjectDetails"]');s.forEach(r=>{r.addEventListener("click",a=>{a.stopPropagation(),document.querySelectorAll(".project-card-mobile.expanded").forEach(i=>{i!==e&&i.classList.remove("expanded")}),e.classList.toggle("expanded")})}),o&&o.addEventListener("click",r=>{r.stopPropagation(),Qe(n)})})}function ft(){let t=Fe("render","tasks",{taskCount:A.length}),e=typeof ln=="function"?ln():A.slice(),n=Is(window.kanbanUpdatedFilter),s=of(e,{showBacklog:window.kanbanShowBacklog===!0,sortMode:wt,manualTaskOrder:Me,updatedCutoff:n,getTaskUpdatedTime:Ln}),o=s.byStatus,r=s.totalFiltered,a={backlog:document.getElementById("backlog-tasks"),todo:document.getElementById("todo-tasks"),progress:document.getElementById("progress-tasks"),review:document.getElementById("review-tasks"),done:document.getElementById("done-tasks")},i=s.counts,l=document.getElementById("backlog-count"),c=document.getElementById("todo-count"),d=document.getElementById("progress-count"),u=document.getElementById("review-count"),p=document.getElementById("done-count");l&&(l.textContent=i.backlog),c&&(c.textContent=i.todo),d&&(d.textContent=i.progress),u&&(u.textContent=i.review),p&&(p.textContent=i.done);let f={escapeHtml:V,formatDate:xe,getProjectColor:Ke,getTagColor:sn,getPriorityLabel:At,projects:B,selectedCards:de.selectedCards,showProjects:window.kanbanShowProjects!==!1,showNoDate:window.kanbanShowNoDate!==!1,noProjectText:g("tasks.noProject"),noDateText:g("tasks.noDate")};["backlog","todo","progress","review","done"].forEach(h=>{let m=a[h];m&&(m.innerHTML=rf(o[h],f))}),aI(),Jn(),SC(),Oe("render",t,{taskCount:A.length,filteredCount:e.length,kanbanCount:r})}function _o(){if(window.innerWidth>768)return;let t=document.getElementById("task-modal");if(!t)return;let n=t.querySelector("#task-form")?.dataset.editingTaskId;if(!n)return;let s=t.dataset.initialStartDate==="true",o=t.dataset.initialEndDate==="true",r=null;n&&(r=A.find(k=>k.id===parseInt(n,10))),r||(r={tags:window.tempTags||[],attachments:et||[]});let a=gf(r,{startDateWasEverSet:s,endDateWasEverSet:o}),i=t.querySelector("#tag-input"),l=i?i.closest(".form-group"):null,c=t.querySelectorAll('input[name="startDate"]'),d=null;for(let k of c){let S=k.closest(".form-group");if(S){d=S;break}}let u=t.querySelectorAll('input[name="endDate"]'),p=null;for(let k of u){let S=k.closest(".form-group");if(S){p=S;break}}let f=t.querySelector("#attachments-links-list"),h=f?f.closest(".form-group"):null;l&&(l.classList.toggle("mobile-general-field",a.tagsInGeneral),l.classList.toggle("mobile-details-field",!a.tagsInGeneral)),d&&(d.classList.toggle("mobile-general-field",a.startDateInGeneral),d.classList.toggle("mobile-details-field",!a.startDateInGeneral)),p&&(p.classList.toggle("mobile-general-field",a.endDateInGeneral),p.classList.toggle("mobile-details-field",!a.endDateInGeneral)),h&&(h.classList.toggle("mobile-general-field",a.linksInGeneral),h.classList.toggle("mobile-details-field",!a.linksInGeneral));let m=t.querySelector('.modal-tab[data-tab="details"]'),y=yf(a);console.log("\u{1F504} Reorganizing fields:",{...a,hideDetailsTab:y}),m&&(y?(console.log("\u2705 Hiding Details tab - Tags and Links both filled"),m.classList.add("hide-details-tab")):(console.log("\u{1F441}\uFE0F Showing Details tab - some dynamic fields empty"),m.classList.remove("hide-details-tab")))}var Es=null;function ao(t,e=null){let n=A.find(F=>F.id===t);if(!n)return;let s=document.getElementById("task-modal");if(!s)return;Es=e;let o=s.querySelector('.modal-tab[data-tab="general"]'),r=s.querySelector('.modal-tab[data-tab="details"]'),a=s.querySelector('.modal-tab[data-tab="history"]'),i=s.querySelector("#task-details-tab"),l=s.querySelector("#task-history-tab");o&&o.classList.add("active"),r&&r.classList.remove("active"),a&&a.classList.remove("active"),i&&i.classList.add("active"),l&&l.classList.remove("active"),document.body.classList.remove("mobile-tab-details-active"),a&&(a.style.display="");let c=s.querySelector(".modal-content");c&&(c.style.minHeight="",c.style.maxHeight="");let d=s.querySelector("h2");d&&(d.textContent="Edit Task");let u=s.querySelector(".modal-close");u&&(u.style.display="inline-block");let p=s.querySelector("#task-options-btn");p&&(p.style.display="inline-block");let f=s.querySelector("#task-footer");f&&(f.style.display="none"),sb();let h=s.querySelector("#hidden-project"),m=s.querySelector("#project-current");if(h&&m){h.value=n.projectId||"";let F=m.querySelector(".project-text");if(F)if(n.projectId){let C=B.find(N=>N.id===n.projectId);if(C){let N=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Ke(C.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;F.innerHTML=N+V(C.name)}else F.textContent=g("tasks.project.selectPlaceholder")}else F.textContent=g("tasks.project.selectPlaceholder");Ol(n.projectId||"")}let y=s.querySelector('#task-form input[name="title"]');y&&(y.value=n.title||""),ku(n.description||"");let k=s.querySelector("#task-description-hidden");k&&(k.value=Lo());let S=s.querySelector("#hidden-priority");S&&(S.value=n.priority||"medium");let T=s.querySelector("#priority-current");if(T){let F=n.priority||"medium",C=At(F).toUpperCase();T.innerHTML=`<span class="priority-pill priority-${F}">${C}</span> <span class="dropdown-arrow">\u25BC</span>`,vl(F)}let D=s.querySelector("#hidden-status");D&&(D.value=n.status||"todo");let E=s.querySelector("#status-current");if(E){let F=E.querySelector(".status-badge");F&&(F.className="status-badge "+(n.status||"todo"),F.textContent=pt(n.status||"todo")),Hu(n.status||"todo")}let b="";typeof n.startDate=="string"&&(Vt(n.startDate)?b=n.startDate:$t(n.startDate)&&(b=un(n.startDate)));let w="";typeof n.endDate=="string"&&(Vt(n.endDate)?w=n.endDate:$t(n.endDate)&&(w=un(n.endDate)));let I=s.querySelector('#task-form input[name="startDate"]'),M=s.querySelector('#task-form input[name="endDate"]'),z=I?I.parentElement:null,_=M?M.parentElement:null,x=z&&z.classList.contains("date-input-wrapper")?z.querySelector("input.date-display"):null,j=_&&_.classList.contains("date-input-wrapper")?_.querySelector("input.date-display"):null,U=x&&x._flatpickr,W=j&&j._flatpickr;U&&W?(x&&x._flatpickr&&(I.value=b||"",b?x._flatpickr.setDate(new Date(b),!1):x._flatpickr.clear()),j&&j._flatpickr&&(M.value=w||"",w?j._flatpickr.setDate(new Date(w),!1):j._flatpickr.clear())):s.querySelectorAll('input[name="startDate"], input[name="endDate"]').forEach(C=>{C._flatpickrInstance&&(C._flatpickrInstance.destroy(),C._flatpickrInstance=null),C._wrapped=!1;let N=C.closest(".date-input-wrapper");N&&(N.parentNode.insertBefore(C,N),N.remove()),C.type="date",C.style.display=""});let Z=s.querySelector("#task-form");if(Z&&(Z.dataset.editingTaskId=String(t)),Ts(n.attachments||[]),Wo(n.tags||[]),$e()&&t){let F=Array.isArray(n.tags)&&n.tags.length>0,C=typeof n.startDate=="string"&&n.startDate.trim()!=="",N=typeof n.endDate=="string"&&n.endDate.trim()!=="",L=Array.isArray(n.attachments)&&n.attachments.some(je=>je.type==="link"||je.url&&je.type!=="file"),P=!!n.startDateWasEverSet||C,J=!!n.endDateWasEverSet||N;s.dataset.initialStartDate=P?"true":"false",s.dataset.initialEndDate=J?"true":"false";let ne=s.querySelector("#tag-input"),se=ne?ne.closest(".form-group"):null,le=s.querySelectorAll('input[name="startDate"]'),G=null;for(let je of le){let Ce=je.closest(".form-group");if(Ce&&Ce.classList.contains("mobile-details-field")){G=Ce;break}}let ge=s.querySelectorAll('input[name="endDate"]'),H=null;for(let je of ge){let Ce=je.closest(".form-group");if(Ce&&Ce.classList.contains("mobile-details-field")){H=Ce;break}}let me=s.querySelector("#attachments-links-list"),Te=me?me.closest(".form-group"):null;se&&(F?(se.classList.remove("mobile-details-field"),se.classList.add("mobile-general-field")):(se.classList.remove("mobile-general-field"),se.classList.add("mobile-details-field"))),G&&(P?(G.classList.remove("mobile-details-field"),G.classList.add("mobile-general-field")):(G.classList.remove("mobile-general-field"),G.classList.add("mobile-details-field"))),H&&(J?(H.classList.remove("mobile-details-field"),H.classList.add("mobile-general-field")):(H.classList.remove("mobile-general-field"),H.classList.add("mobile-details-field"))),Te&&(L?(Te.classList.remove("mobile-details-field"),Te.classList.add("mobile-general-field")):(Te.classList.remove("mobile-general-field"),Te.classList.add("mobile-details-field")));let Ie=F&&L;console.log("\u{1F50D} Details Tab Logic:",{hasTags:F,hasStartDate:C,hasEndDate:N,hasLinks:L,allDetailsFilled:Ie,tags:n.tags,startDate:n.startDate,endDate:n.endDate,attachments:n.attachments}),r&&(Ie?(console.log("\u2705 Hiding Details tab - all fields filled"),r.classList.add("hide-details-tab")):(console.log("\u{1F441}\uFE0F Showing Details tab - some fields empty"),r.classList.remove("hide-details-tab")))}s.classList.add("active"),lI(),setTimeout(()=>{if((!U||!W)&&(I&&(I.value=b||""),M&&(M.value=w||""),Xn()),I){let F=I.parentElement;if(F&&F.classList.contains("date-input-wrapper")){let C=F.querySelector("input.date-display");C&&(I.value=b||"",C._flatpickr&&(b?C._flatpickr.setDate(new Date(b),!1):C._flatpickr.clear()))}}if(M){let F=M.parentElement;if(F&&F.classList.contains("date-input-wrapper")){let C=F.querySelector("input.date-display");C&&(M.value=w||"",C._flatpickr&&(w?C._flatpickr.setDate(new Date(w),!1):C._flatpickr.clear()))}}},0),setTimeout(()=>{s.querySelectorAll('input[name="startDate"], input[name="endDate"]').forEach(C=>{C.removeEventListener("change",_o),C.addEventListener("change",_o)})},50),setTimeout(()=>{let F=s.querySelector(".modal-body");F&&(F.scrollTop=0)},0)}function sI(){let t=document.getElementById("task-form").dataset.editingTaskId;if(!t||!A.find(o=>o.id===parseInt(t)))return;document.getElementById("confirm-modal").classList.add("active");let n=document.getElementById("confirm-input");n.value="",n.focus();let s=function(o){let r=o.target.selectionStart,a=o.target.selectionEnd;o.target.value=o.target.value.toLowerCase(),o.target.setSelectionRange(r,a)};n.addEventListener("input",s),document.addEventListener("keydown",function(o){let r=document.getElementById("confirm-modal");!r||!r.classList.contains("active")||(o.key==="Escape"?(o.preventDefault(),sp()):o.key==="Enter"&&(o.preventDefault(),tb()))})}async function oI(){let e=document.getElementById("task-form")?.dataset.editingTaskId;if(!e)return;let n=Rp(parseInt(e,10),A,St);if(!n.task)return;A=n.tasks,St=n.taskCounter;let s=n.task;s&&s.projectId&&(Zs(s.projectId),Qs(s.projectId,"added",s),Rt().catch(()=>{}));let o=document.getElementById("options-menu");o&&(o.style.display="none"),fa(),Go(),io();let r=document.getElementById("project-details").classList.contains("active"),a=document.getElementById("calendar-view")?.classList.contains("active");r&&s.projectId&&Qe(s.projectId),kl({calendarChanged:!0,calendarImmediate:!!a}),a&&ye(),Ct(),ot().catch(i=>{console.error("Failed to save duplicated task:",i),Y(g("error.saveTaskFailed"))}),ao(s.id)}function sp(){document.getElementById("confirm-modal").classList.remove("active"),document.getElementById("confirm-error").classList.remove("show")}function rI(){let t=document.getElementById("status-info-modal");t&&t.classList.add("active")}async function tb(){let t=document.getElementById("confirm-input"),e=document.getElementById("confirm-error");if(t.value==="delete"){let s=document.getElementById("task-form").dataset.editingTaskId,o=Op(parseInt(s,10),A);if(!o.task)return;window.historyService&&window.historyService.recordTaskDeleted(o.task);let r=o.task&&o.projectId&&document.getElementById("project-details").classList.contains("active"),a=o.projectId;A=o.tasks,a&&(Zs(a),Qs(a,"removed",o.task),Rt().catch(()=>{})),sp(),Bt("task-modal"),fa(),Go(),io(),r&&a?Qe(a):so();let i=document.getElementById("calendar-view");i&&(ye(),i.classList.contains("active")&&ye()),Ct(),ot().catch(l=>{console.error("Failed to save task deletion:",l),Y(g("error.saveChangesFailed"))})}else e.classList.add("show"),t.focus()}function aI(){let t=[],e=null,n=!0,s=null,o=null,r=80,a=20;function i(h){let m=h;for(;m&&m!==document.body;){let k=getComputedStyle(m).overflowY;if((k==="auto"||k==="scroll"||k==="overlay")&&m.scrollHeight>m.clientHeight)return m;m=m.parentElement}return window}function l(h,m){c(),o=setInterval(()=>{try{m===window?window.scrollBy({top:h==="down"?a:-a,left:0}):m.scrollTop+=h==="down"?a:-a}catch{}},50)}function c(){o&&(clearInterval(o),o=null)}function d(){document.querySelectorAll(".kanban-column").forEach(h=>{h.style.backgroundColor="",h.style.border="",h.classList.remove("drag-over")}),document.querySelectorAll(".task-card").forEach(h=>{h.classList.remove("dragging","drag-over-top","drag-over-bottom"),h.style.opacity=""})}let u=document.querySelector(".kanban-board");if(!u||u.dataset.dragDelegation==="1")return;u.dataset.dragDelegation="1";let p=h=>{let y=h?.querySelector('[id$="-tasks"]')?.id||"";return y?y.replace("-tasks",""):null};u.addEventListener("dragstart",h=>{let m=h.target.closest(".task-card");if(!m||!u.contains(m))return;let y=parseInt(m.dataset.taskId,10);if(Number.isNaN(y))return;let k=A.find(T=>T.id===y);e=k?k.status:null,de.selectedCards.has(y)?t=Array.from(de.selectedCards):t=[y],n=t.length===1,m.classList.add("dragging"),m.style.opacity="0.5",s=document.createElement("div"),s.className="drag-placeholder active",s.setAttribute("aria-hidden","true");let S=m.offsetHeight;s.style.height=S+"px",s.style.margin="8px 0",s.style.opacity="1",document.querySelectorAll(".kanban-column").forEach(T=>{T.style.backgroundColor="var(--bg-tertiary)",T.style.border="2px dashed var(--accent-blue)"}),h.dataTransfer.effectAllowed="move";try{h.dataTransfer.setData("text/plain",String(y))}catch{}}),u.addEventListener("dragend",h=>{t=[],e=null,n=!0;try{s&&s.parentNode&&s.parentNode.removeChild(s)}catch{}s=null,d(),c()}),u.addEventListener("click",h=>{let m=h.target.closest(".task-card");if(!m||!u.contains(m))return;let y=parseInt(m.dataset.taskId,10);if(isNaN(y))return;let k=h.ctrlKey||h.metaKey;if(h.shiftKey){h.preventDefault(),h.stopPropagation();let D=m.closest(".kanban-column")||document,E=Array.from(D.querySelectorAll(".task-card")),b=null;Number.isInteger(de.lastSelectedCardId)&&(b=E.find(_=>parseInt(_.dataset.taskId,10)===de.lastSelectedCardId)),b||(b=E.find(_=>de.selectedCards.has(parseInt(_.dataset.taskId,10)))||m);let w=E.indexOf(b),I=E.indexOf(m);if(k||Su(),w===-1||I===-1){m.classList.add("selected"),de.selectedCards.add(y),de.lastSelectedCardId=y;return}let M=Math.min(w,I),z=Math.max(w,I);for(let _=M;_<=z;_++){let x=E[_],j=parseInt(x.dataset.taskId,10);isNaN(j)||(x.classList.add("selected"),de.selectedCards.add(j))}de.lastSelectedCardId=y;return}if(k){h.preventDefault(),h.stopPropagation(),m.classList.toggle("selected"),m.classList.contains("selected")?de.selectedCards.add(y):de.selectedCards.delete(y),de.lastSelectedCardId=y;return}ao(y)}),document.querySelectorAll(".kanban-column").forEach(h=>{h.addEventListener("dragover",m=>{if(m.preventDefault(),h.classList.add("drag-over"),h.style.backgroundColor="var(--hover-bg)",!s)return;let y=h.querySelector('[id$="-tasks"]');if(!y||!p(h))return;let S=Array.from(y.querySelectorAll(".task-card:not(.dragging)")),T=m.clientY;if(s.parentNode&&s.remove(),S.length===0)y.appendChild(s);else{let D=null;for(let E of S){let b=E.getBoundingClientRect(),w=b.top+b.height/2;if(T<w){D=E;break}}D?y.insertBefore(s,D):y.appendChild(s)}try{let D=i(h),E=m.clientY,b=E,w=window.innerHeight-E;b<r?l("up",D):w<r?l("down",D):c()}catch{c()}}),h.addEventListener("dragleave",m=>{h.contains(m.relatedTarget)||(h.classList.remove("drag-over"),h.style.backgroundColor="var(--bg-tertiary)")}),h.addEventListener("drop",async m=>{if(m.preventDefault(),d(),t.length===0)return;let y=p(h);if(!y)return;let k=h.querySelector('[id$="-tasks"]');if(k)if(n){wt!=="manual"&&(wt="manual",["backlog","todo","progress","review","done"].forEach(b=>{Me[b]=A.filter(w=>w.status===b).slice().sort((w,I)=>(ke[I.priority]||0)-(ke[w.priority]||0)).map(w=>w.id)}),Jn(),Kr()),Object.keys(Me).forEach(b=>{Array.isArray(Me[b])&&(Me[b]=Me[b].filter(w=>!t.includes(w)))});let S=A.filter(b=>b.status===y&&!t.includes(b.id)),T;if(Array.isArray(Me[y])&&Me[y].length){let b=new Set(S.map(I=>I.id));T=Me[y].filter(I=>b.has(I));let w=S.filter(I=>!T.includes(I.id)).slice().sort((I,M)=>(ke[M.priority]||0)-(ke[I.priority]||0)).map(I=>I.id);T=T.concat(w)}else T=S.slice().sort((b,w)=>(ke[w.priority]||0)-(ke[b.priority]||0)).map(b=>b.id);let D=T.length;if(s&&s.parentNode===k){let b=Array.from(k.querySelectorAll(".task-card:not(.dragging)")),w=-1,I=Array.from(k.children);for(let M=0;M<I.length;M++)if(I[M]===s){w=M;break}if(w!==-1){let M=0;for(let z=0;z<w;z++)I[z].classList&&I[z].classList.contains("task-card")&&M++;D=M}}T.splice(D,0,...t),Me[y]=T,t.forEach(b=>{let w=A.find(I=>I.id===b);if(w&&w.status!==y){let M=JSON.parse(JSON.stringify(w));if(w.status=y,w.updatedAt=new Date().toISOString(),R.autoSetStartDateOnStatusChange||R.autoSetEndDateOnStatusChange){let z=new Date().toISOString().split("T")[0];R.autoSetStartDateOnStatusChange&&y==="progress"&&!w.startDate&&(w.startDate=z),R.autoSetEndDateOnStatusChange&&y==="done"&&!w.endDate&&(w.endDate=z)}y==="done"&&!w.completedDate&&(w.completedDate=new Date().toISOString()),window.historyService&&window.historyService.recordTaskUpdated(M,w)}}),Kr(),Su(),so(),d(),document.getElementById("calendar-view")&&ye();try{s&&s.parentNode&&s.parentNode.removeChild(s)}catch{}s=null,c(),ot().catch(b=>{console.error("Failed to save drag-and-drop changes:",b),Y(g("error.saveTaskPositionFailed"))})}else{wt!=="manual"&&(wt="manual",["backlog","todo","progress","review","done"].forEach(b=>{Me[b]=A.filter(w=>w.status===b).slice().sort((w,I)=>(ke[I.priority]||0)-(ke[w.priority]||0)).map(w=>w.id)}),Jn(),Kr()),Object.keys(Me).forEach(b=>{Array.isArray(Me[b])&&(Me[b]=Me[b].filter(w=>!t.includes(w)))});let S=A.filter(b=>b.status===y&&!t.includes(b.id)),T;if(Array.isArray(Me[y])&&Me[y].length){let b=new Set(S.map(I=>I.id));T=Me[y].filter(I=>b.has(I));let w=S.filter(I=>!T.includes(I.id)).slice().sort((I,M)=>(ke[M.priority]||0)-(ke[I.priority]||0)).map(I=>I.id);T=T.concat(w)}else T=S.slice().sort((b,w)=>(ke[w.priority]||0)-(ke[b.priority]||0)).map(b=>b.id);let D=T.length;if(s&&s.parentNode===k){let b=Array.from(k.children),w=b.indexOf(s);if(w!==-1){let I=0;for(let M=0;M<w;M++)b[M].classList&&b[M].classList.contains("task-card")&&I++;D=I}}T.splice(D,0,...t),Me[y]=T,t.forEach(b=>{let w=A.find(I=>I.id===b);if(w&&w.status!==y){let M=JSON.parse(JSON.stringify(w));if(w.status=y,w.updatedAt=new Date().toISOString(),R.autoSetStartDateOnStatusChange||R.autoSetEndDateOnStatusChange){let z=new Date().toISOString().split("T")[0];R.autoSetStartDateOnStatusChange&&y==="progress"&&!w.startDate&&(w.startDate=z),R.autoSetEndDateOnStatusChange&&y==="done"&&!w.endDate&&(w.endDate=z)}y==="done"&&!w.completedDate&&(w.completedDate=new Date().toISOString()),window.historyService&&window.historyService.recordTaskUpdated(M,w)}}),Kr(),Su(),so(),d(),document.getElementById("calendar-view")&&ye();try{s&&s.parentNode&&s.parentNode.removeChild(s)}catch{}s=null,c(),ot().catch(b=>{console.error("Failed to save drag-and-drop changes:",b),Y(g("error.saveTaskPositionFailed"))})}})}),document.addEventListener("dragend",()=>c())}function iI(){let t=document.getElementById("project-modal");window.tempProjectTags=[],la([]),document.getElementById("project-form").dataset.editingProjectId="",t.classList.add("active"),setTimeout(()=>{document.querySelector('#project-form input[name="startDate"]').value="",document.querySelectorAll('#project-modal input[type="date"]').forEach(n=>{n._flatpickrInstance&&(n._flatpickrInstance.destroy(),n._flatpickrInstance=null,n._wrapped=!1)}),Xn()},150),setTimeout(()=>{let e=t.querySelector(".modal-body");e&&(e.scrollTop=0)},0)}function lI(){let t=document.getElementById("task-nav-prev"),e=document.getElementById("task-nav-next");if(!t||!e)return;if(!Es){t.style.display="none",e.style.display="none";return}let{taskIds:n,currentIndex:s}=Es;t.style.display="flex",e.style.display="flex",t.disabled=s<=0,e.disabled=s>=n.length-1}function nb(t){if(!Es)return;let{taskIds:e,currentIndex:n,projectId:s}=Es,o=t==="next"?n+1:n-1;if(o<0||o>=e.length)return;let r=e[o];ao(r,{projectId:s,taskIds:e,currentIndex:o})}function dk(){nb("prev")}function uk(){nb("next")}window.taskNavigationInitialized||(window.taskNavigationInitialized=!0,document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("task-nav-prev"),e=document.getElementById("task-nav-next");t&&t.addEventListener("click",n=>{n.stopPropagation(),dk()}),e&&e.addEventListener("click",n=>{n.stopPropagation(),uk()}),document.addEventListener("keydown",n=>{let s=document.getElementById("task-modal");if(!s||!s.classList.contains("active")||!Es)return;let o=n.target;o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||(n.key==="ArrowLeft"&&!n.ctrlKey&&!n.metaKey&&!n.shiftKey&&!n.altKey&&(n.preventDefault(),dk()),n.key==="ArrowRight"&&!n.ctrlKey&&!n.metaKey&&!n.shiftKey&&!n.altKey&&(n.preventDefault(),uk()))})}));function Bl(){let t=document.getElementById("task-modal");if(!t)return;Es=null;let e=t.querySelector('.modal-tab[data-tab="general"]'),n=t.querySelector('.modal-tab[data-tab="details"]'),s=t.querySelector('.modal-tab[data-tab="history"]'),o=t.querySelector("#task-details-tab"),r=t.querySelector("#task-history-tab");e&&e.classList.add("active"),n&&n.classList.remove("active"),s&&s.classList.remove("active"),o&&o.classList.add("active"),r&&r.classList.remove("active"),document.body.classList.remove("mobile-tab-details-active"),s&&(s.style.display="none");let a=t.querySelector(".modal-content");a&&(a.style.minHeight="",a.style.maxHeight=""),setTimeout(()=>{t.querySelectorAll('input[name="startDate"], input[name="endDate"]').forEach(z=>{z._flatpickrInstance&&(z._flatpickrInstance.destroy(),z._flatpickrInstance=null),z._wrapped=!1;let _=z.closest(".date-input-wrapper");_&&(_.parentNode.insertBefore(z,_),_.remove()),z.type="date",z.style.display=""}),Xn()},150);let i=t.querySelector("h2");i&&(i.textContent="Create New Task");let l=t.querySelector(".modal-close");l&&(l.style.display="none");let c=t.querySelector("#task-options-btn");c&&(c.style.display="none");let d=t.querySelector("#task-footer");d&&(d.style.display="flex"),setTimeout(()=>{let M=t.querySelector(".modal-content"),z=t.querySelector(".modal-body"),_=t.querySelector(".modal-footer");if(M&&_){let x=M.getBoundingClientRect(),j=_.getBoundingClientRect(),U=window.getComputedStyle(M),W=window.getComputedStyle(_);console.log("=== MODAL DEBUG ==="),console.log("Viewport:",window.innerWidth,"x",window.innerHeight),console.log("Zoom:",window.devicePixelRatio*100+"%"),console.log(""),console.log("MODAL-CONTENT:"),console.log("  Position:",x.top.toFixed(1),"to",x.bottom.toFixed(1)),console.log("  Height:",x.height.toFixed(1),"/",U.height,"/",U.maxHeight),console.log("  Padding:",U.padding),console.log("  Display:",U.display),console.log("  Overflow:",U.overflow),console.log(""),console.log("MODAL-FOOTER:"),console.log("  Position:",j.top.toFixed(1),"to",j.bottom.toFixed(1)),console.log("  Height:",j.height.toFixed(1)),console.log("  Flex-shrink:",W.flexShrink),console.log("  Padding:",W.padding),console.log("");let Z=j.bottom-x.bottom;Z>1?console.error("\u274C FOOTER OVERFLOW:",Z.toFixed(1)+"px OUTSIDE modal-content"):console.log("\u2705 Footer is inside modal-content"),console.log("==================")}},100);let u=t.querySelector("#task-form");u&&(delete u.dataset.editingTaskId,u.reset()),Fy();let p=t.querySelector("#task-description-hidden");p&&(p.value=Lo());let f=t.querySelector("#hidden-project");f&&(f.value="");let h=t.querySelector("#project-current .project-text");h&&(h.textContent=g("tasks.project.selectPlaceholder")),Ol(""),typeof Zn=="function"&&Zn();let m=t.querySelector("#hidden-priority");m&&(m.value="medium");let y=t.querySelector("#priority-current");if(y){let M=At("medium").toUpperCase();y.innerHTML=`<span class="priority-pill priority-medium">${M}</span> <span class="dropdown-arrow">\u25BC</span>`,vl("medium")}let k=typeof ta=="function"?ta():null,S=document.querySelector(".kanban-board"),T=S&&!S.classList.contains("hidden"),D=k==="tasks"&&T&&window.kanbanShowBacklog!==!0?"todo":"backlog",E=t.querySelector("#hidden-status");E&&(E.value=D);let b=t.querySelector("#status-current");if(b){let M=b.querySelector(".status-badge");M&&(M.className="status-badge "+D,M.textContent=pt(D))}if(et=[],window.tempTags=[],v.tags.clear(),Ts([]),Wo([]),$e()){t.dataset.initialStartDate="false",t.dataset.initialEndDate="false";let M=t.querySelector(".form-group:has(#tag-input)"),z=t.querySelector('.form-group:has([name="startDate"])'),_=t.querySelector('.form-group:has([name="endDate"])'),x=t.querySelector(".form-group:has(#attachments-links-list)");M&&(M.classList.remove("mobile-general-field"),M.classList.add("mobile-details-field")),z&&(z.classList.remove("mobile-general-field"),z.classList.add("mobile-details-field")),_&&(_.classList.remove("mobile-general-field"),_.classList.add("mobile-details-field")),x&&(x.classList.remove("mobile-general-field"),x.classList.add("mobile-details-field")),n&&n.classList.remove("hide-details-tab")}let w=t.querySelector('#task-form input[name="startDate"]');if(w){let M=w._flatpickrInstance;M&&(M.clear(),M.jumpToDate(new Date)),w.value="";let z=w.parentElement?w.parentElement.querySelector("input.date-display"):null;z&&(z.value="")}let I=t.querySelector('#task-form input[name="endDate"]');if(I){let M=I._flatpickrInstance;M&&(M.clear(),M.jumpToDate(new Date)),I.value="";let z=I.parentElement?I.parentElement.querySelector("input.date-display"):null;z&&(z.value="")}t.classList.add("active"),setTimeout(()=>{let M=t.querySelector(".modal-body");M&&(M.scrollTop=0)},0),setTimeout(()=>{Xn(),Cb()},100)}function Bt(t){let e=document.getElementById(t);if(e){if(t==="settings-modal"&&window.settingsFormIsDirty){sa(t);return}if(t==="import-data-modal"){ep();return}if(t==="delete-account-modal"){Sl();return}if(e.classList.remove("active"),t==="settings-modal"&&(typeof qo=="function"&&qo(),typeof Ho=="function"&&Ho()),t==="task-modal")try{let n=e.querySelector(".modal-content");n&&(n.style.minHeight="")}catch{}t==="project-modal"&&document.getElementById("project-form").reset()}}function cI(){if(Tl&&Tl()){sa("task-modal");return}let t=document.getElementById("task-form");if(t&&t.dataset.editingTaskId&&cn("description",Lo()),t){t.reset(),delete t.dataset.editingTaskId;let e=document.querySelector("#status-current .status-badge");e&&(e.className="status-badge backlog",e.textContent=pt("backlog"));let n=document.getElementById("hidden-status");n&&(n.value="backlog");let s=document.querySelector("#priority-current");if(s){let r=At("medium").toUpperCase();s.innerHTML=`<span class="priority-pill priority-medium">${r}</span> <span class="dropdown-arrow">\u25BC</span>`}let o=document.getElementById("hidden-priority");o&&(o.value="medium")}qt=null,Es=null,Bt("task-modal")}document.getElementById("project-form").addEventListener("submit",function(t){t.preventDefault();let e=Fe("projects","submit",{projectCount:B.length,tagCount:(window.tempProjectTags||[]).length}),n=new FormData(t.target),s=window.tempProjectTags||[],o=$p({name:n.get("name"),description:n.get("description"),startDate:n.get("startDate"),endDate:n.get("endDate"),tags:s},B,Ot);B=o.projects,Ot=o.projectCounter;let r=o.project;window.historyService&&window.historyService.recordProjectCreated(r),Bt("project-modal"),t.target.reset(),window.tempProjectTags=[],de.projectsSortedView=null,window.location.hash="projects",Ze("projects"),so(),Rt().catch(a=>{console.error("Failed to save project:",a),Y(g("error.saveProjectFailed"))}),Oe("projects",e,{projectCount:B.length})});function dI(){let t=document.createElement("div");t.className="modal active",t.id="reset-pin-modal-temp",t.innerHTML=`
        <div class="modal-content reset-pin-modal-content">
            <div class="reset-pin-modal-inner">
                <div class="reset-pin-header">
                    <div>
                        <h2 class="reset-pin-title">Reset PIN</h2>
                        <p class="reset-pin-description">Verify your current PIN to set a new one</p>
                    </div>
                </div>
                
                <form id="reset-pin-form" class="reset-pin-form">
                    <div class="reset-pin-field">
                        <label class="reset-pin-label">Current PIN</label>
                        <input
                            type="password"
                            id="current-pin-input"
                            maxlength="4"
                            placeholder="\u2022\u2022\u2022\u2022"
                            class="reset-pin-input"
                            inputmode="numeric"
                            autocomplete="off"
                            required
                        />
                        <div id="current-pin-error" class="reset-pin-error" style="display: none;"></div>
                    </div>

                    <div class="reset-pin-actions">
                        <button type="button" class="reset-pin-btn reset-pin-btn-cancel" onclick="document.getElementById('reset-pin-modal-temp').remove()">
                            Cancel
                        </button>
                        <button type="submit" class="reset-pin-btn reset-pin-btn-primary">
                            Continue
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `,document.body.appendChild(t),document.getElementById("reset-pin-form").addEventListener("submit",function(e){e.preventDefault();let n=document.getElementById("current-pin-input").value.trim(),s=document.getElementById("current-pin-error");if(s.style.display="none",s.textContent="",!n||n.length!==4){s.textContent="PIN must be 4 digits",s.style.display="block";return}if(!/^\d{4}$/.test(n)){s.textContent="PIN must contain only digits",s.style.display="block";return}document.getElementById("reset-pin-modal-temp").remove(),uI(n)}),document.getElementById("current-pin-input").focus()}function uI(t){let e=document.createElement("div");e.className="modal active",e.id="new-pin-modal-temp",e.innerHTML=`
        <div class="modal-content reset-pin-modal-content">
            <div class="reset-pin-modal-inner">
                <div class="reset-pin-header">
                    <div>
                        <h2 class="reset-pin-title">Set New PIN</h2>
                        <p class="reset-pin-description">Create your new 4-digit PIN</p>
                    </div>
                </div>
                
                <form id="new-pin-form" class="reset-pin-form">
                    <div class="reset-pin-field">
                        <label class="reset-pin-label">New PIN</label>
                        <input 
                            type="password" 
                            id="new-pin-input" 
                            maxlength="4" 
                            placeholder="\u2022\u2022\u2022\u2022"
                            class="reset-pin-input"
                            inputmode="numeric"
                            autocomplete="off"
                            required
                        />
                    </div>
                    
                    <div class="reset-pin-field">
                        <label class="reset-pin-label">Confirm PIN</label>
                        <input
                            type="password"
                            id="confirm-pin-input"
                            maxlength="4"
                            placeholder="\u2022\u2022\u2022\u2022"
                            class="reset-pin-input"
                            inputmode="numeric"
                            autocomplete="off"
                            required
                        />
                        <div id="new-pin-error" class="reset-pin-error" style="display: none;"></div>
                    </div>

                    <div class="reset-pin-actions">
                        <button type="button" class="reset-pin-btn reset-pin-btn-cancel" onclick="document.getElementById('new-pin-modal-temp').remove()">
                            Cancel
                        </button>
                        <button type="submit" class="reset-pin-btn reset-pin-btn-primary">
                            Reset PIN
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `,document.body.appendChild(e),document.getElementById("new-pin-form").addEventListener("submit",function(n){n.preventDefault();let s=document.getElementById("new-pin-input").value.trim(),o=document.getElementById("confirm-pin-input").value.trim(),r=document.getElementById("new-pin-error");if(r.style.display="none",r.textContent="",!s||s.length!==4){r.textContent="New PIN must be 4 digits",r.style.display="block";return}if(!/^\d{4}$/.test(s)){r.textContent="PIN must contain only digits",r.style.display="block";return}if(s!==o){r.textContent="PINs do not match",r.style.display="block";return}pI(t,s)}),document.getElementById("new-pin-input").focus()}async function pI(t,e){try{let n=localStorage.getItem("authToken");if(!n){Y(g("error.notLoggedInResetPin"));return}let s=await fetch("/api/auth/change-pin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({currentPin:t,newPin:e})}),o=await s.json();if(!s.ok){Y(o.error||g("error.resetPinFailed"));return}let r=document.getElementById("new-pin-modal-temp");r&&r.remove(),Et(g("success.resetPin")),setTimeout(()=>{window.location.hash="",location.reload()},2e3)}catch(n){console.error("PIN reset error:",n),Y(g("error.resetPinError"))}}document.getElementById("settings-form").addEventListener("submit",async function(t){t.preventDefault();let e=this.querySelector(".settings-btn-save");if(e&&e.disabled&&!window.settingsFormIsDirty)return;let n=document.getElementById("user-name").value.trim();if(!n){Y(g("error.userNameEmpty"));return}try{let w=window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken");if(!w)throw new Error("Missing auth token");let I=await fetch("/api/auth/change-name",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},body:JSON.stringify({newName:n})}),M=await I.json().catch(()=>({}));if(!I.ok)throw new Error(M.error||"Failed to update display name");let z=window.authSystem?.getCurrentUser?.();z&&(z.name=M.name||n),lp(M.name||n,window.authSystem?.getCurrentUser?.()?.avatarDataUrl)}catch(w){console.error("Failed to save display name:",w),Y(g("error.saveDisplayNameFailed"));return}let s=document.getElementById("user-email"),o=String(s?.value||"").trim().toLowerCase();if(!o||!Kp(o)){Y(g("error.invalidEmail"));return}try{let w=window.authSystem?.getCurrentUser?.(),I=String(w?.email||"").trim().toLowerCase();if(o&&o!==I){let M=window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken");if(!M)throw new Error("Missing auth token");let z=await fetch("/api/auth/change-email",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${M}`},body:JSON.stringify({newEmail:o})}),_=await z.json().catch(()=>({}));if(!z.ok)throw new Error(_.error||"Failed to update email");w&&(w.email=_.email||o),document.querySelectorAll(".user-email").forEach(x=>{x&&(x.textContent=_.email||o)})}}catch(w){console.error("Failed to save email:",w),Y(g("error.saveEmailFailed"));return}try{if(_t.hasPendingChange){let w=window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken");if(!w)throw new Error("Missing auth token");let I=await fetch("/api/auth/change-avatar",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${w}`},body:JSON.stringify({avatarDataUrl:_t.dataUrl||null})}),M=await I.json().catch(()=>({}));if(!I.ok)throw new Error(M.error||"Failed to update avatar");let z=window.authSystem?.getCurrentUser?.();z&&(z.avatarDataUrl=M.avatarDataUrl||null),fI(),zo(),_t.hasPendingChange=!1,_t.dataUrl=null}}catch(w){console.error("Failed to save avatar:",w),Y(g("error.saveAvatarFailed"));return}let r=document.getElementById("auto-start-date-toggle"),a=document.getElementById("auto-end-date-toggle"),i=document.getElementById("enable-review-status-toggle"),l=document.getElementById("calendar-include-backlog-toggle"),c=document.getElementById("debug-logs-toggle"),d=document.getElementById("history-sort-order"),u=document.getElementById("language-select");R.autoSetStartDateOnStatusChange=!!r?.checked,R.autoSetEndDateOnStatusChange=!!a?.checked,R.debugLogsEnabled=!!c?.checked,nr(R.debugLogsEnabled);let p=window.enableReviewStatus,f=!!i?.checked;if(p&&!f){let w=A.filter(I=>I.status==="review");if(w.length>0){let I=document.getElementById("review-status-task-list"),M=w.slice(0,5),z=w.length>5,_=`
                    <div style="
                        color: var(--text-primary);
                        font-size: 14px;
                        line-height: 1.6;
                        margin-bottom: 16px;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        flex-wrap: wrap;
                    ">
                        <span style="color: var(--text-secondary);">You have</span>
                        <span style="
                            color: var(--text-primary);
                            font-weight: 600;
                            font-size: 16px;
                        ">${w.length}</span>
                        <span style="color: var(--text-secondary);">${w.length===1?"task":"tasks"} with</span>
                        <span class="status-badge review" style="
                            display: inline-flex;
                            align-items: center;
                            padding: 4px 10px;
                            border-radius: 6px;
                            font-size: 11px;
                            font-weight: 600;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        ">IN REVIEW</span>
                        <span style="color: var(--text-secondary);">status</span>
                    </div>
                    <div style="margin: 20px 0;">
                        ${M.map(x=>`
                            <div style="
                                display: flex;
                                align-items: center;
                                gap: 10px;
                                padding: 8px 0;
                                color: var(--text-primary);
                                font-size: 14px;
                            ">
                                <svg width="18" height="18" viewBox="0 0 16 16" fill="none" style="flex-shrink: 0; color: var(--accent-green);">
                                    <rect x="2" y="2" width="12" height="12" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                    <path d="M5 8L7 10L11 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    ${V(x.title)}
                                </span>
                            </div>
                        `).join("")}
                        ${z?`
                            <div style="
                                margin-top: 12px;
                                padding-top: 12px;
                                border-top: 1px solid var(--border-color);
                            ">
                                <button type="button" style="
                                    background: none;
                                    border: none;
                                    color: var(--accent-blue);
                                    text-decoration: none;
                                    font-size: 13px;
                                    display: inline-flex;
                                    align-items: center;
                                    gap: 6px;
                                    cursor: pointer;
                                    padding: 0;
                                    font-family: inherit;
                                " onclick="
                                    const baseUrl = window.location.href.split('#')[0];
                                    const url = baseUrl + '#tasks?status=review&view=list';
                                    window.open(url, '_blank');
                                ">
                                    <span>View all ${w.length} tasks in List view</span>
                                    <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="flex-shrink: 0;">
                                        <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                        `:""}
                    </div>
                    <div style="
                        color: var(--text-primary);
                        font-size: 14px;
                        line-height: 1.6;
                        margin-top: 20px;
                        padding: 16px;
                        background: var(--bg-tertiary);
                        border-radius: 8px;
                        border-left: 3px solid var(--accent-blue);
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        flex-wrap: wrap;
                    ">
                        <svg width="18" height="18" viewBox="0 0 16 16" fill="none" style="flex-shrink: 0; color: var(--accent-blue);">
                            <path d="M8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2Z" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M8 5V8L10 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <span style="color: var(--text-secondary);">These tasks will be moved to</span>
                        <span class="status-badge progress" style="
                            display: inline-flex;
                            align-items: center;
                            padding: 4px 10px;
                            border-radius: 6px;
                            font-size: 11px;
                            font-weight: 600;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        ">IN PROGRESS</span>
                    </div>
                `;I.innerHTML=_,window.pendingReviewTaskMigration=w,window.pendingReviewStatusToggle=i,document.getElementById("review-status-confirm-modal").classList.add("active");return}}R.enableReviewStatus=f,R.calendarIncludeBacklog=!!l?.checked,R.historySortOrder=d.value,R.language=Ku(u?.value||"en"),window.enableReviewStatus=R.enableReviewStatus,localStorage.setItem("enableReviewStatus",String(R.enableReviewStatus)),pp(),bk(),R.notificationEmail=o;let h=document.getElementById("email-notifications-enabled"),m=document.getElementById("email-notifications-weekdays-only"),y=document.getElementById("email-notifications-include-start-dates"),k=document.getElementById("email-notifications-include-backlog"),S=document.getElementById("email-notification-time"),T=document.getElementById("email-notification-timezone");R.emailNotificationsEnabled=!!h?.checked,R.emailNotificationsWeekdaysOnly=!!m?.checked,R.emailNotificationsIncludeStartDates=!!y?.checked,R.emailNotificationsIncludeBacklog=!!k?.checked;let D=Zl(or(S?.value)||"09:00",30);R.emailNotificationTime=Ql(D||"09:00","08:00","18:00")||"09:00",R.emailNotificationTimeZone=String(T?.value||"Atlantic/Canary"),S&&(S.value=R.emailNotificationTime),Ut.hasPendingChange&&(R.customWorkspaceLogo=Ut.dataUrl||null),Ml(),Ok(),ys({force:!0});let E=document.getElementById("calendar-view");E&&E.classList.contains("active")&&ye(),Ut.hasPendingChange=!1,Ut.dataUrl=null;let b=document.querySelector(".user-email");b&&(b.textContent=o),Et(g("success.settingsSaved")),window.initialSettingsFormState=null,window.settingsFormIsDirty=!1,e&&(e.classList.remove("dirty"),e.disabled=!0),Bt("settings-modal")});function zo(){let t=document.getElementById("user-avatar-preview"),e=document.getElementById("user-avatar-clear-btn"),n=document.getElementById("user-avatar-dropzone"),s=t?.closest?.(".user-avatar-input-row")||n?.closest?.(".user-avatar-input-row")||null,o=window.authSystem?.getCurrentUser?.(),r=_t.hasPendingChange?_t.dataUrl:o?.avatarDataUrl||null,a=!!r;if(t&&e&&(r?(t.style.display="block",t.style.backgroundImage=`url(${r})`,e.style.display="inline-flex"):(t.style.display="none",t.style.backgroundImage="",e.style.display="none")),n){let i=g("settings.avatarUploadAriaUpload"),l=g("settings.avatarUploadAriaChange");n.setAttribute("aria-label",a?l:i);let c=n.querySelector(".workspace-logo-dropzone-text");if(c){let d=n.dataset.defaultText||g("settings.avatarUploadDefault"),u=n.dataset.changeText||g("settings.avatarUploadChange");c.textContent=a?u:d}n.style.minHeight=a?"40px":"48px",n.style.padding=a?"10px 12px":"12px 16px"}s&&s.classList.toggle("has-avatar",a)}function fI(){let t=window.authSystem?.getCurrentUser?.();t&&lp(t.name,t.avatarDataUrl||null)}function hI(){let t=document.getElementById("workspace-logo-dropzone"),e=document.getElementById("workspace-logo-input"),n=document.getElementById("workspace-logo-clear-btn"),s=document.getElementById("workspace-logo-preview");if(!t||!e)return;let o=g("settings.logoUploadDefault");t.dataset.defaultText=o;function r(x){t.innerHTML="";let j=document.createElement("span");j.className="workspace-logo-dropzone-text",j.textContent=x,t.appendChild(j)}function a(x){x.style.display="flex",x.style.alignItems="center",x.style.justifyContent="center",x.style.gap="10px",x.style.padding="12px 16px",x.style.textAlign="center",x.style.cursor="pointer",x.style.userSelect="none",x.style.minHeight="48px",x.style.border="2px dashed var(--border)",x.style.borderRadius="10px",x.style.background="var(--bg-tertiary)",x.style.boxShadow="none",x.style.color="var(--text-muted)",x.style.fontWeight="500",x.style.transition="border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease"}function i(x,j){j?(x.style.borderColor="var(--accent-blue)",x.style.background="rgba(59, 130, 246, 0.08)",x.style.boxShadow="0 0 0 1px var(--accent-blue)"):(x.style.border="2px dashed var(--border)",x.style.background="var(--bg-tertiary)",x.style.boxShadow="none")}function l(){if(!s||!n)return;let x=s.closest(".workspace-logo-input-row")||t?.closest?.(".workspace-logo-input-row")||null,j=Ut.hasPendingChange?Ut.dataUrl:R.customWorkspaceLogo,U=!!j;if(j?(s.style.display="block",s.style.backgroundImage=`url(${j})`,n.style.display="inline-flex"):(s.style.display="none",s.style.backgroundImage="",n.style.display="none"),t){let W=g("settings.logoUploadAriaUpload"),Z=g("settings.logoUploadAriaChange");t.setAttribute("aria-label",U?Z:W);let F=t.dataset.defaultText||g("settings.logoUploadDefault"),C=t.dataset.changeText||g("settings.logoUploadChange");t.getAttribute("aria-busy")!=="true"&&!t.classList.contains("workspace-logo-uploading")&&r(U?C:F),t.style.minHeight=U?"40px":"48px",t.style.padding=U?"10px 12px":"12px 16px"}x&&x.classList.toggle("has-logo",U)}async function c(x,j){if(!x)return;if(j&&(j.preventDefault(),j.stopPropagation()),!x.type.startsWith("image/")){Y(g("error.logoSelectFile"));return}let U=2048*1024;if(x.size>U){Y(g("error.logoTooLarge"));return}let W=t.dataset.defaultText||g("settings.logoUploadDefault");try{t.innerHTML="";let Z=document.createElement("span");Z.className="workspace-logo-dropzone-text",Z.textContent=`Uploading ${x.name}...`,t.appendChild(Z),t.classList.add("workspace-logo-uploading"),t.setAttribute("aria-busy","true");let F=new FileReader;F.onload=function(C){let N=C.target&&C.target.result;if(!N){Y(g("error.imageReadFailed")),r(W),t.classList.remove("workspace-logo-uploading"),t.removeAttribute("aria-busy");return}let L=new Image;L.onload=function(){u(N,L),r(W),t.classList.remove("workspace-logo-uploading"),t.removeAttribute("aria-busy")},L.onerror=function(){Y(g("error.imageLoadFailed")),r(W),t.classList.remove("workspace-logo-uploading"),t.removeAttribute("aria-busy")},L.src=N},F.onerror=function(){Y(g("error.imageReadFailed")),r(W),t.classList.remove("workspace-logo-uploading"),t.removeAttribute("aria-busy")},F.readAsDataURL(x)}catch(Z){Y(g("error.logoUploadFailed",{message:Z.message})),r(W),t.classList.remove("workspace-logo-uploading"),t.removeAttribute("aria-busy")}}a(t),r(o),l();let d=0;t.addEventListener("dragenter",function(x){x.preventDefault(),d+=1,t.classList.add("workspace-logo-dragover"),i(t,!0)}),t.addEventListener("dragover",function(x){x.preventDefault(),t.classList.add("workspace-logo-dragover"),i(t,!0)}),t.addEventListener("dragleave",function(x){x.preventDefault(),d=Math.max(0,d-1),d===0&&(t.classList.remove("workspace-logo-dragover"),i(t,!1))}),t.addEventListener("drop",function(x){d=0,t.classList.remove("workspace-logo-dragover"),i(t,!1);let j=x.dataTransfer&&x.dataTransfer.files;j&&j.length>0&&c(j[0],x)}),t.addEventListener("dragend",function(){d=0,t.classList.remove("workspace-logo-dragover"),i(t,!1)}),t.addEventListener("paste",function(x){if(!x.clipboardData)return;let j=x.clipboardData.files;j&&j.length>0&&c(j[0],x)}),t.addEventListener("click",function(){e.click()}),t.addEventListener("keydown",function(x){(x.key==="Enter"||x.key===" ")&&(x.preventDefault(),e.click())}),e.addEventListener("change",function(x){let j=x.target.files;j&&j.length>0&&c(j[0],x),e.value=""}),n&&n.addEventListener("click",function(x){x.preventDefault(),Ut.hasPendingChange=!0,Ut.dataUrl=null,e&&(e.value=""),l(),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded()}),document.addEventListener("refresh-workspace-logo-ui",()=>{l()});function u(x,j,U=null){let W=document.getElementById("workspace-logo-crop-modal"),Z=document.getElementById("crop-canvas"),F=Z.getContext("2d"),C=document.getElementById("crop-modal-title"),N=W?.querySelector(".crop-instructions");q.originalImage=j,q.originalDataUrl=x,q.canvas=Z,q.ctx=F,q.onApply=U?.onApply||null,q.successMessage=U?.successMessage||null,q.shape=U?.shape||"square",q.outputMimeType=U?.outputMimeType||"image/jpeg",q.outputMaxSize=typeof U?.outputMaxSize=="number"?U.outputMaxSize:null,C&&(C.textContent=U?.title||"Crop Image to Square"),N&&U?.instructions&&(N.textContent=U.instructions),W.setAttribute("role","dialog"),W.setAttribute("aria-modal","true"),W.setAttribute("aria-labelledby","crop-modal-title"),W.classList.add("active"),requestAnimationFrame(()=>{let P=window.innerHeight*.6,J=j.width,ne=j.height;if(J>600||ne>P){let G=Math.min(600/J,P/ne);J=Math.floor(J*G),ne=Math.floor(ne*G)}Z.width=J,Z.height=ne,F.clearRect(0,0,Z.width,Z.height),F.drawImage(j,0,0,J,ne);let se=Math.min(J,ne),le=Math.floor(se*.8);q.selection={x:Math.floor((J-le)/2),y:Math.floor((ne-le)/2),size:le},k(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{f()})})})}function p(){document.getElementById("workspace-logo-crop-modal").classList.remove("active"),S(),q={originalImage:null,originalDataUrl:null,canvas:null,ctx:null,selection:{x:0,y:0,size:0},isDragging:!1,isResizing:!1,dragStartX:0,dragStartY:0,activeHandle:null,shape:"square",outputMimeType:"image/jpeg",outputMaxSize:null,onApply:null,successMessage:null}}function f(){let x=document.getElementById("crop-selection"),j=q.canvas;if(!j||!x)return;x.dataset.shape=q.shape||"square";let U=j.getBoundingClientRect(),W=j.closest(".crop-canvas-container")||j.parentElement,Z=W?W.getBoundingClientRect():U,F=U.left-Z.left,C=U.top-Z.top,N=j.width/U.width,L=q.selection.x/N,P=q.selection.y/N,J=q.selection.size/N;x.style.left=`${F+L}px`,x.style.top=`${C+P}px`,x.style.width=`${J}px`,x.style.height=`${J}px`,h()}function h(){let x=document.getElementById("crop-dimensions"),j=document.getElementById("crop-size-estimate");if(!x||!j)return;let U=q.canvas,W=q.originalImage;if(!U||!W)return;let Z=document.getElementById("crop-selection"),F=U.getBoundingClientRect(),C=Z?.getBoundingClientRect?.(),N=0;if(C&&F.width>0&&F.height>0){let ne=W.width/F.width,se=W.height/F.height,le=C.width*ne,G=C.height*se;N=Math.max(1,Math.floor(Math.min(le,G)))}else{let ne=W.width/U.width;N=Math.max(1,Math.floor(q.selection.size*ne))}x.textContent=`${N} \xD7 ${N} px`;let L=N*N*3,P=Math.floor(L/1024);j.textContent=`~${P} KB`;let J=2048;j.classList.remove("size-warning","size-error"),P>J?j.classList.add("size-error"):P>J*.8&&j.classList.add("size-warning")}async function m(){try{let x=q.canvas,j=q.originalImage,U=q.selection;if(!x||!j){Y(g("error.cropInvalid"));return}let W=x.getBoundingClientRect(),F=document.getElementById("crop-selection")?.getBoundingClientRect?.(),C=0,N=0,L=0;if(F&&W.width>0&&W.height>0){let H=(F.left+F.width/2-W.left)/W.width,me=(F.top+F.height/2-W.top)/W.height,Te=H*j.width,Ie=me*j.height,je=F.width/W.width*j.width,Ce=F.height/W.height*j.height;L=Math.max(1,Math.floor(Math.min(je,Ce))),C=Math.floor(Te-L/2),N=Math.floor(Ie-L/2)}else{let H=j.width/x.width,me=j.height/x.height;L=Math.max(1,Math.floor(U.size*Math.min(H,me))),C=Math.floor(U.x*H),N=Math.floor(U.y*me)}C=Math.max(0,Math.min(C,j.width-L)),N=Math.max(0,Math.min(N,j.height-L));let P=2048*1024,J=6,ne=(H,me)=>{let Te=document.createElement("canvas");Te.width=H,Te.height=H;let Ie=Te.getContext("2d");if(!Ie)throw new Error("Canvas context unavailable");let je=q.shape||"square";je==="circle"&&(Ie.clearRect(0,0,H,H),Ie.save(),Ie.beginPath(),Ie.arc(H/2,H/2,H/2,0,Math.PI*2),Ie.closePath(),Ie.clip()),Ie.drawImage(j,C,N,L,L,0,0,H,H),je==="circle"&&Ie.restore();let Ce=q.outputMimeType||(je==="circle"?"image/png":"image/jpeg");return Ce==="image/jpeg"||Ce==="image/webp"?Te.toDataURL(Ce,me):Te.toDataURL(Ce)},se=q.outputMaxSize?Math.min(L,q.outputMaxSize):L;se=Math.max(50,Math.floor(se));let le=0,G=.92,ge=ne(se,G);for(;ge.length>P*1.37&&le<J;){let H=q.shape||"square",me=q.outputMimeType||(H==="circle"?"image/png":"image/jpeg");me==="image/jpeg"||me==="image/webp"?G=Math.max(.5,G-.1):se=Math.floor(se*.85),ge=ne(se,G),le++}if(ge.length>P*1.37){Y(g("error.cropTooLarge"));return}typeof q.onApply=="function"?(q.onApply(ge),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded(),p(),Et(q.successMessage||g("success.cropApplied"))):(Ut.hasPendingChange=!0,Ut.dataUrl=ge,l(),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded(),p(),Et(g("success.logoCroppedApplied")))}catch(x){Y(g("error.cropFailed",{message:x.message})),console.error("Crop error:",x)}}function y(){let x=document.getElementById("user-avatar-dropzone"),j=document.getElementById("user-avatar-input"),U=document.getElementById("user-avatar-clear-btn");if(!x||!j)return;let W=g("settings.avatarUploadDefault");x.dataset.defaultText=W,x.dataset.changeText=g("settings.avatarUploadChange");function Z(L){x.innerHTML="";let P=document.createElement("span");P.className="workspace-logo-dropzone-text",P.textContent=L,x.appendChild(P)}function F(L){L.style.display="flex",L.style.alignItems="center",L.style.justifyContent="center",L.style.gap="10px",L.style.padding="12px 16px",L.style.textAlign="center",L.style.cursor="pointer",L.style.userSelect="none",L.style.minHeight="48px",L.style.border="2px dashed var(--border)",L.style.borderRadius="10px",L.style.background="var(--bg-tertiary)",L.style.boxShadow="none",L.style.color="var(--text-muted)",L.style.fontWeight="500",L.style.transition="border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease"}function C(L,P){P?(L.style.borderColor="var(--accent-blue)",L.style.background="rgba(59, 130, 246, 0.08)",L.style.boxShadow="0 0 0 1px var(--accent-blue)"):(L.style.border="2px dashed var(--border)",L.style.background="var(--bg-tertiary)",L.style.boxShadow="none")}async function N(L,P){if(!L)return;if(P&&(P.preventDefault(),P.stopPropagation()),!L.type.startsWith("image/")){Y(g("error.avatarSelectFile"));return}let J=2048*1024;if(L.size>J){Y(g("error.avatarTooLarge"));return}let ne=x.dataset.defaultText||g("settings.avatarUploadDefault");try{x.innerHTML="";let se=document.createElement("span");se.className="workspace-logo-dropzone-text",se.textContent=`Uploading ${L.name}...`,x.appendChild(se),x.setAttribute("aria-busy","true");let le=new FileReader,G=await new Promise((H,me)=>{le.onload=()=>H(le.result),le.onerror=me,le.readAsDataURL(L)}),ge=new Image;ge.onload=()=>{u(G,ge,{title:"Crop Avatar",instructions:"Drag to adjust the crop area. Your avatar will be displayed as a circle.",shape:"circle",outputMimeType:"image/png",outputMaxSize:512,successMessage:"Avatar cropped and applied successfully!",onApply:H=>{_t.hasPendingChange=!0,_t.dataUrl=H,zo()}})},ge.onerror=()=>{Y(g("error.imageLoadFailed"))},ge.src=G}catch(se){console.error("Avatar upload error:",se),Y(g("error.avatarUploadFailed"))}finally{x.setAttribute("aria-busy","false"),Z(ne)}}F(x),Z(W),x.addEventListener("click",()=>j.click()),x.addEventListener("keydown",L=>{(L.key==="Enter"||L.key===" ")&&(L.preventDefault(),j.click())}),j.addEventListener("change",L=>{let P=L.target.files&&L.target.files[0];N(P,L),j.value=""}),x.addEventListener("dragenter",L=>{L.preventDefault(),C(x,!0)}),x.addEventListener("dragover",L=>{L.preventDefault(),C(x,!0)}),x.addEventListener("dragleave",L=>{L.preventDefault(),C(x,!1)}),x.addEventListener("drop",L=>{L.preventDefault(),C(x,!1);let P=L.dataTransfer?.files?.[0];N(P,L)}),U&&!U.__avatarClearBound&&(U.__avatarClearBound=!0,U.addEventListener("click",()=>{_t.hasPendingChange=!0,_t.dataUrl=null,zo(),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded()})),zo()}function k(){let x=document.getElementById("crop-selection"),j=document.querySelectorAll(".crop-handle");x&&(x.addEventListener("mousedown",T),x.addEventListener("touchstart",w)),j.forEach(U=>{U.addEventListener("mousedown",D),U.addEventListener("touchstart",I)}),document.addEventListener("mousemove",E),document.addEventListener("mouseup",b),document.addEventListener("touchmove",M),document.addEventListener("touchend",z),document.addEventListener("keydown",_)}function S(){let x=document.getElementById("crop-selection"),j=document.querySelectorAll(".crop-handle");x&&(x.removeEventListener("mousedown",T),x.removeEventListener("touchstart",w)),j.forEach(U=>{U.removeEventListener("mousedown",D),U.removeEventListener("touchstart",I)}),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",b),document.removeEventListener("touchmove",M),document.removeEventListener("touchend",z),document.removeEventListener("keydown",_)}function T(x){x.target.classList.contains("crop-handle")||(x.preventDefault(),x.stopPropagation(),q.isDragging=!0,q.dragStartX=x.clientX,q.dragStartY=x.clientY)}function D(x){x.preventDefault(),x.stopPropagation(),q.isResizing=!0,q.dragStartX=x.clientX,q.dragStartY=x.clientY,x.target.classList.contains("crop-handle-nw")?q.activeHandle="nw":x.target.classList.contains("crop-handle-ne")?q.activeHandle="ne":x.target.classList.contains("crop-handle-sw")?q.activeHandle="sw":x.target.classList.contains("crop-handle-se")&&(q.activeHandle="se")}function E(x){if(!q.isDragging&&!q.isResizing)return;x.preventDefault();let j=q.canvas;if(!j)return;let U=j.getBoundingClientRect(),W=j.width/U.width,Z=(x.clientX-q.dragStartX)*W,F=(x.clientY-q.dragStartY)*W;if(q.isDragging){let C=q.selection.x+Z,N=q.selection.y+F;C=Math.max(0,Math.min(C,j.width-q.selection.size)),N=Math.max(0,Math.min(N,j.height-q.selection.size)),q.selection.x=C,q.selection.y=N}else if(q.isResizing){let C=(H,me)=>Math.abs(H)>Math.abs(me)?H:me,L=q.selection,P=0,J=0,ne=0,se=0;switch(q.activeHandle){case"se":ne=C(Z,F),P=L.x,J=L.y,se=Math.min(j.width-P,j.height-J);break;case"nw":ne=C(-Z,-F),P=L.x+L.size,J=L.y+L.size,se=Math.min(P,J);break;case"ne":ne=C(Z,-F),P=L.x,J=L.y+L.size,se=Math.min(j.width-P,J);break;case"sw":ne=C(-Z,F),P=L.x+L.size,J=L.y,se=Math.min(P,j.height-J);break}let le=L.size+ne;le=Math.max(50,Math.min(le,se));let G=L.x,ge=L.y;switch(q.activeHandle){case"se":G=P,ge=J;break;case"nw":G=P-le,ge=J-le;break;case"ne":G=P,ge=J-le;break;case"sw":G=P-le,ge=J;break}q.selection.size=le,q.selection.x=G,q.selection.y=ge}f(),q.dragStartX=x.clientX,q.dragStartY=x.clientY}function b(x){(q.isDragging||q.isResizing)&&(x.preventDefault(),q.isDragging=!1,q.isResizing=!1,q.activeHandle=null)}function w(x){if(x.target.classList.contains("crop-handle"))return;x.preventDefault();let j=x.touches[0];q.isDragging=!0,q.dragStartX=j.clientX,q.dragStartY=j.clientY}function I(x){x.preventDefault(),x.stopPropagation();let j=x.touches[0];q.isResizing=!0,q.dragStartX=j.clientX,q.dragStartY=j.clientY,x.target.classList.contains("crop-handle-nw")?q.activeHandle="nw":x.target.classList.contains("crop-handle-ne")?q.activeHandle="ne":x.target.classList.contains("crop-handle-sw")?q.activeHandle="sw":x.target.classList.contains("crop-handle-se")&&(q.activeHandle="se")}function M(x){if(!q.isDragging&&!q.isResizing)return;x.preventDefault();let j=x.touches[0],U={clientX:j.clientX,clientY:j.clientY,preventDefault:()=>{}};E(U)}function z(x){(q.isDragging||q.isResizing)&&(x.preventDefault(),q.isDragging=!1,q.isResizing=!1,q.activeHandle=null)}function _(x){x.key==="Escape"&&p()}window.openCropModal=u,window.closeCropModal=p,window.applyCrop=m,y()}hI();window.initializeApp=vD;window.setupUserMenus=mb;window.addEventListener("beforeunload",t=>{if(feedbackLocalStorageTimer&&(clearTimeout(feedbackLocalStorageTimer),persistFeedbackDeltaQueue()),Yn>0)return t.preventDefault(),t.returnValue="You have unsaved changes. Are you sure you want to leave?",t.returnValue});document.addEventListener("DOMContentLoaded",function(){let t=document.getElementById("task-modal");if(!t)return;let e=t.querySelector('#task-form input[name="title"]');e&&e.addEventListener("blur",function(n){let s=t.querySelector("#task-form");s&&s.dataset.editingTaskId&&cn("title",n.target.value)})});var zu=!1;document.addEventListener("click",function(t){if(!t.target.closest(".color-picker-container")){if(zu){zu=!1;return}document.querySelectorAll(".color-picker-dropdown").forEach(e=>{e.style.display="none"})}});async function mI(){let t=document.getElementById("task-form"),e=t.dataset.editingTaskId,n=Fe("tasks","submit",{editing:!!e,taskCount:A.length}),s=t.querySelector('input[name="title"]').value,o=document.getElementById("task-description-hidden").value;o=ab(o);let r=t.querySelector('input[name="projectId"]').value||(t.querySelector('select[name="projectId"]')?t.querySelector('select[name="projectId"]').value:""),a=document.getElementById("hidden-status").value||"backlog",i=t.querySelector("#hidden-priority").value||"medium",l=(t.querySelector('input[name="startDate"]')?.value||"").trim(),c=l===""?"":l,d=(t.querySelector('input[name="endDate"]')?.value||"").trim(),u=d===""?"":d;if(e){let f=A.find(y=>y.id===parseInt(e,10)),h=f?JSON.parse(JSON.stringify(f)):null,m=Np(parseInt(e,10),{title:s,description:o,projectId:r,startDate:c,endDate:u,priority:i,status:a},A);if(m.task){window.historyService&&h&&window.historyService.recordTaskUpdated(h,m.task);let y=m.oldProjectId;A=m.tasks;let k=m.task;if(y!==k.projectId&&(y&&(Zs(y),Qs(y,"removed",k)),k.projectId&&(Zs(k.projectId),Qs(k.projectId,"added",k)),Rt().catch(()=>{})),Bt("task-modal"),document.getElementById("project-details").classList.contains("active")){let S=y||k.projectId;S&&Qe(S)}else document.getElementById("projects").classList.contains("active")&&(de.projectsSortedView=null,Mt(),Ct());ot().catch(S=>{console.error("Failed to save task:",S),Y(k("error.saveChangesFailed"))})}}else{let f=Pp({title:s,description:o,projectId:r,startDate:c,endDate:u,priority:i,status:a,tags:window.tempTags?[...window.tempTags]:[]},A,St,et);A=f.tasks,St=f.taskCounter;let h=f.task;et=[],window.tempTags=[],window.historyService&&window.historyService.recordTaskCreated(h),h&&h.projectId&&(Zs(h.projectId),Qs(h.projectId,"added",h),Rt().catch(()=>{})),fa(),Go(),io(),Bt("task-modal"),h.projectId&&document.getElementById("project-details").classList.contains("active")?(Qe(h.projectId),Ct()):document.getElementById("projects").classList.contains("active")&&(de.projectsSortedView=null,Mt(),Ct()),ot().catch(m=>{console.error("Failed to save task:",m),Y(g("error.saveChangesFailed"))})}Bt("task-modal"),so(),document.getElementById("calendar-view")&&ye(),Qu(),ot().catch(f=>{console.error("Failed to save task:",f),Y(g("error.saveChangesFailed"))}),Oe("tasks",n,{taskCount:A.length,projectCount:B.length})}document.getElementById("task-form").addEventListener("submit",function(t){t.preventDefault(),t.stopPropagation(),mI()});function gI(){document.body.hasAttribute("data-status-dropdown-initialized")||(document.body.setAttribute("data-status-dropdown-initialized","true"),document.addEventListener("click",yI))}function yI(t){if(t.target.closest("#task-options-btn")){t.preventDefault(),t.stopPropagation();let s=document.getElementById("options-menu");s&&(s.style.display=s.style.display==="block"?"none":"block");return}let e=document.getElementById("options-menu");if(e&&!t.target.closest("#task-options-btn")&&!t.target.closest("#options-menu")&&(e.style.display="none"),t.target.closest("#status-current")){t.preventDefault(),t.stopPropagation();let s=t.target.closest(".status-dropdown"),o=s.classList.contains("active");if(document.querySelectorAll(".status-dropdown.active").forEach(r=>r.classList.remove("active")),!o){s.classList.add("active");let r=document.getElementById("hidden-status");r&&Hu(r.value)}return}if(t.target.closest(".status-option")){t.preventDefault(),t.stopPropagation();let s=t.target.closest(".status-option"),o=s.dataset.status,a=s.querySelector(".status-badge").textContent.trim(),i=document.getElementById("status-current"),l=document.getElementById("hidden-status");if(i&&l){let d=i.querySelector(".status-badge");d&&(d.className=`status-badge ${o}`,d.textContent=a),l.value=o,cn("status",o)}let c=s.closest(".status-dropdown");c&&c.classList.remove("active"),setTimeout(()=>Hu(o),100);return}document.querySelectorAll(".status-dropdown.active").forEach(s=>{s.contains(t.target)||s.classList.remove("active")})}function kI(){document.body.hasAttribute("data-priority-dropdown-initialized")||(document.body.setAttribute("data-priority-dropdown-initialized","true"),document.addEventListener("click",bI))}function bI(t){if(t.target.closest("#priority-current")){t.preventDefault(),t.stopPropagation();let n=t.target.closest(".priority-dropdown"),s=n.classList.contains("active");if(document.querySelectorAll(".priority-dropdown.active").forEach(o=>o.classList.remove("active")),!s){n.classList.add("active");let o=document.getElementById("hidden-priority");o&&vl(o.value)}return}if(t.target.closest(".priority-option")){t.preventDefault(),t.stopPropagation();let n=t.target.closest(".priority-option"),s=n.dataset.priority,o=n.textContent.trim(),r=document.getElementById("priority-current"),a=document.getElementById("hidden-priority");if(r&&a){let l=o.toUpperCase();r.innerHTML=`<span class="priority-pill priority-${s}">${l}</span> <span class="dropdown-arrow">\u25BC</span>`,a.value=s,cn("priority",s)}let i=n.closest(".priority-dropdown");i&&i.classList.remove("active"),setTimeout(()=>vl(s),100);return}document.querySelectorAll(".priority-dropdown.active").forEach(n=>{n.contains(t.target)||n.classList.remove("active")})}function vl(t){let e=document.getElementById("priority-options");if(!e)return;let s=qp.map(o=>({...o,label:At(o.value)})).filter(o=>o.value!==t);e.innerHTML=s.map(o=>`<div class="priority-option" data-priority="${o.value}">
            <span class="priority-pill priority-${o.value}">${o.label.toUpperCase()}</span>
        </div>`).join("")}function Hu(t){let e=document.getElementById("status-options");if(!e)return;let n=[{value:"backlog",label:pt("backlog")},{value:"todo",label:pt("todo")},{value:"progress",label:pt("progress")},{value:"review",label:pt("review")},{value:"done",label:pt("done")}],s=n;window.enableReviewStatus===!1&&(s=n.filter(r=>r.value!=="review"));let o=s.filter(r=>r.value!==t);e.innerHTML=o.map(r=>`<div class="status-option" data-status="${r.value}">
            <span class="status-badge ${r.value}">${r.label}</span>
        </div>`).join("")}function vI(){document.body.hasAttribute("data-project-dropdown-initialized")||(document.body.setAttribute("data-project-dropdown-initialized","true"),document.addEventListener("click",wI))}function wI(t){if(t.target.closest("#project-current")){t.preventDefault(),t.stopPropagation();let n=t.target.closest(".project-dropdown"),s=n.classList.contains("active");document.querySelectorAll(".project-dropdown.active").forEach(o=>o.classList.remove("active")),s||(n.classList.add("active"),EI(n));return}if(t.target.closest(".project-option")){t.preventDefault(),t.stopPropagation();let n=t.target.closest(".project-option"),s=n.dataset.projectId,o=n.textContent.trim(),r=document.getElementById("project-current"),a=document.getElementById("hidden-project");if(r&&a){let l=r.querySelector(".project-text");if(l)if(s){let c=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Ke(parseInt(s))}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;l.innerHTML=c+V(o)}else l.textContent=o;a.value=s,cn("projectId",s),Ol(s)}let i=n.closest(".project-dropdown");i&&i.classList.remove("active"),Zn();return}let e=document.querySelectorAll(".project-dropdown.active");e.length>0&&!t.target.closest(".project-dropdown")&&(e.forEach(n=>n.classList.remove("active")),Zn())}function Ol(t){let e=document.getElementById("task-project-open-btn");e&&(e.style.display=t?"inline-flex":"none")}function SI(){let t=document.getElementById("hidden-project");if(!t||!t.value)return;let e=parseInt(t.value,10);e&&(Bt("task-modal"),Qe(e,"projects"))}function sb(t){let e=t?t.querySelector(".project-options"):null,n=document.getElementById("hidden-project"),s=n&&n.value||"",o=s?`<div class="project-option" data-project-id="">${g("tasks.project.selectPlaceholder")}</div>`:"";return B&&B.length>0&&(o+=B.slice().sort((r,a)=>(r.name||"").localeCompare(a.name||"",void 0,{sensitivity:"base"})).filter(r=>s===""||String(r.id)!==String(s)).map(r=>{let a=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Ke(r.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;return`<div class="project-option" data-project-id="${r.id}">${a}${V(r.name)}</div>`}).join("")),e&&(e.innerHTML=o),o}var nt=null,wl=null,Oo=[];function EI(t){let e=sb(t)||"";nt||(nt=document.createElement("div"),nt.className="project-options-portal",document.body.appendChild(nt)),nt.innerHTML=`
        <div class="project-portal-search">
            <input type="text" class="form-input" id="project-portal-search-input" placeholder="Search projects..." autocomplete="off" />
        </div>
        <div class="project-portal-options">${e}</div>
    `,nt.style.display="block";let n=t.querySelector("#project-current");wl=n,qu(n,nt),requestAnimationFrame(()=>qu(n,nt)),nt.addEventListener("click",r=>{r.stopPropagation();let a=r.target.closest(".project-option");if(!a)return;let i=a.dataset.projectId,l=a.textContent.trim(),c=document.getElementById("project-current"),d=document.getElementById("hidden-project");if(c&&d){let p=c.querySelector(".project-text");if(p)if(i){let f=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Ke(parseInt(i))}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;p.innerHTML=f+V(l)}else p.textContent=l;d.value=i,cn("projectId",i),Ol(i)}let u=n.closest(".project-dropdown");u&&u.classList.remove("active"),Zn()},{once:!0});let s=nt.querySelector("#project-portal-search-input");s&&(s.addEventListener("input",()=>TC(s.value)),setTimeout(()=>s.focus(),0)),window.addEventListener("scroll",Vo,!0),window.addEventListener("resize",Vo,!0),document.addEventListener("keydown",rb,!0);let o=t.querySelector(".project-options");o&&(o.style.display="none"),xI(n)}function qu(t,e){let n=t.getBoundingClientRect();e.style.width=`${n.width}px`;let s=window.innerHeight,o=Math.min(e.scrollHeight,200),i=s-n.bottom<o+12?Math.max(8,n.top-o-4):n.bottom+4,l=window.innerWidth,c=e.getBoundingClientRect().width||n.width,d=n.left,u=Math.min(Math.max(8,d),Math.max(8,l-c-8));e.style.left=`${u}px`,e.style.top=`${i}px`}function Zn(){nt&&(nt.style.display="none",nt.innerHTML=""),document.querySelectorAll(".project-dropdown .project-options").forEach(t=>{t.style.display=""}),window.removeEventListener("scroll",Vo,!0),window.removeEventListener("resize",Vo,!0),document.removeEventListener("keydown",rb,!0),wl=null,ob()}function Vo(){!wl||!nt||nt.style.display==="none"||(document.querySelector(".project-dropdown.active")?qu(wl,nt):Zn())}function xI(t){ob(),Oo=TI(t),Oo.forEach(e=>{e.addEventListener("scroll",Vo,{capture:!0,passive:!0})})}function ob(){!Oo||Oo.length===0||(Oo.forEach(t=>{t.removeEventListener("scroll",Vo,{capture:!0})}),Oo=[])}function TI(t){let e=[],n=t.parentElement;for(;n&&n!==document.body;){let s=getComputedStyle(n);/(auto|scroll|overlay)/.test(s.overflowY)&&n.scrollHeight>n.clientHeight&&e.push(n),n=n.parentElement}return e.push(document.documentElement),e.push(document.body),e}function rb(t){t.key==="Escape"&&(Zn(),document.querySelectorAll(".project-dropdown.active").forEach(e=>e.classList.remove("active")))}function DI(t){zy(t),Ur()}function II(t){Hy(t),Ur()}function CI(){qy(),Ur()}function AI(){Uy(),Ur()}function ab(t){if(!t)return t;let e=document.createElement("div");e.innerHTML=t;let n=/(https?:\/\/[^\s<]+)/g,s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null),o=[];for(;s.nextNode();){let r=s.currentNode;if(!r||!r.nodeValue)continue;let a=r.parentElement;a&&a.closest("a")||(n.lastIndex=0,n.test(r.nodeValue)&&o.push(r))}return o.forEach(r=>{let a=r.nodeValue,i=0;n.lastIndex=0;let l=document.createDocumentFragment(),c;for(;(c=n.exec(a))!==null;){let d=c[0];c.index>i&&l.appendChild(document.createTextNode(a.slice(i,c.index)));let u=document.createElement("a");u.href=d,u.textContent=d,u.target="_blank",u.rel="noopener noreferrer",l.appendChild(u),i=c.index+d.length}i<a.length&&l.appendChild(document.createTextNode(a.slice(i))),r.parentNode&&r.parentNode.replaceChild(l,r)}),e.innerHTML}document.addEventListener("DOMContentLoaded",function(){let t=document.getElementById("task-form"),e=document.getElementById("task-description-hidden"),n="";$y({placeholder:"",onFocus:l=>{n=l},onUpdate:l=>{e&&(e.value=l)},onBlur:l=>{e&&(e.value=l),t&&t.dataset.editingTaskId&&l!==n&&cn("description",l)}});let s=document.getElementById("task-description-editor");s&&(s.addEventListener("paste",function(l){if(!l.clipboardData)return;let c=Array.from(l.clipboardData.files||[])[0];if(!c||!c.type||!c.type.startsWith("image/"))return;l.preventDefault(),l.stopPropagation();let d=document.getElementById("attachment-file-dropzone");typeof xl=="function"&&xl(c,d).catch(u=>{console.error("Failed to upload pasted image as attachment:",u)})}),s.addEventListener("click",function(l){let c=l.target.closest("a");if(!c)return;let d=c.getAttribute("href");if(!d)return;let u=window.getSelection();u&&u.toString()||(l.preventDefault(),l.stopPropagation(),window.open(d,"_blank","noopener,noreferrer"))}));let o=document.getElementById("attachment-url"),r=document.getElementById("attachment-name");o&&o.addEventListener("keydown",function(l){l.key==="Enter"&&(l.preventDefault(),Vu())}),r&&r.addEventListener("keydown",function(l){l.key==="Enter"&&(l.preventDefault(),Vu())});let a=document.getElementById("tag-input");a&&a.addEventListener("keydown",function(l){l.key==="Enter"&&(l.preventDefault(),Ab())});let i=document.getElementById("feedback-description");if(i){let l=i.getAttribute("placeholder")||"",c="Describe the issue or idea.",d=()=>typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:$e(),u=()=>{i.placeholder=d()?c:l};if(u(),typeof window.matchMedia=="function"){let p=window.matchMedia("(max-width: 768px)");typeof p.addEventListener=="function"?p.addEventListener("change",u):typeof p.addListener=="function"&&p.addListener(u)}i.addEventListener("keypress",function(p){p.key==="Enter"&&(p.preventDefault(),dp())})}});function MI(){let t=new Date,e=t.getMonth(),n=t.getFullYear();return{currentMonth:e,currentYear:n}}var ib=MI(),qe=ib.currentMonth,Ue=ib.currentYear;function op(){localStorage.setItem("calendarMonth",qe.toString()),localStorage.setItem("calendarYear",Ue.toString())}function ye(){let t=Fe("render","calendar",{taskCount:A.length,month:qe+1,year:Ue}),e=Qn(),n=Lp(e),s=new Date;document.getElementById("calendar-month-year").textContent=jp(e,Ue,qe);let o=v.projects.size>0?new Set(Array.from(v.projects).map(c=>parseInt(c,10))):null,r=ff(Ue,qe,{tasks:A,projects:B,filteredProjectIds:o,includeBacklog:!!R.calendarIncludeBacklog,today:s}),a=r.isCurrentMonth;try{let c=typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:$e();c&&document.querySelectorAll(".calendar-today-btn--header").forEach(d=>{d.style.display=a?"none":"inline-flex"}),c||document.querySelectorAll(".calendar-today-btn--nav").forEach(d=>{d.style.display=a?"none":"inline-flex"})}catch{}let i=hf(r,n);document.getElementById("calendar-grid").innerHTML=i;let l=document.getElementById("project-overlay");l&&(l.style.opacity="0"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{na()})})}var En=0,pk=20;function na(){let t=Fe("render","projectBars",{taskCount:A.length,projectCount:B.length});try{let e=document.getElementById("project-overlay");if(!e){console.error("[ProjectBars] No overlay element found!"),En=0;return}e.innerHTML="",e.style.opacity="0";let n=document.getElementById("calendar-grid");if(!n){console.error("[ProjectBars] No calendar grid found!"),En=0;return}let s=document.getElementById("calendar-view");if(!(s&&(s.classList.contains("active")||s.classList.contains("preparing")))){En=0;return}let r=n.offsetHeight,a=n.offsetWidth,i=Array.from(n.querySelectorAll(".calendar-day"));if(i.length===0)if(En<pk){console.warn("[ProjectBars] No day elements found, retrying in 100ms..."),En++,setTimeout(na,100);return}else{console.error("[ProjectBars] Max retries reached, giving up"),En=0;return}let l=i[0].getBoundingClientRect();if(l.width===0||l.height===0)if(En<pk){console.warn("[ProjectBars] Elements not ready (zero dimensions), retrying in 50ms...",{firstDayRect:l}),En++,setTimeout(na,50);return}else{console.error("[ProjectBars] Max retries reached, giving up"),En=0;return}En=0;let c=i.map((C,N)=>({element:C,index:N,gridIndex:N,day:parseInt(C.querySelector(".calendar-day-number").textContent),isOtherMonth:C.classList.contains("other-month")})).filter(C=>!C.isOtherMonth),d=v.projects.size>0?Array.from(v.projects).map(C=>parseInt(C,10)):B.map(C=>C.id),u=B.filter(C=>d.includes(C.id)),p=new Map;u.slice().sort((C,N)=>{let L=C.startDate||"",P=N.startDate||"";if(L!==P)return L.localeCompare(P);let J=C.endDate||C.startDate||"",ne=N.endDate||N.startDate||"";if(J!==ne)return J.localeCompare(ne);let se=(C.name||"").toLowerCase(),le=(N.name||"").toLowerCase();return se!==le?se.localeCompare(le):(C.id||0)-(N.id||0)}).forEach((C,N)=>p.set(C.id,N));let f=c.length>0?c[0].gridIndex:-1,h=c.length>0?c[c.length-1].gridIndex:-1,m=new Map,y=new Map;u.forEach(C=>{let[N,L,P]=C.startDate.split("-").map(me=>parseInt(me)),J=new Date(N,L-1,P),[ne,se,le]=(C.endDate||C.startDate).split("-").map(me=>parseInt(me)),G=new Date(ne,se-1,le),ge=new Date(Ue,qe,1),H=new Date(Ue,qe+1,0);if(J<=H&&G>=ge){let me=J<ge?ge:J,Te=G>H?H:G,Ie=me.getDate(),je=Te.getDate(),Ce=c.find(ht=>ht.day===Ie),Lt=c.find(ht=>ht.day===je);if(!Ce||!Lt)return;let es=Ce.gridIndex,Mn=Lt.gridIndex,rn=es;for(;rn<=Mn;){let ht=Math.floor(rn/7)*7,ts=Math.min(ht+6,Mn),lo=Math.max(rn,ht),zl=ts,Yo=Math.floor(lo/7);m.has(Yo)||m.set(Yo,[]),m.get(Yo).push({startIndex:lo,endIndex:zl,project:C}),rn=ts+1}}});let k=Is(window.kanbanUpdatedFilter),S=typeof ln=="function"?ln():A.slice(),T=k===null?S:S.filter(C=>Ln(C)>=k),b=(!!R.calendarIncludeBacklog?T:T.filter(C=>C.status!=="backlog")).filter(C=>{let N=C.endDate&&C.endDate.length===10&&C.endDate.includes("-"),L=C.startDate&&C.startDate.length===10&&C.startDate.includes("-");return N||L}),w=new Map,I=C=>C.startDate&&C.startDate.length===10&&C.startDate.includes("-")?C.startDate:C.endDate||"";b.slice().sort((C,N)=>{let L=I(C),P=I(N);if(L!==P)return L.localeCompare(P);let J=C.endDate||"",ne=N.endDate||"";if(J!==ne)return J.localeCompare(ne);let se=(C.title||"").toLowerCase(),le=(N.title||"").toLowerCase();return se!==le?se.localeCompare(le):(C.id||0)-(N.id||0)}).forEach((C,N)=>w.set(C.id,N)),b.forEach(C=>{let N,L,P=C.startDate&&C.startDate.length===10&&C.startDate.includes("-"),J=C.endDate&&C.endDate.length===10&&C.endDate.includes("-");if(P){let[le,G,ge]=C.startDate.split("-").map(H=>parseInt(H));N=new Date(le,G-1,ge)}else if(J){let[le,G,ge]=C.endDate.split("-").map(H=>parseInt(H));N=new Date(le,G-1,ge)}else return;if(J){let[le,G,ge]=C.endDate.split("-").map(H=>parseInt(H));L=new Date(le,G-1,ge)}else if(P)L=N;else return;let ne=new Date(Ue,qe,1),se=new Date(Ue,qe+1,0);if(N<=se&&L>=ne){let le=N<ne?ne:N,G=L>se?se:L,ge=le.getDate(),H=G.getDate(),me=c.find(Lt=>Lt.day===ge),Te=c.find(Lt=>Lt.day===H);if(!me||!Te)return;let Ie=me.gridIndex,je=Te.gridIndex,Ce=Ie;for(;Ce<=je;){let Lt=Math.floor(Ce/7)*7,es=Math.min(Lt+6,je),Mn=Math.max(Ce,Lt),rn=es,ht=Math.floor(Mn/7);y.has(ht)||y.set(ht,[]),y.get(ht).push({startIndex:Mn,endIndex:rn,task:C}),Ce=es+1}}});let M=18,z=3,_=20,x=4,j=n.offsetHeight,U=n.getBoundingClientRect(),W=new Map;m.forEach((C,N)=>{C.sort((P,J)=>(p.get(P.project.id)??0)-(p.get(J.project.id)??0)||P.startIndex-J.startIndex||P.endIndex-J.endIndex);let L=[];C.forEach(P=>{let J=L.findIndex(ne=>P.startIndex>ne);J===-1?(J=L.length,L.push(P.endIndex)):L[J]=P.endIndex,P.track=J}),C.forEach(P=>{let J=i[P.startIndex],ne=i[P.endIndex];if(!J||!ne)return;let se=J.getBoundingClientRect(),le=ne.getBoundingClientRect(),G=document.createElement("div");G.className="project-bar",An(P.project.id)==="completed"&&G.classList.add("completed"),G.style.position="absolute";let ge=6,H=se.left-U.left+ge,me=le.right-se.left-ge*2;H<0&&(me+=H,H=0),H+me>U.width&&(me=Math.max(0,U.width-H)),me=Math.max(0,me),G.style.left=H+"px",G.style.width=me+"px";let Te=J.querySelector(".project-spacer"),Ie=(Te?Te.getBoundingClientRect().top:se.top)-U.top;G.style.top=Ie+P.track*(M+z)+"px",G.style.height=M+"px";let je=Ke(P.project.id);G.style.background=`linear-gradient(90deg, ${je}, ${je}dd)`,G.style.textShadow="0 1px 2px rgba(0,0,0,0.3)",G.style.fontWeight="600",G.style.color="white",G.style.padding="1px 6px",G.style.fontSize="10px",G.style.display="flex",G.style.alignItems="center",G.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)",G.style.pointerEvents="auto",G.style.cursor="pointer",G.style.zIndex="10",G.style.whiteSpace="nowrap",G.style.overflow="hidden",G.style.textOverflow="ellipsis";let Ce=`${Ue}-${String(qe+1).padStart(2,"0")}-01`,Lt=new Date(Ue,qe+1,0).getDate(),es=`${Ue}-${String(qe+1).padStart(2,"0")}-${String(Lt).padStart(2,"0")}`,Mn=P.project.startDate,rn=P.project.endDate||P.project.startDate,ht=Mn<Ce&&P.startIndex===f,ts=rn>es&&P.endIndex===h;ht&&G.classList.add("continues-left"),ts&&G.classList.add("continues-right"),G.style.borderTopLeftRadius=ht?"0":"6px",G.style.borderBottomLeftRadius=ht?"0":"6px",G.style.borderTopRightRadius=ts?"0":"6px",G.style.borderBottomRightRadius=ts?"0":"6px",G.textContent=P.project.name,G.onclick=lo=>{lo.stopPropagation(),Qe(P.project.id,"calendar",{month:qe,year:Ue})},e.appendChild(G)}),W.has(N)||W.set(N,{projectTracks:0,taskTracks:0}),W.get(N).projectTracks=L.length}),y.forEach((C,N)=>{C.sort((P,J)=>(w.get(P.task.id)??0)-(w.get(J.task.id)??0)||P.startIndex-J.startIndex||P.endIndex-J.endIndex);let L=[];C.forEach(P=>{let J=L.findIndex(ne=>P.startIndex>ne);J===-1?(J=L.length,L.push(P.endIndex)):L[J]=P.endIndex,P.track=J}),C.forEach(P=>{let J=P.task.startDate&&P.task.startDate.length===10&&P.task.startDate.includes("-"),ne=P.task.endDate&&P.task.endDate.length===10&&P.task.endDate.includes("-"),se=i[P.startIndex],le=i[P.endIndex];if(!se||!le)return;let G=se.getBoundingClientRect(),ge=le.getBoundingClientRect(),H=document.createElement("div");H.className="task-bar",P.task.status==="done"&&H.classList.add("done"),H.style.position="absolute";let me=6,Te=G.left-U.left+me,Ie=ge.right-G.left-me*2;Te<0&&(Ie+=Te,Te=0),Te+Ie>U.width&&(Ie=Math.max(0,U.width-Te)),Ie=Math.max(0,Ie),H.style.left=Te+"px",H.style.width=Ie+"px";let je=se.querySelector(".project-spacer"),Ce=(je?je.getBoundingClientRect().top:G.top)-U.top,Lt=W.get(N)?.projectTracks||0,es=Lt*(M+z),Mn=Lt>0?6:0;H.style.top=Ce+es+Mn+P.track*(_+x)+"px",H.style.height=_+"px";let rn=Up[P.task.priority]||"var(--accent-blue)";J?(H.style.borderLeftWidth="5px",H.style.borderLeftColor=rn):H.style.borderLeftWidth="1px",ne?(H.style.borderRightWidth="5px",H.style.borderRightColor=rn):H.style.borderRightWidth="1px",H.style.color="var(--text-primary)",H.style.padding="2px 6px",H.style.fontSize="11px",H.style.fontWeight="500",H.style.display="flex",H.style.alignItems="center",H.style.boxShadow="var(--shadow-sm)",H.style.pointerEvents="auto",H.style.cursor="pointer",H.style.zIndex="11",H.style.whiteSpace="nowrap",H.style.overflow="hidden",H.style.textOverflow="ellipsis";let ht=`${Ue}-${String(qe+1).padStart(2,"0")}-01`,ts=new Date(Ue,qe+1,0).getDate(),lo=`${Ue}-${String(qe+1).padStart(2,"0")}-${String(ts).padStart(2,"0")}`,zl=J?P.task.startDate:P.task.endDate,Yo=ne?P.task.endDate:P.task.startDate,Hl=zl<ht&&P.startIndex===f,ql=Yo>lo&&P.endIndex===h;Hl&&H.classList.add("continues-left"),ql&&H.classList.add("continues-right"),J&&H.classList.add("has-start-date"),ne&&H.classList.add("has-end-date"),H.style.borderTopLeftRadius=Hl?"0":"4px",H.style.borderBottomLeftRadius=Hl?"0":"4px",H.style.borderTopRightRadius=ql?"0":"4px",H.style.borderBottomRightRadius=ql?"0":"4px",H.textContent=P.task.title,H.onclick=Hb=>{Hb.stopPropagation(),ao(P.task.id)},e.appendChild(H)}),W.has(N)||W.set(N,{projectTracks:0,taskTracks:0}),W.get(N).taskTracks=L.length});let Z=n.querySelectorAll(".calendar-day .project-spacer"),F=new Map;Z.forEach(C=>{let N=parseInt(C.closest(".calendar-day").dataset.row,10),L=W.get(N)||{projectTracks:0,taskTracks:0},P=L.projectTracks>0?L.projectTracks*(M+z):0,J=L.taskTracks>0?L.taskTracks*(_+x):0,ne=L.projectTracks>0&&L.taskTracks>0?6:0,se=P+J+ne+(L.projectTracks>0||L.taskTracks>0?4:0);C.style.height=se+"px",F.set(N,se)}),e.style.opacity="1"}catch(e){console.error("[ProjectBars] Error rendering project/task bars:",e)}Oe("render",t,{taskCount:A.length,projectCount:B.length})}function lb(t){jI(t)}function LI(){let t=document.querySelector(".calendar-stage");if(!t||t.dataset.swipeReady==="true")return;t.dataset.swipeReady="true";let e=0,n=0,s=!1,o=!1;t.addEventListener("touchstart",r=>{if(r.touches.length!==1)return;let a=r.touches[0];e=a.clientX,n=a.clientY,s=!0,o=!1},{passive:!0}),t.addEventListener("touchmove",r=>{if(!s)return;let a=r.touches[0],i=a.clientX-e,l=a.clientY-n;o||(Math.abs(i)>12&&Math.abs(i)>Math.abs(l)?o=!0:Math.abs(l)>12&&(s=!1)),o&&r.preventDefault()},{passive:!1}),t.addEventListener("touchend",r=>{if(!s||(s=!1,!o))return;let a=r.changedTouches[0],i=a.clientX-e,l=a.clientY-n;if(Math.abs(i)<50||Math.abs(i)<Math.abs(l))return;let c=i<0?1:-1;lb(c)},{passive:!0}),t.addEventListener("touchcancel",()=>{s=!1,o=!1},{passive:!0})}document.addEventListener("DOMContentLoaded",()=>{LI()});function jI(t){let e=pf(Ue,qe,t);Ue=e.year,qe=e.month,op(),ye(),document.getElementById("calendar-view")&&ye()}function PI(){let t=new Date;qe=t.getMonth(),Ue=t.getFullYear(),op(),ye(),document.getElementById("calendar-view")&&ye()}function An(t){let e=A.filter(a=>a.projectId===t);if(e.length===0)return"planning";let n=e.every(a=>a.status==="done"),s=e.some(a=>a.status==="progress"||a.status==="review"),o=e.some(a=>a.status==="todo"),r=e.every(a=>a.status==="backlog");return n?"completed":s?"active":o?"planning":r?"backlog":"planning"}function NI(t){let e=Is(window.kanbanUpdatedFilter),n=typeof ln=="function"?ln():A.slice(),o=(e===null?n:n.filter(u=>Ln(u)>=e)).filter(u=>u.startDate&&u.endDate?t>=u.startDate&&t<=u.endDate:u.endDate?u.endDate===t:u.startDate?u.startDate===t:!1);R.calendarIncludeBacklog||(o=o.filter(u=>u.status!=="backlog")),o.sort((u,p)=>{let f=ke[u.priority]||0;return(ke[p.priority]||0)-f});let a=B.filter(u=>{let p=new Date(u.startDate),f=u.endDate?new Date(u.endDate):new Date(u.startDate),h=new Date(t);return h>=p&&h<=f});if(o.length===0&&a.length===0){let u=`No tasks or projects for ${xe(t)}. Would you like to create a new task?`;document.getElementById("calendar-create-message").textContent=u,document.getElementById("calendar-create-modal").classList.add("active"),window.pendingCalendarDate=t;return}let i=document.getElementById("day-items-modal"),l=document.getElementById("day-items-modal-title"),c=document.getElementById("day-items-modal-body");l.textContent=g("calendar.dayItemsTitle",{date:xe(t)}),window.dayItemsModalDate=t;let d="";a.length>0&&(d+='<div class="day-items-section">',d+=`<div class="day-items-section-title">\u{1F4CA} ${g("calendar.dayItemsProjects")}</div>`,a.forEach(u=>{let p=An(u.id);d+=`
                <div class="day-item" data-action="closeDayItemsAndShowProject" data-param="${u.id}">
                    <div class="day-item-title">${V(u.name)}</div>
                    <div class="day-item-meta" style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap;">
                        <span>${xe(u.startDate)} - ${xe(u.endDate)}</span>
                        <span class="project-status-badge ${p}">${da(p).toUpperCase()}</span>
                    </div>
                </div>
            `}),d+="</div>"),o.length>0&&(d+='<div class="day-items-section">',d+=`<div class="day-items-section-title">\u2705 ${g("calendar.dayItemsTasks")}</div>`,o.forEach(u=>{let p="";if(u.projectId){let m=B.find(y=>y.id===u.projectId);m?p=`<span class="project-indicator" style="background-color: ${Ke(u.projectId)}; color: white; padding: 1px 6px; border-radius: 8px; font-size: 10px; margin-right: 6px; text-shadow: 0 1px 2px rgba(0,0,0,0.3); font-weight: 600;">${V(m.name)}</span>`:p=g("tasks.projectIndicatorNone")}else p=g("tasks.projectIndicatorNone");let f=`<span class="status-badge ${u.status}" style="padding: 2px 8px; font-size: 10px; font-weight: 600;">${pt(u.status)}</span>`,h=At(u.priority||"").toUpperCase();d+=`
                <div class="day-item" data-action="closeDayItemsAndOpenTask" data-param="${u.id}">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 8px;">
                        <div class="day-item-title" style="flex: 1; min-width: 0;">${V(u.title)}</div>
                        <div class="day-item-meta" style="display: flex; align-items: center; gap: 6px; flex-shrink: 0;"><span class="task-priority priority-${u.priority}">${h}</span>${f}</div>
                    </div>
                    <div style="margin-top: 8px; font-size: 11px;">${p}</div>
                </div>
            `}),d+="</div>"),c.innerHTML=d,i.classList.add("active")}function Rl(){document.getElementById("day-items-modal").classList.remove("active")}function BI(t){let e=document.getElementById("day-items-modal");e&&t.target===e&&Rl()}function OI(){let t=window.dayItemsModalDate;Rl(),t&&(Bl(),setTimeout(()=>{let e=document.getElementById("task-modal");if(!e)return;let n=e.querySelector('#task-form input[name="endDate"]');if(!n)return;let s=n.closest(".date-input-wrapper");if(!s)return;let o=s.querySelector(".date-display");!o||!o._flatpickr||(n.value=t,o._flatpickr.setDate(new Date(t),!1))},100)),window.dayItemsModalDate=null}document.addEventListener("keydown",function(t){let e=document.getElementById("day-items-modal");e&&e.classList.contains("active")&&t.key==="Escape"&&(t.preventDefault(),Rl())});function rp(){document.getElementById("project-confirm-modal").classList.remove("active"),document.getElementById("delete-tasks-checkbox").checked=!1,document.getElementById("project-confirm-error").classList.remove("show"),Ss=null}function RI(){let t=document.getElementById("delete-account-modal");t.classList.add("active");let e=t.querySelector('[data-i18n="settings.deleteAccount.warning"]'),n=t.querySelector('[data-i18n="settings.deleteAccount.confirmText"]');e&&e.removeAttribute("data-i18n"),n&&n.removeAttribute("data-i18n"),Il(t),e&&(e.innerHTML=g("settings.deleteAccount.warning")),n&&(n.innerHTML=g("settings.deleteAccount.confirmText"));let s=document.getElementById("delete-account-confirm-input");s.value="",s.focus();let o=function(r){let a=r.target.selectionStart,i=r.target.selectionEnd;r.target.value=r.target.value.toLowerCase(),r.target.setSelectionRange(a,i)};s.addEventListener("input",o),document.getElementById("delete-account-confirm-error").classList.remove("show"),s.addEventListener("keydown",function(r){r.key==="Enter"&&(r.preventDefault(),cb())},{once:!0})}function Sl(){document.getElementById("delete-account-modal").classList.remove("active");let e=document.getElementById("delete-account-confirm-input");e.value="",document.getElementById("delete-account-confirm-error").classList.remove("show");let n=e.cloneNode(!0);e.parentNode.replaceChild(n,e)}async function cb(){let t=document.getElementById("delete-account-confirm-input"),e=document.getElementById("delete-account-confirm-error");if(t.value.trim().toLowerCase()!=="delete"){e.classList.add("show"),t.focus();return}let s=localStorage.getItem("authToken");if(!s){Y(g("error.unauthorized")),Sl();return}try{let o=await fetch("/api/auth/delete-account",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`}}),r=await o.json();if(!o.ok){Y(r.error||g("error.deleteAccountFailed"));return}localStorage.clear(),sessionStorage.clear(),Sl(),Et(g("settings.deleteAccount.success")),setTimeout(()=>{window.location.href="/auth.html"},1500)}catch(o){console.error("Delete account error:",o),Y(g("error.deleteAccountFailed"))}}function sa(t){window.pendingModalToClose=t,document.getElementById("unsaved-changes-modal").classList.add("active")}function db(){document.getElementById("unsaved-changes-modal").classList.remove("active")}function $I(){let t=window.pendingModalToClose||"task-modal";if(db(),t==="task-modal")qt=null;else if(t==="settings-modal"){window.initialSettingsFormState=null,window.settingsFormIsDirty=!1;let n=document.getElementById("settings-form")?.querySelector(".settings-btn-save");n&&(n.classList.remove("dirty"),n.disabled=!0)}window.pendingModalToClose=null,Bt(t)}function ub(){document.getElementById("review-status-confirm-modal").classList.remove("active"),window.pendingReviewStatusToggle&&(window.pendingReviewStatusToggle.checked=!0,window.pendingReviewStatusToggle.dispatchEvent(new Event("change",{bubbles:!0})),typeof window.markSettingsDirtyIfNeeded=="function"&&window.markSettingsDirtyIfNeeded()),window.pendingReviewTaskMigration=null,window.pendingReviewStatusToggle=null}async function FI(){let t=window.pendingReviewTaskMigration?[...window.pendingReviewTaskMigration]:[];if(ub(),t&&t.length>0){let s=t.map(o=>o.id);A.forEach(o=>{s.includes(o.id)&&(o.status="progress")}),await ot()}let e=document.getElementById("enable-review-status-toggle");e&&(e.checked=!1,window.enableReviewStatus=!1,localStorage.setItem("enableReviewStatus","false"),R.enableReviewStatus=!1,await Ml(),pp(),ft());let n=document.getElementById("save-settings-btn");window.initialSettingsFormState=null,window.settingsFormIsDirty=!1,n&&(n.classList.remove("dirty"),n.disabled=!0),Bt("settings-modal"),Et(g("success.settingsSaved"))}function ap(){document.getElementById("calendar-create-modal").classList.remove("active"),window.pendingCalendarDate=null}function zI(){let t=window.pendingCalendarDate;ap(),t&&(Bl(),setTimeout(()=>{let e=document.getElementById("task-modal");if(!e)return;let n=e.querySelector('#task-form input[name="endDate"]');if(!n)return;let s=n.closest(".date-input-wrapper");if(!s)return;let o=s.querySelector(".date-display");!o||!o._flatpickr||(n.value=t,o._flatpickr.setDate(new Date(t),!1))},100))}document.addEventListener("DOMContentLoaded",function(){let t=document.getElementById("calendar-create-modal");t&&t.addEventListener("click",function(e){e.target===t&&ap()})});async function pb(){let t=document.getElementById("project-confirm-input"),e=document.getElementById("project-confirm-error"),n=t.value,s=document.getElementById("delete-tasks-checkbox");if(n!=="delete"){e.classList.add("show"),t.focus();return}let o=parseInt(Ss,10),r=B.find(l=>l.id===o),a=s.checked;a&&(A=A.filter(l=>l.projectId!==o));let i=zp(o,B,A,!a);B=i.projects,window.historyService&&r&&window.historyService.recordProjectDeleted(r),!a&&i.tasks&&(A=i.tasks),rp(),de.projectsSortedView=null,window.location.hash="#projects",Ze("projects"),so(),Promise.all([Rt().catch(l=>{console.error("Failed to save projects:",l),Y(g("error.saveChangesFailed"))}),a?ot().catch(l=>{console.error("Failed to save tasks:",l),Y(g("error.saveChangesFailed"))}):Promise.resolve()])}function Qe(t,e,n){let s=Fe("projects","details",{projectId:t});if(e!==void 0){if(st=e,e==="calendar"){let b=n&&Number.isInteger(n.month)?n.month:qe,w=n&&Number.isInteger(n.year)?n.year:Ue;Tn={month:b,year:w}}}else st||(st="projects");window.location.hash=`project-${t}`;let o=B.find(b=>b.id===t);if(!o){Oe("projects",s,{projectId:t,found:!1});return}$e()&&window.scrollTo({top:0,behavior:"smooth"}),document.querySelectorAll(".page").forEach(b=>b.classList.remove("active")),document.getElementById("project-details").classList.add("active");let r=document.querySelector(".user-menu");r&&(r.style.display="none");let a=A.filter(b=>b.projectId===t),i=a.filter(b=>b.status==="done"),l=a.filter(b=>b.status==="progress"),c=a.filter(b=>b.status==="review"),d=a.filter(b=>b.status==="todo"),u=a.filter(b=>b.status==="backlog"),p=a.length>0?Math.round(i.length/a.length*100):0,f=An(t),h=o.startDate?new Date(o.startDate):null,m=o.endDate?new Date(o.endDate):new Date,y=h&&Number.isFinite(h.getTime())&&Number.isFinite(m.getTime())?Math.ceil((m-h)/(1e3*60*60*24)):null,k=Number.isFinite(y)?g("projects.details.durationDays",{count:y}):"-",S=`
        <div class="project-details-header">
                    <div class="project-details-title">
                        <span id="project-title-display" data-action="editProjectTitle" data-param="${t}" data-param2="${V(o.name).replace(/'/g,"&#39;")}" style="font-size: 32px; font-weight: 700; color: var(--text-primary); cursor: pointer;">${V(o.name)}</span>
                        <div id="project-title-edit" style="display: none;">
                            <input type="text" id="project-title-input" class="editable-project-title" value="${V(o.name)}" style="font-size: 32px; font-weight: 700;">
                            <button class="title-edit-btn confirm" data-action="saveProjectTitle" data-param="${t}">\u2713</button>
                            <button class="title-edit-btn cancel" data-action="cancelProjectTitle">\u2715</button>
                        </div>
                        <span class="project-status-badge ${f}" data-action="showStatusInfoModal">${da(f).toUpperCase()}</span>
                        <button class="back-btn" data-action="${st==="dashboard"?"backToDashboard":st==="calendar"?"backToCalendar":"backToProjects"}" style="padding: 8px 12px; font-size: 14px; display: flex; align-items: center; gap: 6px; margin-left: 12px;">${g(st==="dashboard"?"projects.backTo.dashboard":st==="calendar"?"projects.backTo.calendar":"projects.backTo.projects")}</button>
                        <div style="margin-left: auto; position: relative;">
                            <button type="button" class="options-btn" id="project-options-btn" data-action="toggleProjectMenu" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:20px;padding:4px;line-height:1;">\u22EF</button>
                            <div class="options-menu" id="project-options-menu" style="position:absolute;top:calc(100% + 8px);right:0;display:none;">
                                <button type="button" class="duplicate-btn" data-action="handleDuplicateProject" data-param="${t}" style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:none;border:none;color:var(--text-primary);cursor:pointer;font-size:14px;width:100%;text-align:left;border-radius:4px;">\u{1F4CB} ${g("projects.duplicate.title")}</button>
                                <button type="button" class="delete-btn" data-action="handleDeleteProject" data-param="${t}">\u{1F5D1}\uFE0F ${g("projects.delete.title")}</button>
                            </div>
                        </div>
	                    </div>

	                    <div class="modal-tabs project-details-tabs">
	                        <button type="button" class="modal-tab active" data-tab="details">${g("projects.details.tab.details")}</button>
	                        <button type="button" class="modal-tab" data-tab="history">${g("projects.details.tab.history")}</button>
	                    </div>

	                    <div class="modal-tab-content active" id="project-details-tab">
		                    <div class="project-details-description">
		                        <textarea class="editable-description" id="project-description-editor">${o.description||""}</textarea>
		                    </div>
                    <div class="project-timeline">
                        <div class="timeline-item">
                            <div class="timeline-label">${g("projects.details.startDate")}</div>
                            <input type="text" class="form-input date-display editable-date datepicker"
                                placeholder="dd/mm/yyyy" maxLength="10"
                                value="${o.startDate?xe(o.startDate):""}"
                                data-project-id="${t}" data-field="startDate">
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-label">${g("projects.details.endDate")}</div>
                                <input type="text" class="form-input date-display editable-date datepicker"
                                    placeholder="dd/mm/yyyy" maxLength="10"
                                    value="${o.endDate?xe(o.endDate):""}"
                                    data-project-id="${t}" data-field="endDate">
                        </div>
	                        <div class="timeline-item">
	                            <div class="timeline-label">${g("projects.details.duration")}</div>
	                            <div class="timeline-value">${k}</div>
	                        </div>
                        <div class="timeline-item">
                            <div class="timeline-label">${g("projects.details.created")}</div>
                            <div class="timeline-value">${xe(o.createdAt?.split("T")[0])}</div>
                        </div>
                        <div class="timeline-item" style="position: relative;">
                            <div class="timeline-label">${g("projects.details.calendarColor")}</div>
                            <div class="color-picker-container" style="position: relative;">
                                <div class="current-color" 
                                     style="background-color: ${Ke(t)}; width: 20px; height: 20px; border-radius: 4px; border: 2px solid var(--border-color); cursor: pointer; display: inline-block;"
                                     data-action="toggleProjectColorPicker" data-param="${t}">
                                </div>
                                <div class="color-picker-dropdown" id="color-picker-${t}" style="display: none; position: absolute; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 8px; margin-top: 4px; z-index: 1000; left: 0; top: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                                    <div class="color-grid" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px;">
                                        ${er.map(b=>`
                                            <div class="color-option" 
                                                 style="width: 24px; height: 24px; background-color: ${b}; border-radius: 4px; cursor: pointer; border: 2px solid ${b===Ke(t)?"white":"transparent"};"
                                                 data-action="updateProjectColor" data-param="${t}" data-param2="${b}">
                                            </div>
                                        `).join("")}
                                    </div>
                                    <div class="color-picker-custom" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-light); display: flex; align-items: center; justify-content: space-between; gap: 8px; position: relative;">
                                        <span style="font-size: 12px; color: var(--text-muted);">${g("projects.details.customColor")}</span>
                                        <div 
                                            class="custom-color-swatch" 
                                            data-action="openCustomProjectColorPicker" 
                                            data-param="${t}"
                                            style="width: 24px; height: 24px; background-color: ${Ke(t)}; border-radius: 4px; cursor: pointer; border: 2px solid transparent; box-sizing: border-box;">
                                        </div>
	                                        <input 
	                                            type="color" 
	                                            id="project-color-input-${t}"
	                                            class="project-color-input" 
	                                            data-project-id="${t}"
	                                            value="${Ke(t)}"
	                                            style="position: absolute; opacity: 0; pointer-events: none; width: 0; height: 0;">
	                                    </div>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="timeline-item" style="grid-column: 1 / -1;">
	                            <div class="timeline-label">${g("projects.modal.tagsLabel")}</div>
	                            <div style="margin-top: 8px;">
	                                <div id="project-details-tags-display" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; min-height: 28px;"></div>
	                                <div style="display: flex; gap: 8px;">
	                                    <input type="text" id="project-details-tag-input" class="form-input" placeholder="${g("projects.modal.addTagPlaceholder")}" style="flex: 1;">
	                                    <button type="button" class="btn-secondary" data-action="addProjectDetailsTag" data-param="${t}">+</button>
	                                </div>
	                            </div>
	                        </div>
	                    </div>

	                    <div class="project-progress-section">
                    <div class="progress-header">
                        <div class="progress-title">${g("projects.details.progressOverview")}</div>
                        <div class="progress-percentage">${p}%</div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: ${p}%"></div>
                    </div>
                    <div class="progress-stats">
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="backlog" title="${g("projects.details.viewBacklog")}">
                            <div class="progress-stat-number" style="color: var(--text-muted);">${u.length}</div>
                            <div class="progress-stat-label">${g("tasks.status.backlog")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="todo" title="${g("projects.details.viewTodo")}">
                            <div class="progress-stat-number" style="color: var(--text-muted);">${d.length}</div>
                            <div class="progress-stat-label">${g("tasks.status.todo")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="progress" title="${g("projects.details.viewProgress")}">
                            <div class="progress-stat-number" style="color: var(--accent-blue);">${l.length}</div>
                            <div class="progress-stat-label">${g("tasks.status.progress")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="review" title="${g("projects.details.viewReview")}">
                            <div class="progress-stat-number" style="color: var(--accent-amber);">${c.length}</div>
                            <div class="progress-stat-label">${g("tasks.status.review")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="done" title="${g("projects.details.viewCompleted")}">
                            <div class="progress-stat-number" style="color: var(--accent-green);">${i.length}</div>
                            <div class="progress-stat-label">${g("tasks.status.done")}</div>
                        </div>
                    </div>
                </div>
                
                <div class="project-tasks-section">
                    <div class="section-header">
                        <div class="section-title">${g("projects.details.tasksTitle",{count:a.length})}</div>
                        <button class="add-btn" data-action="openTaskModalForProject" data-param="${t}">${g("tasks.addButton")}</button>
                    </div>
                    <div id="project-tasks-list">
                        ${a.length===0?`<div class="empty-state">${g("tasks.empty.epic")}</div>`:a.sort((b,w)=>{let I=ke[b.priority]||1;return(ke[w.priority]||1)-I}).map(b=>`
                                        <div class="project-task-item" data-action="openTaskDetails" data-param="${b.id}">
                                            <div class="project-task-info">
                                                <div class="project-task-title">${b.title}</div>
                                                <div class="project-task-meta">${b.endDate?`${g("tasks.endDatePrefix")}${xe(b.endDate)}`:g("tasks.noDatesSet")}</div>
                                                ${b.tags&&b.tags.length>0?`
                                                    <div class="task-tags" style="margin-top: 4px;">
                                                        ${b.tags.map(w=>`<span style="background-color: ${sn(w)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${V(w.toUpperCase())}</span>`).join(" ")}
                                                    </div>
                                                `:""}
                                            </div>
                                            <div class="project-task-priority">
                                                <div class="task-priority priority-${b.priority}">${At(b.priority).toUpperCase()}</div>
                                            </div>
                                            <div class="project-task-status-col">
                                                <div class="status-badge ${b.status}">
                                                    ${pt(b.status)}
                                                </div>
                                            </div>
                                        </div>
                            `).join("")}
                    </div>
                </div>

                </div>

	                <div class="modal-tab-content" id="project-history-tab">
	                    <div class="project-history-section">
                    <div class="section-header">
                        <div class="section-title">\u{1F4DC} ${g("projects.details.changeHistory")}</div>
                    </div>
                    <div class="history-timeline-inline" id="project-history-timeline-${t}">
                        <!-- Timeline will be populated by JavaScript -->
                    </div>
                    <div class="history-empty-inline" id="project-history-empty-${t}" style="display: none;">
                        <div style="font-size: 36px; margin-bottom: 12px; opacity: 0.3;">\u{1F4DC}</div>
                        <p style="color: var(--text-muted); text-align: center;">${g("projects.details.noChanges")}</p>
                    </div>
	                    </div>
	                </div>
	        </div>
	            `;document.getElementById("project-details-content").innerHTML=S;let T=document.getElementById("project-description-editor");if(T){let b=()=>oo(t,"description",T.value,{render:!1}),w=typeof rr=="function"?rr(b,500):b;T.addEventListener("input",w),T.addEventListener("blur",b)}HI(t);let D=document.getElementById(`project-color-input-${t}`);D&&D.addEventListener("change",b=>{pD(t,b.target.value)}),setTimeout(()=>{document.querySelectorAll("input.datepicker").forEach(b=>{b._flatpickrInstance&&(b._flatpickrInstance.destroy(),delete b._flatpickrInstance)}),Xn()},50),ga(o.tags||[],t);let E=document.getElementById("project-details-tag-input");E&&(E.replaceWith(E.cloneNode(!0)),document.getElementById("project-details-tag-input").addEventListener("keydown",function(w){w.key==="Enter"&&(w.preventDefault(),Mb(t))})),Oe("projects",s,{projectId:t,taskCount:a.length,completionPercentage:p})}function HI(t){let e=document.getElementById("project-details-content");if(!e)return;let n=e.querySelector(".project-details-tabs");if(!n)return;let s=e.querySelector("#project-details-tab"),o=e.querySelector("#project-history-tab");if(!s||!o)return;let r=a=>{n.querySelectorAll(".modal-tab").forEach(l=>l.classList.remove("active")),e.querySelectorAll(".modal-tab-content").forEach(l=>l.classList.remove("active"));let i=n.querySelector(`.modal-tab[data-tab="${a}"]`);if(i&&i.classList.add("active"),a==="history"){o.classList.add("active"),_u(t);let l=o.querySelector(".project-history-section");l&&(l.scrollTop=0)}else s.classList.add("active")};n.querySelectorAll(".modal-tab").forEach(a=>{a.addEventListener("click",()=>{r(a.dataset.tab)})}),r("details")}function qI(t){Ss=t,fb()}function fb(){let t=Ss;if(!t)return;let e=A.filter(a=>a.projectId===t),n=document.getElementById("delete-tasks-checkbox"),s=n?n.closest('div[style*="margin: 16px"]'):null;s&&(e.length===0?s.style.display="none":s.style.display="block"),document.getElementById("project-confirm-modal").classList.add("active");let o=document.getElementById("project-confirm-input");o.value="",o.focus();let r=function(a){let i=a.target.selectionStart,l=a.target.selectionEnd;a.target.value=a.target.value.toLowerCase(),a.target.setSelectionRange(i,l)};o.addEventListener("input",r),document.addEventListener("keydown",function(a){let i=document.getElementById("project-confirm-modal");!i||!i.classList.contains("active")||(a.key==="Escape"?(a.preventDefault(),rp()):a.key==="Enter"&&(a.preventDefault(),pb()))})}var ip=null;function UI(t){ip=t;let e=document.getElementById("project-duplicate-modal");if(!B.find(d=>d.id===t))return;let s=A.filter(d=>d.projectId===t),o=document.getElementById("duplicate-tasks-checkbox"),r=document.getElementById("task-naming-options");s.length===0?(o&&(o.checked=!1,o.disabled=!0),r&&(r.style.display="none")):(o&&(o.checked=!0,o.disabled=!1),r&&(r.style.display="block"));let a=document.querySelector('input[name="task-naming"][value="none"]');a&&(a.checked=!0);let i=document.getElementById("task-prefix-input"),l=document.getElementById("task-suffix-input");i&&(i.value="",i.disabled=!0),l&&(l.value="",l.disabled=!0),e.classList.add("active"),o&&o.addEventListener("change",function(){r&&(r.style.display=this.checked?"block":"none")}),document.querySelectorAll('input[name="task-naming"]').forEach(d=>{d.addEventListener("change",function(){i&&(i.disabled=this.value!=="prefix"),l&&(l.disabled=this.value!=="suffix"),this.value==="prefix"&&i?setTimeout(()=>i.focus(),100):this.value==="suffix"&&l&&setTimeout(()=>l.focus(),100)})})}function hb(){document.getElementById("project-duplicate-modal").classList.remove("active"),ip=null}async function _I(){let t=ip;if(!t)return;let e=B.find(a=>a.id===t);if(!e)return;let n=document.getElementById("duplicate-tasks-checkbox"),s=n&&n.checked,o=a=>a;if(s){let a=document.querySelector('input[name="task-naming"]:checked')?.value||"none";if(a==="prefix"){let i=document.getElementById("task-prefix-input")?.value||"";i&&(o=l=>`${i}${l}`)}else if(a==="suffix"){let i=document.getElementById("task-suffix-input")?.value||"";i&&(o=l=>`${l}${i}`)}}let r={id:Ot,name:`Copy - ${e.name}`,description:e.description||"",startDate:e.startDate||"",endDate:e.endDate||"",tags:e.tags?[...e.tags]:[],createdAt:new Date().toISOString()};Ot++,B.push(r),s&&A.filter(i=>i.projectId===t).forEach(i=>{let l={...i,id:St,title:o(i.title),projectId:r.id,status:"backlog",createdAt:new Date().toISOString(),tags:i.tags?[...i.tags]:[],attachments:i.attachments?JSON.parse(JSON.stringify(i.attachments)):[]};St++,A.push(l)}),window.historyService&&window.historyService.recordProjectCreated(r),hb(),de.projectsSortedView=null,Et(s?g("projects.duplicate.successWithTasks",{name:r.name}):g("projects.duplicate.success",{name:r.name})),Promise.all([Rt().catch(a=>{console.error("Failed to save projects:",a),Y(g("error.saveChangesFailed"))}),s?ot().catch(a=>{console.error("Failed to save tasks:",a),Y(g("error.saveChangesFailed"))}):Promise.resolve()]),Qe(r.id,"projects")}function VI(){document.getElementById("project-details").classList.remove("active");let t=document.querySelector(".user-menu");t&&(t.style.display="block");try{window.location.hash="#projects"}catch{}Ze("projects"),document.querySelectorAll(".nav-item").forEach(e=>e.classList.remove("active")),document.querySelector('.nav-item[data-page="projects"]').classList.add("active"),Mt()}function WI(){document.getElementById("project-details").classList.remove("active");let t=document.querySelector(".user-menu");if(t&&(t.style.display="block"),Tn&&Number.isInteger(Tn.month)&&Number.isInteger(Tn.year)){qe=Tn.month,Ue=Tn.year;try{op()}catch{}}oa(),ye()}function KI(t){Bl();let e=document.getElementById("task-modal"),n=e.querySelector("#hidden-project"),s=e.querySelector("#project-current .project-text"),o=B.find(r=>String(r.id)===String(t));if(n&&(n.value=String(t||"")),s&&o){let r=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Ke(o.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;s.innerHTML=r+V(o.name)}typeof Zn=="function"&&Zn(),setTimeout(()=>Cb(),150)}function JI(){let t=document.getElementById("settings-modal");if(!t)return;let e=t.querySelector("#settings-form"),n=e.querySelector("#user-name"),s=e.querySelector("#auto-start-date-toggle"),o=e.querySelector("#auto-end-date-toggle"),r=e.querySelector("#enable-review-status-toggle"),a=e.querySelector("#calendar-include-backlog-toggle"),i=e.querySelector("#debug-logs-toggle"),l=e.querySelector("#history-sort-order"),c=e.querySelector("#language-select"),d=window.authSystem?.getCurrentUser();n.value=d?.name||"";let u=e.querySelector("#user-email");u.value=d?.email||R.notificationEmail||"";let p=e.querySelector("#email-notifications-enabled"),f=e.querySelector("#email-notifications-weekdays-only"),h=e.querySelector("#email-notifications-include-start-dates"),m=e.querySelector("#email-notifications-include-backlog"),y=e.querySelector("#email-notification-time"),k=e.querySelector("#email-notification-time-trigger"),S=e.querySelector("#email-notification-time-value"),T=e.querySelector("#email-notification-timezone"),D=e.querySelector("#email-notification-timezone-trigger"),E=e.querySelector("#email-notification-timezone-value"),b=e.querySelector("#email-notification-details");if(p&&(p.checked=R.emailNotificationsEnabled!==!1),f&&(f.checked=!!R.emailNotificationsWeekdaysOnly),h&&(h.checked=!!R.emailNotificationsIncludeStartDates),m&&(m.checked=!!R.emailNotificationsIncludeBacklog),y){let Z=Zl(or(R.emailNotificationTime)||"09:00",30);y.value=Ql(Z||"09:00","08:00","18:00")||"09:00",S&&(S.textContent=y.value)}if(T){let Z=R.emailNotificationTimeZone;if(!Z)try{let F=Intl.DateTimeFormat().resolvedOptions().timeZone;["America/Argentina/Buenos_Aires","Atlantic/Canary","Europe/Madrid","UTC"].includes(F)?Z=F:Z="Atlantic/Canary"}catch{Z="Atlantic/Canary"}T.value=String(Z),E&&(E.textContent=T.options?.[T.selectedIndex]?.textContent||T.value||"")}let w=()=>{let Z=!!p?.checked;b&&(b.classList.toggle("is-collapsed",!Z),b.setAttribute("aria-hidden",Z?"false":"true")),f&&(f.disabled=!Z),h&&(h.disabled=!Z),y&&(y.disabled=!Z),k&&(k.disabled=!Z),T&&(T.disabled=!Z),D&&(D.disabled=!Z)};w(),s&&(s.checked=!!R.autoSetStartDateOnStatusChange),o&&(o.checked=!!R.autoSetEndDateOnStatusChange),r&&(r.checked=!!R.enableReviewStatus),a&&(a.checked=!!R.calendarIncludeBacklog),i&&(i.checked=!!R.debugLogsEnabled),l.value=R.historySortOrder,c&&(c.value=gs());let I=e.querySelector("#workspace-logo-input");I&&(I.value=""),Ut.hasPendingChange=!1,Ut.dataUrl=null,_t.hasPendingChange=!1,_t.dataUrl=null;let M=e.querySelector("#workspace-logo-preview"),z=e.querySelector("#workspace-logo-clear-btn");M&&z&&(R.customWorkspaceLogo?(M.style.display="block",M.style.backgroundImage=`url(${R.customWorkspaceLogo})`,z.style.display="inline-flex"):(M.style.display="none",M.style.backgroundImage="",z.style.display="none"));let _=new CustomEvent("refresh-workspace-logo-ui");document.dispatchEvent(_);let x=e.querySelector("#user-avatar-input");x&&(x.value=""),zo(),window.initialSettingsFormState={userName:n.value||"",notificationEmail:u.value||"",emailNotificationsEnabled:!!p?.checked,emailNotificationsWeekdaysOnly:!!f?.checked,emailNotificationsIncludeStartDates:!!h?.checked,emailNotificationsIncludeBacklog:!!m?.checked,emailNotificationTime:y?.value||"",emailNotificationTimeZone:T?.value||"",autoSetStartDateOnStatusChange:!!R.autoSetStartDateOnStatusChange,autoSetEndDateOnStatusChange:!!R.autoSetEndDateOnStatusChange,enableReviewStatus:!!R.enableReviewStatus,calendarIncludeBacklog:!!a?.checked,debugLogsEnabled:!!i?.checked,historySortOrder:R.historySortOrder||"newest",language:gs(),logoState:R.customWorkspaceLogo?"logo-set":"logo-none",avatarState:window.authSystem?.getCurrentUser?.()?.avatarDataUrl?"avatar-set":"avatar-none"};let j=e.querySelector(".settings-btn-save");if(j&&(j.classList.remove("dirty"),j.disabled=!0),!e.__settingsDirtyBound){e.__settingsDirtyBound=!0;let Z=()=>{if(!window.initialSettingsFormState)return;let F=Ut.hasPendingChange?"draft-changed":R.customWorkspaceLogo?"logo-set":"logo-none",C=_t.hasPendingChange?"draft-changed":window.authSystem?.getCurrentUser?.()?.avatarDataUrl?"avatar-set":"avatar-none",N={userName:n.value||"",notificationEmail:u.value||"",emailNotificationsEnabled:!!p?.checked,emailNotificationsWeekdaysOnly:!!f?.checked,emailNotificationsIncludeStartDates:!!h?.checked,emailNotificationsIncludeBacklog:!!m?.checked,emailNotificationTime:y?.value||"",emailNotificationTimeZone:T?.value||"",autoSetStartDateOnStatusChange:!!s?.checked,autoSetEndDateOnStatusChange:!!o?.checked,enableReviewStatus:!!r?.checked,calendarIncludeBacklog:!!a?.checked,debugLogsEnabled:!!i?.checked,historySortOrder:l.value,language:c?.value||gs(),logoState:F,avatarState:C},L=N.userName!==window.initialSettingsFormState.userName||N.notificationEmail!==window.initialSettingsFormState.notificationEmail||N.emailNotificationsEnabled!==window.initialSettingsFormState.emailNotificationsEnabled||N.emailNotificationsWeekdaysOnly!==window.initialSettingsFormState.emailNotificationsWeekdaysOnly||N.emailNotificationsIncludeBacklog!==window.initialSettingsFormState.emailNotificationsIncludeBacklog||N.emailNotificationsIncludeStartDates!==window.initialSettingsFormState.emailNotificationsIncludeStartDates||N.emailNotificationTime!==window.initialSettingsFormState.emailNotificationTime||N.emailNotificationTimeZone!==window.initialSettingsFormState.emailNotificationTimeZone||N.autoSetStartDateOnStatusChange!==window.initialSettingsFormState.autoSetStartDateOnStatusChange||N.autoSetEndDateOnStatusChange!==window.initialSettingsFormState.autoSetEndDateOnStatusChange||N.enableReviewStatus!==window.initialSettingsFormState.enableReviewStatus||N.calendarIncludeBacklog!==window.initialSettingsFormState.calendarIncludeBacklog||N.debugLogsEnabled!==window.initialSettingsFormState.debugLogsEnabled||N.historySortOrder!==window.initialSettingsFormState.historySortOrder||N.language!==window.initialSettingsFormState.language||N.logoState!==window.initialSettingsFormState.logoState||N.avatarState!==window.initialSettingsFormState.avatarState;j&&(L?(j.classList.add("dirty"),j.disabled=!1):(j.classList.remove("dirty"),j.disabled=!0)),window.settingsFormIsDirty=L};window.markSettingsDirtyIfNeeded=Z,[n,u,p,f,m,h,y,T,s,o,r,a,i,l,c,I,x].filter(Boolean).forEach(F=>{F.addEventListener("change",Z),(F.tagName==="INPUT"&&F.type==="text"||F.type==="email")&&F.addEventListener("input",Z)}),p&&!p.__emailInputsBound&&(p.__emailInputsBound=!0,p.addEventListener("change",()=>{w()})),k&&!k.__notificationTimeBound&&(k.__notificationTimeBound=!0,k.addEventListener("click",F=>{if(F.preventDefault(),F.stopPropagation(),!!!p?.checked)return;if(_e&&_e.style.display!=="none"){qo();return}cD(k,y,S)})),D&&T&&!D.__notificationTimeZoneBound&&(D.__notificationTimeZoneBound=!0,D.addEventListener("click",F=>{if(F.preventDefault(),F.stopPropagation(),!!!p?.checked)return;if(Re&&Re.style.display!=="none"){Ho();return}lD(D,T,E)})),T&&E&&!T.__timezoneValueBound&&(T.__timezoneValueBound=!0,T.addEventListener("change",()=>{E.textContent=T.options?.[T.selectedIndex]?.textContent||T.value||""}))}t.classList.add("active");let U=t.querySelector(".settings-modal-body");U&&(U.scrollTop=0);let W=t.querySelector("#reset-pin-btn");W&&!W.dataset.listenerAttached&&(W.dataset.listenerAttached="true",W.addEventListener("click",function(Z){Z.preventDefault(),dI()}))}function ma(){let t=document.getElementById("shared-user-dropdown");t&&t.classList.remove("active")}function mb(){let t=document.getElementById("shared-user-avatar"),e=document.getElementById("shared-user-dropdown");if(t&&e){let n=t.cloneNode(!0);t.parentNode.replaceChild(n,t),n.addEventListener("click",function(s){s.stopPropagation(),ks(),e.classList.toggle("active")}),e.addEventListener("click",function(s){s.target.closest(".dropdown-item:not(.disabled)")&&ma()})}}function lp(t,e){let n=document.querySelector(".user-name"),s=document.getElementById("shared-user-avatar");if(n&&(n.textContent=t),s){let o=t.split(" ").filter(Boolean),r="NL";o.length>0&&(o.length===1?r=o[0].slice(0,2).toUpperCase():r=(o[0][0]+o[o.length-1][0]).toUpperCase()),e?(s.classList.add("has-image"),s.style.backgroundImage=`url(${e})`,s.textContent=""):(s.classList.remove("has-image"),s.style.backgroundImage="",s.textContent=r)}}function GI(){let t=window.authSystem?.getCurrentUser();if(!t)return;lp(t.name,t.avatarDataUrl);let e=document.querySelector(".user-email");e&&(e.textContent=t.email||t.username)}document.addEventListener("click",function(t){t.target.closest(".user-menu")||ma(),t.target.closest(".notify-menu")||ks()});function gb(){let e=document.documentElement.getAttribute("data-theme")==="dark"?"Nautilus_logo.png":"Nautilus_logo_light.png";document.querySelectorAll('img.logo, img[class*="boot-logo"]').forEach(n=>{n.closest(".overlay")||n.closest(".auth-overlay")||(n.src=e)})}function cp(){let t=document.getElementById("theme-text");if(!t)return;let e=document.documentElement.getAttribute("data-theme")==="dark";t.textContent=g(e?"menu.lightMode":"menu.darkMode")}function YI(){let t=document.documentElement;t.getAttribute("data-theme")==="dark"?(t.removeAttribute("data-theme"),localStorage.setItem("theme","light")):(t.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")),cp(),gb(),typeof ra=="function"&&ra()}var XI=localStorage.getItem("theme");XI==="dark"&&document.documentElement.setAttribute("data-theme","dark");cp();gb();var El=!1;document.querySelector(".resizer").addEventListener("mousedown",function(t){El=!0,this.classList.add("dragging"),document.body.style.cursor="col-resize",document.body.style.userSelect="none",t.preventDefault()});document.addEventListener("mousemove",function(t){if(!El)return;let e=document.querySelector(".sidebar"),n=t.clientX;n>=200&&n<=500&&(e.style.width=n+"px")});document.addEventListener("mouseup",function(){El&&(El=!1,document.querySelector(".resizer").classList.remove("dragging"),document.body.style.cursor="",document.body.style.userSelect="")});function oo(t,e,n,s){let r=(s||{}).render!==!1,a=n;(e==="startDate"||e==="endDate")&&$t(n)&&(a=un(n));let i=B.find(d=>d.id===t),l=i?JSON.parse(JSON.stringify(i)):null;if(i){let d=i[e];if((typeof d=="string"?d:d||"")===(typeof a=="string"?a:a||""))return}let c=Fp(t,e,a,B);if(c.project){B=c.projects;let d=c.project;d.updatedAt=new Date().toISOString(),de.projectsSortedView=null,window.historyService&&l&&window.historyService.recordProjectUpdated(l,d),r&&Qe(t),document.getElementById("calendar-view")?.classList.contains("active")&&ra(),Rt().catch(u=>{console.error("Failed to save project field:",u),Y(g("error.saveChangesFailed"))})}}window.updateProjectField=oo;window.debouncedUpdateProjectField=typeof Yy=="function"?Yy:void 0;window.flushDebouncedProjectField=typeof Xy=="function"?Xy:void 0;function oa(){let t=document.getElementById("tasks")?.classList.contains("active")&&document.getElementById("calendar-view")?.classList.contains("active");window.location.hash!=="#calendar"&&(window.location.hash="calendar"),document.getElementById("tasks")?.classList.contains("active")||Ze("tasks"),document.querySelectorAll(".nav-item").forEach(l=>l.classList.remove("active")),document.querySelector(".nav-item.calendar-nav").classList.add("active");let e=document.querySelector(".view-toggle");e&&e.classList.add("hidden");let n=document.getElementById("kanban-settings-btn")?.parentElement;n&&(n.style.display="none");let s=document.getElementById("backlog-quick-btn");s&&(s.style.display="none");let o=document.querySelector(".kanban-board"),r=document.getElementById("list-view"),a=document.getElementById("calendar-view");o&&!o.classList.contains("hidden")&&o.classList.add("hidden"),r&&r.classList.contains("active")&&r.classList.remove("active"),a&&!a.classList.contains("active")&&a.classList.add("active");try{document.querySelector(".kanban-header")?.classList.add("calendar-mode")}catch{}let i=document.querySelector("#tasks .page-title");i&&(i.textContent="Calendar"),t?ra():ye();try{Jn()}catch{}}function ra(){document.getElementById("calendar-view")?.classList.contains("active")&&requestAnimationFrame(()=>requestAnimationFrame(na))}async function dp(){let t=document.querySelector('input[name="feedback-type"]:checked'),e=t?t.value:"bug",n=document.getElementById("feedback-description").value.trim(),s=no||"";if(!n)return;let o={id:to++,type:e,description:n,screenshotUrl:s,createdAt:new Date().toISOString().split("T")[0],status:"open"};Ve.unshift(o),document.getElementById("feedback-description").value="",yb(),In=1,Ct(),xs(),Al(),pa(),$e()&&requestAnimationFrame(()=>{let r=document.getElementById("feedback-list-pending");r&&r.scrollIntoView({behavior:"smooth",block:"start"})})}document.addEventListener("DOMContentLoaded",function(){let t=document.getElementById("feedback-type-btn"),e=document.getElementById("feedback-type-group"),n=document.getElementById("feedback-type-label");Gn(),window.addEventListener("online",()=>{Gn(),Ve.length>0&&!Yr&&pa()}),window.addEventListener("offline",Gn),t&&e&&(t.addEventListener("click",function(p){p.stopPropagation(),e.classList.toggle("open")}),document.querySelectorAll('input[name="feedback-type"]').forEach(p=>{p.addEventListener("change",function(){let h={bug:g("feedback.type.bugLabel"),idea:g("feedback.type.improvementOption")}[this.value]||this.closest("label").textContent.trim();n.textContent=h,e.classList.remove("open")})}),document.addEventListener("click",function(p){e.contains(p.target)||e.classList.remove("open")}));let s=document.getElementById("feedback-description");s&&(s.addEventListener("keypress",function(u){u.key==="Enter"&&(u.preventDefault(),dp())}),s.addEventListener("paste",function(u){if(!u.clipboardData)return;let p=Array.from(u.clipboardData.files||[])[0];p&&p.type&&p.type.startsWith("image/")&&(u.preventDefault(),fk(p))}));let o=document.getElementById("feedback-screenshot-url"),r=document.getElementById("feedback-screenshot-file"),a=document.getElementById("feedback-screenshot-upload"),i=typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:$e(),l=g(i?"feedback.screenshotDropzoneTap":"feedback.screenshotDropzoneDefault");o&&(o.textContent=l,o.classList.add("feedback-screenshot-dropzone"),o.dataset.defaultText=l);let c=document.getElementById("feedback-screenshot-preview");if(!c){let u=document.querySelector("#feedback .feedback-input-bar");u&&u.parentNode&&(c=document.createElement("div"),c.id="feedback-screenshot-preview",u.parentNode.insertBefore(c,u.nextSibling))}function d(u,p){if(!u||u.length===0)return;let f=u[0];if(!f.type||!f.type.startsWith("image/")){typeof Y=="function"&&Y(g("error.feedbackAttachImage"));return}p&&(p.preventDefault(),p.stopPropagation()),fk(f)}o&&(o.addEventListener("dragover",function(u){u.preventDefault(),o.classList.add("feedback-screenshot-dragover")}),o.addEventListener("dragleave",function(u){u.preventDefault(),o.classList.remove("feedback-screenshot-dragover")}),o.addEventListener("drop",function(u){o.classList.remove("feedback-screenshot-dragover");let p=u.dataTransfer&&u.dataTransfer.files;d(p,u)}),o.addEventListener("paste",function(u){if(!u.clipboardData)return;let p=u.clipboardData.files;p&&p.length>0&&d(p,u)}),o.addEventListener("click",function(){r&&r.click()}),o.addEventListener("keydown",function(u){(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),r&&r.click())})),a&&(a.style.display="none"),r&&r.addEventListener("change",function(u){let p=u.target.files;p&&p.length>0&&d(p,u),r.value=""})});function fk(t){if(!t||!t.type||!t.type.startsWith("image/"))return;let e=new FileReader;e.onload=function(n){let s=n.target&&n.target.result;if(!s)return;no=s;let o=document.getElementById("feedback-screenshot-url");o&&o.dataset&&(o.dataset.hasInlineImage="true");let r=document.getElementById("feedback-screenshot-preview");if(r){r.innerHTML=`
                <div class="feedback-screenshot-preview-card">
                    <div class="feedback-screenshot-thumb">
                        <img src="${s}" alt="${g("feedback.screenshotPreviewAlt")}">
                    </div>
                    <div class="feedback-screenshot-meta">
                        <div class="feedback-screenshot-title">${g("feedback.screenshotPreviewTitle")}</div>
                        <div class="feedback-screenshot-subtitle">${g("feedback.screenshotPreviewSubtitle")}</div>
                    </div>
                    <button type="button" class="feedback-screenshot-remove">${g("feedback.screenshotRemove")}</button>
                </div>
            `,r.style.display="flex";let a=r.querySelector(".feedback-screenshot-thumb");a&&typeof aa=="function"&&(a.onclick=function(){aa(s,"Feedback Screenshot")});let i=r.querySelector(".feedback-screenshot-remove");i&&(i.onclick=function(l){l.preventDefault(),yb()})}},e.onerror=function(){typeof Y=="function"&&Y(g("error.feedbackReadImage"))},e.readAsDataURL(t)}function yb(){no="";let t=document.getElementById("feedback-screenshot-url");if(t){let n=t.dataset.defaultText||g("feedback.screenshotDropzoneDefault");t.textContent=n,t.dataset&&delete t.dataset.hasInlineImage}let e=document.getElementById("feedback-screenshot-preview");e&&(e.innerHTML="",e.style.display="none")}function ZI(t){let e=Ve.find(o=>o.id===t);if(!e)return;let n=e.status,s=e.resolvedAt;e.status==="open"?(e.status="done",e.resolvedAt=new Date().toISOString()):(e.status="open",delete e.resolvedAt),Ct(),xs(),Al(),pa().catch(()=>{e.status=n,s?e.resolvedAt=s:delete e.resolvedAt,Ct(),xs(),Y(g("error.feedbackStatusFailed"))})}function xs(){let t=document.getElementById("feedback");if(!t||!t.classList.contains("active"))return;let e=document.getElementById("feedback-list-pending"),n=document.getElementById("feedback-list-done");if(!e||!n)return;let s={bug:"\u{1F41E}",improvement:"\u{1F4A1}",feature:"\u{1F4A1}",idea:"\u{1F4A1}"},o=[],r=[];for(let h of Ve)h.status==="open"?o.push(h):r.push(h);o.sort((h,m)=>new Date(m.createdAt)-new Date(h.createdAt)),r.sort((h,m)=>new Date(m.resolvedAt||m.createdAt)-new Date(h.resolvedAt||h.createdAt));let a=Math.ceil(o.length/xn);In>a&&a>0&&(In=a);let i=(In-1)*xn,l=i+xn,c=o.slice(i,l),d=Math.ceil(r.length/xn);Kn>d&&d>0&&(Kn=d);let u=(Kn-1)*xn,p=u+xn,f=r.slice(u,p);o.length===0?e.innerHTML=`<div class="empty-state" style="padding: 20px;"><p>${g("feedback.empty.pending")}</p></div>`:e.innerHTML=c.map(h=>`
            <div class="feedback-item ${h.status==="done"?"done":""}">
                <input type="checkbox" class="feedback-checkbox"
                       data-feedback-id="${h.id}"
                       ${h.status==="done"?"checked":""}>
                <span class="feedback-type-icon">${s[h.type]||"\u{1F4A1}"}</span>
                ${h.screenshotUrl?`<button type="button" class="feedback-screenshot-link" data-action="viewFeedbackScreenshot" data-param="${encodeURIComponent(h.screenshotUrl)}" title="${g("feedback.viewScreenshotTitle")}">\u{1F5BC}\uFE0F</button>`:""}
                <div class="feedback-description">${V(h.description)}</div>
                <div class="feedback-date">${xe(h.createdAt)}</div>
                <button class="feedback-delete-btn" data-action="deleteFeedbackItemWithStop" data-param="${h.id}">\u274C</button>
            </div>
        `).join(""),hk("pending",o.length,a,In),r.length===0?n.innerHTML=`<div class="empty-state" style="padding: 20px;"><p>${g("feedback.empty.done")}</p></div>`:n.innerHTML=f.map(h=>`
            <div class="feedback-item done">
                <input type="checkbox" class="feedback-checkbox"
                       data-feedback-id="${h.id}"
                       checked>
                <span class="feedback-type-icon">${s[h.type]||"\u{1F4A1}"}</span>
                ${h.screenshotUrl?`<button type="button" class="feedback-screenshot-link" data-action="viewFeedbackScreenshot" data-param="${encodeURIComponent(h.screenshotUrl)}" title="${g("feedback.viewScreenshotTitle")}">\u{1F5BC}\uFE0F</button>`:""}
                <div class="feedback-description">${V(h.description)}</div>
                <div class="feedback-date">${xe(h.createdAt)}</div>
                <button class="feedback-delete-btn" data-action="deleteFeedbackItemWithStop" data-param="${h.id}">\u274C</button>
            </div>
        `).join(""),hk("done",r.length,d,Kn)}function hk(t,e,n,s){let o=t==="pending"?"feedback-pagination-pending":"feedback-pagination-done",r=document.getElementById(o);if(!r)return;if(n<=1){r.innerHTML="",r.style.display="none";return}r.style.display="flex";let a=(s-1)*xn+1,i=Math.min(s*xn,e),l=`
        <div class="feedback-pagination-info">
            ${g("feedback.pagination.showing",{start:a,end:i,total:e})}
        </div>
        <div class="feedback-pagination-controls">
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${t}', 1)"
                ${s===1?"disabled":""}
                title="${g("feedback.pagination.first")}">
                &laquo;
            </button>
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${t}', ${s-1})"
                ${s===1?"disabled":""}
                title="${g("feedback.pagination.prev")}">
                &lsaquo;
            </button>
            <span class="feedback-pagination-page">
                ${g("feedback.pagination.pageOf",{current:s,total:n})}
            </span>
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${t}', ${s+1})"
                ${s===n?"disabled":""}
                title="${g("feedback.pagination.next")}">
                &rsaquo;
            </button>
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${t}', ${n})"
                ${s===n?"disabled":""}
                title="${g("feedback.pagination.last")}">
                &raquo;
            </button>
        </div>
    `;r.innerHTML=l}function QI(t,e){let n=document.querySelector("#feedback .page-content"),s=document.activeElement,o=!!(s&&s.classList&&s.classList.contains("feedback-pagination-btn")),r=!!(n&&n.scrollHeight-(n.scrollTop+n.clientHeight)<80);t==="pending"?In=e:Kn=e,xs();let a=t==="pending"?"feedback-pagination-pending":"feedback-pagination-done",l=o||r?a:t==="pending"?"feedback-list-pending":"feedback-list-done",c=document.getElementById(l);c&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{c.scrollIntoView({behavior:"smooth",block:l===a?"end":"start"})})})}window.changeFeedbackPage=QI;function eC(){document.querySelectorAll(".modal-content .modal-tab").forEach(t=>{t.addEventListener("click",e=>{let n=e.target.dataset.tab,s=e.target.closest(".modal-content");if(!s)return;try{if(!!s.closest("#task-modal")){let a=s.querySelector("#task-footer");if(a&&window.getComputedStyle(a).display==="none")if(n==="history"){let l=Math.round(s.getBoundingClientRect().height);l>0&&(s.style.minHeight=`${l}px`,s.style.maxHeight=`${l}px`)}else(n==="general"||n==="details")&&(s.style.minHeight="",s.style.maxHeight="")}}catch{}if(s.querySelectorAll(".modal-tab").forEach(r=>r.classList.remove("active")),e.target.classList.add("active"),n==="general"||n==="details"){let r=s.querySelector("#task-details-tab"),a=s.querySelector("#task-history-tab");if(r&&a){s.querySelectorAll(".modal-tab-content").forEach(i=>{i.classList.remove("active")}),r.classList.add("active"),n==="details"?document.body.classList.add("mobile-tab-details-active"):document.body.classList.remove("mobile-tab-details-active");return}}document.body.classList.remove("mobile-tab-details-active"),s.querySelectorAll(".modal-tab-content").forEach(r=>{r.classList.remove("active")});let o=s.querySelector(`#task-${n}-tab`);if(o&&(o.classList.add("active"),n==="history")){let a=document.getElementById("task-form")?.dataset.editingTaskId;a&&Uu(parseInt(a));let i=document.querySelector(".task-history-container");i&&(i.scrollTop=0)}})})}function Uu(t){if(!window.historyService||!A.find(a=>a.id===t))return;let n=window.historyService.getEntityHistory("task",t),s=document.getElementById("task-history-timeline"),o=document.getElementById("task-history-empty");if(!s)return;if(n.length===0){s.innerHTML="",o&&(o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.padding="48px 20px");return}o&&(o.style.display="none"),R.historySortOrder==="oldest"&&(n=[...n].reverse());let r=document.getElementById("history-sort-toggle");if(r)r.innerHTML=R.historySortOrder==="newest"?g("history.sort.newest"):g("history.sort.oldest");else{let a=s.parentElement;r=document.createElement("button"),r.id="history-sort-toggle",r.className="history-sort-toggle",r.innerHTML=R.historySortOrder==="newest"?g("history.sort.newest"):g("history.sort.oldest"),r.onclick=()=>kb("task",t),a.insertBefore(r,s)}s.innerHTML=n.map(a=>bb(a)).join("")}function kb(t,e){if(R.historySortOrder=R.historySortOrder==="newest"?"oldest":"newest",Ml(),t==="task"&&e)Uu(e);else if(t==="project"&&e)_u(e);else{let s=document.getElementById("task-form")?.dataset.editingTaskId;s&&Uu(parseInt(s));let o=document.getElementById("project-details");if(o&&o.classList.contains("active")){let r=o.innerHTML.match(/renderProjectHistory\((\d+)\)/);r&&_u(parseInt(r[1]))}}}function _u(t){if(!window.historyService||!B.find(a=>a.id===t))return;let n=window.historyService.getEntityHistory("project",t),s=document.getElementById(`project-history-timeline-${t}`),o=document.getElementById(`project-history-empty-${t}`);if(!s)return;if(n.length===0){s.innerHTML="",o&&(o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.padding="48px 20px");return}o&&(o.style.display="none"),R.historySortOrder==="oldest"&&(n=[...n].reverse());let r=document.getElementById(`project-history-sort-toggle-${t}`);if(r)r.innerHTML=R.historySortOrder==="newest"?g("history.sort.newest"):g("history.sort.oldest");else{let a=s.parentElement;r=document.createElement("button"),r.id=`project-history-sort-toggle-${t}`,r.className="history-sort-toggle",r.innerHTML=R.historySortOrder==="newest"?g("history.sort.newest"):g("history.sort.oldest"),r.onclick=()=>kb("project",t),a.insertBefore(r,s)}s.innerHTML=n.map(a=>bb(a)).join("")}function bb(t){let e={created:"\u2728",updated:"",deleted:"\u{1F5D1}\uFE0F"},n={created:"var(--accent-green)",updated:"var(--text-secondary)",deleted:"var(--accent-red)"},s=new Date(t.timestamp).toLocaleString(Qn(),{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}),o=Object.entries(t.changes),r=o.length,a={title:g("history.field.title"),name:g("history.field.name"),description:g("history.field.description"),status:g("history.field.status"),priority:g("history.field.priority"),category:g("history.field.category"),startDate:g("history.field.startDate"),endDate:g("history.field.endDate"),link:g("history.field.link"),task:g("history.field.task"),projectId:g("history.field.projectId"),tags:g("history.field.tags"),attachments:g("history.field.attachments")};return`
        <div class="history-entry-inline">
            <div class="history-entry-header-inline">
                ${e[t.action]?`<span class="history-action-icon" style="color: ${n[t.action]};">${e[t.action]}</span>`:""}
                ${t.action==="created"||t.action==="deleted"?`<span class="history-action-label-inline" style="color: ${n[t.action]};">${t.action.charAt(0).toUpperCase()+t.action.slice(1)}</span>`:""}
                <span class="history-time-inline">${s}</span>
            </div>

            ${r>0?`
                <div class="history-changes-compact">
                    ${o.map(([i,{before:l,after:c}])=>{let d=a[i]||i;if(i==="link"||i==="task"){let f=c&&typeof c=="object"?c.action:"",h=(c&&typeof c=="object"?c.entity:null)||"task",m=c&&typeof c=="object"?c.title||c.id||g("tasks.table.task"):String(c),y=f==="removed"?"\u274C":"\u2795",k=g(f==="removed"?"history.link.removed":"history.link.added"),S=h==="task"?g("history.entity.task"):h,T=`${y} ${k} ${S} "${m}"`;return`
                                <div class="history-change-compact history-change-compact--single">
                                    <span class="change-field-label">${d}:</span>
                                    <span class="change-after-compact">${V(T)}</span>
                                </div>
                            `}if(i==="description"){let f=l?l.replace(/<[^>]*>/g,"").trim():"",h=c?c.replace(/<[^>]*>/g,"").trim():"";return`
                                <div class="history-change-description">
                                    <div class="change-field-label">${d}:</div>
                                    <div class="description-diff">
                                        ${f?`<div class="description-before"><s>${V(f)}</s></div>`:`<div class="description-before"><em style="opacity: 0.6;">${g("history.value.empty")}</em></div>`}
                                        ${h?`<div class="description-after">${V(h)}</div>`:`<div class="description-after"><em style="opacity: 0.6;">${g("history.value.empty")}</em></div>`}
                                    </div>
                                </div>
                            `}let u=mk(i,l,!0),p=mk(i,c,!1);return`
                            <div class="history-change-compact">
                                <span class="change-field-label">${d}:</span>
                                ${u!==null?`<span class="change-before-compact">${u}</span>`:'<span class="change-null">\u2014</span>'}
                                <span class="change-arrow-compact">${g("history.change.arrow")}</span>
                                ${p!==null?`<span class="change-after-compact">${p}</span>`:'<span class="change-null">\u2014</span>'}
                            </div>
                        `}).join("")}
                </div>
            `:""}
        </div>
    `}function mk(t,e,n=!1){if(e==null)return null;if(e==="")return`<em style="opacity: 0.7;">${g("history.value.empty")}</em>`;if(t==="startDate"||t==="endDate"){let o=xe(e);return n?`<span style="opacity: 0.7;">${o}</span>`:o}if(t==="link"||t==="task"){let o=e&&typeof e=="object"?e.action:"",r=(e&&typeof e=="object"?e.entity:null)||"task",a=e&&typeof e=="object"?e.title||e.id||g("tasks.table.task"):String(e),i=o==="removed"?"\u274C":"\u2795",l=g(o==="removed"?"history.link.removed":"history.link.added"),c=r==="task"?g("history.entity.task"):r,d=`${i} ${l} ${c} "${a}"`;return n?`<span style="opacity: 0.7;">${V(d)}</span>`:V(d)}if(t==="status"){let o=pt(e).toUpperCase();return`<span style="background: ${{backlog:"#4B5563",todo:"#186f95",progress:"var(--accent-blue)",review:"var(--accent-amber)",done:"var(--accent-green)"}[e]||"#4B5563"}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11.5px; font-weight: 600; text-transform: uppercase;">${V(o)}</span>`}if(t==="priority"){let o=At(e).toUpperCase();return`<span style="${{high:"background: rgba(239, 68, 68, 0.2); color: #ef4444;",medium:"background: rgba(245, 158, 11, 0.2); color: #f59e0b;",low:"background: rgba(16, 185, 129, 0.2); color: #10b981;"}[e]||"background: rgba(107, 114, 128, 0.2); color: #6b7280;"} padding: 4px 10px; border-radius: 6px; font-size: 11px; font-weight: 700; text-transform: uppercase;">${V(o)}</span>`}if(t==="projectId"){if(!e)return`<em style="opacity: 0.7;">${g("tasks.noProject")}</em>`;let o=B.find(a=>a.id===e),r=o?V(o.name):`#${e}`;return n?`<span style="opacity: 0.7;">${r}</span>`:r}if(t==="tags")return!Array.isArray(e)||e.length===0?`<em style="opacity: 0.7;">${g("history.value.none")}</em>`:e.slice(0,2).map(o=>`<span style="background-color: ${sn(o)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${V(o.toUpperCase())}</span>`).join(" ")+(e.length>2?" ...":"");if(t==="attachments"){if(!Array.isArray(e)||e.length===0)return`<em style="opacity: 0.7;">${g("history.value.none")}</em>`;let o=e.length===1?g("history.attachments.countSingle",{count:e.length}):g("history.attachments.countPlural",{count:e.length});return n?`<span style="opacity: 0.7;">${o}</span>`:o}if(t==="description"){let o=e.replace(/<[^>]*>/g,"").trim(),r=o.length>50?V(o.substring(0,50))+"...":V(o)||`<em>${g("history.value.empty")}</em>`;return n?`<span style="opacity: 0.7;">${r}</span>`:r}let s=V(String(e));return n?`<span style="opacity: 0.7;">${s}</span>`:s}function tC(t){let e=document.getElementById(`history-details-inline-${t}`),s=document.querySelector(`[data-action="toggleHistoryEntryInline"][data-param="${t}"]`)?.querySelector(".expand-icon-inline");if(e){let o=e.style.display!=="none";e.style.display=o?"none":"block",s&&(s.textContent=o?"\u25BC":"\u25B2")}}var Zr=null;function nC(t){Zr=t,document.getElementById("feedback-delete-modal").classList.add("active")}function vb(){document.getElementById("feedback-delete-modal").classList.remove("active"),Zr=null}async function sC(){if(Zr!==null){let t=Zr;Ve=Ve.filter(e=>e.id!==Zr),vb(),Ct(),xs(),Al(),pa()}}document.addEventListener("click",function(t){let e=t.target.closest(".feedback-checkbox");if(e){let n=parseInt(e.dataset.feedbackId,10);n&&ZI(n)}});function oC(t,e){document.getElementById("project-title-display").style.display="none",document.getElementById("project-title-edit").style.display="flex",document.getElementById("project-title-input").focus(),document.getElementById("project-title-input").select()}function rC(t){let e=document.getElementById("project-title-input").value.trim();e?oo(t,"name",e):wb()}function wb(){document.getElementById("project-title-display").style.display="inline",document.getElementById("project-title-edit").style.display="none"}function aC(){document.getElementById("kanban-tip").style.display="none",localStorage.setItem("kanban-tip-dismissed","true")}function iC(t){t.stopPropagation();let e=document.getElementById("project-options-menu");e&&(e.style.display=e.style.display==="block"?"none":"block")}document.addEventListener("click",function(t){let e=document.getElementById("project-options-menu");e&&!t.target.closest("#project-options-btn")&&!t.target.closest("#project-options-menu")&&(e.style.display="none")});document.addEventListener("DOMContentLoaded",function(){if(localStorage.getItem("kanban-tip-dismissed")==="true"){let t=document.getElementById("kanban-tip");t&&(t.style.display="none")}});async function Vu(){let t=document.getElementById("attachment-url"),e=document.getElementById("attachment-name"),n=t.value.trim();if(!n){t.style.border="2px solid var(--accent-red, #ef4444)",t.placeholder="URL is required",t.focus(),setTimeout(()=>{t.style.border="",t.placeholder="Paste link (Drive, Dropbox, etc.)"},2e3);return}t.style.border="";let s=document.getElementById("task-form").dataset.editingTaskId,o=e.value.trim()||"Attachment",r="\u{1F4C1}";if(!e.value.trim())try{let i=new URL(n),l=i.pathname.toLowerCase();if(i.hostname.includes("docs.google.com"))l.includes("/document/")?(o=g("tasks.attachments.googleDoc"),r="\u{1F4C4}"):l.includes("/spreadsheets/")?(o=g("tasks.attachments.googleSheet"),r="\u{1F4CA}"):l.includes("/presentation/")?(o=g("tasks.attachments.googleSlides"),r="\u{1F4D1}"):(o=g("tasks.attachments.googleDriveFile"),r="\u{1F5C2}\uFE0F");else if(i.hostname.includes("drive.google.com"))o=g("tasks.attachments.googleDriveFile"),r="\u{1F5C2}\uFE0F";else if(l.endsWith(".pdf"))o=l.split("/").pop()||g("tasks.attachments.pdf"),r="\u{1F4D5}";else if(l.endsWith(".doc")||l.endsWith(".docx"))o=l.split("/").pop()||g("tasks.attachments.word"),r="\u{1F4DD}";else if(l.endsWith(".xls")||l.endsWith(".xlsx"))o=l.split("/").pop()||g("tasks.attachments.excel"),r="\u{1F4CA}";else if(l.endsWith(".ppt")||l.endsWith(".pptx"))o=l.split("/").pop()||g("tasks.attachments.powerpoint"),r="\u{1F4D1}";else{let c=l.split("/").pop();o=c&&c.length>0?c:i.hostname,r="\u{1F4C1}"}}catch{o=n.substring(0,30),r="\u{1F4C1}"}r="\u{1F310}";let a={name:o,icon:r,type:"link",url:n,addedAt:new Date().toISOString()};if(s){let i=A.find(l=>l.id===parseInt(s));if(!i)return;i.attachments||(i.attachments=[]),i.attachments.push(a),Ts(i.attachments),_o(),ot().catch(l=>{console.error("Failed to save attachment:",l),Y(g("error.attachmentSaveFailed"))})}else et.push(a),Ts(et);t.value="",e.value=""}async function Ts(t){let e=document.getElementById("attachments-files-list"),n=document.getElementById("attachments-links-list");if(e&&n){await lC(t,e,n);return}let s=document.getElementById("attachments-list");if(!s)return;if(!t||t.length===0){s.innerHTML=`<div style="color: var(--text-muted); font-size: 13px; padding: 8px 0;">${g("tasks.attachments.none")}</div>`;return}let o=r=>{if(!r)return"";try{let a=/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(r);return(new URL(a?r:`https://${r}`).host||r).replace(/^www\./,"")}catch{return r}};s.innerHTML=t.map((r,a)=>{let i=r.size?Math.round(r.size/1024):0,l=i>1024?`${(i/1024).toFixed(1)} MB`:`${i} KB`;if(r.type==="file"&&r.fileKey){let c=r.fileType==="image",d=`<div id="thumbnail-${r.fileKey}" class="attachment-thumb" aria-hidden="true">${r.icon}</div>`,u=c?"viewFile":"downloadFileAttachment",p=c?`data-param="${r.fileKey}" data-param2="${V(r.name)}" data-param3="${r.fileType}"`:`data-param="${r.fileKey}" data-param2="${V(r.name)}" data-param3="${r.mimeType}"`;return`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="${u}" ${p}>
                        ${d}
                        <span class="attachment-name">${V(r.name)} <span class="attachment-meta">&middot; ${l}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${a}" aria-label="${g("tasks.attachments.remove")}" title="${g("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `}else return r.type==="image"&&r.data?`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="viewImageLegacy" data-param="${r.data}" data-param2="${V(r.name)}">
                        <span class="attachment-thumb" aria-hidden="true"><img src="${r.data}" alt=""></span>
                        <span class="attachment-name">${V(r.name)} <span class="attachment-meta">&middot; ${l}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${a}" aria-label="${g("tasks.attachments.remove")}" title="${g("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `:`
                <div class="attachment-item" style="display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px; border: 1px solid var(--border);">
                    <div style="width: 40px; height: 40px; background: transparent; border-radius: 0; display: flex; align-items: center; justify-content: center; font-size: 25px; line-height: 1;">\u{1F310}</div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-size: 14px; font-weight: 500; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${V(r.name)}</div>
                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: none;">${V(r.url)}</div>
                    </div>
                    <div style="display: flex; gap: 6px; align-items: center;">
                        <button type="button" data-action="openUrlAttachment" data-param="${encodeURIComponent(r.url)}" style="padding: 0 12px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; height: 32px; line-height: 1; box-sizing: border-box; display: inline-flex; align-items: center; justify-content: center; appearance: none; -webkit-appearance: none;">${g("tasks.attachments.open")}</button>
                        <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${a}" aria-label="${g("tasks.attachments.removeLink")}" title="${g("tasks.attachments.removeTitle")}">&times;</button>
                    </div>
                </div>
            `}).join("");for(let r of t)if(r.type==="file"&&r.fileKey&&r.fileType==="image")try{let a=await sr(r.fileKey),i=document.getElementById(`thumbnail-${r.fileKey}`);i&&a&&(i.innerHTML=`<img src="${a}" alt="${V(r.name)}">`)}catch(a){console.error("Failed to load thumbnail:",a)}}async function lC(t,e,n){if(!e||!n)return;let s=(t||[]).map((d,u)=>({att:d,index:u})),o=s.filter(({att:d})=>d?!!(d.type==="file"||d.fileKey||d.type==="image"&&d.data):!1),r=s.filter(({att:d})=>d?!!(d.type==="link"||d.url&&d.type!=="file"):!1),a=d=>{if(!d)return"";try{let u=/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(d);return(new URL(u?d:`https://${d}`).host||d).replace(/^www\./,"")}catch{return d}},i=o.map(({att:d,index:u})=>{let p=d.size?Math.round(d.size/1024):0,f=p>1024?`${(p/1024).toFixed(1)} MB`:`${p} KB`;if(d.type==="file"&&d.fileKey){let h=d.fileType==="image",m=`<div id="thumbnail-${d.fileKey}" class="attachment-thumb" aria-hidden="true">${d.icon}</div>`,y=h?"viewFile":"downloadFileAttachment",k=h?`data-param="${d.fileKey}" data-param2="${V(d.name)}" data-param3="${d.fileType}"`:`data-param="${d.fileKey}" data-param2="${V(d.name)}" data-param3="${d.mimeType}"`;return`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="${y}" ${k}>
                        ${m}
                        <span class="attachment-name">${V(d.name)} <span class="attachment-meta">&middot; ${f}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${u}" aria-label="${g("tasks.attachments.remove")}" title="${g("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `}return d.type==="image"&&d.data?`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="viewImageLegacy" data-param="${d.data}" data-param2="${V(d.name)}">
                        <span class="attachment-thumb" aria-hidden="true"><img src="${d.data}" alt=""></span>
                        <span class="attachment-name">${V(d.name)} <span class="attachment-meta">&middot; ${f}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${u}" aria-label="${g("tasks.attachments.remove")}" title="${g("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `:""}).filter(Boolean).join(""),l=r.map(({att:d,index:u})=>`
        <div class="attachment-item" style="display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px; border: 1px solid var(--border);">
            <div style="width: 40px; height: 40px; background: transparent; border-radius: 0; display: flex; align-items: center; justify-content: center; font-size: 25px; line-height: 1;">\u{1F310}</div>
            <div style="flex: 1; min-width: 0;">
                <div style="font-size: 14px; font-weight: 500; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${V(d.name)}</div>
                <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: none;">${V(d.url)}</div>
            </div>
            <div style="display: flex; gap: 6px; align-items: center;">
                <button type="button" data-action="openUrlAttachment" data-param="${encodeURIComponent(d.url)}" style="padding: 0 12px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; height: 32px; line-height: 1; box-sizing: border-box; display: inline-flex; align-items: center; justify-content: center; appearance: none; -webkit-appearance: none;">${g("tasks.attachments.open")}</button>
                <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${u}" aria-label="${g("tasks.attachments.removeLink")}" title="${g("tasks.attachments.removeTitle")}">&times;</button>
            </div>
        </div>
    `).join("");!!i||!!l?(e.innerHTML=i||"",n.innerHTML=l||""):(e.innerHTML=`<div style="color: var(--text-muted); font-size: 13px; padding: 8px 0;">${g("tasks.attachments.none")}</div>`,n.innerHTML="");for(let d of t||[])if(d&&d.type==="file"&&d.fileKey&&d.fileType==="image")try{let u=await sr(d.fileKey),p=document.getElementById(`thumbnail-${d.fileKey}`);p&&u&&(p.innerHTML=`<img src="${u}" alt="${V(d.name)}">`)}catch(u){console.error("Failed to load thumbnail:",u)}}async function Sb(t,e,n){if(n==="image")try{let s=await sr(t);aa(s,e)}catch(s){Y(g("error.attachmentLoadFailed",{message:s.message}))}}function aa(t,e){let n=document.createElement("div");n.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        cursor: pointer;
    `,n.innerHTML=`
        <div style="max-width: 90%; max-height: 90%; display: flex; flex-direction: column; align-items: center;">
            <div style="color: white; padding: 16px; font-size: 18px; background: rgba(0,0,0,0.5); border-radius: 8px 8px 0 0; width: 100%; text-align: center;">
                ${V(e)}
            </div>
            <img src="${t}" alt="${V(e)}" style="max-width: 100%; max-height: calc(90vh - 60px); object-fit: contain; border-radius: 0 0 8px 8px;">
        </div>
    `,n.onclick=()=>n.remove(),document.body.appendChild(n)}async function Eb(t,e,n){try{let s=await sr(t),r=await(await fetch(s)).blob(),a=URL.createObjectURL(r),i=document.createElement("a");i.href=a,i.download=e,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),Et(g("success.fileDownloaded"))}catch(s){Y(g("error.fileDownloadFailed",{message:s.message}))}}async function xb(t){let e=document.getElementById("task-form").dataset.editingTaskId;if(e){let n=A.find(o=>o.id===parseInt(e));if(!n||!n.attachments)return;let s=n.attachments[t];if(s.type==="file"&&s.fileKey)try{await Yl(s.fileKey),Et(g("success.attachmentDeletedFromStorage",{name:s.name}))}catch(o){console.error("Failed to delete file from storage:",o),Y(g("error.fileDeleteFailed"));return}else Et(g("success.attachmentRemoved"));n.attachments.splice(t,1),Ts(n.attachments),_o(),ot().catch(o=>{console.error("Failed to save attachment removal:",o),Y(g("error.saveChangesFailed"))})}else{let n=et[t];if(n.type==="file"&&n.fileKey)try{await Yl(n.fileKey),Et(g("success.attachmentDeletedFromStorage",{name:n.name}))}catch(s){console.error("Failed to delete file from storage:",s),Y(g("error.fileDeleteFailed"));return}else Et(g("success.attachmentRemoved"));et.splice(t,1),Ts(et)}}function cC(){let t=document.getElementById("attachment-file-dropzone"),e=document.getElementById("attachment-file");if(!t||!e)return;let n=$e(),s=g(n?"tasks.modal.attachmentsDropzoneTap":"tasks.modal.attachmentsDropzoneDefault");t.dataset.defaultText=s;function o(c){t.innerHTML="";let d=document.createElement("span");d.className="task-attachment-dropzone-text",d.textContent=c,t.appendChild(d)}function r(c){c.style.display="flex",c.style.alignItems="center",c.style.justifyContent="center",c.style.gap="10px",c.style.padding="12px 16px",c.style.textAlign="center",c.style.cursor="pointer",c.style.userSelect="none",c.style.minHeight="48px",c.style.border="2px dashed var(--border)",c.style.borderRadius="10px",c.style.background="var(--bg-tertiary)",c.style.boxShadow="none",c.style.color="var(--text-muted)",c.style.fontWeight="500",c.style.transition="border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease"}function a(c,d){d?(c.style.borderColor="var(--accent-blue)",c.style.background="rgba(59, 130, 246, 0.08)",c.style.boxShadow="0 0 0 1px var(--accent-blue)"):(c.style.border="2px dashed var(--border)",c.style.background="var(--bg-tertiary)",c.style.boxShadow="none")}r(t),o(s);async function i(c,d){if(!c||c.length===0)return;let u=c[0];d&&(d.preventDefault(),d.stopPropagation()),await xl(u,t)}let l=0;t.addEventListener("dragenter",function(c){c.preventDefault(),l+=1,t.classList.add("task-attachment-dragover"),a(t,!0)}),t.addEventListener("dragover",function(c){c.preventDefault(),t.classList.add("task-attachment-dragover"),a(t,!0)}),t.addEventListener("dragleave",function(c){c.preventDefault(),l=Math.max(0,l-1),l===0&&(t.classList.remove("task-attachment-dragover"),a(t,!1))}),t.addEventListener("drop",function(c){l=0,t.classList.remove("task-attachment-dragover"),a(t,!1),i(c.dataTransfer&&c.dataTransfer.files,c)}),t.addEventListener("dragend",function(){l=0,t.classList.remove("task-attachment-dragover"),a(t,!1)}),t.addEventListener("paste",function(c){if(!c.clipboardData)return;let d=c.clipboardData.files;d&&d.length>0&&i(d,c)}),t.addEventListener("click",function(){e.click()}),t.addEventListener("keydown",function(c){(c.key==="Enter"||c.key===" ")&&(c.preventDefault(),e.click())}),e.addEventListener("change",function(c){let d=c.target.files;d&&d.length>0&&i(d,c),e.value=""})}document.addEventListener("DOMContentLoaded",cC);async function xl(t,e){if(!t)return;let n=dC(t.type||"",t.name||""),s=uC(n);if(t.size>s){let i=Math.round(s/1048576);Y(g("error.fileSizeTooLarge",{maxMB:i}));return}let o=e&&e.tagName==="BUTTON",r=o?e.textContent||"\u{1F4C1} Upload File":null,a=o?null:e?.dataset?.defaultText||g("tasks.modal.attachmentsDropzoneDefault");try{if(e)if(o)e.textContent="\u23F3 Uploading...",e.disabled=!0;else{e.innerHTML="";let u=document.createElement("span");u.className="task-attachment-dropzone-text",u.textContent=`Uploading ${t.name}...`,e.appendChild(u),e.classList.add("task-attachment-uploading"),e.setAttribute("aria-busy","true")}let i=await Vp(t),l=`file_${Date.now()}_${Math.random().toString(36).substring(7)}`;await Wp(l,i);let c={name:t.name,icon:pC(n),type:"file",fileType:n,fileKey:l,mimeType:t.type,size:t.size,addedAt:new Date().toISOString()},d=document.getElementById("task-form").dataset.editingTaskId;if(d){let u=A.find(p=>p.id===parseInt(d));if(!u)return;u.attachments||(u.attachments=[]),u.attachments.push(c),Ts(u.attachments),ot().catch(p=>{console.error("Failed to save attachment:",p),Y(g("error.attachmentSaveFailed"))})}else et.push(c),Ts(et);Et(g("success.fileUploaded"))}catch(i){Y(g("error.fileUploadFailed",{message:i.message}))}finally{if(e)if(o)e.textContent=r,e.disabled=!1;else{e.innerHTML="";let i=document.createElement("span");i.className="task-attachment-dropzone-text",i.textContent=a,e.appendChild(i),e.classList.remove("task-attachment-uploading"),e.removeAttribute("aria-busy")}}}async function Tb(t){let e=document.getElementById("attachment-file"),n=e&&e.files?e.files[0]:null;if(!n){Y(g("error.selectFile"));return}let s=document.getElementById("attachment-file-dropzone")||t?.target||null;await xl(n,s),e&&(e.value="")}function dC(t,e){return t.startsWith("image/")?"image":t==="application/pdf"||e.toLowerCase().endsWith(".pdf")?"pdf":t.includes("spreadsheet")||e.match(/\.(xlsx?|csv)$/i)?"spreadsheet":t.includes("document")||t.includes("word")||e.match(/\.docx?$/i)?"document":t.includes("presentation")||t.includes("powerpoint")||e.match(/\.pptx?$/i)?"presentation":"file"}function uC(t){switch(t){case"pdf":return 20*1024*1024;case"image":case"spreadsheet":case"document":case"presentation":return 10*1024*1024;default:return 10*1024*1024}}function pC(t){switch(t){case"image":return"\u{1F5BC}\uFE0F";case"pdf":return"\u{1F4C4}";case"spreadsheet":return"\u{1F4CA}";case"document":return"\u{1F4DD}";case"presentation":return"\u{1F4CA}";default:return"\u{1F5C2}\uFE0F"}}window.addFileAttachment=Tb;window.viewFile=Sb;window.viewImageLegacy=aa;window.downloadFileAttachment=Eb;window.removeAttachment=xb;window.kanbanShowBacklog=localStorage.getItem("kanbanShowBacklog")==="true";window.kanbanShowProjects=localStorage.getItem("kanbanShowProjects")!=="false";window.kanbanShowNoDate=localStorage.getItem("kanbanShowNoDate")!=="false";window.kanbanUpdatedFilter=localStorage.getItem("kanbanUpdatedFilter")||"all";window.enableReviewStatus=localStorage.getItem("enableReviewStatus")==="true";function Db(t){switch(t){case"5m":return"5m";case"30m":return"30m";case"24h":return"24h";case"week":return g("filters.updated.week");case"month":return g("filters.updated.month");default:return""}}function up(){let t=document.querySelector(".kanban-board");if(!t)return;let e=3;window.kanbanShowBacklog===!0&&e++,window.enableReviewStatus!==!1&&e++,t.style.gridTemplateColumns=`repeat(${e}, 1fr)`}function pp(){let t=window.enableReviewStatus!==!1,e=document.getElementById("kanban-column-review");e&&(e.style.display=t?"":"none");let n=document.getElementById("filter-status-review");n&&(n.style.display=t?"":"none"),up(),!t&&v.statuses.has("review")&&(v.statuses.delete("review"),De(),Be())}function fC(){let t=window.kanbanShowBacklog===!0,e=document.getElementById("kanban-column-backlog");e&&(e.style.display=t?"":"none"),up(),ws()}function ws(){let t=typeof ta=="function"?ta():null,e=document.querySelector(".kanban-board"),n=e&&!e.classList.contains("hidden"),s=typeof $e=="function"?$e():!0,o=t==="tasks"&&n&&!s&&window.kanbanShowBacklog!==!0,r=document.getElementById("filter-status-backlog");if(r&&(r.style.display=o?"none":""),o&&v.statuses.has("backlog")){v.statuses.delete("backlog");let a=document.querySelector('input[data-filter="status"][value="backlog"]');a&&(a.checked=!1),De(),Be()}}function Zs(t){let e=t?parseInt(t,10):null;if(!e)return null;let n=B.find(s=>s.id===e);return n?(n.updatedAt=new Date().toISOString(),n):null}function Qs(t,e,n){if(!window.historyService)return;let s=t?parseInt(t,10):null;if(!s)return;let o=B.find(r=>r.id===s);o&&(e==="added"&&window.historyService.recordProjectTaskAdded?window.historyService.recordProjectTaskAdded(o,n):e==="removed"&&window.historyService.recordProjectTaskRemoved&&window.historyService.recordProjectTaskRemoved(o,n))}function hC(){let t=document.getElementById("btn-filter-kanban-updated");if(!t)return;let e=t.querySelector("#badge-kanban-updated");if(!e)return;for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(`${g("tasks.filters.updated")} `)),t.appendChild(e),t.appendChild(document.createTextNode(" "));let n=document.createElement("span");n.className="filter-arrow",n.textContent="\u25BC",t.appendChild(n)}function $l(){try{hC()}catch{}let t=document.getElementById("badge-kanban-updated");if(t){t.textContent=Db(window.kanbanUpdatedFilter);let e=t.closest(".filter-button");e&&(window.kanbanUpdatedFilter!=="all"?e.classList.add("active"):e.classList.remove("active"))}try{document.querySelectorAll('input[type="radio"][data-filter="kanban-updated"][name="kanban-updated-filter"]').forEach(e=>{e.checked=e.value===window.kanbanUpdatedFilter})}catch{}}function ia(t,e={render:!0}){let s=new Set(["all","5m","30m","24h","week","month"]).has(t)?t:t==="today"?"24h":"all";window.kanbanUpdatedFilter=s;try{localStorage.setItem("kanbanUpdatedFilter",s)}catch{}$l();try{ha()}catch{}try{Xr()}catch{}if(e&&e.render===!1)return;let o=!document.querySelector(".kanban-board")?.classList.contains("hidden"),r=document.getElementById("list-view")?.classList.contains("active"),a=document.getElementById("calendar-view")?.classList.contains("active");o&&ft(),(r||$e())&&on(),a&&ye()}function Ib(t){t.stopPropagation();let e=document.getElementById("kanban-settings-panel");e.classList.contains("active")?e.classList.remove("active"):(e.classList.add("active"),document.getElementById("kanban-show-backlog").checked=window.kanbanShowBacklog===!0,document.getElementById("kanban-show-projects").checked=window.kanbanShowProjects!==!1,document.getElementById("kanban-show-no-date").checked=window.kanbanShowNoDate!==!1)}function mC(){let t=document.getElementById("kanban-show-backlog");window.kanbanShowBacklog=t.checked,localStorage.setItem("kanbanShowBacklog",t.checked);let e=document.getElementById("kanban-column-backlog");e&&(e.style.display=t.checked?"":"none"),up(),ws(),ft()}function gC(){let t=document.getElementById("kanban-show-projects");window.kanbanShowProjects=t.checked,localStorage.setItem("kanbanShowProjects",t.checked),ft()}function yC(){let t=document.getElementById("kanban-show-no-date");window.kanbanShowNoDate=t.checked,localStorage.setItem("kanbanShowNoDate",t.checked),ft()}window.toggleKanbanSettings=Ib;window.toggleKanbanBacklog=mC;window.toggleKanbanProjects=gC;window.toggleKanbanNoDate=yC;document.addEventListener("click",t=>{let e=document.getElementById("kanban-settings-panel"),n=document.getElementById("kanban-settings-btn");e&&!e.contains(t.target)&&t.target!==n&&!n.contains(t.target)&&e.classList.remove("active")});async function cn(t,e){let s=document.getElementById("task-form")?.dataset.editingTaskId;if(!s)return;let o=A.find(p=>p.id===parseInt(s,10)),r=o?JSON.parse(JSON.stringify(o)):null,a=t==="description"?ab(e):e;if(o){let p=o[t],f=!1;if(t==="projectId"){let h=a===""||a===null||typeof a>"u"?null:parseInt(a,10),m=typeof o.projectId=="number"?o.projectId:null;f=(Number.isNaN(h)?null:h)===m}else f=(typeof p=="string"?p:p||"")===(typeof a=="string"?a:a||"");if(f)return}let i=Bp(parseInt(s,10),t,a,A,R);if(!i.task)return;window.historyService&&r&&window.historyService.recordTaskUpdated(r,i.task);let l=i.oldProjectId;A=i.tasks;let c=i.task;if(t==="projectId"){fa();let p=c.projectId;l!==p&&(l&&(Zs(l),Qs(l,"removed",c)),p&&(Zs(p),Qs(p,"added",c)),Rt().catch(()=>{}))}t==="endDate"&&io(),ot().catch(p=>{console.error("Failed to save task field update:",p),Y(g("error.saveChangesFailed"))});let d=document.getElementById("project-details").classList.contains("active"),u=t==="startDate"||t==="endDate"||t==="projectId"||t==="status"||t==="priority"||t==="title"||t==="tags";if(u&&ra(),!!u){if(d)if(t==="projectId"){let p=c.projectId;if(p)if(l!==p){Qe(p);return}else{Qe(p);return}else if(l){Qe(l);return}}else{let p=l||(window.location.hash&&window.location.hash.startsWith("#project-")?parseInt(window.location.hash.replace("#project-",""),10):null);if(p){Qe(p);return}}else ft(),($e()||document.getElementById("list-view").classList.contains("active"))&&on(),document.getElementById("projects").classList.contains("active")&&(de.projectsSortedView=null,Mt(),Ct());t==="status"&&(R.autoSetStartDateOnStatusChange||R.autoSetEndDateOnStatusChange)&&setTimeout(()=>{let p=document.getElementById("task-form");if(!p)return;let f=p.querySelector('input[name="startDate"]'),h=p.querySelector('input[name="endDate"]');if(f&&c.startDate){let m=f._flatpickrInstance;m&&m.setDate(new Date(c.startDate),!1),f.value=c.startDate;let y=f.parentElement?.querySelector("input.date-display");y&&(y.value=va(c.startDate))}if(h&&c.endDate){let m=h._flatpickrInstance;m&&m.setDate(new Date(c.endDate),!1),h.value=c.endDate;let y=h.parentElement?.querySelector("input.date-display");y&&(y.value=va(c.endDate))}},50)}}var qt=null;function Cb(){let t=document.getElementById("task-form");t&&(qt={title:t.querySelector('input[name="title"]')?.value.trim()||"",description:document.getElementById("task-description-hidden")?.value.trim()||"",projectId:t.querySelector('input[name="projectId"]')?.value||t.querySelector('select[name="projectId"]')?.value||"",startDate:t.querySelector('input[name="startDate"]')?.value||"",endDate:t.querySelector('input[name="endDate"]')?.value||"",priority:t.querySelector("#hidden-priority")?.value||"medium",status:t.querySelector("#hidden-status")?.value||"backlog",tags:window.tempTags?[...window.tempTags]:[],attachments:et?et.length:0})}function Tl(){let t=document.getElementById("task-form");if(!t||t.dataset.editingTaskId||!qt)return!1;let e={title:t.querySelector('input[name="title"]')?.value.trim()||"",description:document.getElementById("task-description-hidden")?.value.trim()||"",projectId:t.querySelector('input[name="projectId"]')?.value||t.querySelector('select[name="projectId"]')?.value||"",startDate:t.querySelector('input[name="startDate"]')?.value||"",endDate:t.querySelector('input[name="endDate"]')?.value||"",priority:t.querySelector("#hidden-priority")?.value||"medium",status:t.querySelector("#hidden-status")?.value||"backlog",tags:window.tempTags?[...window.tempTags]:[],attachments:et?et.length:0};return e.title!==qt.title||e.description!==qt.description||e.projectId!==qt.projectId||e.startDate!==qt.startDate||e.endDate!==qt.endDate||e.priority!==qt.priority||e.status!==qt.status||e.tags.length!==qt.tags.length||e.attachments!==qt.attachments}function Nu(t){let e=document.getElementById(t);!e||e.__overlayBound||(e.__overlayBound=!0,e.addEventListener("pointerdown",n=>{e.__downOnOverlay=n.target===e}),e.addEventListener("click",n=>{let s=n.target===e,o=!!e.__downOnOverlay;if(e.__downOnOverlay=!1,!(!s||!o)){if(t==="task-modal"){let r=document.getElementById("task-form");r&&r.dataset.editingTaskId&&cn("description",Lo())}if(t==="task-modal"&&Tl()){sa(t);return}Bt(t)}}))}document.addEventListener("DOMContentLoaded",()=>{Nu("task-modal"),Nu("project-modal"),Nu("settings-modal")});document.addEventListener("keydown",async t=>{if(t.key==="Escape"&&document.querySelectorAll(".modal.active").forEach(n=>{if(n.id==="task-modal")if(Tl())sa("task-modal");else{let s=document.getElementById("task-form");s&&s.dataset.editingTaskId&&cn("description",Lo()),Bt(n.id)}else n.id==="settings-modal"&&window.settingsFormIsDirty?sa("settings-modal"):Bt(n.id)}),t.key==="n"||t.key==="N"){if(t.target.tagName==="INPUT"||t.target.tagName==="TEXTAREA"||t.target.isContentEditable)return;t.preventDefault();let e=document.getElementById("notification-dropdown"),n=document.getElementById("notification-toggle");if(!e||!n)return;if(e.classList.contains("active"))ks();else{ma();let o=await fl({force:!0});ea(o),e.classList.add("active"),n.classList.add("active"),await Ou(o)}}});async function Ab(){let t=document.getElementById("tag-input"),e=t.value.trim().toLowerCase();if(!e){t.style.border="2px solid var(--accent-red, #ef4444)",setTimeout(()=>{t.style.border=""},2e3);return}let n=document.getElementById("task-form").dataset.editingTaskId;if(n){let s=A.find(a=>a.id===parseInt(n));if(!s)return;if(s.tags||(s.tags=[]),s.tags.includes(e)){t.value="";return}let o=JSON.parse(JSON.stringify(s));s.tags=[...s.tags,e],Wo(s.tags),_o(),window.historyService&&window.historyService.recordTaskUpdated(o,s),document.getElementById("project-details").classList.contains("active")&&s.projectId?Qe(s.projectId):(ft(),($e()||document.getElementById("list-view").classList.contains("active"))&&on(),document.getElementById("projects").classList.contains("active")&&(de.projectsSortedView=null,Mt())),Go(),io(),ot().catch(a=>{console.error("Failed to save tag addition:",a),Y(g("error.saveTagFailed"))})}else{if(window.tempTags||(window.tempTags=[]),window.tempTags.includes(e)){t.value="";return}window.tempTags=[...window.tempTags,e],Wo(window.tempTags)}t.value=""}async function kC(t){let e=document.getElementById("task-form").dataset.editingTaskId;if(e){let n=A.find(r=>r.id===parseInt(e));if(!n||!n.tags)return;let s=JSON.parse(JSON.stringify(n));n.tags=n.tags.filter(r=>r!==t),Wo(n.tags),_o(),window.historyService&&window.historyService.recordTaskUpdated(s,n),ot().catch(r=>{console.error("Failed to save tag removal:",r),Y(g("error.removeTagFailed"))}),document.getElementById("project-details").classList.contains("active")&&n.projectId?Qe(n.projectId):(ft(),($e()||document.getElementById("list-view").classList.contains("active"))&&on(),document.getElementById("projects").classList.contains("active")&&(de.projectsSortedView=null,Mt())),Go(),io()}else window.tempTags||(window.tempTags=[]),window.tempTags=window.tempTags.filter(n=>n!==t),Wo(window.tempTags)}function Wo(t){let e=document.getElementById("tags-display"),n=$e();e.innerHTML=kf(t,{isMobile:n,getTagColor:sn,escapeHtml:V,noTagsText:g("tasks.tags.none")})}async function bC(){let t=document.getElementById("project-tag-input"),e=t.value.trim().toLowerCase();if(!e){t.style.border="2px solid var(--accent-red, #ef4444)",setTimeout(()=>{t.style.border=""},2e3);return}let n=document.getElementById("project-form").dataset.editingProjectId;if(n){let s=B.find(o=>o.id===parseInt(n));if(!s)return;if(s.tags||(s.tags=[]),s.tags.includes(e)){t.value="";return}s.tags=[...s.tags,e],la(s.tags),de.projectsSortedView=null,Mt(),ya(),Rt().catch(o=>{console.error("Failed to save project tag addition:",o),Y(g("error.saveTagFailed"))})}else{if(window.tempProjectTags||(window.tempProjectTags=[]),window.tempProjectTags.includes(e)){t.value="";return}window.tempProjectTags=[...window.tempProjectTags,e],la(window.tempProjectTags)}t.value=""}async function vC(t){let e=document.getElementById("project-form").dataset.editingProjectId;if(e){let n=B.find(s=>s.id===parseInt(e));if(!n||!n.tags)return;n.tags=n.tags.filter(s=>s!==t),la(n.tags),de.projectsSortedView=null,Mt(),ya(),Rt().catch(s=>{console.error("Failed to save project tag removal:",s),Y(g("error.saveTagFailed"))})}else{if(!window.tempProjectTags)return;window.tempProjectTags=window.tempProjectTags.filter(n=>n!==t),la(window.tempProjectTags)}}function la(t){let e=document.getElementById("project-tags-display");if(!t||t.length===0){e.innerHTML=`<span style="color: var(--text-muted); font-size: 13px;">${g("tasks.tags.none")}</span>`;return}let n=document.getElementById("project-form")?.dataset.editingProjectId,s=n?Ke(parseInt(n)):"#6b7280",o=$e(),r=o?"3px 6px":"4px 8px",a=o?"11px":"12px",i="4px",l=o?"12px":"14px",c=o?"1.2":"1.4";e.innerHTML=t.map(d=>`
            <span class="task-tag" style="background-color: ${s}; color: white; padding: ${r}; border-radius: 4px; font-size: ${a}; display: inline-flex; align-items: center; gap: ${i}; line-height: ${c};">
                ${V(d.toUpperCase())}
                <button type="button" data-action="removeProjectTag" data-param="${V(d)}" style="background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${l}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;">\xD7</button>
            </span>
        `).join("")}function ga(t,e){let n=document.getElementById("project-details-tags-display");if(!n)return;if(!t||t.length===0){n.innerHTML=`<span style="color: var(--text-muted); font-size: 13px;">${g("tasks.tags.none")}</span>`;return}let s=e?Ke(e):"#6b7280",o=$e(),r=o?"3px 6px":"4px 8px",a=o?"11px":"12px",i="4px",l=o?"12px":"14px",c=o?"1.2":"1.4";n.innerHTML=t.map(d=>`
            <span class="task-tag" style="background-color: ${s}; color: white; padding: ${r}; border-radius: 4px; font-size: ${a}; display: inline-flex; align-items: center; gap: ${i}; line-height: ${c};">
                ${V(d.toUpperCase())}
                <button type="button" data-action="removeProjectDetailsTag" data-param="${V(d)}" style="background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${l}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;">\xD7</button>
            </span>
        `).join("")}async function Mb(t){let e=document.getElementById("project-details-tag-input");if(!e)return;let n=e.value.trim().toLowerCase();if(!n){e.style.border="2px solid var(--accent-red, #ef4444)",setTimeout(()=>{e.style.border=""},2e3);return}let s=B.find(o=>o.id===parseInt(t));if(s){if(s.tags||(s.tags=[]),s.tags.includes(n)){e.value="";return}s.tags=[...s.tags,n],ga(s.tags,t),de.projectsSortedView=null,Mt(),ya(),Rt().catch(o=>{console.error("Failed to save project tag addition:",o),Y(g("error.saveTagFailed"))}),e.value=""}}async function wC(t){let e=document.getElementById("project-title-display");if(!e)return;let n=parseInt(e.dataset.param),s=B.find(o=>o.id===n);!s||!s.tags||(s.tags=s.tags.filter(o=>o!==t),ga(s.tags,n),de.projectsSortedView=null,Mt(),ya(),Rt().catch(o=>{console.error("Failed to save project tag removal:",o),Y(g("error.saveTagFailed"))}))}function Lb(){bf({toggleTheme:YI,showCalendarView:oa,toggleKanbanSettings:Ib,openProjectModal:iI,openTaskModal:Bl,closeUserDropdown:ma,openSettingsModal:JI,openTaskModalForProject:KI,openSelectedProjectFromTask:SI,closeModal:Bt,closeTaskModal:cI,closeConfirmModal:sp,closeFeedbackDeleteModal:vb,closeProjectConfirmModal:rp,closeUnsavedChangesModal:db,openDeleteAccountModal:RI,closeDeleteAccountModal:Sl,confirmDeleteAccount:cb,closeDayItemsModal:Rl,closeDayItemsModalOnBackdrop:BI,openTaskDetails:ao,deleteTask:sI,duplicateTask:oI,confirmDelete:tb,showProjectDetails:Qe,toggleProjectExpand:eb,toggleProjectMenu:iC,editProjectTitle:oC,saveProjectTitle:rC,cancelProjectTitle:wb,handleDeleteProject:qI,handleDuplicateProject:UI,toggleProjectColorPicker:dD,updateProjectColor:uD,openCustomProjectColorPicker:fD,navigateToProjectStatus:jb,deleteProject:fb,confirmProjectDelete:pb,closeDuplicateProjectModal:hb,confirmDuplicateProject:_I,addFeedbackItem:dp,deleteFeedbackItem:nC,confirmFeedbackDelete:sC,toggleHistoryEntryInline:tC,formatTaskText:DI,insertTaskHeading:II,insertTaskDivider:CI,insertTaskChecklist:AI,sortTable:HD,toggleSortMode:eD,animateCalendarMonthChange:lb,goToToday:PI,showDayTasks:NI,addAttachment:Vu,addFileAttachment:Tb,addTag:Ab,removeTag:kC,addProjectTag:bC,removeProjectTag:vC,addProjectDetailsTag:Mb,removeProjectDetailsTag:wC,removeAttachment:xb,downloadFileAttachment:Eb,viewFile:Sb,viewImageLegacy:aa,showErrorNotification:Y,t:g,backToProjects:VI,showAllActivity:CD,backToDashboard:AD,backToCalendar:WI,openUpdatesFromNotification:Ak,openDueTodayFromNotification:Mk,dismissKanbanTip:aC,confirmDiscardChanges:$I,closeReviewStatusConfirmModal:ub,confirmDisableReviewStatus:FI,closeCalendarCreateModal:ap,confirmCreateTask:zI,addTaskFromDayItemsModal:OI,signOut:ND,exportDashboardData:BD,closeExportDataModal:Kk,confirmExportData:OD,openImportDataModal:RD,closeImportDataModal:ep,confirmImportData:Yk,generateReport:zD,getCurrentMonth:()=>qe,getCurrentYear:()=>Ue,showStatusInfoModal:rI,toggleTaskSelection:UD,closeMassEditPopover:Uo,clearMassEditPopover:Qk,queueMassEditChange:KD,applyAllMassEditChanges:JD,closeMassEditConfirm:tp,closeMassEditConfirmOnBackdrop:YD,applyMassEditConfirmed:XD})}var gk=!1;function SC(){if(gk)return;gk=!0;let t=document.getElementById("mass-edit-select-all");t&&t.addEventListener("change",s=>{s.target.checked?ck():cl()});let e=document.getElementById("table-select-all");e&&e.addEventListener("change",s=>{s.target.checked?ck():cl()});let n=document.getElementById("mass-edit-clear-btn");n&&n.addEventListener("click",()=>cl()),["status","priority","dates","project","tags"].forEach(s=>{let o=document.getElementById(`mass-edit-${s}-btn`);o&&o.addEventListener("click",r=>{Xk(s,r.target)})}),document.addEventListener("click",s=>{let o=document.getElementById("mass-edit-popover");if(!o)return;let r=o.contains(s.target),a=s.target.closest(".mass-edit-btn");!r&&!a&&Uo()}),document.addEventListener("keydown",s=>{if(s.key==="Escape"){let o=document.getElementById("mass-edit-popover");o&&o.style.display!=="none"&&Uo()}})}function EC(){v.statuses.clear(),v.statusExcludeMode=!1,v.priorities.clear(),v.priorityExcludeMode=!1,v.projects.clear(),v.projectExcludeMode=!1,v.tags.clear(),v.tagExcludeMode=!1,v.search="",v.datePresets.clear(),v.dateFrom="",v.dateTo="";let t=document.getElementById("filter-search");t&&(t.value="");let e=document.getElementById("filter-due-date"),n=document.getElementById("filter-created-date");e&&(e.value=""),n&&(n.value="");let s=document.getElementById("filter-date-global");s&&(s.value=""),document.querySelectorAll('#global-filters input[type="checkbox"]').forEach(r=>{r.checked=!1}),Be()}function xC(t,e){Ze("tasks"),window.location.hash="tasks",document.querySelectorAll(".nav-item").forEach(i=>i.classList.remove("active"));let n=document.querySelector('.nav-item[data-page="tasks"]');n&&n.classList.add("active"),v.statuses.clear(),v.priorities.clear(),v.projects.clear(),v.tags.clear(),v.dateFrom="",v.dateTo="",v.search="";let s=document.getElementById("filter-search");s&&(s.value=""),v.statuses.add(e),v.projects.add(t.toString()),document.querySelectorAll('input[type="checkbox"]').forEach(i=>i.checked=!1),document.querySelectorAll(`input[data-filter="status"][value="${e}"]`).forEach(i=>i.checked=!0),document.querySelectorAll(`input[data-filter="project"][value="${t}"]`).forEach(i=>i.checked=!0),document.querySelectorAll(".view-btn").forEach(i=>i.classList.remove("active"));let o=document.querySelector(".view-btn:nth-child(2)");o&&o.classList.add("active");let r=document.querySelector(".kanban-board"),a=document.getElementById("list-view");r&&r.classList.add("hidden"),a&&a.classList.add("active"),De(),on()}window.filterProjectTasks=xC;function jb(t,e){zk("status",e),setTimeout(()=>{let n=document.querySelector(".view-toggle");n&&n.classList.remove("hidden"),v.projects.add(t.toString());let s=document.querySelector(`input[data-filter="project"][value="${t}"]`);s&&(s.checked=!0),De(),ft()},200)}window.navigateToProjectStatus=jb;function TC(t){let e=nt&&nt.querySelector(".project-portal-options");if(!e)return;let n=document.getElementById("hidden-project"),s=n&&n.value||"",o=(t||"").toLowerCase(),r="";s&&(r+=`<div class="project-option" data-project-id="">${g("tasks.project.selectPlaceholder")}</div>`),r+=B.slice().sort((a,i)=>(a.name||"").localeCompare(i.name||"",void 0,{sensitivity:"base"})).filter(a=>s===""||String(a.id)!==String(s)).filter(a=>!o||(a.name||"").toLowerCase().includes(o)).map(a=>`<div class="project-option" data-project-id="${a.id}">${a.name}</div>`).join(""),e.innerHTML=r}function io(){let t=document.getElementById("filter-date-global");if(!t)return;let e=Array.from(t.options).find(s=>s.value==="no-date");if(!e)return;let n=A.some(s=>!s.endDate);e.style.display=n?"":"none"}function Fl(){let t=document.getElementById("badge-project-status");if(!t)return;let e=K.statuses.size;t.textContent=e===0?"":e;let n=t.closest(".filter-button");n&&(e>0?n.classList.add("active"):n.classList.remove("active"))}function fp(){let t=document.getElementById("badge-project-tags");if(!t)return;let e=K.tags.size;t.textContent=e===0?"":e;let n=t.closest(".filter-button");n&&(e>0?n.classList.add("active"):n.classList.remove("active"))}function ya(){let t=document.getElementById("project-tags-options");if(!t)return;let e=new Set(K.tags),n=new Set;if(B.forEach(s=>{s.tags&&s.tags.length>0&&s.tags.forEach(o=>n.add(o))}),t.innerHTML="",n.size===0){let s=document.createElement("li");s.textContent=g("filters.noOtherTags"),s.style.color="var(--text-muted)",s.style.padding="8px 12px",t.appendChild(s)}else Array.from(n).sort().forEach(s=>{let o=document.createElement("li"),r=`project-tag-${s}`,a=e.has(s)?"checked":"";o.innerHTML=`<label><input type="checkbox" id="${r}" value="${s}" data-filter="project-tags" ${a}> ${s.toUpperCase()}</label>`,t.appendChild(o)});t.querySelectorAll('input[type="checkbox"]').forEach(s=>{s.addEventListener("change",()=>{s.checked?K.tags.add(s.value):K.tags.delete(s.value),fp(),nn()})})}function Pb(t){switch(t){case"5m":return"5m";case"30m":return"30m";case"24h":return"24h";case"week":return g("filters.updated.week");case"month":return g("filters.updated.month");default:return""}}function Nb(t){let e=Date.now();switch(t){case"5m":return e-300*1e3;case"30m":return e-1800*1e3;case"24h":return e-1440*60*1e3;case"week":return e-10080*60*1e3;case"month":return e-720*60*60*1e3;default:return null}}function Bb(t){let e=t&&(t.updatedAt||t.createdAt)||"",n=new Date(e).getTime();return Number.isFinite(n)?n:0}function ca(){let t=document.getElementById("badge-project-updated");if(t){t.textContent=Pb(K.updatedFilter);let e=t.closest(".filter-button");e&&(K.updatedFilter!=="all"?e.classList.add("active"):e.classList.remove("active"))}try{document.querySelectorAll('input[type="radio"][data-filter="project-updated"][name="project-updated-filter"]').forEach(e=>{e.checked=e.value===K.updatedFilter})}catch{}}function Ob(){let t=document.getElementById("projects-active-filters");if(!t)return;t.innerHTML="";let e=(n,s,o)=>{let r=document.createElement("span");r.className="filter-chip";let a=document.createElement("span");a.className="chip-text",a.textContent=s!=null&&s!==""?`${n}: ${s}`:n;let i=document.createElement("button");i.type="button",i.className="chip-remove",i.setAttribute("aria-label",g("filters.chip.removeAria",{label:n})),i.textContent="x",i.addEventListener("click",o),r.appendChild(a),r.appendChild(i),t.appendChild(r)};if(K.search&&e(g("filters.chip.search"),K.search,()=>{K.search="";let n=document.getElementById("projects-search");n&&(n.value="");let s=Cn()||{};eo({...s,search:""}),nn()}),K.statuses.forEach(n=>{e(g("projects.filters.status"),da(n),()=>{K.statuses.delete(n);let s=document.querySelector(`input[type="checkbox"][data-filter="project-status"][value="${n}"]`);s&&(s.checked=!1),Fl(),nn()})}),K.updatedFilter&&K.updatedFilter!=="all"&&e(g("filters.chip.updated"),Pb(K.updatedFilter),()=>{K.updatedFilter="all",ca();let n=Cn()||{};eo({...n,updatedFilter:"all"}),nn()}),K.taskFilter==="has-tasks"||K.taskFilter==="no-tasks"){let n=K.taskFilter==="has-tasks"?g("projects.filters.hasTasks"):g("projects.filters.noTasks");e(n,"",()=>{K.taskFilter="",document.querySelectorAll("#projects .projects-filters .pf-chip").forEach(o=>o.classList.remove("active"));let s=Cn()||{};eo({...s,filter:""}),nn()})}K.tags.forEach(n=>{e(g("projects.filters.tags"),n.toUpperCase(),()=>{K.tags.delete(n);let s=document.querySelector(`input[type="checkbox"][data-filter="project-tags"][value="${n}"]`);s&&(s.checked=!1),fp(),nn()})})}function nn(){let t=Fe("filters","projects",{totalProjects:B.length,statusCount:K.statuses.size,tagCount:K.tags.size,taskFilter:K.taskFilter||"",updatedFilter:K.updatedFilter||"all",hasSearch:!!K.search}),e=B.slice();if(K.statuses.size>0&&(e=e.filter(s=>{let o=An(s.id);return K.statuses.has(o)})),K.taskFilter==="has-tasks"?e=e.filter(s=>A.some(o=>o.projectId===s.id)):K.taskFilter==="no-tasks"&&(e=e.filter(s=>!A.some(o=>o.projectId===s.id))),K.tags.size>0&&(e=e.filter(s=>!s.tags||s.tags.length===0?!1:Array.from(K.tags).some(o=>s.tags.includes(o)))),K.updatedFilter&&K.updatedFilter!=="all"){let s=Nb(K.updatedFilter);s!=null&&(e=e.filter(o=>Bb(o)>=s))}if(K.search){let s=K.search.toLowerCase();e=e.filter(o=>((o.name||"")+" "+(o.description||"")).toLowerCase().includes(s))}let n=Cn()||{search:"",filter:"",sort:"default",sortDirection:"asc",updatedFilter:"all"};n.sort&&n.sort!=="default"?Wu(n.sort,e):Wu("default",e),Dl();try{Ob()}catch{}Oe("filters",t,{totalProjects:B.length,filteredCount:e.length})}function Wu(t,e){let n=e&&Array.isArray(e)?e.slice():B.slice(),o=ut.direction==="desc",r=t==="name-asc"||t==="name-desc"?"name":t;if(!r||r==="default"){let l={active:0,planning:1,backlog:2,completed:3};n.sort((c,d)=>{let u=An(c.id),p=An(d.id),f=(l[u]||999)-(l[p]||999);return o?-f:f}),de.projectsSortedView=n,DC(n);return}r==="name"?n.sort((l,c)=>{let d=(l.name||"").localeCompare(c.name||"");return o?-d:d}):r==="created-desc"?n.sort((l,c)=>{let d=new Date(c.createdAt)-new Date(l.createdAt);return o?-d:d}):r==="updated-desc"?n.sort((l,c)=>{let d=new Date(l.updatedAt||l.createdAt),p=new Date(c.updatedAt||c.createdAt)-d;return o?-p:p}):r==="tasks-desc"?n.sort((l,c)=>{let d=A.filter(u=>u.projectId===c.id).length-A.filter(u=>u.projectId===l.id).length;return o?-d:d}):r==="completion-desc"&&n.sort((l,c)=>{let d=A.filter(k=>k.projectId===l.id).length,u=A.filter(k=>k.projectId===l.id&&k.status==="done").length,p=d>0?u/d*100:0,f=A.filter(k=>k.projectId===c.id).length,h=A.filter(k=>k.projectId===c.id&&k.status==="done").length,y=(f>0?h/f*100:0)-p;return o?-y:y}),de.projectsSortedView=n;let a=document.getElementById("projects-list");if(!a)return;let i=new Set;a.querySelectorAll(".project-list-item.expanded").forEach(l=>{let c=l.id.replace("project-item-","");i.add(c)}),a.innerHTML=de.projectsSortedView.map(np).join(""),i.forEach(l=>{let c=document.getElementById(`project-item-${l}`);c&&c.classList.add("expanded")}),bl(de.projectsSortedView),Nl(a)}function Rb(t){return{default:g("projects.sort.statusLabel"),name:g("projects.sort.nameLabel"),"name-asc":g("projects.sort.nameLabel"),"name-desc":g("projects.sort.nameLabel"),"created-desc":g("projects.sort.newestLabel"),"updated-desc":g("projects.sort.lastUpdatedLabel"),"tasks-desc":g("projects.sort.mostTasksLabel"),"completion-desc":g("projects.sort.percentCompletedLabel")}[t]||t}function $b(){let t=document.getElementById("projects-sort-label");if(!t)return;let e=ut?.lastSort||"default",n=Rb(e),s=ut?.direction==="asc"?"asc":"desc";t.textContent=g("projects.sort.prefix",{label:n,direction:s});let o=document.querySelector("#projects-sort-btn .sort-label-arrow");o&&hp(o,s);try{mp()}catch{}}function hp(t,e){t&&(t.classList.toggle("is-up",e==="asc"),t.classList.toggle("is-down",e!=="asc"),t.innerHTML='<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 20 L6 14 H10 V4 H14 V14 H18 Z" fill="currentColor"/></svg>')}function yk(t,{toggleDirection:e=!1}={}){let n=t||"default",s=ut.lastSort===n;e||s?ut.direction=ut.direction==="asc"?"desc":"asc":ut.direction="asc",ut.lastSort=n,$b();try{mp()}catch{}let o=Cn()||{search:"",filter:"",sort:"default"};eo({...o,sort:n,sortDirection:ut.direction}),nn()}function mp(){let t=document.getElementById("projects-sort-panel");if(!t)return;let e=ut?.lastSort||"default",n=ut?.direction==="asc"?"asc":"desc";t.querySelectorAll(".projects-sort-option").forEach(s=>{let o=s.dataset.sort===e;s.classList.toggle("is-active",o);let r=s.querySelector(".sort-option-indicator");r||(r=document.createElement("button"),r.type="button",r.className="sort-option-indicator",r.setAttribute("aria-label",g("projects.sort.help")),s.appendChild(r)),o&&hp(r,n),r.style.visibility=o?"visible":"hidden"})}document.addEventListener("DOMContentLoaded",()=>{let t=document.getElementById("projects-sort-btn"),e=document.getElementById("projects-sort-panel"),n=document.getElementById("projects-sort-label");if(t&&e){t.addEventListener("click",l=>{if(l.target.closest(".sort-label-arrow")){l.preventDefault(),l.stopPropagation(),yk(ut?.lastSort||"default",{toggleDirection:!0});return}let d=!(t.getAttribute("aria-expanded")==="true");t.setAttribute("aria-expanded",String(d)),d?(e.setAttribute("aria-hidden","false"),e.removeAttribute("inert")):(e.contains(document.activeElement)&&t.focus(),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""));try{mp()}catch{}l.stopPropagation()});let i=document.getElementById("projects-sort-panel");if(!i)return;i.querySelectorAll(".projects-sort-option").forEach(l=>{l.addEventListener("click",c=>{let d=l.dataset.sort||"default",u=c.target&&c.target.classList&&c.target.classList.contains("sort-option-indicator");yk(d,{toggleDirection:u||ut.lastSort===d}),u?(e.removeAttribute("inert"),c.stopPropagation()):(t.setAttribute("aria-expanded","false"),e.contains(document.activeElement)&&t.focus(),e.setAttribute("aria-hidden","true"),e.setAttribute("inert",""))})}),document.addEventListener("click",()=>{t.setAttribute("aria-expanded","false"),e.contains(document.activeElement)&&t.focus(),e.setAttribute("aria-hidden","true"),e.setAttribute("inert","")})}let s=document.getElementById("group-project-status");s&&s.querySelectorAll('input[type="checkbox"][data-filter="project-status"]').forEach(l=>{l.addEventListener("change",()=>{l.checked?K.statuses.add(l.value):K.statuses.delete(l.value),Fl(),nn(),Fb()})});let o=document.getElementById("projects-search");o&&o.addEventListener("input",rr(i=>{K.search=(i.target.value||"").trim(),nn();let l=Cn()||{};eo({...l,search:i.target.value})},220));let r=Array.from(document.querySelectorAll(".pf-chip"));r.forEach(i=>{i.addEventListener("click",()=>{let l=i.dataset.filter;i.classList.contains("active")?(i.classList.remove("active"),K.taskFilter=""):(r.forEach(d=>d.classList.remove("active")),i.classList.add("active"),K.taskFilter=l),nn();let c=Cn()||{};eo({...c,filter:K.taskFilter||""})})});let a=document.getElementById("btn-clear-projects");a&&a.addEventListener("click",zb),Dl()});window.clearProjectFilters=zb;function Fb(){let t=new URLSearchParams,e=Cn()||{},n=K.search||e.search;n&&n.trim()!==""&&t.set("search",n.trim()),K.statuses.size>0&&t.set("status",Array.from(K.statuses).join(","));let s=K.taskFilter||e.filter;s&&["has-tasks","no-tasks"].includes(s)&&t.set("filter",s),e.sort&&e.sort!=="default"&&t.set("sort",e.sort),e.sortDirection&&e.sortDirection!=="asc"&&t.set("sortDirection",e.sortDirection);let o=K.updatedFilter||e.updatedFilter;o&&o!=="all"&&t.set("updatedFilter",o);let r=t.toString(),a=r?`#projects?${r}`:"#projects";window.location.hash!==a&&window.history.replaceState(null,"",a)}function eo(t){try{localStorage.setItem("projectsViewState",JSON.stringify(t)),Fb()}catch{}}function Cn(){try{let t=localStorage.getItem("projectsViewState");if(!t)return null;let e=JSON.parse(t);return!e||typeof e!="object"?null:(e.filter==="clear"&&(e.filter=""),e.filter&&e.filter!=="has-tasks"&&e.filter!=="no-tasks"&&(e.filter=""),e.updatedFilter==null&&(e.updatedFilter="all"),e.updatedFilter&&typeof e.updatedFilter=="string"&&(new Set(["all","5m","30m","24h","week","month"]).has(e.updatedFilter)||(e.updatedFilter="all")),e)}catch{return null}}function DC(t){let e=document.getElementById("projects-list");if(!e)return;if(!t||t.length===0){e.innerHTML=`<div class="empty-state"><h3>${g("projects.empty.filteredTitle")}</h3></div>`,bl([]);return}let n=new Set;e.querySelectorAll(".project-list-item.expanded").forEach(s=>{let o=s.id.replace("project-item-","");n.add(o)}),e.innerHTML=t.map(np).join(""),n.forEach(s=>{let o=document.getElementById(`project-item-${s}`);o&&o.classList.add("expanded")}),bl(t)}function IC(){let t=document.getElementById("projects-sort"),e=document.getElementById("projects-sort-btn"),n=document.getElementById("projects-sort-label"),s=document.getElementById("projects-search"),o=Array.from(document.querySelectorAll(".pf-chip")),r=Cn()||{search:"",filter:"",sort:"default",sortDirection:"asc",updatedFilter:"all"},a=window.urlProjectFilters||{},i={search:a.search!==void 0?a.search:r.search,filter:a.filter!==void 0?a.filter:r.filter,sort:a.sort!==void 0?a.sort:r.sort,sortDirection:a.sortDirection!==void 0?a.sortDirection:r.sortDirection,updatedFilter:a.updatedFilter!==void 0?a.updatedFilter:r.updatedFilter};i.filter==="clear"&&(i.filter=""),i.filter&&i.filter!=="has-tasks"&&i.filter!=="no-tasks"&&(i.filter=""),a.statuses&&Array.isArray(a.statuses)&&a.statuses.length>0&&(K.statuses.clear(),a.statuses.forEach(h=>K.statuses.add(h)),document.querySelectorAll('input[type="checkbox"][data-filter="project-status"]').forEach(h=>{h.checked=K.statuses.has(h.value)}),Fl()),i.search&&(K.search=i.search),i.filter&&(K.taskFilter=i.filter),window.urlProjectFilters=null;let l=i.sort||"default",c=i.sortDirection||"asc";if(l==="name-asc"?(l="name",c="asc"):l==="name-desc"&&(l="name",c="desc"),ut.lastSort=l,ut.direction=c,s&&(s.value=i.search||""),o&&o.length&&(o.forEach(f=>f.classList.remove("active")),i.filter&&["has-tasks","no-tasks"].includes(i.filter))){let f=o.find(h=>h.dataset.filter===i.filter);f&&f.classList.add("active")}let d=de.projectsSortedView&&de.projectsSortedView.length?de.projectsSortedView.slice():B.slice();if(s&&s.value&&s.value.trim()!==""){let f=s.value.trim().toLowerCase();d=d.filter(h=>((h.name||"")+" "+(h.description||"")).toLowerCase().includes(f))}K.statuses.size>0&&(d=d.filter(f=>{let h=An(f.id);return K.statuses.has(h)}));let u=i.filter||K.taskFilter;if(u==="has-tasks"?d=d.filter(f=>A.some(h=>h.projectId===f.id)):u==="no-tasks"&&(d=d.filter(f=>!A.some(h=>h.projectId===f.id))),i.updatedFilter&&i.updatedFilter!=="all"){let f=Nb(i.updatedFilter);f!=null&&(d=d.filter(h=>Bb(h)>=f))}if(e){let f=i.sort||"default",h=Rb(f),m=ut.direction==="asc"?"asc":"desc",y=g("projects.sort.prefix",{label:h,direction:m});n&&(n.textContent=y);let k=document.querySelector("#projects-sort-btn .sort-label-arrow");k&&hp(k,m)}{let f=new Set(["all","5m","30m","24h","week","month"]),h=f.has(i.updatedFilter)?i.updatedFilter:"all";K.updatedFilter=h,ca();try{Ob()}catch{}document.querySelectorAll('input[type="radio"][data-filter="project-updated"][name="project-updated-filter"]').forEach(m=>{m.__projectUpdatedBound||(m.__projectUpdatedBound=!0,m.addEventListener("change",()=>{if(!m.checked)return;K.updatedFilter=f.has(m.value)?m.value:"all",ca(),nn();let y=Cn()||i;eo({...y,updatedFilter:K.updatedFilter}),Dl()}))})}let p=ut.lastSort||"default";Wu(p,d),Dl()}function Dl(){let t=document.getElementById("btn-clear-projects");if(!t)return;let e=K.search&&K.search.trim()!=="",n=K.statuses.size>0,s=K.taskFilter!=="",o=K.updatedFilter&&K.updatedFilter!=="all",r=K.tags.size>0,a=e||n||s||o||r;t.style.display=a?"inline-flex":"none"}function zb(){K.search="",K.statuses.clear(),K.taskFilter="",K.updatedFilter="all",K.tags.clear();let t=document.getElementById("projects-search");t&&(t.value=""),Array.from(document.querySelectorAll(".pf-chip")).forEach(o=>o.classList.remove("active")),document.querySelectorAll('input[type="checkbox"][data-filter="project-status"]').forEach(o=>o.checked=!1),document.querySelectorAll('input[type="checkbox"][data-filter="project-tags"]').forEach(o=>o.checked=!1),document.querySelectorAll('input[type="radio"][data-filter="project-updated"][name="project-updated-filter"]').forEach(o=>o.checked=o.value==="all"),ca(),Fl(),fp(),nn()}function kk(){let t=document.getElementById("hamburger-btn"),e=document.querySelector(".sidebar"),n=document.getElementById("sidebar-overlay");if(!t||!e||!n)return;function s(){e.classList.toggle("active"),n.classList.toggle("active"),document.body.style.overflow=e.classList.contains("active")?"hidden":""}function o(){e.classList.remove("active"),n.classList.remove("active"),document.body.style.overflow=""}t.addEventListener("click",s),n.addEventListener("click",o),e.querySelectorAll(".nav-item").forEach(a=>{a.addEventListener("click",()=>{$e()&&o()})}),window.addEventListener("resize",()=>{window.innerWidth>768&&o()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",kk):kk();window.addEventListener("resize",()=>{Nl()});var CC=typeof window<"u"&&typeof window.__pageLoadStart=="number"?window.__pageLoadStart:performance.now(),AC=performance.now();pn()&&console.log(`[perf] main.js: executed after ${Math.round(AC-CC)}ms since nav start`);Lb();pn()&&Ft("event-delegation-setup");document.addEventListener("DOMContentLoaded",()=>{pn()&&Ft("dom-content-loaded")});
