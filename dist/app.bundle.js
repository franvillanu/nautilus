var Xi=Object.defineProperty;var Qi=(e,t)=>()=>(e&&(t=e(e=0)),t);var ec=(e,t)=>{for(var a in t)Xi(e,a,{get:t[a],enumerable:!0})};var vr={};ec(vr,{generateWordReport:()=>Gc});import{Document as Mc,Packer as Fc,Paragraph as Z,Table as Da,TableCell as fe,TableRow as Bt,TextRun as ee,AlignmentType as le,WidthType as ge,BorderStyle as se,HeadingLevel as na,ShadingType as kt}from"https://esm.sh/docx@9.5.1";function rn(e){return e>=75?Be.success:e>=50?Be.primary:e>=25?Be.priority.medium:Be.priority.high}function Oc(e,t){let a=new Set(t.filter(r=>r.status!=="done").map(r=>r.projectId).filter(r=>r!==null)),n=t.length,o=t.filter(r=>r.status==="done").length,s=n>0?Math.round(o/n*100):0;return{activeProjectsCount:a.size,totalTasks:n,completedTasks:o,completionPercent:s}}function gr(e,t){let a=t.filter(l=>l.projectId===e.id),n=a.length,o=a.filter(l=>l.status==="done").length,s=n>0?Math.round(o/n*100):0,r=new Date().toISOString().split("T")[0],i=a.filter(l=>l.status!=="done"&&l.endDate&&l.endDate<r).length,c=a.filter(l=>!l.startDate||!l.endDate).length;return{totalTasks:n,completedTasks:o,completionPercent:s,overdueTasks:i,tasksWithoutDates:c,tasks:a}}function yr(e){return(e.tags||[]).map(t=>t.toUpperCase())}function qc(e){return(e.tags||[]).map(t=>t.toUpperCase())}function zc(e,t){let a=yr(e),n=qc(t),o=[...a,...n];for(let s of Rc)if(o.includes(s))return s;return null}function Hc(e,t){if(!t)return null;let a=yr(e),n=hr[t];for(let o of n)if(a.includes(o))return o;return null}function Uc(e,t){let a=t.filter(o=>o.projectId===e.id),n={};for(let o of a){let s=zc(o,e);if(!s)continue;n[s]||(n[s]={localities:{},otherTasks:[]});let r=Hc(o,s);r?(n[s].localities[r]||(n[s].localities[r]=[]),n[s].localities[r].push(o)):n[s].otherTasks.push(o)}return n}function co(e){return[...e].sort((t,a)=>!t.startDate&&!a.startDate?0:t.startDate?a.startDate?t.startDate!==a.startDate?t.startDate.localeCompare(a.startDate):!t.endDate&&!a.endDate?0:t.endDate?a.endDate?t.endDate.localeCompare(a.endDate):-1:1:-1:1)}function _c(){let t=new Date().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return[new Z({children:[new ee({text:"REPORTE NAUTILUS",size:36,bold:!0})],heading:na.TITLE,alignment:le.CENTER,spacing:{after:150}}),new Z({children:[new ee({text:"Sistema de Gesti\xF3n de Investigaci\xF3n Marina",size:20,color:"6B7280"})],alignment:le.CENTER,spacing:{after:100}}),new Z({children:[new ee({text:t,size:18,color:"9CA3AF"})],alignment:le.CENTER,spacing:{after:300}}),new Z({text:"",border:{bottom:{color:"D1D5DB",space:1,style:se.SINGLE,size:3}},spacing:{after:400}})]}function Vc(e,t){let a={done:t.filter(s=>s.status==="done").length,progress:t.filter(s=>s.status==="progress").length,review:t.filter(s=>s.status==="review").length,todo:t.filter(s=>s.status==="todo").length},n=new Da({width:{size:100,type:ge.PERCENTAGE},borders:{top:{style:se.NONE},bottom:{style:se.NONE},left:{style:se.NONE},right:{style:se.NONE},insideHorizontal:{style:se.NONE},insideVertical:{style:se.SINGLE,size:1,color:"E5E7EB"}},rows:[new Bt({children:[new fe({children:[new Z({children:[new ee({text:"Proyectos Activos",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:200,after:100}}),new Z({children:[new ee({text:e.activeProjectsCount.toString(),size:48,bold:!0,color:Be.primary})],alignment:le.CENTER,spacing:{after:200}})],width:{size:33.33,type:ge.PERCENTAGE},shading:{fill:"FAFAFA",type:kt.CLEAR}}),new fe({children:[new Z({children:[new ee({text:"Tareas Completadas",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:200,after:100}}),new Z({children:[new ee({text:`${e.completedTasks}/${e.totalTasks}`,size:48,bold:!0})],alignment:le.CENTER,spacing:{after:200}})],width:{size:33.33,type:ge.PERCENTAGE},shading:{fill:"FAFAFA",type:kt.CLEAR}}),new fe({children:[new Z({children:[new ee({text:"Progreso Global",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:200,after:100}}),new Z({children:[new ee({text:`${e.completionPercent}%`,size:48,bold:!0,color:rn(e.completionPercent)})],alignment:le.CENTER,spacing:{after:200}})],width:{size:33.33,type:ge.PERCENTAGE},shading:{fill:"FAFAFA",type:kt.CLEAR}})]})]}),o=new Da({width:{size:100,type:ge.PERCENTAGE},alignment:le.CENTER,borders:{top:{style:se.SINGLE,size:1,color:"E5E7EB"},bottom:{style:se.SINGLE,size:1,color:"E5E7EB"},left:{style:se.NONE},right:{style:se.NONE},insideHorizontal:{style:se.NONE},insideVertical:{style:se.NONE}},rows:[new Bt({children:[new fe({children:[new Z({children:[new ee({text:"Por Hacer",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:150,after:50}}),new Z({children:[new ee({text:a.todo.toString(),size:32,bold:!0,color:"9CA3AF"})],alignment:le.CENTER,spacing:{after:150}})],width:{size:25,type:ge.PERCENTAGE}}),new fe({children:[new Z({children:[new ee({text:"En Progreso",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:150,after:50}}),new Z({children:[new ee({text:a.progress.toString(),size:32,bold:!0,color:Be.primary})],alignment:le.CENTER,spacing:{after:150}})],width:{size:25,type:ge.PERCENTAGE}}),new fe({children:[new Z({children:[new ee({text:"En Revisi\xF3n",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:150,after:50}}),new Z({children:[new ee({text:a.review.toString(),size:32,bold:!0,color:Be.priority.medium})],alignment:le.CENTER,spacing:{after:150}})],width:{size:25,type:ge.PERCENTAGE}}),new fe({children:[new Z({children:[new ee({text:"Completadas",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:150,after:50}}),new Z({children:[new ee({text:a.done.toString(),size:32,bold:!0,color:Be.success})],alignment:le.CENTER,spacing:{after:150}})],width:{size:25,type:ge.PERCENTAGE}})]})]});return[new Z({children:[new ee({text:"Resumen Global",size:32,bold:!0})],heading:na.HEADING_1,spacing:{before:200,after:300}}),n,new Z({text:"",spacing:{before:300,after:200}}),new Z({children:[new ee({text:"Distribuci\xF3n de Tareas",size:22,bold:!0})],spacing:{after:150}}),o,new Z({text:"",spacing:{after:400}})]}function lo(e){let t=new Bt({tableHeader:!0,children:[new fe({children:[new Z({children:[new ee({text:"Tarea",bold:!0,size:20})],alignment:le.LEFT})],width:{size:35,type:ge.PERCENTAGE},shading:{type:kt.CLEAR,fill:Be.headerBg}}),new fe({children:[new Z({children:[new ee({text:"Prioridad",bold:!0,size:20})],alignment:le.CENTER})],width:{size:13,type:ge.PERCENTAGE},shading:{type:kt.CLEAR,fill:Be.headerBg}}),new fe({children:[new Z({children:[new ee({text:"Estado",bold:!0,size:20})],alignment:le.CENTER})],width:{size:17,type:ge.PERCENTAGE},shading:{type:kt.CLEAR,fill:Be.headerBg}}),new fe({children:[new Z({children:[new ee({text:"Inicio",bold:!0,size:20})],alignment:le.CENTER})],width:{size:17,type:ge.PERCENTAGE},shading:{type:kt.CLEAR,fill:Be.headerBg}}),new fe({children:[new Z({children:[new ee({text:"Fin",bold:!0,size:20})],alignment:le.CENTER})],width:{size:18,type:ge.PERCENTAGE},shading:{type:kt.CLEAR,fill:Be.headerBg}})]}),a={low:"Baja",medium:"Media",high:"Alta"},n={todo:"Por Hacer",progress:"En Progreso",review:"En Revisi\xF3n",done:"Completada"},o=e.map(s=>{let r=Be.status[s.status]||"FFFFFF",i=Be.priority[s.priority]||"9CA3AF",c=fr.priority[s.priority]||"",l=fr.status[s.status]||"";return new Bt({children:[new fe({children:[new Z({text:s.title||"Sin t\xEDtulo",spacing:{before:100,after:100}})]}),new fe({children:[new Z({children:[new ee({text:`${c} `,color:i}),new ee({text:a[s.priority]||s.priority||"-"})],alignment:le.CENTER,spacing:{before:100,after:100}})]}),new fe({children:[new Z({children:[new ee({text:`${l} `}),new ee({text:n[s.status]||s.status||"-",strike:s.status==="done"})],alignment:le.CENTER,spacing:{before:100,after:100}})],shading:{type:kt.CLEAR,fill:r}}),new fe({children:[new Z({text:s.startDate||"-",alignment:le.CENTER,spacing:{before:100,after:100}})]}),new fe({children:[new Z({text:s.endDate||"-",alignment:le.CENTER,spacing:{before:100,after:100}})]})]})});return new Da({rows:[t,...o],width:{size:100,type:ge.PERCENTAGE},borders:{top:{style:se.SINGLE,size:1},bottom:{style:se.SINGLE,size:1},left:{style:se.SINGLE,size:1},right:{style:se.SINGLE,size:1},insideHorizontal:{style:se.SINGLE,size:1},insideVertical:{style:se.SINGLE,size:1}}})}function Wc(e,t,a){let n=[];n.push(new Z({children:[new ee({text:e.name,size:28,bold:!0})],heading:na.HEADING_1,spacing:{before:600,after:200}}));let o=[`${t.completedTasks}/${t.totalTasks} tareas`,new ee({text:`${t.completionPercent}%`,bold:!0,color:rn(t.completionPercent)})],s=[];s.push(new Bt({children:[new fe({children:[new Z({children:[new ee({text:"\u{1F4CA} Progreso",size:16,color:"4B5563"})]})],width:{size:30,type:ge.PERCENTAGE},shading:{fill:"F9FAFB"}}),new fe({children:[new Z({children:[new ee({text:`${t.completionPercent}%`,size:18,bold:!0,color:rn(t.completionPercent)}),new ee({text:`  (${t.completedTasks}/${t.totalTasks} tareas)`,size:14,color:"6B7280"})]})],width:{size:70,type:ge.PERCENTAGE}})]})),t.overdueTasks>0&&s.push(new Bt({children:[new fe({children:[new Z({children:[new ee({text:"\u26A0\uFE0F Vencidas",size:16,color:"4B5563"})]})],width:{size:30,type:ge.PERCENTAGE},shading:{fill:"FEF2F2"}}),new fe({children:[new Z({children:[new ee({text:`${t.overdueTasks} tareas`,size:16,color:Be.priority.high})]})],width:{size:70,type:ge.PERCENTAGE}})]})),t.tasksWithoutDates>0&&s.push(new Bt({children:[new fe({children:[new Z({children:[new ee({text:"\u{1F4C5} Sin fechas",size:16,color:"4B5563"})]})],width:{size:30,type:ge.PERCENTAGE},shading:{fill:"FFFBEB"}}),new fe({children:[new Z({children:[new ee({text:`${t.tasksWithoutDates} tareas`,size:16,color:"6B7280"})]})],width:{size:70,type:ge.PERCENTAGE}})]}));let r=new Da({width:{size:100,type:ge.PERCENTAGE},borders:{top:{style:se.SINGLE,size:1,color:"E5E7EB"},bottom:{style:se.SINGLE,size:1,color:"E5E7EB"},left:{style:se.SINGLE,size:1,color:"E5E7EB"},right:{style:se.SINGLE,size:1,color:"E5E7EB"},insideHorizontal:{style:se.SINGLE,size:1,color:"E5E7EB"},insideVertical:{style:se.SINGLE,size:1,color:"E5E7EB"}},rows:s});n.push(r),n.push(new Z({text:"",spacing:{after:200}}));let i=co(t.tasks);i.length>0&&n.push(lo(i));let c=Uc(e,a);if(Object.keys(c).length>0){n.push(new Z({children:[new ee({text:"Desglose Geogr\xE1fico",size:26,bold:!0})],heading:na.HEADING_2,spacing:{before:400,after:300}}));for(let l of Object.keys(c).sort()){let u=c[l];n.push(new Z({children:[new ee({text:"\u{1F3DD}\uFE0F ",size:24}),new ee({text:l,size:24,bold:!0,color:Be.primary})],heading:na.HEADING_3,spacing:{before:350,after:200}}));let d=Object.keys(u.localities).sort();for(let f of d){let m=co(u.localities[f]);n.push(new Z({children:[new ee({text:"\u{1F4CD} ",size:22}),new ee({text:f,size:22,bold:!0,italics:!1})],spacing:{before:250,after:150}})),n.push(lo(m)),n.push(new Z({text:"",spacing:{after:250}}))}if(u.otherTasks.length>0){let f=co(u.otherTasks);n.push(new Z({children:[new ee({text:"\u{1F4CD} ",size:22}),new ee({text:"Otras Ubicaciones",size:22,bold:!0,italics:!1})],spacing:{before:250,after:150}})),n.push(lo(f)),n.push(new Z({text:"",spacing:{after:250}}))}}}return n}async function Gc(e,t){try{let a=Oc(e,t),n=[];n.push(..._c()),n.push(...Vc(a,t));let o=[...e].sort((f,m)=>f.name.localeCompare(m.name,"es",{sensitivity:"base"}));n.push(new Z({children:[new ee({text:"Proyectos",size:32,bold:!0})],heading:na.HEADING_1,spacing:{before:600,after:300}}));let s=o.map(f=>{let m=gr(f,t);return new fe({children:[new Z({children:[new ee({text:f.name,size:16,bold:!0})],alignment:le.CENTER,spacing:{before:150,after:50}}),new Z({children:[new ee({text:`${m.completionPercent}%`,size:28,bold:!0,color:rn(m.completionPercent)})],alignment:le.CENTER,spacing:{after:50}}),new Z({children:[new ee({text:`${m.completedTasks}/${m.totalTasks} tareas`,size:14,color:"6B7280"})],alignment:le.CENTER,spacing:{after:150}})],width:{size:100/o.length,type:ge.PERCENTAGE}})}),r=new Da({width:{size:100,type:ge.PERCENTAGE},borders:{top:{style:se.SINGLE,size:1,color:"E5E7EB"},bottom:{style:se.SINGLE,size:1,color:"E5E7EB"},left:{style:se.NONE},right:{style:se.NONE},insideHorizontal:{style:se.NONE},insideVertical:{style:se.SINGLE,size:1,color:"E5E7EB"}},rows:[new Bt({children:s})]});n.push(r),n.push(new Z({text:"",spacing:{after:400}}));for(let f of o){let m=gr(f,t);n.push(...Wc(f,m,t))}let i=new Mc({sections:[{properties:{},children:n}]}),c=await Fc.toBlob(i),l=URL.createObjectURL(c),u=`Reporte-Nautilus-${new Date().toISOString().split("T")[0]}.docx`,d=document.createElement("a");return d.href=l,d.download=u,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(l),{success:!0,filename:u,insights:a}}catch(a){return console.error("Error generating report:",a),{success:!1,error:a.message}}}var hr,Rc,Be,fr,br=Qi(()=>{hr={TENERIFE:["TAJAO","LOS CRISTIANOS","LAS TERESITAS","EL M\xC9DANO","SAN JUAN","BOCA CANGREJO"],"LA PALMA":["LOS CANCAJOS","LA BOMBILLA","R\xCDO MUERTO"],LANZAROTE:["\xD3RZOLA"],FUERTEVENTURA:["TONELES","JACOMAR","LOBOS","MORRO JABLE"]},Rc=Object.keys(hr),Be={status:{todo:"E5E7EB",progress:"DBEAFE",review:"FEF3C7",done:"D1FAE5"},priorityBg:{low:"F3F4F6",medium:"FEF3C7",high:"FEE2E2"},priority:{low:"9CA3AF",medium:"F59E0B",high:"EF4444"},primary:"0284C7",secondary:"6366F1",success:"10B981",headerBg:"F3F4F6"},fr={priority:{low:"\u25A0",medium:"\u25A0",high:"\u25A0"},status:{todo:"\u2B1C",progress:"\u{1F7E6}",review:"\u{1F7E8}",done:"\u2705"},sections:{project:"\u{1F4C1}",island:"\u{1F3DD}\uFE0F",locality:"\u{1F4CD}",summary:"\u{1F4CA}",tasks:"\u{1F4CB}",metrics:"\u{1F4C8}"},progress:{full:"\u{1F7E9}",high:"\u{1F7E8}",medium:"\u{1F7E7}",low:"\u{1F7E5}"}}});var Gn={en:"en-US",es:"es-ES"},Ja={en:{"boot.loading":"Loading Nautilus","lock.welcome":"Welcome back","lock.subtitle":"Enter the access password to continue.","lock.sessionHint":"? Session stays signed-in for 24 hours.","lock.passwordLabel":"Password","lock.passwordPlaceholder":"Enter password","lock.unlock":"Unlock","auth.backToUserLogin":"Back to User Login","auth.login.title":"Welcome to Nautilus","auth.login.subtitle":"Login to access your workspace","auth.login.identifierLabel":"Username or Email","auth.login.identifierPlaceholder":"Enter username or email","auth.login.pinLabel":"PIN (4 digits)","auth.admin.title":"Admin Access","auth.admin.subtitle":"Enter master PIN to access admin dashboard","auth.admin.pinLabel":"Master PIN (4 digits)","auth.setup.title":"Complete Your Setup","auth.setup.subtitle":"Personalize your account","auth.setup.usernameLabel":"Username","auth.setup.usernamePlaceholder":"e.g., alex","auth.setup.usernameHint":"3-20 characters, lowercase letters and numbers only","auth.setup.displayNameLabel":"Display Name","auth.setup.displayNamePlaceholder":"e.g., Alex Morgan","auth.setup.emailLabel":"Email","auth.setup.emailPlaceholder":"your.email@example.com","auth.setup.emailHint":"Required for notifications","auth.setup.newPinLabel":"New PIN (4 digits)","auth.setup.confirmPinLabel":"Confirm PIN","auth.setup.next":"Next","auth.setup.submit":"Complete Setup","admin.title":"User Management","admin.signOut":"Sign Out","admin.usersTitle":"Users","admin.createUserTitle":"Create New User","admin.usernameLabel":"Username","admin.usernamePlaceholder":"e.g., jdoe","admin.usernameHint":"3-20 characters, lowercase letters and numbers only","admin.displayNameLabel":"Display Name","admin.displayNamePlaceholder":"e.g., John Doe","admin.tempPinLabel":"Temporary PIN (4 digits)","admin.createUserButton":"Create User","auth.admin.resetPinPrompt":"Enter new temporary PIN for {userName}:","auth.admin.pinMustBe4Digits":"PIN must be exactly 4 digits","auth.admin.resetPinFailed":"Failed to reset PIN","auth.admin.resetPinSuccess":"PIN reset for {userName}. New temp PIN: {pin}","auth.admin.deleteUserConfirm":'Are you sure you want to delete user "{userName}"? This will also delete all their tasks and projects.',"auth.admin.deleteUserFailed":"Failed to delete user","auth.admin.deleteUserSuccess":'User "{userName}" deleted successfully',"common.cancel":"Cancel","common.delete":"Delete","common.continue":"Continue","common.gotIt":"Got it","common.close":"Close modal","common.done":"Done","common.nautilusLogoAlt":"Nautilus logo","common.devBanner":"\u26A0\uFE0F LOCAL DEV - NOT PRODUCTION \u26A0\uFE0F","common.datePlaceholder":"dd/mm/yyyy","crop.title":"Crop Image to Square","crop.instructions":"Drag to adjust the crop area. The image will be cropped to a square.","crop.apply":"Crop & Apply","crop.close":"Close crop modal","dashboard.insights.productivityTitle":"Productivity Trend","dashboard.insights.productivityDesc":"Task completion rate increased 23% compared to last month","dashboard.insights.deadlineTitle":"Deadline Alert","dashboard.insights.deadlineDesc":"3 milestones due within the next 7 days","projects.title":"Projects","projects.subtitle":"Manage your projects","projects.searchPlaceholder":"\u{1F50D} Search projects (title or description)","projects.filters.status":"Status","projects.filters.statusTitle":"Project Status","projects.status.backlog":"BACKLOG","projects.status.planning":"PLANNING","projects.status.active":"ACTIVE","projects.status.completed":"COMPLETED","projects.filters.updated":"Updated","projects.filters.updatedTitle":"Recently Updated","projects.filters.all":"All","projects.filters.last5m":"Last 5 minutes","projects.filters.last30m":"Last 30 minutes","projects.filters.last24h":"Last 24 hours","projects.filters.lastWeek":"Last week","projects.filters.lastMonth":"Last month","projects.filters.hasTasks":"Has tasks","projects.filters.noTasks":"No tasks","projects.filters.tags":"Tags","projects.filters.tagsTitle":"Project Tags","projects.filters.clear":"Clear Filters","projects.noDescription":"No description","projects.tasksBreakdown":"{total} tasks \xB7 {done} done","tasks.card.description":"Description","projects.card.tasksCount":"{count} tasks","projects.card.percentDone":"{count}% done","projects.sort.label":"Sort: Status","projects.sort.status":"Status","projects.sort.name":"Name","projects.sort.newest":"Newest","projects.sort.lastUpdated":"Last Updated","projects.sort.mostTasks":"Most tasks","projects.sort.percentCompleted":"% Completed","projects.sort.prefix":"Sort: {label}","projects.sort.help":"Click the same option again to switch Asc/Desc.","projects.sort.statusLabel":"Status","projects.sort.nameLabel":"Name","projects.sort.newestLabel":"Newest","projects.sort.lastUpdatedLabel":"Last Updated","projects.sort.mostTasksLabel":"Most tasks","projects.sort.percentCompletedLabel":"% Completed","projects.newProjectButton":"+ New Project","projects.openDetailsTitle":"View project details","projects.empty.title":"No projects yet","projects.empty.subtitle":"Create your first project","projects.empty.searchTitle":"No projects found","projects.empty.searchSubtitle":"Create a new project to get started","projects.empty.filteredTitle":"No projects matched","projects.modal.createTitle":"Create New Project","projects.modal.nameLabel":"Project Name","projects.modal.descriptionLabel":"Description","projects.modal.startDateLabel":"Start Date","projects.modal.endDateLabel":"End Date","projects.modal.tagsLabel":"Tags","projects.modal.addTagPlaceholder":"Add tag","projects.modal.createButton":"Create Project","projects.delete.title":"Delete Project","projects.delete.body":"This action cannot be undone. To confirm deletion, type delete below:","projects.delete.deleteTasksLabel":"Delete all tasks in this project","projects.delete.deleteTasksHint":"If unchecked, tasks will be unassigned from the project","projects.delete.inputPlaceholder":"Type delete here","projects.delete.error":'Type "delete" exactly to confirm',"projects.duplicate.title":"Duplicate Project","projects.duplicate.description":"Create a copy of this project with all its settings.","projects.duplicate.includeTasksLabel":"Include all tasks from this project","projects.duplicate.taskNamingTitle":"Task naming:","projects.duplicate.namingNone":"Keep original names","projects.duplicate.namingPrefix":"Add prefix:","projects.duplicate.namingSuffix":"Add suffix:","projects.duplicate.prefixPlaceholder":"e.g., Copy - ","projects.duplicate.suffixPlaceholder":"e.g., (Copy)","projects.duplicate.confirm":"Duplicate Project","projects.duplicate.success":'Project "{name}" duplicated successfully',"projects.duplicate.successWithTasks":'Project "{name}" and its tasks duplicated successfully',"projects.statusInfo.title":"Project Status Logic","projects.statusInfo.subtitle":"Project status updates automatically based on task progress","projects.statusInfo.backlogTitle":"\u2B1B Backlog","projects.statusInfo.backlogDesc":'All tasks are in "Backlog"',"projects.statusInfo.planningTitle":"\u2B1C Planning","projects.statusInfo.planningDesc":'All tasks are in "To Do"',"projects.statusInfo.activeTitle":"\u2705 Active","projects.statusInfo.activeDesc":'At least one task is "In Progress" or "In Review"',"projects.statusInfo.completedTitle":"? Completed","projects.statusInfo.completedDesc":'All tasks are marked as "Done"',"projects.backTo.dashboard":"\u2190 Back to Dashboard","projects.backTo.calendar":"\u2190 Back to Calendar","projects.backTo.projects":"\u2190 Back to Projects","projects.details.tab.details":"Details","projects.details.tab.history":"History","projects.details.startDate":"Start Date","projects.details.endDate":"End Date","projects.details.duration":"Duration","projects.details.durationDays":"{count} days","projects.details.created":"Created","projects.details.calendarColor":"Calendar Color","projects.details.customColor":"Custom color","projects.details.progressOverview":"Progress Overview","projects.details.taskProgress":"Task Progress","projects.details.tasksTitle":"Tasks ({count})","projects.details.changeHistory":"Change History","projects.details.noChanges":"No changes yet for this project","projects.details.noTasksFound":"No tasks found","projects.details.viewTodo":"View To Do tasks for this project","projects.details.viewProgress":"View In Progress tasks for this project","projects.details.viewReview":"View In Review tasks for this project","projects.details.viewCompleted":"View Completed tasks for this project","projects.details.viewBacklog":"View backlog tasks in List view","projects.untitled":"Untitled Project","tasks.title":"All Tasks","tasks.subtitle":"Manage tasks across all projects","tasks.searchPlaceholder":"\u{1F50D} Search tasks (title or description)","tasks.filters.status":"Status","tasks.filters.statusTitle":"Status","tasks.status.backlog":"Backlog","tasks.status.todo":"To Do","tasks.status.progress":"In Progress","tasks.status.review":"In Review","tasks.status.done":"Done","tasks.filters.tags":"Tags","tasks.filters.tagsTitle":"Tags","tasks.filters.priority":"Priority","tasks.filters.priorityTitle":"Priority","tasks.priority.high":"High","tasks.priority.medium":"Medium","tasks.priority.low":"Low","tasks.filters.project":"Project","tasks.filters.projectTitle":"Project","tasks.filters.selectAll":"Select / Unselect All","tasks.filters.date":"Date","tasks.filters.endDate":"End Date","tasks.filters.startDate":"Start Date","tasks.filters.dateTitle":"Quick Date Filters","tasks.filters.endDateTitle":"End Date Filters","tasks.filters.noDate":"No End Date","tasks.filters.overdue":"Overdue","tasks.filters.endToday":"End Date Today","tasks.filters.endTomorrow":"End Date Tomorrow","tasks.filters.end7Days":"End Date in 7 Days","tasks.filters.endThisWeek":"End Date This Week","tasks.filters.endThisMonth":"End Date This Month","tasks.filters.startDateTitle":"Start Date Filters","tasks.filters.noStartDate":"No Start Date","tasks.filters.alreadyStarted":"Already Started","tasks.filters.startToday":"Start Date Today","tasks.filters.startTomorrow":"Start Date Tomorrow","tasks.filters.start7Days":"Start Date in 7 Days","tasks.filters.startThisWeek":"Start Date This Week","tasks.filters.startThisMonth":"Start Date This Month","tasks.filters.updated":"Updated","tasks.filters.updatedTitle":"Recently Updated","tasks.filters.dateFrom":"Start date","tasks.filters.dateTo":"End date","tasks.filters.clear":"Clear Filters","filters.noOtherProjects":"No other projects","filters.noTags":"No Tags","filters.noOtherTags":"No other tags","filters.sheet.title":"Options","filters.chip.search":"Search","filters.chip.project":"Project","filters.chip.tag":"Tag","filters.chip.date":"Date","filters.chip.updated":"Updated","filters.chip.removeAria":"Remove {label} filter","filters.dateRange.from":"From","filters.dateRange.until":"Until","filters.updated.week":"Week","filters.updated.month":"Month","tasks.kanban.tipLabel":"Tip:","tasks.kanban.tipTextBefore":"In the Kanban Board hold ","tasks.kanban.tipTextAfter":" (Cmd on Mac) and click to select multiple tasks. Shift-click selects a range, then drag to move them together","tasks.view.kanban":"Kanban","tasks.view.list":"List","tasks.view.calendar":"Calendar","tasks.sort.label":"Sort: Priority","tasks.sort.orderByPriority":"Order by Priority","tasks.kanban.showBacklog":"Show Backlog","tasks.kanban.showProjects":"Show Projects","tasks.kanban.showNoDate":'Show "No Date"',"tasks.addButton":"+ Add Task","tasks.noProject":"No Project","tasks.projectIndicatorNone":"No Project - ","tasks.project.selectPlaceholder":"Select a project","tasks.tags.none":"No tags","tasks.checklist.toggle":"Toggle checkbox","tasks.untitled":"Untitled task","tasks.startDatePrefix":"Start Date: ","tasks.endDatePrefix":"End Date: ","tasks.noDate":"No date","tasks.noDatesSet":"No dates set","tasks.noEndDate":"No End Date","tasks.due.yesterday":"Yesterday","tasks.due.daysOverdue":"{count} days overdue","tasks.due.tomorrow":"Tomorrow","tasks.openTaskDetails":"Open task details","tasks.noTasksInProject":"No tasks in this project","tasks.attachments.open":"Open","tasks.attachments.none":"No attachments","tasks.attachments.remove":"Remove attachment","tasks.attachments.removeTitle":"Remove","tasks.attachments.removeLink":"Remove link","tasks.attachments.googleDoc":"Google Doc","tasks.attachments.googleSheet":"Google Sheet","tasks.attachments.googleSlides":"Google Slides","tasks.attachments.googleDriveFile":"Google Drive File","tasks.attachments.pdf":"PDF Document","tasks.attachments.word":"Word Document","tasks.attachments.excel":"Excel File","tasks.attachments.powerpoint":"PowerPoint","tasks.empty.epic":"No tasks yet. Create your first task for this epic.","tasks.backlogQuickTitle":"Open Backlog tasks in List view","tasks.backlogQuickLabel":"Backlog","tasks.kanban.columnBacklog":"\u{1F9CA} Backlog","tasks.kanban.columnTodo":"\u{1F4CB} To Do","tasks.kanban.columnProgress":"\u{1F504} In Progress","tasks.kanban.columnReview":"\u2611\uFE0F In Review","tasks.kanban.columnDone":"\u2705 Done","tasks.table.task":"Task","tasks.table.priority":"Priority","tasks.table.status":"Status","tasks.table.tags":"Tags","tasks.table.project":"Project","tasks.table.startDate":"Start Date","tasks.table.endDate":"End Date","tasks.table.updated":"Updated","tasks.list.count":"{count} results","tasks.modal.editTitle":"Edit Task","tasks.modal.duplicate":"\u{1F4C4} Duplicate Task","tasks.modal.delete":"\u{1F5D1}\uFE0F Delete Task","tasks.modal.tab.general":"General","tasks.modal.tab.details":"Details","tasks.modal.tab.history":"History","tasks.modal.titleLabel":"Task Title","tasks.modal.attachmentsLabel":"Attachments","tasks.modal.attachmentsSupported":"Supported: Images (10MB), PDFs (20MB), Documents (10MB)","tasks.modal.attachmentsDropzoneDefault":"Drag & drop or click to attach file","tasks.modal.attachmentsDropzoneTap":"Click to attach file","tasks.modal.linksLabel":"Links","tasks.modal.attachmentNamePlaceholder":"Name (optional)","tasks.modal.attachmentUrlPlaceholder":"URL","tasks.modal.addLink":"Add Link","tasks.modal.statusLabel":"Status","tasks.modal.priorityLabel":"Priority","tasks.modal.tagsLabel":"Tags","tasks.modal.addTagPlaceholder":"Add tag","tasks.modal.projectLabel":"Project","tasks.modal.projectOpenTitle":"Open project details","tasks.modal.projectSelect":"Select a project","tasks.modal.submitCreate":"Create Task","tasks.modal.listBulleted":"\u2022 List","tasks.modal.listNumbered":"1. List","tasks.modal.insertDivider":"Insert horizontal divider","tasks.modal.insertCheckbox":"Insert checkbox","tasks.history.emptyTitle":"No Changes Yet","tasks.history.emptySubtitle":"Changes to this task will appear here","calendar.title":"Calendar","calendar.today":"Today","calendar.prevMonth":"Previous month","calendar.nextMonth":"Next month","calendar.dayItemsTitle":"Items for {date}","calendar.dayItemsProjects":"Projects","calendar.dayItemsTasks":"Tasks","calendar.dayItems.close":"Close day items","calendar.dayItems.addTask":"+ Add Task","feedback.title":"Feedback & Issues","feedback.subtitle":"Report bugs and suggest features","feedback.saveStatus.saved":"Saved","feedback.saveStatus.saving":"Saving...","feedback.saveStatus.error":"Save failed","feedback.saveStatus.offline":"Offline","feedback.type.bugLabel":"\u{1F41E} Bug","feedback.type.title":"Feedback Type","feedback.type.bugOption":"\u{1F41E} Bug","feedback.type.improvementOption":"\u{1F4A1} Improvement","feedback.descriptionPlaceholder":"Describe the issue or idea. You can paste an image directly into this field.","feedback.descriptionPlaceholderShort":"Describe the issue or idea.","feedback.screenshotAttachTitle":"Attach screenshot from device","feedback.screenshotDropzoneTap":"\u{1F4F7} Tap to attach screenshot","feedback.screenshotDropzoneDefault":"\u{1F4F7} Drag & drop or click to attach screenshot","feedback.screenshotPreviewTitle":"Screenshot attached","feedback.screenshotPreviewSubtitle":"Will be saved with this feedback","feedback.screenshotRemove":"Remove","feedback.screenshotPreviewAlt":"Feedback screenshot preview","feedback.viewScreenshotTitle":"View screenshot","feedback.pagination.first":"First page","feedback.pagination.prev":"Previous page","feedback.pagination.next":"Next page","feedback.pagination.last":"Last page","feedback.pagination.showing":"Showing {start}-{end} of {total}","feedback.pagination.pageOf":"Page {current} of {total}","feedback.addButton":"Add","feedback.pendingTitle":"? Pending","feedback.doneTitle":"? Done","feedback.delete.title":"Delete Feedback","feedback.delete.body":"Are you sure you want to delete this feedback?","feedback.empty.pending":"No pending feedback","feedback.empty.done":"No completed feedback","export.title":"Export Data","export.body":"This will download a complete backup of all your tasks, projects, and settings as a JSON file. Are you sure you want to export your data?","export.confirm":"Export","confirm.deleteTask.title":"Delete Task","confirm.deleteTask.body":"This action cannot be undone. To confirm deletion, type delete below:","confirm.deleteTask.inputPlaceholder":"Type delete here","confirm.deleteTask.error":'Type "delete" exactly to confirm',"confirm.unsaved.title":"Unsaved Changes","confirm.unsaved.body":"You have unsaved changes. Are you sure you want to close and lose them?","confirm.unsaved.discard":"Discard Changes","confirm.review.title":'Disable "In Review" Status',"error.saveDataFailed":"Failed to save data. Please try again.","error.saveProjectsFailed":"Failed to save projects. Please try again.","error.saveTasksFailed":"Failed to save tasks. Please try again.","error.saveFeedbackFailed":"Failed to save feedback. Please try again.","error.saveProjectColorsFailed":"Failed to save project colors.","error.saveTaskFailed":"Failed to save task. Please try again.","error.saveChangesFailed":"Failed to save changes. Please try again.","error.saveTaskPositionFailed":"Failed to save task position. Please try again.","error.saveProjectFailed":"Failed to save project. Please try again.","error.notLoggedInResetPin":"You must be logged in to reset your PIN","error.resetPinFailed":"Failed to reset PIN","success.resetPin":"PIN reset successfully! You will need to re-login with your new PIN.","error.resetPinError":"An error occurred while resetting your PIN","error.userNameEmpty":"User name cannot be empty.","error.saveDisplayNameFailed":"Could not save display name. Please try again.","error.invalidEmail":"Please enter a valid email address.","error.saveEmailFailed":"Could not save email. Please try again.","error.saveAvatarFailed":"Could not save avatar. Please try again.","success.settingsSaved":"Settings saved successfully!","error.logoSelectFile":"Please select an image file for the workspace logo.","error.logoTooLarge":"Please use an image smaller than 2MB for the workspace logo.","error.imageReadFailed":"Could not read the selected image.","error.imageLoadFailed":"Could not load the selected image.","error.logoUploadFailed":"Error uploading logo: {message}","error.cropInvalid":"Error: Crop state is invalid.","error.cropTooLarge":"Cropped image is too large. Please select a smaller area or use a smaller source image.","success.cropApplied":"Image cropped and applied successfully!","success.logoCroppedApplied":"Workspace logo cropped and applied successfully!","error.cropFailed":"Error cropping image: {message}","error.avatarSelectFile":"Please select an image file for your avatar.","error.avatarTooLarge":"Please use an image smaller than 2MB for your avatar.","error.avatarUploadFailed":"Failed to upload avatar. Please try again.","error.endDateBeforeStart":"End date cannot be before start date","error.startDateAfterEnd":"Start date cannot be after end date","error.feedbackAttachImage":"Please attach an image file.","error.feedbackReadImage":"Could not read the image file. Please try again.","error.feedbackStatusFailed":"Failed to update feedback status. Please try again.","error.attachmentSaveFailed":"Failed to save attachment. Please try again.","error.attachmentLoadFailed":"Failed to load image: {message}","success.fileDownloaded":"File downloaded!","error.fileDownloadFailed":"Failed to download file: {message}","success.attachmentDeletedFromStorage":"{name} deleted from storage","error.fileDeleteFailed":"Failed to delete file from storage","success.attachmentRemoved":"Attachment removed","error.fileSizeTooLarge":"File size must be less than {maxMB}MB. Please choose a smaller file.","success.fileUploaded":"File uploaded successfully!","error.fileUploadFailed":"Error uploading file: {message}","error.selectFile":"Please select a file","error.saveTagFailed":"Failed to save tag. Please try again.","error.removeTagFailed":"Failed to remove tag. Please try again.","error.openScreenshotFailed":"Could not open screenshot","history.sort.newest":"\u2191 Newest First","history.sort.oldest":"\u2193 Oldest First","history.field.title":"Title","history.field.name":"Name","history.field.description":"Description","history.field.status":"Status","history.field.priority":"Priority","history.field.category":"Category","history.field.startDate":"Start Date","history.field.endDate":"End Date","history.field.link":"Link","history.field.task":"Link","history.field.projectId":"Project","history.field.tags":"Tags","history.field.attachments":"Attachments","history.action.created":"Created","history.action.deleted":"Deleted","history.link.added":"Added","history.link.removed":"Removed","history.entity.task":"task","history.value.empty":"empty","history.value.none":"none","history.change.beforeLabel":"Before:","history.change.afterLabel":"After:","history.change.notSet":"Not set","history.change.removed":"Removed","history.tags.none":"No tags","history.attachments.none":"No attachments","history.attachments.countSingle":"{count} file","history.attachments.countPlural":"{count} files","history.project.fallback":"Project #{id}","history.change.arrow":"\u2192","menu.openMenu":"Open menu","menu.language":"Language","menu.darkMode":"Dark mode","menu.lightMode":"Light mode","menu.settings":"Settings","menu.help":"Help","menu.signOut":"Sign out","nav.overview":"Overview","nav.dashboard":"Dashboard","nav.updates":"Release notes","nav.calendar":"Calendar","nav.work":"Work","nav.projects":"Projects","nav.allTasks":"All Tasks","nav.feedback":"Feedback","updates.title":"Release notes","updates.subtitle":"Latest change log for Nautilus","updates.latestLabel":"Latest release","updates.historyLabel":"Release log","updates.sections.new":"New","updates.sections.improvements":"Improvements","updates.sections.fixes":"Fixes","updates.empty":"No release notes yet.","updates.sectionEmpty":"Nothing listed yet.","updates.historyEmpty":"No previous releases yet.","notifications.title":"Notifications","notifications.toggle":"Notifications","notifications.today":"Today","notifications.yesterday":"Yesterday","notifications.clearAll":"Clear all","notifications.releaseTitle":"New release","notifications.releaseCta":"View updates","notifications.releaseMeta":"Released {date}","notifications.dueTodayTitle":"Due today","notifications.dueTodayCta":"View tasks","notifications.dueTodayMetaOne":"{count} task due today","notifications.dueTodayMetaMany":"{count} tasks due today","notifications.dueTodayMore":"and {count} more tasks","notifications.empty":"You are all caught up.","settings.title":"Settings","settings.subtitle":"Manage your preferences and application settings","settings.section.profile":"Profile","settings.displayName":"Display Name","settings.displayNameHint":"This name is displayed throughout the application","settings.placeholder.displayName":"Enter your display name","settings.email":"Email","settings.emailHint":"Used for your account and deadline notifications","settings.placeholder.email":"Enter your email","settings.avatar":"Avatar","settings.avatarHint":"Upload an image for your avatar (max 2MB). It will be displayed as a circle.","settings.avatarRemoveTitle":"Remove avatar","settings.workspaceLogo":"Workspace Logo","settings.workspaceLogoHint":"Upload a square image to replace the Nautilus logo (max 2MB).","settings.workspaceLogoRemoveTitle":"Remove custom logo","settings.section.application":"Application","settings.enableReviewStatus":"Enable In Review status","settings.enableReviewStatusHint":"Show or hide the IN REVIEW status column and filter option","settings.enableReviewStatusHintPrefix":"Show or hide the","settings.enableReviewStatusHintSuffix":"status column and filter option","settings.calendarIncludeBacklog":"Show backlog in calendar","settings.calendarIncludeBacklogHint":"Display backlog tasks in all calendar views","settings.autoStartDate":"Auto-set start date","settings.autoStartDateHint":'Automatically set Start Date when task status changes to "In Progress" (if empty)',"settings.autoEndDate":"Auto-set end date","settings.autoEndDateHint":'Automatically set End Date when task status changes to "Done" (if empty)',"settings.debugLogs":"Enable debug logs","settings.debugLogsHint":"Capture diagnostic logs in the browser console when enabled","settings.historySortOrder":"History Sort Order","settings.historySortOrderHint":"Default sort order for task and project history timelines","settings.historySortNewest":"Newest First","settings.historySortOldest":"Oldest First","settings.language":"Language","settings.languageHint":"Choose the application language","settings.section.notifications":"Notifications","settings.emailNotifications":"Email notifications","settings.emailNotificationsHint":"Enable or disable deadline reminder emails","settings.weekdaysOnly":"Weekdays only","settings.weekdaysOnlyHint":"Skip emails on Saturday and Sunday","settings.includeStartDates":"Notify when tasks start","settings.includeStartDatesHint":"Send reminders when a task starts (e.g., today)","settings.includeBacklog":"Include backlog tasks","settings.includeBacklogHint":"Include backlog tasks in email and in-app notifications","settings.sendTime":"Send time","settings.sendTimeHint":"Daily time to send reminders (08:00-18:00, 30-minute increments)","settings.timeZone":"Time zone","settings.timeZoneHint":"Keeps the same local time year-round (DST-aware)","settings.timeZone.option.argentina":"Argentina (Buenos Aires)","settings.timeZone.option.canary":"Canary Islands (Atlantic/Canary)","settings.timeZone.option.spain":"Spain mainland (Europe/Madrid)","settings.timeZone.option.utc":"UTC","settings.section.security":"Security","settings.pinManagement":"PIN Management","settings.pinManagementHint":"Reset your PIN to a new 4-digit code","settings.resetPinButton":"Reset PIN","settings.section.dataManagement":"Data Management","settings.exportData":"Export Data","settings.exportDataHint":"Download a complete backup of all your tasks, projects, and settings as a JSON file","settings.exportButton":"Export","settings.cancelButton":"Cancel","settings.saveButton":"Save Settings","settings.avatarUploadDefault":"Drag & drop or click to upload avatar","settings.avatarUploadChange":"Change avatar","settings.avatarUploadAriaUpload":"Upload avatar","settings.avatarUploadAriaChange":"Change avatar","settings.logoUploadDefault":"Drag & drop or click to upload logo","settings.logoUploadChange":"Change logo","settings.logoUploadAriaUpload":"Upload logo","settings.logoUploadAriaChange":"Change logo","dashboard.title":"Dashboard","dashboard.hero.activeProjectsLabel":"Active Projects","dashboard.hero.completionRateLabel":"Completion Rate","dashboard.hero.projectsTrend":"\u{1F4C8} +2 this month","dashboard.hero.completionTrend":"\u{1F3AF} Target: 80%","dashboard.projectAnalytics":"\u{1F4CA} Project Analytics","dashboard.period.week":"Week","dashboard.period.month":"Month","dashboard.period.quarter":"Quarter","dashboard.stat.pendingTasks":"Pending Tasks","dashboard.stat.inProgress":"In Progress","dashboard.stat.highPriority":"High Priority","dashboard.stat.overdue":"Overdue","dashboard.stat.completed":"Completed","dashboard.stat.projects":"Projects","dashboard.highPriorityHint":"High priority tasks due within 7 days (or overdue)","dashboard.projectProgress":"\u{1F30A} Project Progress","dashboard.legend.todo":"To Do","dashboard.legend.progress":"In Progress","dashboard.legend.review":"In Review","dashboard.legend.complete":"Complete","dashboard.viewAll":"View All","dashboard.quickActions":"\u26A1 Quick Actions","dashboard.action.generateReport":"Generate Report","dashboard.action.addTask":"Add Task","dashboard.action.viewCalendar":"View Calendar","dashboard.action.newProject":"New Project","dashboard.recentActivity":"\u{1F504} Recent Activity","dashboard.researchInsights":"\u{1F9E0} Insights","dashboard.activity.emptyTitle":"Welcome to your Dashboard!","dashboard.activity.emptySubtitle":"Start creating projects and tasks to see activity","dashboard.activity.completed":'Completed "{title}" {projectPart}',"dashboard.activity.createdProject":'Created new project "{project}"',"dashboard.activity.addedTask":'Added new task "{title}" {projectPart}',"dashboard.activity.inProject":"in {project}","dashboard.activity.toProject":"to {project}","dashboard.activity.recently":"Recently","dashboard.activity.justNow":"Just now","dashboard.activity.today":"Today","dashboard.activity.yesterday":"Yesterday","dashboard.activity.daysAgoShort":"{count}d ago","dashboard.activity.minuteAgo":"{count} minute ago","dashboard.activity.minutesAgo":"{count} minutes ago","dashboard.activity.hourAgo":"{count} hour ago","dashboard.activity.hoursAgo":"{count} hours ago","dashboard.activity.dayAgo":"{count} day ago","dashboard.activity.daysAgo":"{count} days ago","dashboard.trend.thisWeek":"this week","dashboard.trend.thisMonth":"this month","dashboard.trend.thisQuarter":"this quarter","dashboard.trend.dueTodayOne":"{count} due today","dashboard.trend.dueTodayMany":"{count} due today","dashboard.trend.onTrack":"On track","dashboard.trend.needsAttention":"Needs attention","dashboard.trend.allOnTrack":"All on track","dashboard.trend.criticalOne":"{count} critical","dashboard.trend.criticalMany":"{count} critical","dashboard.trend.completedOne":"{count} completed","dashboard.trend.completedMany":"{count} completed","dashboard.trend.inProgress":"In progress","dashboard.emptyProjects.title":"No projects yet","dashboard.emptyProjects.subtitle":"Create your first project to see progress visualization","dashboard.tasks":"tasks","dashboard.activity.allTitle":"All Recent Activity","dashboard.activity.allSubtitle":"Full history of your recent work","dashboard.activity.backToDashboard":"\u2190 Back to Dashboard","dashboard.insights.excellentTitle":"Excellent Progress","dashboard.insights.excellentDesc":"{percent}% completion rate exceeds target. Great momentum!","dashboard.insights.goodTitle":"Good Progress","dashboard.insights.goodDesc":"{percent}% completion rate is solid. Consider pushing to reach 80% target.","dashboard.insights.opportunityTitle":"Progress Opportunity","dashboard.insights.opportunityDesc":"{percent}% completion rate. Focus on completing current tasks to build momentum.","dashboard.insights.actionTitle":"Action Needed","dashboard.insights.actionDesc":"{percent}% completion rate is low. Break down large tasks and tackle smaller ones first.","dashboard.insights.todayTitle":"Today's Focus","dashboard.insights.todayDescOne":"{count} task is due today. Prioritize it for maximum impact.","dashboard.insights.todayDescMany":"{count} tasks are due today. Prioritize them for maximum impact.","dashboard.insights.overdueTitle":"Overdue Items","dashboard.insights.overdueDescOne":"{count} overdue task needs attention. Address it to prevent delays.","dashboard.insights.overdueDescMany":"{count} overdue tasks need attention. Address these to prevent delays.","dashboard.insights.highPriorityTitle":"High Priority Focus","dashboard.insights.highPriorityDescOne":"{count} high-priority task needs immediate attention.","dashboard.insights.highPriorityDescMany":"{count} high-priority tasks need immediate attention.","dashboard.insights.emptyProjectsTitle":"Empty Projects","dashboard.insights.emptyProjectsDescOne":"{count} project has no tasks yet. Add tasks to track progress.","dashboard.insights.emptyProjectsDescMany":"{count} projects have no tasks yet. Add tasks to track progress.","dashboard.insights.momentumTitle":"Strong Momentum","dashboard.insights.momentumDescOne":"{count} task completed this week. You're in a productive flow!","dashboard.insights.momentumDescMany":"{count} tasks completed this week. You're in a productive flow!","dashboard.insights.readyTitle":"Ready to Start","dashboard.insights.readyDesc":"Create your first project and add some tasks to begin tracking your progress.","dashboard.insights.caughtUpTitle":"All Caught Up","dashboard.insights.caughtUpDesc":"Great work! No urgent items detected. Consider planning your next milestones."},es:{"boot.loading":"Cargando Nautilus","lock.welcome":"Bienvenido de nuevo","lock.subtitle":"Ingresa la contrase\xF1a de acceso para continuar.","lock.sessionHint":"? La sesi\xF3n permanece iniciada por 24 horas.","lock.passwordLabel":"Contrase\xF1a","lock.passwordPlaceholder":"Ingresa la contrase\xF1a","lock.unlock":"Desbloquear","auth.backToUserLogin":"Volver al inicio de sesi\xF3n","auth.login.title":"Bienvenido a Nautilus","auth.login.subtitle":"Inicia sesi\xF3n para acceder a tu espacio","auth.login.identifierLabel":"Usuario o correo","auth.login.identifierPlaceholder":"Ingresa usuario o correo","auth.login.pinLabel":"PIN (4 d\xEDgitos)","auth.admin.title":"Acceso de administraci\xF3n","auth.admin.subtitle":"Ingresa el PIN maestro para acceder al panel de administraci\xF3n","auth.admin.pinLabel":"PIN maestro (4 d\xEDgitos)","auth.setup.title":"Completa tu configuraci\xF3n","auth.setup.subtitle":"Personaliza tu cuenta","auth.setup.usernameLabel":"Usuario","auth.setup.usernamePlaceholder":"p. ej., alex","auth.setup.usernameHint":"3-20 caracteres, solo letras min\xFAsculas y n\xFAmeros","auth.setup.displayNameLabel":"Nombre visible","auth.setup.displayNamePlaceholder":"p. ej., Alex Morgan","auth.setup.emailLabel":"Correo electr\xF3nico","auth.setup.emailPlaceholder":"tu.correo@ejemplo.com","auth.setup.emailHint":"Necesario para notificaciones","auth.setup.newPinLabel":"Nuevo PIN (4 d\xEDgitos)","auth.setup.confirmPinLabel":"Confirmar PIN","auth.setup.next":"Siguiente","auth.setup.submit":"Completar configuraci\xF3n","admin.title":"Gesti\xF3n de usuarios","admin.signOut":"Cerrar sesi\xF3n","admin.usersTitle":"Usuarios","admin.createUserTitle":"Crear nuevo usuario","admin.usernameLabel":"Usuario","admin.usernamePlaceholder":"p. ej., jdoe","admin.usernameHint":"3-20 caracteres, solo letras min\xFAsculas y n\xFAmeros","admin.displayNameLabel":"Nombre visible","admin.displayNamePlaceholder":"p. ej., John Doe","admin.tempPinLabel":"PIN temporal (4 d\xEDgitos)","admin.createUserButton":"Crear usuario","auth.admin.resetPinPrompt":"Ingresa un nuevo PIN temporal para {userName}:","auth.admin.pinMustBe4Digits":"El PIN debe tener exactamente 4 d\xEDgitos","auth.admin.resetPinFailed":"No se pudo restablecer el PIN","auth.admin.resetPinSuccess":"PIN restablecido para {userName}. Nuevo PIN temporal: {pin}","auth.admin.deleteUserConfirm":'\xBFSeguro que deseas eliminar al usuario "{userName}"? Esto tambi\xE9n eliminar\xE1 todas sus tareas y proyectos.',"auth.admin.deleteUserFailed":"No se pudo eliminar el usuario","auth.admin.deleteUserSuccess":'Usuario "{userName}" eliminado correctamente',"common.cancel":"Cancelar","common.delete":"Eliminar","common.continue":"Continuar","common.gotIt":"Entendido","common.close":"Cerrar modal","common.done":"Listo","common.nautilusLogoAlt":"Logo de Nautilus","common.devBanner":"\u26A0\uFE0F DESARROLLO LOCAL - NO PRODUCCI\xD3N \u26A0\uFE0F","common.datePlaceholder":"dd/mm/yyyy","crop.title":"Recortar imagen a cuadrado","crop.instructions":"Arrastra para ajustar el \xE1rea de recorte. La imagen se recortar\xE1 a un cuadrado.","crop.apply":"Recortar y aplicar","crop.close":"Cerrar recorte","dashboard.insights.productivityTitle":"Tendencia de productividad","dashboard.insights.productivityDesc":"La tasa de finalizaci\xF3n de tareas aument\xF3 un 23% respecto al mes pasado","dashboard.insights.deadlineTitle":"Alerta de plazos","dashboard.insights.deadlineDesc":"3 hitos vencen en los pr\xF3ximos 7 d\xEDas","projects.title":"Proyectos","projects.subtitle":"Gestiona tus proyectos","projects.searchPlaceholder":"\u{1F50D} Buscar proyectos (t\xEDtulo o descripci\xF3n)","projects.filters.status":"Estado","projects.filters.statusTitle":"Estado del proyecto","projects.status.backlog":"BACKLOG","projects.status.planning":"PLANIFICACI\xD3N","projects.status.active":"ACTIVO","projects.status.completed":"COMPLETADO","projects.filters.updated":"Actualizado","projects.filters.updatedTitle":"Actualizados recientemente","projects.filters.all":"Todos","projects.filters.last5m":"\xDAltimos 5 minutos","projects.filters.last30m":"\xDAltimos 30 minutos","projects.filters.last24h":"\xDAltimas 24 horas","projects.filters.lastWeek":"\xDAltima semana","projects.filters.lastMonth":"\xDAltimo mes","projects.filters.hasTasks":"Con tareas","projects.filters.noTasks":"Sin tareas","projects.filters.tags":"Etiquetas","projects.filters.tagsTitle":"Etiquetas de proyectos","projects.filters.clear":"Limpiar filtros","projects.noDescription":"Sin descripcion","projects.tasksBreakdown":"{total} tareas \xB7 {done} hechas","tasks.card.description":"Descripcion","projects.card.tasksCount":"{count} tareas","projects.card.percentDone":"{count}% hecho","projects.sort.label":"Ordenar: Estado","projects.sort.status":"Estado","projects.sort.name":"Nombre","projects.sort.newest":"M\xE1s reciente","projects.sort.lastUpdated":"\xDAltima actualizaci\xF3n","projects.sort.mostTasks":"M\xE1s tareas","projects.sort.percentCompleted":"% completado","projects.sort.prefix":"Ordenar: {label}","projects.sort.help":"Repite la misma opci\xF3n para alternar Asc/Desc.","projects.sort.statusLabel":"Estado","projects.sort.nameLabel":"Nombre","projects.sort.newestLabel":"M\xE1s reciente","projects.sort.lastUpdatedLabel":"\xDAltima actualizaci\xF3n","projects.sort.mostTasksLabel":"M\xE1s tareas","projects.sort.percentCompletedLabel":"% completado","projects.newProjectButton":"+ Nuevo proyecto","projects.openDetailsTitle":"Ver detalles del proyecto","projects.empty.title":"A\xFAn no hay proyectos","projects.empty.subtitle":"Crea tu primer proyecto","projects.empty.searchTitle":"No se encontraron proyectos","projects.empty.searchSubtitle":"Crea un nuevo proyecto para empezar","projects.empty.filteredTitle":"No hubo coincidencias de proyectos","projects.modal.createTitle":"Crear nuevo proyecto","projects.modal.nameLabel":"Nombre del proyecto","projects.modal.descriptionLabel":"Descripci\xF3n","projects.modal.startDateLabel":"Fecha de inicio","projects.modal.endDateLabel":"Fecha de fin","projects.modal.tagsLabel":"Etiquetas","projects.modal.addTagPlaceholder":"A\xF1adir etiqueta","projects.modal.createButton":"Crear proyecto","projects.delete.title":"Eliminar proyecto","projects.delete.body":"Esta acci\xF3n no se puede deshacer. Para confirmar, escribe delete abajo:","projects.delete.deleteTasksLabel":"Eliminar todas las tareas de este proyecto","projects.delete.deleteTasksHint":"Si no se marca, las tareas se desasignar\xE1n del proyecto","projects.delete.inputPlaceholder":"Escribe delete aqu\xED","projects.delete.error":'Escribe "delete" exactamente para confirmar',"projects.duplicate.title":"Duplicar proyecto","projects.duplicate.description":"Crear una copia de este proyecto con toda su configuraci\xF3n.","projects.duplicate.includeTasksLabel":"Incluir todas las tareas de este proyecto","projects.duplicate.taskNamingTitle":"Nomenclatura de tareas:","projects.duplicate.namingNone":"Mantener nombres originales","projects.duplicate.namingPrefix":"Agregar prefijo:","projects.duplicate.namingSuffix":"Agregar sufijo:","projects.duplicate.prefixPlaceholder":"ej., Copia - ","projects.duplicate.suffixPlaceholder":"ej., (Copia)","projects.duplicate.confirm":"Duplicar proyecto","projects.duplicate.success":'Proyecto "{name}" duplicado exitosamente',"projects.duplicate.successWithTasks":'Proyecto "{name}" y sus tareas duplicados exitosamente',"projects.statusInfo.title":"L\xF3gica del estado del proyecto","projects.statusInfo.subtitle":"El estado del proyecto se actualiza autom\xE1ticamente seg\xFAn el progreso de las tareas","projects.statusInfo.backlogTitle":"\u2B1B Backlog","projects.statusInfo.backlogDesc":'Todas las tareas est\xE1n en "Backlog"',"projects.statusInfo.planningTitle":"\u2B1C Planificaci\xF3n","projects.statusInfo.planningDesc":'Todas las tareas est\xE1n en "Por hacer"',"projects.statusInfo.activeTitle":"\u2705 Activo","projects.statusInfo.activeDesc":'Al menos una tarea est\xE1 en "En progreso" o "En revisi\xF3n"',"projects.statusInfo.completedTitle":"? Completado","projects.statusInfo.completedDesc":'Todas las tareas est\xE1n marcadas como "Hecho"',"projects.backTo.dashboard":"\u2190 Volver al panel","projects.backTo.calendar":"\u2190 Volver al calendario","projects.backTo.projects":"\u2190 Volver a proyectos","projects.details.tab.details":"Detalles","projects.details.tab.history":"Historial","projects.details.startDate":"Fecha de inicio","projects.details.endDate":"Fecha de fin","projects.details.duration":"Duraci\xF3n","projects.details.durationDays":"{count} d\xEDas","projects.details.created":"Creado","projects.details.calendarColor":"Color del calendario","projects.details.customColor":"Color personalizado","projects.details.progressOverview":"Resumen de progreso","projects.details.taskProgress":"Progreso de tareas","projects.details.tasksTitle":"Tareas ({count})","projects.details.changeHistory":"Historial de cambios","projects.details.noChanges":"A\xFAn no hay cambios para este proyecto","projects.details.noTasksFound":"No se encontraron tareas","projects.details.viewTodo":"Ver tareas Por hacer de este proyecto","projects.details.viewProgress":"Ver tareas En progreso de este proyecto","projects.details.viewReview":"Ver tareas En revisi\xF3n de este proyecto","projects.details.viewCompleted":"Ver tareas Completadas de este proyecto","projects.details.viewBacklog":"Ver tareas de backlog en vista de lista","projects.untitled":"Proyecto sin t\xEDtulo","tasks.title":"Todas las tareas","tasks.subtitle":"Gestiona tareas de todos los proyectos","tasks.searchPlaceholder":"\u{1F50D} Buscar tareas (t\xEDtulo o descripci\xF3n)","tasks.filters.status":"Estado","tasks.filters.statusTitle":"Estado","tasks.status.backlog":"Backlog","tasks.status.todo":"Por hacer","tasks.status.progress":"En progreso","tasks.status.review":"En revisi\xF3n","tasks.status.done":"Hecho","tasks.filters.tags":"Etiquetas","tasks.filters.tagsTitle":"Etiquetas","tasks.filters.priority":"Prioridad","tasks.filters.priorityTitle":"Prioridad","tasks.priority.high":"Alta","tasks.priority.medium":"Media","tasks.priority.low":"Baja","tasks.filters.project":"Proyecto","tasks.filters.projectTitle":"Proyecto","tasks.filters.selectAll":"Seleccionar / deseleccionar todo","tasks.filters.date":"Fecha","tasks.filters.endDate":"Fecha de Fin","tasks.filters.startDate":"Fecha de Inicio","tasks.filters.dateTitle":"Filtros r\xE1pidos por fecha","tasks.filters.endDateTitle":"Filtros de Fecha de Fin","tasks.filters.noDate":"Sin fecha de fin","tasks.filters.overdue":"Vencidas","tasks.filters.endToday":"Fecha de fin hoy","tasks.filters.endTomorrow":"Fecha de fin ma\xF1ana","tasks.filters.end7Days":"Fecha de fin en 7 d\xEDas","tasks.filters.endThisWeek":"Fecha de fin esta semana","tasks.filters.endThisMonth":"Fecha de fin este mes","tasks.filters.startDateTitle":"Filtros de Fecha de Inicio","tasks.filters.noStartDate":"Sin fecha de inicio","tasks.filters.alreadyStarted":"Ya comenz\xF3","tasks.filters.startToday":"Fecha de inicio hoy","tasks.filters.startTomorrow":"Fecha de inicio ma\xF1ana","tasks.filters.start7Days":"Fecha de inicio en 7 d\xEDas","tasks.filters.startThisWeek":"Fecha de inicio esta semana","tasks.filters.startThisMonth":"Fecha de inicio este mes","tasks.filters.updated":"Actualizado","tasks.filters.updatedTitle":"Actualizados recientemente","tasks.filters.dateFrom":"Fecha de inicio","tasks.filters.dateTo":"Fecha de fin","tasks.filters.clear":"Limpiar filtros","filters.noOtherProjects":"No hay otros proyectos","filters.noTags":"Sin etiquetas","filters.noOtherTags":"No hay otras etiquetas","filters.sheet.title":"Opciones","filters.chip.search":"B\xFAsqueda","filters.chip.project":"Proyecto","filters.chip.tag":"Etiqueta","filters.chip.date":"Fecha","filters.chip.updated":"Actualizado","filters.chip.removeAria":"Quitar filtro {label}","filters.dateRange.from":"Desde","filters.dateRange.until":"Hasta","filters.updated.week":"Semana","filters.updated.month":"Mes","tasks.kanban.tipLabel":"Consejo:","tasks.kanban.tipTextBefore":"En el tablero Kanban manten ","tasks.kanban.tipTextAfter":" (Cmd en Mac) y haz clic para seleccionar varias tareas. Shift + clic selecciona un rango, luego arrastra para moverlas juntas","tasks.view.kanban":"Kanban","tasks.view.list":"Lista","tasks.view.calendar":"Calendario","tasks.sort.label":"Ordenar: Prioridad","tasks.sort.orderByPriority":"Ordenar por prioridad","tasks.kanban.showBacklog":"Mostrar backlog","tasks.kanban.showProjects":"Mostrar proyectos","tasks.kanban.showNoDate":'Mostrar "Sin fecha"',"tasks.addButton":"+ A\xF1adir tarea","tasks.noProject":"Sin proyecto","tasks.projectIndicatorNone":"Sin proyecto - ","tasks.project.selectPlaceholder":"Selecciona un proyecto","tasks.tags.none":"Sin etiquetas","tasks.checklist.toggle":"Alternar casilla","tasks.untitled":"Tarea sin t\xEDtulo","tasks.startDatePrefix":"Fecha de inicio: ","tasks.endDatePrefix":"Fecha de fin: ","tasks.noDate":"Sin fecha","tasks.noDatesSet":"Sin fechas","tasks.noEndDate":"Sin fecha de fin","tasks.due.yesterday":"Ayer","tasks.due.daysOverdue":"{count} d\xEDas de atraso","tasks.due.tomorrow":"Ma\xF1ana","tasks.openTaskDetails":"Abrir detalles de la tarea","tasks.noTasksInProject":"No hay tareas en este proyecto","tasks.attachments.open":"Abrir","tasks.attachments.none":"Sin archivos adjuntos","tasks.attachments.remove":"Quitar archivo adjunto","tasks.attachments.removeTitle":"Quitar","tasks.attachments.removeLink":"Quitar enlace","tasks.attachments.googleDoc":"Documento de Google","tasks.attachments.googleSheet":"Hoja de c\xE1lculo de Google","tasks.attachments.googleSlides":"Presentaci\xF3n de Google","tasks.attachments.googleDriveFile":"Archivo de Google Drive","tasks.attachments.pdf":"Documento PDF","tasks.attachments.word":"Documento de Word","tasks.attachments.excel":"Archivo de Excel","tasks.attachments.powerpoint":"PowerPoint","tasks.empty.epic":"A\xFAn no hay tareas. Crea tu primera tarea para este \xE9pico.","tasks.backlogQuickTitle":"Abrir tareas de backlog en vista de lista","tasks.backlogQuickLabel":"Backlog","tasks.kanban.columnBacklog":"\u{1F9CA} Backlog","tasks.kanban.columnTodo":"\u{1F4CB} Por hacer","tasks.kanban.columnProgress":"\u{1F504} En progreso","tasks.kanban.columnReview":"\u2611\uFE0F En revisi\xF3n","tasks.kanban.columnDone":"\u2705 Hecho","tasks.table.task":"Tarea","tasks.table.priority":"Prioridad","tasks.table.status":"Estado","tasks.table.tags":"Etiquetas","tasks.table.project":"Proyecto","tasks.table.startDate":"Fecha de inicio","tasks.table.endDate":"Fecha de fin","tasks.table.updated":"Actualizado","tasks.list.count":"{count} resultados","tasks.modal.editTitle":"Editar tarea","tasks.modal.duplicate":"\u{1F4C4} Duplicar tarea","tasks.modal.delete":"\u{1F5D1}\uFE0F Eliminar tarea","tasks.modal.tab.general":"General","tasks.modal.tab.details":"Detalles","tasks.modal.tab.history":"Historial","tasks.modal.titleLabel":"T\xEDtulo de la tarea","tasks.modal.attachmentsLabel":"Adjuntos","tasks.modal.attachmentsSupported":"Compatible: Im\xE1genes (10MB), PDF (20MB), Documentos (10MB)","tasks.modal.attachmentsDropzoneDefault":"Arrastra y suelta o haz clic para adjuntar","tasks.modal.attachmentsDropzoneTap":"Haz clic para adjuntar","tasks.modal.linksLabel":"Enlaces","tasks.modal.attachmentNamePlaceholder":"Nombre (opcional)","tasks.modal.attachmentUrlPlaceholder":"URL","tasks.modal.addLink":"Agregar enlace","tasks.modal.statusLabel":"Estado","tasks.modal.priorityLabel":"Prioridad","tasks.modal.tagsLabel":"Etiquetas","tasks.modal.addTagPlaceholder":"A\xF1adir etiqueta","tasks.modal.projectLabel":"Proyecto","tasks.modal.projectOpenTitle":"Abrir detalles del proyecto","tasks.modal.projectSelect":"Selecciona un proyecto","tasks.modal.submitCreate":"Crear tarea","tasks.modal.listBulleted":"\u2022 Lista","tasks.modal.listNumbered":"1. Lista","tasks.modal.insertDivider":"Insertar separador horizontal","tasks.modal.insertCheckbox":"Insertar casilla","tasks.history.emptyTitle":"A\xFAn no hay cambios","tasks.history.emptySubtitle":"Los cambios en esta tarea aparecer\xE1n aqu\xED","calendar.title":"Calendario","calendar.today":"Hoy","calendar.prevMonth":"Mes anterior","calendar.nextMonth":"Mes siguiente","calendar.dayItemsTitle":"Elementos para {date}","calendar.dayItemsProjects":"Proyectos","calendar.dayItemsTasks":"Tareas","calendar.dayItems.close":"Cerrar tareas del d\xEDa","calendar.dayItems.addTask":"+ Agregar Tarea","feedback.title":"Comentarios e incidencias","feedback.subtitle":"Reporta errores y sugiere funciones","feedback.saveStatus.saved":"Guardado","feedback.saveStatus.saving":"Guardando...","feedback.saveStatus.error":"No se pudo guardar","feedback.saveStatus.offline":"Sin conexion","feedback.type.bugLabel":"\u{1F41E} Error","feedback.type.title":"Tipo de comentario","feedback.type.bugOption":"\u{1F41E} Error","feedback.type.improvementOption":"\u{1F4A1} Mejora","feedback.descriptionPlaceholder":"Describe el problema o la idea. Puedes pegar una imagen directamente en este campo.","feedback.descriptionPlaceholderShort":"Describe el problema o la idea.","feedback.screenshotAttachTitle":"Adjuntar captura desde el dispositivo","feedback.screenshotDropzoneTap":"\u{1F4F7} Adjuntar captura","feedback.screenshotDropzoneDefault":"\u{1F4F7} Arrastra o haz clic para adjuntar","feedback.screenshotPreviewTitle":"Captura adjunta","feedback.screenshotPreviewSubtitle":"Se guardar\xE1 con este comentario","feedback.screenshotRemove":"Eliminar","feedback.screenshotPreviewAlt":"Vista previa de la captura","feedback.viewScreenshotTitle":"Ver captura","feedback.pagination.first":"Primera p\xE1gina","feedback.pagination.prev":"P\xE1gina anterior","feedback.pagination.next":"P\xE1gina siguiente","feedback.pagination.last":"\xDAltima p\xE1gina","feedback.pagination.showing":"Mostrando {start}-{end} de {total}","feedback.pagination.pageOf":"P\xE1gina {current} de {total}","feedback.addButton":"Agregar","feedback.pendingTitle":"? Pendiente","feedback.doneTitle":"? Hecho","feedback.delete.title":"Eliminar comentario","feedback.delete.body":"\xBFSeguro que deseas eliminar este comentario?","feedback.empty.pending":"No hay feedback pendiente","feedback.empty.done":"No hay feedback completado","export.title":"Exportar datos","export.body":"Esto descargar\xE1 una copia completa de todas tus tareas, proyectos y ajustes como un archivo JSON. \xBFSeguro que deseas exportar tus datos?","export.confirm":"Exportar","confirm.deleteTask.title":"Eliminar tarea","confirm.deleteTask.body":"Esta acci\xF3n no se puede deshacer. Para confirmar, escribe delete abajo:","confirm.deleteTask.inputPlaceholder":"Escribe delete aqu\xED","confirm.deleteTask.error":'Escribe "delete" exactamente para confirmar',"confirm.unsaved.title":"Cambios sin guardar","confirm.unsaved.body":"Tienes cambios sin guardar. \xBFSeguro que quieres cerrar y perderlos?","confirm.unsaved.discard":"Descartar cambios","confirm.review.title":'Desactivar estado "En revisi\xF3n"',"error.saveDataFailed":"No se pudieron guardar los datos. Int\xE9ntalo de nuevo.","error.saveProjectsFailed":"No se pudieron guardar los proyectos. Int\xE9ntalo de nuevo.","error.saveTasksFailed":"No se pudieron guardar las tareas. Int\xE9ntalo de nuevo.","error.saveFeedbackFailed":"No se pudo guardar el feedback. Int\xE9ntalo de nuevo.","error.saveProjectColorsFailed":"No se pudieron guardar los colores del proyecto.","error.saveTaskFailed":"No se pudo guardar la tarea. Int\xE9ntalo de nuevo.","error.saveChangesFailed":"No se pudieron guardar los cambios. Int\xE9ntalo de nuevo.","error.saveTaskPositionFailed":"No se pudo guardar la posici\xF3n de la tarea. Int\xE9ntalo de nuevo.","error.saveProjectFailed":"No se pudo guardar el proyecto. Int\xE9ntalo de nuevo.","error.notLoggedInResetPin":"Debes iniciar sesi\xF3n para restablecer tu PIN","error.resetPinFailed":"No se pudo restablecer el PIN","success.resetPin":"\xA1PIN restablecido con \xE9xito! Tendr\xE1s que iniciar sesi\xF3n de nuevo con tu nuevo PIN.","error.resetPinError":"Ocurri\xF3 un error al restablecer el PIN","error.userNameEmpty":"El nombre de usuario no puede estar vac\xEDo.","error.saveDisplayNameFailed":"No se pudo guardar el nombre visible. Int\xE9ntalo de nuevo.","error.invalidEmail":"Por favor, introduce un correo v\xE1lido.","error.saveEmailFailed":"No se pudo guardar el correo. Int\xE9ntalo de nuevo.","error.saveAvatarFailed":"No se pudo guardar el avatar. Int\xE9ntalo de nuevo.","success.settingsSaved":"\xA1Ajustes guardados correctamente!","error.logoSelectFile":"Selecciona un archivo de imagen para el logo del espacio de trabajo.","error.logoTooLarge":"Usa una imagen menor de 2 MB para el logo del espacio de trabajo.","error.imageReadFailed":"No se pudo leer la imagen seleccionada.","error.imageLoadFailed":"No se pudo cargar la imagen seleccionada.","error.logoUploadFailed":"Error al subir el logo: {message}","error.cropInvalid":"Error: el estado del recorte no es v\xE1lido.","error.cropTooLarge":"La imagen recortada es demasiado grande. Selecciona un \xE1rea m\xE1s peque\xF1a o usa una imagen m\xE1s peque\xF1a.","success.cropApplied":"\xA1Imagen recortada y aplicada correctamente!","success.logoCroppedApplied":"\xA1Logo del espacio de trabajo recortado y aplicado correctamente!","error.cropFailed":"Error al recortar la imagen: {message}","error.avatarSelectFile":"Selecciona un archivo de imagen para tu avatar.","error.avatarTooLarge":"Usa una imagen menor de 2 MB para tu avatar.","error.avatarUploadFailed":"No se pudo subir el avatar. Int\xE9ntalo de nuevo.","error.endDateBeforeStart":"La fecha de fin no puede ser anterior a la fecha de inicio","error.startDateAfterEnd":"La fecha de inicio no puede ser posterior a la fecha de fin","error.feedbackAttachImage":"Adjunta un archivo de imagen.","error.feedbackReadImage":"No se pudo leer la imagen. Int\xE9ntalo de nuevo.","error.feedbackStatusFailed":"No se pudo actualizar el estado del feedback. Int\xE9ntalo de nuevo.","error.attachmentSaveFailed":"No se pudo guardar el adjunto. Int\xE9ntalo de nuevo.","error.attachmentLoadFailed":"No se pudo cargar la imagen: {message}","success.fileDownloaded":"\xA1Archivo descargado!","error.fileDownloadFailed":"No se pudo descargar el archivo: {message}","success.attachmentDeletedFromStorage":"{name} eliminado del almacenamiento","error.fileDeleteFailed":"No se pudo eliminar el archivo del almacenamiento","success.attachmentRemoved":"Adjunto eliminado","error.fileSizeTooLarge":"El tama\xF1o del archivo debe ser menor de {maxMB} MB. Elige uno m\xE1s peque\xF1o.","success.fileUploaded":"\xA1Archivo subido correctamente!","error.fileUploadFailed":"Error al subir el archivo: {message}","error.selectFile":"Selecciona un archivo","error.saveTagFailed":"No se pudo guardar la etiqueta. Int\xE9ntalo de nuevo.","error.removeTagFailed":"No se pudo eliminar la etiqueta. Int\xE9ntalo de nuevo.","error.openScreenshotFailed":"No se pudo abrir la captura","history.sort.newest":"\u2191 M\xE1s recientes primero","history.sort.oldest":"\u2193 M\xE1s antiguos primero","history.field.title":"T\xEDtulo","history.field.name":"Nombre","history.field.description":"Descripci\xF3n","history.field.status":"Estado","history.field.priority":"Prioridad","history.field.category":"Categor\xEDa","history.field.startDate":"Fecha de inicio","history.field.endDate":"Fecha de fin","history.field.link":"Enlace","history.field.task":"Enlace","history.field.projectId":"Proyecto","history.field.tags":"Etiquetas","history.field.attachments":"Adjuntos","history.action.created":"Creado","history.action.deleted":"Eliminado","history.link.added":"Agregado","history.link.removed":"Eliminado","history.entity.task":"tarea","history.value.empty":"vac\xEDo","history.value.none":"ninguno","history.change.beforeLabel":"Antes:","history.change.afterLabel":"Despu\xE9s:","history.change.notSet":"Sin establecer","history.change.removed":"Eliminado","history.tags.none":"Sin etiquetas","history.attachments.none":"Sin archivos adjuntos","history.attachments.countSingle":"{count} archivo","history.attachments.countPlural":"{count} archivos","history.project.fallback":"Proyecto #{id}","history.change.arrow":"\u2192","menu.openMenu":"Abrir men\xFA","menu.language":"Idioma","menu.darkMode":"Modo oscuro","menu.lightMode":"Modo claro","menu.settings":"Configuraci\xF3n","menu.help":"Ayuda","menu.signOut":"Cerrar sesi\xF3n","nav.overview":"Resumen","nav.dashboard":"Panel","nav.updates":"Notas de versi\xF3n","nav.calendar":"Calendario","nav.work":"Trabajo","nav.projects":"Proyectos","nav.allTasks":"Todas las tareas","nav.feedback":"Comentarios","updates.title":"Notas de versi\xF3n","updates.subtitle":"\xDAltimo registro de cambios en Nautilus","updates.latestLabel":"Ultima version","updates.historyLabel":"Registro de versiones","updates.sections.new":"Novedades","updates.sections.improvements":"Mejoras","updates.sections.fixes":"Correcciones","updates.empty":"Todavia no hay notas de version.","updates.sectionEmpty":"Todav\xEDa no hay entradas.","updates.historyEmpty":"Sin versiones anteriores.","notifications.title":"Notificaciones","notifications.toggle":"Notificaciones","notifications.today":"Hoy","notifications.yesterday":"Ayer","notifications.clearAll":"Limpiar todo","notifications.releaseTitle":"Nueva versi\xF3n","notifications.releaseCta":"Ver actualizaciones","notifications.releaseMeta":"Publicado {date}","notifications.dueTodayTitle":"Vence hoy","notifications.dueTodayCta":"Ver tareas","notifications.dueTodayMetaOne":"{count} tarea vence hoy","notifications.dueTodayMetaMany":"{count} tareas vencen hoy","notifications.dueTodayMore":"y {count} tareas m\xE1s","notifications.empty":"Todo al d\xEDa.","settings.title":"Configuraci\xF3n","settings.subtitle":"Administra tus preferencias y la configuraci\xF3n de la aplicaci\xF3n","settings.section.profile":"Perfil","settings.displayName":"Nombre para mostrar","settings.displayNameHint":"Este nombre se muestra en toda la aplicaci\xF3n","settings.placeholder.displayName":"Escribe tu nombre para mostrar","settings.email":"Correo electr\xF3nico","settings.emailHint":"Se usa para tu cuenta y notificaciones de vencimiento","settings.placeholder.email":"Escribe tu correo","settings.avatar":"Avatar","settings.avatarHint":"Sube una imagen para tu avatar (m\xE1x. 2 MB). Se mostrar\xE1 en forma circular.","settings.avatarRemoveTitle":"Eliminar avatar","settings.workspaceLogo":"Logo del espacio de trabajo","settings.workspaceLogoHint":"Sube una imagen cuadrada para reemplazar el logo de Nautilus (m\xE1x. 2 MB).","settings.workspaceLogoRemoveTitle":"Eliminar logo personalizado","settings.section.application":"Aplicaci\xF3n","settings.enableReviewStatus":"Habilitar estado En revisi\xF3n","settings.enableReviewStatusHint":"Muestra u oculta la columna y el filtro de estado EN REVISI\xD3N","settings.enableReviewStatusHintPrefix":"Muestra u oculta la columna y el filtro del estado","settings.enableReviewStatusHintSuffix":"en la vista de tareas","settings.calendarIncludeBacklog":"Mostrar backlog en calendario","settings.calendarIncludeBacklogHint":"Muestra tareas en backlog en todas las vistas de calendario","settings.autoStartDate":"Autocompletar fecha de inicio","settings.autoStartDateHint":'Establece autom\xE1ticamente la fecha de inicio cuando la tarea pasa a "En progreso" (si est\xE1 vac\xEDa)',"settings.autoEndDate":"Autocompletar fecha de fin","settings.autoEndDateHint":'Establece autom\xE1ticamente la fecha de fin cuando la tarea pasa a "Hecho" (si est\xE1 vac\xEDa)',"settings.debugLogs":"Habilitar logs de depuracion","settings.debugLogsHint":"Guarda logs de diagnostico en la consola del navegador al activarlo","settings.historySortOrder":"Orden de historial","settings.historySortOrderHint":"Orden predeterminado para los historiales de tareas y proyectos","settings.historySortNewest":"M\xE1s reciente primero","settings.historySortOldest":"M\xE1s antiguo primero","settings.language":"Idioma","settings.languageHint":"Elige el idioma de la aplicaci\xF3n","settings.section.notifications":"Notificaciones","settings.emailNotifications":"Notificaciones por correo","settings.emailNotificationsHint":"Activa o desactiva los correos de recordatorio de vencimientos","settings.weekdaysOnly":"Solo d\xEDas laborables","settings.weekdaysOnlyHint":"Omitir correos s\xE1bado y domingo","settings.includeStartDates":"Notificar cuando las tareas comienzan","settings.includeStartDatesHint":"Enviar recordatorios cuando una tarea comienza (ej., hoy)","settings.includeBacklog":"Incluir tareas en backlog","settings.includeBacklogHint":"Incluir tareas en backlog en notificaciones por correo y en la app","settings.sendTime":"Hora de env\xEDo","settings.sendTimeHint":"Hora diaria de env\xEDo (08:00-18:00, intervalos de 30 minutos)","settings.timeZone":"Zona horaria","settings.timeZoneHint":"Mantiene la misma hora local todo el a\xF1o (con horario de verano)","settings.timeZone.option.argentina":"Argentina (Buenos Aires)","settings.timeZone.option.canary":"Islas Canarias (Atlantic/Canary)","settings.timeZone.option.spain":"Espa\xF1a peninsular (Europe/Madrid)","settings.timeZone.option.utc":"UTC","settings.section.security":"Seguridad","settings.pinManagement":"Gesti\xF3n de PIN","settings.pinManagementHint":"Restablece tu PIN a un nuevo c\xF3digo de 4 d\xEDgitos","settings.resetPinButton":"Restablecer PIN","settings.section.dataManagement":"Gesti\xF3n de datos","settings.exportData":"Exportar datos","settings.exportDataHint":"Descarga una copia de seguridad completa de tus tareas, proyectos y configuraci\xF3n en un archivo JSON","settings.exportButton":"Exportar","settings.cancelButton":"Cancelar","settings.saveButton":"Guardar configuraci\xF3n","settings.avatarUploadDefault":"Arrastra y suelta o haz clic para subir un avatar","settings.avatarUploadChange":"Cambiar avatar","settings.avatarUploadAriaUpload":"Subir avatar","settings.avatarUploadAriaChange":"Cambiar avatar","settings.logoUploadDefault":"Arrastra y suelta o haz clic para subir un logo","settings.logoUploadChange":"Cambiar logo","settings.logoUploadAriaUpload":"Subir logo","settings.logoUploadAriaChange":"Cambiar logo","dashboard.title":"Panel","dashboard.hero.activeProjectsLabel":"Proyectos activos","dashboard.hero.completionRateLabel":"Tasa de finalizaci\xF3n","dashboard.hero.projectsTrend":"\u{1F4C8} +2 este mes","dashboard.hero.completionTrend":"\u{1F3AF} Objetivo: 80%","dashboard.projectAnalytics":"\u{1F4CA} Anal\xEDtica de proyectos","dashboard.period.week":"Semana","dashboard.period.month":"Mes","dashboard.period.quarter":"Trimestre","dashboard.stat.pendingTasks":"Tareas pendientes","dashboard.stat.inProgress":"En progreso","dashboard.stat.highPriority":"Alta prioridad","dashboard.stat.overdue":"Vencidas","dashboard.stat.completed":"Completadas","dashboard.stat.projects":"Proyectos","dashboard.highPriorityHint":"Tareas de alta prioridad con vencimiento en 7 d\xEDas (o vencidas)","dashboard.projectProgress":"\u{1F30A} Progreso del proyecto","dashboard.legend.todo":"Por hacer","dashboard.legend.progress":"En progreso","dashboard.legend.review":"En revisi\xF3n","dashboard.legend.complete":"Completo","dashboard.viewAll":"Ver todo","dashboard.quickActions":"\u26A1 Acciones r\xE1pidas","dashboard.action.generateReport":"Generar informe","dashboard.action.addTask":"Agregar tarea","dashboard.action.viewCalendar":"Ver calendario","dashboard.action.newProject":"Nuevo proyecto","dashboard.recentActivity":"\u{1F504} Actividad reciente","dashboard.researchInsights":"\u{1F9E0} Perspectivas","dashboard.activity.emptyTitle":"Bienvenido a tu panel","dashboard.activity.emptySubtitle":"Empieza a crear proyectos y tareas para ver actividad","dashboard.activity.completed":'Completaste "{title}" {projectPart}',"dashboard.activity.createdProject":'Creaste el nuevo proyecto "{project}"',"dashboard.activity.addedTask":'Agregaste la nueva tarea "{title}" {projectPart}',"dashboard.activity.inProject":"en {project}","dashboard.activity.toProject":"a {project}","dashboard.activity.recently":"Recientemente","dashboard.activity.justNow":"Justo ahora","dashboard.activity.today":"Hoy","dashboard.activity.yesterday":"Ayer","dashboard.activity.daysAgoShort":"hace {count}d","dashboard.activity.minuteAgo":"hace {count} minuto","dashboard.activity.minutesAgo":"hace {count} minutos","dashboard.activity.hourAgo":"hace {count} hora","dashboard.activity.hoursAgo":"hace {count} horas","dashboard.activity.dayAgo":"hace {count} d\xEDa","dashboard.activity.daysAgo":"hace {count} d\xEDas","dashboard.trend.thisWeek":"esta semana","dashboard.trend.thisMonth":"este mes","dashboard.trend.thisQuarter":"este trimestre","dashboard.trend.dueTodayOne":"{count} vence hoy","dashboard.trend.dueTodayMany":"{count} vencen hoy","dashboard.trend.onTrack":"En buen camino","dashboard.trend.needsAttention":"Necesita atenci\xF3n","dashboard.trend.allOnTrack":"Todo en buen camino","dashboard.trend.criticalOne":"{count} cr\xEDtica","dashboard.trend.criticalMany":"{count} cr\xEDticas","dashboard.trend.completedOne":"{count} completada","dashboard.trend.completedMany":"{count} completadas","dashboard.trend.inProgress":"En progreso","dashboard.emptyProjects.title":"A\xFAn no hay proyectos","dashboard.emptyProjects.subtitle":"Crea tu primer proyecto para ver la visualizaci\xF3n de progreso","dashboard.tasks":"tareas","dashboard.activity.allTitle":"Toda la actividad reciente","dashboard.activity.allSubtitle":"Historial completo de tu trabajo reciente","dashboard.activity.backToDashboard":"\u2190 Volver al panel","dashboard.insights.excellentTitle":"Progreso excelente","dashboard.insights.excellentDesc":"{percent}% de finalizaci\xF3n supera el objetivo. Gran impulso.","dashboard.insights.goodTitle":"Buen progreso","dashboard.insights.goodDesc":"{percent}% de finalizaci\xF3n es s\xF3lido. Intenta llegar al objetivo de 80%.","dashboard.insights.opportunityTitle":"Oportunidad de progreso","dashboard.insights.opportunityDesc":"{percent}% de finalizaci\xF3n. Enf\xF3cate en completar tareas actuales para ganar impulso.","dashboard.insights.actionTitle":"Acci\xF3n necesaria","dashboard.insights.actionDesc":"{percent}% de finalizaci\xF3n es bajo. Divide tareas grandes y empieza con las peque\xF1as.","dashboard.insights.todayTitle":"Enfoque de hoy","dashboard.insights.todayDescOne":"{count} tarea vence hoy. Prior\xEDzala para mayor impacto.","dashboard.insights.todayDescMany":"{count} tareas vencen hoy. Prior\xEDzalas para mayor impacto.","dashboard.insights.overdueTitle":"Elementos vencidos","dashboard.insights.overdueDescOne":"{count} tarea vencida necesita atenci\xF3n. Ati\xE9ndela para evitar retrasos.","dashboard.insights.overdueDescMany":"{count} tareas vencidas necesitan atenci\xF3n. Ati\xE9ndelas para evitar retrasos.","dashboard.insights.highPriorityTitle":"Enfoque de alta prioridad","dashboard.insights.highPriorityDescOne":"{count} tarea de alta prioridad necesita atenci\xF3n inmediata.","dashboard.insights.highPriorityDescMany":"{count} tareas de alta prioridad necesitan atenci\xF3n inmediata.","dashboard.insights.emptyProjectsTitle":"Proyectos sin tareas","dashboard.insights.emptyProjectsDescOne":"{count} proyecto no tiene tareas a\xFAn. Agrega tareas para seguir el progreso.","dashboard.insights.emptyProjectsDescMany":"{count} proyectos no tienen tareas a\xFAn. Agrega tareas para seguir el progreso.","dashboard.insights.momentumTitle":"Buen impulso","dashboard.insights.momentumDescOne":"{count} tarea completada esta semana. Vas en buen ritmo.","dashboard.insights.momentumDescMany":"{count} tareas completadas esta semana. Vas en buen ritmo.","dashboard.insights.readyTitle":"Listo para empezar","dashboard.insights.readyDesc":"Crea tu primer proyecto y agrega tareas para comenzar a seguir tu progreso.","dashboard.insights.caughtUpTitle":"Todo al d\xEDa","dashboard.insights.caughtUpDesc":"Buen trabajo. No hay urgencias. Considera planificar tus pr\xF3ximos hitos."}};function tc(){return localStorage.getItem("authToken")}function Za(){let e=tc(),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}var rs=2e4,ac="debugLogsEnabled";function is(){try{return localStorage.getItem(ac)==="true"}catch{return!1}}function ss(e,t){is()&&(t?console.log(`[feedback-debug] ${e}`,t):console.log(`[feedback-debug] ${e}`))}async function Xa(e,t={},a=rs){let n=new AbortController,o=setTimeout(()=>n.abort(),a);try{return await fetch(e,{...t,signal:n.signal})}finally{clearTimeout(o)}}async function ct(e,t){try{let a=await Xa(`/api/storage?key=${encodeURIComponent(e)}`,{method:"POST",headers:Za(),body:JSON.stringify(t)});if(!a.ok)throw a.status===401?(window.location.hash="#login",new Error("Unauthorized - please login")):new Error(`Failed to save data: ${a.status} ${a.statusText}`);return!0}catch(a){throw console.error(`Error saving data for key "${e}":`,a),a}}async function tt(e){try{let t=await Xa(`/api/storage?key=${encodeURIComponent(e)}`,{headers:Za()});if(!t.ok){if(t.status===401)return window.location.hash="#login",null;if(t.status===404)return null;throw new Error(`Failed to load data: ${t.status} ${t.statusText}`)}let a=await t.text();return a&&a!=="null"?JSON.parse(a):null}catch(t){return console.error(`Error loading data for key "${e}":`,t),null}}async function cs(e){try{let t=Array.isArray(e)?e:[],a=encodeURIComponent(t.join(",")),n=await Xa(`/api/storage/batch?keys=${a}`,{headers:Za()});if(!n.ok)return n.status===401&&(window.location.hash="#login"),null;let o=await n.json();return o&&typeof o=="object"?o:null}catch(t){return console.error("Error batch loading data:",t),null}}async function Yn(){return tt("feedback:index")}async function ls(e){return ct("feedback:index",e)}async function Qa(e){return tt(`feedback:item:${e}`)}async function ds(e){return ct(`feedback:item:${e.id}`,e)}async function us(e,t=rs){try{let a=is(),n=`fb-${Date.now()}-${Math.random().toString(36).slice(2)}`,o=typeof performance<"u"&&performance.now?performance.now():Date.now(),s=null;if(a)try{s=JSON.stringify({operations:e}).length}catch{}let r=Za();a&&(r["X-Debug-Logs"]="1",r["X-Request-Id"]=n,ss("batch-feedback:request",{requestId:n,operationCount:Array.isArray(e)?e.length:0,payloadBytes:s,timeoutMs:t}));let i=await Xa("/api/batch-feedback",{method:"POST",headers:r,body:JSON.stringify({operations:e})},t);if(!i.ok)throw i.status===401?(window.location.hash="#login",new Error("Unauthorized - please login")):new Error(`Failed to batch process feedback: ${i.status} ${i.statusText}`);let c=await i.json();if(a){let l=typeof performance<"u"&&performance.now?performance.now():Date.now();ss("batch-feedback:response",{requestId:n,durationMs:Math.round(l-o),success:c&&c.success,processed:c&&c.processed,total:c&&c.total})}return c}catch(a){throw console.error("Error batch processing feedback:",a),a}}async function fs(e){try{await ct("tasks",e),Array.isArray(e)&&en(Jn,e)}catch(t){throw console.error("Error saving tasks:",t),t}}async function gs(e){try{await ct("projects",e),Array.isArray(e)&&en(Zn,e)}catch(t){throw console.error("Error saving projects:",t),t}}async function hs(e){try{await ct("projectColors",e)}catch(t){throw console.error("Error saving project colors:",t),t}}async function ys(e,t){try{await Promise.all([ct("sortMode",e),ct("manualTaskOrder",t)])}catch(a){throw console.error("Error saving sort state:",a),a}}async function vs(e={}){let t=!!e.preferCache,a=e.feedback||{};try{let n=t?ps(Jn):[],o=t?ps(Zn):[],s=a.preferCache??t,r=await Ss({...a,preferCache:s}),i=n&&n.length>0||o&&o.length>0;if(t&&i){let c=typeof e.onRefresh=="function"?e.onRefresh:null,l={...e,preferCache:!1,feedback:{...a,preferCache:!1}};return ms(l).then(u=>{c&&c(u)}),{tasks:n||[],projects:o||[],feedbackItems:r||[]}}return await ms({...e,feedback:{...a,preferCache:s}})}catch(n){return console.error("Error loading all data:",n),{tasks:[],projects:[],feedbackItems:[]}}}var tn="feedbackItemsCache:v1",Jn="tasksCache:v1",Zn="projectsCache:v1";function bs(e){try{let t=localStorage.getItem("authToken");return t?`${e}:${t}`:e}catch{return e}}function ps(e){try{let t=localStorage.getItem(bs(e)),a=t?JSON.parse(t):[];return Array.isArray(a)?a:[]}catch{return[]}}function en(e,t){try{localStorage.setItem(bs(e),JSON.stringify(t||[]))}catch{}}function nc(e){let t=e||tn;try{let a=localStorage.getItem(t),n=a?JSON.parse(a):[];return Array.isArray(n)?n:[]}catch{return[]}}function Kn(e,t){let a=e||tn;try{localStorage.setItem(a,JSON.stringify(t||[]))}catch{}}async function ms(e={}){let t=e.feedback||{},a=await cs(["tasks","projects","feedbackItems"]),[n,o,s]=await Promise.all([a?Promise.resolve(a.tasks):tt("tasks"),a?Promise.resolve(a.projects):tt("projects"),Ss(t)]);return Array.isArray(n)&&en(Jn,n),Array.isArray(o)&&en(Zn,o),{tasks:n||[],projects:o||[],feedbackItems:s||[]}}function ks(e,t){let a=Array.isArray(e)?e:[],n=Array.isArray(t)?t:[];if(a.length===0)return n.filter(Boolean);let o=new Set,s=[],r=new Map;for(let c of n)c&&c.id!=null&&r.set(c.id,c);for(let c of a)!c||c.id==null||(o.add(c.id),s.push(r.get(c.id)||c));let i=[];for(let c of n)c&&c.id!=null&&!o.has(c.id)&&i.push(c);return[...i,...s]}async function ws(e,t,a){let n=Number.isInteger(t)?t:null,o=Number.isInteger(a)?a:null,s=await Promise.all(e.map(u=>Qa(u))),r=[],i=[];for(let u of s){if(!u)continue;(u.status==="done"?"done":"open")==="done"?i.push(u):r.push(u)}let c=n!==null?r.slice(0,n):r,l=o!==null?i.slice(0,o):i;return[...c,...l]}async function oc(e){let t=e.limitPending,a=e.limitDone,n=e.cacheKey||tn,o=Array.isArray(e.cached)?e.cached:[],s=typeof e.onRefresh=="function"?e.onRefresh:null;try{let r=await Yn();if(Array.isArray(r)&&r.length>0){let i=[];Number.isInteger(t)||Number.isInteger(a)?i=await ws(r,t,a):i=await Promise.all(r.map(l=>Qa(l)));let c=ks(o,i.filter(Boolean));Kn(n,c),s&&s(c)}}catch(r){console.error("Error refreshing feedback items:",r)}}async function Ss(e={}){let t=[];try{let a=e.limitPending,n=e.limitDone,o=e.cacheKey||tn;if(t=e.useCache===!1?[]:nc(o),!!(e.preferCache&&t.length>0))return oc({limitPending:a,limitDone:n,cacheKey:o,cached:t,onRefresh:e.onRefresh}),t;let r=await Yn();if(Array.isArray(r)&&r.length>0){let c=[];Number.isInteger(a)||Number.isInteger(n)?c=await ws(r,a,n):c=await Promise.all(r.map(u=>Qa(u)));let l=ks(t,c.filter(Boolean));return Kn(o,l),l}let i=await tt("feedbackItems");if(Array.isArray(i)&&i.length>0){try{let c=i.map(l=>l&&l.id).filter(l=>l!=null);await Promise.all(i.map(l=>ds(l))),await ls(c)}catch(c){console.error("Error migrating legacy feedback items:",c)}return Kn(o,i),i}}catch(a){console.error("Error loading feedback items:",a)}return t||[]}async function Es(){try{let[e,t]=await Promise.all([tt("sortMode"),tt("manualTaskOrder")]);return{sortMode:e==="auto"||!e?"priority":e,manualTaskOrder:t||{todo:[],progress:[],review:[],done:[]}}}catch(e){return console.error("Error loading sort state:",e),{sortMode:"priority",manualTaskOrder:{todo:[],progress:[],review:[],done:[]}}}}async function Ds(){try{return await tt("projectColors")||{}}catch(e){return console.error("Error loading project colors:",e),{}}}async function Ts(e){try{await ct("settings",e)}catch(t){throw console.error("Error saving settings:",t),t}}async function xs(){try{return await tt("settings")||{}}catch(e){return console.error("Error loading settings:",e),{}}}function Xn(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)}function Ye(e){return typeof e=="string"&&/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{4}$/.test(e.trim())}function at(e){return typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e.trim())}function dt(e){if(!Ye(e))return e||"";let t=e.trim().split(/[\/\-]/),a=parseInt(t[0],10),n=parseInt(t[1],10),o=parseInt(t[2],10);if(!a||!n||!o||a>31||n>12)return"";let s=String(a).padStart(2,"0"),r=String(n).padStart(2,"0");return`${o}-${r}-${s}`}function an(e){if(!at(e))return e||"";let[t,a,n]=e.split("-");return`${n}/${a}/${t}`}function pe(e){if(!e)return"No date";if(Ye(e))return e.replace(/-/g,"/");if(at(e)){let[t,a,n]=e.split("-");return`${n}/${a}/${t}`}return"No date"}function nn(e,t=void 0){if(!e)return"No date";try{if(at(e)){let[a,n,o]=e.split("-");return new Date(parseInt(a,10),parseInt(n,10)-1,parseInt(o,10)).toLocaleDateString(t,{year:"numeric",month:"short",day:"numeric"})}if(Ye(e)){let a=e.split(/[\/\-]/),n=parseInt(a[0],10),o=parseInt(a[1],10),s=parseInt(a[2],10);return new Date(s,o-1,n).toLocaleDateString(t,{year:"numeric",month:"short",day:"numeric"})}}catch{}return"No date"}function Is(e){let t=new Intl.DateTimeFormat(e,{weekday:"short"}),a=new Date(2024,0,1);return Array.from({length:7},(n,o)=>{let s=t.format(new Date(a.getFullYear(),a.getMonth(),a.getDate()+o));return Xn(s)})}function js(e,t,a){let n=new Intl.DateTimeFormat(e,{month:"long",year:"numeric"});return Xn(n.format(new Date(t,a,1)))}function Cs(e,t,a,n=[]){let o=new Date().toISOString(),s=e.startDate||"",r=e.endDate||"",i={id:a,title:e.title||"",description:e.description||"",projectId:e.projectId?parseInt(e.projectId,10):null,startDate:s,endDate:r,startDateWasEverSet:typeof s=="string"&&s.trim()!=="",endDateWasEverSet:typeof r=="string"&&r.trim()!=="",priority:e.priority||"medium",status:e.status||"todo",tags:e.tags||[],attachments:n.length>0?[...n]:[],createdAt:o,updatedAt:o},c=[...t,i],l=a+1;return{task:i,tasks:c,taskCounter:l}}function Ls(e,t,a){let n=a.findIndex(u=>u.id===parseInt(e,10));if(n===-1)return{task:null,tasks:a,oldProjectId:null};let o=a[n],s=o.projectId,r=t.projectId!==void 0?t.projectId?parseInt(t.projectId,10):null:o.projectId,i={...o,title:t.title!==void 0?t.title:o.title,description:t.description!==void 0?t.description:o.description,projectId:r,startDate:t.startDate!==void 0?t.startDate:o.startDate,endDate:t.endDate!==void 0?t.endDate:o.endDate,priority:t.priority!==void 0?t.priority:o.priority,status:t.status!==void 0?t.status:o.status};if(t.startDate!==void 0&&typeof i.startDate=="string"&&i.startDate.trim()!==""&&(i.startDateWasEverSet=!0),t.endDate!==void 0&&typeof i.endDate=="string"&&i.endDate.trim()!==""&&(i.endDateWasEverSet=!0),!(i.title!==o.title||i.description!==o.description||i.projectId!==o.projectId||i.startDate!==o.startDate||i.endDate!==o.endDate||i.priority!==o.priority||i.status!==o.status))return{task:o,tasks:a,oldProjectId:s};i.updatedAt=new Date().toISOString();let l=[...a];return l[n]=i,{task:i,tasks:l,oldProjectId:s}}function Ps(e,t,a,n,o={autoSetStartDateOnStatusChange:!1,autoSetEndDateOnStatusChange:!1}){let s=n.findIndex(g=>g.id===parseInt(e,10));if(s===-1)return{task:null,tasks:n,oldProjectId:null};let r=n[s],i=r.projectId,c={...r},l=r.startDate,u=r.endDate,d=r.completedDate;if(t==="startDate"||t==="endDate"){let g=Ye(a)?dt(a):at(a)?a:"";c[t]=g,g&&(t==="startDate"&&(c.startDateWasEverSet=!0),t==="endDate"&&(c.endDateWasEverSet=!0))}else t==="projectId"?c.projectId=a?parseInt(a,10):null:c[t]=a;if(t==="status"&&(o.autoSetStartDateOnStatusChange||o.autoSetEndDateOnStatusChange)){let g=new Date().toISOString().split("T")[0];o.autoSetStartDateOnStatusChange&&a==="progress"&&!c.startDate&&(c.startDate=g,c.startDateWasEverSet=!0),o.autoSetEndDateOnStatusChange&&a==="done"&&!c.endDate&&(c.endDate=g,c.endDateWasEverSet=!0)}t==="status"&&a==="done"&&!c.completedDate&&(c.completedDate=new Date().toISOString());let f;if(t==="projectId"?f=c.projectId!==r.projectId:f=c[t]!==r[t],t==="status"&&(c.startDate!==l&&(f=!0),c.endDate!==u&&(f=!0),c.completedDate!==d&&(f=!0)),!f)return{task:r,tasks:n,oldProjectId:i};c.updatedAt=new Date().toISOString();let m=[...n];return m[s]=c,{task:c,tasks:m,oldProjectId:i}}function As(e,t){let a=t.find(s=>s.id===parseInt(e,10));if(!a)return{task:null,tasks:t,projectId:null};let n=a.projectId,o=t.filter(s=>s.id!==parseInt(e,10));return{task:a,tasks:o,projectId:n}}function Bs(e,t,a){let n=t.find(u=>u.id===parseInt(e,10));if(!n)return{task:null,tasks:t,taskCounter:a};let o=n.title||"Untitled",s=o.startsWith("Copy ")?o:`Copy ${o}`,r=new Date().toISOString(),i={id:a,title:s,description:n.description||"",projectId:n.projectId??null,startDate:n.startDate||"",endDate:n.endDate||"",startDateWasEverSet:!!n.startDateWasEverSet||!!n.startDate&&String(n.startDate).trim()!=="",endDateWasEverSet:!!n.endDateWasEverSet||!!n.endDate&&String(n.endDate).trim()!=="",priority:n.priority||"medium",status:n.status||"todo",tags:Array.isArray(n.tags)?[...n.tags]:[],attachments:Array.isArray(n.attachments)?n.attachments.map(u=>({...u})):[],createdAt:r,updatedAt:r},c=[...t,i],l=a+1;return{task:i,tasks:c,taskCounter:l}}function $s(e,t,a){let n={id:a,name:e.name||"",description:e.description||"",startDate:e.startDate||"",endDate:e.endDate||"",tags:e.tags||[],createdAt:new Date().toISOString()},o=[...t,n],s=a+1;return{project:n,projects:o,projectCounter:s}}function Ns(e,t,a,n){let o=n.findIndex(c=>c.id===parseInt(e,10));if(o===-1)return{project:null,projects:n};let r={...n[o]};if(t==="startDate"||t==="endDate"){let c=Ye(a)?dt(a):at(a)?a:"";r[t]=c}else r[t]=a;let i=[...n];return i[o]=r,{project:r,projects:i}}function Ms(e,t,a=null,n=!1){let o=t.find(i=>i.id===parseInt(e,10));if(!o)return{project:null,projects:t,tasks:a};let s=t.filter(i=>i.id!==parseInt(e,10)),r=a;return a&&n&&(r=a.map(i=>i.projectId===parseInt(e,10)?{...i,projectId:null}:i)),{project:o,projects:s,tasks:r}}function U(e){return(e||"").replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}var Qn=["#dc2626","#ea580c","#b45309","#ca8a04","#16a34a","#059669","#0ea5a4","#0284c7","#0369a1","#4338ca","#7c3aed","#6b21a8","#be185d","#e11d48","#065f46","#334155"],ka=["#6C5CE7","#3742FA","#E84393","#00B894","#74B9FF","#0984E3","#0891b2","#E17055","#9B59B6","#2F3542","#FF3838","#6C5B7B","#C44569","#F8B500","#5758BB"];var Fs={backlog:"Backlog",todo:"To Do",progress:"In Progress",review:"In Review",done:"Done"};var oe={high:3,medium:2,low:1},wa={done:1,progress:2,review:3,todo:4,backlog:5},Rs=[{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}],eo={high:"var(--accent-red)",medium:"var(--accent-amber)",low:"var(--accent-green)"};var to=[{id:"2026.01.06",version:"2.7.0",title:{en:"Signal and Flow",es:"Se\xF1al y flujo"},date:"2026-01-06",summary:{en:"A focused release that makes changes visible and deadlines clearer.",es:"Una versi\xF3n enfocada que hace visibles los cambios y aclara los plazos."},sections:{new:[{en:"Release Notes page with a clean breakdown of changes.",es:"P\xE1gina de notas de versi\xF3n con un desglose claro de cambios."},{en:"Top bar notification bell for new releases.",es:"Campana de notificaciones en la barra superior para nuevas versiones."},{en:"Due today reminders with quick navigation.",es:"Recordatorios de vencimiento hoy con navegaci\xF3n r\xE1pida."}],improvements:[{en:"Updates page tuned for fast scanning.",es:"P\xE1gina de novedades ajustada para lectura r\xE1pida."},{en:"Notification badge aggregates releases and due today tasks.",es:"La insignia de notificaciones agrupa versiones y tareas que vencen hoy."},{en:"Release dates formatted per locale.",es:"Fechas de versi\xF3n formateadas seg\xFAn la configuraci\xF3n regional."}],fixes:[{en:"Notifications now stay focused on tasks due today.",es:"Las notificaciones ahora se enfocan en tareas que vencen hoy."},{en:"Release history stays consistent across sessions.",es:"El historial de versiones se mantiene consistente entre sesiones."}]}},{id:"2025.12.20",version:"2.6.1",title:{en:"Stability Pass",es:"Pase de estabilidad"},date:"2025-12-20",summary:{en:"Polish across projects, tasks, and reporting.",es:"Pulido en proyectos, tareas y reportes."},sections:{new:[{en:"Task sorting refinements in list view.",es:"Mejoras en el ordenamiento de tareas en vista de lista."},{en:"Improved history timeline labels.",es:"Etiquetas mejoradas en la l\xEDnea de tiempo del historial."}],improvements:[{en:"Cleaner spacing for project detail views.",es:"Espaciado m\xE1s limpio en vistas de detalle de proyecto."},{en:"Faster dashboard rendering on large datasets.",es:"Renderizado del panel m\xE1s r\xE1pido con datos grandes."}],fixes:[{en:"Resolved occasional drag reorder glitches.",es:"Corregidos fallos ocasionales al reordenar arrastrando."},{en:"Fixed missing labels in calendar tooltips.",es:"Corregidas etiquetas faltantes en los tooltips del calendario."}]}},{id:"2025.12.04",version:"2.6.0",title:{en:"Project Clarity",es:"Claridad de proyecto"},date:"2025-12-04",summary:{en:"Better project visibility and smarter filters.",es:"Mejor visibilidad de proyectos y filtros m\xE1s inteligentes."},sections:{new:[{en:"Enhanced project filters for recency.",es:"Filtros de proyectos mejorados por recencia."},{en:"Quick access backlog button in Kanban.",es:"Bot\xF3n de acceso r\xE1pido al backlog en Kanban."}],improvements:[{en:"Refined status badges for contrast.",es:"Insignias de estado refinadas para mejor contraste."},{en:"Clearer labels across filters and chips.",es:"Etiquetas m\xE1s claras en filtros y chips."}],fixes:[{en:"Fixed filter chips not clearing on reset.",es:"Corregido que los chips de filtros no se limpiaban al restablecer."},{en:"Resolved layout shifts in mobile task list.",es:"Corregidos saltos de dise\xF1o en la lista de tareas m\xF3vil."}]}}];var Os="debugLogsEnabled",ao=new Map,sc=typeof window<"u"&&typeof window.__pageLoadStart=="number"?window.__pageLoadStart:typeof performance<"u"?performance.now():Date.now();function rc(){let e=typeof performance<"u"?performance.now():Date.now();return Math.round(e-sc)}function Ve(e,t){if(!ut())return;let a=rc();console.log(`[perf] ${e} @ ${a}ms`,t||"")}function no(e){let t=!!e;window.debugLogsEnabled=t;try{localStorage.setItem(Os,String(t))}catch{}}function ut(){if(typeof window.debugLogsEnabled=="boolean")return window.debugLogsEnabled;try{return localStorage.getItem(Os)==="true"}catch{return!1}}function on(e,t,a){ut()&&(a?console.log(`[debug:${e}] ${t}`,a):console.log(`[debug:${e}] ${t}`))}function ke(e,t,a){if(!ut())return;let n=`${e}:${t}:${Date.now()}-${Math.random().toString(36).slice(2)}`;return ao.set(n,typeof performance<"u"&&performance.now?performance.now():Date.now()),on(e,`${t}:start`,a),n}function ye(e,t,a){if(!ut())return;let n=ao.get(t);if(n==null)return;ao.delete(t);let o=typeof performance<"u"&&performance.now?performance.now():Date.now();on(e,"duration",{durationMs:Math.round(o-n),...a})}function _t(e,t="info"){let a=document.createElement("div");a.className=`notification notification-${t}`,a.style.cssText=`
        position: fixed;
        bottom: 24px;
        right: 24px;
        padding: 16px 24px;
        background: ${t==="error"?"var(--accent-red)":t==="success"?"var(--accent-green)":"var(--accent-blue)"};
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10001;
        font-size: 14px;
        font-weight: 500;
        max-width: 400px;
        animation: slideIn 0.3s ease-out;
    `,a.textContent=e,document.body.appendChild(a),setTimeout(()=>{a.style.animation="slideOut 0.3s ease-out",setTimeout(()=>a.remove(),300)},4e3)}function W(e){_t(e,"error")}function Ke(e){_t(e,"success")}function qs(e){return new Promise((t,a)=>{let n=new FileReader;n.onload=o=>t(o.target.result),n.onerror=o=>a(o),n.readAsDataURL(e)})}async function zs(e,t){let a=await fetch(`/api/files?key=${encodeURIComponent(e)}`,{method:"POST",headers:{"Content-Type":"text/plain"},body:t});if(!a.ok){let n=`Failed to upload file: ${a.status} ${a.statusText}`;try{let o=await a.json();o.message&&(n=o.message),o.troubleshooting&&(n+=`

Troubleshooting: `+o.troubleshooting)}catch{}throw new Error(n)}}async function Sa(e){let t=await fetch(`/api/files?key=${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`Failed to download file: ${t.status} ${t.statusText}`);return await t.text()}async function oo(e){let t=await fetch(`/api/files?key=${encodeURIComponent(e)}`,{method:"DELETE"});if(!t.ok)throw new Error(`Failed to delete file: ${t.status} ${t.statusText}`)}function Hs(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e||"").trim())}function Ea(e){if(!e||typeof e!="string")return"";let t=e.trim().match(/^(\d{1,2}):(\d{2})$/);if(!t)return"";let a=Number(t[1]),n=Number(t[2]);return!Number.isInteger(a)||!Number.isInteger(n)||a<0||a>23||n<0||n>59?"":`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`}function ro(e,t){let a=Ea(e);if(!a)return"";let[n,o]=a.split(":"),s=Number(n)*60+Number(o),r=Number(t)||1,c=(Math.round(s/r)*r%1440+1440)%1440,l=Math.floor(c/60),u=c%60;return`${String(l).padStart(2,"0")}:${String(u).padStart(2,"0")}`}function so(e){let t=Ea(e);if(!t)return null;let[a,n]=t.split(":");return Number(a)*60+Number(n)}function Us(e){let t=Math.max(0,Math.min(1439,Number(e))),a=Math.floor(t/60),n=t%60;return`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`}function io(e,t,a){let n=so(e),o=so(t),s=so(a);return n==null||o==null||s==null?"":n<o?t:n>s?a:e}function ta(e){let t=Date.now();switch(e){case"5m":return t-300*1e3;case"30m":return t-1800*1e3;case"24h":return t-1440*60*1e3;case"week":return t-10080*60*1e3;case"month":return t-720*60*60*1e3;default:return null}}function At(e){let t=e&&(e.updatedAt||e.createdAt||e.createdDate)||"",a=new Date(t).getTime();return Number.isFinite(a)?a:0}function _s(e){let t=e&&(e.updatedAt||e.createdAt||e.createdDate)||"",a=new Date(t),n=a.getTime();if(!Number.isFinite(n)||n===0)return"";try{return a.toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return a.toISOString().slice(0,16).replace("T"," ")}}function sn(e,t){let a=null;return function(...n){a&&clearTimeout(a),a=setTimeout(()=>e.apply(this,n),t)}}function aa(e,t,a){a?e.add(t):e.delete(t)}function ic(){return new Date().toISOString().split("T")[0]}function cc(e,t){return t?e.title&&e.title.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t):!0}function lc(e,t){return t.size===0||t.has(e.status)}function dc(e,t){return t.size===0||t.has(e.priority)}function uc(e,t){return!!(t.size===0||e.projectId&&t.has(e.projectId.toString())||!e.projectId&&t.has("none"))}function pc(e,t){return!!(t.size===0||e.tags&&e.tags.some(a=>t.has(a))||(!e.tags||e.tags.length===0)&&t.has("none"))}function mc(e,t,a){let n=new Date(a+"T00:00:00");switch(t){case"no-date":return!e.endDate||e.endDate==="";case"overdue":return e.endDate&&e.endDate<a;case"end-today":return e.endDate===a;case"end-tomorrow":{let o=new Date(n);return o.setDate(o.getDate()+1),e.endDate===o.toISOString().split("T")[0]}case"end-7days":{let o=new Date(n);return o.setDate(o.getDate()+7),e.endDate===o.toISOString().split("T")[0]}case"end-week":{let o=new Date(n);o.setDate(o.getDate()+7);let s=o.toISOString().split("T")[0];return e.endDate&&e.endDate>=a&&e.endDate<=s}case"end-month":{let o=new Date(n);o.setDate(o.getDate()+30);let s=o.toISOString().split("T")[0];return e.endDate&&e.endDate>=a&&e.endDate<=s}case"no-start-date":return!e.startDate||e.startDate==="";case"already-started":return e.startDate&&e.startDate<a&&e.status!=="done";case"start-today":return e.startDate===a;case"start-tomorrow":{let o=new Date(n);return o.setDate(o.getDate()+1),e.startDate===o.toISOString().split("T")[0]}case"start-7days":{let o=new Date(n);return o.setDate(o.getDate()+7),e.startDate===o.toISOString().split("T")[0]}case"start-week":{let o=new Date(n);o.setDate(o.getDate()+7);let s=o.toISOString().split("T")[0];return e.startDate&&e.startDate>=a&&e.startDate<=s}case"start-month":{let o=new Date(n);o.setDate(o.getDate()+30);let s=o.toISOString().split("T")[0];return e.startDate&&e.startDate>=a&&e.startDate<=s}default:return!0}}function fc(e,t,a){return t.size===0?!0:Array.from(t).some(n=>mc(e,n,a))}function gc(e,t,a,n="endDate"){if(!t&&!a)return!0;let o=n==="startDate"?e.startDate:e.endDate;return o?t&&a?t===a?o===a:o>=t&&o<=a:t?o>=t:a?o<=a:!0:!1}function Vs(e,t){let{search:a="",statuses:n=new Set,priorities:o=new Set,projects:s=new Set,tags:r=new Set,datePresets:i=new Set,dateFrom:c="",dateTo:l="",dateField:u="endDate"}=t,d=ic(),f=a.toLowerCase();return e.filter(m=>{if(!cc(m,f)||!lc(m,n)||!dc(m,o)||!uc(m,s)||!pc(m,r))return!1;if(i.size>0){if(!fc(m,i,d))return!1}else if((c||l)&&!gc(m,c,l,u))return!1;return!0})}function Ws(e,t){let a=new Date().toISOString().split("T")[0],n=e.filter(m=>m.status!=="backlog"),o=n.length,s=n.filter(m=>m.status==="done").length,r=o>0?Math.round(s/o*100):0,i=n.filter(m=>m.status==="progress").length,c=n.filter(m=>m.status==="todo").length,l=n.filter(m=>m.status==="review").length,u=n.filter(m=>m.endDate&&m.endDate<a&&m.status!=="done").length,d=n.filter(m=>m.priority==="high"&&m.status!=="done").length,f=t.filter(m=>m.endDate).length;return{activeProjects:t.length,totalTasks:o,completedTasks:s,completionRate:r,inProgressTasks:i,pendingTasks:c,reviewTasks:l,overdueTasks:u,highPriorityTasks:d,milestones:f}}function Gs(e,t){let a=new Date().toISOString().split("T")[0],n=new Date,o=e.filter(d=>d.status!=="backlog"),s=new Date;s.setDate(s.getDate()-7);let r=o.filter(d=>d.status!=="done"||!d.completedDate?!1:new Date(d.completedDate)>s).length,i=o.filter(d=>!d.endDate||d.status==="done"?!1:new Date(d.endDate).toDateString()===n.toDateString()).length,c=o.filter(d=>d.status!=="done"&&d.endDate&&d.endDate<a).length,l=o.filter(d=>{if(d.status==="done"||d.priority!=="high"||!d.endDate)return!1;let f=new Date(n.getFullYear(),n.getMonth(),n.getDate()),m=new Date(d.endDate),g=new Date(m.getFullYear(),m.getMonth(),m.getDate());return Math.round((g-f)/(1e3*60*60*24))<=7}).length,u=t.filter(d=>{let f=e.filter(g=>g.projectId===d.id),m=f.filter(g=>g.status==="done");return f.length>0&&m.length===f.length}).length;return{thisWeekCompleted:r,dueTodayCount:i,overdueCount:c,criticalHighPriority:l,completedProjects:u,progressChange:Math.max(1,Math.floor(o.length*.1))}}function Ys(e,t,a=5){return e.slice(0,a).map(n=>{let o=Number(n?.id),s=t.filter(d=>Number(d?.projectId)===o&&d.status!=="backlog"),r=s.filter(d=>d.status==="done").length,i=s.filter(d=>d.status==="progress").length,c=s.filter(d=>d.status==="review").length,l=s.filter(d=>d.status==="todo").length,u=s.length;return{id:n.id,name:n.name,completed:r,inProgress:i,review:c,todo:l,total:u,completedPercent:u>0?r/u*100:0,inProgressPercent:u>0?i/u*100:0,reviewPercent:u>0?c/u*100:0,todoPercent:u>0?l/u*100:0}})}function Ks(e,t){let{tasksLabel:a}=t;return e.map(n=>`
        <div class="progress-bar-item clickable-project" data-action="showProjectDetails" data-param="${n.id}" style="cursor: pointer; transition: all 0.2s ease;">
            <div class="project-progress-header">
                <span class="project-name">${n.name}</span>
                <span class="task-count">${n.completed}/${n.total} ${a}</span>
            </div>
            <div style="height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; display: flex;">
                <div style="background: var(--accent-green); width: ${n.completedPercent}%; transition: width 0.5s ease;"></div>
                <div style="background: var(--accent-blue); width: ${n.inProgressPercent}%; transition: width 0.5s ease;"></div>
                <div style="background: var(--accent-amber); width: ${n.reviewPercent}%; transition: width 0.5s ease;"></div>
                <div style="background: var(--text-muted); width: ${n.todoPercent}%; transition: width 0.5s ease;"></div>
            </div>
        </div>
    `).join("")}function Js(e,t){return e.map(a=>`
        <div class="activity-item">
            <div class="activity-icon ${a.type}">${a.icon}</div>
            <div class="activity-content">
                <div class="activity-text">${a.text}</div>
            </div>
            <div class="activity-date">${t(a.date)}</div>
        </div>
    `).join("")}function hc(e,t){if(!e)return{hasDate:!1,urgency:"none",bgColor:null,textColor:"var(--text-muted)",borderColor:null,icon:"",iconColor:""};let a=new Date;a.setHours(0,0,0,0);let n=new Date(e);n.setHours(0,0,0,0);let o=n-a,s=Math.ceil(o/(1e3*60*60*24));return t==="done"?{hasDate:!0,urgency:"completed",diffDays:s,bgColor:"rgba(148, 163, 184, 0.12)",textColor:"#94a3b8",borderColor:"rgba(148, 163, 184, 0.25)",icon:"",iconColor:""}:s<0?{hasDate:!0,urgency:"overdue",diffDays:s,bgColor:"rgba(249, 115, 22, 0.2)",textColor:"#fb923c",borderColor:"rgba(249, 115, 22, 0.4)",icon:"\u26A0 ",iconColor:"#f97316"}:s<=7?{hasDate:!0,urgency:"soon",diffDays:s,bgColor:"rgba(192, 132, 252, 0.25)",textColor:"#c084fc",borderColor:"rgba(192, 132, 252, 0.5)",icon:"",iconColor:""}:{hasDate:!0,urgency:"normal",diffDays:s,bgColor:"rgba(59, 130, 246, 0.15)",textColor:"#93c5fd",borderColor:"rgba(59, 130, 246, 0.3)",icon:"",iconColor:""}}function Zs(e,t){let{escapeHtml:a,formatDate:n,getProjectColor:o,getTagColor:s,getPriorityLabel:r,projects:i,selectedCards:c,showProjects:l=!0,showNoDate:u=!0,noProjectText:d,noDateText:f}=t,m=i.find(S=>S.id===e.projectId),g=m?m.name:d,y=e.endDate?n(e.endDate):f,v=hc(e.endDate,e.status),w;if(v.hasDate){let{bgColor:S,textColor:x,borderColor:$,icon:z,iconColor:O}=v;w=`<span style="
            background: ${S};
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            color: ${x};
            border: 1px solid ${$};
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        ">${z?`<span style="color: ${O};">${z}</span>`:""}${a(y)}</span>`}else w=u?`<span style="color: var(--text-muted); font-size: 12px;">${y}</span>`:"";let T=c&&c.has(e.id)?" selected":"",E=e.status==="done"?" is-done":"",D=m?`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${o(m.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`:"",b=`<div style="display: flex; flex-wrap: wrap; align-items: center; gap: 4px; margin-top: 12px;">
        ${e.tags&&e.tags.length>0?e.tags.map(S=>`<span style="background-color: ${s(S)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${a(S.toUpperCase())}</span>`).join(""):""}
        <span style="margin-left: auto;">${w}</span>
    </div>`;return`
        <div class="task-card${T}${E}" draggable="true" data-task-id="${e.id}">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 8px;">
                <div class="task-title" style="flex: 1;">${D}${a(e.title||"")}</div>
                <div class="task-priority priority-${e.priority}" style="flex-shrink: 0;">${r(e.priority||"").toUpperCase()}</div>
            </div>
            ${l?`
            <div style="margin-top:8px; font-size:12px;">
                ${m?`<span style="background-color: ${o(m.id)}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500; display: inline-block; max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${a(m.name)}">${a(m.name)}</span>`:`<span style="color: var(--text-muted);">${d}</span>`}
            </div>
            `:""}
            ${b}
        </div>
    `}function yc(e,t=!1){let a={backlog:[],todo:[],progress:[],review:[],done:[]};return e.forEach(n=>{n.status==="backlog"&&!t||a[n.status]&&a[n.status].push(n)}),a}function Xs(e){return[...e].sort((t,a)=>{let n=oe[t.priority]||0;return(oe[a.priority]||0)-n})}function vc(e,t){if(!t||t.length===0)return Xs(e);let a=new Map(t.map((n,o)=>[n,o]));return[...e].sort((n,o)=>{let s=a.has(n.id)?a.get(n.id):9999,r=a.has(o.id)?a.get(o.id):9999;if(s!==r)return s-r;let i=oe[n.priority]||0;return(oe[o.priority]||0)-i})}function bc(e,t,a=null){let n={};return Object.keys(e).forEach(o=>{t==="manual"&&a&&a[o]?n[o]=vc(e[o],a[o]):n[o]=Xs(e[o])}),n}function kc(e){return{backlog:e.backlog?e.backlog.length:0,todo:e.todo?e.todo.length:0,progress:e.progress?e.progress.length:0,review:e.review?e.review.length:0,done:e.done?e.done.length:0}}function wc(e,t,a){return t===null?e:e.filter(n=>a(n)>=t)}function Qs(e,t={}){let{showBacklog:a=!1,sortMode:n="priority",manualTaskOrder:o=null,updatedCutoff:s=null,getTaskUpdatedTime:r=null}=t,i=e;s!==null&&r&&(i=wc(e,s,r));let c=yc(i,a),l=bc(c,n,o),u=kc(l);return{byStatus:l,counts:u,totalFiltered:i.length,totalOriginal:e.length}}function er(e,t){return e.map(a=>Zs(a,t)).join("")}function Sc(e){return[...e].sort((t,a)=>{let n=oe[t.priority]||0,o=oe[a.priority]||0;if(n!==o)return o-n;let s=t.endDate?new Date(t.endDate):null,r=a.endDate?new Date(a.endDate):null;return s&&r?s-r:s&&!r?-1:!s&&r?1:0})}function tr(e,t,a=[],n=null){switch(t){case"title":return(e.title||"").toLowerCase();case"status":return(wa||{backlog:0,todo:1,progress:2,review:3,done:4})[e.status]??0;case"priority":return{low:0,medium:1,high:2}[e.priority]??0;case"project":{let o=a.find(s=>s.id===e.projectId);return o?o.name.toLowerCase():""}case"startDate":return e.startDate||"";case"endDate":return e.endDate||"";case"updatedAt":return n?n(e):0;default:return""}}function Ec(e,t,a,n=[],o=null){return t?[...e].sort((s,r)=>{let i=tr(s,t,n,o),c=tr(r,t,n,o);return i<c?a==="asc"?-1:1:i>c?a==="asc"?1:-1:0}):e}function ar(e,t=null){if(!e)return{text:null,class:"",showPrefix:!1,hasDate:!1};let a=new Date;a.setHours(0,0,0,0);let n=new Date(e);n.setHours(0,0,0,0);let o=n-a,s=Math.ceil(o/(1e3*60*60*24));return s<0?t==="done"?{text:null,class:"",showPrefix:!0,hasDate:!0,diffDays:s,urgency:"completed"}:{text:null,class:"overdue",showPrefix:!0,hasDate:!0,diffDays:s,daysOverdue:Math.abs(s),urgency:"overdue"}:s===0?{text:null,class:"today",showPrefix:!0,hasDate:!0,diffDays:s,urgency:"today"}:s===1?{text:null,class:"soon",showPrefix:!0,hasDate:!0,diffDays:s,urgency:"tomorrow"}:s<=7?{text:null,class:"soon",showPrefix:!0,hasDate:!0,diffDays:s,urgency:"soon"}:{text:null,class:"",showPrefix:!0,hasDate:!0,diffDays:s,urgency:"normal"}}function Dc(e,t){let{escapeHtml:a,formatDate:n,getTagColor:o,getProjectColor:s,getPriorityLabel:r,getStatusLabel:i,formatTaskUpdatedDateTime:c,projects:l,noProjectText:u,noDateText:d}=t,f=`status-badge ${e.status}`,m=l.find(b=>b.id===e.projectId),g=m?m.name:u,y=e.startDate?n(e.startDate):d,v=e.endDate?n(e.endDate):d,w=c(e)||"",C=e.priority?r(e.priority):"",T=e.tags&&e.tags.length>0?e.tags.map(b=>`<span style="background-color: ${o(b)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; margin-right: 4px; font-weight: 500;">${a(b.toUpperCase())}</span>`).join(""):"",E=m?`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${s(m.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`:"";return`
        <tr class="task-row${e.status==="done"?" task-row-done":""}" data-action="openTaskDetails" data-param="${e.id}">
            <td>${E}${a(e.title||"")}</td>
            <td><span class="priority-badge priority-${e.priority}">${C}</span></td>
            <td><span class="${f}">${i(e.status).toUpperCase()}</span></td>
            <td>${T||'<span style="color: var(--text-muted); font-size: 12px;">-</span>'}</td>
            <td>${a(g)}</td>
            <td>${y}</td>
            <td>${v}</td>
            <td>${a(w)}</td>
        </tr>
    `}function nr(e,t){return e.map(a=>Dc(a,t)).join("")}function or(e,t={}){let{currentSort:a=null,projects:n=[],updatedCutoff:o=null,getTaskUpdatedTime:s=null}=t,r=e;o!==null&&s&&(r=e.filter(c=>s(c)>=o));let i=Sc(r);return a&&a.column&&(i=Ec(i,a.column,a.direction,n,s)),{tasks:i,count:i.length,totalOriginal:e.length}}function sr(e,t){let a=new Date(e,t,1).getDay();a=(a+6)%7;let n=new Date(e,t+1,0).getDate(),o=new Date(e,t,0).getDate(),s=a+n,r=Math.ceil(s/7)*7,i=r-s;return{firstDayOfWeek:a,daysInMonth:n,daysInPrevMonth:o,totalCells:s,cellsNeeded:r,nextMonthDays:i,totalRows:Math.ceil(r/7)}}function Tc(e,t,a={}){let{today:n=new Date}=a,o=sr(e,t),s=[],r=n.getMonth()===t&&n.getFullYear()===e,i=n.getDate(),c=0;for(let l=o.firstDayOfWeek-1;l>=0;l--){let u=o.daysInPrevMonth-l;s.push({day:u,type:"prev-month",row:Math.floor(c/7),column:c%7,isWeekend:c%7>=5,dateStr:null}),c++}for(let l=1;l<=o.daysInMonth;l++){let u=xc(e,t,l),d=r&&l===i,f=c%7;s.push({day:l,type:"current-month",row:Math.floor(c/7),column:f,isWeekend:f>=5,isToday:d,dateStr:u}),c++}for(let l=1;l<=o.nextMonthDays;l++)s.push({day:l,type:"next-month",row:Math.floor(c/7),column:c%7,isWeekend:c%7>=5,dateStr:null}),c++;return s}function xc(e,t,a){return`${e}-${String(t+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`}function Ic(e,t){if(!t.startDate)return!1;let a=new Date(e),n=new Date(t.startDate),o=t.endDate?new Date(t.endDate):new Date(t.startDate);return a>=n&&a<=o}function jc(e,t,a=null){return t.filter(n=>a&&!a.has(n.id)?!1:Ic(e,n)).length}function Cc(e,t,a={}){let{includeBacklog:n=!1,useStartDate:o=!1}=a;return t.filter(s=>!n&&s.status==="backlog"?!1:!!(s.endDate===e||o&&s.startDate===e))}function rr(e,t,a){let n=t+a,o=e;return n<0?(n=11,o--):n>11&&(n=0,o++),{year:o,month:n}}function Lc(e,t,a=new Date){return a.getMonth()===t&&a.getFullYear()===e}function ir(e,t,a={}){let{tasks:n=[],projects:o=[],filteredProjectIds:s=null,includeBacklog:r=!1,today:i=new Date}=a,c=sr(e,t),u=Tc(e,t,{today:i}).map(d=>{if(d.type!=="current-month")return{...d,taskCount:0,projectCount:0};let f=Cc(d.dateStr,n,{includeBacklog:r}),m=jc(d.dateStr,o,s);return{...d,taskCount:f.length,projectCount:m,hasProjects:m>0}});return{year:e,month:t,grid:c,days:u,isCurrentMonth:Lc(e,t,i),totalRows:c.totalRows}}function Pc(e){return e.map((t,a)=>`<div class="calendar-day-header${a>=5?" weekend":""}">${t}</div>`).join("")}function Ac(e){let{day:t,dateStr:a,type:n,row:o,isToday:s,isWeekend:r,hasProjects:i}=e;return n!=="current-month"?`<div class="calendar-day other-month" data-row="${o}">
            <div class="calendar-day-number">${t}</div>
            <div class="project-spacer" style="height:0px;"></div>
        </div>`:`<div class="calendar-day${s?" today":""}${r?" weekend":""}" data-row="${o}" data-action="showDayTasks" data-param="${a}" data-has-project="${i}">
        <div class="calendar-day-number">${t}</div>
        <div class="project-spacer" style="height:0px;"></div>
        <div class="tasks-container"></div>
    </div>`}function cr(e,t){let{days:a}=e,n=Pc(t);return a.forEach((o,s)=>{let r=Math.floor(s/7),i=s%7>=5;n+=Ac({...o,row:r,isWeekend:i})}),n}function Bc(e,t){let a=e.filter(o=>o.projectId===t),n={total:a.length,backlog:0,todo:0,progress:0,review:0,done:0};return a.forEach(o=>{n.hasOwnProperty(o.status)&&n[o.status]++}),n}function $c(e){return[...e].sort((t,a)=>{let n=oe[t.priority||"low"]||1,o=oe[a.priority||"low"]||1;if(n!==o)return o-n;let s=wa[t.status||"todo"]||4,r=wa[a.status||"todo"]||4;return s-r})}function lr(e,t,a){let{escapeHtml:n,formatDatePretty:o,getProjectColor:s,getProjectStatus:r,getProjectStatusLabel:i,getTagColor:c,getPriorityLabel:l,getStatusLabel:u,getLocale:d,t:f}=a,m=t.filter(O=>O.projectId===e.id),g=Bc(t,e.id),{done:y,progress:v,review:w,todo:C,backlog:T,total:E}=g,D=E>0?y/E*100:0,b=E>0?Math.round(y/E*100):0,S=s(e.id),x=r(e.id),$=$c(m),z=$.length>0?$.map(O=>{let k=O.priority||"low",A=O.startDate&&O.startDate!=="",V=O.endDate&&O.endDate!=="",G="";return A&&V?G=`<span class="date-badge">${o(O.startDate,d())}</span><span class="date-arrow">\u2192</span><span class="date-badge">${o(O.endDate,d())}</span>`:V?G=`<span class="date-badge">${o(O.endDate,d())}</span>`:A&&(G=`<span class="date-badge">${o(O.startDate,d())}</span>`),`
                <div class="expanded-task-item" data-action="openTaskDetails" data-param="${O.id}" data-stop-propagation="true">
                    <div class="expanded-task-info">
                        <div class="expanded-task-name">${n(O.title)}</div>
                        ${G||O.tags&&O.tags.length>0?`
                            <div class="expanded-task-meta">
                                ${O.tags&&O.tags.length>0?`
                                    <div class="task-tags">
                                        ${O.tags.map(Y=>`<span style="background-color: ${c(Y)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${n(Y.toUpperCase())}</span>`).join(" ")}
                                    </div>
                                `:""}
                                ${G?`<div class="expanded-task-dates">${G}</div>`:""}
                            </div>
                        `:""}
                    </div>
                    <div class="expanded-task-priority">
                        <div class="priority-chip priority-${k}">${l(k)}</div>
                    </div>
                    <div class="expanded-task-status-col">
                        <div class="expanded-task-status ${O.status}">${u(O.status)}</div>
                    </div>
                </div>
            `}).join(""):`<div class="no-tasks-message">${f("tasks.noTasksInProject")}</div>`;return`
        <div class="project-list-item" id="project-item-${e.id}">
            <div class="project-row" data-action="toggleProjectExpand" data-param="${e.id}">
                <div class="project-chevron">\u25B8</div>
                <div class="project-info">
                    <div class="project-swatch" style="background: ${S};"></div>
                    <div class="project-name-desc">
                        <div class="project-title project-title-link" data-action="showProjectDetails" data-param="${e.id}" data-stop-propagation="true">${n(e.name||f("projects.untitled"))}</div>
                        ${e.tags&&e.tags.length>0?`
                            <div class="project-tags-row">
                                ${e.tags.map(O=>`<span class="project-tag" style="background-color: ${s(e.id)};">${n(O.toUpperCase())}</span>`).join("")}
                            </div>
                        `:""}
                        <div class="project-description">${n(e.description||f("projects.noDescription"))}</div>
                    </div>
                </div>
                <div class="project-status-col">
                    <span class="project-status-badge ${x}">${i(x).toUpperCase()}</span>
                </div>
                <div class="project-progress-col">
                    <div class="progress-bar-wrapper">
                        <div class="progress-segment done" style="width: ${D}%;"></div>
                    </div>
                    <div class="progress-percent">${b}%</div>
                </div>
                <div class="project-tasks-col">
                    <span class="project-tasks-breakdown">${f("projects.tasksBreakdown",{total:E,done:y})}</span>
                </div>
                <div class="project-dates-col">
                    <span class="date-badge">${o(e.startDate,d())}</span>
                    <span class="date-arrow">\u2192</span>
                    <span class="date-badge">${o(e.endDate,d())}</span>
                </div>
            </div>
            <div class="project-tasks-expanded">
                <div class="expanded-tasks-container">
                    <div class="expanded-tasks-header">
                        <span>\u{1F4CB} ${f("projects.details.tasksTitle",{count:E})}</span>
                        <button class="add-btn expanded-add-task-btn" type="button" data-action="openTaskModalForProject" data-param="${e.id}" data-stop-propagation="true">${f("tasks.addButton")}</button>
                    </div>
                    ${z}
                </div>
            </div>
        </div>
    `}function dr(e,t={}){let{startDateWasEverSet:a=!1,endDateWasEverSet:n=!1}=t,o=Array.isArray(e?.tags)&&e.tags.length>0,s=typeof e?.startDate=="string"&&e.startDate.trim()!=="",r=typeof e?.endDate=="string"&&e.endDate.trim()!=="",i=Array.isArray(e?.attachments)&&e.attachments.some(f=>f.type==="link"||f.url&&f.type!=="file");return{hasTags:o,hasStartDate:s,hasEndDate:r,hasLinks:i,startDateInGeneral:a||s,endDateInGeneral:n||r,tagsInGeneral:o,linksInGeneral:i}}function ur(e){return e.hasTags&&e.hasLinks}function Nc(e,t){let{isMobile:a=!1,getTagColor:n,escapeHtml:o}=t,s=a?"3px 6px":"4px 8px",r=a?"11px":"12px",i="4px",c=a?"12px":"14px",l=a?"1.2":"1.4";return`
        <span class="task-tag" style="background-color: ${n(e)}; color: white; padding: ${s}; border-radius: 4px; font-size: ${r}; display: inline-flex; align-items: center; gap: ${i}; line-height: ${l};">
            ${o(e.toUpperCase())}
            <button type="button" data-action="removeTag" data-param="${o(e)}" style="background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${c}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;">\xD7</button>
        </span>
    `}function pr(e,t){let{noTagsText:a="No tags"}=t;return!e||e.length===0?`<span style="color: var(--text-muted); font-size: 13px;">${a}</span>`:e.map(n=>Nc(n,t)).join("")}function mr(e){document.addEventListener("click",t=>{let a=t.target.closest("[data-action]");if(!a)return;let n=a.dataset.action,o=a.dataset.param,s=a.dataset.param2,r={toggleTheme:()=>e.toggleTheme(),showCalendarView:()=>e.showCalendarView(),toggleKanbanSettings:()=>e.toggleKanbanSettings(t),openProjectModal:()=>e.openProjectModal(),openTaskModal:()=>e.openTaskModal(),openSettingsModal:()=>{e.closeUserDropdown(),e.openSettingsModal()},openTaskModalForProject:()=>e.openTaskModalForProject(parseInt(o)),openSelectedProjectFromTask:()=>e.openSelectedProjectFromTask(),closeModal:()=>e.closeModal(o),closeTaskModal:()=>e.closeTaskModal(),closeConfirmModal:()=>e.closeConfirmModal(),closeFeedbackDeleteModal:()=>e.closeFeedbackDeleteModal(),closeProjectConfirmModal:()=>e.closeProjectConfirmModal(),closeUnsavedChangesModal:()=>e.closeUnsavedChangesModal(),closeDayItemsModal:()=>e.closeDayItemsModal(),closeDayItemsModalOnBackdrop:()=>e.closeDayItemsModalOnBackdrop(t),openTaskDetails:()=>{a.dataset.stopPropagation&&t.stopPropagation();let i=parseInt(o),c=a.closest("#project-tasks-list");if(c){let u=document.getElementById("project-details");if(u&&u.classList.contains("active")){let f=Array.from(c.querySelectorAll(".project-task-item[data-param]")).map(g=>parseInt(g.dataset.param)),m=f.indexOf(i);if(m!==-1&&f.length>1){let y=window.location.hash.match(/project-(\d+)/),w={projectId:y?parseInt(y[1]):null,taskIds:f,currentIndex:m};e.openTaskDetails(i,w);return}}}let l=a.closest(".expanded-task-item");if(l){let u=l.closest(".project-card-mobile"),d=null;if(u)d=parseInt(u.dataset.projectId);else{let f=l.closest(".project-list-item");if(f&&f.id){let m=f.id.match(/project-item-(\d+)/);m&&(d=parseInt(m[1]))}}if(d){let f=l.closest(".expanded-tasks-container");if(f){let g=Array.from(f.querySelectorAll(".expanded-task-item[data-param]")).map(v=>parseInt(v.dataset.param)),y=g.indexOf(i);if(y!==-1&&g.length>1){let v={projectId:d,taskIds:g,currentIndex:y};e.openTaskDetails(i,v);return}}}}e.openTaskDetails(i)},deleteTask:()=>e.deleteTask(),duplicateTask:()=>e.duplicateTask(),confirmDelete:()=>e.confirmDelete(),showProjectDetails:()=>{a.dataset.stopPropagation&&t.stopPropagation();let c=document.getElementById("dashboard").classList.contains("active")?"dashboard":"projects";e.showProjectDetails(parseInt(o),c)},toggleProjectExpand:()=>e.toggleProjectExpand(parseInt(o)),toggleProjectMenu:()=>e.toggleProjectMenu(t),editProjectTitle:()=>e.editProjectTitle(parseInt(o),s),saveProjectTitle:()=>e.saveProjectTitle(parseInt(o)),cancelProjectTitle:()=>e.cancelProjectTitle(),handleDeleteProject:()=>e.handleDeleteProject(parseInt(o)),handleDuplicateProject:()=>e.handleDuplicateProject(parseInt(o)),toggleProjectColorPicker:()=>e.toggleProjectColorPicker(parseInt(o)),updateProjectColor:()=>e.updateProjectColor(parseInt(o),s),openCustomProjectColorPicker:()=>e.openCustomProjectColorPicker(parseInt(o)),navigateToProjectStatus:()=>e.navigateToProjectStatus(parseInt(o),s),deleteProject:()=>e.deleteProject(),confirmProjectDelete:()=>e.confirmProjectDelete(),closeDuplicateProjectModal:()=>e.closeDuplicateProjectModal(),confirmDuplicateProject:()=>e.confirmDuplicateProject(),addFeedbackItem:()=>e.addFeedbackItem(),deleteFeedbackItem:()=>e.deleteFeedbackItem(parseInt(o)),confirmFeedbackDelete:()=>e.confirmFeedbackDelete(),toggleHistoryEntryInline:()=>e.toggleHistoryEntryInline(parseInt(o)),formatTaskText:()=>e.formatTaskText(o),insertTaskHeading:()=>e.insertTaskHeading(o),insertTaskDivider:()=>e.insertTaskDivider(),sortTable:()=>e.sortTable(o),toggleSortMode:()=>e.toggleSortMode(),changeMonth:()=>e.animateCalendarMonthChange(parseInt(o)),goToToday:()=>e.goToToday(),showDayTasks:()=>e.showDayTasks(o),addAttachment:()=>e.addAttachment(),addFileAttachment:()=>e.addFileAttachment(t),addTag:()=>e.addTag(),removeTag:()=>e.removeTag(o),addProjectTag:()=>e.addProjectTag(),removeProjectTag:()=>e.removeProjectTag(o),addProjectDetailsTag:()=>e.addProjectDetailsTag(o),removeProjectDetailsTag:()=>e.removeProjectDetailsTag(o),removeAttachment:()=>{e.removeAttachment(parseInt(o)),t.preventDefault()},openUrlAttachment:()=>{if(o)try{let i=decodeURIComponent(o);window.open(i,"_blank","noopener,noreferrer")}catch(i){console.error("Failed to open URL attachment:",i)}},downloadFileAttachment:()=>e.downloadFileAttachment(o,s,a.dataset.param3),viewFile:()=>e.viewFile(o,s,a.dataset.param3),viewImageLegacy:()=>e.viewImageLegacy(o,s),viewFeedbackScreenshot:()=>{if(o)try{let c=decodeURIComponent(o);e.viewImageLegacy(c,"Feedback Screenshot")}catch(i){console.error("Failed to open feedback screenshot",i),e.showErrorNotification&&e.showErrorNotification(e.t("error.openScreenshotFailed"))}},backToProjects:()=>e.backToProjects(),showAllActivity:()=>e.showAllActivity(),backToDashboard:()=>e.backToDashboard(),backToCalendar:()=>e.backToCalendar(),openUpdatesFromNotification:()=>e.openUpdatesFromNotification(),openDueTodayFromNotification:()=>e.openDueTodayFromNotification(),dismissKanbanTip:()=>e.dismissKanbanTip(),confirmDiscardChanges:()=>e.confirmDiscardChanges(),closeReviewStatusConfirmModal:()=>e.closeReviewStatusConfirmModal(),confirmDisableReviewStatus:()=>e.confirmDisableReviewStatus(),closeCalendarCreateModal:()=>e.closeCalendarCreateModal(),confirmCreateTask:()=>e.confirmCreateTask(),addTaskFromDayItemsModal:()=>e.addTaskFromDayItemsModal(),signOut:()=>e.signOut(),exportDashboardData:()=>e.exportDashboardData(),closeExportDataModal:()=>e.closeExportDataModal(),confirmExportData:()=>e.confirmExportData(),generateReport:()=>e.generateReport(),showStatusInfoModal:()=>{t.stopPropagation(),e.showStatusInfoModal()},stopPropagation:()=>t.stopPropagation(),closeModalOnBackdrop:()=>{t.target===a&&e.closeModal(o)},closeDayItemsAndOpenTask:()=>{e.closeDayItemsModal(),e.openTaskDetails(parseInt(o))},closeDayItemsAndShowProject:()=>{e.closeDayItemsModal(),e.showProjectDetails(parseInt(o),"calendar",{month:e.getCurrentMonth(),year:e.getCurrentYear()})},deleteFeedbackItemWithStop:()=>{e.deleteFeedbackItem(parseInt(o)),t.stopPropagation()}};r[n]?r[n]():console.warn(`No handler found for action: ${n}`)})}var te={projects:null,tasks:null,feedbackItems:null,feedbackIndex:null,projectCounter:null,taskCounter:null,feedbackCounter:null,projectsSortedView:null,selectedCards:null,lastSelectedCardId:null,projectToDelete:null,tempAttachments:null,projectNavigationReferrer:null,calendarNavigationState:null,previousPage:null,currentFeedbackScreenshotData:null,feedbackPendingPage:null,feedbackDonePage:null,settings:null};var Yc=typeof performance<"u"?performance.now():Date.now(),Kc="2.7.1",Jc=`v${Kc}`;function Zc(){Object.entries({projects:()=>N,tasks:()=>L,feedbackItems:()=>re,feedbackIndex:()=>We,projectCounter:()=>st,taskCounter:()=>Ge,feedbackCounter:()=>Kt,projectsSortedView:()=>yn,selectedCards:()=>vn,lastSelectedCardId:()=>bn,projectToDelete:()=>qt,tempAttachments:()=>je,projectNavigationReferrer:()=>Pe,calendarNavigationState:()=>ft,previousPage:()=>nt,currentFeedbackScreenshotData:()=>Jt,feedbackPendingPage:()=>St,feedbackDonePage:()=>Et,settings:()=>M}).forEach(([t,a])=>{Object.defineProperty(te,t,{get:a,set:n=>{switch(t){case"projects":N=n;break;case"tasks":L=n;break;case"feedbackItems":re=n;break;case"feedbackIndex":We=n;break;case"projectCounter":st=n;break;case"taskCounter":Ge=n;break;case"feedbackCounter":Kt=n;break;case"projectsSortedView":yn=n;break;case"selectedCards":vn=n;break;case"lastSelectedCardId":bn=n;break;case"projectToDelete":qt=n;break;case"tempAttachments":je=n;break;case"projectNavigationReferrer":Pe=n;break;case"calendarNavigationState":ft=n;break;case"previousPage":nt=n;break;case"currentFeedbackScreenshotData":Jt=n;break;case"feedbackPendingPage":St=n;break;case"feedbackDonePage":Et=n;break;case"settings":M=n;break}},configurable:!0,enumerable:!0})})}Zc();function uo(){te.selectedCards.clear(),te.lastSelectedCardId=null,document.querySelectorAll(".task-card.selected").forEach(e=>{e.classList.remove("selected")})}var Xc=["en","es"];function Mo(e){return Xc.includes(e)?e:"en"}function Nt(){return Mo(M.language||"en")}function Ct(){let e=Nt();return Gn[e]||Gn.en}function p(e,t){let a=Nt(),o=(Ja[a]||Ja.en)[e]||Ja.en[e]||e;return t?o.replace(/\{(\w+)\}/g,(s,r)=>Object.prototype.hasOwnProperty.call(t,r)?String(t[r]):s):o}function Mr(e=document){e.querySelectorAll("[data-i18n]").forEach(a=>{let n=a.getAttribute("data-i18n");if(!n)return;let o=a.getAttribute("data-i18n-attr");o?o.split(",").map(s=>s.trim()).filter(Boolean).forEach(s=>{a.setAttribute(s,p(n))}):a.textContent=p(n)})}window.i18n={t:p,applyTranslations:Mr,getCurrentLanguage:Nt};function He(e){return{backlog:p("tasks.status.backlog"),todo:p("tasks.status.todo"),progress:p("tasks.status.progress"),review:p("tasks.status.review"),done:p("tasks.status.done")}[e]||Fs[e]||e||""}function Ha(e){return{backlog:p("projects.status.backlog"),planning:p("projects.status.planning"),active:p("projects.status.active"),completed:p("projects.status.completed")}[e]||e||""}function et(e){return{high:p("tasks.priority.high"),medium:p("tasks.priority.medium"),low:p("tasks.priority.low")}[e]||et(e)||e||""}function Fr(){M.language=Nt(),document.documentElement.lang=M.language,Mr(),Cl();let e=document.getElementById("email-notification-timezone"),t=document.getElementById("email-notification-timezone-value");e&&t&&(t.textContent=e.options?.[e.selectedIndex]?.textContent||e.value||"");let a=document.getElementById("user-avatar-dropzone");a&&(a.dataset.defaultText=p("settings.avatarUploadDefault"),a.dataset.changeText=p("settings.avatarUploadChange"));let n=document.getElementById("workspace-logo-dropzone");n&&(n.dataset.defaultText=p("settings.logoUploadDefault"),n.dataset.changeText=p("settings.logoUploadChange"));let o=document.getElementById("attachment-file-dropzone");if(o){let c=window.innerWidth<=768,l=p(c?"tasks.modal.attachmentsDropzoneTap":"tasks.modal.attachmentsDropzoneDefault");o.dataset.defaultText=l;let u=o.querySelector(".task-attachment-dropzone-text");u&&(u.textContent=l)}let s=document.getElementById("feedback-screenshot-url");if(s){let c=typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:window.innerWidth<=768,l=p(c?"feedback.screenshotDropzoneTap":"feedback.screenshotDropzoneDefault");s.dataset.defaultText=l,s.dataset.hasInlineImage||(s.textContent=l)}Xo(),la(),document.dispatchEvent(new CustomEvent("refresh-workspace-logo-ui")),ri();try{Dt()}catch{}try{za()}catch{}try{Hn()}catch{}try{Yi()}catch{}ii(),_o(),Fn(),Mt(),li();try{Ul()}catch{}let r=document.querySelector(".filter-chip.active")?.dataset?.period||"week";oi(r);let i=document.getElementById("activity-page");i&&i.classList.contains("active")&&ci();try{document.getElementById("projects")?.classList.contains("active")&&_e(),document.getElementById("tasks")?.classList.contains("active")&&(Me(),document.getElementById("list-view")?.classList.contains("active")&&rt()),document.getElementById("calendar")?.classList.contains("active")&&ie(),document.getElementById("feedback")?.classList.contains("active")&&(jt(),gt())}catch{}}var Ze={hasPendingChange:!1,dataUrl:null},Xe={hasPendingChange:!1,dataUrl:null},F={originalImage:null,originalDataUrl:null,canvas:null,ctx:null,selection:{x:0,y:0,size:0},isDragging:!1,isResizing:!1,dragStartX:0,dragStartY:0,activeHandle:null,shape:"square",outputMimeType:"image/jpeg",outputMaxSize:null,onApply:null,successMessage:null},po=null,Qc=typeof performance<"u"?performance.now():Date.now(),el=typeof window<"u"&&typeof window.__pageLoadStart=="number"?window.__pageLoadStart:Yc;Ve("app-js-executed",{sinceNavStartMs:Math.round(Qc-el)});var N=[],L=[],re=[],We=[],st=1,Ge=1,Kt=1,yn=null,vn=new Set,bn=null,qt=null,je=[],Pe="projects",ft=null,nt="",Jt="",St=1,Et=1,mt=10,Rr="feedbackItemsCache:v1",M={autoSetStartDateOnStatusChange:!1,autoSetEndDateOnStatusChange:!1,enableReviewStatus:!0,calendarIncludeBacklog:!1,debugLogsEnabled:!1,historySortOrder:"newest",language:"en",customWorkspaceLogo:null,notificationEmail:"",emailNotificationsEnabled:!0,emailNotificationsWeekdaysOnly:!1,emailNotificationsIncludeStartDates:!1,emailNotificationsIncludeBacklog:!1,emailNotificationTime:"09:00",emailNotificationTimeZone:"Atlantic/Canary"};["projects","tasks","feedbackItems","feedbackIndex","projectCounter","taskCounter","feedbackCounter","projectsSortedView","selectedCards","lastSelectedCardId","projectToDelete","tempAttachments","projectNavigationReferrer","calendarNavigationState","previousPage","currentFeedbackScreenshotData","feedbackPendingPage","feedbackDonePage","settings"].forEach(e=>{Object.defineProperty(te,e,{get:()=>{switch(e){case"projects":return N;case"tasks":return L;case"feedbackItems":return re;case"feedbackIndex":return We;case"projectCounter":return st;case"taskCounter":return Ge;case"feedbackCounter":return Kt;case"projectsSortedView":return yn;case"selectedCards":return vn;case"lastSelectedCardId":return bn;case"projectToDelete":return qt;case"tempAttachments":return je;case"projectNavigationReferrer":return Pe;case"calendarNavigationState":return ft;case"previousPage":return nt;case"currentFeedbackScreenshotData":return Jt;case"feedbackPendingPage":return St;case"feedbackDonePage":return Et;case"settings":return M}},set:t=>{switch(e){case"projects":N=t;break;case"tasks":L=t;break;case"feedbackItems":re=t;break;case"feedbackIndex":We=t;break;case"projectCounter":st=t;break;case"taskCounter":Ge=t;break;case"feedbackCounter":Kt=t;break;case"projectsSortedView":yn=t;break;case"selectedCards":vn=t;break;case"lastSelectedCardId":bn=t;break;case"projectToDelete":qt=t;break;case"tempAttachments":je=t;break;case"projectNavigationReferrer":Pe=t;break;case"calendarNavigationState":ft=t;break;case"previousPage":nt=t;break;case"currentFeedbackScreenshotData":Jt=t;break;case"feedbackPendingPage":St=t;break;case"feedbackDonePage":Et=t;break;case"settings":M=t;break}},configurable:!0,enumerable:!0})});window.saveData=ct;window.loadData=tt;var Aa=!1,Tt=0,ja=new Map;function kr(e,t,a,n){let o=n||{},s=Number.isFinite(o.delayMs)?o.delayMs:500,r=`${e}:${t}`,i=ja.get(r);i&&clearTimeout(i);let c=setTimeout(()=>{ja.delete(r),Zt(e,t,a,o)},s);ja.set(r,c)}function wr(e,t,a,n){let o=`${e}:${t}`,s=ja.get(o);s&&(clearTimeout(s),ja.delete(o)),Zt(e,t,a,n||{})}var Or="nautilusLastSeenReleaseId";var qr="nautilusNotificationHistory",tl=30,al=3e4,Fo="nautilusNotificationPendingSeen",ga=!0,Ie={timestamp:0,data:null},mo=!1;function Sr(e){if(!e)return 0;let t=Ye(e)?dt(e):e,a=Date.parse(t);return Number.isNaN(a)?0:a}function Ta(e){if(!e)return"";if(typeof e=="string")return e;if(typeof e=="object"){let t=Ct(),a=t&&t.startsWith("es")?"es":"en";return e[a]||e.en||e.es||""}return String(e)}function zr(){return(Array.isArray(to)?[...to]:[]).sort((t,a)=>Sr(a.date)-Sr(t.date))}function Ro(){return zr()[0]||null}function nl(){try{return localStorage.getItem(Or)||""}catch{return""}}function Hr(e){if(e)try{localStorage.setItem(Or,e)}catch{}}function Er(e){return e?nn(e,Ct()):""}function oa(e){return e?at(e)?e:Ye(e)?dt(e):"":""}function ha(){try{let e=localStorage.getItem(qr);if(!e)return{notifications:[],lastChecked:null};let t=JSON.parse(e);return{notifications:Array.isArray(t.notifications)?t.notifications:[],lastChecked:t.lastChecked||null}}catch{return{notifications:[],lastChecked:null}}}function Ua(e){try{localStorage.setItem(qr,JSON.stringify(e))}catch{}}function cn(e,t,a){return`notif_${a}_${e}_${t}`}function ol(){if(!Array.isArray(L)||L.length===0)return;let e=ke("notifications","create-due-today",{taskCount:L.length}),t=new Date().toISOString().split("T")[0],a=ha(),n=new Set(a.notifications.map(c=>c.id)),o=[],s=M.emailNotificationsIncludeStartDates!==!1,r=!!M.emailNotificationsIncludeBacklog;L.forEach(c=>{if(!c||c.status==="done"||!c.id||c.status==="backlog"&&!r)return;let l=oa(c.startDate||""),u=oa(c.endDate||"");if(s&&l===t){let d=cn("task_starting",c.id,t);n.has(d)||o.push({id:d,type:"task_starting",taskId:c.id,date:t,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}if(u===t){let d=cn("task_due",c.id,t);n.has(d)||o.push({id:d,type:"task_due",taskId:c.id,date:t,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}});let i=7;for(let c=1;c<=i;c++){let l=new Date;l.setDate(l.getDate()-c);let u=l.toISOString().split("T")[0];L.forEach(d=>{if(!d||d.status==="done"||!d.id)return;let f=oa(d.startDate||""),m=oa(d.endDate||"");if(s&&f===u){let g=cn("task_starting",d.id,u);n.has(g)||o.push({id:g,type:"task_starting",taskId:d.id,date:u,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}if(m===u){let g=cn("task_due",d.id,u);n.has(g)||o.push({id:g,type:"task_due",taskId:d.id,date:u,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}})}o.length>0&&a.notifications.push(...o),a.lastChecked=new Date().toISOString(),Ua(a),ye("notifications",e,{newCount:o.length,totalCount:a.notifications.length})}function sl(){let e=ha();e.notifications.forEach(t=>{t.dismissed||(t.read=!0)}),Ua(e)}function rl(e){let t=ha();t.notifications.forEach(a=>{a.date===e&&(a.dismissed=!0)}),Ua(t)}function il(){let e=ha();e.notifications.forEach(t=>{t.dismissed=!0}),Ua(e)}function cl(){let e=ke("notifications","cleanup"),t=ha(),a=t.notifications.length,n=new Date;n.setDate(n.getDate()-tl);let o=n.toISOString().split("T")[0];t.notifications=t.notifications.filter(s=>s.date>=o),Ua(t),ye("notifications",e,{beforeCount:a,afterCount:t.notifications.length})}function Ur(){return ha().notifications.filter(t=>!t.dismissed)}function ll(){return Ur().filter(t=>!t.read).length}function dl(){let t=Ur().filter(o=>o.type==="task_due"||o.type==="task_starting"),a=new Map;return t.forEach(o=>{a.has(o.date)||a.set(o.date,[]),a.get(o.date).push(o)}),Array.from(a.entries()).sort((o,s)=>s[0].localeCompare(o[0]))}function ia(){let e=ke("notifications","build-state"),t=Ro(),a=nl(),n=!1,o=dl(),s=ll(),r={latest:t,releaseUnseen:n,taskNotificationsByDate:o,unreadCount:s};return ye("notifications",e,{unreadCount:s,taskGroups:o.length}),r}function Bn(){return window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken")}function _r(){let e=localStorage.getItem(Fo);if(!e)return null;try{let t=JSON.parse(e);return!t||!t.seenAt?null:t}catch{return null}}function Ca(e){!e||!e.seenAt||localStorage.setItem(Fo,JSON.stringify(e))}function fo(e,t=!1){let a=_r();if(!a){Ca({seenAt:e,clearAll:!!t});return}let n=new Date(a.seenAt).getTime(),o=new Date(e).getTime(),s={seenAt:Number.isFinite(n)&&Number.isFinite(o)&&n>o?a.seenAt:e,clearAll:!!(a.clearAll||t)};Ca(s)}async function ul(){if(!ga||mo)return;let e=_r();if(!e)return;let t=Bn();if(t){mo=!0;try{let a={seenAt:e.seenAt,clearAll:!!e.clearAll};e.dismissDate&&(a.dismissDate=e.dismissDate),(await fetch("/api/notifications/state",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(a)})).ok&&localStorage.removeItem(Fo)}catch(a){console.warn("[notifications] failed to flush pending seen",a)}finally{mo=!1}}}async function kn({force:e=!1}={}){if(ga){await ul();let t=Date.now();if(!e&&Ie.data&&t-Ie.timestamp<al)return Ie.data;let a=Bn();if(a)try{let n=await fetch("/api/notifications/state",{headers:{Authorization:`Bearer ${a}`}});if(n.ok){let o=await n.json(),i={latest:Ro(),releaseUnseen:!1,taskNotificationsByDate:Array.isArray(o.taskNotificationsByDate)?o.taskNotificationsByDate:[],unreadCount:Number(o.unreadCount)||0};return Ie={timestamp:t,data:i},i}}catch(n){console.warn("[notifications] failed to fetch server state",n)}}return ia()}function ca(e=ia()){let t=document.getElementById("notification-count");if(!t)return;let n=(e.releaseUnseen&&e.latest?1:0)+e.unreadCount;n>0?(t.textContent=n>99?"99+":String(n),t.classList.add("is-visible")):(t.textContent="",t.classList.remove("is-visible"))}function pl(e){let t=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()-1);let n=a.toISOString().split("T")[0];return e===t?p("notifications.today")||"Today":e===n?p("notifications.yesterday")||"Yesterday":nn(e,Ct())}function Ba(e=ia()){let t=document.getElementById("notification-list");if(!t)return;let a=ke("notifications","render-dropdown",{taskGroups:e.taskNotificationsByDate.length,unreadCount:e.unreadCount}),n=[],o=new Map(N.map(i=>[i.id,i])),s=new Map(L.map(i=>[i.id,i])),r=!!M.emailNotificationsIncludeBacklog;e.taskNotificationsByDate.forEach(([i,c])=>{let l=pl(i),u=c.filter(D=>D.type==="task_starting").map(D=>s.get(D.taskId)).filter(D=>D&&D.status!=="done"&&(r||D.status!=="backlog")).filter(D=>oa(D.startDate||"")===i),d=c.filter(D=>D.type==="task_due").map(D=>s.get(D.taskId)).filter(D=>D&&D.status!=="done"&&(r||D.status!=="backlog")).filter(D=>oa(D.endDate||"")===i);if(u.length===0&&d.length===0)return;let f=D=>[...D].sort((b,S)=>{let x=oe[b.priority||"low"]||0,$=oe[S.priority||"low"]||0;return x!==$?$-x:String(b.title||"").localeCompare(String(S.title||""))}),m=f(u),g=f(d),y=D=>D.slice(0,3).map(b=>{let S=b.projectId?o.get(b.projectId):null,x=S?S.name:"",$=S?Te(S.id):"",z=(b.priority||"low").toLowerCase(),O=["high","medium","low"].includes(z)?et(z):z||"";return`
                    <div class="notify-task" data-task-id="${b.id}">
                        <div class="notify-task-header">
                            <div class="notify-task-title">${U(b.title||p("tasks.untitled"))}</div>
                            <span class="notify-priority notify-priority--${z}">${U(O)}</span>
                        </div>
                    </div>
                `}).join(""),v="",w=0,C=0;if(m.length>0){let D=m.slice(0,3),b=Math.max(m.length-D.length,0);w+=m.length,C+=b,v+=`<div class="notify-section-subheader notify-section-subheader--starting">\u{1F680} STARTING <span class="notify-section-count notify-section-count--starting" aria-label="${m.length} starting tasks">${m.length}</span></div>`,v+=y(D),b>0&&(v+=`<div class="notify-task-overflow">+${b} more starting</div>`,v+=`<button type="button" class="notify-link notify-link--starting notify-link--full" data-action="openDueTodayFromNotification" data-date="${i}" data-date-field="startDate">View ${m.length} starting</button>`)}if(g.length>0){let D=g.slice(0,3),b=Math.max(g.length-D.length,0);w+=g.length,C+=b,m.length>0&&(v+='<div style="height: 1px; background: var(--border); margin: 10px 0;"></div>'),v+=`<div class="notify-section-subheader notify-section-subheader--due">\u{1F3AF} DUE <span class="notify-section-count notify-section-count--due" aria-label="${g.length} due tasks">${g.length}</span></div>`,v+=y(D),b>0&&(v+=`<div class="notify-task-overflow">+${b} more due</div>`,v+=`<button type="button" class="notify-link notify-link--due notify-link--full" data-action="openDueTodayFromNotification" data-date="${i}" data-date-field="endDate">View ${g.length} due</button>`)}let T=new Date().toISOString().split("T")[0],E=i===T;n.push(`
            <div class="notify-section notify-section--due" data-date="${i}">
                <div class="notify-section-heading">
                    <div class="notify-section-title">
                        <span class="notify-section-title-text">${l}</span>
                        ${E?"":`<div class="notify-section-title-actions"><button type="button" class="notify-dismiss-btn" data-action="dismissDate" data-date="${i}" aria-label="Dismiss" title="Dismiss">x</button></div>`}
                    </div>
                </div>
                <div class="notify-task-list">
                    ${v}
                </div>
            </div>
        `)}),n.length===0&&n.push(`<div class="notify-empty">${p("notifications.empty")}</div>`),t.innerHTML=n.join(""),ye("notifications",a,{sections:n.length,taskGroups:e.taskNotificationsByDate.length})}var ln=null;function Mt({force:e=!1}={}){ln&&clearTimeout(ln),ln=setTimeout(async()=>{let t=await kn({force:e});ca(t);let a=document.getElementById("notification-dropdown");a&&a.classList.contains("active")&&Ba(t),ln=null},100)}async function Do(e=null,{clearAll:t=!1}={}){if(e&&e.latest&&e.latest.id&&Hr(e.latest.id),ga){let n=new Date().toISOString(),o=Bn();if(!o){fo(n,t);let r={...e||Ie.data||ia(),unreadCount:0};Ie={timestamp:Date.now(),data:r},ca(r);return}if(o)try{if((await fetch("/api/notifications/state",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({seenAt:n,clearAll:!!t})})).ok){let i={...e||Ie.data||ia(),unreadCount:0};Ie={timestamp:Date.now(),data:i},ca(i);return}fo(n,t)}catch(s){console.warn("[notifications] failed to mark seen",s),fo(new Date().toISOString(),t)}}sl();let a=ia();ca(a)}async function ml(e){if(ga){let t=new Date().toISOString(),a=Bn();if(!a){if(Ca({seenAt:t,dismissDate:e}),Ie.data&&Ie.data.taskNotificationsByDate){let n={...Ie.data,taskNotificationsByDate:Ie.data.taskNotificationsByDate.filter(([o])=>o!==e)};Ie={timestamp:Date.now(),data:n},ca(n),Ba(n)}return}try{if((await fetch("/api/notifications/state",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({seenAt:t,dismissDate:e})})).ok){if(Ie.data&&Ie.data.taskNotificationsByDate){let o={...Ie.data,taskNotificationsByDate:Ie.data.taskNotificationsByDate.filter(([s])=>s!==e)};Ie={timestamp:Date.now(),data:o},ca(o),Ba(o)}return}Ca({seenAt:t,dismissDate:e})}catch(n){console.warn("[notifications] failed to dismiss date",n),Ca({seenAt:t,dismissDate:e})}}else rl(e),Mt()}function fl(){let e=Ro();!e||!e.id||(Hr(e.id),Mt())}function Ft(){let e=document.getElementById("notification-dropdown"),t=document.getElementById("notification-toggle");e&&e.classList.remove("active"),t&&t.classList.remove("active"),Vr(!1)}function Vr(e){typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 768px)").matches&&document.body.classList.toggle("notify-scroll-lock",!!e)}function gl(){let e=document.getElementById("notification-toggle"),t=document.getElementById("notification-dropdown");!e||!t||e.dataset.bound||(e.dataset.bound="true",e.addEventListener("click",async a=>{if(a.stopPropagation(),t.classList.contains("active")){Ft();return}Ga();let o=await kn({force:!0});Ba(o),t.classList.add("active"),e.classList.add("active"),Vr(!0),await Do(o)}),t.dataset.outsideListener||(t.dataset.outsideListener="true",document.addEventListener("click",a=>{if(!t.classList.contains("active"))return;let n=a.target;n&&(t.contains(n)||e.contains(n)||Ft())})),t.dataset.actionListener||(t.dataset.actionListener="true",t.addEventListener("click",async a=>{let n=a.target;if(!n)return;let o=n.closest(".notify-task");if(o&&o.dataset.taskId){a.preventDefault(),a.stopPropagation();let c=parseInt(o.dataset.taskId,10);isNaN(c)||(Ft(),va(c));return}let s=n.closest("[data-action]");if(!s)return;a.preventDefault(),a.stopPropagation();let r=s.dataset.action,i=s.dataset.date;if(r==="dismissDate"&&i)await ml(i);else if(r==="dismissAll")if(ga){let c=Ie.data||await kn({force:!0});await Do(c,{clearAll:!0}),Mt({force:!0})}else il(),Mt();else if(r==="openUpdatesFromNotification")Wr();else if(r==="openDueTodayFromNotification"&&i){let c=s.getAttribute("data-date-field")||"endDate";Gr(i,c)}})),Mt())}function Wr(){if(Ft(),window.location.hash.replace("#","")==="updates"){Re("updates");return}window.location.hash="updates"}function Gr(e,t="endDate"){Ft();let a=new Date().toISOString().split("T")[0],n=e===a,s=!!M.emailNotificationsIncludeBacklog?"backlog,todo,progress,review":"todo,progress,review",r;if(n?r=`#tasks?view=list&datePreset=${t==="startDate"?"start-today":"end-today"}&status=${s}`:r=`#tasks?view=list&dateFrom=${e}&dateTo=${e}&dateField=${t}&status=${s}`,window.location.hash===r){Re("tasks");return}window.location.hash=r.replace("#","")}var ze="priority",me={};function hl(){ze="priority",me={};let e=document.getElementById("sort-btn"),t=document.getElementById("sort-label"),a=document.getElementById("sort-icon");e&&e.classList.remove("manual"),t&&(t.textContent=p("tasks.sort.orderByPriority")),a&&(a.textContent="\u2B06\uFE0F"),Me(),xa()}async function xa(){try{await ys(ze,me)}catch{try{localStorage.setItem("sortMode",ze),localStorage.setItem("manualTaskOrder",JSON.stringify(me))}catch{}}}function Dt(){let e=document.getElementById("sort-toggle"),t=document.getElementById("sort-btn"),a=document.getElementById("sort-label"),n=document.getElementById("sort-icon"),o=document.getElementById("group-kanban-updated");if(!e||!t)return;let s=document.querySelector(".kanban-board"),r=s&&!s.classList.contains("hidden");e.style.display=r?"flex":"none";let i=document.getElementById("list-view")?.classList.contains("active"),c=document.getElementById("calendar-view")?.classList.contains("active"),l=r||i||c;o&&(o.style.display=l?"":"none");try{Hn()}catch{}try{t.classList.remove("manual")}catch{}a&&(a.textContent=p("tasks.sort.orderByPriority")),n&&(n.textContent="\u21C5");try{let u=window.kanbanShowBacklog===!0?["backlog","todo","progress","review","done"]:["todo","progress","review","done"],d=typeof yt=="function"?yt():L.slice(),f=ta(window.kanbanUpdatedFilter);f!==null&&(d=d.filter(y=>At(y)>=f));let m=(y,v)=>{if(y.length!==v.length)return!1;for(let w=0;w<y.length;w++)if(y[w]!==v[w])return!1;return!0},g=!0;for(let y of u){let w=Array.from(document.querySelectorAll(`#${y}-tasks .task-card`)).map(T=>parseInt(T.dataset.taskId,10)).filter(T=>!Number.isNaN(T)),C=d.filter(T=>T.status===y).slice().sort((T,E)=>(oe[E.priority]||0)-(oe[T.priority]||0)).map(T=>T.id);if(!m(w,C)){g=!1;break}}g?(t.disabled=!0,t.classList.add("disabled"),t.setAttribute("aria-disabled","true")):(t.disabled=!1,t.classList.remove("disabled"),t.removeAttribute("aria-disabled"))}catch{t.disabled=!1,t.classList.remove("disabled")}}async function Qe(){if(Aa)return;Tt++;let e=ke("storage","save-projects",{projectCount:N.length}),t=!1;try{await gs(N),t=!0}catch(a){throw console.error("Error saving projects:",a),W(p("error.saveProjectsFailed")),a}finally{ye("storage",e,{success:t,projectCount:N.length}),Tt--}}async function qe(){if(Aa)return;Tt++;let e=ke("storage","save-tasks",{taskCount:L.length}),t=!1;try{await fs(L),t=!0}catch(a){throw console.error("Error saving tasks:",a),W(p("error.saveTasksFailed")),a}finally{ye("storage",e,{success:t,taskCount:L.length}),Tt--}}var yl=null,vl=!1;var wn=0,$n=!1,Nn=!1,Oo=!1,gn=null;var Yr="feedbackDeltaQueue",bl=1e3,kl=1200,wl=1e4,dn=3,Sl=2e3,Le=[],hn=!1,go=null,sa=null,un=null,$t=0,To=new Map;function pn(e,t){ut()&&(t?console.log(`[feedback-debug] ${e}`,t):console.log(`[feedback-debug] ${e}`))}function El(e){let t={total:e.length,add:0,update:0,delete:0,maxScreenshotChars:0,totalScreenshotChars:0};for(let a of e)if(!(!a||!a.action)&&(a.action==="add"&&t.add++,a.action==="update"&&t.update++,a.action==="delete"&&t.delete++,a.item&&typeof a.item.screenshotUrl=="string")){let n=a.item.screenshotUrl.length;t.totalScreenshotChars+=n,n>t.maxScreenshotChars&&(t.maxScreenshotChars=n)}return t}function Dl(){try{let e=localStorage.getItem(Yr),t=e?JSON.parse(e):[];Le=Array.isArray(t)?t:[]}catch{Le=[]}}function Sn(){try{localStorage.setItem(Yr,JSON.stringify(Le))}catch{}}function Tl(){sa&&clearTimeout(sa),sa=setTimeout(()=>{Sn(),sa=null},bl)}function xl(){try{localStorage.setItem(Rr,JSON.stringify(re))}catch{}}function _a(){un&&clearTimeout(un),un=setTimeout(()=>{xl(),un=null},kl)}function Il(e){if(!(!e||!e.action)){if(e.action==="add"&&e.item){re.some(a=>a&&a.id===e.item.id)||(re.unshift(e.item),We.includes(e.item.id)||We.unshift(e.item.id));return}if(e.action==="update"&&e.item&&e.item.id!=null){let t=re.findIndex(a=>a&&a.id===e.item.id);t>=0&&(re[t]={...re[t],...e.item});return}e.action==="delete"&&e.targetId!=null&&(re=re.filter(t=>!t||t.id!==e.targetId),We=We.filter(t=>t!==e.targetId)),_a()}}function En(e=300){go||(go=setTimeout(()=>{go=null,Kr()},e))}function qo(e,t={}){if(!e||!e.action)return;let a={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,...e};Le.push(a),Tl(),Ll(),gt(),typeof t.onError=="function"&&To.set(a.id,t.onError),En()}async function Kr(){if(!(hn||Le.length===0)){if(!navigator.onLine){gt();return}hn=!0,Tt++;try{let e=[],t=[...Le];for(let a of t)a.action==="add"&&a.item?e.push({action:"add",item:a.item}):a.action==="update"&&a.item&&a.item.id!=null?e.push({action:"update",item:a.item}):a.action==="delete"&&a.targetId!=null&&e.push({action:"delete",id:a.targetId});if(e.length>0){let a=typeof performance<"u"&&performance.now?performance.now():Date.now(),n={operations:e},o=null;try{o=JSON.stringify(n).length}catch{}pn("flush:start",{queueLength:Le.length,operationCount:e.length,payloadBytes:o,summary:El(e)});let s=await us(e,wl);s&&s.index&&(We=s.index);let r=!!(s&&Array.isArray(s.errors)&&s.errors.length>0);if(s&&s.success&&!r)Le.splice(0,t.length),Sn(),$t=0,Pl();else{if(r){let c=new Set(s.errors.map(u=>u&&u.index).filter(u=>Number.isInteger(u))),l=t.filter((u,d)=>c.has(d));Le=l.length>0?l:t}else Le=t;Sn(),ho()}let i=typeof performance<"u"&&performance.now?performance.now():Date.now();pn("flush:success",{durationMs:Math.round(i-a),processed:s&&s.processed,total:s&&s.total,success:s&&s.success,indexSize:Array.isArray(s&&s.index)?s.index.length:null,errors:s&&Array.isArray(s.errors)?s.errors.length:0})}}catch(e){if(console.error("Feedback flush error:",e),pn("flush:error",{message:e&&e.message?e.message:String(e),name:e&&e.name?e.name:null,retryCount:$t+1,queueLength:Le.length}),$t++,$t>=dn)console.error(`Feedback save failed after ${dn} attempts. Queue will be kept for later.`),ho(),$t=0;else{let a=Sl*Math.pow(2,$t-1);console.log(`Feedback save failed. Retrying in ${a}ms (attempt ${$t}/${dn})`),ho(),pn("flush:retry-scheduled",{retryDelayMs:a,attempt:$t,maxAttempts:dn}),setTimeout(()=>{Kr()},a)}let t=Le[0];if(t){let a=To.get(t.id);if(a){try{a(e)}catch{}To.delete(t.id)}}}finally{hn=!1,Tt=Math.max(0,Tt-1),gt()}}}function zo(){gn!==null&&(clearTimeout(gn),gn=null)}function jl(){zo(),gn=setTimeout(()=>{let e=document.getElementById("feedback-save-status");if(!e)return;e.classList.add("is-hidden"),Oo=!1;let t=e.querySelector(".feedback-save-text");t&&(t.textContent="")},1600)}function gt(){let e=document.getElementById("feedback-save-status");if(!e)return;let t=e.querySelector(".feedback-save-text")||e,a="saved";($n||Le.length>0)&&(navigator.onLine?hn||Le.length>0||vl||yl!==null?a="saving":Nn?a="error":a="saving":a="offline");let n={saved:"feedback.saveStatus.saved",saving:"feedback.saveStatus.saving",error:"feedback.saveStatus.error",offline:"feedback.saveStatus.offline"}[a];t.textContent=p(n);let o=a!=="saved"||Oo;e.classList.toggle("is-hidden",!o),e.classList.toggle("is-saving",a==="saving"),e.classList.toggle("is-error",a==="error"),e.classList.toggle("is-offline",a==="offline"),e.classList.toggle("is-saved",a==="saved")}function Cl(){let e=document.getElementById("feedback-description");if(!e)return;let a=window.matchMedia("(max-width: 768px)").matches?"feedback.descriptionPlaceholderShort":"feedback.descriptionPlaceholder";e.setAttribute("placeholder",p(a))}function Ll(){$n=!0,Nn=!1,zo(),gt()}function Pl(){$n=!1,Nn=!1,Oo=!0,gt(),jl()}function ho(){$n=!0,Nn=!0,zo(),gt()}async function Al(){if(!Aa)try{await hs(wt)}catch(e){console.error("Error saving project colors:",e),W(p("error.saveProjectColorsFailed"))}}async function Ho(){let e=ke("settings","save"),t=!1;try{await Ts(M),t=!0}catch(a){console.error("Error saving settings:",a)}finally{ye("settings",e,{success:t})}window.initialSettingsFormState=null,window.settingsFormIsDirty=!1}var Ee=null,Rt=null,ve=null,Ot=null;function Bl(e){let o=String(e||""),s=[];for(let r=480;r<=1080;r+=30){let i=Us(r),c=i===o?" selected":"";s.push(`<div class="time-option${c}" role="option" data-value="${i}">${i}</div>`)}return s.join("")}function $l(e){if(!e||!e.options)return"";let t=String(e.value||""),a=[];return Array.from(e.options).forEach(n=>{let o=String(n.value||""),s=String(n.textContent||o),r=o===t?" selected":"";a.push(`<div class="tz-option${r}" role="option" data-value="${U(o)}">${U(s)}</div>`)}),a.join("")}function Nl(e,t,a){if(!e||!t)return;ve||(ve=document.createElement("div"),ve.className="tz-options-portal",document.body.appendChild(ve)),ve.innerHTML=$l(t),ve.style.display="block",Ot=e,xo(e,ve),requestAnimationFrame(()=>xo(e,ve)),e.setAttribute("aria-expanded","true");let n=o=>{o.stopPropagation();let s=o.target.closest(".tz-option");if(!s)return;let r=s.dataset.value;if(r){if(t.value=r,a){let i=t.options?.[t.selectedIndex]?.textContent||r;a.textContent=i}t.dispatchEvent(new Event("change",{bubbles:!0})),da()}};ve.onclick=n,setTimeout(()=>document.addEventListener("click",Jr,!0),0),window.addEventListener("scroll",Dn,!0),window.addEventListener("resize",Dn,!0),document.addEventListener("keydown",Zr,!0)}function da(){ve&&(ve.style.display="none",ve.innerHTML="",ve.onclick=null,Ot&&Ot.setAttribute("aria-expanded","false"),Ot=null,document.removeEventListener("click",Jr,!0),window.removeEventListener("scroll",Dn,!0),window.removeEventListener("resize",Dn,!0),document.removeEventListener("keydown",Zr,!0))}function Jr(e){let t=e.target;!ve||ve.style.display==="none"||ve.contains(t)||Ot&&Ot.contains(t)||da()}function Dn(){!Ot||!ve||ve.style.display==="none"||xo(Ot,ve)}function Zr(e){e.key==="Escape"&&(!ve||ve.style.display==="none"||(e.preventDefault(),da()))}function xo(e,t){let a=e.getBoundingClientRect();t.style.width=`${a.width}px`;let n=window.innerHeight,o=Math.min(t.scrollHeight,240),i=n-a.bottom<o+12?Math.max(8,a.top-o-4):a.bottom+4,c=window.innerWidth,l=t.getBoundingClientRect().width||a.width,u=a.left,d=Math.min(Math.max(8,u),Math.max(8,c-l-8));t.style.left=`${d}px`,t.style.top=`${i}px`}function Ml(e,t,a){if(!e||!t)return;Ee||(Ee=document.createElement("div"),Ee.className="time-options-portal",document.body.appendChild(Ee));let n=String(t.value||"").trim();Ee.innerHTML=Bl(n),Ee.style.display="block",Rt=e,Io(e,Ee),requestAnimationFrame(()=>Io(e,Ee)),e.setAttribute("aria-expanded","true");let o=s=>{s.stopPropagation();let r=s.target.closest(".time-option");if(!r)return;let i=r.dataset.value;i&&(t.value=i,a&&(a.textContent=i),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded(),ua())};Ee.addEventListener("click",o),setTimeout(()=>document.addEventListener("click",Xr,!0),0),window.addEventListener("scroll",Tn,!0),window.addEventListener("resize",Tn,!0),document.addEventListener("keydown",Qr,!0)}function ua(){Ee&&(Ee.style.display="none",Ee.innerHTML="",Rt&&Rt.setAttribute("aria-expanded","false"),Rt=null,document.removeEventListener("click",Xr,!0),window.removeEventListener("scroll",Tn,!0),window.removeEventListener("resize",Tn,!0),document.removeEventListener("keydown",Qr,!0))}function Xr(e){let t=e.target;!Ee||Ee.style.display==="none"||Ee.contains(t)||Rt&&Rt.contains(t)||ua()}function Tn(){!Rt||!Ee||Ee.style.display==="none"||Io(Rt,Ee)}function Qr(e){e.key==="Escape"&&(!Ee||Ee.style.display==="none"||(e.preventDefault(),ua()))}function Io(e,t){let a=e.getBoundingClientRect();t.style.width=`${a.width}px`;let n=window.innerHeight,o=Math.min(t.scrollHeight,260),i=n-a.bottom<o+12?Math.max(8,a.top-o-4):a.bottom+4,c=window.innerWidth,l=t.getBoundingClientRect().width||a.width,u=a.left,d=Math.min(Math.max(8,u),Math.max(8,c-l-8));t.style.left=`${d}px`,t.style.top=`${i}px`}function ei(){let e=document.querySelector(".workspace-icon");e&&(po===null&&(po=e.textContent||""),M.customWorkspaceLogo?(e.style.backgroundImage=`url(${M.customWorkspaceLogo})`,e.textContent=""):(e.style.backgroundImage="",e.textContent=po))}function Dr({tasks:e,projects:t,feedbackItems:a}={}){N=t||[],L=e||[],re=a||[],We=re.map(n=>n&&n.id).filter(n=>n!=null),N.forEach(n=>{n&&n.id!=null&&(n.id=parseInt(n.id,10)),Array.isArray(n.tags)||(n.tags=[])}),L.forEach(n=>{n&&(n.id!=null&&(n.id=parseInt(n.id,10)),n.projectId!=null&&n.projectId!=="null"?n.projectId=parseInt(n.projectId,10):n.projectId=null,(n.startDate===void 0||n.startDate===null)&&(n.startDate=""),(n.endDate===void 0||n.endDate===null)&&(n.endDate=""),typeof n.startDate!="string"&&(n.startDate=String(n.startDate||"")),typeof n.endDate!="string"&&(n.endDate=String(n.endDate||"")),Array.isArray(n.tags)||(typeof n.tags=="string"&&n.tags.trim()!==""?n.tags=n.tags.split(",").map(o=>o.trim()).filter(Boolean):n.tags=[]),Array.isArray(n.attachments)||(n.attachments=[]),n.startDateWasEverSet===void 0&&(n.startDateWasEverSet=n.startDate.trim()!==""),n.endDateWasEverSet===void 0&&(n.endDateWasEverSet=n.endDate.trim()!==""),n.dueDate&&!n.endDate&&(n.endDate=n.dueDate,n.endDateWasEverSet=!0),delete n.dueDate)}),re.forEach(n=>{n&&n.id!=null&&(n.id=parseInt(n.id,10))}),Dl(),Le.length>0&&Le.forEach(Il),_a(),N.length>0?st=Math.max(...N.map(n=>n.id||0))+1:st=1,L.length>0?Ge=Math.max(...L.map(n=>n.id||0))+1:Ge=1,re.length>0?Kt=Math.max(...re.map(n=>n.id||0))+1:Kt=1}var yo={},wt={},Tr=0;function Xt(e){return yo[e]||(yo[e]=Qn[Tr%Qn.length],Tr++),yo[e]}function Te(e){if(!wt[e]){let t=new Set(Object.values(wt)),a=ka.filter(n=>!t.has(n));wt[e]=a.length>0?a[0]:ka[Object.keys(wt).length%ka.length]}return wt[e]}function ti(e,t){wt[e]=t,Al(),document.getElementById("calendar-view").classList.contains("active")&&ie()}function Fl(e){let t=document.getElementById(`color-picker-${e}`);if(t){let a=t.style.display!=="none";document.querySelectorAll(".color-picker-dropdown").forEach(n=>n.style.display="none"),t.style.display=a?"none":"block"}}function Rl(e,t){ti(e,t);let a=document.querySelector(`#color-picker-${e}`).previousElementSibling;a&&(a.style.backgroundColor=t);let n=document.getElementById(`color-picker-${e}`);if(n){n.querySelectorAll(".color-option").forEach(r=>{let l="#"+r.style.backgroundColor.replace(/rgb\(|\)|\s/g,"").split(",").map(u=>parseInt(u,10).toString(16).padStart(2,"0")).join("");r.style.border=l.toUpperCase()===t.toUpperCase()?"2px solid white":"2px solid transparent"});let s=n.querySelector(".custom-color-swatch");s&&(s.style.border="2px solid transparent")}let o=N.find(s=>s.id===e);o&&o.tags&&Ya(o.tags,e),document.getElementById("projects")?.classList.contains("active")&&(te.projectsSortedView=null,_e())}function Ol(e,t){if(!t)return;ti(e,t);let a=document.getElementById(`color-picker-${e}`);if(a){let s=a.previousElementSibling;s&&(s.style.backgroundColor=t);let r=a.querySelector(".custom-color-swatch");r&&(r.style.backgroundColor=t)}let n=document.getElementById(`color-picker-${e}`);if(n){n.querySelectorAll(".color-option").forEach(r=>{r.style.border="2px solid transparent"});let s=n.querySelector(".custom-color-swatch");s&&(s.style.border="2px solid white")}let o=N.find(s=>s.id===e);o&&o.tags&&Ya(o.tags,e),document.getElementById("projects")?.classList.contains("active")&&(te.projectsSortedView=null,_e())}function ql(e){let t=document.getElementById(`project-color-input-${e}`);t&&(Co=!0,t.click())}var h={search:"",statuses:new Set,priorities:new Set,projects:new Set,tags:new Set,datePresets:new Set,dateFrom:"",dateTo:""},q={search:"",statuses:new Set,taskFilter:"",updatedFilter:"all",tags:new Set},Ne={lastSort:"",direction:"asc"},xr=!1;function zl(){xr||(xr=!0,Va(),ya(),Qt(),Hl())}function Va(){let e=document.getElementById("project-options");if(e){let t=new Set(h.projects);if(e.innerHTML="",L.some(n=>!n.projectId)){let n=document.createElement("li"),o=t.has("none")?"checked":"";n.innerHTML=`<label><input type="checkbox" id="proj-none" value="none" data-filter="project" ${o}> ${p("tasks.noProject")}</label>`,e.appendChild(n)}else t.has("none")&&(h.projects.delete("none"),he());if(N.length===0){let n=document.createElement("li");n.textContent=p("filters.noOtherProjects"),n.style.color="var(--text-muted)",n.style.padding="8px 12px",e.appendChild(n)}else N.slice().sort((n,o)=>(n.name||"").localeCompare(o.name||"",void 0,{sensitivity:"base"})).forEach(n=>{let o=document.createElement("li"),s=`proj-${n.id}`,r=t.has(String(n.id))?"checked":"";o.innerHTML=`<label><input type="checkbox" id="${s}" value="${n.id}" data-filter="project" ${r}> ${n.name}</label>`,e.appendChild(o)});e.querySelectorAll('input[type="checkbox"][data-filter="project"]').forEach(n=>{n.addEventListener("change",()=>{aa(h.projects,n.value,n.checked),he(),De(),document.getElementById("calendar-view")&&ie(),$e()})})}}function ya(){let e=document.getElementById("tag-options");if(e){let t=new Set(h.tags),a=new Set;if(L.forEach(o=>{o.tags&&o.tags.length>0&&o.tags.forEach(s=>a.add(s))}),e.innerHTML="",L.some(o=>!o.tags||o.tags.length===0)){let o=document.createElement("li"),s=t.has("none")?"checked":"";o.innerHTML=`<label><input type="checkbox" id="tag-none" value="none" data-filter="tag" ${s}> ${p("filters.noTags")}</label>`,e.appendChild(o)}else t.has("none")&&(h.tags.delete("none"),he());if(a.size===0){let o=document.createElement("li");o.textContent=p("filters.noOtherTags"),o.style.color="var(--text-muted)",o.style.padding="8px 12px",e.appendChild(o)}else Array.from(a).sort().forEach(o=>{let s=document.createElement("li"),r=`tag-${o}`,i=t.has(o)?"checked":"";s.innerHTML=`<label><input type="checkbox" id="${r}" value="${o}" data-filter="tag" ${i}> ${o.toUpperCase()}</label>`,e.appendChild(s)});e.querySelectorAll('input[type="checkbox"]').forEach(o=>{o.addEventListener("change",()=>{o.dataset.filter==="tag"&&aa(h.tags,o.value,o.checked),he(),De(),document.getElementById("calendar-view")&&ie(),$e()})})}}function Hl(){let e=!!(window.matchMedia&&(window.matchMedia("(max-width: 768px)").matches||window.matchMedia("(pointer: coarse)").matches)),t=document.getElementById("project-select-all");t&&t.parentElement.parentElement&&(N.length>1?t.parentElement.parentElement.style.display="block":t.parentElement.parentElement.style.display="none");let a=[document.getElementById("group-status"),document.getElementById("group-priority"),document.getElementById("group-project"),document.getElementById("group-tags"),document.getElementById("group-end-date"),document.getElementById("group-start-date"),document.getElementById("group-kanban-updated"),document.getElementById("group-project-status"),document.getElementById("group-project-updated"),document.getElementById("group-project-tags")].filter(Boolean),n=()=>{let d=document.getElementById("dropdown-backdrop");return d||(d=document.createElement("div"),d.id="dropdown-backdrop",d.setAttribute("aria-hidden","true"),d.addEventListener("click",()=>o()),document.body.appendChild(d)),d},o=()=>{a.forEach(f=>f.classList.remove("open")),document.body.classList.remove("dropdown-sheet-open");let d=document.getElementById("dropdown-backdrop");d&&d.classList.remove("open")},s=d=>{let f=d.querySelector(".dropdown-panel");if(f){if(f.classList.add("has-sheet-header"),e){try{let m=d.getBoundingClientRect(),g=12,y=8,v=window.innerHeight||document.documentElement.clientHeight||0,w=Math.max(0,v-m.bottom-g),C=Math.max(0,m.top-g),T=Math.min(460,Math.floor(v*.6)),E=w>=260||w>=C,D=Math.min(T,E?w:C),b=D<220;if(f.classList.toggle("sheet-bottom",b),f.classList.toggle("sheet-anchored",!b),b)f.style.removeProperty("--sheet-top"),f.style.removeProperty("--sheet-maxh");else{D<240&&(D=Math.min(240,Math.max(0,E?w:C)));let S=E?m.bottom+y:m.top-y-D;S=Math.max(g,Math.min(S,v-g-140)),f.style.setProperty("--sheet-top",`${Math.round(S)}px`),f.style.setProperty("--sheet-maxh",`${Math.round(D)}px`)}}catch{f.classList.add("sheet-bottom"),f.classList.remove("sheet-anchored")}n().classList.add("open"),document.body.classList.add("dropdown-sheet-open")}if(!f.querySelector(".dropdown-sheet-header")){let m=f.querySelector(".dropdown-section-title")?.textContent?.trim()||d.querySelector(".filter-button")?.textContent?.trim()||p("filters.sheet.title"),g=document.createElement("div");g.className="dropdown-sheet-header";let y=document.createElement("div");y.className="dropdown-sheet-handle";let v=document.createElement("div");v.className="dropdown-sheet-title",v.textContent=m.toUpperCase();let w=document.createElement("button");w.type="button",w.className="dropdown-sheet-done",w.textContent=p("common.done"),w.addEventListener("click",()=>o()),g.appendChild(y),g.appendChild(v),g.appendChild(w),f.insertBefore(g,f.firstChild)}}};a.forEach(d=>{d.querySelector(".filter-button").addEventListener("click",g=>{g.stopPropagation();let y=d.classList.contains("open");o(),y||(d.classList.add("open"),s(d))});let m=d.querySelector(".dropdown-panel");m&&m.addEventListener("click",g=>g.stopPropagation())}),document.addEventListener("click",()=>o()),document.addEventListener("keydown",d=>{d.key==="Escape"&&o()}),document.querySelectorAll('.dropdown-panel input[type="checkbox"][data-filter="status"],.dropdown-panel input[type="checkbox"][data-filter="priority"],.dropdown-panel input[type="checkbox"][data-filter="project"]').forEach(d=>{d.addEventListener("change",()=>{let f=d.dataset.filter;f==="status"&&aa(h.statuses,d.value,d.checked),f==="priority"&&aa(h.priorities,d.value,d.checked),f==="project"&&aa(h.projects,d.value,d.checked),he(),De(),document.getElementById("calendar-view")&&ie(),$e()})}),document.querySelectorAll('input[type="checkbox"][data-filter="date-preset"]').forEach(d=>{d.addEventListener("change",()=>{let f=d.value;if(d.checked){if(h.datePresets.add(f),h.datePresets.size>0){h.dateFrom="",h.dateTo="";let g=document.getElementById("filter-date-from"),y=document.getElementById("filter-date-to");g&&(g.value=""),y&&(y.value="")}}else h.datePresets.delete(f);he(),De(),document.getElementById("calendar-view")&&ie(),$e()})});let r=document.getElementById("project-select-all");r&&r.addEventListener("change",()=>{let d=document.querySelectorAll('.dropdown-panel input[type="checkbox"][data-filter="project"]'),f=r.checked;d.forEach(g=>{g.checked=f,f?h.projects.add(g.value):h.projects.delete(g.value)}),he(),De(),document.getElementById("calendar-view")&&ie(),$e()});let i=document.getElementById("filter-search");i&&i.addEventListener("input",()=>{h.search=(i.value||"").trim().toLowerCase(),he(),De(),document.getElementById("calendar-view")&&ie(),$e()}),document.querySelectorAll('input[type="radio"][data-filter="kanban-updated"][name="kanban-updated-filter"]').forEach(d=>{d.addEventListener("change",()=>{d.checked&&(Oa(d.value),$e())})});let c=document.getElementById("filter-date-from"),l=document.getElementById("filter-date-to");c?c.addEventListener("change",()=>{h.dateFrom=c.value,he(),De(),document.getElementById("calendar-view")&&ie(),$e()}):console.error("[Filter] Date From element not found!"),l?l.addEventListener("change",()=>{h.dateTo=l.value,he(),De(),document.getElementById("calendar-view")&&ie(),$e()}):console.error("[Filter] Date To element not found!");let u=document.getElementById("btn-clear-filters");u&&u.addEventListener("click",()=>{h.search="",h.statuses.clear(),h.priorities.clear(),h.projects.clear(),h.tags.clear(),h.datePresets.clear(),h.dateFrom="",h.dateTo="";try{Oa("all",{render:!1})}catch{}if(document.querySelectorAll('.dropdown-panel input[type="checkbox"]').forEach(f=>f.checked=!1),i&&(i.value=""),c){c.value="";let f=c.closest(".date-input-wrapper");if(f){let m=f.querySelector(".date-display");m&&m._flatpickr&&m._flatpickr.clear()}}if(l){l.value="";let f=l.closest(".date-input-wrapper");if(f){let m=f.querySelector(".date-display");m&&m._flatpickr&&m._flatpickr.clear()}}he(),De(),document.getElementById("calendar-view")&&ie(),$e()}),he(),Wa(),Hn(),$e()}function $e(){let e=document.getElementById("btn-clear-filters");if(!e)return;let t=document.querySelector(".kanban-board"),a=t&&!t.classList.contains("hidden"),n=document.getElementById("list-view")?.classList.contains("active"),o=document.getElementById("calendar-view")?.classList.contains("active"),r=(a||n||o)&&window.kanbanUpdatedFilter&&window.kanbanUpdatedFilter!=="all",i=h.search&&h.search.trim()!==""||h.statuses.size>0||h.priorities.size>0||h.projects.size>0||h.tags.size>0||h.datePresets.size>0||h.dateFrom&&h.dateFrom!==""||h.dateTo&&h.dateTo!==""||r;e.style.display=i?"inline-flex":"none"}function he(){let e=document.getElementById("badge-status"),t=document.getElementById("badge-priority"),a=document.getElementById("badge-project"),n=document.getElementById("badge-tags"),o=document.getElementById("badge-end-date"),s=document.getElementById("badge-start-date");e&&(e.textContent=h.statuses.size===0?"":h.statuses.size),t&&(t.textContent=h.priorities.size===0?"":h.priorities.size),a&&(a.textContent=h.projects.size===0?"":h.projects.size),n&&(n.textContent=h.tags.size===0?"":h.tags.size);let r=["no-date","overdue","end-today","end-tomorrow","end-7days","end-week","end-month"],i=["no-start-date","already-started","start-today","start-tomorrow","start-7days","start-week","start-month"],c=0,l=0;h.datePresets.forEach(d=>{r.includes(d)?c++:i.includes(d)&&l++}),o&&(o.textContent=c===0?"":c),s&&(s.textContent=l===0?"":l);let u=(d,f)=>{let m=document.getElementById(d);if(m){let g=m.closest(".filter-button");g&&(f?g.classList.add("active"):g.classList.remove("active"))}};u("badge-status",h.statuses.size>0),u("badge-priority",h.priorities.size>0),u("badge-project",h.projects.size>0),u("badge-tags",h.tags.size>0),u("badge-end-date",c>0),u("badge-start-date",l>0),Wa(),$e(),on("filters","badges",{statusCount:h.statuses.size,priorityCount:h.priorities.size,projectCount:h.projects.size,tagCount:h.tags.size,endDateCount:c,startDateCount:l})}function Wa(){let e=document.getElementById("active-filters");if(!e)return;let t=ke("filters","chips");e.innerHTML="";let a=(n,o,s,r,i)=>{let c=document.createElement("span");c.className="filter-chip",r==="status"?c.classList.add("chip-status"):r==="priority"&&c.classList.add("chip-priority");let l=document.createElement("span");if(l.className="chip-text",r==="status"&&i){let d=document.createElement("span");d.className=`dot ${i}`,l.appendChild(d),l.appendChild(document.createTextNode(` ${n}: ${o}`))}else l.textContent=`${n}: ${o}`;let u=document.createElement("button");u.type="button",u.className="chip-remove",u.setAttribute("aria-label",p("filters.chip.removeAria",{label:n})),u.textContent="\xD7",u.addEventListener("click",s),c.appendChild(l),c.appendChild(u),e.appendChild(c)};h.search&&a(p("filters.chip.search"),h.search,()=>{h.search="";let n=document.getElementById("filter-search");n&&(n.value=""),he(),$e(),De()}),h.statuses.forEach(n=>a(p("tasks.filters.status"),He(n),()=>{h.statuses.delete(n);let o=document.querySelector(`input[type="checkbox"][data-filter="status"][value="${n}"]`);o&&(o.checked=!1),he(),De()},"status",n)),h.priorities.forEach(n=>a(p("tasks.filters.priority"),et(n),()=>{h.priorities.delete(n);let o=document.querySelector(`input[type="checkbox"][data-filter="priority"][value="${n}"]`);o&&(o.checked=!1),he(),De()},"priority",n)),h.projects.forEach(n=>{let o=N.find(s=>s.id.toString()===n.toString());a(p("filters.chip.project"),o?o.name:n,()=>{h.projects.delete(n);let s=document.querySelector(`input[type="checkbox"][data-filter="project"][value="${n}"]`);s&&(s.checked=!1),he(),De()})}),h.tags.forEach(n=>a(p("filters.chip.tag"),n,()=>{h.tags.delete(n);let o=document.querySelector(`input[type="checkbox"][data-filter="tag"][value="${n}"]`);o&&(o.checked=!1),he(),De()})),h.datePresets.forEach(n=>{let s={"no-date":p("tasks.filters.noDate"),overdue:p("tasks.filters.overdue"),"end-today":p("tasks.filters.endToday"),"end-tomorrow":p("tasks.filters.endTomorrow"),"end-7days":p("tasks.filters.end7Days"),"end-week":p("tasks.filters.endThisWeek"),"end-month":p("tasks.filters.endThisMonth"),"no-start-date":p("tasks.filters.noStartDate"),"already-started":p("tasks.filters.alreadyStarted"),"start-today":p("tasks.filters.startToday"),"start-tomorrow":p("tasks.filters.startTomorrow"),"start-7days":p("tasks.filters.start7Days"),"start-week":p("tasks.filters.startThisWeek"),"start-month":p("tasks.filters.startThisMonth")}[n]||n;a(p("filters.chip.date"),s,()=>{h.datePresets.delete(n);let r=document.querySelector(`input[type="checkbox"][data-filter="date-preset"][value="${n}"]`);r&&(r.checked=!1),he(),De()})});try{let n=document.querySelector(".kanban-board"),o=n&&!n.classList.contains("hidden"),s=document.getElementById("list-view")?.classList.contains("active"),r=document.getElementById("calendar-view")?.classList.contains("active");(o||s||r)&&window.kanbanUpdatedFilter&&window.kanbanUpdatedFilter!=="all"&&a(p("filters.chip.updated"),Mi(window.kanbanUpdatedFilter),()=>{Oa("all"),$e()})}catch{}if(h.dateFrom||h.dateTo){let n="";h.dateFrom&&h.dateTo?n=`${pe(h.dateFrom)} - ${pe(h.dateTo)}`:h.dateFrom?n=`${p("filters.dateRange.from")} ${pe(h.dateFrom)}`:h.dateTo&&(n=`${p("filters.dateRange.until")} ${pe(h.dateTo)}`),a(p("filters.chip.date"),n,()=>{h.dateFrom="",h.dateTo="";let o=document.getElementById("filter-date-from"),s=document.getElementById("filter-date-to");if(o){o.value="";let r=o.closest(".date-input-wrapper");if(r){let i=r.querySelector(".date-display");i&&i._flatpickr&&i._flatpickr.clear()}}if(s){s.value="";let r=s.closest(".date-input-wrapper");if(r){let i=r.querySelector(".date-display");i&&i._flatpickr&&i._flatpickr.clear()}}De()})}ye("filters",t,{chipCount:e.children.length})}function La(){let e=new URLSearchParams,t=document.getElementById("list-view")?.classList.contains("active"),a=document.getElementById("calendar-view")?.classList.contains("active");t?e.set("view","list"):a&&e.set("view","calendar"),h.search&&h.search.trim()!==""&&e.set("search",h.search.trim()),h.statuses.size>0&&e.set("status",Array.from(h.statuses).join(",")),h.priorities.size>0&&e.set("priority",Array.from(h.priorities).join(",")),h.projects.size>0&&e.set("project",Array.from(h.projects).join(",")),h.tags.size>0&&e.set("tags",Array.from(h.tags).join(",")),h.datePresets.size>0&&e.set("datePreset",Array.from(h.datePresets).join(",")),h.dateFrom&&h.dateFrom!==""&&(e.set("dateFrom",h.dateFrom),h.dateField&&h.dateField!=="endDate"&&e.set("dateField",h.dateField)),h.dateTo&&h.dateTo!==""&&e.set("dateTo",h.dateTo),window.kanbanUpdatedFilter&&window.kanbanUpdatedFilter!=="all"&&e.set("updated",window.kanbanUpdatedFilter);let n=e.toString(),o=n?`#tasks?${n}`:"#tasks";window.location.hash!==o&&window.history.replaceState(null,"",o)}function De(){La(),Wa(),Me(),(window.innerWidth<=768||document.getElementById("list-view").classList.contains("active"))&&rt(),document.getElementById("calendar-view").classList.contains("active")&&ie()}function yt(){let e=ke("filters","tasks",{totalTasks:L.length,hasSearch:!!h.search,statusCount:h.statuses.size,priorityCount:h.priorities.size,projectCount:h.projects.size,tagCount:h.tags.size,datePresetCount:h.datePresets.size,hasDateRange:!!(h.dateFrom||h.dateTo)}),t=Vs(L,{search:h.search,statuses:h.statuses,priorities:h.priorities,projects:h.projects,tags:h.tags,datePresets:h.datePresets,dateFrom:h.dateFrom,dateTo:h.dateTo,dateField:h.dateField||"endDate"});return ye("filters",e,{totalTasks:L.length,filteredCount:t.length}),t}function xt(){let e=window.flatpickr;if(typeof e!="function"){let r=(xt.__retryCount||0)+1;xt.__retryCount=r,r<=50?setTimeout(xt,100):console.warn("flatpickr is not available; date pickers disabled");return}let a={dateFormat:"d/m/Y",altInput:!1,allowInput:!0,locale:ai(),disableMobile:!0};function n(r,i){let c=!1;r.addEventListener("keydown",function(l){!c&&r.value.match(/^\d{2}\/\d{2}\/\d{4}$/)&&l.key.length===1&&/\d/.test(l.key)&&(r.value="",c=!0),l.key==="Backspace"&&r.selectionStart===0&&r.selectionEnd===0&&(r.value="",c=!0,l.preventDefault())}),r.addEventListener("input",function(l){let u=l.target.value,d=u.replace(/\D/g,""),f="";if(d.length>=1){let m=d.substring(0,2);parseInt(m,10)>31&&(m="31"),f=m}if(d.length>=3){let m=d.substring(2,4);parseInt(m,10)>12&&(m="12"),f+="/"+m}if(d.length>=5&&(f+="/"+d.substring(4,8)),u!==f&&(l.target.value=f),f.match(/^\d{2}\/\d{2}\/\d{4}$/)){let[m,g,y]=f.split("/"),v=new Date(+y,+g-1,+m);if(i&&i.config)try{i.__suppressChange=!0,i.setDate(v,!1),setTimeout(()=>i.__suppressChange=!1,0)}catch{}}}),r.addEventListener("keypress",function(l){let u=String.fromCharCode(l.which);!/[\d\/]/.test(u)&&l.which!==8&&l.which!==46&&l.preventDefault()}),r.addEventListener("blur",function(){c=!1}),i&&i.config.onChange.push(()=>c=!1)}function o(r){if(r.__patchedProgrammaticGuards)return;r.__patchedProgrammaticGuards=!0;let i=r.clear.bind(r);r.clear=function(){r.__suppressChange=!0;let l=i();return setTimeout(()=>r.__suppressChange=!1,0),l};let c=r.setDate.bind(r);r.__origSetDate=c,r.setDate=function(l,u,...d){r.__suppressChange=!0;let f=c(l,u,...d);return setTimeout(()=>r.__suppressChange=!1,0),f}}function s(r){if(!r||!r.calendarContainer||r.calendarContainer.querySelector(".flatpickr-today-btn"))return;let i=document.createElement("div");i.className="flatpickr-today-footer";let c=document.createElement("button");c.type="button",c.className="flatpickr-today-btn",c.textContent=p("calendar.today")||"Today",c.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation();let u=new Date;r.jumpToDate(u),r.__suppressChange=!1,typeof r.__origSetDate=="function"?r.__origSetDate(u,!0):r.setDate(u,!0)}),i.appendChild(c),r.calendarContainer.appendChild(i)}document.querySelectorAll('input[type="date"], input.datepicker').forEach(r=>{if(!r._flatpickrInstance)if(r.type==="date"){if(r._wrapped)return;r._wrapped=!0;let i=document.createElement("div");i.className="date-input-wrapper";let c=document.createElement("input");c.type="text",c.className="form-input date-display",c.placeholder=p("common.datePlaceholder"),c.maxLength="10",r.style.display="none",r.type="hidden",r.parentNode.insertBefore(i,r),i.appendChild(r),i.appendChild(c);let l=r.value&&at(r.value)?r.value:"";l?c.value=an(l):c.value="";let u=e(c,{...a,defaultDate:l?new Date(l):null,onReady(m,g,y){s(y)},onOpen(m,g,y){!r.value&&!y.selectedDates.length&&y.jumpToDate(new Date)},onChange:function(m){let g=r.value||"",y="";if(m.length>0){let E=m[0];y=`${E.getFullYear()}-${String(E.getMonth()+1).padStart(2,"0")}-${String(E.getDate()).padStart(2,"0")}`}r.value=y;let v=document.getElementById("task-form");if(v&&(r.name==="startDate"||r.name==="endDate")){let E=document.querySelector(".modal.active");if(E){let D=E.querySelector('input[name="startDate"]'),b=E.querySelector('input[name="endDate"]');if(D&&b){let S=(D.value||"").trim(),x=(b.value||"").trim();if(S&&x&&x<S){r.value=g,g?c._flatpickr.setDate(new Date(g),!1):c._flatpickr.clear();let $=c.closest(".date-input-wrapper"),z=$?$.closest(".form-group"):null;if(z){let O=z.querySelector(".date-validation-error");O&&O.remove();let k=document.createElement("div");k.className="date-validation-error",k.style.cssText="color: var(--error); font-size: 12px; margin-top: 6px; padding: 8px 12px; background: var(--bg-error, rgba(239, 68, 68, 0.08)); border-left: 3px solid var(--error); border-radius: 4px;",k.innerHTML="\u26A0\uFE0F "+(r.name==="endDate"?"End Date cannot be before Start Date":"Start Date cannot be after End Date"),$.parentNode.insertBefore(k,$.nextSibling),setTimeout(()=>{k.parentElement&&k.remove()},5e3)}return}else{let $=c.closest(".date-input-wrapper"),z=$?$.closest(".form-group"):null;if(z){let O=z.querySelector(".date-validation-error");O&&O.remove()}}}}}if(r.id==="filter-date-from"){h.dateFrom=y,he(),De(),document.getElementById("calendar-view")&&ie(),$e();return}else if(r.id==="filter-date-to"){h.dateTo=y,he(),De(),document.getElementById("calendar-view")&&ie(),$e();return}let w=!!(v&&v.dataset.editingTaskId),C=r.name;if(w&&(C==="startDate"||C==="endDate")&&!u.__suppressChange){lt(C,y);return}if(c.classList.contains("editable-date")&&!u.__suppressChange){let E=c.getAttribute("onchange");if(E&&E.includes("updateProjectField")){let D=E.match(/updateProjectField\((\d+),\s*['"](\w+)['"]/);if(D){let b=parseInt(D[1],10),S=D[2];Zt(b,S,c.value)}}}}});o(u),n(c,u),r._flatpickrInstance=u;let d=!!c.closest("#task-form"),f=r.name==="startDate"||r.name==="endDate";if(d&&f){let m=document.createElement("button");m.type="button",m.textContent="Clear",m.style.padding="6px 10px",m.style.border="1px solid var(--border)",m.style.background="var(--bg-tertiary)",m.style.color="var(--text-secondary)",m.style.borderRadius="6px",m.style.cursor="pointer",m.style.flex="0 0 auto";let g=c.parentElement;g&&(g.style.display="flex",g.style.gap="8px"),g.appendChild(m),m.addEventListener("click",()=>{c.value="",r.value="",u&&(u.__suppressChange=!0,u.clear(),setTimeout(()=>u.__suppressChange=!1,0));let y=document.getElementById("task-form");y&&y.dataset.editingTaskId&&lt(r.name,"")})}}else{r.maxLength="10";let i=e(r,{...a,defaultDate:null,onReady(c,l,u){s(u)},onChange:function(c,l){if(i.__suppressChange)return;let u=r.dataset.projectId,d=r.dataset.field;u&&d&&Zt(parseInt(u,10),d,l)}});o(i),n(r,i),r._flatpickrInstance=i}})}function ai(){let e=Nt(),t=window.flatpickr?.l10ns,a=null;return e==="es"&&t?.es?a=t.es:a=t?.default||t?.en||t?.es||null,a?{...a,firstDayOfWeek:1}:{firstDayOfWeek:1}}function Ul(){let e=ai();document.querySelectorAll("input").forEach(t=>{let a=t._flatpickrInstance;a&&typeof a.set=="function"&&(a.set("locale",e),typeof a.redraw=="function"&&a.redraw())})}var Ir=null,Ia=null,mn=null;function vo(e,t){let a=0,n=Array.isArray(e)?e:[];for(let o of n){let s=t?t(o):Date.parse(o?.updatedAt||o?.createdAt||o?.createdDate||"")||0;Number.isFinite(s)&&s>a&&(a=s)}return a}function bo(e){let t=0,a=Array.isArray(e)?e:[];for(let n of a){let o=Number(n?.id);Number.isNaN(o)||(t+=o)}return t}function ko(e){let t=Array.isArray(e?.tasks)?e.tasks:[],a=Array.isArray(e?.projects)?e.projects:[],n=Array.isArray(e?.feedbackItems)?e.feedbackItems:[],o=vo(t,typeof At=="function"?At:null),s=vo(a,i=>Date.parse(i?.updatedAt||i?.createdAt||"")||0),r=vo(n,i=>Date.parse(i?.updatedAt||i?.createdAt||i?.createdDate||"")||0);return`t:${t.length}:${o}:${bo(t)}|p:${a.length}:${s}:${bo(a)}|f:${n.length}:${r}:${bo(n)}`}function jo(e=L,t=N){let a=!!M.calendarIncludeBacklog,n=h?.projects,o=n&&n.size>0?new Set(Array.from(n).map(d=>parseInt(d,10))):null,s=0,r=0,i=Array.isArray(e)?e:[];for(let d of i){if(!d||!a&&d.status==="backlog"||o&&!o.has(Number(d.projectId)))continue;let f=d.startDate||"",m=d.endDate||"",g=typeof f=="string"&&f.length===10&&f.includes("-"),y=typeof m=="string"&&m.length===10&&m.includes("-");if(!g&&!y)continue;r++;let v=Number(d.id)||0,w=d.status?String(d.status):"",C=Number(d.projectId)||0,T=d.title?String(d.title):"",E=Date.parse(d.updatedAt||d.createdAt||d.createdDate||"")||0;s=s*31+v+C+E|0;for(let D=0;D<f.length;D++)s=s*31+f.charCodeAt(D)|0;for(let D=0;D<m.length;D++)s=s*31+m.charCodeAt(D)|0;for(let D=0;D<w.length;D++)s=s*31+w.charCodeAt(D)|0;for(let D=0;D<T.length;D++)s=s*31+T.charCodeAt(D)|0}let c=Array.isArray(t)?t:[],l=0,u=0;for(let d of c){if(!d||o&&!o.has(Number(d.id)))continue;u++;let f=Number(d.id)||0,m=d.name?String(d.name):"",g=d.startDate?String(d.startDate):"",y=d.endDate?String(d.endDate):"",v=Date.parse(d.updatedAt||d.createdAt||"")||0;l=l*31+f+v|0;for(let w=0;w<m.length;w++)l=l*31+m.charCodeAt(w)|0;for(let w=0;w<g.length;w++)l=l*31+g.charCodeAt(w)|0;for(let w=0;w<y.length;w++)l=l*31+y.charCodeAt(w)|0}return`m:${Se}-${we+1}|b:${a?1:0}|pf:${o?o.size:0}|c:${r}|h:${s}|pc:${u}|ph:${l}`}function _l(e=500){mn!==null&&clearTimeout(mn),mn=setTimeout(()=>{mn=null,ie(),Ia=jo()},e)}function Vl(){let e=document.querySelector(".page.active");return e?e.id:null}function Wl(){let e=window.location.hash.slice(1);if(!e)return;let t=["dashboard","projects","tasks","updates","feedback","calendar"],a="dashboard";if(e==="dashboard/recent_activity")a="dashboard";else if(e.startsWith("project-"))a="projects";else if(t.includes(e))a=e==="calendar"?"tasks":e;else return;document.querySelectorAll(".page").forEach(n=>n.classList.remove("active")),document.getElementById(a)?.classList.add("active"),document.getElementById("project-details")?.classList.remove("active"),document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active")),e==="calendar"?document.querySelector(".nav-item.calendar-nav")?.classList.add("active"):document.querySelector(`.nav-item[data-page="${a}"]`)?.classList.add("active")}function Gl(e={}){let t=!!e.calendarChanged;Oe(),si();let a=Vl();if(a==="dashboard"){Uo();return}if(a==="projects"){_e();return}if(a==="tasks"){let n=document.querySelector(".kanban-board");n&&!n.classList.contains("hidden")&&Me(),document.getElementById("list-view")?.classList.contains("active")&&rt(),document.getElementById("calendar-view")?.classList.contains("active")&&(t?(Ve("calendar-refresh-debounced",{reason:"data-changed"}),_l(500)):Ve("calendar-refresh-skipped",{reason:"fingerprint-match"}));return}if(a==="updates"){Fn();return}a==="feedback"&&jt()}var wo=!1;async function Mn(){if(wo)return;wo=!0,Ve("init-start",{hasAuth:!!localStorage.getItem("authToken"),hasAdmin:!!localStorage.getItem("adminToken")});let e=ke("init","init",{hasAuth:!!localStorage.getItem("authToken"),hasAdmin:!!localStorage.getItem("adminToken")});if(!localStorage.getItem("authToken")&&!localStorage.getItem("adminToken")){console.log("Waiting for authentication before initializing app..."),wo=!1;return}typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(10),N=[],L=[],re=[],We=[],st=1,Ge=1,Aa=!0,typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(20),Wl();let a=vs({preferCache:!0,onRefresh:y=>{if(!y)return;let v=ko(y),w=ko({tasks:L,projects:N,feedbackItems:re});if(v===w)return;Dr(y),Le.length>0&&En(0);let C=jo(y.tasks||L,y.projects||N),T=Ia&&C!==Ia;Ir=v,Ia=C,Gl({calendarChanged:T})},feedback:{limitPending:mt,limitDone:mt,cacheKey:Rr,preferCache:!0}}),n=Es().catch(()=>null),o=Ds().catch(()=>({})),s=xs().catch(()=>({})),r=window.historyService?.loadHistory?window.historyService.loadHistory().catch(()=>null):Promise.resolve(null),i=ke("init","load-data"),[c,l,u,d]=await Promise.all([a,n,o,s,r]);if(ye("init",i,{taskCount:c?.tasks?.length||0,projectCount:c?.projects?.length||0,feedbackCount:c?.feedbackItems?.length||0}),Ve("init-data-loaded",{taskCount:c?.tasks?.length||0,projectCount:c?.projects?.length||0,feedbackCount:c?.feedbackItems?.length||0}),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(60),Dr(c),Le.length>0&&En(0),l&&typeof l=="object"){let y=l.sortMode,v=l.manualTaskOrder;y&&(ze=y),v&&(me=v)}else try{let y=localStorage.getItem("sortMode"),v=localStorage.getItem("manualTaskOrder");y&&(ze=y),v&&(me=JSON.parse(v))}catch{}(ze==="auto"||ze!=="priority"&&ze!=="manual")&&(ze="priority"),Dt(),wt=u&&typeof u=="object"?u:{},d&&typeof d=="object"&&(M={...M,...d}),M.language=Mo(M.language),no(M.debugLogsEnabled),ei(),typeof M.enableReviewStatus<"u"&&(window.enableReviewStatus=M.enableReviewStatus,localStorage.setItem("enableReviewStatus",String(M.enableReviewStatus))),ts(),Du(),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(75),Jl(),jd(),Ld(),Ad(),Ti(),gl(),ru(),xt(),zl(),uu(),Fr(),Ve("init-ui-ready"),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(90),Aa=!1,h.search="",h.statuses.clear(),h.priorities.clear(),h.projects.clear(),h.tags.clear(),h.datePresets.clear(),h.dateFrom="",h.dateTo="",q.search="",q.statuses.clear(),q.taskFilter="",q.updatedFilter="all";try{localStorage.removeItem("projectsViewState")}catch{}try{localStorage.removeItem("kanbanUpdatedFilter")}catch{}window.kanbanUpdatedFilter="all";let f=window.location.hash.slice(1),m=["dashboard","projects","tasks","updates","feedback","calendar"];if(document.querySelectorAll(".nav-item").forEach(y=>y.classList.remove("active")),f==="calendar")Ma();else if(f==="dashboard/recent_activity")document.querySelector('.nav-item[data-page="dashboard"]')?.classList.add("active"),Re("dashboard/recent_activity");else if(f.startsWith("project-")){let y=parseInt(f.replace("project-",""));document.querySelector('.nav-item[data-page="projects"]')?.classList.add("active"),Ae(y)}else{let y=m.includes(f)?f==="calendar"?"tasks":f:"dashboard",v=document.querySelector(`.nav-item[data-page="${y}"]`);if(f==="calendar"?document.querySelector(".nav-item.calendar-nav")?.classList.add("active"):v&&v.classList.add("active"),document.querySelectorAll(".page").forEach(w=>w.classList.remove("active")),document.getElementById(y).classList.add("active"),f==="calendar"){document.querySelector(".kanban-board")?.classList.add("hidden"),document.getElementById("list-view")?.classList.remove("active"),document.getElementById("calendar-view")?.classList.add("active");let w=document.querySelector(".view-toggle");w&&w.classList.add("hidden");let C=document.getElementById("global-filters");C&&(C.style.display="none"),ie()}}zt(),Ir=ko({tasks:L,projects:N,feedbackItems:re}),Ia=jo(L,N),Ve("init-render-complete"),await new Promise(requestAnimationFrame),await new Promise(requestAnimationFrame),Ve("init-first-paint"),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(100),ga||(ol(),cl()),Ve("init-notifications-ready"),ye("init",e,{taskCount:L.length,projectCount:N.length,feedbackCount:re.length,pendingSaves:Tt}),Ve("init-complete",{taskCount:L.length,projectCount:N.length,feedbackCount:re.length});function g(){let y=window.location.hash.slice(1),[v,w]=y.split("?"),C=new URLSearchParams(w||"");if(!(v==="login"||v==="admin-login"||v==="setup"))if(document.querySelectorAll(".nav-item").forEach(T=>T.classList.remove("active")),v==="dashboard/recent_activity")Pe="projects",document.querySelector('.nav-item[data-page="dashboard"]')?.classList.add("active"),Re("dashboard/recent_activity"),nt=v;else if(v.startsWith("project-")){let T=parseInt(v.replace("project-",""));document.querySelector('.nav-item[data-page="projects"]')?.classList.add("active"),Ae(T),nt=v}else if(v==="calendar")Pe="projects",document.querySelector(".nav-item.calendar-nav")?.classList.add("active"),Ma(),nt=v;else if(v==="tasks"){if(Pe="projects",document.querySelector('.nav-item[data-page="tasks"]')?.classList.add("active"),C.has("search")?h.search=(C.get("search")||"").trim().toLowerCase():h.search="",C.has("status")){let T=C.get("status").split(",").filter(Boolean);h.statuses.clear(),T.forEach(E=>h.statuses.add(E.trim()))}else h.statuses.clear();if(C.has("priority")){let T=C.get("priority").split(",").filter(Boolean);h.priorities.clear(),T.forEach(E=>h.priorities.add(E.trim()))}else h.priorities.clear();if(C.has("project")){let T=C.get("project").split(",").filter(Boolean);h.projects.clear(),T.forEach(E=>h.projects.add(E.trim()))}else h.projects.clear();if(C.has("tags")){let T=C.get("tags").split(",").filter(Boolean);h.tags.clear(),T.forEach(E=>h.tags.add(E.trim()))}else h.tags.clear();if(C.has("datePreset")){let E=(C.get("datePreset")||"").split(",").filter(Boolean);h.datePresets.clear(),E.forEach(D=>h.datePresets.add(D.trim())),h.dateFrom="",h.dateTo="",h.dateField="endDate"}else if(C.has("dateFrom")||C.has("dateTo")){let T=C.get("dateFrom")||"",E=C.get("dateTo")||"";h.dateFrom=T,h.dateTo=E,h.dateField=C.get("dateField")||"endDate",h.datePresets.clear()}else h.datePresets.clear(),h.dateFrom="",h.dateTo="",h.dateField="endDate";if(C.has("updated")){let T=C.get("updated");if(new Set(["all","5m","30m","24h","week","month"]).has(T))try{Oa(T,{render:!1})}catch(D){console.error("Failed to set kanbanUpdatedFilter from URL:",D)}}if(C.has("view")){let T=C.get("view");(T==="list"||T==="kanban"||T==="calendar")&&setTimeout(()=>{let E=document.querySelectorAll(".view-btn"),D=Array.from(E).find(b=>b.dataset.view===T);D&&!D.classList.contains("active")&&D.click()},100)}Re("tasks"),setTimeout(()=>{let T=document.getElementById("filter-search");T&&(T.value=h.search),document.querySelectorAll('input[data-filter="status"]').forEach(b=>{b.checked=h.statuses.has(b.value)}),document.querySelectorAll('input[data-filter="priority"]').forEach(b=>{b.checked=h.priorities.has(b.value)}),document.querySelectorAll('input[data-filter="project"]').forEach(b=>{b.checked=h.projects.has(b.value)}),document.querySelectorAll('input[data-filter="tag"]').forEach(b=>{b.checked=h.tags.has(b.value)}),document.querySelectorAll('input[data-filter="date-preset"]').forEach(b=>{b.checked=h.datePresets.has(b.value)});let E=document.getElementById("filter-date-from"),D=document.getElementById("filter-date-to");if(E&&h.dateFrom){E.value=h.dateFrom;let b=E.closest(".date-input-wrapper")?.querySelector(".date-display");b&&(b.value=pe(h.dateFrom))}if(D&&h.dateTo){D.value=h.dateTo;let b=D.closest(".date-input-wrapper")?.querySelector(".date-display");b&&(b.value=pe(h.dateTo))}he(),Wa(),$e()},100),nt=v}else if(v==="projects"){Pe="projects",document.querySelector('.nav-item[data-page="projects"]')?.classList.add("active");let T={};if(C.has("search")&&(T.search=C.get("search")),C.has("status")){let E=C.get("status").split(",").filter(Boolean),D=["backlog","planning","active","completed"];T.statuses=E.filter(b=>D.includes(b.trim()))}if(C.has("filter")){let E=C.get("filter");["has-tasks","no-tasks"].includes(E)&&(T.filter=E)}if(C.has("sort")){let E=C.get("sort");["default","name","created-desc","updated-desc","tasks-desc","completion-desc"].includes(E)&&(T.sort=E)}if(C.has("sortDirection")){let E=C.get("sortDirection");(E==="asc"||E==="desc")&&(T.sortDirection=E)}if(C.has("updatedFilter")){let E=C.get("updatedFilter");["all","5m","30m","24h","week","month"].includes(E)&&(T.updatedFilter=E)}window.urlProjectFilters=T,Re("projects"),nt=v}else v==="updates"?(Pe="projects",document.querySelector('.nav-item[data-page="updates"]')?.classList.add("active"),Re("updates"),nt=v):v==="feedback"?(Pe="projects",document.querySelector('.nav-item[data-page="feedback"]')?.classList.add("active"),Re("feedback"),nt=v):(v===""||v==="dashboard")&&(Pe="projects",document.querySelector('.nav-item[data-page="dashboard"]')?.classList.add("active"),Re("dashboard"),nt=v||"dashboard")}g(),window.addEventListener("hashchange",g),document.querySelectorAll(".view-btn").forEach(y=>{y.addEventListener("click",v=>{document.querySelectorAll(".view-btn").forEach(E=>E.classList.remove("active"));let w=v.currentTarget;w.classList.add("active");let C=(w.dataset.view||"").toLowerCase();try{let E=document.getElementById("backlog-quick-btn");E&&(E.style.display=C==="kanban"?"inline-flex":"none")}catch{}document.querySelector(".kanban-board").classList.add("hidden"),document.getElementById("list-view").classList.remove("active"),document.getElementById("calendar-view").classList.remove("active");let T=document.querySelector("#tasks .page-title");if(T&&(T.textContent=p("tasks.title")),C==="list"){let E=document.getElementById("global-filters");E&&(E.style.display=""),document.getElementById("list-view").classList.add("active"),rt(),Dt();try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}let D=document.getElementById("kanban-settings-btn")?.parentElement;D&&(D.style.display="none"),La()}else if(C==="kanban"){let E=document.getElementById("backlog-quick-btn");E&&(E.style.display="inline-flex");let D=document.getElementById("global-filters");D&&(D.style.display=""),document.querySelector(".kanban-board").classList.remove("hidden"),Me(),Dt();try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}let b=document.getElementById("kanban-settings-btn")?.parentElement;b&&(b.style.display=""),La()}else if(C==="calendar"){let E=document.getElementById("calendar-view");if(!E)return;let D=document.getElementById("backlog-quick-btn");D&&(D.style.display="none");let b=document.getElementById("kanban-settings-btn")?.parentElement;b&&(b.style.display="none"),E.classList.add("preparing"),ie(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{$a(),E.classList.remove("preparing"),E.classList.add("active"),Dt(),La()})})}})});try{let y=document.getElementById("backlog-quick-btn"),v=document.querySelector(".kanban-header .view-toggle");if(!y&&v&&v.parentElement){let w=document.createElement("button");w.type="button",w.id="backlog-quick-btn",w.className="backlog-quick-btn",w.title=p("tasks.backlogQuickTitle"),w.textContent=p("tasks.backlogQuickLabel"),w.addEventListener("click",T=>{T.preventDefault(),window.location.hash="#tasks?view=list&status=backlog"}),v.insertAdjacentElement("afterend",w);let C=(document.querySelector(".view-btn.active")?.dataset.view||"").trim().toLowerCase();w.style.display=C==="kanban"?"inline-flex":"none"}}catch{}Yl()}function Yl(){let e=document.querySelectorAll(".filter-chip");e.forEach(n=>{n.addEventListener("click",function(){e.forEach(s=>s.classList.remove("active")),this.classList.add("active");let o=this.dataset.period;oi(o)})}),document.querySelectorAll(".enhanced-stat-card").forEach(n=>{n.addEventListener("mouseenter",function(){this.style.transform="translateY(-4px) scale(1.02)"}),n.addEventListener("mouseleave",function(){this.style.transform="translateY(0) scale(1)"}),n.addEventListener("click",function(){let o=this.dataset.filter,s=this.dataset.value;o&&s&&ni(o,s)})}),document.querySelectorAll(".quick-action").forEach(n=>{n.addEventListener("click",function(){this.style.transform="scale(0.95)",setTimeout(()=>{this.style.transform="scale(1)"},150)})})}function ni(e,t){window.location.hash="tasks",document.querySelectorAll(".nav-item").forEach(c=>c.classList.remove("active"));let a=document.querySelector('.nav-item[data-page="tasks"]');a&&a.classList.add("active"),Re("tasks");let n=document.querySelector(".view-toggle");n&&n.classList.remove("hidden"),document.querySelectorAll(".view-btn").forEach(c=>c.classList.remove("active"));let o=document.querySelector(".view-btn:first-child");o&&o.classList.add("active");let s=document.querySelector(".kanban-board"),r=document.getElementById("list-view"),i=document.getElementById("calendar-view");s&&s.classList.remove("hidden"),i&&i.classList.remove("active"),r&&r.classList.remove("active");try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}Bu(),setTimeout(()=>{Kl(e,t),Me()},100)}function Kl(e,t){if(e==="status")h.statuses.clear(),h.statuses.add(t),document.querySelectorAll('input[data-filter="status"]').forEach(n=>{n.checked=n.value===t});else if(e==="priority")h.priorities.clear(),h.priorities.add(t),h.statuses.clear(),h.statuses.add("todo"),h.statuses.add("progress"),h.statuses.add("review"),document.querySelectorAll('input[data-filter="priority"]').forEach(o=>{o.checked=o.value===t}),document.querySelectorAll('input[data-filter="status"]').forEach(o=>{o.checked=["todo","progress","review"].includes(o.value)});else if(e==="overdue"){let a=new Date().toISOString().split("T")[0];h.dateTo=a;let n=document.getElementById("filter-date-to");n&&(n.value=a),h.statuses.clear(),h.statuses.add("todo"),h.statuses.add("progress"),h.statuses.add("review"),document.querySelectorAll('input[data-filter="status"]').forEach(s=>{s.checked=["todo","progress","review"].includes(s.value)})}he(),De()}function oi(e){let a={week:p("dashboard.trend.thisWeek"),month:p("dashboard.trend.thisMonth"),quarter:p("dashboard.trend.thisQuarter")}[e]||p("dashboard.trend.thisWeek"),n=document.getElementById("progress-change"),o=document.getElementById("completed-change");n&&(n.textContent=`+${Math.max(1,Math.floor(L.length*.1))} ${a}`),o&&(o.textContent=`+${L.filter(s=>s.status==="done").length} ${a}`)}function Jl(){document.querySelectorAll(".nav-item").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.page;if(t){if(t==="calendar"){Ma(),document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active")),e.classList.add("active");return}if(t==="tasks"&&(document.getElementById("calendar-view")?.classList.remove("active"),document.getElementById("list-view")?.classList.remove("active")),window.location.hash=t,t==="tasks"){let n=window.location.hash.slice(1),[o,s]=n.split("?"),r=new URLSearchParams(s||"");if(o==="tasks"&&r.toString()===""){h.search="",h.statuses.clear(),h.priorities.clear(),h.projects.clear(),h.tags.clear(),h.datePresets.clear(),h.dateFrom="",h.dateTo="";try{Oa("all",{render:!1})}catch{}let i=document.getElementById("filter-search");i&&(i.value=""),document.querySelectorAll('#global-filters input[type="checkbox"]').forEach(c=>c.checked=!1)}}document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active")),e.classList.add("active"),Re(t);let a=document.querySelector(".view-toggle");a&&(t==="tasks"?a.classList.remove("hidden"):a.classList.add("hidden"))}})})}function Re(e){if(e.includes("/")){let[s,r]=e.split("/");if(s==="dashboard"&&r==="recent_activity"){td();return}}window.innerWidth<=768&&window.scrollTo({top:0,behavior:"smooth"}),document.querySelectorAll(".page").forEach(s=>s.classList.remove("active")),document.getElementById("project-details").classList.remove("active");let t=document.getElementById("activity-page");t&&(t.style.display="none");let a=document.querySelector(".dashboard-grid");a&&(a.style.display="grid");let n=document.querySelector(".insights-card");n&&(n.style.display="");let o=document.querySelector(".user-menu");if(o&&(o.style.display=""),document.getElementById(e).classList.add("active"),e==="dashboard")Oe(),Uo();else if(e==="projects"){Oe();try{Ka(),Fu()}catch{}}else if(e==="tasks"){Oe();let s=window.location.hash.slice(1),[,r]=s.split("?");if(!new URLSearchParams(r||"").has("view")){document.querySelectorAll(".view-btn").forEach(f=>f.classList.remove("active")),document.querySelector(".view-btn:nth-child(1)").classList.add("active"),document.querySelector(".kanban-board").classList.remove("hidden"),document.getElementById("list-view").classList.remove("active"),document.getElementById("calendar-view").classList.remove("active");let l=document.querySelector("#tasks .page-title");l&&(l.textContent=p("tasks.title"));try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}let u=document.getElementById("kanban-settings-btn")?.parentElement;u&&(u.style.display="");let d=document.getElementById("backlog-quick-btn");d&&(d.style.display="inline-flex")}Me(),rt()}else e==="updates"?(Oe(),Fn(),fl()):e==="feedback"&&jt()}function zt(){Oe(),Uo(),_e(),Me(),jt(),Fn(),rt(),document.getElementById("calendar-view").classList.contains("active")&&ie(),si()}function si(){let e=Jc;document.querySelectorAll(".app-version").forEach(t=>t.textContent=e),document.querySelectorAll(".mobile-version").forEach(t=>t.textContent=e)}function Zl(e){let t=(e||[]).map(a=>Ta(a)).filter(Boolean);return t.length?`
        <ul class="release-list">
            ${t.map(a=>`<li><span class="release-point-icon" aria-hidden="true"></span><span>${U(a)}</span></li>`).join("")}
        </ul>
    `:`<div class="release-section-empty">${p("updates.sectionEmpty")}</div>`}function Fn(){let e=document.getElementById("updates-content");if(!e)return;let t=zr();if(t.length===0){e.innerHTML=`<div class="updates-empty">${p("updates.empty")}</div>`;return}let a=t[0],n=t.slice(1),o=[a.version,Ta(a.title)].filter(Boolean).join(" - "),s=p("notifications.releaseMeta",{date:Er(a.date)}),r=a.summary?U(Ta(a.summary)):"",i=a.sections||{},l=[{key:"new",label:p("updates.sections.new")},{key:"improvements",label:p("updates.sections.improvements")},{key:"fixes",label:p("updates.sections.fixes")}].map(d=>{let f=i[d.key]||[];return`
            <div class="release-section-card release-section-card--${d.key}">
                <div class="release-section-card-header">
                    <span class="release-section-icon" data-kind="${d.key}" aria-hidden="true"></span>
                    <div>
                        <div class="release-section-title">${d.label}</div>
                    </div>
                </div>
                ${Zl(f)}
            </div>
        `}).join(""),u=n.length?n.map(d=>{let f=[d.version,Ta(d.title)].filter(Boolean).join(" - "),m=Er(d.date),g=d.summary?U(Ta(d.summary)):"";return`
                <div class="release-history-item">
                    <div class="release-history-title">${U(f)}</div>
                    <div class="release-history-meta">${m}</div>
                    ${g?`<div class="release-history-summary">${g}</div>`:""}
                </div>
            `}).join(""):`<div class="release-history-empty">${p("updates.historyEmpty")}</div>`;e.innerHTML=`
        <div class="release-notes-stack">
            <article class="release-hero" data-release-id="${a.id}" aria-label="${p("updates.latestLabel")}">
                <div class="release-hero-top">
                    <span class="release-badge">${p("updates.latestLabel")}</span>
                    <span class="release-hero-meta">${s}</span>
                </div>
                <div class="release-hero-title">${U(o)}</div>
                ${r?`<p class="release-hero-summary">${r}</p>`:""}
            </article>
            <div class="release-section-stack">
                ${l}
            </div>
            <section class="release-history-block" aria-label="${p("updates.historyLabel")}">
                <div class="release-history-header">
                    <div>
                        <div class="release-history-label">${p("updates.historyLabel")}</div>
                        <div class="release-history-subtitle">${p("updates.subtitle")}</div>
                    </div>
                </div>
                <div class="release-history-list">
                    ${u}
                </div>
            </section>
        </div>
    `}function Uo(){let e=ke("render","dashboard",{taskCount:L.length,projectCount:N.length});Xl(),ii(),_o(),li(),nd();let t=document.getElementById("projects-stat-card");t&&(t.onclick=()=>{window.location.hash="projects"}),ye("render",e,{taskCount:L.length,projectCount:N.length})}function Xl(){let e=ke("render","dashboard-stats",{taskCount:L.length,projectCount:N.length}),t=Ws(L,N);document.getElementById("hero-active-projects").textContent=t.activeProjects,document.getElementById("hero-completion-rate").textContent=`${t.completionRate}%`;let a=document.querySelector(".progress-circle"),n=2*Math.PI*45,o=n-t.completionRate/100*n;a.style.strokeDashoffset=o,document.getElementById("ring-percentage").textContent=`${t.completionRate}%`,document.getElementById("in-progress-tasks").textContent=t.inProgressTasks,document.getElementById("pending-tasks-new").textContent=t.pendingTasks,document.getElementById("completed-tasks-new").textContent=t.completedTasks,document.getElementById("overdue-tasks").textContent=t.overdueTasks,document.getElementById("high-priority-tasks").textContent=t.highPriorityTasks,document.getElementById("research-milestones").textContent=t.milestones,ri(),ye("render",e,{activeProjects:t.activeProjects,totalTasks:t.totalTasks,completionRate:t.completionRate})}function ri(){let e=Gs(L,N);document.getElementById("progress-change").textContent=`+${e.progressChange} ${p("dashboard.trend.thisWeek")}`,document.getElementById("pending-change").textContent=e.dueTodayCount>0?p(e.dueTodayCount===1?"dashboard.trend.dueTodayOne":"dashboard.trend.dueTodayMany",{count:e.dueTodayCount}):p("dashboard.trend.onTrack"),document.getElementById("completed-change").textContent=`+${e.thisWeekCompleted} ${p("dashboard.trend.thisWeek")}`;let t=document.getElementById("overdue-change");t&&(t.textContent=e.overdueCount>0?p("dashboard.trend.needsAttention"):p("dashboard.trend.allOnTrack"),t.classList.toggle("negative",e.overdueCount>0),t.classList.toggle("positive",e.overdueCount===0),t.classList.remove("neutral")),document.getElementById("priority-change").textContent=e.criticalHighPriority>0?p(e.criticalHighPriority===1?"dashboard.trend.criticalOne":"dashboard.trend.criticalMany",{count:e.criticalHighPriority}):p("dashboard.trend.onTrack"),document.getElementById("milestones-change").textContent=e.completedProjects>0?p(e.completedProjects===1?"dashboard.trend.completedOne":"dashboard.trend.completedMany",{count:e.completedProjects}):p("dashboard.trend.inProgress")}function ii(){let e=document.getElementById("project-progress-bars");if(!e)return;let t=N.filter(n=>vt(n.id)==="active");if(t.length===0){e.innerHTML=`
            <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                <div style="font-size: 48px; margin-bottom: 16px;">\u{1F30A}</div>
                <div style="font-size: 16px; margin-bottom: 8px;">${p("dashboard.emptyProjects.title")}</div>
                <div style="font-size: 14px;">${p("dashboard.emptyProjects.subtitle")}</div>
            </div>
        `;return}let a=Ys(t,L,5);e.innerHTML=Ks(a,{tasksLabel:p("dashboard.tasks")})}function _o(){let e=document.getElementById("activity-feed");if(!e)return;let t=[];if(L.filter(s=>s.status==="done").sort((s,r)=>new Date(r.completedDate||r.createdAt||r.createdDate)-new Date(s.completedDate||s.createdAt||s.createdDate)).slice(0,3).forEach(s=>{let r=N.find(l=>l.id===s.projectId),i=s.completedDate||s.createdAt||s.createdDate,c=r?p("dashboard.activity.inProject",{project:r.name}):"";t.push({type:"completed",text:p("dashboard.activity.completed",{title:s.title,projectPart:c}).trim(),timeText:So(i),date:i,icon:"\u2705"})}),N.sort((s,r)=>new Date(r.createdAt||r.createdDate)-new Date(s.createdAt||s.createdDate)).slice(0,2).forEach(s=>{let r=s.createdAt||s.createdDate;t.push({type:"created",text:p("dashboard.activity.createdProject",{project:s.name}),timeText:So(r),date:r,icon:"\u{1F680}"})}),L.filter(s=>s.status!=="done").sort((s,r)=>new Date(r.createdAt||r.createdDate)-new Date(s.createdAt||s.createdDate)).slice(0,2).forEach(s=>{let r=s.createdAt||s.createdDate,i=N.find(l=>l.id===s.projectId),c=i?p("dashboard.activity.toProject",{project:i.name}):"";t.push({type:"created",text:p("dashboard.activity.addedTask",{title:s.title,projectPart:c}).trim(),timeText:So(r),date:r,icon:"\u{1F4DD}"})}),t.sort((s,r)=>new Date(r.date)-new Date(s.date)),t.length===0){e.innerHTML=`
            <div class="activity-item">
                <div class="activity-icon completed">\u{1F30A}</div>
                <div class="activity-content">
                    <div class="activity-text">${p("dashboard.activity.emptyTitle")}</div>
                    <div class="activity-time">${p("dashboard.activity.emptySubtitle")}</div>
                </div>
            </div>
        `;return}e.innerHTML=Js(t.slice(0,4),od)}function Ql(){window.location.hash="dashboard/recent_activity"}function ed(){window.location.hash="dashboard"}function td(){document.querySelectorAll(".page").forEach(t=>{t.classList.remove("active")});let e=document.getElementById("activity-page");if(!e){e=document.createElement("div"),e.id="activity-page",e.className="page",e.innerHTML=`
            <div class="page-header">
                <div>
                    <h1 class="page-title" data-i18n="dashboard.activity.allTitle">${p("dashboard.activity.allTitle")}</h1>
                    <p class="page-subtitle" data-i18n="dashboard.activity.allSubtitle">${p("dashboard.activity.allSubtitle")}</p>
                </div>
                <button class="view-all-btn back-btn" data-action="backToDashboard" data-i18n="dashboard.activity.backToDashboard">${p("dashboard.activity.backToDashboard")}</button>
            </div>
            <div class="page-content">
                <div id="all-activity-list" class="all-activity-list"></div>
            </div>
        `;let t=document.querySelector(".main-content");t&&t.appendChild(e)}e.classList.add("active"),e.style.display="flex",ci();try{e.scrollIntoView({behavior:"auto",block:"start"})}catch{window.scrollTo(0,0)}document.querySelectorAll(".nav-item").forEach(t=>t.classList.remove("active")),document.querySelector('.nav-item[data-page="dashboard"]').classList.add("active")}function ci(){let e=[];L.filter(o=>o.status==="done").sort((o,s)=>new Date(s.completedDate||s.createdAt||s.createdDate)-new Date(o.completedDate||o.createdAt||o.createdDate)).forEach(o=>{let s=N.find(c=>c.id===o.projectId),r=o.completedDate||o.createdAt||o.createdDate,i=s?p("dashboard.activity.inProject",{project:s.name}):"";e.push({type:"completed",text:p("dashboard.activity.completed",{title:o.title,projectPart:i}).trim(),date:r,icon:"\u2705"})}),N.sort((o,s)=>new Date(s.createdAt||s.createdDate)-new Date(o.createdAt||o.createdDate)).forEach(o=>{e.push({type:"created",text:p("dashboard.activity.createdProject",{project:o.name}),date:o.createdAt||o.createdDate,icon:"\u{1F680}"})}),L.sort((o,s)=>new Date(s.createdAt||s.createdDate)-new Date(o.createdAt||o.createdDate)).forEach(o=>{let s=N.find(i=>i.id===o.projectId),r=s?p("dashboard.activity.toProject",{project:s.name}):"";e.push({type:"created",text:p("dashboard.activity.addedTask",{title:o.title,projectPart:r}).trim(),date:o.createdAt||o.createdDate,icon:"\u{1F4DD}"})}),e.sort((o,s)=>new Date(s.date)-new Date(o.date));let a=document.getElementById("all-activity-list");if(!a)return;let n=e.map(o=>`
        <div class="activity-item-full">
            <div class="activity-icon ${o.type}">${o.icon}</div>
            <div class="activity-content">
                <div class="activity-text">${o.text}</div>
            </div>
            <div class="activity-full-date">${new Date(o.date).toLocaleDateString(Ct(),{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}</div>
        </div>
    `).join("");a.innerHTML=n}function li(){let e=document.getElementById("insights-list");if(!e)return;let a=ad().map(n=>`
        <div class="insight-item ${n.type}">
            <div class="insight-icon">${n.icon}</div>
            <div class="insight-content">
                <div class="insight-title">${n.title}</div>
                <div class="insight-desc">${n.description}</div>
            </div>
        </div>
    `).join("");e.innerHTML=a}function ad(){let e=[],t=L.length,a=L.filter(i=>i.status==="done").length,n=new Date().toISOString().split("T")[0],o=L.filter(i=>i.endDate&&i.endDate<n&&i.status!=="done").length,s=L.filter(i=>i.priority==="high").length,r=L.filter(i=>{if(!i.endDate)return!1;let c=new Date().toDateString();return new Date(i.endDate).toDateString()===c&&i.status!=="done"}).length;if(t>0){let i=a/t*100;i>=80?e.push({type:"success",icon:"\u{1F3AF}",title:p("dashboard.insights.excellentTitle"),description:p("dashboard.insights.excellentDesc",{percent:i.toFixed(0)})}):i>=60?e.push({type:"success",icon:"\u{1F4C8}",title:p("dashboard.insights.goodTitle"),description:p("dashboard.insights.goodDesc",{percent:i.toFixed(0)})}):i>=30?e.push({type:"warning",icon:"\u26A1",title:p("dashboard.insights.opportunityTitle"),description:p("dashboard.insights.opportunityDesc",{percent:i.toFixed(0)})}):e.push({type:"priority",icon:"\u{1F6A8}",title:p("dashboard.insights.actionTitle"),description:p("dashboard.insights.actionDesc",{percent:i.toFixed(0)})})}if(r>0&&e.push({type:"priority",icon:"\u{1F4C5}",title:p("dashboard.insights.todayTitle"),description:p(r===1?"dashboard.insights.todayDescOne":"dashboard.insights.todayDescMany",{count:r})}),o>0&&r===0&&e.push({type:"warning",icon:"\u23F0",title:p("dashboard.insights.overdueTitle"),description:p(o===1?"dashboard.insights.overdueDescOne":"dashboard.insights.overdueDescMany",{count:o})}),s>0){let i=L.filter(c=>c.priority==="high"&&c.status!=="done").length;i>0&&e.push({type:"priority",icon:"\u{1F525}",title:p("dashboard.insights.highPriorityTitle"),description:p(i===1?"dashboard.insights.highPriorityDescOne":"dashboard.insights.highPriorityDescMany",{count:i})})}if(N.length>1){let i=N.filter(l=>L.some(u=>u.projectId===l.id)).length,c=N.length-i;c>0&&e.push({type:"warning",icon:"\uFFFD",title:p("dashboard.insights.emptyProjectsTitle"),description:p(c===1?"dashboard.insights.emptyProjectsDescOne":"dashboard.insights.emptyProjectsDescMany",{count:c})})}if(t>=5){let i=L.filter(c=>{if(c.status!=="done"||!c.completedDate)return!1;let l=new Date;return l.setDate(l.getDate()-7),new Date(c.completedDate)>l}).length;i>=3&&e.push({type:"success",icon:"\u{1F680}",title:p("dashboard.insights.momentumTitle"),description:p(i===1?"dashboard.insights.momentumDescOne":"dashboard.insights.momentumDescMany",{count:i})})}return e.length===0&&(t===0?e.push({type:"priority",icon:"\u{1F30A}",title:p("dashboard.insights.readyTitle"),description:p("dashboard.insights.readyDesc")}):e.push({type:"success",icon:"\u2705",title:p("dashboard.insights.caughtUpTitle"),description:p("dashboard.insights.caughtUpDesc")})),e.slice(0,3)}function nd(){document.querySelectorAll(".enhanced-stat-card").forEach((a,n)=>{a.style.opacity="0",a.style.transform="translateY(20px)",setTimeout(()=>{a.style.transition="all 0.4s ease",a.style.opacity="1",a.style.transform="translateY(0)"},n*100)}),document.querySelectorAll(".hero-stat-card").forEach((a,n)=>{a.style.opacity="0",a.style.transform="translateX(-30px)",setTimeout(()=>{a.style.transition="all 0.6s ease",a.style.opacity="1",a.style.transform="translateX(0)"},n*200)})}function So(e){if(!e)return p("dashboard.activity.recently");let t=new Date(e),n=Math.floor((new Date-t)/1e3);if(n<60)return p("dashboard.activity.justNow");if(n<3600){let o=Math.floor(n/60);return p(o===1?"dashboard.activity.minuteAgo":"dashboard.activity.minutesAgo",{count:o})}if(n<86400){let o=Math.floor(n/3600);return p(o===1?"dashboard.activity.hourAgo":"dashboard.activity.hoursAgo",{count:o})}if(n<604800){let o=Math.floor(n/86400);return p(o===1?"dashboard.activity.dayAgo":"dashboard.activity.daysAgo",{count:o})}return t.toLocaleDateString(Ct())}function od(e){if(!e)return"";let t=new Date(e),n=Math.floor((new Date-t)/(1e3*60*60*24));return n===0?p("dashboard.activity.today"):n===1?p("dashboard.activity.yesterday"):n<7?p("dashboard.activity.daysAgoShort",{count:n}):t.toLocaleDateString(Ct(),{month:"short",day:"numeric"})}function sd(){window.authSystem&&window.authSystem.logout&&window.authSystem.logout()}function rd(){document.getElementById("export-data-modal").classList.add("active")}function di(){document.getElementById("export-data-modal").classList.remove("active")}function id(){di();let e=window.authSystem?window.authSystem.getCurrentUser():null,t={user:e?{id:e.id,username:e.username,name:e.name,email:e.email}:null,projects:N,tasks:L,feedbackItems:re,projectColors:wt,sortMode:ze,manualTaskOrder:me,settings:M,history:window.historyService?window.historyService.getHistory():[],projectCounter:st,taskCounter:Ge,statistics:{totalProjects:N.length,totalTasks:L.length,completedTasks:L.filter(i=>i.status==="done").length,completionRate:L.length>0?(L.filter(i=>i.status==="done").length/L.length*100).toFixed(1):0,feedbackCount:re.length},exportDate:new Date().toISOString(),exportVersion:"2.0",sourceSystem:"Nautilus Multi-User"},a=JSON.stringify(t,null,2),n="data:application/json;charset=utf-8,"+encodeURIComponent(a),s=`nautilus-complete-backup-${e?.username||"user"}-${new Date().toISOString().split("T")[0]}.json`,r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",s),r.click(),_t("Complete backup exported successfully! All data, settings, and history included.","success")}async function cd(){_t("Generando reporte...","info");try{let{generateWordReport:e}=await Promise.resolve().then(()=>(br(),vr)),t=await e(N,L);if(t.success)_t(`\u2705 Reporte generado: ${t.filename}`,"success"),console.log("Report Summary:",{activeProjects:t.insights.activeProjectsCount,completedTasks:`${t.insights.completedTasks}/${t.insights.totalTasks}`,progress:`${t.insights.completionPercent}%`});else throw new Error(t.error)}catch(e){console.error("Error generating report:",e),_t("\u274C Error al generar el reporte: "+e.message,"error")}}function Oe(){document.getElementById("projects-count").textContent=N.length,document.getElementById("tasks-count").textContent=L.length;let e=document.getElementById("active-projects"),t=document.getElementById("pending-tasks"),a=document.getElementById("completed-tasks");e&&(e.textContent=N.length),t&&(t.textContent=L.filter(l=>l.status!=="done").length),a&&(a.textContent=L.filter(l=>l.status==="done").length);let n=document.getElementById("todo-count"),o=document.getElementById("progress-count"),s=document.getElementById("review-count"),r=document.getElementById("done-count");n&&(n.textContent=L.filter(l=>l.status==="todo").length),o&&(o.textContent=L.filter(l=>l.status==="progress").length),s&&(s.textContent=L.filter(l=>l.status==="review").length),r&&(r.textContent=L.filter(l=>l.status==="done").length);let i=re.filter(l=>l.status==="open").length,c=document.getElementById("feedback-count");c&&(c.textContent=i),Mt()}var Vt={column:null,direction:"asc"};function ld(e){Vt.column===e?Vt.direction=Vt.direction==="asc"?"desc":"asc":(Vt.column=e,Vt.direction="asc"),document.querySelectorAll(".tasks-table th .sort-indicator").forEach(a=>{a.textContent="\u2195",a.style.opacity="0.5"});let t=document.getElementById(`sort-${e}`);t&&(t.textContent=Vt.direction==="asc"?"\u2191":"\u2193",t.style.opacity="1"),rt()}function rt(){let e=document.getElementById("tasks-table-body"),t=typeof yt=="function"?yt():L.slice(),a=ta(window.kanbanUpdatedFilter),o=or(t,{currentSort:Vt,projects:N,updatedCutoff:a,getTaskUpdatedTime:At}).tasks,s=p("tasks.list.count",{count:o.length})||`${o.length} results`,r=document.getElementById("tasks-list-count");r&&(r.textContent=s);let i=document.getElementById("tasks-list-count-bottom");if(i&&(i.textContent=s),e){let c={escapeHtml:U,formatDate:pe,getTagColor:Xt,getProjectColor:Te,getPriorityLabel:et,getStatusLabel:He,formatTaskUpdatedDateTime:_s,projects:N,noProjectText:p("tasks.noProject"),noDateText:p("tasks.noDate")};e.innerHTML=nr(o,c)}ud(o)}function dd(e,t=null){let a=ar(e,t);if(!a.hasDate)return{text:p("tasks.noEndDate"),class:"",showPrefix:!1};let n;switch(a.urgency){case"overdue":n=a.daysOverdue===1?p("tasks.due.yesterday"):p("tasks.due.daysOverdue",{count:a.daysOverdue});break;case"tomorrow":n=p("tasks.due.tomorrow");break;default:n=pe(e)}return{text:n,class:a.class,showPrefix:a.showPrefix}}function ud(e){let t=document.getElementById("tasks-list-mobile");if(!t)return;let a=new Set(Array.from(t.querySelectorAll(".task-card-mobile.expanded")).map(o=>parseInt(o.dataset.taskId,10)).filter(Number.isFinite)),n=o=>{let s=document.createElement("div");s.innerHTML=o||"";let r=Array.from(s.querySelectorAll(".checkbox-row")),i=r.map(u=>{let d=u.querySelector(".checkbox-toggle"),f=d?.getAttribute("aria-pressed")==="true"||d?.classList?.contains("checked"),m=(u.querySelector(".check-text")?.textContent||"").trim();return m?`${f?"\u2713":"\u2610"} ${m}`:null}).filter(Boolean);r.forEach(u=>u.remove());let c=(s.textContent||s.innerText||"").replace(/\s+/g," ").trim(),l=i.join(`
`).trim();return c&&l?`${c}
${l}`:c||l};if(e.length===0){t.innerHTML=`
            <div class="tasks-list-mobile-empty">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
                <h3>${p("projects.details.noTasksFound")}</h3>
                <p>Try adjusting your filters or create a new task</p>
            </div>
        `;return}t.innerHTML=e.map(o=>{let s=N.find(f=>f.id===o.projectId),r=s?Te(s.id):"#999",i=dd(o.endDate,o.status),c=n(o.description),l=o.tags&&o.tags.length>0?o.tags.map(f=>{let m=Xt(f);return`<span class="card-tag-premium" style="background:${m}; border-color:${m}; color:#ffffff;">${U(f.toUpperCase())}</span>`}).join(""):"",u=o.attachments&&o.attachments.length>0?o.attachments.length:0;return`
            <div class="task-card-mobile${o.status==="done"?" is-done":""}" data-priority="${o.priority}" data-task-id="${o.id}">
                <!-- Header (always visible) -->
                <div class="card-header-premium">
                    <div class="card-header-content" data-card-action="toggle">
                        <h3 class="card-title-premium">${U(o.title||p("tasks.untitled"))}</h3>
                        <div class="card-meta-premium">
                            <span class="status-badge-mobile ${o.status}">${He(o.status)}</span>
                            ${i.text?`<span class="card-date-smart ${i.class}">${i.showPrefix?p("tasks.endDatePrefix"):""}${i.text}</span>`:""}
                        </div>
                    </div>
                    <div class="card-actions-premium">
                        <button class="card-open-btn-premium" data-card-action="open" title="${p("tasks.openTaskDetails")}">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </button>
                        <svg class="card-chevron-premium" data-card-action="toggle" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </div>

                <!-- Expandable body -->
                <div class="card-body-premium">
                    ${c?`
                    <div class="card-description-premium">
                        <div class="card-description-premium-label">${p("tasks.card.description")}</div>
                        <div class="card-description-premium-text">${U(c)}</div>
                    </div>
                    `:""}

                    ${l?`
                    <div class="card-tags-premium">${l}</div>
                    `:""}

                    ${s?`
                    <div class="card-project-premium">
                        <span class="card-project-dot-premium" style="background-color: ${r};"></span>
                        <span class="card-project-name-premium">${U(s.name)}</span>
                    </div>
                    `:""}

                    <div class="card-footer-premium">
                        ${o.startDate?`
                        <div class="card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${p("tasks.startDatePrefix")}${pe(o.startDate)}</span>
                        </div>
                        `:""}
                        ${o.endDate?`
                        <div class="card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${p("tasks.endDatePrefix")}${pe(o.endDate)}</span>
                        </div>
                        `:""}
                        ${u>0?`
                        <div class="card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                            </svg>
                            <span>${u}</span>
                        </div>
                        `:""}
                    </div>
                </div>
            </div>
        `}).join(""),pd(),a.size>0&&a.forEach(o=>{let s=t.querySelector(`.task-card-mobile[data-task-id="${o}"]`);s&&s.classList.add("expanded")})}function pd(){document.querySelectorAll(".task-card-mobile").forEach(t=>{let a=parseInt(t.dataset.taskId),n=t.querySelectorAll('[data-card-action="toggle"]'),o=t.querySelector('[data-card-action="open"]');n.forEach(s=>{s.addEventListener("click",r=>{r.stopPropagation(),document.querySelectorAll(".task-card-mobile.expanded").forEach(i=>{i!==t&&i.classList.remove("expanded")}),t.classList.toggle("expanded")})}),o&&o.addEventListener("click",s=>{s.stopPropagation(),va(a)})})}document.addEventListener("click",function(e){e.target.closest(".multi-select-wrapper")||document.querySelectorAll(".multi-select.active").forEach(t=>t.classList.remove("active"))});function Vo(e){return lr(e,L,{escapeHtml:U,formatDatePretty:nn,getProjectColor:Te,getProjectStatus:vt,getProjectStatusLabel:Ha,getTagColor:Xt,getPriorityLabel:et,getStatusLabel:He,getLocale:Ct,t:p})}var fn=null;function md(e=document){(e.querySelectorAll?.(".expanded-task-item")||[]).forEach(a=>{if(a.offsetParent===null)return;a.classList.remove("expanded-task-item--stacked");let n=a.querySelector(".expanded-task-meta");if(!n)return;let o=n.querySelector(".task-tags"),s=n.querySelector(".expanded-task-dates"),r=c=>c&&c.clientWidth>0&&c.scrollWidth>c.clientWidth+1;(r(a)||r(n)||r(o)||r(s))&&a.classList.add("expanded-task-item--stacked")})}function Rn(e=document){fn!==null&&cancelAnimationFrame(fn),fn=requestAnimationFrame(()=>{fn=null,md(e)})}function _e(){let e=ke("render","projects",{projectCount:N.length}),t=document.getElementById("projects-list");if(N.length===0){t.innerHTML=`<div class="empty-state"><h3>${p("projects.empty.title")}</h3><p>${p("projects.empty.subtitle")}</p></div>`;let o=document.getElementById("projects-list-mobile");o&&(o.innerHTML=""),ye("render",e,{projectCount:N.length,rendered:0});return}let a=new Set;t.querySelectorAll(".project-list-item.expanded").forEach(o=>{let s=o.id.replace("project-item-","");a.add(s)});let n=te.projectsSortedView||N;t.innerHTML=n.map(Vo).join(""),a.forEach(o=>{let s=document.getElementById(`project-item-${o}`);s&&s.classList.add("expanded")}),xn(n),Rn(t),ye("render",e,{projectCount:N.length,rendered:n.length})}function ui(e){let t=document.getElementById(`project-item-${e}`);t&&(t.classList.toggle("expanded"),Rn(t))}window.toggleProjectExpand=ui;function xn(e){let t=document.getElementById("projects-list-mobile");if(t){if(e.length===0){t.innerHTML=`
            <div class="projects-list-mobile-empty">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                </svg>
                <h3>${p("projects.empty.searchTitle")}</h3>
                <p>${p("projects.empty.searchSubtitle")}</p>
            </div>
        `;return}t.innerHTML=e.map(a=>{let n=L.filter(m=>m.projectId===a.id),o=n.filter(m=>m.status==="done").length,s=n.filter(m=>m.status==="progress").length,r=n.filter(m=>m.status==="review").length,i=n.filter(m=>m.status==="todo").length,c=n.filter(m=>m.status==="backlog").length,l=n.length,u=l>0?Math.round(o/l*100):0,d=Te(a.id),f=vt(a.id);return`
            <div class="project-card-mobile" data-project-id="${a.id}">
                <!-- Header (always visible) -->
                <div class="project-card-header-premium">
                    <div class="project-card-header-content" data-card-action="toggle">
                        <div class="project-card-title-row">
                            <span class="project-swatch-mobile" style="background: ${d};"></span>
                            <h3 class="project-card-title-premium">${U(a.name||"Untitled Project")}</h3>
                        </div>
                        <div class="project-card-meta-premium">
                            <span class="project-status-badge-mobile ${f}">${Ha(f)}</span>
                            <span class="project-card-tasks-count">${p("projects.card.tasksCount",{count:l})}</span>
                            ${u>0?`<span class="project-card-completion">${p("projects.card.percentDone",{count:u})}</span>`:""}
                        </div>
                    </div>
                    <div class="project-card-actions-premium">
                        <button class="project-card-open-btn-premium" data-action="showProjectDetails" data-param="${a.id}" title="${p("projects.openDetailsTitle")}">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </button>
                        <svg class="project-card-chevron-premium" data-card-action="toggle" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </div>

                <!-- Expandable body -->
                <div class="project-card-body-premium">
                    ${a.tags&&a.tags.length>0?`
                    <div class="project-card-tags-premium" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px;">
                        ${a.tags.map(m=>`<span style="background-color: ${Te(a.id)}; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: 500;">${U(m.toUpperCase())}</span>`).join("")}
                    </div>
                    `:""}

                    ${a.description?`
                    <div class="project-card-description-premium">
                        <div class="project-card-description-label">${p("tasks.card.description")}</div>
                        <div class="project-card-description-text">${U(a.description)}</div>
                    </div>
                    `:""}

                    <div class="project-card-footer-premium">
                        ${a.startDate?`
                        <div class="project-card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${p("projects.details.startDate")}: ${pe(a.startDate)}</span>
                        </div>
                        `:""}
                        ${a.endDate?`
                        <div class="project-card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${p("tasks.endDatePrefix")}${pe(a.endDate)}</span>
                        </div>
                        `:""}
                    </div>

                    ${l>0?`
                    <div class="project-card-progress-premium">
                        <div class="project-card-progress-label">${p("projects.details.taskProgress")}</div>
                        <div class="project-card-progress-bar">
                            <div class="progress-segment done" style="width: ${o/l*100}%;"></div>
                            <div class="progress-segment progress" style="width: ${s/l*100}%;"></div>
                            <div class="progress-segment review" style="width: ${r/l*100}%;"></div>
                            <div class="progress-segment todo" style="width: ${i/l*100}%;"></div>
                            <div class="progress-segment backlog" style="width: ${c/l*100}%;"></div>
                        </div>
                        <div class="project-card-breakdown">
                            ${o>0?`<span class="breakdown-item done">${o} ${p("tasks.status.done")}</span>`:""}
                            ${s>0?`<span class="breakdown-item progress">${s} ${p("tasks.status.progress")}</span>`:""}
                            ${r>0?`<span class="breakdown-item review">${r} ${p("tasks.status.review")}</span>`:""}
                            ${i>0?`<span class="breakdown-item todo">${i} ${p("tasks.status.todo")}</span>`:""}
                            ${c>0?`<span class="breakdown-item backlog">${c} ${p("tasks.status.backlog")}</span>`:""}
                        </div>
                    </div>
                    `:""}
                </div>
            </div>
        `}).join(""),fd()}}function fd(){document.querySelectorAll(".project-card-mobile").forEach(t=>{let a=parseInt(t.dataset.projectId),n=t.querySelectorAll('[data-card-action="toggle"]'),o=t.querySelector('[data-action="showProjectDetails"]');n.forEach(s=>{s.addEventListener("click",r=>{r.stopPropagation(),document.querySelectorAll(".project-card-mobile.expanded").forEach(i=>{i!==t&&i.classList.remove("expanded")}),t.classList.toggle("expanded")})}),o&&o.addEventListener("click",s=>{s.stopPropagation(),Ae(a)})})}function Me(){let e=ke("render","tasks",{taskCount:L.length}),t=typeof yt=="function"?yt():L.slice(),a=ta(window.kanbanUpdatedFilter),n=Qs(t,{showBacklog:window.kanbanShowBacklog===!0,sortMode:ze,manualTaskOrder:me,updatedCutoff:a,getTaskUpdatedTime:At}),o=n.byStatus,s=n.totalFiltered,r={backlog:document.getElementById("backlog-tasks"),todo:document.getElementById("todo-tasks"),progress:document.getElementById("progress-tasks"),review:document.getElementById("review-tasks"),done:document.getElementById("done-tasks")},i=n.counts,c=document.getElementById("backlog-count"),l=document.getElementById("todo-count"),u=document.getElementById("progress-count"),d=document.getElementById("review-count"),f=document.getElementById("done-count");c&&(c.textContent=i.backlog),l&&(l.textContent=i.todo),u&&(u.textContent=i.progress),d&&(d.textContent=i.review),f&&(f.textContent=i.done);let m={escapeHtml:U,formatDate:pe,getProjectColor:Te,getTagColor:Xt,getPriorityLabel:et,projects:N,selectedCards:te.selectedCards,showProjects:window.kanbanShowProjects!==!1,showNoDate:window.kanbanShowNoDate!==!1,noProjectText:p("tasks.noProject"),noDateText:p("tasks.noDate")};["backlog","todo","progress","review","done"].forEach(g=>{let y=r[g];y&&(y.innerHTML=er(o[g],m))}),vd(),Dt(),ye("render",e,{taskCount:L.length,filteredCount:t.length,kanbanCount:s})}function pa(){if(window.innerWidth>768)return;let e=document.getElementById("task-modal");if(!e)return;let a=e.querySelector("#task-form")?.dataset.editingTaskId;if(!a)return;let n=e.dataset.initialStartDate==="true",o=e.dataset.initialEndDate==="true",s=null;a&&(s=L.find(w=>w.id===parseInt(a,10))),s||(s={tags:window.tempTags||[],attachments:je||[]});let r=dr(s,{startDateWasEverSet:n,endDateWasEverSet:o}),i=e.querySelector("#tag-input"),c=i?i.closest(".form-group"):null,l=e.querySelectorAll('input[name="startDate"]'),u=null;for(let w of l){let C=w.closest(".form-group");if(C){u=C;break}}let d=e.querySelectorAll('input[name="endDate"]'),f=null;for(let w of d){let C=w.closest(".form-group");if(C){f=C;break}}let m=e.querySelector("#attachments-links-list"),g=m?m.closest(".form-group"):null;c&&(c.classList.toggle("mobile-general-field",r.tagsInGeneral),c.classList.toggle("mobile-details-field",!r.tagsInGeneral)),u&&(u.classList.toggle("mobile-general-field",r.startDateInGeneral),u.classList.toggle("mobile-details-field",!r.startDateInGeneral)),f&&(f.classList.toggle("mobile-general-field",r.endDateInGeneral),f.classList.toggle("mobile-details-field",!r.endDateInGeneral)),g&&(g.classList.toggle("mobile-general-field",r.linksInGeneral),g.classList.toggle("mobile-details-field",!r.linksInGeneral));let y=e.querySelector('.modal-tab[data-tab="details"]'),v=ur(r);console.log("\u{1F504} Reorganizing fields:",{...r,hideDetailsTab:v}),y&&(v?(console.log("\u2705 Hiding Details tab - Tags and Links both filled"),y.classList.add("hide-details-tab")):(console.log("\u{1F441}\uFE0F Showing Details tab - some dynamic fields empty"),y.classList.remove("hide-details-tab")))}var Ht=null;function va(e,t=null){let a=L.find(I=>I.id===e);if(!a)return;let n=document.getElementById("task-modal");if(!n)return;Ht=t;let o=n.querySelector('.modal-tab[data-tab="general"]'),s=n.querySelector('.modal-tab[data-tab="details"]'),r=n.querySelector('.modal-tab[data-tab="history"]'),i=n.querySelector("#task-details-tab"),c=n.querySelector("#task-history-tab");o&&o.classList.add("active"),s&&s.classList.remove("active"),r&&r.classList.remove("active"),i&&i.classList.add("active"),c&&c.classList.remove("active"),document.body.classList.remove("mobile-tab-details-active"),r&&(r.style.display="");let l=n.querySelector(".modal-content");l&&(l.style.minHeight="",l.style.maxHeight="");let u=n.querySelector("h2");u&&(u.textContent="Edit Task");let d=n.querySelector(".modal-close");d&&(d.style.display="inline-block");let f=n.querySelector("#task-options-btn");f&&(f.style.display="inline-block");let m=n.querySelector("#task-footer");m&&(m.style.display="none"),fi();let g=n.querySelector("#hidden-project"),y=n.querySelector("#project-current");if(g&&y){g.value=a.projectId||"";let I=y.querySelector(".project-text");if(I)if(a.projectId){let P=N.find(j=>j.id===a.projectId);if(P){let j=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Te(P.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;I.innerHTML=j+U(P.name)}else I.textContent=p("tasks.project.selectPlaceholder")}else I.textContent=p("tasks.project.selectPlaceholder");qn(a.projectId||"")}let v=n.querySelector('#task-form input[name="title"]');v&&(v.value=a.title||"");let w=n.querySelector("#task-description-editor");w&&(w.innerHTML=a.description||"");let C=n.querySelector("#task-description-hidden");C&&(C.value=a.description||"");let T=n.querySelector("#hidden-priority");T&&(T.value=a.priority||"medium");let E=n.querySelector("#priority-current");if(E){let I=a.priority||"medium";E.innerHTML=`<span class="priority-dot ${I}"></span> ${et(I)} <span class="dropdown-arrow">\u25BC</span>`,In(I)}let D=n.querySelector("#hidden-status");D&&(D.value=a.status||"todo");let b=n.querySelector("#status-current");if(b){let I=b.querySelector(".status-badge");I&&(I.className="status-badge "+(a.status||"todo"),I.textContent=He(a.status||"todo")),Lo(a.status||"todo")}let S="";typeof a.startDate=="string"&&(at(a.startDate)?S=a.startDate:Ye(a.startDate)&&(S=dt(a.startDate)));let x="";typeof a.endDate=="string"&&(at(a.endDate)?x=a.endDate:Ye(a.endDate)&&(x=dt(a.endDate)));let $=n.querySelector('#task-form input[name="startDate"]'),z=n.querySelector('#task-form input[name="endDate"]'),O=$?$.parentElement:null,k=z?z.parentElement:null,A=O&&O.classList.contains("date-input-wrapper")?O.querySelector("input.date-display"):null,V=k&&k.classList.contains("date-input-wrapper")?k.querySelector("input.date-display"):null,G=A&&A._flatpickr,Y=V&&V._flatpickr;G&&Y?(A&&A._flatpickr&&($.value=S||"",S?A._flatpickr.setDate(new Date(S),!1):A._flatpickr.clear()),V&&V._flatpickr&&(z.value=x||"",x?V._flatpickr.setDate(new Date(x),!1):V._flatpickr.clear())):n.querySelectorAll('input[name="startDate"], input[name="endDate"]').forEach(P=>{P._flatpickrInstance&&(P._flatpickrInstance.destroy(),P._flatpickrInstance=null),P._wrapped=!1;let j=P.closest(".date-input-wrapper");j&&(j.parentNode.insertBefore(P,j),j.remove()),P.type="date",P.style.display=""});let K=n.querySelector("#task-form");if(K&&(K.dataset.editingTaskId=String(e)),Ut(a.attachments||[]),fa(a.tags||[]),window.innerWidth<=768&&e){let I=Array.isArray(a.tags)&&a.tags.length>0,P=typeof a.startDate=="string"&&a.startDate.trim()!=="",j=typeof a.endDate=="string"&&a.endDate.trim()!=="",B=Array.isArray(a.attachments)&&a.attachments.some(de=>de.type==="link"||de.url&&de.type!=="file"),H=!!a.startDateWasEverSet||P,J=!!a.endDateWasEverSet||j;n.dataset.initialStartDate=H?"true":"false",n.dataset.initialEndDate=J?"true":"false";let X=n.querySelector("#tag-input"),Q=X?X.closest(".form-group"):null,_=n.querySelectorAll('input[name="startDate"]'),ae=null;for(let de of _){let be=de.closest(".form-group");if(be&&be.classList.contains("mobile-details-field")){ae=be;break}}let R=n.querySelectorAll('input[name="endDate"]'),ne=null;for(let de of R){let be=de.closest(".form-group");if(be&&be.classList.contains("mobile-details-field")){ne=be;break}}let ue=n.querySelector("#attachments-links-list"),ce=ue?ue.closest(".form-group"):null;Q&&(I?(Q.classList.remove("mobile-details-field"),Q.classList.add("mobile-general-field")):(Q.classList.remove("mobile-general-field"),Q.classList.add("mobile-details-field"))),ae&&(H?(ae.classList.remove("mobile-details-field"),ae.classList.add("mobile-general-field")):(ae.classList.remove("mobile-general-field"),ae.classList.add("mobile-details-field"))),ne&&(J?(ne.classList.remove("mobile-details-field"),ne.classList.add("mobile-general-field")):(ne.classList.remove("mobile-general-field"),ne.classList.add("mobile-details-field"))),ce&&(B?(ce.classList.remove("mobile-details-field"),ce.classList.add("mobile-general-field")):(ce.classList.remove("mobile-general-field"),ce.classList.add("mobile-details-field")));let xe=I&&B;console.log("\u{1F50D} Details Tab Logic:",{hasTags:I,hasStartDate:P,hasEndDate:j,hasLinks:B,allDetailsFilled:xe,tags:a.tags,startDate:a.startDate,endDate:a.endDate,attachments:a.attachments}),s&&(xe?(console.log("\u2705 Hiding Details tab - all fields filled"),s.classList.add("hide-details-tab")):(console.log("\u{1F441}\uFE0F Showing Details tab - some fields empty"),s.classList.remove("hide-details-tab")))}n.classList.add("active"),kd(),setTimeout(()=>{if((!G||!Y)&&($&&($.value=S||""),z&&(z.value=x||""),xt()),$){let I=$.parentElement;if(I&&I.classList.contains("date-input-wrapper")){let P=I.querySelector("input.date-display");P&&($.value=S||"",P._flatpickr&&(S?P._flatpickr.setDate(new Date(S),!1):P._flatpickr.clear()))}}if(z){let I=z.parentElement;if(I&&I.classList.contains("date-input-wrapper")){let P=I.querySelector("input.date-display");P&&(z.value=x||"",P._flatpickr&&(x?P._flatpickr.setDate(new Date(x),!1):P._flatpickr.clear()))}}},0),setTimeout(()=>{n.querySelectorAll('input[name="startDate"], input[name="endDate"]').forEach(P=>{P.removeEventListener("change",pa),P.addEventListener("change",pa)})},50),setTimeout(()=>{let I=n.querySelector(".modal-body");I&&(I.scrollTop=0)},0)}function gd(){let e=document.getElementById("task-form").dataset.editingTaskId;if(!e||!L.find(o=>o.id===parseInt(e)))return;document.getElementById("confirm-modal").classList.add("active");let a=document.getElementById("confirm-input");a.value="",a.focus();let n=function(o){let s=o.target.selectionStart,r=o.target.selectionEnd;o.target.value=o.target.value.toLowerCase(),o.target.setSelectionRange(s,r)};a.addEventListener("input",n),document.addEventListener("keydown",function(o){let s=document.getElementById("confirm-modal");!s||!s.classList.contains("active")||(o.key==="Escape"?(o.preventDefault(),Wo()):o.key==="Enter"&&(o.preventDefault(),pi()))})}async function hd(){let t=document.getElementById("task-form")?.dataset.editingTaskId;if(!t)return;let a=Bs(parseInt(t,10),L,Ge);if(!a.task)return;L=a.tasks,Ge=a.taskCounter;let n=a.task;n&&n.projectId&&(Wt(n.projectId),Gt(n.projectId,"added",n),Qe().catch(()=>{}));let o=document.getElementById("options-menu");o&&(o.style.display="none"),Ue("task-modal"),Va(),ya(),Qt(),document.getElementById("project-details").classList.contains("active")&&n.projectId?Ae(n.projectId):zt(),document.getElementById("calendar-view")&&ie(),Oe(),qe().catch(i=>{console.error("Failed to save duplicated task:",i),W(p("error.saveTaskFailed"))})}function Wo(){document.getElementById("confirm-modal").classList.remove("active"),document.getElementById("confirm-error").classList.remove("show")}function yd(){let e=document.getElementById("status-info-modal");e&&e.classList.add("active")}async function pi(){let e=document.getElementById("confirm-input"),t=document.getElementById("confirm-error");if(e.value==="delete"){let n=document.getElementById("task-form").dataset.editingTaskId,o=As(parseInt(n,10),L);if(!o.task)return;window.historyService&&window.historyService.recordTaskDeleted(o.task);let s=o.task&&o.projectId&&document.getElementById("project-details").classList.contains("active"),r=o.projectId;L=o.tasks,r&&(Wt(r),Gt(r,"removed",o.task),Qe().catch(()=>{})),Wo(),Ue("task-modal"),Va(),ya(),Qt(),s&&r?Ae(r):zt(),document.getElementById("calendar-view")&&ie(),Oe(),qe().catch(c=>{console.error("Failed to save task deletion:",c),W(p("error.saveChangesFailed"))})}else t.classList.add("show"),e.focus()}function vd(){let e=[],t=null,a=null,n=!0,o=null,s=null,r=80,i=20;function c(g){let y=g;for(;y&&y!==document.body;){let w=getComputedStyle(y).overflowY;if((w==="auto"||w==="scroll"||w==="overlay")&&y.scrollHeight>y.clientHeight)return y;y=y.parentElement}return window}function l(g,y){u(),s=setInterval(()=>{try{y===window?window.scrollBy({top:g==="down"?i:-i,left:0}):y.scrollTop+=g==="down"?i:-i}catch{}},50)}function u(){s&&(clearInterval(s),s=null)}document.querySelectorAll(".task-card").forEach(g=>{g.addEventListener("dragstart",y=>{let v=parseInt(g.dataset.taskId),w=L.find(T=>T.id===v);t=w?w.status:null,te.selectedCards.has(v)?e=Array.from(te.selectedCards):e=[v],n=e.length===1,g.classList.add("dragging"),g.style.opacity="0.5",o=document.createElement("div"),o.className="drag-placeholder active",o.setAttribute("aria-hidden","true");let C=g.offsetHeight;o.style.height=C+"px",o.style.margin="8px 0",o.style.opacity="1",document.querySelectorAll(".kanban-column").forEach(T=>{T.style.backgroundColor="var(--bg-tertiary)",T.style.border="2px dashed var(--accent-blue)"}),y.dataTransfer.effectAllowed="move";try{y.dataTransfer.setData("text/plain",String(v))}catch{}}),g.addEventListener("dragend",y=>{g.classList.remove("dragging"),g.style.opacity="1",e=[],t=null,a=null,n=!0;try{o&&o.parentNode&&o.parentNode.removeChild(o)}catch{}o=null,document.querySelectorAll(".kanban-column").forEach(v=>{v.style.backgroundColor="",v.style.border="",v.classList.remove("drag-over")}),document.querySelectorAll(".task-card").forEach(v=>{v.classList.remove("drag-over-top","drag-over-bottom")}),u()}),g.addEventListener("dragover",y=>{if(e.length===0)return;y.preventDefault();let v=parseInt(g.dataset.taskId,10);if(e.includes(v))return;let w=g.getBoundingClientRect(),C=y.clientY,T=w.top+w.height/2,E=C<T;a={card:g,isTop:E}}),g.addEventListener("dragleave",y=>{a&&a.card===g&&(a=null)}),g.addEventListener("click",y=>{let v=parseInt(g.dataset.taskId,10);if(isNaN(v))return;let w=y.ctrlKey||y.metaKey;if(y.shiftKey){y.preventDefault(),y.stopPropagation();let E=g.closest(".kanban-column")||document,D=Array.from(E.querySelectorAll(".task-card")),b=null;Number.isInteger(te.lastSelectedCardId)&&(b=D.find(O=>parseInt(O.dataset.taskId,10)===te.lastSelectedCardId)),b||(b=D.find(O=>te.selectedCards.has(parseInt(O.dataset.taskId,10)))||g);let S=D.indexOf(b),x=D.indexOf(g);if(w||uo(),S===-1||x===-1){g.classList.add("selected"),te.selectedCards.add(v),te.lastSelectedCardId=v;return}let $=Math.min(S,x),z=Math.max(S,x);for(let O=$;O<=z;O++){let k=D[O],A=parseInt(k.dataset.taskId,10);isNaN(A)||(k.classList.add("selected"),te.selectedCards.add(A))}te.lastSelectedCardId=v;return}if(w){y.preventDefault(),y.stopPropagation(),g.classList.toggle("selected"),g.classList.contains("selected")?te.selectedCards.add(v):te.selectedCards.delete(v),te.lastSelectedCardId=v;return}va(v)})});let f=document.querySelectorAll(".kanban-column"),m=["backlog","todo","progress","review","done"];f.forEach((g,y)=>{g.addEventListener("dragover",v=>{if(v.preventDefault(),g.classList.add("drag-over"),g.style.backgroundColor="var(--hover-bg)",!o)return;let w=g.querySelector('[id$="-tasks"]');if(!w)return;let C=m[y],T=Array.from(w.querySelectorAll(".task-card:not(.dragging)")),E=v.clientY;if(o.parentNode&&o.remove(),T.length===0)w.appendChild(o);else{let D=null;for(let b of T){let S=b.getBoundingClientRect(),x=S.top+S.height/2;if(E<x){D=b;break}}D?w.insertBefore(o,D):w.appendChild(o)}try{let D=c(g),b=v.clientY,S=b,x=window.innerHeight-b;S<r?l("up",D):x<r?l("down",D):u()}catch{u()}}),g.addEventListener("dragleave",v=>{g.contains(v.relatedTarget)||(g.classList.remove("drag-over"),g.style.backgroundColor="var(--bg-tertiary)")}),g.addEventListener("drop",async v=>{if(v.preventDefault(),g.classList.remove("drag-over"),g.style.backgroundColor="var(--bg-tertiary)",e.length===0)return;let w=m[y],C=g.querySelector('[id$="-tasks"]');if(C)if(n){ze!=="manual"&&(ze="manual",["backlog","todo","progress","review","done"].forEach(S=>{me[S]=L.filter(x=>x.status===S).slice().sort((x,$)=>(oe[$.priority]||0)-(oe[x.priority]||0)).map(x=>x.id)}),Dt(),xa()),Object.keys(me).forEach(S=>{Array.isArray(me[S])&&(me[S]=me[S].filter(x=>!e.includes(x)))});let T=L.filter(S=>S.status===w&&!e.includes(S.id)),E;if(Array.isArray(me[w])&&me[w].length){let S=new Set(T.map($=>$.id));E=me[w].filter($=>S.has($));let x=T.filter($=>!E.includes($.id)).slice().sort(($,z)=>(oe[z.priority]||0)-(oe[$.priority]||0)).map($=>$.id);E=E.concat(x)}else E=T.slice().sort((S,x)=>(oe[x.priority]||0)-(oe[S.priority]||0)).map(S=>S.id);let D=E.length;if(o&&o.parentNode===C){let S=Array.from(C.querySelectorAll(".task-card:not(.dragging)")),x=-1,$=Array.from(C.children);for(let z=0;z<$.length;z++)if($[z]===o){x=z;break}if(x!==-1){let z=0;for(let O=0;O<x;O++)$[O].classList&&$[O].classList.contains("task-card")&&z++;D=z}}E.splice(D,0,...e),me[w]=E,e.forEach(S=>{let x=L.find($=>$.id===S);if(x&&x.status!==w){let z=JSON.parse(JSON.stringify(x));if(x.status=w,x.updatedAt=new Date().toISOString(),M.autoSetStartDateOnStatusChange||M.autoSetEndDateOnStatusChange){let O=new Date().toISOString().split("T")[0];M.autoSetStartDateOnStatusChange&&w==="progress"&&!x.startDate&&(x.startDate=O),M.autoSetEndDateOnStatusChange&&w==="done"&&!x.endDate&&(x.endDate=O)}w==="done"&&!x.completedDate&&(x.completedDate=new Date().toISOString()),window.historyService&&window.historyService.recordTaskUpdated(z,x)}}),xa(),uo(),zt(),document.getElementById("calendar-view")&&ie();try{o&&o.parentNode&&o.parentNode.removeChild(o)}catch{}o=null,u(),qe().catch(S=>{console.error("Failed to save drag-and-drop changes:",S),W(p("error.saveTaskPositionFailed"))})}else{ze!=="manual"&&(ze="manual",["backlog","todo","progress","review","done"].forEach(S=>{me[S]=L.filter(x=>x.status===S).slice().sort((x,$)=>(oe[$.priority]||0)-(oe[x.priority]||0)).map(x=>x.id)}),Dt(),xa()),Object.keys(me).forEach(S=>{Array.isArray(me[S])&&(me[S]=me[S].filter(x=>!e.includes(x)))});let T=L.filter(S=>S.status===w&&!e.includes(S.id)),E;if(Array.isArray(me[w])&&me[w].length){let S=new Set(T.map($=>$.id));E=me[w].filter($=>S.has($));let x=T.filter($=>!E.includes($.id)).slice().sort(($,z)=>(oe[z.priority]||0)-(oe[$.priority]||0)).map($=>$.id);E=E.concat(x)}else E=T.slice().sort((S,x)=>(oe[x.priority]||0)-(oe[S.priority]||0)).map(S=>S.id);let D=E.length;if(o&&o.parentNode===C){let S=Array.from(C.children),x=S.indexOf(o);if(x!==-1){let $=0;for(let z=0;z<x;z++)S[z].classList&&S[z].classList.contains("task-card")&&$++;D=$}}E.splice(D,0,...e),me[w]=E,e.forEach(S=>{let x=L.find($=>$.id===S);if(x&&x.status!==w){let z=JSON.parse(JSON.stringify(x));if(x.status=w,x.updatedAt=new Date().toISOString(),M.autoSetStartDateOnStatusChange||M.autoSetEndDateOnStatusChange){let O=new Date().toISOString().split("T")[0];M.autoSetStartDateOnStatusChange&&w==="progress"&&!x.startDate&&(x.startDate=O),M.autoSetEndDateOnStatusChange&&w==="done"&&!x.endDate&&(x.endDate=O)}w==="done"&&!x.completedDate&&(x.completedDate=new Date().toISOString()),window.historyService&&window.historyService.recordTaskUpdated(z,x)}}),xa(),uo(),zt(),document.getElementById("calendar-view")&&ie();try{o&&o.parentNode&&o.parentNode.removeChild(o)}catch{}o=null,u(),qe().catch(S=>{console.error("Failed to save drag-and-drop changes:",S),W(p("error.saveTaskPositionFailed"))})}})}),document.addEventListener("dragend",()=>u())}function bd(){let e=document.getElementById("project-modal");window.tempProjectTags=[],qa([]),document.getElementById("project-form").dataset.editingProjectId="",e.classList.add("active"),setTimeout(()=>{document.querySelector('#project-form input[name="startDate"]').value="",document.querySelectorAll('#project-modal input[type="date"]').forEach(a=>{a._flatpickrInstance&&(a._flatpickrInstance.destroy(),a._flatpickrInstance=null,a._wrapped=!1)}),xt()},150),setTimeout(()=>{let t=e.querySelector(".modal-body");t&&(t.scrollTop=0)},0)}function kd(){let e=document.getElementById("task-nav-prev"),t=document.getElementById("task-nav-next");if(!e||!t)return;if(!Ht){e.style.display="none",t.style.display="none";return}let{taskIds:a,currentIndex:n}=Ht;e.style.display="flex",t.style.display="flex",e.disabled=n<=0,t.disabled=n>=a.length-1}function mi(e){if(!Ht)return;let{taskIds:t,currentIndex:a,projectId:n}=Ht,o=e==="next"?a+1:a-1;if(o<0||o>=t.length)return;let s=t[o];va(s,{projectId:n,taskIds:t,currentIndex:o})}function jr(){mi("prev")}function Cr(){mi("next")}window.taskNavigationInitialized||(window.taskNavigationInitialized=!0,document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("task-nav-prev"),t=document.getElementById("task-nav-next");e&&e.addEventListener("click",a=>{a.stopPropagation(),jr()}),t&&t.addEventListener("click",a=>{a.stopPropagation(),Cr()}),document.addEventListener("keydown",a=>{let n=document.getElementById("task-modal");if(!n||!n.classList.contains("active")||!Ht)return;let o=a.target;o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||(a.key==="ArrowLeft"&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&!a.altKey&&(a.preventDefault(),jr()),a.key==="ArrowRight"&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&!a.altKey&&(a.preventDefault(),Cr()))})}));function On(){let e=document.getElementById("task-modal");if(!e)return;Ht=null;let t=e.querySelector('.modal-tab[data-tab="general"]'),a=e.querySelector('.modal-tab[data-tab="details"]'),n=e.querySelector('.modal-tab[data-tab="history"]'),o=e.querySelector("#task-details-tab"),s=e.querySelector("#task-history-tab");t&&t.classList.add("active"),a&&a.classList.remove("active"),n&&n.classList.remove("active"),o&&o.classList.add("active"),s&&s.classList.remove("active"),document.body.classList.remove("mobile-tab-details-active"),n&&(n.style.display="none");let r=e.querySelector(".modal-content");r&&(r.style.minHeight="",r.style.maxHeight=""),setTimeout(()=>{e.querySelectorAll('input[name="startDate"], input[name="endDate"]').forEach(S=>{S._flatpickrInstance&&(S._flatpickrInstance.destroy(),S._flatpickrInstance=null),S._wrapped=!1;let x=S.closest(".date-input-wrapper");x&&(x.parentNode.insertBefore(S,x),x.remove()),S.type="date",S.style.display=""}),xt()},150);let i=e.querySelector("h2");i&&(i.textContent="Create New Task");let c=e.querySelector(".modal-close");c&&(c.style.display="none");let l=e.querySelector("#task-options-btn");l&&(l.style.display="none");let u=e.querySelector("#task-footer");u&&(u.style.display="flex"),setTimeout(()=>{let b=e.querySelector(".modal-content"),S=e.querySelector(".modal-body"),x=e.querySelector(".modal-footer");if(b&&x){let $=b.getBoundingClientRect(),z=x.getBoundingClientRect(),O=window.getComputedStyle(b),k=window.getComputedStyle(x);console.log("=== MODAL DEBUG ==="),console.log("Viewport:",window.innerWidth,"x",window.innerHeight),console.log("Zoom:",window.devicePixelRatio*100+"%"),console.log(""),console.log("MODAL-CONTENT:"),console.log("  Position:",$.top.toFixed(1),"to",$.bottom.toFixed(1)),console.log("  Height:",$.height.toFixed(1),"/",O.height,"/",O.maxHeight),console.log("  Padding:",O.padding),console.log("  Display:",O.display),console.log("  Overflow:",O.overflow),console.log(""),console.log("MODAL-FOOTER:"),console.log("  Position:",z.top.toFixed(1),"to",z.bottom.toFixed(1)),console.log("  Height:",z.height.toFixed(1)),console.log("  Flex-shrink:",k.flexShrink),console.log("  Padding:",k.padding),console.log("");let A=z.bottom-$.bottom;A>1?console.error("\u274C FOOTER OVERFLOW:",A.toFixed(1)+"px OUTSIDE modal-content"):console.log("\u2705 Footer is inside modal-content"),console.log("==================")}},100);let d=e.querySelector("#task-form");d&&(delete d.dataset.editingTaskId,d.reset());let f=e.querySelector("#task-description-editor");f&&(f.innerHTML="");let m=e.querySelector("#task-description-hidden");m&&(m.value="");let g=e.querySelector("#hidden-project");g&&(g.value="");let y=e.querySelector("#project-current .project-text");y&&(y.textContent=p("tasks.project.selectPlaceholder")),qn(""),typeof It=="function"&&It();let v=e.querySelector("#hidden-priority");v&&(v.value="medium");let w=e.querySelector("#priority-current");w&&(w.innerHTML=`<span class="priority-dot medium"></span> ${et("medium")} <span class="dropdown-arrow">\u25BC</span>`,In("medium"));let C=e.querySelector("#hidden-status");C&&(C.value="backlog");let T=e.querySelector("#status-current");if(T){let b=T.querySelector(".status-badge");b&&(b.className="status-badge backlog",b.textContent=He("backlog"))}if(je=[],window.tempTags=[],h.tags.clear(),Ut([]),fa([]),window.innerWidth<=768){e.dataset.initialStartDate="false",e.dataset.initialEndDate="false";let b=e.querySelector(".form-group:has(#tag-input)"),S=e.querySelector('.form-group:has([name="startDate"])'),x=e.querySelector('.form-group:has([name="endDate"])'),$=e.querySelector(".form-group:has(#attachments-links-list)");b&&(b.classList.remove("mobile-general-field"),b.classList.add("mobile-details-field")),S&&(S.classList.remove("mobile-general-field"),S.classList.add("mobile-details-field")),x&&(x.classList.remove("mobile-general-field"),x.classList.add("mobile-details-field")),$&&($.classList.remove("mobile-general-field"),$.classList.add("mobile-details-field")),a&&a.classList.remove("hide-details-tab")}let E=e.querySelector('#task-form input[name="startDate"]');if(E){let b=E._flatpickrInstance;b&&(b.clear(),b.jumpToDate(new Date)),E.value="";let S=E.parentElement?E.parentElement.querySelector("input.date-display"):null;S&&(S.value="")}let D=e.querySelector('#task-form input[name="endDate"]');if(D){let b=D._flatpickrInstance;b&&(b.clear(),b.jumpToDate(new Date)),D.value="";let S=D.parentElement?D.parentElement.querySelector("input.date-display"):null;S&&(S.value="")}e.classList.add("active"),setTimeout(()=>{let b=e.querySelector(".modal-body");b&&(b.scrollTop=0)},0),setTimeout(()=>{xt(),Ri()},100)}function Ue(e){let t=document.getElementById(e);if(t){if(e==="settings-modal"&&window.settingsFormIsDirty){Na(e);return}if(t.classList.remove("active"),e==="settings-modal"&&(typeof ua=="function"&&ua(),typeof da=="function"&&da()),e==="task-modal")try{let a=t.querySelector(".modal-content");a&&(a.style.minHeight="")}catch{}e==="project-modal"&&document.getElementById("project-form").reset()}}function wd(){if(Pn&&Pn()){Na("task-modal");return}let e=document.getElementById("task-form");if(e&&e.dataset.editingTaskId){let t=e.querySelector("#task-description-editor");t&&lt("description",t.innerHTML)}if(e){e.reset(),delete e.dataset.editingTaskId;let t=document.querySelector("#status-current .status-badge");t&&(t.className="status-badge backlog",t.textContent=He("backlog"));let a=document.getElementById("hidden-status");a&&(a.value="backlog");let n=document.querySelector("#priority-current");n&&(n.innerHTML=`<span class="priority-dot medium"></span> ${et("medium")} <span class="dropdown-arrow">\u25BC</span>`);let o=document.getElementById("hidden-priority");o&&(o.value="medium")}Je=null,Ht=null,Ue("task-modal")}document.getElementById("project-form").addEventListener("submit",function(e){e.preventDefault();let t=ke("projects","submit",{projectCount:N.length,tagCount:(window.tempProjectTags||[]).length}),a=new FormData(e.target),n=window.tempProjectTags||[],o=$s({name:a.get("name"),description:a.get("description"),startDate:a.get("startDate"),endDate:a.get("endDate"),tags:n},N,st);N=o.projects,st=o.projectCounter;let s=o.project;window.historyService&&window.historyService.recordProjectCreated(s),Ue("project-modal"),e.target.reset(),window.tempProjectTags=[],te.projectsSortedView=null,window.location.hash="projects",Re("projects"),zt(),Qe().catch(r=>{console.error("Failed to save project:",r),W(p("error.saveProjectFailed"))}),ye("projects",t,{projectCount:N.length})});function Sd(){let e=document.createElement("div");e.className="modal active",e.id="reset-pin-modal-temp",e.innerHTML=`
        <div class="modal-content reset-pin-modal-content">
            <div class="reset-pin-modal-inner">
                <div class="reset-pin-header">
                    <div>
                        <h2 class="reset-pin-title">Reset PIN</h2>
                        <p class="reset-pin-description">Verify your current PIN to set a new one</p>
                    </div>
                </div>
                
                <form id="reset-pin-form" class="reset-pin-form">
                    <div class="reset-pin-field">
                        <label class="reset-pin-label">Current PIN</label>
                        <input
                            type="password"
                            id="current-pin-input"
                            maxlength="4"
                            placeholder="\u2022\u2022\u2022\u2022"
                            class="reset-pin-input"
                            inputmode="numeric"
                            autocomplete="off"
                            required
                        />
                        <div id="current-pin-error" class="reset-pin-error" style="display: none;"></div>
                    </div>

                    <div class="reset-pin-actions">
                        <button type="button" class="reset-pin-btn reset-pin-btn-cancel" onclick="document.getElementById('reset-pin-modal-temp').remove()">
                            Cancel
                        </button>
                        <button type="submit" class="reset-pin-btn reset-pin-btn-primary">
                            Continue
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `,document.body.appendChild(e),document.getElementById("reset-pin-form").addEventListener("submit",function(t){t.preventDefault();let a=document.getElementById("current-pin-input").value.trim(),n=document.getElementById("current-pin-error");if(n.style.display="none",n.textContent="",!a||a.length!==4){n.textContent="PIN must be 4 digits",n.style.display="block";return}if(!/^\d{4}$/.test(a)){n.textContent="PIN must contain only digits",n.style.display="block";return}document.getElementById("reset-pin-modal-temp").remove(),Ed(a)}),document.getElementById("current-pin-input").focus()}function Ed(e){let t=document.createElement("div");t.className="modal active",t.id="new-pin-modal-temp",t.innerHTML=`
        <div class="modal-content reset-pin-modal-content">
            <div class="reset-pin-modal-inner">
                <div class="reset-pin-header">
                    <div>
                        <h2 class="reset-pin-title">Set New PIN</h2>
                        <p class="reset-pin-description">Create your new 4-digit PIN</p>
                    </div>
                </div>
                
                <form id="new-pin-form" class="reset-pin-form">
                    <div class="reset-pin-field">
                        <label class="reset-pin-label">New PIN</label>
                        <input 
                            type="password" 
                            id="new-pin-input" 
                            maxlength="4" 
                            placeholder="\u2022\u2022\u2022\u2022"
                            class="reset-pin-input"
                            inputmode="numeric"
                            autocomplete="off"
                            required
                        />
                    </div>
                    
                    <div class="reset-pin-field">
                        <label class="reset-pin-label">Confirm PIN</label>
                        <input
                            type="password"
                            id="confirm-pin-input"
                            maxlength="4"
                            placeholder="\u2022\u2022\u2022\u2022"
                            class="reset-pin-input"
                            inputmode="numeric"
                            autocomplete="off"
                            required
                        />
                        <div id="new-pin-error" class="reset-pin-error" style="display: none;"></div>
                    </div>

                    <div class="reset-pin-actions">
                        <button type="button" class="reset-pin-btn reset-pin-btn-cancel" onclick="document.getElementById('new-pin-modal-temp').remove()">
                            Cancel
                        </button>
                        <button type="submit" class="reset-pin-btn reset-pin-btn-primary">
                            Reset PIN
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `,document.body.appendChild(t),document.getElementById("new-pin-form").addEventListener("submit",function(a){a.preventDefault();let n=document.getElementById("new-pin-input").value.trim(),o=document.getElementById("confirm-pin-input").value.trim(),s=document.getElementById("new-pin-error");if(s.style.display="none",s.textContent="",!n||n.length!==4){s.textContent="New PIN must be 4 digits",s.style.display="block";return}if(!/^\d{4}$/.test(n)){s.textContent="PIN must contain only digits",s.style.display="block";return}if(n!==o){s.textContent="PINs do not match",s.style.display="block";return}Dd(e,n)}),document.getElementById("new-pin-input").focus()}async function Dd(e,t){try{let a=localStorage.getItem("authToken");if(!a){W(p("error.notLoggedInResetPin"));return}let n=await fetch("/api/auth/change-pin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({currentPin:e,newPin:t})}),o=await n.json();if(!n.ok){W(o.error||p("error.resetPinFailed"));return}let s=document.getElementById("new-pin-modal-temp");s&&s.remove(),Ke(p("success.resetPin")),setTimeout(()=>{window.location.hash="",location.reload()},2e3)}catch(a){console.error("PIN reset error:",a),W(p("error.resetPinError"))}}document.getElementById("settings-form").addEventListener("submit",async function(e){e.preventDefault();let t=this.querySelector(".settings-btn-save");if(t&&t.disabled&&!window.settingsFormIsDirty)return;let a=document.getElementById("user-name").value.trim();if(!a){W(p("error.userNameEmpty"));return}try{let S=window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken");if(!S)throw new Error("Missing auth token");let x=await fetch("/api/auth/change-name",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`},body:JSON.stringify({newName:a})}),$=await x.json().catch(()=>({}));if(!x.ok)throw new Error($.error||"Failed to update display name");let z=window.authSystem?.getCurrentUser?.();z&&(z.name=$.name||a),Zo($.name||a,window.authSystem?.getCurrentUser?.()?.avatarDataUrl)}catch(S){console.error("Failed to save display name:",S),W(p("error.saveDisplayNameFailed"));return}let n=document.getElementById("user-email"),o=String(n?.value||"").trim().toLowerCase();if(!o||!Hs(o)){W(p("error.invalidEmail"));return}try{let S=window.authSystem?.getCurrentUser?.(),x=String(S?.email||"").trim().toLowerCase();if(o&&o!==x){let $=window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken");if(!$)throw new Error("Missing auth token");let z=await fetch("/api/auth/change-email",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${$}`},body:JSON.stringify({newEmail:o})}),O=await z.json().catch(()=>({}));if(!z.ok)throw new Error(O.error||"Failed to update email");S&&(S.email=O.email||o),document.querySelectorAll(".user-email").forEach(k=>{k&&(k.textContent=O.email||o)})}}catch(S){console.error("Failed to save email:",S),W(p("error.saveEmailFailed"));return}try{if(Xe.hasPendingChange){let S=window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken");if(!S)throw new Error("Missing auth token");let x=await fetch("/api/auth/change-avatar",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${S}`},body:JSON.stringify({avatarDataUrl:Xe.dataUrl||null})}),$=await x.json().catch(()=>({}));if(!x.ok)throw new Error($.error||"Failed to update avatar");let z=window.authSystem?.getCurrentUser?.();z&&(z.avatarDataUrl=$.avatarDataUrl||null),Td(),la(),Xe.hasPendingChange=!1,Xe.dataUrl=null}}catch(S){console.error("Failed to save avatar:",S),W(p("error.saveAvatarFailed"));return}let s=document.getElementById("auto-start-date-toggle"),r=document.getElementById("auto-end-date-toggle"),i=document.getElementById("enable-review-status-toggle"),c=document.getElementById("calendar-include-backlog-toggle"),l=document.getElementById("debug-logs-toggle"),u=document.getElementById("history-sort-order"),d=document.getElementById("language-select");M.autoSetStartDateOnStatusChange=!!s?.checked,M.autoSetEndDateOnStatusChange=!!r?.checked,M.debugLogsEnabled=!!l?.checked,no(M.debugLogsEnabled);let f=window.enableReviewStatus,m=!!i?.checked;if(f&&!m){let S=L.filter(x=>x.status==="review");if(S.length>0){let x=document.getElementById("review-status-task-list"),$=S.slice(0,5),z=S.length>5,O=`
                    <div style="
                        color: var(--text-primary);
                        font-size: 14px;
                        line-height: 1.6;
                        margin-bottom: 16px;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        flex-wrap: wrap;
                    ">
                        <span style="color: var(--text-secondary);">You have</span>
                        <span style="
                            color: var(--text-primary);
                            font-weight: 600;
                            font-size: 16px;
                        ">${S.length}</span>
                        <span style="color: var(--text-secondary);">${S.length===1?"task":"tasks"} with</span>
                        <span class="status-badge review" style="
                            display: inline-flex;
                            align-items: center;
                            padding: 4px 10px;
                            border-radius: 6px;
                            font-size: 11px;
                            font-weight: 600;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        ">IN REVIEW</span>
                        <span style="color: var(--text-secondary);">status</span>
                    </div>
                    <div style="margin: 20px 0;">
                        ${$.map(k=>`
                            <div style="
                                display: flex;
                                align-items: center;
                                gap: 10px;
                                padding: 8px 0;
                                color: var(--text-primary);
                                font-size: 14px;
                            ">
                                <svg width="18" height="18" viewBox="0 0 16 16" fill="none" style="flex-shrink: 0; color: var(--accent-green);">
                                    <rect x="2" y="2" width="12" height="12" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                    <path d="M5 8L7 10L11 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    ${U(k.title)}
                                </span>
                            </div>
                        `).join("")}
                        ${z?`
                            <div style="
                                margin-top: 12px;
                                padding-top: 12px;
                                border-top: 1px solid var(--border-color);
                            ">
                                <button type="button" style="
                                    background: none;
                                    border: none;
                                    color: var(--accent-blue);
                                    text-decoration: none;
                                    font-size: 13px;
                                    display: inline-flex;
                                    align-items: center;
                                    gap: 6px;
                                    cursor: pointer;
                                    padding: 0;
                                    font-family: inherit;
                                " onclick="
                                    const baseUrl = window.location.href.split('#')[0];
                                    const url = baseUrl + '#tasks?status=review&view=list';
                                    window.open(url, '_blank');
                                ">
                                    <span>View all ${S.length} tasks in List view</span>
                                    <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="flex-shrink: 0;">
                                        <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                        `:""}
                    </div>
                    <div style="
                        color: var(--text-primary);
                        font-size: 14px;
                        line-height: 1.6;
                        margin-top: 20px;
                        padding: 16px;
                        background: var(--bg-tertiary);
                        border-radius: 8px;
                        border-left: 3px solid var(--accent-blue);
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        flex-wrap: wrap;
                    ">
                        <svg width="18" height="18" viewBox="0 0 16 16" fill="none" style="flex-shrink: 0; color: var(--accent-blue);">
                            <path d="M8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2Z" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M8 5V8L10 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <span style="color: var(--text-secondary);">These tasks will be moved to</span>
                        <span class="status-badge progress" style="
                            display: inline-flex;
                            align-items: center;
                            padding: 4px 10px;
                            border-radius: 6px;
                            font-size: 11px;
                            font-weight: 600;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        ">IN PROGRESS</span>
                    </div>
                `;x.innerHTML=O,window.pendingReviewTaskMigration=S,window.pendingReviewStatusToggle=i,document.getElementById("review-status-confirm-modal").classList.add("active");return}}M.enableReviewStatus=m,M.calendarIncludeBacklog=!!c?.checked,M.historySortOrder=u.value,M.language=Mo(d?.value||"en"),window.enableReviewStatus=M.enableReviewStatus,localStorage.setItem("enableReviewStatus",String(M.enableReviewStatus)),ts(),Fr(),M.notificationEmail=o;let g=document.getElementById("email-notifications-enabled"),y=document.getElementById("email-notifications-weekdays-only"),v=document.getElementById("email-notifications-include-start-dates"),w=document.getElementById("email-notifications-include-backlog"),C=document.getElementById("email-notification-time"),T=document.getElementById("email-notification-timezone");M.emailNotificationsEnabled=!!g?.checked,M.emailNotificationsWeekdaysOnly=!!y?.checked,M.emailNotificationsIncludeStartDates=!!v?.checked,M.emailNotificationsIncludeBacklog=!!w?.checked;let E=ro(Ea(C?.value)||"09:00",30);M.emailNotificationTime=io(E||"09:00","08:00","18:00")||"09:00",M.emailNotificationTimeZone=String(T?.value||"Atlantic/Canary"),C&&(C.value=M.emailNotificationTime),Ze.hasPendingChange&&(M.customWorkspaceLogo=Ze.dataUrl||null),Ho(),ei(),Mt({force:!0});let D=document.getElementById("calendar-view");D&&D.classList.contains("active")&&ie(),Ze.hasPendingChange=!1,Ze.dataUrl=null;let b=document.querySelector(".user-email");b&&(b.textContent=o),Ke(p("success.settingsSaved")),window.initialSettingsFormState=null,window.settingsFormIsDirty=!1,t&&(t.classList.remove("dirty"),t.disabled=!0),Ue("settings-modal")});function la(){let e=document.getElementById("user-avatar-preview"),t=document.getElementById("user-avatar-clear-btn"),a=document.getElementById("user-avatar-dropzone"),n=e?.closest?.(".user-avatar-input-row")||a?.closest?.(".user-avatar-input-row")||null,o=window.authSystem?.getCurrentUser?.(),s=Xe.hasPendingChange?Xe.dataUrl:o?.avatarDataUrl||null,r=!!s;if(e&&t&&(s?(e.style.display="block",e.style.backgroundImage=`url(${s})`,t.style.display="inline-flex"):(e.style.display="none",e.style.backgroundImage="",t.style.display="none")),a){let i=p("settings.avatarUploadAriaUpload"),c=p("settings.avatarUploadAriaChange");a.setAttribute("aria-label",r?c:i);let l=a.querySelector(".workspace-logo-dropzone-text");if(l){let u=a.dataset.defaultText||p("settings.avatarUploadDefault"),d=a.dataset.changeText||p("settings.avatarUploadChange");l.textContent=r?d:u}a.style.minHeight=r?"40px":"48px",a.style.padding=r?"10px 12px":"12px 16px"}n&&n.classList.toggle("has-avatar",r)}function Td(){let e=window.authSystem?.getCurrentUser?.();e&&Zo(e.name,e.avatarDataUrl||null)}function xd(){let e=document.getElementById("workspace-logo-dropzone"),t=document.getElementById("workspace-logo-input"),a=document.getElementById("workspace-logo-clear-btn"),n=document.getElementById("workspace-logo-preview");if(!e||!t)return;let o=p("settings.logoUploadDefault");e.dataset.defaultText=o;function s(k){e.innerHTML="";let A=document.createElement("span");A.className="workspace-logo-dropzone-text",A.textContent=k,e.appendChild(A)}function r(k){k.style.display="flex",k.style.alignItems="center",k.style.justifyContent="center",k.style.gap="10px",k.style.padding="12px 16px",k.style.textAlign="center",k.style.cursor="pointer",k.style.userSelect="none",k.style.minHeight="48px",k.style.border="2px dashed var(--border)",k.style.borderRadius="10px",k.style.background="var(--bg-tertiary)",k.style.boxShadow="none",k.style.color="var(--text-muted)",k.style.fontWeight="500",k.style.transition="border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease"}function i(k,A){A?(k.style.borderColor="var(--accent-blue)",k.style.background="rgba(59, 130, 246, 0.08)",k.style.boxShadow="0 0 0 1px var(--accent-blue)"):(k.style.border="2px dashed var(--border)",k.style.background="var(--bg-tertiary)",k.style.boxShadow="none")}function c(){if(!n||!a)return;let k=n.closest(".workspace-logo-input-row")||e?.closest?.(".workspace-logo-input-row")||null,A=Ze.hasPendingChange?Ze.dataUrl:M.customWorkspaceLogo,V=!!A;if(A?(n.style.display="block",n.style.backgroundImage=`url(${A})`,a.style.display="inline-flex"):(n.style.display="none",n.style.backgroundImage="",a.style.display="none"),e){let G=p("settings.logoUploadAriaUpload"),Y=p("settings.logoUploadAriaChange");e.setAttribute("aria-label",V?Y:G);let K=e.dataset.defaultText||p("settings.logoUploadDefault"),I=e.dataset.changeText||p("settings.logoUploadChange");e.getAttribute("aria-busy")!=="true"&&!e.classList.contains("workspace-logo-uploading")&&s(V?I:K),e.style.minHeight=V?"40px":"48px",e.style.padding=V?"10px 12px":"12px 16px"}k&&k.classList.toggle("has-logo",V)}async function l(k,A){if(!k)return;if(A&&(A.preventDefault(),A.stopPropagation()),!k.type.startsWith("image/")){W(p("error.logoSelectFile"));return}let V=2048*1024;if(k.size>V){W(p("error.logoTooLarge"));return}let G=e.dataset.defaultText||p("settings.logoUploadDefault");try{e.innerHTML="";let Y=document.createElement("span");Y.className="workspace-logo-dropzone-text",Y.textContent=`Uploading ${k.name}...`,e.appendChild(Y),e.classList.add("workspace-logo-uploading"),e.setAttribute("aria-busy","true");let K=new FileReader;K.onload=function(I){let P=I.target&&I.target.result;if(!P){W(p("error.imageReadFailed")),s(G),e.classList.remove("workspace-logo-uploading"),e.removeAttribute("aria-busy");return}let j=new Image;j.onload=function(){d(P,j),s(G),e.classList.remove("workspace-logo-uploading"),e.removeAttribute("aria-busy")},j.onerror=function(){W(p("error.imageLoadFailed")),s(G),e.classList.remove("workspace-logo-uploading"),e.removeAttribute("aria-busy")},j.src=P},K.onerror=function(){W(p("error.imageReadFailed")),s(G),e.classList.remove("workspace-logo-uploading"),e.removeAttribute("aria-busy")},K.readAsDataURL(k)}catch(Y){W(p("error.logoUploadFailed",{message:Y.message})),s(G),e.classList.remove("workspace-logo-uploading"),e.removeAttribute("aria-busy")}}r(e),s(o),c();let u=0;e.addEventListener("dragenter",function(k){k.preventDefault(),u+=1,e.classList.add("workspace-logo-dragover"),i(e,!0)}),e.addEventListener("dragover",function(k){k.preventDefault(),e.classList.add("workspace-logo-dragover"),i(e,!0)}),e.addEventListener("dragleave",function(k){k.preventDefault(),u=Math.max(0,u-1),u===0&&(e.classList.remove("workspace-logo-dragover"),i(e,!1))}),e.addEventListener("drop",function(k){u=0,e.classList.remove("workspace-logo-dragover"),i(e,!1);let A=k.dataTransfer&&k.dataTransfer.files;A&&A.length>0&&l(A[0],k)}),e.addEventListener("dragend",function(){u=0,e.classList.remove("workspace-logo-dragover"),i(e,!1)}),e.addEventListener("paste",function(k){if(!k.clipboardData)return;let A=k.clipboardData.files;A&&A.length>0&&l(A[0],k)}),e.addEventListener("click",function(){t.click()}),e.addEventListener("keydown",function(k){(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),t.click())}),t.addEventListener("change",function(k){let A=k.target.files;A&&A.length>0&&l(A[0],k),t.value=""}),a&&a.addEventListener("click",function(k){k.preventDefault(),Ze.hasPendingChange=!0,Ze.dataUrl=null,t&&(t.value=""),c(),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded()}),document.addEventListener("refresh-workspace-logo-ui",()=>{c()});function d(k,A,V=null){let G=document.getElementById("workspace-logo-crop-modal"),Y=document.getElementById("crop-canvas"),K=Y.getContext("2d"),I=document.getElementById("crop-modal-title"),P=G?.querySelector(".crop-instructions");F.originalImage=A,F.originalDataUrl=k,F.canvas=Y,F.ctx=K,F.onApply=V?.onApply||null,F.successMessage=V?.successMessage||null,F.shape=V?.shape||"square",F.outputMimeType=V?.outputMimeType||"image/jpeg",F.outputMaxSize=typeof V?.outputMaxSize=="number"?V.outputMaxSize:null,I&&(I.textContent=V?.title||"Crop Image to Square"),P&&V?.instructions&&(P.textContent=V.instructions),G.setAttribute("role","dialog"),G.setAttribute("aria-modal","true"),G.setAttribute("aria-labelledby","crop-modal-title"),G.classList.add("active"),requestAnimationFrame(()=>{let B=window.innerHeight*.6,H=A.width,J=A.height;if(H>600||J>B){let _=Math.min(600/H,B/J);H=Math.floor(H*_),J=Math.floor(J*_)}Y.width=H,Y.height=J,K.clearRect(0,0,Y.width,Y.height),K.drawImage(A,0,0,H,J);let X=Math.min(H,J),Q=Math.floor(X*.8);F.selection={x:Math.floor((H-Q)/2),y:Math.floor((J-Q)/2),size:Q},w(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{m()})})})}function f(){document.getElementById("workspace-logo-crop-modal").classList.remove("active"),C(),F={originalImage:null,originalDataUrl:null,canvas:null,ctx:null,selection:{x:0,y:0,size:0},isDragging:!1,isResizing:!1,dragStartX:0,dragStartY:0,activeHandle:null,shape:"square",outputMimeType:"image/jpeg",outputMaxSize:null,onApply:null,successMessage:null}}function m(){let k=document.getElementById("crop-selection"),A=F.canvas;if(!A||!k)return;k.dataset.shape=F.shape||"square";let V=A.getBoundingClientRect(),G=A.closest(".crop-canvas-container")||A.parentElement,Y=G?G.getBoundingClientRect():V,K=V.left-Y.left,I=V.top-Y.top,P=A.width/V.width,j=F.selection.x/P,B=F.selection.y/P,H=F.selection.size/P;k.style.left=`${K+j}px`,k.style.top=`${I+B}px`,k.style.width=`${H}px`,k.style.height=`${H}px`,g()}function g(){let k=document.getElementById("crop-dimensions"),A=document.getElementById("crop-size-estimate");if(!k||!A)return;let V=F.canvas,G=F.originalImage;if(!V||!G)return;let Y=document.getElementById("crop-selection"),K=V.getBoundingClientRect(),I=Y?.getBoundingClientRect?.(),P=0;if(I&&K.width>0&&K.height>0){let J=G.width/K.width,X=G.height/K.height,Q=I.width*J,_=I.height*X;P=Math.max(1,Math.floor(Math.min(Q,_)))}else{let J=G.width/V.width;P=Math.max(1,Math.floor(F.selection.size*J))}k.textContent=`${P} \xD7 ${P} px`;let j=P*P*3,B=Math.floor(j/1024);A.textContent=`~${B} KB`;let H=2048;A.classList.remove("size-warning","size-error"),B>H?A.classList.add("size-error"):B>H*.8&&A.classList.add("size-warning")}async function y(){try{let k=F.canvas,A=F.originalImage,V=F.selection;if(!k||!A){W(p("error.cropInvalid"));return}let G=k.getBoundingClientRect(),K=document.getElementById("crop-selection")?.getBoundingClientRect?.(),I=0,P=0,j=0;if(K&&G.width>0&&G.height>0){let R=(K.left+K.width/2-G.left)/G.width,ne=(K.top+K.height/2-G.top)/G.height,ue=R*A.width,ce=ne*A.height,xe=K.width/G.width*A.width,de=K.height/G.height*A.height;j=Math.max(1,Math.floor(Math.min(xe,de))),I=Math.floor(ue-j/2),P=Math.floor(ce-j/2)}else{let R=A.width/k.width,ne=A.height/k.height;j=Math.max(1,Math.floor(V.size*Math.min(R,ne))),I=Math.floor(V.x*R),P=Math.floor(V.y*ne)}I=Math.max(0,Math.min(I,A.width-j)),P=Math.max(0,Math.min(P,A.height-j));let B=2048*1024,H=6,J=(R,ne)=>{let ue=document.createElement("canvas");ue.width=R,ue.height=R;let ce=ue.getContext("2d");if(!ce)throw new Error("Canvas context unavailable");let xe=F.shape||"square";xe==="circle"&&(ce.clearRect(0,0,R,R),ce.save(),ce.beginPath(),ce.arc(R/2,R/2,R/2,0,Math.PI*2),ce.closePath(),ce.clip()),ce.drawImage(A,I,P,j,j,0,0,R,R),xe==="circle"&&ce.restore();let de=F.outputMimeType||(xe==="circle"?"image/png":"image/jpeg");return de==="image/jpeg"||de==="image/webp"?ue.toDataURL(de,ne):ue.toDataURL(de)},X=F.outputMaxSize?Math.min(j,F.outputMaxSize):j;X=Math.max(50,Math.floor(X));let Q=0,_=.92,ae=J(X,_);for(;ae.length>B*1.37&&Q<H;){let R=F.shape||"square",ne=F.outputMimeType||(R==="circle"?"image/png":"image/jpeg");ne==="image/jpeg"||ne==="image/webp"?_=Math.max(.5,_-.1):X=Math.floor(X*.85),ae=J(X,_),Q++}if(ae.length>B*1.37){W(p("error.cropTooLarge"));return}typeof F.onApply=="function"?(F.onApply(ae),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded(),f(),Ke(F.successMessage||p("success.cropApplied"))):(Ze.hasPendingChange=!0,Ze.dataUrl=ae,c(),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded(),f(),Ke(p("success.logoCroppedApplied")))}catch(k){W(p("error.cropFailed",{message:k.message})),console.error("Crop error:",k)}}function v(){let k=document.getElementById("user-avatar-dropzone"),A=document.getElementById("user-avatar-input"),V=document.getElementById("user-avatar-clear-btn");if(!k||!A)return;let G=p("settings.avatarUploadDefault");k.dataset.defaultText=G,k.dataset.changeText=p("settings.avatarUploadChange");function Y(j){k.innerHTML="";let B=document.createElement("span");B.className="workspace-logo-dropzone-text",B.textContent=j,k.appendChild(B)}function K(j){j.style.display="flex",j.style.alignItems="center",j.style.justifyContent="center",j.style.gap="10px",j.style.padding="12px 16px",j.style.textAlign="center",j.style.cursor="pointer",j.style.userSelect="none",j.style.minHeight="48px",j.style.border="2px dashed var(--border)",j.style.borderRadius="10px",j.style.background="var(--bg-tertiary)",j.style.boxShadow="none",j.style.color="var(--text-muted)",j.style.fontWeight="500",j.style.transition="border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease"}function I(j,B){B?(j.style.borderColor="var(--accent-blue)",j.style.background="rgba(59, 130, 246, 0.08)",j.style.boxShadow="0 0 0 1px var(--accent-blue)"):(j.style.border="2px dashed var(--border)",j.style.background="var(--bg-tertiary)",j.style.boxShadow="none")}async function P(j,B){if(!j)return;if(B&&(B.preventDefault(),B.stopPropagation()),!j.type.startsWith("image/")){W(p("error.avatarSelectFile"));return}let H=2048*1024;if(j.size>H){W(p("error.avatarTooLarge"));return}let J=k.dataset.defaultText||p("settings.avatarUploadDefault");try{k.innerHTML="";let X=document.createElement("span");X.className="workspace-logo-dropzone-text",X.textContent=`Uploading ${j.name}...`,k.appendChild(X),k.setAttribute("aria-busy","true");let Q=new FileReader,_=await new Promise((R,ne)=>{Q.onload=()=>R(Q.result),Q.onerror=ne,Q.readAsDataURL(j)}),ae=new Image;ae.onload=()=>{d(_,ae,{title:"Crop Avatar",instructions:"Drag to adjust the crop area. Your avatar will be displayed as a circle.",shape:"circle",outputMimeType:"image/png",outputMaxSize:512,successMessage:"Avatar cropped and applied successfully!",onApply:R=>{Xe.hasPendingChange=!0,Xe.dataUrl=R,la()}})},ae.onerror=()=>{W(p("error.imageLoadFailed"))},ae.src=_}catch(X){console.error("Avatar upload error:",X),W(p("error.avatarUploadFailed"))}finally{k.setAttribute("aria-busy","false"),Y(J)}}K(k),Y(G),k.addEventListener("click",()=>A.click()),k.addEventListener("keydown",j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),A.click())}),A.addEventListener("change",j=>{let B=j.target.files&&j.target.files[0];P(B,j),A.value=""}),k.addEventListener("dragenter",j=>{j.preventDefault(),I(k,!0)}),k.addEventListener("dragover",j=>{j.preventDefault(),I(k,!0)}),k.addEventListener("dragleave",j=>{j.preventDefault(),I(k,!1)}),k.addEventListener("drop",j=>{j.preventDefault(),I(k,!1);let B=j.dataTransfer?.files?.[0];P(B,j)}),V&&!V.__avatarClearBound&&(V.__avatarClearBound=!0,V.addEventListener("click",()=>{Xe.hasPendingChange=!0,Xe.dataUrl=null,la(),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded()})),la()}function w(){let k=document.getElementById("crop-selection"),A=document.querySelectorAll(".crop-handle");k&&(k.addEventListener("mousedown",T),k.addEventListener("touchstart",S)),A.forEach(V=>{V.addEventListener("mousedown",E),V.addEventListener("touchstart",x)}),document.addEventListener("mousemove",D),document.addEventListener("mouseup",b),document.addEventListener("touchmove",$),document.addEventListener("touchend",z),document.addEventListener("keydown",O)}function C(){let k=document.getElementById("crop-selection"),A=document.querySelectorAll(".crop-handle");k&&(k.removeEventListener("mousedown",T),k.removeEventListener("touchstart",S)),A.forEach(V=>{V.removeEventListener("mousedown",E),V.removeEventListener("touchstart",x)}),document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",b),document.removeEventListener("touchmove",$),document.removeEventListener("touchend",z),document.removeEventListener("keydown",O)}function T(k){k.target.classList.contains("crop-handle")||(k.preventDefault(),k.stopPropagation(),F.isDragging=!0,F.dragStartX=k.clientX,F.dragStartY=k.clientY)}function E(k){k.preventDefault(),k.stopPropagation(),F.isResizing=!0,F.dragStartX=k.clientX,F.dragStartY=k.clientY,k.target.classList.contains("crop-handle-nw")?F.activeHandle="nw":k.target.classList.contains("crop-handle-ne")?F.activeHandle="ne":k.target.classList.contains("crop-handle-sw")?F.activeHandle="sw":k.target.classList.contains("crop-handle-se")&&(F.activeHandle="se")}function D(k){if(!F.isDragging&&!F.isResizing)return;k.preventDefault();let A=F.canvas;if(!A)return;let V=A.getBoundingClientRect(),G=A.width/V.width,Y=(k.clientX-F.dragStartX)*G,K=(k.clientY-F.dragStartY)*G;if(F.isDragging){let I=F.selection.x+Y,P=F.selection.y+K;I=Math.max(0,Math.min(I,A.width-F.selection.size)),P=Math.max(0,Math.min(P,A.height-F.selection.size)),F.selection.x=I,F.selection.y=P}else if(F.isResizing){let I=(R,ne)=>Math.abs(R)>Math.abs(ne)?R:ne,j=F.selection,B=0,H=0,J=0,X=0;switch(F.activeHandle){case"se":J=I(Y,K),B=j.x,H=j.y,X=Math.min(A.width-B,A.height-H);break;case"nw":J=I(-Y,-K),B=j.x+j.size,H=j.y+j.size,X=Math.min(B,H);break;case"ne":J=I(Y,-K),B=j.x,H=j.y+j.size,X=Math.min(A.width-B,H);break;case"sw":J=I(-Y,K),B=j.x+j.size,H=j.y,X=Math.min(B,A.height-H);break}let Q=j.size+J;Q=Math.max(50,Math.min(Q,X));let _=j.x,ae=j.y;switch(F.activeHandle){case"se":_=B,ae=H;break;case"nw":_=B-Q,ae=H-Q;break;case"ne":_=B,ae=H-Q;break;case"sw":_=B-Q,ae=H;break}F.selection.size=Q,F.selection.x=_,F.selection.y=ae}m(),F.dragStartX=k.clientX,F.dragStartY=k.clientY}function b(k){(F.isDragging||F.isResizing)&&(k.preventDefault(),F.isDragging=!1,F.isResizing=!1,F.activeHandle=null)}function S(k){if(k.target.classList.contains("crop-handle"))return;k.preventDefault();let A=k.touches[0];F.isDragging=!0,F.dragStartX=A.clientX,F.dragStartY=A.clientY}function x(k){k.preventDefault(),k.stopPropagation();let A=k.touches[0];F.isResizing=!0,F.dragStartX=A.clientX,F.dragStartY=A.clientY,k.target.classList.contains("crop-handle-nw")?F.activeHandle="nw":k.target.classList.contains("crop-handle-ne")?F.activeHandle="ne":k.target.classList.contains("crop-handle-sw")?F.activeHandle="sw":k.target.classList.contains("crop-handle-se")&&(F.activeHandle="se")}function $(k){if(!F.isDragging&&!F.isResizing)return;k.preventDefault();let A=k.touches[0],V={clientX:A.clientX,clientY:A.clientY,preventDefault:()=>{}};D(V)}function z(k){(F.isDragging||F.isResizing)&&(k.preventDefault(),F.isDragging=!1,F.isResizing=!1,F.activeHandle=null)}function O(k){k.key==="Escape"&&f()}window.openCropModal=d,window.closeCropModal=f,window.applyCrop=y,v()}xd();window.initializeApp=Mn;window.setupUserMenus=Ti;window.addEventListener("beforeunload",e=>{if(sa&&(clearTimeout(sa),Sn()),Tt>0)return e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to leave?",e.returnValue});document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("task-modal");if(!e)return;let t=e.querySelector('#task-form input[name="title"]');t&&t.addEventListener("blur",function(o){let s=e.querySelector("#task-form");s&&s.dataset.editingTaskId&&lt("title",o.target.value)});let a=e.querySelector("#task-description-editor"),n=e.querySelector("#task-description-hidden");if(a&&n){let o="";a.addEventListener("focus",function(){o=a.innerHTML}),a.addEventListener("input",function(){n.value=a.innerHTML}),a.addEventListener("blur",function(){let s=e.querySelector("#task-form");s&&s.dataset.editingTaskId&&a.innerHTML!==o&&lt("description",a.innerHTML)})}});var Co=!1;document.addEventListener("click",function(e){if(!e.target.closest(".color-picker-container")){if(Co){Co=!1;return}document.querySelectorAll(".color-picker-dropdown").forEach(t=>{t.style.display="none"})}});async function Id(){let e=document.getElementById("task-form"),t=e.dataset.editingTaskId,a=ke("tasks","submit",{editing:!!t,taskCount:L.length}),n=e.querySelector('input[name="title"]').value,o=document.getElementById("task-description-hidden").value;o=yi(o);let s=e.querySelector('input[name="projectId"]').value||(e.querySelector('select[name="projectId"]')?e.querySelector('select[name="projectId"]').value:""),r=document.getElementById("hidden-status").value||"backlog",i=e.querySelector("#hidden-priority").value||"medium",c=(e.querySelector('input[name="startDate"]')?.value||"").trim(),l=c===""?"":c,u=(e.querySelector('input[name="endDate"]')?.value||"").trim(),d=u===""?"":u;if(t){let m=L.find(v=>v.id===parseInt(t,10)),g=m?JSON.parse(JSON.stringify(m)):null,y=Ls(parseInt(t,10),{title:n,description:o,projectId:s,startDate:l,endDate:d,priority:i,status:r},L);if(y.task){window.historyService&&g&&window.historyService.recordTaskUpdated(g,y.task);let v=y.oldProjectId;L=y.tasks;let w=y.task;if(v!==w.projectId&&(v&&(Wt(v),Gt(v,"removed",w)),w.projectId&&(Wt(w.projectId),Gt(w.projectId,"added",w)),Qe().catch(()=>{})),Ue("task-modal"),document.getElementById("project-details").classList.contains("active")){let C=v||w.projectId;C&&Ae(C)}else document.getElementById("projects").classList.contains("active")&&(te.projectsSortedView=null,_e(),Oe());qe().catch(C=>{console.error("Failed to save task:",C),W(w("error.saveChangesFailed"))})}}else{let m=Cs({title:n,description:o,projectId:s,startDate:l,endDate:d,priority:i,status:r,tags:window.tempTags?[...window.tempTags]:[]},L,Ge,je);L=m.tasks,Ge=m.taskCounter;let g=m.task;je=[],window.tempTags=[],window.historyService&&window.historyService.recordTaskCreated(g),g&&g.projectId&&(Wt(g.projectId),Gt(g.projectId,"added",g),Qe().catch(()=>{})),Va(),ya(),Qt(),Ue("task-modal"),g.projectId&&document.getElementById("project-details").classList.contains("active")?(Ae(g.projectId),Oe()):document.getElementById("projects").classList.contains("active")&&(te.projectsSortedView=null,_e(),Oe()),qe().catch(y=>{console.error("Failed to save task:",y),W(p("error.saveChangesFailed"))})}Ue("task-modal"),zt(),document.getElementById("calendar-view")&&ie(),_o(),qe().catch(m=>{console.error("Failed to save task:",m),W(p("error.saveChangesFailed"))}),ye("tasks",a,{taskCount:L.length,projectCount:N.length})}document.getElementById("task-form").addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation(),Id()});function jd(){document.body.hasAttribute("data-status-dropdown-initialized")||(document.body.setAttribute("data-status-dropdown-initialized","true"),document.addEventListener("click",Cd))}function Cd(e){if(e.target.closest("#task-options-btn")){e.preventDefault(),e.stopPropagation();let n=document.getElementById("options-menu");n&&(n.style.display=n.style.display==="block"?"none":"block");return}let t=document.getElementById("options-menu");if(t&&!e.target.closest("#task-options-btn")&&!e.target.closest("#options-menu")&&(t.style.display="none"),e.target.closest("#status-current")){e.preventDefault(),e.stopPropagation();let n=e.target.closest(".status-dropdown"),o=n.classList.contains("active");if(document.querySelectorAll(".status-dropdown.active").forEach(s=>s.classList.remove("active")),!o){n.classList.add("active");let s=document.getElementById("hidden-status");s&&Lo(s.value)}return}if(e.target.closest(".status-option")){e.preventDefault(),e.stopPropagation();let n=e.target.closest(".status-option"),o=n.dataset.status,r=n.querySelector(".status-badge").textContent.trim(),i=document.getElementById("status-current"),c=document.getElementById("hidden-status");if(i&&c){let u=i.querySelector(".status-badge");u&&(u.className=`status-badge ${o}`,u.textContent=r),c.value=o,lt("status",o)}let l=n.closest(".status-dropdown");l&&l.classList.remove("active"),setTimeout(()=>Lo(o),100);return}document.querySelectorAll(".status-dropdown.active").forEach(n=>{n.contains(e.target)||n.classList.remove("active")})}function Ld(){document.body.hasAttribute("data-priority-dropdown-initialized")||(document.body.setAttribute("data-priority-dropdown-initialized","true"),document.addEventListener("click",Pd))}function Pd(e){if(e.target.closest("#priority-current")){e.preventDefault(),e.stopPropagation();let a=e.target.closest(".priority-dropdown"),n=a.classList.contains("active");if(document.querySelectorAll(".priority-dropdown.active").forEach(o=>o.classList.remove("active")),!n){a.classList.add("active");let o=document.getElementById("hidden-priority");o&&In(o.value)}return}if(e.target.closest(".priority-option")){e.preventDefault(),e.stopPropagation();let a=e.target.closest(".priority-option"),n=a.dataset.priority,o=a.textContent.trim(),s=document.getElementById("priority-current"),r=document.getElementById("hidden-priority");s&&r&&(s.innerHTML=`<span class="priority-dot ${n}"></span> ${o} <span class="dropdown-arrow">\u25BC</span>`,r.value=n,lt("priority",n));let i=a.closest(".priority-dropdown");i&&i.classList.remove("active"),setTimeout(()=>In(n),100);return}document.querySelectorAll(".priority-dropdown.active").forEach(a=>{a.contains(e.target)||a.classList.remove("active")})}function In(e){let t=document.getElementById("priority-options");if(!t)return;let n=Rs.map(o=>({...o,label:et(o.value)})).filter(o=>o.value!==e);t.innerHTML=n.map(o=>`<div class="priority-option" data-priority="${o.value}">
            <span class="priority-dot ${o.value}"></span> ${o.label}
        </div>`).join("")}function Lo(e){let t=document.getElementById("status-options");if(!t)return;let a=[{value:"backlog",label:He("backlog")},{value:"todo",label:He("todo")},{value:"progress",label:He("progress")},{value:"review",label:He("review")},{value:"done",label:He("done")}],n=a;window.enableReviewStatus===!1&&(n=a.filter(s=>s.value!=="review"));let o=n.filter(s=>s.value!==e);t.innerHTML=o.map(s=>`<div class="status-option" data-status="${s.value}">
            <span class="status-badge ${s.value}">${s.label}</span>
        </div>`).join("")}function Ad(){document.body.hasAttribute("data-project-dropdown-initialized")||(document.body.setAttribute("data-project-dropdown-initialized","true"),document.addEventListener("click",Bd))}function Bd(e){if(e.target.closest("#project-current")){e.preventDefault(),e.stopPropagation();let a=e.target.closest(".project-dropdown"),n=a.classList.contains("active");document.querySelectorAll(".project-dropdown.active").forEach(o=>o.classList.remove("active")),n||(a.classList.add("active"),Nd(a));return}if(e.target.closest(".project-option")){e.preventDefault(),e.stopPropagation();let a=e.target.closest(".project-option"),n=a.dataset.projectId,o=a.textContent.trim(),s=document.getElementById("project-current"),r=document.getElementById("hidden-project");if(s&&r){let c=s.querySelector(".project-text");if(c)if(n){let l=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Te(parseInt(n))}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;c.innerHTML=l+U(o)}else c.textContent=o;r.value=n,lt("projectId",n),qn(n)}let i=a.closest(".project-dropdown");i&&i.classList.remove("active"),It();return}let t=document.querySelectorAll(".project-dropdown.active");t.length>0&&!e.target.closest(".project-dropdown")&&(t.forEach(a=>a.classList.remove("active")),It())}function qn(e){let t=document.getElementById("task-project-open-btn");t&&(t.style.display=e?"inline-flex":"none")}function $d(){let e=document.getElementById("hidden-project");if(!e||!e.value)return;let t=parseInt(e.value,10);t&&(Ue("task-modal"),Ae(t,"projects"))}function fi(e){let t=e?e.querySelector(".project-options"):null,a=document.getElementById("hidden-project"),n=a&&a.value||"",o=n?`<div class="project-option" data-project-id="">${p("tasks.project.selectPlaceholder")}</div>`:"";return N&&N.length>0&&(o+=N.slice().sort((s,r)=>(s.name||"").localeCompare(r.name||"",void 0,{sensitivity:"base"})).filter(s=>n===""||String(s.id)!==String(n)).map(s=>{let r=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Te(s.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;return`<div class="project-option" data-project-id="${s.id}">${r}${U(s.name)}</div>`}).join("")),t&&(t.innerHTML=o),o}var Ce=null,jn=null,ra=[];function Nd(e){let t=fi(e)||"";Ce||(Ce=document.createElement("div"),Ce.className="project-options-portal",document.body.appendChild(Ce)),Ce.innerHTML=`
        <div class="project-portal-search">
            <input type="text" class="form-input" id="project-portal-search-input" placeholder="Search projects..." autocomplete="off" />
        </div>
        <div class="project-portal-options">${t}</div>
    `,Ce.style.display="block";let a=e.querySelector("#project-current");jn=a,Po(a,Ce),requestAnimationFrame(()=>Po(a,Ce)),Ce.addEventListener("click",s=>{s.stopPropagation();let r=s.target.closest(".project-option");if(!r)return;let i=r.dataset.projectId,c=r.textContent.trim(),l=document.getElementById("project-current"),u=document.getElementById("hidden-project");if(l&&u){let f=l.querySelector(".project-text");if(f)if(i){let m=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Te(parseInt(i))}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;f.innerHTML=m+U(c)}else f.textContent=c;u.value=i,lt("projectId",i),qn(i)}let d=a.closest(".project-dropdown");d&&d.classList.remove("active"),It()},{once:!0});let n=Ce.querySelector("#project-portal-search-input");n&&(n.addEventListener("input",()=>Nu(n.value)),setTimeout(()=>n.focus(),0)),window.addEventListener("scroll",ma,!0),window.addEventListener("resize",ma,!0),document.addEventListener("keydown",hi,!0);let o=e.querySelector(".project-options");o&&(o.style.display="none"),Md(a)}function Po(e,t){let a=e.getBoundingClientRect();t.style.width=`${a.width}px`;let n=window.innerHeight,o=Math.min(t.scrollHeight,200),i=n-a.bottom<o+12?Math.max(8,a.top-o-4):a.bottom+4,c=window.innerWidth,l=t.getBoundingClientRect().width||a.width,u=a.left,d=Math.min(Math.max(8,u),Math.max(8,c-l-8));t.style.left=`${d}px`,t.style.top=`${i}px`}function It(){Ce&&(Ce.style.display="none",Ce.innerHTML=""),document.querySelectorAll(".project-dropdown .project-options").forEach(e=>{e.style.display=""}),window.removeEventListener("scroll",ma,!0),window.removeEventListener("resize",ma,!0),document.removeEventListener("keydown",hi,!0),jn=null,gi()}function ma(){!jn||!Ce||Ce.style.display==="none"||(document.querySelector(".project-dropdown.active")?Po(jn,Ce):It())}function Md(e){gi(),ra=Fd(e),ra.forEach(t=>{t.addEventListener("scroll",ma,{capture:!0,passive:!0})})}function gi(){!ra||ra.length===0||(ra.forEach(e=>{e.removeEventListener("scroll",ma,{capture:!0})}),ra=[])}function Fd(e){let t=[],a=e.parentElement;for(;a&&a!==document.body;){let n=getComputedStyle(a);/(auto|scroll|overlay)/.test(n.overflowY)&&a.scrollHeight>a.clientHeight&&t.push(a),a=a.parentElement}return t.push(document.documentElement),t.push(document.body),t}function hi(e){e.key==="Escape"&&(It(),document.querySelectorAll(".project-dropdown.active").forEach(t=>t.classList.remove("active")))}function Rd(e){document.execCommand(e,!1,null),document.getElementById("task-description-editor").focus()}function Od(e){document.execCommand("formatBlock",!1,e),document.getElementById("task-description-editor").focus()}function qd(){let e=document.getElementById("task-description-editor");if(!e)return;let t=window.getSelection(),a=!1;if(t&&t.rangeCount){let o=t.getRangeAt(0).commonAncestorContainer,s=o.nodeType===1?o.closest?.(".check-text"):o.parentElement?.closest?.(".check-text");if(s&&e.contains(s)){let r=s.closest(".checkbox-row");if(r&&r.parentNode){let i=document.createElement("div");i.innerHTML='<div class="divider-row"><hr></div><div><br></div>';let c=i.firstChild;r.parentNode.insertBefore(c,r.nextSibling);let l=document.createRange(),u=c.nextSibling;u?(l.setStart(u,0),l.collapse(!0)):(l.selectNodeContents(e),l.collapse(!1)),t.removeAllRanges(),t.addRange(l),e.focus(),e.dispatchEvent(new Event("input")),a=!0}}}a||(document.execCommand("insertHTML",!1,'<div class="divider-row"><hr></div><div><br></div>'),document.getElementById("task-description-editor").focus())}function zd(){let e=document.getElementById("task-description-editor");if(!e)return;let t="chk-"+Date.now()+"-"+Math.floor(Math.random()*1e3),a=`<div class="checkbox-row" data-id="${t}" contenteditable="false"><button type="button" class="checkbox-toggle variant-1" aria-pressed="false" title="${p("tasks.checklist.toggle")}" contenteditable="false"></button><div class="check-text" contenteditable="true"></div></div>`;try{document.execCommand("insertHTML",!1,a)}catch{e.insertAdjacentHTML("beforeend",a)}setTimeout(()=>{let n=e.querySelector(`[data-id="${t}"] .check-text`);if(n){let o=document.createRange();o.selectNodeContents(n),o.collapse(!0);let s=window.getSelection();s.removeAllRanges(),s.addRange(o),n.focus()}e.dispatchEvent(new Event("input"))},10)}function yi(e){if(!e)return e;let t=document.createElement("div");t.innerHTML=e;let a=/(https?:\/\/[^\s<]+)/g,n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),o=[];for(;n.nextNode();){let s=n.currentNode;if(!s||!s.nodeValue)continue;let r=s.parentElement;r&&r.closest("a")||(a.lastIndex=0,a.test(s.nodeValue)&&o.push(s))}return o.forEach(s=>{let r=s.nodeValue,i=0;a.lastIndex=0;let c=document.createDocumentFragment(),l;for(;(l=a.exec(r))!==null;){let u=l[0];l.index>i&&c.appendChild(document.createTextNode(r.slice(i,l.index)));let d=document.createElement("a");d.href=u,d.textContent=u,d.target="_blank",d.rel="noopener noreferrer",c.appendChild(d),i=l.index+u.length}i<r.length&&c.appendChild(document.createTextNode(r.slice(i))),s.parentNode&&s.parentNode.replaceChild(c,s)}),t.innerHTML}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("task-description-editor"),t=document.getElementById("task-description-hidden");e&&t&&(e.addEventListener("input",function(){t.value=e.innerHTML}),e.addEventListener("paste",function(c){if(!c.clipboardData)return;let l=Array.from(c.clipboardData.files||[])[0];if(!l||!l.type||!l.type.startsWith("image/"))return;c.preventDefault(),c.stopPropagation();let u=document.getElementById("attachment-file-dropzone");typeof Ln=="function"&&Ln(l,u).catch(d=>{console.error("Failed to upload pasted image as attachment:",d)})}),e.addEventListener("keydown",function(c){let l=window.getSelection();if((c.key==="Backspace"||c.key==="Delete")&&l&&l.rangeCount)try{let u=l.getRangeAt(0);if(!u.collapsed&&u.startContainer!==u.endContainer)return;if(u.collapsed){let d=u.startContainer;if(!(d.nodeType===1?d.closest?.(".check-text"):d.parentElement?.closest?.(".check-text"))&&c.key==="Backspace"){let m=d.nodeType===3?d.parentElement:d;if(m&&(d.nodeType===3,u.startOffset===0)){let y=m.previousSibling;for(;y&&y.nodeType!==1;)y=y.previousSibling;if(y&&y.classList&&y.classList.contains("checkbox-row")){c.preventDefault();let v=y.querySelector(".check-text");if(v){v.firstChild||v.appendChild(document.createTextNode(""));let w=(v.firstChild.nodeType===3,v.firstChild),C=w.nodeType===3?w.length:v.textContent?v.textContent.length:0,T=document.createRange();try{T.setStart(w,C)}catch{T.selectNodeContents(v),T.collapse(!1)}T.collapse(!0),l.removeAllRanges(),l.addRange(T),v.focus(),e.dispatchEvent(new Event("input"));return}}}}}else{let f=function(E){let D=E.nodeType===3?E.parentElement:E;for(;D&&D.parentElement!==e;)D=D.parentElement;return D},d=Array.from(e.childNodes),m=f(u.startContainer),g=f(u.endContainer),y=d.indexOf(m),v=d.indexOf(g);y===-1&&(y=0),v===-1&&(v=d.length-1);let w=Math.min(y,v),C=Math.max(y,v),T=!1;for(let E=w;E<=C;E++){let D=d[E];if(D&&D.classList&&D.classList.contains("checkbox-row")){let b=D.nextSibling;D.parentNode.removeChild(D),b&&b.nodeType===1&&b.tagName.toLowerCase()==="div"&&b.innerHTML.trim()==="<br>"&&b.parentNode.removeChild(b),T=!0}}if(T){c.preventDefault(),e.dispatchEvent(new Event("input"));return}}}catch{}if(c.key==="Enter"){if(!l||!l.rangeCount){c.stopPropagation();return}let d=l.getRangeAt(0).commonAncestorContainer,f=d.nodeType===1?d.closest?.(".check-text"):d.parentElement?.closest?.(".check-text");if(f&&e.contains(f)){c.preventDefault();let m=f.closest(".checkbox-row");if(!m)return;let g=l.getRangeAt(0),y=g.cloneRange();y.selectNodeContents(f),y.setEnd(g.startContainer,g.startOffset);let v=y.toString(),w=g.cloneRange();w.selectNodeContents(f),w.setStart(g.endContainer,g.endOffset);let C=w.toString();if(v.length===0&&C.length===0){let T=document.createElement("div");T.innerHTML="<br>",m.parentNode.replaceChild(T,m);let E=document.createRange();E.setStart(T,0),E.collapse(!0),l.removeAllRanges(),l.addRange(E),e.focus(),e.dispatchEvent(new Event("input"));return}if(C.length===0){let T="chk-"+Date.now()+"-"+Math.floor(Math.random()*1e3),E=document.createElement("div");E.innerHTML=`<div class="checkbox-row" data-id="${T}" contenteditable="false"><button type="button" class="checkbox-toggle variant-1" aria-pressed="false" title="${p("tasks.checklist.toggle")}" contenteditable="false"></button><div class="check-text" contenteditable="true"></div></div>`;let D=E.firstChild;if(m&&m.parentNode){m.parentNode.insertBefore(D,m.nextSibling);let b=D.querySelector(".check-text"),S=document.createRange();S.selectNodeContents(b),S.collapse(!0),l.removeAllRanges(),l.addRange(S),b.focus(),e.dispatchEvent(new Event("input"))}return}document.execCommand("insertHTML",!1,"<br><br>"),e.dispatchEvent(new Event("input"));return}c.stopPropagation();return}if((c.key==="Backspace"||c.key==="Delete")&&l&&l.rangeCount){let u=l.getRangeAt(0),d=u.commonAncestorContainer,f=d.nodeType===1?d.closest?.(".check-text"):d.parentElement?.closest?.(".check-text");if(console.log("[checkbox-editor] keydown",{key:c.key,collapsed:u.collapsed,containerNodeType:d.nodeType,containerTag:d.nodeType===1?d.tagName:null,isInCheckText:!!f}),f&&e.contains(f)){let m=f.closest(".checkbox-row");if(!m)return;let g=u.cloneRange();g.selectNodeContents(f),g.setEnd(u.startContainer,u.startOffset);let y=g.toString(),v=u.cloneRange();v.selectNodeContents(f),v.setStart(u.endContainer,u.endOffset);let w=v.toString();if(c.key==="Backspace"&&y.length===0){c.preventDefault(),console.log("[checkbox-editor] Backspace at start of checkbox row",{beforeText:y,afterText:w});let C=m.previousSibling,T=m.nextSibling;for(;C&&C.nodeType!==1;)C=C.previousSibling;m.parentNode.removeChild(m),T&&T.nodeType===1&&T.tagName.toLowerCase()==="div"&&T.innerHTML.trim()==="<br>"&&T.parentNode.removeChild(T);let E=window.getSelection(),D=document.createRange(),b=null,S=!1;if(C&&C.classList&&C.classList.contains("checkbox-row")){let x=C.querySelector(".check-text");if(x){x.firstChild||x.appendChild(document.createTextNode(""));let $=(x.firstChild.nodeType===3,x.firstChild),z=$.nodeType===3?$.length:x.textContent?x.textContent.length:0;try{D.setStart($,z)}catch{D.selectNodeContents(x)}D.collapse(!1),S=!0,b=x,console.log("[checkbox-editor] caret moved to previous checkbox row")}}if(!S){for(;T&&T.nodeType!==1;)T=T.nextSibling;T&&T.parentNode?(D.setStart(T,0),D.collapse(!0)):(D.selectNodeContents(e),D.collapse(!1)),console.log("[checkbox-editor] caret fallback placement",{hasNext:!!T})}E.removeAllRanges(),E.addRange(D),b&&typeof b.focus=="function"?b.focus():e.focus();{let x=E.anchorNode;console.log("[checkbox-editor] final caret location",{nodeType:x?x.nodeType:null,tag:x&&x.nodeType===1?x.tagName:null,textSnippet:x&&x.textContent?x.textContent.slice(0,30):null,insideCheckboxRow:!!(x&&x.parentElement&&x.parentElement.closest(".checkbox-row"))})}e.dispatchEvent(new Event("input"));return}if(c.key==="Delete"&&w.length===0){c.preventDefault();let C=m.nextSibling;m.parentNode.removeChild(m),C&&C.nodeType===1&&C.tagName.toLowerCase()==="div"&&C.innerHTML.trim()==="<br>"&&C.parentNode.removeChild(C);let T=window.getSelection(),E=document.createRange();C?(E.setStart(C,0),E.collapse(!0)):(E.selectNodeContents(e),E.collapse(!1)),T.removeAllRanges(),T.addRange(E),e.focus(),e.dispatchEvent(new Event("input"));return}}}}),e.addEventListener("click",function(c){let l=c.target.closest(".checkbox-toggle");if(!l)return;let u=l.getAttribute("aria-pressed")==="true";l.setAttribute("aria-pressed",String(!u)),l.classList.toggle("checked",!u),l.innerText=u?"":"\u2714",e.dispatchEvent(new Event("input"))}));let a=document.getElementById("task-description-editor");a&&a.addEventListener("click",function(c){let l=c.target.closest("a");if(!l)return;let u=l.getAttribute("href");if(!u)return;let d=window.getSelection();d&&d.toString()||(c.preventDefault(),c.stopPropagation(),window.open(u,"_blank","noopener,noreferrer"))});let n=document.getElementById("attachment-url"),o=document.getElementById("attachment-name");n&&n.addEventListener("keydown",function(c){c.key==="Enter"&&(c.preventDefault(),$o())}),o&&o.addEventListener("keydown",function(c){c.key==="Enter"&&(c.preventDefault(),$o())});let s=document.getElementById("checklist-btn");s&&s.addEventListener("click",function(){let c=document.getElementById("task-description-editor"),l=window.getSelection();Ru(c)||zd()});let r=document.getElementById("tag-input");r&&r.addEventListener("keydown",function(c){c.key==="Enter"&&(c.preventDefault(),Oi())});let i=document.getElementById("feedback-description");if(i){let c=i.getAttribute("placeholder")||"",l="Describe the issue or idea.",u=()=>typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:window.innerWidth<=768,d=()=>{i.placeholder=u()?l:c};if(d(),typeof window.matchMedia=="function"){let f=window.matchMedia("(max-width: 768px)");typeof f.addEventListener=="function"?f.addEventListener("change",d):typeof f.addListener=="function"&&f.addListener(d)}i.addEventListener("keypress",function(f){f.key==="Enter"&&(f.preventDefault(),Qo())})}});function Hd(){let e=new Date,t=e.getMonth(),a=e.getFullYear();return{currentMonth:t,currentYear:a}}var vi=Hd(),we=vi.currentMonth,Se=vi.currentYear;function Go(){localStorage.setItem("calendarMonth",we.toString()),localStorage.setItem("calendarYear",Se.toString())}function ie(){let e=ke("render","calendar",{taskCount:L.length,month:we+1,year:Se}),t=Ct(),a=Is(t),n=new Date;document.getElementById("calendar-month-year").textContent=js(t,Se,we);let o=h.projects.size>0?new Set(Array.from(h.projects).map(l=>parseInt(l,10))):null,s=ir(Se,we,{tasks:L,projects:N,filteredProjectIds:o,includeBacklog:!!M.calendarIncludeBacklog,today:n}),r=s.isCurrentMonth;try{let l=typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:window.innerWidth<=768;l&&document.querySelectorAll(".calendar-today-btn--header").forEach(u=>{u.style.display=r?"none":"inline-flex"}),l||document.querySelectorAll(".calendar-today-btn--nav").forEach(u=>{u.style.display=r?"none":"inline-flex"})}catch{}let i=cr(s,a);document.getElementById("calendar-grid").innerHTML=i;let c=document.getElementById("project-overlay");c&&(c.style.opacity="0"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{$a()})})}var pt=0,Lr=20;function $a(){let e=ke("render","projectBars",{taskCount:L.length,projectCount:N.length});try{let t=document.getElementById("project-overlay");if(!t){console.error("[ProjectBars] No overlay element found!"),pt=0;return}t.innerHTML="",t.style.opacity="0";let a=document.getElementById("calendar-grid");if(!a){console.error("[ProjectBars] No calendar grid found!"),pt=0;return}let n=document.getElementById("calendar-view");if(!(n&&(n.classList.contains("active")||n.classList.contains("preparing")))){pt=0;return}let s=a.offsetHeight,r=a.offsetWidth,i=Array.from(a.querySelectorAll(".calendar-day"));if(i.length===0)if(pt<Lr){console.warn("[ProjectBars] No day elements found, retrying in 100ms..."),pt++,setTimeout($a,100);return}else{console.error("[ProjectBars] Max retries reached, giving up"),pt=0;return}let c=i[0].getBoundingClientRect();if(c.width===0||c.height===0)if(pt<Lr){console.warn("[ProjectBars] Elements not ready (zero dimensions), retrying in 50ms...",{firstDayRect:c}),pt++,setTimeout($a,50);return}else{console.error("[ProjectBars] Max retries reached, giving up"),pt=0;return}pt=0;let l=i.map((I,P)=>({element:I,index:P,gridIndex:P,day:parseInt(I.querySelector(".calendar-day-number").textContent),isOtherMonth:I.classList.contains("other-month")})).filter(I=>!I.isOtherMonth),u=h.projects.size>0?Array.from(h.projects).map(I=>parseInt(I,10)):N.map(I=>I.id),d=N.filter(I=>u.includes(I.id)),f=new Map;d.slice().sort((I,P)=>{let j=I.startDate||"",B=P.startDate||"";if(j!==B)return j.localeCompare(B);let H=I.endDate||I.startDate||"",J=P.endDate||P.startDate||"";if(H!==J)return H.localeCompare(J);let X=(I.name||"").toLowerCase(),Q=(P.name||"").toLowerCase();return X!==Q?X.localeCompare(Q):(I.id||0)-(P.id||0)}).forEach((I,P)=>f.set(I.id,P));let m=l.length>0?l[0].gridIndex:-1,g=l.length>0?l[l.length-1].gridIndex:-1,y=new Map,v=new Map;d.forEach(I=>{let[P,j,B]=I.startDate.split("-").map(ne=>parseInt(ne)),H=new Date(P,j-1,B),[J,X,Q]=(I.endDate||I.startDate).split("-").map(ne=>parseInt(ne)),_=new Date(J,X-1,Q),ae=new Date(Se,we,1),R=new Date(Se,we+1,0);if(H<=R&&_>=ae){let ne=H<ae?ae:H,ue=_>R?R:_,ce=ne.getDate(),xe=ue.getDate(),de=l.find(Fe=>Fe.day===ce),be=l.find(Fe=>Fe.day===xe);if(!de||!be)return;let Lt=de.gridIndex,bt=be.gridIndex,it=Lt;for(;it<=bt;){let Fe=Math.floor(it/7)*7,Pt=Math.min(Fe+6,bt),ea=Math.max(it,Fe),_n=Pt,ba=Math.floor(ea/7);y.has(ba)||y.set(ba,[]),y.get(ba).push({startIndex:ea,endIndex:_n,project:I}),it=Pt+1}}});let w=ta(window.kanbanUpdatedFilter),C=typeof yt=="function"?yt():L.slice(),T=w===null?C:C.filter(I=>At(I)>=w),b=(!!M.calendarIncludeBacklog?T:T.filter(I=>I.status!=="backlog")).filter(I=>{let P=I.endDate&&I.endDate.length===10&&I.endDate.includes("-"),j=I.startDate&&I.startDate.length===10&&I.startDate.includes("-");return P||j}),S=new Map,x=I=>I.startDate&&I.startDate.length===10&&I.startDate.includes("-")?I.startDate:I.endDate||"";b.slice().sort((I,P)=>{let j=x(I),B=x(P);if(j!==B)return j.localeCompare(B);let H=I.endDate||"",J=P.endDate||"";if(H!==J)return H.localeCompare(J);let X=(I.title||"").toLowerCase(),Q=(P.title||"").toLowerCase();return X!==Q?X.localeCompare(Q):(I.id||0)-(P.id||0)}).forEach((I,P)=>S.set(I.id,P)),b.forEach(I=>{let P,j,B=I.startDate&&I.startDate.length===10&&I.startDate.includes("-"),H=I.endDate&&I.endDate.length===10&&I.endDate.includes("-");if(B){let[Q,_,ae]=I.startDate.split("-").map(R=>parseInt(R));P=new Date(Q,_-1,ae)}else if(H){let[Q,_,ae]=I.endDate.split("-").map(R=>parseInt(R));P=new Date(Q,_-1,ae)}else return;if(H){let[Q,_,ae]=I.endDate.split("-").map(R=>parseInt(R));j=new Date(Q,_-1,ae)}else if(B)j=P;else return;let J=new Date(Se,we,1),X=new Date(Se,we+1,0);if(P<=X&&j>=J){let Q=P<J?J:P,_=j>X?X:j,ae=Q.getDate(),R=_.getDate(),ne=l.find(be=>be.day===ae),ue=l.find(be=>be.day===R);if(!ne||!ue)return;let ce=ne.gridIndex,xe=ue.gridIndex,de=ce;for(;de<=xe;){let be=Math.floor(de/7)*7,Lt=Math.min(be+6,xe),bt=Math.max(de,be),it=Lt,Fe=Math.floor(bt/7);v.has(Fe)||v.set(Fe,[]),v.get(Fe).push({startIndex:bt,endIndex:it,task:I}),de=Lt+1}}});let $=18,z=3,O=20,k=4,A=a.offsetHeight,V=a.getBoundingClientRect(),G=new Map;y.forEach((I,P)=>{I.sort((B,H)=>(f.get(B.project.id)??0)-(f.get(H.project.id)??0)||B.startIndex-H.startIndex||B.endIndex-H.endIndex);let j=[];I.forEach(B=>{let H=j.findIndex(J=>B.startIndex>J);H===-1?(H=j.length,j.push(B.endIndex)):j[H]=B.endIndex,B.track=H}),I.forEach(B=>{let H=i[B.startIndex],J=i[B.endIndex];if(!H||!J)return;let X=H.getBoundingClientRect(),Q=J.getBoundingClientRect(),_=document.createElement("div");_.className="project-bar",vt(B.project.id)==="completed"&&_.classList.add("completed"),_.style.position="absolute";let ae=6,R=X.left-V.left+ae,ne=Q.right-X.left-ae*2;R<0&&(ne+=R,R=0),R+ne>V.width&&(ne=Math.max(0,V.width-R)),ne=Math.max(0,ne),_.style.left=R+"px",_.style.width=ne+"px";let ue=H.querySelector(".project-spacer"),ce=(ue?ue.getBoundingClientRect().top:X.top)-V.top;_.style.top=ce+B.track*($+z)+"px",_.style.height=$+"px";let xe=Te(B.project.id);_.style.background=`linear-gradient(90deg, ${xe}, ${xe}dd)`,_.style.textShadow="0 1px 2px rgba(0,0,0,0.3)",_.style.fontWeight="600",_.style.color="white",_.style.padding="1px 6px",_.style.fontSize="10px",_.style.display="flex",_.style.alignItems="center",_.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)",_.style.pointerEvents="auto",_.style.cursor="pointer",_.style.zIndex="10",_.style.whiteSpace="nowrap",_.style.overflow="hidden",_.style.textOverflow="ellipsis";let de=`${Se}-${String(we+1).padStart(2,"0")}-01`,be=new Date(Se,we+1,0).getDate(),Lt=`${Se}-${String(we+1).padStart(2,"0")}-${String(be).padStart(2,"0")}`,bt=B.project.startDate,it=B.project.endDate||B.project.startDate,Fe=bt<de&&B.startIndex===m,Pt=it>Lt&&B.endIndex===g;Fe&&_.classList.add("continues-left"),Pt&&_.classList.add("continues-right"),_.style.borderTopLeftRadius=Fe?"0":"6px",_.style.borderBottomLeftRadius=Fe?"0":"6px",_.style.borderTopRightRadius=Pt?"0":"6px",_.style.borderBottomRightRadius=Pt?"0":"6px",_.textContent=B.project.name,_.onclick=ea=>{ea.stopPropagation(),Ae(B.project.id,"calendar",{month:we,year:Se})},t.appendChild(_)}),G.has(P)||G.set(P,{projectTracks:0,taskTracks:0}),G.get(P).projectTracks=j.length}),v.forEach((I,P)=>{I.sort((B,H)=>(S.get(B.task.id)??0)-(S.get(H.task.id)??0)||B.startIndex-H.startIndex||B.endIndex-H.endIndex);let j=[];I.forEach(B=>{let H=j.findIndex(J=>B.startIndex>J);H===-1?(H=j.length,j.push(B.endIndex)):j[H]=B.endIndex,B.track=H}),I.forEach(B=>{let H=B.task.startDate&&B.task.startDate.length===10&&B.task.startDate.includes("-"),J=B.task.endDate&&B.task.endDate.length===10&&B.task.endDate.includes("-"),X=i[B.startIndex],Q=i[B.endIndex];if(!X||!Q)return;let _=X.getBoundingClientRect(),ae=Q.getBoundingClientRect(),R=document.createElement("div");R.className="task-bar",B.task.status==="done"&&R.classList.add("done"),R.style.position="absolute";let ne=6,ue=_.left-V.left+ne,ce=ae.right-_.left-ne*2;ue<0&&(ce+=ue,ue=0),ue+ce>V.width&&(ce=Math.max(0,V.width-ue)),ce=Math.max(0,ce),R.style.left=ue+"px",R.style.width=ce+"px";let xe=X.querySelector(".project-spacer"),de=(xe?xe.getBoundingClientRect().top:_.top)-V.top,be=G.get(P)?.projectTracks||0,Lt=be*($+z),bt=be>0?6:0;R.style.top=de+Lt+bt+B.track*(O+k)+"px",R.style.height=O+"px";let it=eo[B.task.priority]||"var(--accent-blue)";H?(R.style.borderLeftWidth="5px",R.style.borderLeftColor=it):R.style.borderLeftWidth="1px",J?(R.style.borderRightWidth="5px",R.style.borderRightColor=it):R.style.borderRightWidth="1px",R.style.color="var(--text-primary)",R.style.padding="2px 6px",R.style.fontSize="11px",R.style.fontWeight="500",R.style.display="flex",R.style.alignItems="center",R.style.boxShadow="var(--shadow-sm)",R.style.pointerEvents="auto",R.style.cursor="pointer",R.style.zIndex="11",R.style.whiteSpace="nowrap",R.style.overflow="hidden",R.style.textOverflow="ellipsis";let Fe=`${Se}-${String(we+1).padStart(2,"0")}-01`,Pt=new Date(Se,we+1,0).getDate(),ea=`${Se}-${String(we+1).padStart(2,"0")}-${String(Pt).padStart(2,"0")}`,_n=H?B.task.startDate:B.task.endDate,ba=J?B.task.endDate:B.task.startDate,Vn=_n<Fe&&B.startIndex===m,Wn=ba>ea&&B.endIndex===g;Vn&&R.classList.add("continues-left"),Wn&&R.classList.add("continues-right"),H&&R.classList.add("has-start-date"),J&&R.classList.add("has-end-date"),R.style.borderTopLeftRadius=Vn?"0":"4px",R.style.borderBottomLeftRadius=Vn?"0":"4px",R.style.borderTopRightRadius=Wn?"0":"4px",R.style.borderBottomRightRadius=Wn?"0":"4px",R.textContent=B.task.title,R.onclick=Zi=>{Zi.stopPropagation(),va(B.task.id)},t.appendChild(R)}),G.has(P)||G.set(P,{projectTracks:0,taskTracks:0}),G.get(P).taskTracks=j.length});let Y=a.querySelectorAll(".calendar-day .project-spacer"),K=new Map;Y.forEach(I=>{let P=parseInt(I.closest(".calendar-day").dataset.row,10),j=G.get(P)||{projectTracks:0,taskTracks:0},B=j.projectTracks>0?j.projectTracks*($+z):0,H=j.taskTracks>0?j.taskTracks*(O+k):0,J=j.projectTracks>0&&j.taskTracks>0?6:0,X=B+H+J+(j.projectTracks>0||j.taskTracks>0?4:0);I.style.height=X+"px",K.set(P,X)}),t.style.opacity="1"}catch(t){console.error("[ProjectBars] Error rendering project/task bars:",t)}ye("render",e,{taskCount:L.length,projectCount:N.length})}function bi(e){_d(e)}function Ud(){let e=document.querySelector(".calendar-stage");if(!e||e.dataset.swipeReady==="true")return;e.dataset.swipeReady="true";let t=0,a=0,n=!1,o=!1;e.addEventListener("touchstart",s=>{if(s.touches.length!==1)return;let r=s.touches[0];t=r.clientX,a=r.clientY,n=!0,o=!1},{passive:!0}),e.addEventListener("touchmove",s=>{if(!n)return;let r=s.touches[0],i=r.clientX-t,c=r.clientY-a;o||(Math.abs(i)>12&&Math.abs(i)>Math.abs(c)?o=!0:Math.abs(c)>12&&(n=!1)),o&&s.preventDefault()},{passive:!1}),e.addEventListener("touchend",s=>{if(!n||(n=!1,!o))return;let r=s.changedTouches[0],i=r.clientX-t,c=r.clientY-a;if(Math.abs(i)<50||Math.abs(i)<Math.abs(c))return;let l=i<0?1:-1;bi(l)},{passive:!0}),e.addEventListener("touchcancel",()=>{n=!1,o=!1},{passive:!0})}document.addEventListener("DOMContentLoaded",()=>{Ud()});function _d(e){let t=rr(Se,we,e);Se=t.year,we=t.month,Go(),ie(),document.getElementById("calendar-view")&&ie()}function Vd(){let e=new Date;we=e.getMonth(),Se=e.getFullYear(),Go(),ie(),document.getElementById("calendar-view")&&ie()}function vt(e){let t=L.filter(r=>r.projectId===e);if(t.length===0)return"planning";let a=t.every(r=>r.status==="done"),n=t.some(r=>r.status==="progress"||r.status==="review"),o=t.some(r=>r.status==="todo"),s=t.every(r=>r.status==="backlog");return a?"completed":n?"active":o?"planning":s?"backlog":"planning"}function Wd(e){let t=ta(window.kanbanUpdatedFilter),a=typeof yt=="function"?yt():L.slice(),o=(t===null?a:a.filter(d=>At(d)>=t)).filter(d=>d.startDate&&d.endDate?e>=d.startDate&&e<=d.endDate:d.endDate?d.endDate===e:d.startDate?d.startDate===e:!1);M.calendarIncludeBacklog||(o=o.filter(d=>d.status!=="backlog")),o.sort((d,f)=>{let m=oe[d.priority]||0;return(oe[f.priority]||0)-m});let r=N.filter(d=>{let f=new Date(d.startDate),m=d.endDate?new Date(d.endDate):new Date(d.startDate),g=new Date(e);return g>=f&&g<=m});if(o.length===0&&r.length===0){let d=`No tasks or projects for ${pe(e)}. Would you like to create a new task?`;document.getElementById("calendar-create-message").textContent=d,document.getElementById("calendar-create-modal").classList.add("active"),window.pendingCalendarDate=e;return}let i=document.getElementById("day-items-modal"),c=document.getElementById("day-items-modal-title"),l=document.getElementById("day-items-modal-body");c.textContent=p("calendar.dayItemsTitle",{date:pe(e)}),window.dayItemsModalDate=e;let u="";r.length>0&&(u+='<div class="day-items-section">',u+=`<div class="day-items-section-title">\u{1F4CA} ${p("calendar.dayItemsProjects")}</div>`,r.forEach(d=>{let f=vt(d.id);u+=`
                <div class="day-item" data-action="closeDayItemsAndShowProject" data-param="${d.id}">
                    <div class="day-item-title">${U(d.name)}</div>
                    <div class="day-item-meta" style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap;">
                        <span>${pe(d.startDate)} - ${pe(d.endDate)}</span>
                        <span class="project-status-badge ${f}">${Ha(f).toUpperCase()}</span>
                    </div>
                </div>
            `}),u+="</div>"),o.length>0&&(u+='<div class="day-items-section">',u+=`<div class="day-items-section-title">\u2705 ${p("calendar.dayItemsTasks")}</div>`,o.forEach(d=>{let f="";if(d.projectId){let y=N.find(v=>v.id===d.projectId);y?f=`<span class="project-indicator" style="background-color: ${Te(d.projectId)}; color: white; padding: 1px 6px; border-radius: 8px; font-size: 10px; margin-right: 6px; text-shadow: 0 1px 2px rgba(0,0,0,0.3); font-weight: 600;">${U(y.name)}</span>`:f=p("tasks.projectIndicatorNone")}else f=p("tasks.projectIndicatorNone");let m=`<span class="status-badge ${d.status}" style="padding: 2px 8px; font-size: 10px; font-weight: 600;">${He(d.status)}</span>`,g=et(d.priority||"").toUpperCase();u+=`
                <div class="day-item" data-action="closeDayItemsAndOpenTask" data-param="${d.id}">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 8px;">
                        <div class="day-item-title" style="flex: 1; min-width: 0;">${U(d.title)}</div>
                        <div class="day-item-meta" style="display: flex; align-items: center; gap: 6px; flex-shrink: 0;"><span class="task-priority priority-${d.priority}">${g}</span>${m}</div>
                    </div>
                    <div style="margin-top: 8px; font-size: 11px;">${f}</div>
                </div>
            `}),u+="</div>"),l.innerHTML=u,i.classList.add("active")}function zn(){document.getElementById("day-items-modal").classList.remove("active")}function Gd(e){let t=document.getElementById("day-items-modal");t&&e.target===t&&zn()}function Yd(){let e=window.dayItemsModalDate;zn(),e&&(On(),setTimeout(()=>{let t=document.getElementById("task-modal");if(!t)return;let a=t.querySelector('#task-form input[name="endDate"]');if(!a)return;let n=a.closest(".date-input-wrapper");if(!n)return;let o=n.querySelector(".date-display");!o||!o._flatpickr||(a.value=e,o._flatpickr.setDate(new Date(e),!1))},100)),window.dayItemsModalDate=null}document.addEventListener("keydown",function(e){let t=document.getElementById("day-items-modal");t&&t.classList.contains("active")&&e.key==="Escape"&&(e.preventDefault(),zn())});function Yo(){document.getElementById("project-confirm-modal").classList.remove("active"),document.getElementById("delete-tasks-checkbox").checked=!1,document.getElementById("project-confirm-error").classList.remove("show"),qt=null}function Na(e){window.pendingModalToClose=e,document.getElementById("unsaved-changes-modal").classList.add("active")}function ki(){document.getElementById("unsaved-changes-modal").classList.remove("active")}function Kd(){let e=window.pendingModalToClose||"task-modal";if(ki(),e==="task-modal")Je=null;else if(e==="settings-modal"){window.initialSettingsFormState=null,window.settingsFormIsDirty=!1;let a=document.getElementById("settings-form")?.querySelector(".settings-btn-save");a&&(a.classList.remove("dirty"),a.disabled=!0)}window.pendingModalToClose=null,Ue(e)}function wi(){document.getElementById("review-status-confirm-modal").classList.remove("active"),window.pendingReviewStatusToggle&&(window.pendingReviewStatusToggle.checked=!0,window.pendingReviewStatusToggle.dispatchEvent(new Event("change",{bubbles:!0})),typeof window.markSettingsDirtyIfNeeded=="function"&&window.markSettingsDirtyIfNeeded()),window.pendingReviewTaskMigration=null,window.pendingReviewStatusToggle=null}async function Jd(){let e=window.pendingReviewTaskMigration?[...window.pendingReviewTaskMigration]:[];if(wi(),e&&e.length>0){let n=e.map(o=>o.id);L.forEach(o=>{n.includes(o.id)&&(o.status="progress")}),await qe()}let t=document.getElementById("enable-review-status-toggle");t&&(t.checked=!1,window.enableReviewStatus=!1,localStorage.setItem("enableReviewStatus","false"),M.enableReviewStatus=!1,await Ho(),ts(),Me());let a=document.getElementById("save-settings-btn");window.initialSettingsFormState=null,window.settingsFormIsDirty=!1,a&&(a.classList.remove("dirty"),a.disabled=!0),Ue("settings-modal"),Ke(p("success.settingsSaved"))}function Ko(){document.getElementById("calendar-create-modal").classList.remove("active"),window.pendingCalendarDate=null}function Zd(){let e=window.pendingCalendarDate;Ko(),e&&(On(),setTimeout(()=>{let t=document.getElementById("task-modal");if(!t)return;let a=t.querySelector('#task-form input[name="endDate"]');if(!a)return;let n=a.closest(".date-input-wrapper");if(!n)return;let o=n.querySelector(".date-display");!o||!o._flatpickr||(a.value=e,o._flatpickr.setDate(new Date(e),!1))},100))}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("calendar-create-modal");e&&e.addEventListener("click",function(t){t.target===e&&Ko()})});async function Si(){let e=document.getElementById("project-confirm-input"),t=document.getElementById("project-confirm-error"),a=e.value,n=document.getElementById("delete-tasks-checkbox");if(a!=="delete"){t.classList.add("show"),e.focus();return}let o=parseInt(qt,10),s=N.find(c=>c.id===o),r=n.checked;r&&(L=L.filter(c=>c.projectId!==o));let i=Ms(o,N,L,!r);N=i.projects,window.historyService&&s&&window.historyService.recordProjectDeleted(s),!r&&i.tasks&&(L=i.tasks),Yo(),te.projectsSortedView=null,window.location.hash="#projects",Re("projects"),zt(),Promise.all([Qe().catch(c=>{console.error("Failed to save projects:",c),W(p("error.saveChangesFailed"))}),r?qe().catch(c=>{console.error("Failed to save tasks:",c),W(p("error.saveChangesFailed"))}):Promise.resolve()])}function Ae(e,t,a){let n=ke("projects","details",{projectId:e});if(t!==void 0){if(Pe=t,t==="calendar"){let b=a&&Number.isInteger(a.month)?a.month:we,S=a&&Number.isInteger(a.year)?a.year:Se;ft={month:b,year:S}}}else Pe||(Pe="projects");window.location.hash=`project-${e}`;let o=N.find(b=>b.id===e);if(!o){ye("projects",n,{projectId:e,found:!1});return}window.innerWidth<=768&&window.scrollTo({top:0,behavior:"smooth"}),document.querySelectorAll(".page").forEach(b=>b.classList.remove("active")),document.getElementById("project-details").classList.add("active");let s=document.querySelector(".user-menu");s&&(s.style.display="none");let r=L.filter(b=>b.projectId===e),i=r.filter(b=>b.status==="done"),c=r.filter(b=>b.status==="progress"),l=r.filter(b=>b.status==="review"),u=r.filter(b=>b.status==="todo"),d=r.filter(b=>b.status==="backlog"),f=r.length>0?Math.round(i.length/r.length*100):0,m=vt(e),g=o.startDate?new Date(o.startDate):null,y=o.endDate?new Date(o.endDate):new Date,v=g&&Number.isFinite(g.getTime())&&Number.isFinite(y.getTime())?Math.ceil((y-g)/(1e3*60*60*24)):null,w=Number.isFinite(v)?p("projects.details.durationDays",{count:v}):"-",C=`
        <div class="project-details-header">
                    <div class="project-details-title">
                        <span id="project-title-display" data-action="editProjectTitle" data-param="${e}" data-param2="${U(o.name).replace(/'/g,"&#39;")}" style="font-size: 32px; font-weight: 700; color: var(--text-primary); cursor: pointer;">${U(o.name)}</span>
                        <div id="project-title-edit" style="display: none;">
                            <input type="text" id="project-title-input" class="editable-project-title" value="${U(o.name)}" style="font-size: 32px; font-weight: 700;">
                            <button class="title-edit-btn confirm" data-action="saveProjectTitle" data-param="${e}">\u2713</button>
                            <button class="title-edit-btn cancel" data-action="cancelProjectTitle">\u2715</button>
                        </div>
                        <span class="project-status-badge ${m}" data-action="showStatusInfoModal">${Ha(m).toUpperCase()}</span>
                        <button class="back-btn" data-action="${Pe==="dashboard"?"backToDashboard":Pe==="calendar"?"backToCalendar":"backToProjects"}" style="padding: 8px 12px; font-size: 14px; display: flex; align-items: center; gap: 6px; margin-left: 12px;">${p(Pe==="dashboard"?"projects.backTo.dashboard":Pe==="calendar"?"projects.backTo.calendar":"projects.backTo.projects")}</button>
                        <div style="margin-left: auto; position: relative;">
                            <button type="button" class="options-btn" id="project-options-btn" data-action="toggleProjectMenu" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:20px;padding:4px;line-height:1;">\u22EF</button>
                            <div class="options-menu" id="project-options-menu" style="position:absolute;top:calc(100% + 8px);right:0;display:none;">
                                <button type="button" class="duplicate-btn" data-action="handleDuplicateProject" data-param="${e}" style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:none;border:none;color:var(--text-primary);cursor:pointer;font-size:14px;width:100%;text-align:left;border-radius:4px;">\u{1F4CB} ${p("projects.duplicate.title")}</button>
                                <button type="button" class="delete-btn" data-action="handleDeleteProject" data-param="${e}">\u{1F5D1}\uFE0F ${p("projects.delete.title")}</button>
                            </div>
                        </div>
	                    </div>

	                    <div class="modal-tabs project-details-tabs">
	                        <button type="button" class="modal-tab active" data-tab="details">${p("projects.details.tab.details")}</button>
	                        <button type="button" class="modal-tab" data-tab="history">${p("projects.details.tab.history")}</button>
	                    </div>

	                    <div class="modal-tab-content active" id="project-details-tab">
		                    <div class="project-details-description">
		                        <textarea class="editable-description" id="project-description-editor">${o.description||""}</textarea>
		                    </div>
                    <div class="project-timeline">
                        <div class="timeline-item">
                            <div class="timeline-label">${p("projects.details.startDate")}</div>
                            <input type="text" class="form-input date-display editable-date datepicker"
                                placeholder="dd/mm/yyyy" maxLength="10"
                                value="${o.startDate?pe(o.startDate):""}"
                                data-project-id="${e}" data-field="startDate">
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-label">${p("projects.details.endDate")}</div>
                                <input type="text" class="form-input date-display editable-date datepicker"
                                    placeholder="dd/mm/yyyy" maxLength="10"
                                    value="${o.endDate?pe(o.endDate):""}"
                                    data-project-id="${e}" data-field="endDate">
                        </div>
	                        <div class="timeline-item">
	                            <div class="timeline-label">${p("projects.details.duration")}</div>
	                            <div class="timeline-value">${w}</div>
	                        </div>
                        <div class="timeline-item">
                            <div class="timeline-label">${p("projects.details.created")}</div>
                            <div class="timeline-value">${pe(o.createdAt?.split("T")[0])}</div>
                        </div>
                        <div class="timeline-item" style="position: relative;">
                            <div class="timeline-label">${p("projects.details.calendarColor")}</div>
                            <div class="color-picker-container" style="position: relative;">
                                <div class="current-color" 
                                     style="background-color: ${Te(e)}; width: 20px; height: 20px; border-radius: 4px; border: 2px solid var(--border-color); cursor: pointer; display: inline-block;"
                                     data-action="toggleProjectColorPicker" data-param="${e}">
                                </div>
                                <div class="color-picker-dropdown" id="color-picker-${e}" style="display: none; position: absolute; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 8px; margin-top: 4px; z-index: 1000; left: 0; top: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                                    <div class="color-grid" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px;">
                                        ${ka.map(b=>`
                                            <div class="color-option" 
                                                 style="width: 24px; height: 24px; background-color: ${b}; border-radius: 4px; cursor: pointer; border: 2px solid ${b===Te(e)?"white":"transparent"};"
                                                 data-action="updateProjectColor" data-param="${e}" data-param2="${b}">
                                            </div>
                                        `).join("")}
                                    </div>
                                    <div class="color-picker-custom" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-light); display: flex; align-items: center; justify-content: space-between; gap: 8px; position: relative;">
                                        <span style="font-size: 12px; color: var(--text-muted);">${p("projects.details.customColor")}</span>
                                        <div 
                                            class="custom-color-swatch" 
                                            data-action="openCustomProjectColorPicker" 
                                            data-param="${e}"
                                            style="width: 24px; height: 24px; background-color: ${Te(e)}; border-radius: 4px; cursor: pointer; border: 2px solid transparent; box-sizing: border-box;">
                                        </div>
	                                        <input 
	                                            type="color" 
	                                            id="project-color-input-${e}"
	                                            class="project-color-input" 
	                                            data-project-id="${e}"
	                                            value="${Te(e)}"
	                                            style="position: absolute; opacity: 0; pointer-events: none; width: 0; height: 0;">
	                                    </div>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="timeline-item" style="grid-column: 1 / -1;">
	                            <div class="timeline-label">${p("projects.modal.tagsLabel")}</div>
	                            <div style="margin-top: 8px;">
	                                <div id="project-details-tags-display" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; min-height: 28px;"></div>
	                                <div style="display: flex; gap: 8px;">
	                                    <input type="text" id="project-details-tag-input" class="form-input" placeholder="${p("projects.modal.addTagPlaceholder")}" style="flex: 1;">
	                                    <button type="button" class="btn-secondary" data-action="addProjectDetailsTag" data-param="${e}">+</button>
	                                </div>
	                            </div>
	                        </div>
	                    </div>

	                    <div class="project-progress-section">
                    <div class="progress-header">
                        <div class="progress-title">${p("projects.details.progressOverview")}</div>
                        <div class="progress-percentage">${f}%</div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: ${f}%"></div>
                    </div>
                    <div class="progress-stats">
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="backlog" title="${p("projects.details.viewBacklog")}">
                            <div class="progress-stat-number" style="color: var(--text-muted);">${d.length}</div>
                            <div class="progress-stat-label">${p("tasks.status.backlog")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="todo" title="${p("projects.details.viewTodo")}">
                            <div class="progress-stat-number" style="color: var(--text-muted);">${u.length}</div>
                            <div class="progress-stat-label">${p("tasks.status.todo")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="progress" title="${p("projects.details.viewProgress")}">
                            <div class="progress-stat-number" style="color: var(--accent-blue);">${c.length}</div>
                            <div class="progress-stat-label">${p("tasks.status.progress")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="review" title="${p("projects.details.viewReview")}">
                            <div class="progress-stat-number" style="color: var(--accent-amber);">${l.length}</div>
                            <div class="progress-stat-label">${p("tasks.status.review")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="done" title="${p("projects.details.viewCompleted")}">
                            <div class="progress-stat-number" style="color: var(--accent-green);">${i.length}</div>
                            <div class="progress-stat-label">${p("tasks.status.done")}</div>
                        </div>
                    </div>
                </div>
                
                <div class="project-tasks-section">
                    <div class="section-header">
                        <div class="section-title">${p("projects.details.tasksTitle",{count:r.length})}</div>
                        <button class="add-btn" data-action="openTaskModalForProject" data-param="${e}">${p("tasks.addButton")}</button>
                    </div>
                    <div id="project-tasks-list">
                        ${r.length===0?`<div class="empty-state">${p("tasks.empty.epic")}</div>`:r.sort((b,S)=>{let x=oe[b.priority]||1;return(oe[S.priority]||1)-x}).map(b=>`
                                        <div class="project-task-item" data-action="openTaskDetails" data-param="${b.id}">
                                            <div class="project-task-info">
                                                <div class="project-task-title">${b.title}</div>
                                                <div class="project-task-meta">${b.endDate?`${p("tasks.endDatePrefix")}${pe(b.endDate)}`:p("tasks.noDatesSet")}</div>
                                                ${b.tags&&b.tags.length>0?`
                                                    <div class="task-tags" style="margin-top: 4px;">
                                                        ${b.tags.map(S=>`<span style="background-color: ${Xt(S)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${U(S.toUpperCase())}</span>`).join(" ")}
                                                    </div>
                                                `:""}
                                            </div>
                                            <div class="project-task-priority">
                                                <div class="task-priority priority-${b.priority}"><span class="priority-dot ${b.priority}"></span> ${et(b.priority)}</div>
                                            </div>
                                            <div class="project-task-status-col">
                                                <div class="status-badge ${b.status}">
                                                    ${He(b.status)}
                                                </div>
                                            </div>
                                        </div>
                            `).join("")}
                    </div>
                </div>

                </div>

	                <div class="modal-tab-content" id="project-history-tab">
	                    <div class="project-history-section">
                    <div class="section-header">
                        <div class="section-title">\u{1F4DC} ${p("projects.details.changeHistory")}</div>
                    </div>
                    <div class="history-timeline-inline" id="project-history-timeline-${e}">
                        <!-- Timeline will be populated by JavaScript -->
                    </div>
                    <div class="history-empty-inline" id="project-history-empty-${e}" style="display: none;">
                        <div style="font-size: 36px; margin-bottom: 12px; opacity: 0.3;">\u{1F4DC}</div>
                        <p style="color: var(--text-muted); text-align: center;">${p("projects.details.noChanges")}</p>
                    </div>
	                    </div>
	                </div>
	        </div>
	            `;document.getElementById("project-details-content").innerHTML=C;let T=document.getElementById("project-description-editor");if(T){let b=()=>Zt(e,"description",T.value,{render:!1}),S=typeof sn=="function"?sn(b,500):b;T.addEventListener("input",S),T.addEventListener("blur",b)}Xd(e);let E=document.getElementById(`project-color-input-${e}`);E&&E.addEventListener("change",b=>{Ol(e,b.target.value)}),setTimeout(()=>{document.querySelectorAll("input.datepicker").forEach(b=>{b._flatpickrInstance&&(b._flatpickrInstance.destroy(),delete b._flatpickrInstance)}),xt()},50),Ya(o.tags||[],e);let D=document.getElementById("project-details-tag-input");D&&(D.replaceWith(D.cloneNode(!0)),document.getElementById("project-details-tag-input").addEventListener("keydown",function(S){S.key==="Enter"&&(S.preventDefault(),qi(e))})),ye("projects",n,{projectId:e,taskCount:r.length,completionPercentage:f})}function Xd(e){let t=document.getElementById("project-details-content");if(!t)return;let a=t.querySelector(".project-details-tabs");if(!a)return;let n=t.querySelector("#project-details-tab"),o=t.querySelector("#project-history-tab");if(!n||!o)return;let s=r=>{a.querySelectorAll(".modal-tab").forEach(c=>c.classList.remove("active")),t.querySelectorAll(".modal-tab-content").forEach(c=>c.classList.remove("active"));let i=a.querySelector(`.modal-tab[data-tab="${r}"]`);if(i&&i.classList.add("active"),r==="history"){o.classList.add("active"),Bo(e);let c=o.querySelector(".project-history-section");c&&(c.scrollTop=0)}else n.classList.add("active")};a.querySelectorAll(".modal-tab").forEach(r=>{r.addEventListener("click",()=>{s(r.dataset.tab)})}),s("details")}function Qd(e){qt=e,Ei()}function Ei(){let e=qt;if(!e)return;let t=L.filter(r=>r.projectId===e),a=document.getElementById("delete-tasks-checkbox"),n=a?a.closest('div[style*="margin: 16px"]'):null;n&&(t.length===0?n.style.display="none":n.style.display="block"),document.getElementById("project-confirm-modal").classList.add("active");let o=document.getElementById("project-confirm-input");o.value="",o.focus();let s=function(r){let i=r.target.selectionStart,c=r.target.selectionEnd;r.target.value=r.target.value.toLowerCase(),r.target.setSelectionRange(i,c)};o.addEventListener("input",s),document.addEventListener("keydown",function(r){let i=document.getElementById("project-confirm-modal");!i||!i.classList.contains("active")||(r.key==="Escape"?(r.preventDefault(),Yo()):r.key==="Enter"&&(r.preventDefault(),Si()))})}var Jo=null;function eu(e){Jo=e;let t=document.getElementById("project-duplicate-modal");if(!N.find(u=>u.id===e))return;let n=L.filter(u=>u.projectId===e),o=document.getElementById("duplicate-tasks-checkbox"),s=document.getElementById("task-naming-options");n.length===0?(o&&(o.checked=!1,o.disabled=!0),s&&(s.style.display="none")):(o&&(o.checked=!0,o.disabled=!1),s&&(s.style.display="block"));let r=document.querySelector('input[name="task-naming"][value="none"]');r&&(r.checked=!0);let i=document.getElementById("task-prefix-input"),c=document.getElementById("task-suffix-input");i&&(i.value="",i.disabled=!0),c&&(c.value="",c.disabled=!0),t.classList.add("active"),o&&o.addEventListener("change",function(){s&&(s.style.display=this.checked?"block":"none")}),document.querySelectorAll('input[name="task-naming"]').forEach(u=>{u.addEventListener("change",function(){i&&(i.disabled=this.value!=="prefix"),c&&(c.disabled=this.value!=="suffix"),this.value==="prefix"&&i?setTimeout(()=>i.focus(),100):this.value==="suffix"&&c&&setTimeout(()=>c.focus(),100)})})}function Di(){document.getElementById("project-duplicate-modal").classList.remove("active"),Jo=null}async function tu(){let e=Jo;if(!e)return;let t=N.find(r=>r.id===e);if(!t)return;let a=document.getElementById("duplicate-tasks-checkbox"),n=a&&a.checked,o=r=>r;if(n){let r=document.querySelector('input[name="task-naming"]:checked')?.value||"none";if(r==="prefix"){let i=document.getElementById("task-prefix-input")?.value||"";i&&(o=c=>`${i}${c}`)}else if(r==="suffix"){let i=document.getElementById("task-suffix-input")?.value||"";i&&(o=c=>`${c}${i}`)}}let s={id:st,name:`Copy - ${t.name}`,description:t.description||"",startDate:t.startDate||"",endDate:t.endDate||"",tags:t.tags?[...t.tags]:[],createdAt:new Date().toISOString()};st++,N.push(s),n&&L.filter(i=>i.projectId===e).forEach(i=>{let c={...i,id:Ge,title:o(i.title),projectId:s.id,createdAt:new Date().toISOString(),tags:i.tags?[...i.tags]:[],attachments:i.attachments?JSON.parse(JSON.stringify(i.attachments)):[]};Ge++,L.push(c)}),window.historyService&&window.historyService.recordProjectCreated(s),Di(),te.projectsSortedView=null,Ke(n?p("projects.duplicate.successWithTasks",{name:s.name}):p("projects.duplicate.success",{name:s.name})),Promise.all([Qe().catch(r=>{console.error("Failed to save projects:",r),W(p("error.saveChangesFailed"))}),n?qe().catch(r=>{console.error("Failed to save tasks:",r),W(p("error.saveChangesFailed"))}):Promise.resolve()]),Ae(s.id,"projects")}function au(){document.getElementById("project-details").classList.remove("active");let e=document.querySelector(".user-menu");e&&(e.style.display="block");try{window.location.hash="#projects"}catch{}Re("projects"),document.querySelectorAll(".nav-item").forEach(t=>t.classList.remove("active")),document.querySelector('.nav-item[data-page="projects"]').classList.add("active"),_e()}function nu(){document.getElementById("project-details").classList.remove("active");let e=document.querySelector(".user-menu");if(e&&(e.style.display="block"),ft&&Number.isInteger(ft.month)&&Number.isInteger(ft.year)){we=ft.month,Se=ft.year;try{Go()}catch{}}Ma(),ie()}function ou(e){On();let t=document.getElementById("task-modal"),a=t.querySelector("#hidden-project"),n=t.querySelector("#project-current .project-text"),o=N.find(s=>String(s.id)===String(e));if(a&&(a.value=String(e||"")),n&&o){let s=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Te(o.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;n.innerHTML=s+U(o.name)}typeof It=="function"&&It(),setTimeout(()=>Ri(),150)}function su(){let e=document.getElementById("settings-modal");if(!e)return;let t=e.querySelector("#settings-form"),a=t.querySelector("#user-name"),n=t.querySelector("#auto-start-date-toggle"),o=t.querySelector("#auto-end-date-toggle"),s=t.querySelector("#enable-review-status-toggle"),r=t.querySelector("#calendar-include-backlog-toggle"),i=t.querySelector("#debug-logs-toggle"),c=t.querySelector("#history-sort-order"),l=t.querySelector("#language-select"),u=window.authSystem?.getCurrentUser();a.value=u?.name||"";let d=t.querySelector("#user-email");d.value=u?.email||M.notificationEmail||"";let f=t.querySelector("#email-notifications-enabled"),m=t.querySelector("#email-notifications-weekdays-only"),g=t.querySelector("#email-notifications-include-start-dates"),y=t.querySelector("#email-notifications-include-backlog"),v=t.querySelector("#email-notification-time"),w=t.querySelector("#email-notification-time-trigger"),C=t.querySelector("#email-notification-time-value"),T=t.querySelector("#email-notification-timezone"),E=t.querySelector("#email-notification-timezone-trigger"),D=t.querySelector("#email-notification-timezone-value"),b=t.querySelector("#email-notification-details");if(f&&(f.checked=M.emailNotificationsEnabled!==!1),m&&(m.checked=!!M.emailNotificationsWeekdaysOnly),g&&(g.checked=!!M.emailNotificationsIncludeStartDates),y&&(y.checked=!!M.emailNotificationsIncludeBacklog),v){let Y=ro(Ea(M.emailNotificationTime)||"09:00",30);v.value=io(Y||"09:00","08:00","18:00")||"09:00",C&&(C.textContent=v.value)}T&&(T.value=String(M.emailNotificationTimeZone||"Atlantic/Canary"),D&&(D.textContent=T.options?.[T.selectedIndex]?.textContent||T.value||""));let S=()=>{let Y=!!f?.checked;b&&(b.classList.toggle("is-collapsed",!Y),b.setAttribute("aria-hidden",Y?"false":"true")),m&&(m.disabled=!Y),g&&(g.disabled=!Y),v&&(v.disabled=!Y),w&&(w.disabled=!Y),T&&(T.disabled=!Y),E&&(E.disabled=!Y)};S(),n&&(n.checked=!!M.autoSetStartDateOnStatusChange),o&&(o.checked=!!M.autoSetEndDateOnStatusChange),s&&(s.checked=!!M.enableReviewStatus),r&&(r.checked=!!M.calendarIncludeBacklog),i&&(i.checked=!!M.debugLogsEnabled),c.value=M.historySortOrder,l&&(l.value=Nt());let x=t.querySelector("#workspace-logo-input");x&&(x.value=""),Ze.hasPendingChange=!1,Ze.dataUrl=null,Xe.hasPendingChange=!1,Xe.dataUrl=null;let $=t.querySelector("#workspace-logo-preview"),z=t.querySelector("#workspace-logo-clear-btn");$&&z&&(M.customWorkspaceLogo?($.style.display="block",$.style.backgroundImage=`url(${M.customWorkspaceLogo})`,z.style.display="inline-flex"):($.style.display="none",$.style.backgroundImage="",z.style.display="none"));let O=new CustomEvent("refresh-workspace-logo-ui");document.dispatchEvent(O);let k=t.querySelector("#user-avatar-input");k&&(k.value=""),la(),window.initialSettingsFormState={userName:a.value||"",notificationEmail:d.value||"",emailNotificationsEnabled:!!f?.checked,emailNotificationsWeekdaysOnly:!!m?.checked,emailNotificationsIncludeStartDates:!!g?.checked,emailNotificationsIncludeBacklog:!!y?.checked,emailNotificationTime:v?.value||"",emailNotificationTimeZone:T?.value||"",autoSetStartDateOnStatusChange:!!M.autoSetStartDateOnStatusChange,autoSetEndDateOnStatusChange:!!M.autoSetEndDateOnStatusChange,enableReviewStatus:!!M.enableReviewStatus,calendarIncludeBacklog:!!r?.checked,debugLogsEnabled:!!i?.checked,historySortOrder:M.historySortOrder||"newest",language:Nt(),logoState:M.customWorkspaceLogo?"logo-set":"logo-none",avatarState:window.authSystem?.getCurrentUser?.()?.avatarDataUrl?"avatar-set":"avatar-none"};let A=t.querySelector(".settings-btn-save");if(A&&(A.classList.remove("dirty"),A.disabled=!0),!t.__settingsDirtyBound){t.__settingsDirtyBound=!0;let Y=()=>{if(!window.initialSettingsFormState)return;let K=Ze.hasPendingChange?"draft-changed":M.customWorkspaceLogo?"logo-set":"logo-none",I=Xe.hasPendingChange?"draft-changed":window.authSystem?.getCurrentUser?.()?.avatarDataUrl?"avatar-set":"avatar-none",P={userName:a.value||"",notificationEmail:d.value||"",emailNotificationsEnabled:!!f?.checked,emailNotificationsWeekdaysOnly:!!m?.checked,emailNotificationsIncludeStartDates:!!g?.checked,emailNotificationsIncludeBacklog:!!y?.checked,emailNotificationTime:v?.value||"",emailNotificationTimeZone:T?.value||"",autoSetStartDateOnStatusChange:!!n?.checked,autoSetEndDateOnStatusChange:!!o?.checked,enableReviewStatus:!!s?.checked,calendarIncludeBacklog:!!r?.checked,debugLogsEnabled:!!i?.checked,historySortOrder:c.value,language:l?.value||Nt(),logoState:K,avatarState:I},j=P.userName!==window.initialSettingsFormState.userName||P.notificationEmail!==window.initialSettingsFormState.notificationEmail||P.emailNotificationsEnabled!==window.initialSettingsFormState.emailNotificationsEnabled||P.emailNotificationsWeekdaysOnly!==window.initialSettingsFormState.emailNotificationsWeekdaysOnly||P.emailNotificationsIncludeBacklog!==window.initialSettingsFormState.emailNotificationsIncludeBacklog||P.emailNotificationsIncludeStartDates!==window.initialSettingsFormState.emailNotificationsIncludeStartDates||P.emailNotificationTime!==window.initialSettingsFormState.emailNotificationTime||P.emailNotificationTimeZone!==window.initialSettingsFormState.emailNotificationTimeZone||P.autoSetStartDateOnStatusChange!==window.initialSettingsFormState.autoSetStartDateOnStatusChange||P.autoSetEndDateOnStatusChange!==window.initialSettingsFormState.autoSetEndDateOnStatusChange||P.enableReviewStatus!==window.initialSettingsFormState.enableReviewStatus||P.calendarIncludeBacklog!==window.initialSettingsFormState.calendarIncludeBacklog||P.debugLogsEnabled!==window.initialSettingsFormState.debugLogsEnabled||P.historySortOrder!==window.initialSettingsFormState.historySortOrder||P.language!==window.initialSettingsFormState.language||P.logoState!==window.initialSettingsFormState.logoState||P.avatarState!==window.initialSettingsFormState.avatarState;A&&(j?(A.classList.add("dirty"),A.disabled=!1):(A.classList.remove("dirty"),A.disabled=!0)),window.settingsFormIsDirty=j};window.markSettingsDirtyIfNeeded=Y,[a,d,f,m,y,g,v,T,n,o,s,r,i,c,l,x,k].filter(Boolean).forEach(K=>{K.addEventListener("change",Y),(K.tagName==="INPUT"&&K.type==="text"||K.type==="email")&&K.addEventListener("input",Y)}),f&&!f.__emailInputsBound&&(f.__emailInputsBound=!0,f.addEventListener("change",()=>{S()})),w&&!w.__notificationTimeBound&&(w.__notificationTimeBound=!0,w.addEventListener("click",K=>{if(K.preventDefault(),K.stopPropagation(),!!!f?.checked)return;if(Ee&&Ee.style.display!=="none"){ua();return}Ml(w,v,C)})),E&&T&&!E.__notificationTimeZoneBound&&(E.__notificationTimeZoneBound=!0,E.addEventListener("click",K=>{if(K.preventDefault(),K.stopPropagation(),!!!f?.checked)return;if(ve&&ve.style.display!=="none"){da();return}Nl(E,T,D)})),T&&D&&!T.__timezoneValueBound&&(T.__timezoneValueBound=!0,T.addEventListener("change",()=>{D.textContent=T.options?.[T.selectedIndex]?.textContent||T.value||""}))}e.classList.add("active");let V=e.querySelector(".settings-modal-body");V&&(V.scrollTop=0);let G=e.querySelector("#reset-pin-btn");G&&!G.dataset.listenerAttached&&(G.dataset.listenerAttached="true",G.addEventListener("click",function(Y){Y.preventDefault(),Sd()}))}function Ga(){let e=document.getElementById("shared-user-dropdown");e&&e.classList.remove("active")}function Ti(){let e=document.getElementById("shared-user-avatar"),t=document.getElementById("shared-user-dropdown");if(e&&t){let a=e.cloneNode(!0);e.parentNode.replaceChild(a,e),a.addEventListener("click",function(n){n.stopPropagation(),Ft(),t.classList.toggle("active")}),t.addEventListener("click",function(n){n.target.closest(".dropdown-item:not(.disabled)")&&Ga()})}}function Zo(e,t){let a=document.querySelector(".user-name"),n=document.getElementById("shared-user-avatar");if(a&&(a.textContent=e),n){let o=e.split(" ").filter(Boolean),s="NL";o.length>0&&(o.length===1?s=o[0].slice(0,2).toUpperCase():s=(o[0][0]+o[o.length-1][0]).toUpperCase()),t?(n.classList.add("has-image"),n.style.backgroundImage=`url(${t})`,n.textContent=""):(n.classList.remove("has-image"),n.style.backgroundImage="",n.textContent=s)}}function ru(){let e=window.authSystem?.getCurrentUser();if(!e)return;Zo(e.name,e.avatarDataUrl);let t=document.querySelector(".user-email");t&&(t.textContent=e.email||e.username)}document.addEventListener("click",function(e){e.target.closest(".user-menu")||Ga(),e.target.closest(".notify-menu")||Ft()});function xi(){let t=document.documentElement.getAttribute("data-theme")==="dark"?"Nautilus_logo.png":"Nautilus_logo_light.png";document.querySelectorAll('img.logo, img[class*="boot-logo"]').forEach(a=>{a.closest(".overlay")||a.closest(".auth-overlay")||(a.src=t)})}function Xo(){let e=document.getElementById("theme-text");if(!e)return;let t=document.documentElement.getAttribute("data-theme")==="dark";e.textContent=p(t?"menu.lightMode":"menu.darkMode")}function iu(){let e=document.documentElement;e.getAttribute("data-theme")==="dark"?(e.removeAttribute("data-theme"),localStorage.setItem("theme","light")):(e.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")),Xo(),xi(),typeof Fa=="function"&&Fa()}var cu=localStorage.getItem("theme");cu==="dark"&&document.documentElement.setAttribute("data-theme","dark");Xo();xi();var Cn=!1;document.querySelector(".resizer").addEventListener("mousedown",function(e){Cn=!0,this.classList.add("dragging"),document.body.style.cursor="col-resize",document.body.style.userSelect="none",e.preventDefault()});document.addEventListener("mousemove",function(e){if(!Cn)return;let t=document.querySelector(".sidebar"),a=e.clientX;a>=200&&a<=500&&(t.style.width=a+"px")});document.addEventListener("mouseup",function(){Cn&&(Cn=!1,document.querySelector(".resizer").classList.remove("dragging"),document.body.style.cursor="",document.body.style.userSelect="")});function Zt(e,t,a,n){let s=(n||{}).render!==!1,r=a;(t==="startDate"||t==="endDate")&&Ye(a)&&(r=dt(a));let i=N.find(u=>u.id===e),c=i?JSON.parse(JSON.stringify(i)):null;if(i){let u=i[t];if((typeof u=="string"?u:u||"")===(typeof r=="string"?r:r||""))return}let l=Ns(e,t,r,N);if(l.project){N=l.projects;let u=l.project;u.updatedAt=new Date().toISOString(),te.projectsSortedView=null,window.historyService&&c&&window.historyService.recordProjectUpdated(c,u),s&&Ae(e),document.getElementById("calendar-view")?.classList.contains("active")&&Fa(),Qe().catch(d=>{console.error("Failed to save project field:",d),W(p("error.saveChangesFailed"))})}}window.updateProjectField=Zt;window.debouncedUpdateProjectField=typeof kr=="function"?kr:void 0;window.flushDebouncedProjectField=typeof wr=="function"?wr:void 0;function Ma(){let e=document.getElementById("tasks")?.classList.contains("active")&&document.getElementById("calendar-view")?.classList.contains("active");window.location.hash!=="#calendar"&&(window.location.hash="calendar"),document.getElementById("tasks")?.classList.contains("active")||Re("tasks"),document.querySelectorAll(".nav-item").forEach(c=>c.classList.remove("active")),document.querySelector(".nav-item.calendar-nav").classList.add("active");let t=document.querySelector(".view-toggle");t&&t.classList.add("hidden");let a=document.getElementById("kanban-settings-btn")?.parentElement;a&&(a.style.display="none");let n=document.getElementById("backlog-quick-btn");n&&(n.style.display="none");let o=document.querySelector(".kanban-board"),s=document.getElementById("list-view"),r=document.getElementById("calendar-view");o&&!o.classList.contains("hidden")&&o.classList.add("hidden"),s&&s.classList.contains("active")&&s.classList.remove("active"),r&&!r.classList.contains("active")&&r.classList.add("active");try{document.querySelector(".kanban-header")?.classList.add("calendar-mode")}catch{}let i=document.querySelector("#tasks .page-title");i&&(i.textContent="Calendar"),e?Fa():ie();try{Dt()}catch{}}function Fa(){document.getElementById("calendar-view")?.classList.contains("active")&&requestAnimationFrame(()=>requestAnimationFrame($a))}async function Qo(){let e=document.querySelector('input[name="feedback-type"]:checked'),t=e?e.value:"bug",a=document.getElementById("feedback-description").value.trim(),n=Jt||"";if(!a)return;let o={id:Kt++,type:t,description:a,screenshotUrl:n,createdAt:new Date().toISOString().split("T")[0],status:"open"};re.unshift(o),We.unshift(o.id),wn++,document.getElementById("feedback-description").value="",Ii(),Oe(),jt(),qo({action:"add",item:o}),_a()}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("feedback-type-btn"),t=document.getElementById("feedback-type-group"),a=document.getElementById("feedback-type-label");gt(),window.addEventListener("online",()=>{gt(),En(0)}),window.addEventListener("offline",gt),e&&t&&(e.addEventListener("click",function(f){f.stopPropagation(),t.classList.toggle("open")}),document.querySelectorAll('input[name="feedback-type"]').forEach(f=>{f.addEventListener("change",function(){let g={bug:p("feedback.type.bugLabel"),idea:p("feedback.type.improvementOption")}[this.value]||this.closest("label").textContent.trim();a.textContent=g,t.classList.remove("open")})}),document.addEventListener("click",function(f){t.contains(f.target)||t.classList.remove("open")}));let n=document.getElementById("feedback-description");n&&(n.addEventListener("keypress",function(d){d.key==="Enter"&&(d.preventDefault(),Qo())}),n.addEventListener("paste",function(d){if(!d.clipboardData)return;let f=Array.from(d.clipboardData.files||[])[0];f&&f.type&&f.type.startsWith("image/")&&(d.preventDefault(),Pr(f))}));let o=document.getElementById("feedback-screenshot-url"),s=document.getElementById("feedback-screenshot-file"),r=document.getElementById("feedback-screenshot-upload"),i=typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:window.innerWidth<=768,c=p(i?"feedback.screenshotDropzoneTap":"feedback.screenshotDropzoneDefault");o&&(o.textContent=c,o.classList.add("feedback-screenshot-dropzone"),o.dataset.defaultText=c);let l=document.getElementById("feedback-screenshot-preview");if(!l){let d=document.querySelector("#feedback .feedback-input-bar");d&&d.parentNode&&(l=document.createElement("div"),l.id="feedback-screenshot-preview",d.parentNode.insertBefore(l,d.nextSibling))}function u(d,f){if(!d||d.length===0)return;let m=d[0];if(!m.type||!m.type.startsWith("image/")){typeof W=="function"&&W(p("error.feedbackAttachImage"));return}f&&(f.preventDefault(),f.stopPropagation()),Pr(m)}o&&(o.addEventListener("dragover",function(d){d.preventDefault(),o.classList.add("feedback-screenshot-dragover")}),o.addEventListener("dragleave",function(d){d.preventDefault(),o.classList.remove("feedback-screenshot-dragover")}),o.addEventListener("drop",function(d){o.classList.remove("feedback-screenshot-dragover");let f=d.dataTransfer&&d.dataTransfer.files;u(f,d)}),o.addEventListener("paste",function(d){if(!d.clipboardData)return;let f=d.clipboardData.files;f&&f.length>0&&u(f,d)}),o.addEventListener("click",function(){s&&s.click()}),o.addEventListener("keydown",function(d){(d.key==="Enter"||d.key===" ")&&(d.preventDefault(),s&&s.click())})),r&&(r.style.display="none"),s&&s.addEventListener("change",function(d){let f=d.target.files;f&&f.length>0&&u(f,d),s.value=""})});function Pr(e){if(!e||!e.type||!e.type.startsWith("image/"))return;let t=new FileReader;t.onload=function(a){let n=a.target&&a.target.result;if(!n)return;Jt=n;let o=document.getElementById("feedback-screenshot-url");o&&o.dataset&&(o.dataset.hasInlineImage="true");let s=document.getElementById("feedback-screenshot-preview");if(s){s.innerHTML=`
                <div class="feedback-screenshot-preview-card">
                    <div class="feedback-screenshot-thumb">
                        <img src="${n}" alt="${p("feedback.screenshotPreviewAlt")}">
                    </div>
                    <div class="feedback-screenshot-meta">
                        <div class="feedback-screenshot-title">${p("feedback.screenshotPreviewTitle")}</div>
                        <div class="feedback-screenshot-subtitle">${p("feedback.screenshotPreviewSubtitle")}</div>
                    </div>
                    <button type="button" class="feedback-screenshot-remove">${p("feedback.screenshotRemove")}</button>
                </div>
            `,s.style.display="flex";let r=s.querySelector(".feedback-screenshot-thumb");r&&typeof Ra=="function"&&(r.onclick=function(){Ra(n,"Feedback Screenshot")});let i=s.querySelector(".feedback-screenshot-remove");i&&(i.onclick=function(c){c.preventDefault(),Ii()})}},t.onerror=function(){typeof W=="function"&&W(p("error.feedbackReadImage"))},t.readAsDataURL(e)}function Ii(){Jt="";let e=document.getElementById("feedback-screenshot-url");if(e){let a=e.dataset.defaultText||p("feedback.screenshotDropzoneDefault");e.textContent=a,e.dataset&&delete e.dataset.hasInlineImage}let t=document.getElementById("feedback-screenshot-preview");t&&(t.innerHTML="",t.style.display="none")}function lu(e){let t=re.find(s=>s.id===e);if(!t)return;let a=t.status,n=t.resolvedAt,o=++wn;t.status==="open"?(t.status="done",t.resolvedAt=new Date().toISOString()):(t.status="open",delete t.resolvedAt),Oe(),jt(),qo({action:"update",item:{id:t.id,status:t.status,resolvedAt:t.resolvedAt||null}},{onError:()=>{wn===o&&(t.status=a,n?t.resolvedAt=n:delete t.resolvedAt,Oe(),jt(),W(p("error.feedbackStatusFailed")))}}),_a()}function jt(){let e=document.getElementById("feedback-list-pending"),t=document.getElementById("feedback-list-done");if(!e||!t)return;let a={bug:"\u{1F41E}",improvement:"\u{1F4A1}",feature:"\u{1F4A1}",idea:"\u{1F4A1}"},n=re.filter(m=>m.status==="open").sort((m,g)=>new Date(g.createdAt)-new Date(m.createdAt)),o=re.filter(m=>m.status==="done").sort((m,g)=>new Date(g.resolvedAt||g.createdAt)-new Date(m.resolvedAt||m.createdAt)),s=Math.ceil(n.length/mt);St>s&&s>0&&(St=s);let r=(St-1)*mt,i=r+mt,c=n.slice(r,i),l=Math.ceil(o.length/mt);Et>l&&l>0&&(Et=l);let u=(Et-1)*mt,d=u+mt,f=o.slice(u,d);n.length===0?e.innerHTML=`<div class="empty-state" style="padding: 20px;"><p>${p("feedback.empty.pending")}</p></div>`:e.innerHTML=c.map(m=>`
            <div class="feedback-item ${m.status==="done"?"done":""}">
                <input type="checkbox" class="feedback-checkbox"
                       data-feedback-id="${m.id}"
                       ${m.status==="done"?"checked":""}>
                <span class="feedback-type-icon">${a[m.type]||"\u{1F4A1}"}</span>
                ${m.screenshotUrl?`<button type="button" class="feedback-screenshot-link" data-action="viewFeedbackScreenshot" data-param="${encodeURIComponent(m.screenshotUrl)}" title="${p("feedback.viewScreenshotTitle")}">\u{1F5BC}\uFE0F</button>`:""}
                <div class="feedback-description">${U(m.description)}</div>
                <div class="feedback-date">${pe(m.createdAt)}</div>
                <button class="feedback-delete-btn" data-action="deleteFeedbackItemWithStop" data-param="${m.id}">\u274C</button>
            </div>
        `).join(""),Ar("pending",n.length,s,St),o.length===0?t.innerHTML=`<div class="empty-state" style="padding: 20px;"><p>${p("feedback.empty.done")}</p></div>`:t.innerHTML=f.map(m=>`
            <div class="feedback-item done">
                <input type="checkbox" class="feedback-checkbox"
                       data-feedback-id="${m.id}"
                       checked>
                <span class="feedback-type-icon">${a[m.type]||"\u{1F4A1}"}</span>
                ${m.screenshotUrl?`<button type="button" class="feedback-screenshot-link" data-action="viewFeedbackScreenshot" data-param="${encodeURIComponent(m.screenshotUrl)}" title="${p("feedback.viewScreenshotTitle")}">\u{1F5BC}\uFE0F</button>`:""}
                <div class="feedback-description">${U(m.description)}</div>
                <div class="feedback-date">${pe(m.createdAt)}</div>
                <button class="feedback-delete-btn" data-action="deleteFeedbackItemWithStop" data-param="${m.id}">\u274C</button>
            </div>
        `).join(""),Ar("done",o.length,l,Et)}function Ar(e,t,a,n){let o=e==="pending"?"feedback-pagination-pending":"feedback-pagination-done",s=document.getElementById(o);if(!s)return;if(a<=1){s.innerHTML="",s.style.display="none";return}s.style.display="flex";let r=(n-1)*mt+1,i=Math.min(n*mt,t),c=`
        <div class="feedback-pagination-info">
            ${p("feedback.pagination.showing",{start:r,end:i,total:t})}
        </div>
        <div class="feedback-pagination-controls">
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${e}', 1)"
                ${n===1?"disabled":""}
                title="${p("feedback.pagination.first")}">
                &laquo;
            </button>
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${e}', ${n-1})"
                ${n===1?"disabled":""}
                title="${p("feedback.pagination.prev")}">
                &lsaquo;
            </button>
            <span class="feedback-pagination-page">
                ${p("feedback.pagination.pageOf",{current:n,total:a})}
            </span>
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${e}', ${n+1})"
                ${n===a?"disabled":""}
                title="${p("feedback.pagination.next")}">
                &rsaquo;
            </button>
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${e}', ${a})"
                ${n===a?"disabled":""}
                title="${p("feedback.pagination.last")}">
                &raquo;
            </button>
        </div>
    `;s.innerHTML=c}function du(e,t){let a=document.querySelector("#feedback .page-content"),n=document.activeElement,o=!!(n&&n.classList&&n.classList.contains("feedback-pagination-btn")),s=!!(a&&a.scrollHeight-(a.scrollTop+a.clientHeight)<80);e==="pending"?St=t:Et=t,jt();let r=e==="pending"?"feedback-pagination-pending":"feedback-pagination-done",c=o||s?r:e==="pending"?"feedback-list-pending":"feedback-list-done",l=document.getElementById(c);l&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{l.scrollIntoView({behavior:"smooth",block:c===r?"end":"start"})})})}window.changeFeedbackPage=du;function uu(){document.querySelectorAll(".modal-content .modal-tab").forEach(e=>{e.addEventListener("click",t=>{let a=t.target.dataset.tab,n=t.target.closest(".modal-content");if(!n)return;try{if(!!n.closest("#task-modal")){let r=n.querySelector("#task-footer");if(r&&window.getComputedStyle(r).display==="none")if(a==="history"){let c=Math.round(n.getBoundingClientRect().height);c>0&&(n.style.minHeight=`${c}px`,n.style.maxHeight=`${c}px`)}else(a==="general"||a==="details")&&(n.style.minHeight="",n.style.maxHeight="")}}catch{}if(n.querySelectorAll(".modal-tab").forEach(s=>s.classList.remove("active")),t.target.classList.add("active"),a==="general"||a==="details"){let s=n.querySelector("#task-details-tab"),r=n.querySelector("#task-history-tab");if(s&&r){n.querySelectorAll(".modal-tab-content").forEach(i=>{i.classList.remove("active")}),s.classList.add("active"),a==="details"?document.body.classList.add("mobile-tab-details-active"):document.body.classList.remove("mobile-tab-details-active");return}}document.body.classList.remove("mobile-tab-details-active"),n.querySelectorAll(".modal-tab-content").forEach(s=>{s.classList.remove("active")});let o=n.querySelector(`#task-${a}-tab`);if(o&&(o.classList.add("active"),a==="history")){let r=document.getElementById("task-form")?.dataset.editingTaskId;r&&Ao(parseInt(r));let i=document.querySelector(".task-history-container");i&&(i.scrollTop=0)}})})}function Ao(e){if(!window.historyService||!L.find(r=>r.id===e))return;let a=window.historyService.getEntityHistory("task",e),n=document.getElementById("task-history-timeline"),o=document.getElementById("task-history-empty");if(!n)return;if(a.length===0){n.innerHTML="",o&&(o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.padding="48px 20px");return}o&&(o.style.display="none"),M.historySortOrder==="oldest"&&(a=[...a].reverse());let s=document.getElementById("history-sort-toggle");if(s)s.innerHTML=M.historySortOrder==="newest"?p("history.sort.newest"):p("history.sort.oldest");else{let r=n.parentElement;s=document.createElement("button"),s.id="history-sort-toggle",s.className="history-sort-toggle",s.innerHTML=M.historySortOrder==="newest"?p("history.sort.newest"):p("history.sort.oldest"),s.onclick=()=>ji("task",e),r.insertBefore(s,n)}n.innerHTML=a.map(r=>Ci(r)).join("")}function ji(e,t){if(M.historySortOrder=M.historySortOrder==="newest"?"oldest":"newest",Ho(),e==="task"&&t)Ao(t);else if(e==="project"&&t)Bo(t);else{let n=document.getElementById("task-form")?.dataset.editingTaskId;n&&Ao(parseInt(n));let o=document.getElementById("project-details");if(o&&o.classList.contains("active")){let s=o.innerHTML.match(/renderProjectHistory\((\d+)\)/);s&&Bo(parseInt(s[1]))}}}function Bo(e){if(!window.historyService||!N.find(r=>r.id===e))return;let a=window.historyService.getEntityHistory("project",e),n=document.getElementById(`project-history-timeline-${e}`),o=document.getElementById(`project-history-empty-${e}`);if(!n)return;if(a.length===0){n.innerHTML="",o&&(o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.padding="48px 20px");return}o&&(o.style.display="none"),M.historySortOrder==="oldest"&&(a=[...a].reverse());let s=document.getElementById(`project-history-sort-toggle-${e}`);if(s)s.innerHTML=M.historySortOrder==="newest"?p("history.sort.newest"):p("history.sort.oldest");else{let r=n.parentElement;s=document.createElement("button"),s.id=`project-history-sort-toggle-${e}`,s.className="history-sort-toggle",s.innerHTML=M.historySortOrder==="newest"?p("history.sort.newest"):p("history.sort.oldest"),s.onclick=()=>ji("project",e),r.insertBefore(s,n)}n.innerHTML=a.map(r=>Ci(r)).join("")}function Ci(e){let t={created:"\u2728",updated:"",deleted:"\u{1F5D1}\uFE0F"},a={created:"var(--accent-green)",updated:"var(--text-secondary)",deleted:"var(--accent-red)"},n=new Date(e.timestamp).toLocaleString(Ct(),{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}),o=Object.entries(e.changes),s=o.length,r={title:p("history.field.title"),name:p("history.field.name"),description:p("history.field.description"),status:p("history.field.status"),priority:p("history.field.priority"),category:p("history.field.category"),startDate:p("history.field.startDate"),endDate:p("history.field.endDate"),link:p("history.field.link"),task:p("history.field.task"),projectId:p("history.field.projectId"),tags:p("history.field.tags"),attachments:p("history.field.attachments")};return`
        <div class="history-entry-inline">
            <div class="history-entry-header-inline">
                ${t[e.action]?`<span class="history-action-icon" style="color: ${a[e.action]};">${t[e.action]}</span>`:""}
                ${e.action==="created"||e.action==="deleted"?`<span class="history-action-label-inline" style="color: ${a[e.action]};">${e.action.charAt(0).toUpperCase()+e.action.slice(1)}</span>`:""}
                <span class="history-time-inline">${n}</span>
            </div>

            ${s>0?`
                <div class="history-changes-compact">
                    ${o.map(([i,{before:c,after:l}])=>{let u=r[i]||i;if(i==="link"||i==="task"){let m=l&&typeof l=="object"?l.action:"",g=(l&&typeof l=="object"?l.entity:null)||"task",y=l&&typeof l=="object"?l.title||l.id||p("tasks.table.task"):String(l),v=m==="removed"?"\u274C":"\u2795",w=p(m==="removed"?"history.link.removed":"history.link.added"),C=g==="task"?p("history.entity.task"):g,T=`${v} ${w} ${C} "${y}"`;return`
                                <div class="history-change-compact history-change-compact--single">
                                    <span class="change-field-label">${u}:</span>
                                    <span class="change-after-compact">${U(T)}</span>
                                </div>
                            `}if(i==="description"){let m=c?c.replace(/<[^>]*>/g,"").trim():"",g=l?l.replace(/<[^>]*>/g,"").trim():"";return`
                                <div class="history-change-description">
                                    <div class="change-field-label">${u}:</div>
                                    <div class="description-diff">
                                        ${m?`<div class="description-before"><s>${U(m)}</s></div>`:`<div class="description-before"><em style="opacity: 0.6;">${p("history.value.empty")}</em></div>`}
                                        ${g?`<div class="description-after">${U(g)}</div>`:`<div class="description-after"><em style="opacity: 0.6;">${p("history.value.empty")}</em></div>`}
                                    </div>
                                </div>
                            `}let d=Br(i,c,!0),f=Br(i,l,!1);return`
                            <div class="history-change-compact">
                                <span class="change-field-label">${u}:</span>
                                ${d!==null?`<span class="change-before-compact">${d}</span>`:'<span class="change-null">\u2014</span>'}
                                <span class="change-arrow-compact">${p("history.change.arrow")}</span>
                                ${f!==null?`<span class="change-after-compact">${f}</span>`:'<span class="change-null">\u2014</span>'}
                            </div>
                        `}).join("")}
                </div>
            `:""}
        </div>
    `}function Br(e,t,a=!1){if(t==null)return null;if(t==="")return`<em style="opacity: 0.7;">${p("history.value.empty")}</em>`;if(e==="startDate"||e==="endDate"){let o=pe(t);return a?`<span style="opacity: 0.7;">${o}</span>`:o}if(e==="link"||e==="task"){let o=t&&typeof t=="object"?t.action:"",s=(t&&typeof t=="object"?t.entity:null)||"task",r=t&&typeof t=="object"?t.title||t.id||p("tasks.table.task"):String(t),i=o==="removed"?"\u274C":"\u2795",c=p(o==="removed"?"history.link.removed":"history.link.added"),l=s==="task"?p("history.entity.task"):s,u=`${i} ${c} ${l} "${r}"`;return a?`<span style="opacity: 0.7;">${U(u)}</span>`:U(u)}if(e==="status"){let o=He(t).toUpperCase();return`<span style="background: ${{backlog:"#4B5563",todo:"#186f95",progress:"var(--accent-blue)",review:"var(--accent-amber)",done:"var(--accent-green)"}[t]||"#4B5563"}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11.5px; font-weight: 600; text-transform: uppercase;">${U(o)}</span>`}if(e==="priority"){let o=et(t);return`<span style="color: ${eo[t]||"var(--text-secondary)"}; font-weight: 600; font-size: 12px;">\u25CF</span> <span style="font-weight: 500;">${U(o)}</span>`}if(e==="projectId"){if(!t)return`<em style="opacity: 0.7;">${p("tasks.noProject")}</em>`;let o=N.find(r=>r.id===t),s=o?U(o.name):`#${t}`;return a?`<span style="opacity: 0.7;">${s}</span>`:s}if(e==="tags")return!Array.isArray(t)||t.length===0?`<em style="opacity: 0.7;">${p("history.value.none")}</em>`:t.slice(0,2).map(o=>`<span style="background-color: ${Xt(o)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${U(o.toUpperCase())}</span>`).join(" ")+(t.length>2?" ...":"");if(e==="attachments"){if(!Array.isArray(t)||t.length===0)return`<em style="opacity: 0.7;">${p("history.value.none")}</em>`;let o=t.length===1?p("history.attachments.countSingle",{count:t.length}):p("history.attachments.countPlural",{count:t.length});return a?`<span style="opacity: 0.7;">${o}</span>`:o}if(e==="description"){let o=t.replace(/<[^>]*>/g,"").trim(),s=o.length>50?U(o.substring(0,50))+"...":U(o)||`<em>${p("history.value.empty")}</em>`;return a?`<span style="opacity: 0.7;">${s}</span>`:s}let n=U(String(t));return a?`<span style="opacity: 0.7;">${n}</span>`:n}function pu(e){let t=document.getElementById(`history-details-inline-${e}`),n=document.querySelector(`[data-action="toggleHistoryEntryInline"][data-param="${e}"]`)?.querySelector(".expand-icon-inline");if(t){let o=t.style.display!=="none";t.style.display=o?"none":"block",n&&(n.textContent=o?"\u25BC":"\u25B2")}}var Pa=null;function mu(e){Pa=e,document.getElementById("feedback-delete-modal").classList.add("active")}function Li(){document.getElementById("feedback-delete-modal").classList.remove("active"),Pa=null}async function fu(){if(Pa!==null){let e=Pa;re=re.filter(t=>t.id!==Pa),We=We.filter(t=>t!==e),wn++,Li(),Oe(),jt(),qo({action:"delete",targetId:e}),_a()}}document.addEventListener("click",function(e){let t=e.target.closest(".feedback-checkbox");if(t){let a=parseInt(t.dataset.feedbackId,10);a&&lu(a)}});function gu(e,t){document.getElementById("project-title-display").style.display="none",document.getElementById("project-title-edit").style.display="flex",document.getElementById("project-title-input").focus(),document.getElementById("project-title-input").select()}function hu(e){let t=document.getElementById("project-title-input").value.trim();t?Zt(e,"name",t):Pi()}function Pi(){document.getElementById("project-title-display").style.display="inline",document.getElementById("project-title-edit").style.display="none"}function yu(){document.getElementById("kanban-tip").style.display="none",localStorage.setItem("kanban-tip-dismissed","true")}function vu(e){e.stopPropagation();let t=document.getElementById("project-options-menu");t&&(t.style.display=t.style.display==="block"?"none":"block")}document.addEventListener("click",function(e){let t=document.getElementById("project-options-menu");t&&!e.target.closest("#project-options-btn")&&!e.target.closest("#project-options-menu")&&(t.style.display="none")});document.addEventListener("DOMContentLoaded",function(){if(localStorage.getItem("kanban-tip-dismissed")==="true"){let e=document.getElementById("kanban-tip");e&&(e.style.display="none")}});async function $o(){let e=document.getElementById("attachment-url"),t=document.getElementById("attachment-name"),a=e.value.trim();if(!a){e.style.border="2px solid var(--accent-red, #ef4444)",e.placeholder="URL is required",e.focus(),setTimeout(()=>{e.style.border="",e.placeholder="Paste link (Drive, Dropbox, etc.)"},2e3);return}e.style.border="";let n=document.getElementById("task-form").dataset.editingTaskId,o=t.value.trim()||"Attachment",s="\u{1F4C1}";if(!t.value.trim())try{let i=new URL(a),c=i.pathname.toLowerCase();if(i.hostname.includes("docs.google.com"))c.includes("/document/")?(o=p("tasks.attachments.googleDoc"),s="\u{1F4C4}"):c.includes("/spreadsheets/")?(o=p("tasks.attachments.googleSheet"),s="\u{1F4CA}"):c.includes("/presentation/")?(o=p("tasks.attachments.googleSlides"),s="\u{1F4D1}"):(o=p("tasks.attachments.googleDriveFile"),s="\u{1F5C2}\uFE0F");else if(i.hostname.includes("drive.google.com"))o=p("tasks.attachments.googleDriveFile"),s="\u{1F5C2}\uFE0F";else if(c.endsWith(".pdf"))o=c.split("/").pop()||p("tasks.attachments.pdf"),s="\u{1F4D5}";else if(c.endsWith(".doc")||c.endsWith(".docx"))o=c.split("/").pop()||p("tasks.attachments.word"),s="\u{1F4DD}";else if(c.endsWith(".xls")||c.endsWith(".xlsx"))o=c.split("/").pop()||p("tasks.attachments.excel"),s="\u{1F4CA}";else if(c.endsWith(".ppt")||c.endsWith(".pptx"))o=c.split("/").pop()||p("tasks.attachments.powerpoint"),s="\u{1F4D1}";else{let l=c.split("/").pop();o=l&&l.length>0?l:i.hostname,s="\u{1F4C1}"}}catch{o=a.substring(0,30),s="\u{1F4C1}"}s="\u{1F310}";let r={name:o,icon:s,type:"link",url:a,addedAt:new Date().toISOString()};if(n){let i=L.find(c=>c.id===parseInt(n));if(!i)return;i.attachments||(i.attachments=[]),i.attachments.push(r),Ut(i.attachments),pa(),qe().catch(c=>{console.error("Failed to save attachment:",c),W(p("error.attachmentSaveFailed"))})}else je.push(r),Ut(je);e.value="",t.value=""}async function Ut(e){let t=document.getElementById("attachments-files-list"),a=document.getElementById("attachments-links-list");if(t&&a){await bu(e,t,a);return}let n=document.getElementById("attachments-list");if(!n)return;if(!e||e.length===0){n.innerHTML=`<div style="color: var(--text-muted); font-size: 13px; padding: 8px 0;">${p("tasks.attachments.none")}</div>`;return}let o=s=>{if(!s)return"";try{let r=/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(s);return(new URL(r?s:`https://${s}`).host||s).replace(/^www\./,"")}catch{return s}};n.innerHTML=e.map((s,r)=>{let i=s.size?Math.round(s.size/1024):0,c=i>1024?`${(i/1024).toFixed(1)} MB`:`${i} KB`;if(s.type==="file"&&s.fileKey){let l=s.fileType==="image",u=`<div id="thumbnail-${s.fileKey}" class="attachment-thumb" aria-hidden="true">${s.icon}</div>`,d=l?"viewFile":"downloadFileAttachment",f=l?`data-param="${s.fileKey}" data-param2="${U(s.name)}" data-param3="${s.fileType}"`:`data-param="${s.fileKey}" data-param2="${U(s.name)}" data-param3="${s.mimeType}"`;return`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="${d}" ${f}>
                        ${u}
                        <span class="attachment-name">${U(s.name)} <span class="attachment-meta">&middot; ${c}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${r}" aria-label="${p("tasks.attachments.remove")}" title="${p("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `}else return s.type==="image"&&s.data?`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="viewImageLegacy" data-param="${s.data}" data-param2="${U(s.name)}">
                        <span class="attachment-thumb" aria-hidden="true"><img src="${s.data}" alt=""></span>
                        <span class="attachment-name">${U(s.name)} <span class="attachment-meta">&middot; ${c}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${r}" aria-label="${p("tasks.attachments.remove")}" title="${p("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `:`
                <div class="attachment-item" style="display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px; border: 1px solid var(--border);">
                    <div style="width: 40px; height: 40px; background: transparent; border-radius: 0; display: flex; align-items: center; justify-content: center; font-size: 25px; line-height: 1;">\u{1F310}</div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-size: 14px; font-weight: 500; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${U(s.name)}</div>
                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: none;">${U(s.url)}</div>
                    </div>
                    <div style="display: flex; gap: 6px; align-items: center;">
                        <button type="button" data-action="openUrlAttachment" data-param="${encodeURIComponent(s.url)}" style="padding: 0 12px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; height: 32px; line-height: 1; box-sizing: border-box; display: inline-flex; align-items: center; justify-content: center; appearance: none; -webkit-appearance: none;">${p("tasks.attachments.open")}</button>
                        <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${r}" aria-label="${p("tasks.attachments.removeLink")}" title="${p("tasks.attachments.removeTitle")}">&times;</button>
                    </div>
                </div>
            `}).join("");for(let s of e)if(s.type==="file"&&s.fileKey&&s.fileType==="image")try{let r=await Sa(s.fileKey),i=document.getElementById(`thumbnail-${s.fileKey}`);i&&r&&(i.innerHTML=`<img src="${r}" alt="${U(s.name)}">`)}catch(r){console.error("Failed to load thumbnail:",r)}}async function bu(e,t,a){if(!t||!a)return;let n=(e||[]).map((u,d)=>({att:u,index:d})),o=n.filter(({att:u})=>u?!!(u.type==="file"||u.fileKey||u.type==="image"&&u.data):!1),s=n.filter(({att:u})=>u?!!(u.type==="link"||u.url&&u.type!=="file"):!1),r=u=>{if(!u)return"";try{let d=/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(u);return(new URL(d?u:`https://${u}`).host||u).replace(/^www\./,"")}catch{return u}},i=o.map(({att:u,index:d})=>{let f=u.size?Math.round(u.size/1024):0,m=f>1024?`${(f/1024).toFixed(1)} MB`:`${f} KB`;if(u.type==="file"&&u.fileKey){let g=u.fileType==="image",y=`<div id="thumbnail-${u.fileKey}" class="attachment-thumb" aria-hidden="true">${u.icon}</div>`,v=g?"viewFile":"downloadFileAttachment",w=g?`data-param="${u.fileKey}" data-param2="${U(u.name)}" data-param3="${u.fileType}"`:`data-param="${u.fileKey}" data-param2="${U(u.name)}" data-param3="${u.mimeType}"`;return`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="${v}" ${w}>
                        ${y}
                        <span class="attachment-name">${U(u.name)} <span class="attachment-meta">&middot; ${m}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${d}" aria-label="${p("tasks.attachments.remove")}" title="${p("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `}return u.type==="image"&&u.data?`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="viewImageLegacy" data-param="${u.data}" data-param2="${U(u.name)}">
                        <span class="attachment-thumb" aria-hidden="true"><img src="${u.data}" alt=""></span>
                        <span class="attachment-name">${U(u.name)} <span class="attachment-meta">&middot; ${m}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${d}" aria-label="${p("tasks.attachments.remove")}" title="${p("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `:""}).filter(Boolean).join(""),c=s.map(({att:u,index:d})=>`
        <div class="attachment-item" style="display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px; border: 1px solid var(--border);">
            <div style="width: 40px; height: 40px; background: transparent; border-radius: 0; display: flex; align-items: center; justify-content: center; font-size: 25px; line-height: 1;">\u{1F310}</div>
            <div style="flex: 1; min-width: 0;">
                <div style="font-size: 14px; font-weight: 500; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${U(u.name)}</div>
                <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: none;">${U(u.url)}</div>
            </div>
            <div style="display: flex; gap: 6px; align-items: center;">
                <button type="button" data-action="openUrlAttachment" data-param="${encodeURIComponent(u.url)}" style="padding: 0 12px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; height: 32px; line-height: 1; box-sizing: border-box; display: inline-flex; align-items: center; justify-content: center; appearance: none; -webkit-appearance: none;">${p("tasks.attachments.open")}</button>
                <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${d}" aria-label="${p("tasks.attachments.removeLink")}" title="${p("tasks.attachments.removeTitle")}">&times;</button>
            </div>
        </div>
    `).join("");!!i||!!c?(t.innerHTML=i||"",a.innerHTML=c||""):(t.innerHTML=`<div style="color: var(--text-muted); font-size: 13px; padding: 8px 0;">${p("tasks.attachments.none")}</div>`,a.innerHTML="");for(let u of e||[])if(u&&u.type==="file"&&u.fileKey&&u.fileType==="image")try{let d=await Sa(u.fileKey),f=document.getElementById(`thumbnail-${u.fileKey}`);f&&d&&(f.innerHTML=`<img src="${d}" alt="${U(u.name)}">`)}catch(d){console.error("Failed to load thumbnail:",d)}}async function Ai(e,t,a){if(a==="image")try{let n=await Sa(e);Ra(n,t)}catch(n){W(p("error.attachmentLoadFailed",{message:n.message}))}}function Ra(e,t){let a=document.createElement("div");a.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        cursor: pointer;
    `,a.innerHTML=`
        <div style="max-width: 90%; max-height: 90%; display: flex; flex-direction: column; align-items: center;">
            <div style="color: white; padding: 16px; font-size: 18px; background: rgba(0,0,0,0.5); border-radius: 8px 8px 0 0; width: 100%; text-align: center;">
                ${U(t)}
            </div>
            <img src="${e}" alt="${U(t)}" style="max-width: 100%; max-height: calc(90vh - 60px); object-fit: contain; border-radius: 0 0 8px 8px;">
        </div>
    `,a.onclick=()=>a.remove(),document.body.appendChild(a)}async function Bi(e,t,a){try{let n=await Sa(e),s=await(await fetch(n)).blob(),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),Ke(p("success.fileDownloaded"))}catch(n){W(p("error.fileDownloadFailed",{message:n.message}))}}async function $i(e){let t=document.getElementById("task-form").dataset.editingTaskId;if(t){let a=L.find(o=>o.id===parseInt(t));if(!a||!a.attachments)return;let n=a.attachments[e];if(n.type==="file"&&n.fileKey)try{await oo(n.fileKey),Ke(p("success.attachmentDeletedFromStorage",{name:n.name}))}catch(o){console.error("Failed to delete file from storage:",o),W(p("error.fileDeleteFailed"));return}else Ke(p("success.attachmentRemoved"));a.attachments.splice(e,1),Ut(a.attachments),pa(),qe().catch(o=>{console.error("Failed to save attachment removal:",o),W(p("error.saveChangesFailed"))})}else{let a=je[e];if(a.type==="file"&&a.fileKey)try{await oo(a.fileKey),Ke(p("success.attachmentDeletedFromStorage",{name:a.name}))}catch(n){console.error("Failed to delete file from storage:",n),W(p("error.fileDeleteFailed"));return}else Ke(p("success.attachmentRemoved"));je.splice(e,1),Ut(je)}}function ku(){let e=document.getElementById("attachment-file-dropzone"),t=document.getElementById("attachment-file");if(!e||!t)return;let a=window.innerWidth<=768,n=p(a?"tasks.modal.attachmentsDropzoneTap":"tasks.modal.attachmentsDropzoneDefault");e.dataset.defaultText=n;function o(l){e.innerHTML="";let u=document.createElement("span");u.className="task-attachment-dropzone-text",u.textContent=l,e.appendChild(u)}function s(l){l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.gap="10px",l.style.padding="12px 16px",l.style.textAlign="center",l.style.cursor="pointer",l.style.userSelect="none",l.style.minHeight="48px",l.style.border="2px dashed var(--border)",l.style.borderRadius="10px",l.style.background="var(--bg-tertiary)",l.style.boxShadow="none",l.style.color="var(--text-muted)",l.style.fontWeight="500",l.style.transition="border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease"}function r(l,u){u?(l.style.borderColor="var(--accent-blue)",l.style.background="rgba(59, 130, 246, 0.08)",l.style.boxShadow="0 0 0 1px var(--accent-blue)"):(l.style.border="2px dashed var(--border)",l.style.background="var(--bg-tertiary)",l.style.boxShadow="none")}s(e),o(n);async function i(l,u){if(!l||l.length===0)return;let d=l[0];u&&(u.preventDefault(),u.stopPropagation()),await Ln(d,e)}let c=0;e.addEventListener("dragenter",function(l){l.preventDefault(),c+=1,e.classList.add("task-attachment-dragover"),r(e,!0)}),e.addEventListener("dragover",function(l){l.preventDefault(),e.classList.add("task-attachment-dragover"),r(e,!0)}),e.addEventListener("dragleave",function(l){l.preventDefault(),c=Math.max(0,c-1),c===0&&(e.classList.remove("task-attachment-dragover"),r(e,!1))}),e.addEventListener("drop",function(l){c=0,e.classList.remove("task-attachment-dragover"),r(e,!1),i(l.dataTransfer&&l.dataTransfer.files,l)}),e.addEventListener("dragend",function(){c=0,e.classList.remove("task-attachment-dragover"),r(e,!1)}),e.addEventListener("paste",function(l){if(!l.clipboardData)return;let u=l.clipboardData.files;u&&u.length>0&&i(u,l)}),e.addEventListener("click",function(){t.click()}),e.addEventListener("keydown",function(l){(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),t.click())}),t.addEventListener("change",function(l){let u=l.target.files;u&&u.length>0&&i(u,l),t.value=""})}document.addEventListener("DOMContentLoaded",ku);async function Ln(e,t){if(!e)return;let a=wu(e.type||"",e.name||""),n=Su(a);if(e.size>n){let i=Math.round(n/1048576);W(p("error.fileSizeTooLarge",{maxMB:i}));return}let o=t&&t.tagName==="BUTTON",s=o?t.textContent||"\u{1F4C1} Upload File":null,r=o?null:t?.dataset?.defaultText||p("tasks.modal.attachmentsDropzoneDefault");try{if(t)if(o)t.textContent="\u23F3 Uploading...",t.disabled=!0;else{t.innerHTML="";let d=document.createElement("span");d.className="task-attachment-dropzone-text",d.textContent=`Uploading ${e.name}...`,t.appendChild(d),t.classList.add("task-attachment-uploading"),t.setAttribute("aria-busy","true")}let i=await qs(e),c=`file_${Date.now()}_${Math.random().toString(36).substring(7)}`;await zs(c,i);let l={name:e.name,icon:Eu(a),type:"file",fileType:a,fileKey:c,mimeType:e.type,size:e.size,addedAt:new Date().toISOString()},u=document.getElementById("task-form").dataset.editingTaskId;if(u){let d=L.find(f=>f.id===parseInt(u));if(!d)return;d.attachments||(d.attachments=[]),d.attachments.push(l),Ut(d.attachments),qe().catch(f=>{console.error("Failed to save attachment:",f),W(p("error.attachmentSaveFailed"))})}else je.push(l),Ut(je);Ke(p("success.fileUploaded"))}catch(i){W(p("error.fileUploadFailed",{message:i.message}))}finally{if(t)if(o)t.textContent=s,t.disabled=!1;else{t.innerHTML="";let i=document.createElement("span");i.className="task-attachment-dropzone-text",i.textContent=r,t.appendChild(i),t.classList.remove("task-attachment-uploading"),t.removeAttribute("aria-busy")}}}async function Ni(e){let t=document.getElementById("attachment-file"),a=t&&t.files?t.files[0]:null;if(!a){W(p("error.selectFile"));return}let n=document.getElementById("attachment-file-dropzone")||e?.target||null;await Ln(a,n),t&&(t.value="")}function wu(e,t){return e.startsWith("image/")?"image":e==="application/pdf"||t.toLowerCase().endsWith(".pdf")?"pdf":e.includes("spreadsheet")||t.match(/\.(xlsx?|csv)$/i)?"spreadsheet":e.includes("document")||e.includes("word")||t.match(/\.docx?$/i)?"document":e.includes("presentation")||e.includes("powerpoint")||t.match(/\.pptx?$/i)?"presentation":"file"}function Su(e){switch(e){case"pdf":return 20*1024*1024;case"image":case"spreadsheet":case"document":case"presentation":return 10*1024*1024;default:return 10*1024*1024}}function Eu(e){switch(e){case"image":return"\u{1F5BC}\uFE0F";case"pdf":return"\u{1F4C4}";case"spreadsheet":return"\u{1F4CA}";case"document":return"\u{1F4DD}";case"presentation":return"\u{1F4CA}";default:return"\u{1F5C2}\uFE0F"}}window.addFileAttachment=Ni;window.viewFile=Ai;window.viewImageLegacy=Ra;window.downloadFileAttachment=Bi;window.removeAttachment=$i;window.kanbanShowBacklog=localStorage.getItem("kanbanShowBacklog")==="true";window.kanbanShowProjects=localStorage.getItem("kanbanShowProjects")!=="false";window.kanbanShowNoDate=localStorage.getItem("kanbanShowNoDate")!=="false";window.kanbanUpdatedFilter=localStorage.getItem("kanbanUpdatedFilter")||"all";window.enableReviewStatus=localStorage.getItem("enableReviewStatus")==="true";function Mi(e){switch(e){case"5m":return"5m";case"30m":return"30m";case"24h":return"24h";case"week":return p("filters.updated.week");case"month":return p("filters.updated.month");default:return""}}function es(){let e=document.querySelector(".kanban-board");if(!e)return;let t=3;window.kanbanShowBacklog===!0&&t++,window.enableReviewStatus!==!1&&t++,e.style.gridTemplateColumns=`repeat(${t}, 1fr)`}function ts(){let e=window.enableReviewStatus!==!1,t=document.getElementById("kanban-column-review");t&&(t.style.display=e?"":"none");let a=document.getElementById("filter-status-review");a&&(a.style.display=e?"":"none"),es(),!e&&h.statuses.has("review")&&(h.statuses.delete("review"),applyFilters())}function Du(){let e=window.kanbanShowBacklog===!0,t=document.getElementById("kanban-column-backlog");t&&(t.style.display=e?"":"none"),es()}function Wt(e){let t=e?parseInt(e,10):null;if(!t)return null;let a=N.find(n=>n.id===t);return a?(a.updatedAt=new Date().toISOString(),a):null}function Gt(e,t,a){if(!window.historyService)return;let n=e?parseInt(e,10):null;if(!n)return;let o=N.find(s=>s.id===n);o&&(t==="added"&&window.historyService.recordProjectTaskAdded?window.historyService.recordProjectTaskAdded(o,a):t==="removed"&&window.historyService.recordProjectTaskRemoved&&window.historyService.recordProjectTaskRemoved(o,a))}function Tu(){let e=document.getElementById("btn-filter-kanban-updated");if(!e)return;let t=e.querySelector("#badge-kanban-updated");if(!t)return;for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(`${p("tasks.filters.updated")} `)),e.appendChild(t),e.appendChild(document.createTextNode(" "));let a=document.createElement("span");a.className="filter-arrow",a.textContent="\u25BC",e.appendChild(a)}function Hn(){try{Tu()}catch{}let e=document.getElementById("badge-kanban-updated");if(e){e.textContent=Mi(window.kanbanUpdatedFilter);let t=e.closest(".filter-button");t&&(window.kanbanUpdatedFilter!=="all"?t.classList.add("active"):t.classList.remove("active"))}try{document.querySelectorAll('input[type="radio"][data-filter="kanban-updated"][name="kanban-updated-filter"]').forEach(t=>{t.checked=t.value===window.kanbanUpdatedFilter})}catch{}}function Oa(e,t={render:!0}){let n=new Set(["all","5m","30m","24h","week","month"]).has(e)?e:e==="today"?"24h":"all";window.kanbanUpdatedFilter=n;try{localStorage.setItem("kanbanUpdatedFilter",n)}catch{}Hn();try{Wa()}catch{}try{La()}catch{}if(t&&t.render===!1)return;let o=!document.querySelector(".kanban-board")?.classList.contains("hidden"),s=document.getElementById("list-view")?.classList.contains("active"),r=document.getElementById("calendar-view")?.classList.contains("active");o&&Me(),(s||window.innerWidth<=768)&&rt(),r&&ie()}function Fi(e){e.stopPropagation();let t=document.getElementById("kanban-settings-panel");t.classList.contains("active")?t.classList.remove("active"):(t.classList.add("active"),document.getElementById("kanban-show-backlog").checked=window.kanbanShowBacklog===!0,document.getElementById("kanban-show-projects").checked=window.kanbanShowProjects!==!1,document.getElementById("kanban-show-no-date").checked=window.kanbanShowNoDate!==!1)}function xu(){let e=document.getElementById("kanban-show-backlog");window.kanbanShowBacklog=e.checked,localStorage.setItem("kanbanShowBacklog",e.checked);let t=document.getElementById("kanban-column-backlog");t&&(t.style.display=e.checked?"":"none"),es(),Me()}function Iu(){let e=document.getElementById("kanban-show-projects");window.kanbanShowProjects=e.checked,localStorage.setItem("kanbanShowProjects",e.checked),Me()}function ju(){let e=document.getElementById("kanban-show-no-date");window.kanbanShowNoDate=e.checked,localStorage.setItem("kanbanShowNoDate",e.checked),Me()}window.toggleKanbanSettings=Fi;window.toggleKanbanBacklog=xu;window.toggleKanbanProjects=Iu;window.toggleKanbanNoDate=ju;document.addEventListener("click",e=>{let t=document.getElementById("kanban-settings-panel"),a=document.getElementById("kanban-settings-btn");t&&!t.contains(e.target)&&e.target!==a&&!a.contains(e.target)&&t.classList.remove("active")});async function lt(e,t){let n=document.getElementById("task-form")?.dataset.editingTaskId;if(!n)return;let o=L.find(f=>f.id===parseInt(n,10)),s=o?JSON.parse(JSON.stringify(o)):null,r=e==="description"?yi(t):t;if(o){let f=o[e],m=!1;if(e==="projectId"){let g=r===""||r===null||typeof r>"u"?null:parseInt(r,10),y=typeof o.projectId=="number"?o.projectId:null;m=(Number.isNaN(g)?null:g)===y}else m=(typeof f=="string"?f:f||"")===(typeof r=="string"?r:r||"");if(m)return}let i=Ps(parseInt(n,10),e,r,L,M);if(!i.task)return;window.historyService&&s&&window.historyService.recordTaskUpdated(s,i.task);let c=i.oldProjectId;L=i.tasks;let l=i.task;if(e==="projectId"){Va();let f=l.projectId;c!==f&&(c&&(Wt(c),Gt(c,"removed",l)),f&&(Wt(f),Gt(f,"added",l)),Qe().catch(()=>{}))}e==="endDate"&&Qt(),qe().catch(f=>{console.error("Failed to save task field update:",f),W(p("error.saveChangesFailed"))});let u=document.getElementById("project-details").classList.contains("active"),d=e==="startDate"||e==="endDate"||e==="projectId"||e==="status"||e==="priority"||e==="title"||e==="tags";if(d&&Fa(),!!d){if(u)if(e==="projectId"){let f=l.projectId;if(f)if(c!==f){Ae(f);return}else{Ae(f);return}else if(c){Ae(c);return}}else{let f=c||(window.location.hash&&window.location.hash.startsWith("#project-")?parseInt(window.location.hash.replace("#project-",""),10):null);if(f){Ae(f);return}}else Me(),(window.innerWidth<=768||document.getElementById("list-view").classList.contains("active"))&&rt(),document.getElementById("projects").classList.contains("active")&&(te.projectsSortedView=null,_e(),Oe());e==="status"&&(M.autoSetStartDateOnStatusChange||M.autoSetEndDateOnStatusChange)&&setTimeout(()=>{let f=document.getElementById("task-form");if(!f)return;let m=f.querySelector('input[name="startDate"]'),g=f.querySelector('input[name="endDate"]');if(m&&l.startDate){let y=m._flatpickrInstance;y&&y.setDate(new Date(l.startDate),!1),m.value=l.startDate;let v=m.parentElement?.querySelector("input.date-display");v&&(v.value=an(l.startDate))}if(g&&l.endDate){let y=g._flatpickrInstance;y&&y.setDate(new Date(l.endDate),!1),g.value=l.endDate;let v=g.parentElement?.querySelector("input.date-display");v&&(v.value=an(l.endDate))}},50)}}var Je=null;function Ri(){let e=document.getElementById("task-form");e&&(Je={title:e.querySelector('input[name="title"]')?.value.trim()||"",description:document.getElementById("task-description-hidden")?.value.trim()||"",projectId:e.querySelector('input[name="projectId"]')?.value||e.querySelector('select[name="projectId"]')?.value||"",startDate:e.querySelector('input[name="startDate"]')?.value||"",endDate:e.querySelector('input[name="endDate"]')?.value||"",priority:e.querySelector("#hidden-priority")?.value||"medium",status:e.querySelector("#hidden-status")?.value||"backlog",tags:window.tempTags?[...window.tempTags]:[],attachments:je?je.length:0})}function Pn(){let e=document.getElementById("task-form");if(!e||e.dataset.editingTaskId||!Je)return!1;let t={title:e.querySelector('input[name="title"]')?.value.trim()||"",description:document.getElementById("task-description-hidden")?.value.trim()||"",projectId:e.querySelector('input[name="projectId"]')?.value||e.querySelector('select[name="projectId"]')?.value||"",startDate:e.querySelector('input[name="startDate"]')?.value||"",endDate:e.querySelector('input[name="endDate"]')?.value||"",priority:e.querySelector("#hidden-priority")?.value||"medium",status:e.querySelector("#hidden-status")?.value||"backlog",tags:window.tempTags?[...window.tempTags]:[],attachments:je?je.length:0};return t.title!==Je.title||t.description!==Je.description||t.projectId!==Je.projectId||t.startDate!==Je.startDate||t.endDate!==Je.endDate||t.priority!==Je.priority||t.status!==Je.status||t.tags.length!==Je.tags.length||t.attachments!==Je.attachments}function Eo(e){let t=document.getElementById(e);!t||t.__overlayBound||(t.__overlayBound=!0,t.addEventListener("pointerdown",a=>{t.__downOnOverlay=a.target===t}),t.addEventListener("click",a=>{let n=a.target===t,o=!!t.__downOnOverlay;if(t.__downOnOverlay=!1,!(!n||!o)){if(e==="task-modal"){let s=document.getElementById("task-form");if(s&&s.dataset.editingTaskId){let r=s.querySelector("#task-description-editor");r&&lt("description",r.innerHTML)}}if(e==="task-modal"&&Pn()){Na(e);return}Ue(e)}}))}document.addEventListener("DOMContentLoaded",()=>{Eo("task-modal"),Eo("project-modal"),Eo("settings-modal")});document.addEventListener("keydown",async e=>{if(e.key==="Escape"&&document.querySelectorAll(".modal.active").forEach(a=>{if(a.id==="task-modal")if(Pn())Na("task-modal");else{let n=document.getElementById("task-form");if(n&&n.dataset.editingTaskId){let o=n.querySelector("#task-description-editor");o&&lt("description",o.innerHTML)}Ue(a.id)}else a.id==="settings-modal"&&window.settingsFormIsDirty?Na("settings-modal"):Ue(a.id)}),e.key==="n"||e.key==="N"){if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.isContentEditable)return;e.preventDefault();let t=document.getElementById("notification-dropdown"),a=document.getElementById("notification-toggle");if(!t||!a)return;if(t.classList.contains("active"))Ft();else{Ga();let o=await kn({force:!0});Ba(o),t.classList.add("active"),a.classList.add("active"),await Do(o)}}});async function Oi(){let e=document.getElementById("tag-input"),t=e.value.trim().toLowerCase();if(!t){e.style.border="2px solid var(--accent-red, #ef4444)",setTimeout(()=>{e.style.border=""},2e3);return}let a=document.getElementById("task-form").dataset.editingTaskId;if(a){let n=L.find(r=>r.id===parseInt(a));if(!n)return;if(n.tags||(n.tags=[]),n.tags.includes(t)){e.value="";return}let o=JSON.parse(JSON.stringify(n));n.tags=[...n.tags,t],fa(n.tags),pa(),window.historyService&&window.historyService.recordTaskUpdated(o,n),document.getElementById("project-details").classList.contains("active")&&n.projectId?Ae(n.projectId):(Me(),(window.innerWidth<=768||document.getElementById("list-view").classList.contains("active"))&&rt(),document.getElementById("projects").classList.contains("active")&&(te.projectsSortedView=null,_e())),ya(),Qt(),qe().catch(r=>{console.error("Failed to save tag addition:",r),W(p("error.saveTagFailed"))})}else{if(window.tempTags||(window.tempTags=[]),window.tempTags.includes(t)){e.value="";return}window.tempTags=[...window.tempTags,t],fa(window.tempTags)}e.value=""}async function Cu(e){let t=document.getElementById("task-form").dataset.editingTaskId;if(t){let a=L.find(s=>s.id===parseInt(t));if(!a||!a.tags)return;let n=JSON.parse(JSON.stringify(a));a.tags=a.tags.filter(s=>s!==e),fa(a.tags),pa(),window.historyService&&window.historyService.recordTaskUpdated(n,a),qe().catch(s=>{console.error("Failed to save tag removal:",s),W(p("error.removeTagFailed"))}),document.getElementById("project-details").classList.contains("active")&&a.projectId?Ae(a.projectId):(Me(),(window.innerWidth<=768||document.getElementById("list-view").classList.contains("active"))&&rt(),document.getElementById("projects").classList.contains("active")&&(te.projectsSortedView=null,_e())),ya(),Qt()}else window.tempTags||(window.tempTags=[]),window.tempTags=window.tempTags.filter(a=>a!==e),fa(window.tempTags)}function fa(e){let t=document.getElementById("tags-display"),a=window.innerWidth<=768;t.innerHTML=pr(e,{isMobile:a,getTagColor:Xt,escapeHtml:U,noTagsText:p("tasks.tags.none")})}async function Lu(){let e=document.getElementById("project-tag-input"),t=e.value.trim().toLowerCase();if(!t){e.style.border="2px solid var(--accent-red, #ef4444)",setTimeout(()=>{e.style.border=""},2e3);return}let a=document.getElementById("project-form").dataset.editingProjectId;if(a){let n=N.find(o=>o.id===parseInt(a));if(!n)return;if(n.tags||(n.tags=[]),n.tags.includes(t)){e.value="";return}n.tags=[...n.tags,t],qa(n.tags),te.projectsSortedView=null,_e(),Ka(),Qe().catch(o=>{console.error("Failed to save project tag addition:",o),W(p("error.saveTagFailed"))})}else{if(window.tempProjectTags||(window.tempProjectTags=[]),window.tempProjectTags.includes(t)){e.value="";return}window.tempProjectTags=[...window.tempProjectTags,t],qa(window.tempProjectTags)}e.value=""}async function Pu(e){let t=document.getElementById("project-form").dataset.editingProjectId;if(t){let a=N.find(n=>n.id===parseInt(t));if(!a||!a.tags)return;a.tags=a.tags.filter(n=>n!==e),qa(a.tags),te.projectsSortedView=null,_e(),Ka(),Qe().catch(n=>{console.error("Failed to save project tag removal:",n),W(p("error.saveTagFailed"))})}else{if(!window.tempProjectTags)return;window.tempProjectTags=window.tempProjectTags.filter(a=>a!==e),qa(window.tempProjectTags)}}function qa(e){let t=document.getElementById("project-tags-display");if(!e||e.length===0){t.innerHTML=`<span style="color: var(--text-muted); font-size: 13px;">${p("tasks.tags.none")}</span>`;return}let a=document.getElementById("project-form")?.dataset.editingProjectId,n=a?Te(parseInt(a)):"#6b7280",o=window.innerWidth<=768,s=o?"3px 6px":"4px 8px",r=o?"11px":"12px",i="4px",c=o?"12px":"14px",l=o?"1.2":"1.4";t.innerHTML=e.map(u=>`
            <span class="task-tag" style="background-color: ${n}; color: white; padding: ${s}; border-radius: 4px; font-size: ${r}; display: inline-flex; align-items: center; gap: ${i}; line-height: ${l};">
                ${U(u.toUpperCase())}
                <button type="button" data-action="removeProjectTag" data-param="${U(u)}" style="background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${c}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;">\xD7</button>
            </span>
        `).join("")}function Ya(e,t){let a=document.getElementById("project-details-tags-display");if(!a)return;if(!e||e.length===0){a.innerHTML=`<span style="color: var(--text-muted); font-size: 13px;">${p("tasks.tags.none")}</span>`;return}let n=t?Te(t):"#6b7280",o=window.innerWidth<=768,s=o?"3px 6px":"4px 8px",r=o?"11px":"12px",i="4px",c=o?"12px":"14px",l=o?"1.2":"1.4";a.innerHTML=e.map(u=>`
            <span class="task-tag" style="background-color: ${n}; color: white; padding: ${s}; border-radius: 4px; font-size: ${r}; display: inline-flex; align-items: center; gap: ${i}; line-height: ${l};">
                ${U(u.toUpperCase())}
                <button type="button" data-action="removeProjectDetailsTag" data-param="${U(u)}" style="background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${c}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;">\xD7</button>
            </span>
        `).join("")}async function qi(e){let t=document.getElementById("project-details-tag-input");if(!t)return;let a=t.value.trim().toLowerCase();if(!a){t.style.border="2px solid var(--accent-red, #ef4444)",setTimeout(()=>{t.style.border=""},2e3);return}let n=N.find(o=>o.id===parseInt(e));if(n){if(n.tags||(n.tags=[]),n.tags.includes(a)){t.value="";return}n.tags=[...n.tags,a],Ya(n.tags,e),te.projectsSortedView=null,_e(),Ka(),Qe().catch(o=>{console.error("Failed to save project tag addition:",o),W(p("error.saveTagFailed"))}),t.value=""}}async function Au(e){let t=document.getElementById("project-title-display");if(!t)return;let a=parseInt(t.dataset.param),n=N.find(o=>o.id===a);!n||!n.tags||(n.tags=n.tags.filter(o=>o!==e),Ya(n.tags,a),te.projectsSortedView=null,_e(),Ka(),Qe().catch(o=>{console.error("Failed to save project tag removal:",o),W(p("error.saveTagFailed"))}))}function zi(){mr({toggleTheme:iu,showCalendarView:Ma,toggleKanbanSettings:Fi,openProjectModal:bd,openTaskModal:On,closeUserDropdown:Ga,openSettingsModal:su,openTaskModalForProject:ou,openSelectedProjectFromTask:$d,closeModal:Ue,closeTaskModal:wd,closeConfirmModal:Wo,closeFeedbackDeleteModal:Li,closeProjectConfirmModal:Yo,closeUnsavedChangesModal:ki,closeDayItemsModal:zn,closeDayItemsModalOnBackdrop:Gd,openTaskDetails:va,deleteTask:gd,duplicateTask:hd,confirmDelete:pi,showProjectDetails:Ae,toggleProjectExpand:ui,toggleProjectMenu:vu,editProjectTitle:gu,saveProjectTitle:hu,cancelProjectTitle:Pi,handleDeleteProject:Qd,handleDuplicateProject:eu,toggleProjectColorPicker:Fl,updateProjectColor:Rl,openCustomProjectColorPicker:ql,navigateToProjectStatus:Hi,deleteProject:Ei,confirmProjectDelete:Si,closeDuplicateProjectModal:Di,confirmDuplicateProject:tu,addFeedbackItem:Qo,deleteFeedbackItem:mu,confirmFeedbackDelete:fu,toggleHistoryEntryInline:pu,formatTaskText:Rd,insertTaskHeading:Od,insertTaskDivider:qd,sortTable:ld,toggleSortMode:hl,animateCalendarMonthChange:bi,goToToday:Vd,showDayTasks:Wd,addAttachment:$o,addFileAttachment:Ni,addTag:Oi,removeTag:Cu,addProjectTag:Lu,removeProjectTag:Pu,addProjectDetailsTag:qi,removeProjectDetailsTag:Au,removeAttachment:$i,downloadFileAttachment:Bi,viewFile:Ai,viewImageLegacy:Ra,showErrorNotification:W,t:p,backToProjects:au,showAllActivity:Ql,backToDashboard:ed,backToCalendar:nu,openUpdatesFromNotification:Wr,openDueTodayFromNotification:Gr,dismissKanbanTip:yu,confirmDiscardChanges:Kd,closeReviewStatusConfirmModal:wi,confirmDisableReviewStatus:Jd,closeCalendarCreateModal:Ko,confirmCreateTask:Zd,addTaskFromDayItemsModal:Yd,signOut:sd,exportDashboardData:rd,closeExportDataModal:di,confirmExportData:id,generateReport:cd,getCurrentMonth:()=>we,getCurrentYear:()=>Se,showStatusInfoModal:yd})}function Bu(){h.statuses.clear(),h.priorities.clear(),h.projects.clear(),h.tags.clear(),h.search="",h.datePresets.clear(),h.dateFrom="",h.dateTo="";let e=document.getElementById("filter-search");e&&(e.value="");let t=document.getElementById("filter-due-date"),a=document.getElementById("filter-created-date");t&&(t.value=""),a&&(a.value="");let n=document.getElementById("filter-date-global");n&&(n.value=""),document.querySelectorAll('#global-filters input[type="checkbox"]').forEach(s=>{s.checked=!1}),De()}function $u(e,t){Re("tasks"),window.location.hash="tasks",document.querySelectorAll(".nav-item").forEach(i=>i.classList.remove("active"));let a=document.querySelector('.nav-item[data-page="tasks"]');a&&a.classList.add("active"),h.statuses.clear(),h.priorities.clear(),h.projects.clear(),h.tags.clear(),h.dateFrom="",h.dateTo="",h.search="";let n=document.getElementById("filter-search");n&&(n.value=""),h.statuses.add(t),h.projects.add(e.toString()),document.querySelectorAll('input[type="checkbox"]').forEach(i=>i.checked=!1),document.querySelectorAll(`input[data-filter="status"][value="${t}"]`).forEach(i=>i.checked=!0),document.querySelectorAll(`input[data-filter="project"][value="${e}"]`).forEach(i=>i.checked=!0),document.querySelectorAll(".view-btn").forEach(i=>i.classList.remove("active"));let o=document.querySelector(".view-btn:nth-child(2)");o&&o.classList.add("active");let s=document.querySelector(".kanban-board"),r=document.getElementById("list-view");s&&s.classList.add("hidden"),r&&r.classList.add("active"),he(),rt()}window.filterProjectTasks=$u;function Hi(e,t){ni("status",t),setTimeout(()=>{let a=document.querySelector(".view-toggle");a&&a.classList.remove("hidden"),h.projects.add(e.toString());let n=document.querySelector(`input[data-filter="project"][value="${e}"]`);n&&(n.checked=!0),he(),Me()},200)}window.navigateToProjectStatus=Hi;function Nu(e){let t=Ce&&Ce.querySelector(".project-portal-options");if(!t)return;let a=document.getElementById("hidden-project"),n=a&&a.value||"",o=(e||"").toLowerCase(),s="";n&&(s+=`<div class="project-option" data-project-id="">${p("tasks.project.selectPlaceholder")}</div>`),s+=N.slice().sort((r,i)=>(r.name||"").localeCompare(i.name||"",void 0,{sensitivity:"base"})).filter(r=>n===""||String(r.id)!==String(n)).filter(r=>!o||(r.name||"").toLowerCase().includes(o)).map(r=>`<div class="project-option" data-project-id="${r.id}">${r.name}</div>`).join(""),t.innerHTML=s}function Qt(){let e=document.getElementById("filter-date-global");if(!e)return;let t=Array.from(e.options).find(n=>n.value==="no-date");if(!t)return;let a=L.some(n=>!n.endDate);t.style.display=a?"":"none"}function Un(){let e=document.getElementById("badge-project-status");if(!e)return;let t=q.statuses.size;e.textContent=t===0?"":t;let a=e.closest(".filter-button");a&&(t>0?a.classList.add("active"):a.classList.remove("active"))}function as(){let e=document.getElementById("badge-project-tags");if(!e)return;let t=q.tags.size;e.textContent=t===0?"":t;let a=e.closest(".filter-button");a&&(t>0?a.classList.add("active"):a.classList.remove("active"))}function Ka(){let e=document.getElementById("project-tags-options");if(!e)return;let t=new Set(q.tags),a=new Set;if(N.forEach(n=>{n.tags&&n.tags.length>0&&n.tags.forEach(o=>a.add(o))}),e.innerHTML="",a.size===0){let n=document.createElement("li");n.textContent=p("filters.noOtherTags"),n.style.color="var(--text-muted)",n.style.padding="8px 12px",e.appendChild(n)}else Array.from(a).sort().forEach(n=>{let o=document.createElement("li"),s=`project-tag-${n}`,r=t.has(n)?"checked":"";o.innerHTML=`<label><input type="checkbox" id="${s}" value="${n}" data-filter="project-tags" ${r}> ${n.toUpperCase()}</label>`,e.appendChild(o)});e.querySelectorAll('input[type="checkbox"]').forEach(n=>{n.addEventListener("change",()=>{n.checked?q.tags.add(n.value):q.tags.delete(n.value),as(),ot()})})}function Ui(e){switch(e){case"5m":return"5m";case"30m":return"30m";case"24h":return"24h";case"week":return p("filters.updated.week");case"month":return p("filters.updated.month");default:return""}}function _i(e){let t=Date.now();switch(e){case"5m":return t-300*1e3;case"30m":return t-1800*1e3;case"24h":return t-1440*60*1e3;case"week":return t-10080*60*1e3;case"month":return t-720*60*60*1e3;default:return null}}function Vi(e){let t=e&&(e.updatedAt||e.createdAt)||"",a=new Date(t).getTime();return Number.isFinite(a)?a:0}function za(){let e=document.getElementById("badge-project-updated");if(e){e.textContent=Ui(q.updatedFilter);let t=e.closest(".filter-button");t&&(q.updatedFilter!=="all"?t.classList.add("active"):t.classList.remove("active"))}try{document.querySelectorAll('input[type="radio"][data-filter="project-updated"][name="project-updated-filter"]').forEach(t=>{t.checked=t.value===q.updatedFilter})}catch{}}function Wi(){let e=document.getElementById("projects-active-filters");if(!e)return;e.innerHTML="";let t=(a,n,o)=>{let s=document.createElement("span");s.className="filter-chip";let r=document.createElement("span");r.className="chip-text",r.textContent=n!=null&&n!==""?`${a}: ${n}`:a;let i=document.createElement("button");i.type="button",i.className="chip-remove",i.setAttribute("aria-label",p("filters.chip.removeAria",{label:a})),i.textContent="x",i.addEventListener("click",o),s.appendChild(r),s.appendChild(i),e.appendChild(s)};if(q.search&&t(p("filters.chip.search"),q.search,()=>{q.search="";let a=document.getElementById("projects-search");a&&(a.value="");let n=ht()||{};Yt({...n,search:""}),ot()}),q.statuses.forEach(a=>{t(p("projects.filters.status"),Ha(a),()=>{q.statuses.delete(a);let n=document.querySelector(`input[type="checkbox"][data-filter="project-status"][value="${a}"]`);n&&(n.checked=!1),Un(),ot()})}),q.updatedFilter&&q.updatedFilter!=="all"&&t(p("filters.chip.updated"),Ui(q.updatedFilter),()=>{q.updatedFilter="all",za();let a=ht()||{};Yt({...a,updatedFilter:"all"}),ot()}),q.taskFilter==="has-tasks"||q.taskFilter==="no-tasks"){let a=q.taskFilter==="has-tasks"?p("projects.filters.hasTasks"):p("projects.filters.noTasks");t(a,"",()=>{q.taskFilter="",document.querySelectorAll("#projects .projects-filters .pf-chip").forEach(o=>o.classList.remove("active"));let n=ht()||{};Yt({...n,filter:""}),ot()})}q.tags.forEach(a=>{t(p("projects.filters.tags"),a.toUpperCase(),()=>{q.tags.delete(a);let n=document.querySelector(`input[type="checkbox"][data-filter="project-tags"][value="${a}"]`);n&&(n.checked=!1),as(),ot()})})}function ot(){let e=ke("filters","projects",{totalProjects:N.length,statusCount:q.statuses.size,tagCount:q.tags.size,taskFilter:q.taskFilter||"",updatedFilter:q.updatedFilter||"all",hasSearch:!!q.search}),t=N.slice();if(q.statuses.size>0&&(t=t.filter(n=>{let o=vt(n.id);return q.statuses.has(o)})),q.taskFilter==="has-tasks"?t=t.filter(n=>L.some(o=>o.projectId===n.id)):q.taskFilter==="no-tasks"&&(t=t.filter(n=>!L.some(o=>o.projectId===n.id))),q.tags.size>0&&(t=t.filter(n=>!n.tags||n.tags.length===0?!1:Array.from(q.tags).some(o=>n.tags.includes(o)))),q.updatedFilter&&q.updatedFilter!=="all"){let n=_i(q.updatedFilter);n!=null&&(t=t.filter(o=>Vi(o)>=n))}if(q.search){let n=q.search.toLowerCase();t=t.filter(o=>((o.name||"")+" "+(o.description||"")).toLowerCase().includes(n))}let a=ht()||{search:"",filter:"",sort:"default",sortDirection:"asc",updatedFilter:"all"};a.sort&&a.sort!=="default"?No(a.sort,t):No("default",t),An();try{Wi()}catch{}ye("filters",e,{totalProjects:N.length,filteredCount:t.length})}function No(e,t){let a=t&&Array.isArray(t)?t.slice():N.slice(),o=Ne.direction==="desc",s=e==="name-asc"||e==="name-desc"?"name":e;if(!s||s==="default"){let c={active:0,planning:1,backlog:2,completed:3};a.sort((l,u)=>{let d=vt(l.id),f=vt(u.id),m=(c[d]||999)-(c[f]||999);return o?-m:m}),te.projectsSortedView=a,Mu(a);return}s==="name"?a.sort((c,l)=>{let u=(c.name||"").localeCompare(l.name||"");return o?-u:u}):s==="created-desc"?a.sort((c,l)=>{let u=new Date(l.createdAt)-new Date(c.createdAt);return o?-u:u}):s==="updated-desc"?a.sort((c,l)=>{let u=new Date(c.updatedAt||c.createdAt),f=new Date(l.updatedAt||l.createdAt)-u;return o?-f:f}):s==="tasks-desc"?a.sort((c,l)=>{let u=L.filter(d=>d.projectId===l.id).length-L.filter(d=>d.projectId===c.id).length;return o?-u:u}):s==="completion-desc"&&a.sort((c,l)=>{let u=L.filter(w=>w.projectId===c.id).length,d=L.filter(w=>w.projectId===c.id&&w.status==="done").length,f=u>0?d/u*100:0,m=L.filter(w=>w.projectId===l.id).length,g=L.filter(w=>w.projectId===l.id&&w.status==="done").length,v=(m>0?g/m*100:0)-f;return o?-v:v}),te.projectsSortedView=a;let r=document.getElementById("projects-list");if(!r)return;let i=new Set;r.querySelectorAll(".project-list-item.expanded").forEach(c=>{let l=c.id.replace("project-item-","");i.add(l)}),r.innerHTML=te.projectsSortedView.map(Vo).join(""),i.forEach(c=>{let l=document.getElementById(`project-item-${c}`);l&&l.classList.add("expanded")}),xn(te.projectsSortedView),Rn(r)}function Gi(e){return{default:p("projects.sort.statusLabel"),name:p("projects.sort.nameLabel"),"name-asc":p("projects.sort.nameLabel"),"name-desc":p("projects.sort.nameLabel"),"created-desc":p("projects.sort.newestLabel"),"updated-desc":p("projects.sort.lastUpdatedLabel"),"tasks-desc":p("projects.sort.mostTasksLabel"),"completion-desc":p("projects.sort.percentCompletedLabel")}[e]||e}function Yi(){let e=document.getElementById("projects-sort-label");if(!e)return;let t=Ne?.lastSort||"default",a=Gi(t),n=Ne?.direction==="asc"?"asc":"desc";e.textContent=p("projects.sort.prefix",{label:a,direction:n});let o=document.querySelector("#projects-sort-btn .sort-label-arrow");o&&ns(o,n);try{os()}catch{}}function ns(e,t){e&&(e.classList.toggle("is-up",t==="asc"),e.classList.toggle("is-down",t!=="asc"),e.innerHTML='<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 20 L6 14 H10 V4 H14 V14 H18 Z" fill="currentColor"/></svg>')}function $r(e,{toggleDirection:t=!1}={}){let a=e||"default",n=Ne.lastSort===a;t||n?Ne.direction=Ne.direction==="asc"?"desc":"asc":Ne.direction="asc",Ne.lastSort=a,Yi();try{os()}catch{}let o=ht()||{search:"",filter:"",sort:"default"};Yt({...o,sort:a,sortDirection:Ne.direction}),ot()}function os(){let e=document.getElementById("projects-sort-panel");if(!e)return;let t=Ne?.lastSort||"default",a=Ne?.direction==="asc"?"asc":"desc";e.querySelectorAll(".projects-sort-option").forEach(n=>{let o=n.dataset.sort===t;n.classList.toggle("is-active",o);let s=n.querySelector(".sort-option-indicator");s||(s=document.createElement("button"),s.type="button",s.className="sort-option-indicator",s.setAttribute("aria-label",p("projects.sort.help")),n.appendChild(s)),o&&ns(s,a),s.style.visibility=o?"visible":"hidden"})}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("projects-sort-btn"),t=document.getElementById("projects-sort-panel"),a=document.getElementById("projects-sort-label");if(e&&t){e.addEventListener("click",c=>{if(c.target.closest(".sort-label-arrow")){c.preventDefault(),c.stopPropagation(),$r(Ne?.lastSort||"default",{toggleDirection:!0});return}let u=!(e.getAttribute("aria-expanded")==="true");e.setAttribute("aria-expanded",String(u)),u?(t.setAttribute("aria-hidden","false"),t.removeAttribute("inert")):(t.contains(document.activeElement)&&e.focus(),t.setAttribute("aria-hidden","true"),t.setAttribute("inert",""));try{os()}catch{}c.stopPropagation()});let i=document.getElementById("projects-sort-panel");if(!i)return;i.querySelectorAll(".projects-sort-option").forEach(c=>{c.addEventListener("click",l=>{let u=c.dataset.sort||"default",d=l.target&&l.target.classList&&l.target.classList.contains("sort-option-indicator");$r(u,{toggleDirection:d||Ne.lastSort===u}),d?(t.removeAttribute("inert"),l.stopPropagation()):(e.setAttribute("aria-expanded","false"),t.contains(document.activeElement)&&e.focus(),t.setAttribute("aria-hidden","true"),t.setAttribute("inert",""))})}),document.addEventListener("click",()=>{e.setAttribute("aria-expanded","false"),t.contains(document.activeElement)&&e.focus(),t.setAttribute("aria-hidden","true"),t.setAttribute("inert","")})}let n=document.getElementById("group-project-status");n&&n.querySelectorAll('input[type="checkbox"][data-filter="project-status"]').forEach(c=>{c.addEventListener("change",()=>{c.checked?q.statuses.add(c.value):q.statuses.delete(c.value),Un(),ot(),Ki()})});let o=document.getElementById("projects-search");o&&o.addEventListener("input",sn(i=>{q.search=(i.target.value||"").trim(),ot();let c=ht()||{};Yt({...c,search:i.target.value})},220));let s=Array.from(document.querySelectorAll(".pf-chip"));s.forEach(i=>{i.addEventListener("click",()=>{let c=i.dataset.filter;i.classList.contains("active")?(i.classList.remove("active"),q.taskFilter=""):(s.forEach(u=>u.classList.remove("active")),i.classList.add("active"),q.taskFilter=c),ot();let l=ht()||{};Yt({...l,filter:q.taskFilter||""})})});let r=document.getElementById("btn-clear-projects");r&&r.addEventListener("click",Ji),An()});window.clearProjectFilters=Ji;function Ki(){let e=new URLSearchParams,t=ht()||{},a=q.search||t.search;a&&a.trim()!==""&&e.set("search",a.trim()),q.statuses.size>0&&e.set("status",Array.from(q.statuses).join(","));let n=q.taskFilter||t.filter;n&&["has-tasks","no-tasks"].includes(n)&&e.set("filter",n),t.sort&&t.sort!=="default"&&e.set("sort",t.sort),t.sortDirection&&t.sortDirection!=="asc"&&e.set("sortDirection",t.sortDirection);let o=q.updatedFilter||t.updatedFilter;o&&o!=="all"&&e.set("updatedFilter",o);let s=e.toString(),r=s?`#projects?${s}`:"#projects";window.location.hash!==r&&window.history.replaceState(null,"",r)}function Yt(e){try{localStorage.setItem("projectsViewState",JSON.stringify(e)),Ki()}catch{}}function ht(){try{let e=localStorage.getItem("projectsViewState");if(!e)return null;let t=JSON.parse(e);return!t||typeof t!="object"?null:(t.filter==="clear"&&(t.filter=""),t.filter&&t.filter!=="has-tasks"&&t.filter!=="no-tasks"&&(t.filter=""),t.updatedFilter==null&&(t.updatedFilter="all"),t.updatedFilter&&typeof t.updatedFilter=="string"&&(new Set(["all","5m","30m","24h","week","month"]).has(t.updatedFilter)||(t.updatedFilter="all")),t)}catch{return null}}function Mu(e){let t=document.getElementById("projects-list");if(!t)return;if(!e||e.length===0){t.innerHTML=`<div class="empty-state"><h3>${p("projects.empty.filteredTitle")}</h3></div>`,xn([]);return}let a=new Set;t.querySelectorAll(".project-list-item.expanded").forEach(n=>{let o=n.id.replace("project-item-","");a.add(o)}),t.innerHTML=e.map(Vo).join(""),a.forEach(n=>{let o=document.getElementById(`project-item-${n}`);o&&o.classList.add("expanded")}),xn(e)}function Fu(){let e=document.getElementById("projects-sort"),t=document.getElementById("projects-sort-btn"),a=document.getElementById("projects-sort-label"),n=document.getElementById("projects-search"),o=Array.from(document.querySelectorAll(".pf-chip")),s=ht()||{search:"",filter:"",sort:"default",sortDirection:"asc",updatedFilter:"all"},r=window.urlProjectFilters||{},i={search:r.search!==void 0?r.search:s.search,filter:r.filter!==void 0?r.filter:s.filter,sort:r.sort!==void 0?r.sort:s.sort,sortDirection:r.sortDirection!==void 0?r.sortDirection:s.sortDirection,updatedFilter:r.updatedFilter!==void 0?r.updatedFilter:s.updatedFilter};i.filter==="clear"&&(i.filter=""),i.filter&&i.filter!=="has-tasks"&&i.filter!=="no-tasks"&&(i.filter=""),r.statuses&&Array.isArray(r.statuses)&&r.statuses.length>0&&(q.statuses.clear(),r.statuses.forEach(g=>q.statuses.add(g)),document.querySelectorAll('input[type="checkbox"][data-filter="project-status"]').forEach(g=>{g.checked=q.statuses.has(g.value)}),Un()),i.search&&(q.search=i.search),i.filter&&(q.taskFilter=i.filter),window.urlProjectFilters=null;let c=i.sort||"default",l=i.sortDirection||"asc";if(c==="name-asc"?(c="name",l="asc"):c==="name-desc"&&(c="name",l="desc"),Ne.lastSort=c,Ne.direction=l,n&&(n.value=i.search||""),o&&o.length&&(o.forEach(m=>m.classList.remove("active")),i.filter&&["has-tasks","no-tasks"].includes(i.filter))){let m=o.find(g=>g.dataset.filter===i.filter);m&&m.classList.add("active")}let u=te.projectsSortedView&&te.projectsSortedView.length?te.projectsSortedView.slice():N.slice();if(n&&n.value&&n.value.trim()!==""){let m=n.value.trim().toLowerCase();u=u.filter(g=>((g.name||"")+" "+(g.description||"")).toLowerCase().includes(m))}q.statuses.size>0&&(u=u.filter(m=>{let g=vt(m.id);return q.statuses.has(g)}));let d=i.filter||q.taskFilter;if(d==="has-tasks"?u=u.filter(m=>L.some(g=>g.projectId===m.id)):d==="no-tasks"&&(u=u.filter(m=>!L.some(g=>g.projectId===m.id))),i.updatedFilter&&i.updatedFilter!=="all"){let m=_i(i.updatedFilter);m!=null&&(u=u.filter(g=>Vi(g)>=m))}if(t){let m=i.sort||"default",g=Gi(m),y=Ne.direction==="asc"?"asc":"desc",v=p("projects.sort.prefix",{label:g,direction:y});a&&(a.textContent=v);let w=document.querySelector("#projects-sort-btn .sort-label-arrow");w&&ns(w,y)}{let m=new Set(["all","5m","30m","24h","week","month"]),g=m.has(i.updatedFilter)?i.updatedFilter:"all";q.updatedFilter=g,za();try{Wi()}catch{}document.querySelectorAll('input[type="radio"][data-filter="project-updated"][name="project-updated-filter"]').forEach(y=>{y.__projectUpdatedBound||(y.__projectUpdatedBound=!0,y.addEventListener("change",()=>{if(!y.checked)return;q.updatedFilter=m.has(y.value)?y.value:"all",za(),ot();let v=ht()||i;Yt({...v,updatedFilter:q.updatedFilter}),An()}))})}let f=Ne.lastSort||"default";No(f,u),An()}function An(){let e=document.getElementById("btn-clear-projects");if(!e)return;let t=q.search&&q.search.trim()!=="",a=q.statuses.size>0,n=q.taskFilter!=="",o=q.updatedFilter&&q.updatedFilter!=="all",s=q.tags.size>0,r=t||a||n||o||s;e.style.display=r?"inline-flex":"none"}function Ji(){q.search="",q.statuses.clear(),q.taskFilter="",q.updatedFilter="all",q.tags.clear();let e=document.getElementById("projects-search");e&&(e.value=""),Array.from(document.querySelectorAll(".pf-chip")).forEach(o=>o.classList.remove("active")),document.querySelectorAll('input[type="checkbox"][data-filter="project-status"]').forEach(o=>o.checked=!1),document.querySelectorAll('input[type="checkbox"][data-filter="project-tags"]').forEach(o=>o.checked=!1),document.querySelectorAll('input[type="radio"][data-filter="project-updated"][name="project-updated-filter"]').forEach(o=>o.checked=o.value==="all"),za(),Un(),as(),ot()}function Ru(e){if(!e)return!1;let t=window.getSelection();if(!t||!t.rangeCount)return!1;let a=t.getRangeAt(0),n=a.commonAncestorContainer,o=n.nodeType===1?n.closest?.(".check-text"):n.parentElement?.closest?.(".check-text");if(!o||!e.contains(o))return!1;let s=o.closest(".checkbox-row");if(!s)return!1;let r=a.cloneRange();r.selectNodeContents(o),r.setEnd(a.startContainer,a.startOffset);let i=r.toString(),c=a.cloneRange();c.selectNodeContents(o),c.setStart(a.endContainer,a.endOffset);let l=c.toString();if(i.length===0&&l.length===0){let u=document.createElement("div");u.innerHTML="<br>",s.parentNode.replaceChild(u,s);let d=document.createRange();return d.setStart(u,0),d.collapse(!0),t.removeAllRanges(),t.addRange(d),e.focus(),e.dispatchEvent(new Event("input")),!0}if(l.length===0){let u="chk-"+Date.now()+"-"+Math.floor(Math.random()*1e3),d=document.createElement("div");d.innerHTML=`<div class="checkbox-row" data-id="${u}" contenteditable="false"><button type="button" class="checkbox-toggle variant-1" aria-pressed="false" title="${p("tasks.checklist.toggle")}" contenteditable="false"></button><div class="check-text" contenteditable="true"></div></div>`;let f=d.firstChild;if(s&&s.parentNode){s.parentNode.insertBefore(f,s.nextSibling);let m=f.querySelector(".check-text"),g=document.createRange();g.selectNodeContents(m),g.collapse(!0),t.removeAllRanges(),t.addRange(g),m.focus(),e.dispatchEvent(new Event("input"))}return!0}return document.execCommand("insertHTML",!1,"<br><br>"),e.dispatchEvent(new Event("input")),!0}function Nr(){let e=document.getElementById("hamburger-btn"),t=document.querySelector(".sidebar"),a=document.getElementById("sidebar-overlay");if(!e||!t||!a)return;function n(){t.classList.toggle("active"),a.classList.toggle("active"),document.body.style.overflow=t.classList.contains("active")?"hidden":""}function o(){t.classList.remove("active"),a.classList.remove("active"),document.body.style.overflow=""}e.addEventListener("click",n),a.addEventListener("click",o),t.querySelectorAll(".nav-item").forEach(r=>{r.addEventListener("click",()=>{window.innerWidth<=768&&o()})}),window.addEventListener("resize",()=>{window.innerWidth>768&&o()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",Nr):Nr();window.addEventListener("resize",()=>{Rn()});var Ou=typeof window<"u"&&typeof window.__pageLoadStart=="number"?window.__pageLoadStart:performance.now(),qu=performance.now();ut()&&console.log(`[perf] main.js: executed after ${Math.round(qu-Ou)}ms since nav start`);zi();ut()&&Ve("event-delegation-setup");document.addEventListener("DOMContentLoaded",()=>{ut()&&Ve("dom-content-loaded"),typeof Mn=="function"&&Mn()});
