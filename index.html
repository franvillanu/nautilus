<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="theme-color" content="#0f1419">
    <title>Nautilus ‚Äì Task Manager</title>

    <!-- Critical inline styles to prevent white flash (MUST be first) -->
    <style>
        /* Apply dark background immediately before CSS loads */
        html, body {
            background: #0f1419;
            color: #f9fafb;
            margin: 0;
            padding: 0;
        }
    </style>

    <!-- Apply theme from localStorage before page renders (blocking script) -->
    <script>
        (function() {
            // console.log('[PERF] HTML parsing started, inline script executing at', performance.now());
            window.__pageLoadStart = performance.now();

            // Check for saved theme preference, default to dark
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);

            // Set background color based on theme (only html, body doesn't exist yet)
            if (savedTheme === 'dark') {
                document.documentElement.style.background = '#0f1419';
            } else {
                document.documentElement.style.background = '#f8fafc';
            }

            // Set logo source based on theme
            window.__logoSrc = savedTheme === 'dark' ? 'Nautilus_logo.png' : 'Nautilus_logo_light.png';
        })();
    </script>


    <!-- Consolidated CSS -->
    <link rel="stylesheet" href="style.css?v=20260111-mobile-scroll-fixes">
    <!-- Lock screen styles -->
    <link rel="stylesheet" href="lock/style.css?v=20251108-14">

    <!-- Flatpickr (CDN for production) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <style>
        /* Boot splash: prevents blank screen while JS/CSS load */
        .boot-splash {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #0f1419;
            color: #f9fafb;
            z-index: 20000;
        }
        [data-theme="light"] .boot-splash {
            background: #f8fafc;
            color: #111827;
        }
        .boot-splash-inner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 24px;
            text-align: center;
        }

        /* Minimalistic loader:
           - wordmark is always original
           - nautilus icon fills upward (reveals original colors)
        */
        .boot-logo {
            position: relative;
            display: block;
            --progress: 0;
            --p: 0;
            /* % from top where the wordmark begins (tweak to taste) */
            --icon-cutoff: 56%;
            /* Reveal starts slightly above the wordmark (tuned in earlier PRs) */
            --reveal-top: 52%;
            filter: drop-shadow(0 12px 22px rgba(0,0,0,0.38));

            /* Fallbacks (in case clamp() isn't supported) */
            width: 220px;
            height: 220px;
            width: clamp(180px, 14vw, 240px);
            height: clamp(180px, 14vw, 240px);
            min-width: 180px;
            min-height: 180px;
            flex: 0 0 auto;
        }
        [data-theme="light"] .boot-logo {
            filter: drop-shadow(0 12px 22px rgba(0,0,0,0.18));
        }

        .boot-logo img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            pointer-events: none;
            user-select: none;
        }

        .boot-logo-wordmark {
            z-index: 1;
            clip-path: inset(var(--icon-cutoff) 0 0 0);
        }

        .boot-logo-dim {
            z-index: 2;
            clip-path: inset(0 0 calc(100% - var(--icon-cutoff)) 0);
            opacity: 0.55;
            filter: saturate(0.05) brightness(0.85) contrast(1.08);
        }

        [data-theme="light"] .boot-logo-dim {
            opacity: 0.45;
            filter: saturate(0.05) brightness(0.38) contrast(1.12);
        }

        .boot-logo-reveal {
            z-index: 3;
            clip-path: inset(var(--reveal-top) 0 calc(100% - var(--icon-cutoff)) 0);
            transition: clip-path 0.3s ease-out, -webkit-clip-path 0.3s ease-out;
            will-change: clip-path;
        }
    </style>
</head>
<body>
<!-- Visible immediately to avoid a blank screen while the app boots -->
<div id="boot-splash" class="boot-splash" role="status" aria-live="polite" aria-label="Loading Nautilus" data-i18n="boot.loading" data-i18n-attr="aria-label">
    <div class="boot-splash-inner">
        <div class="boot-logo" aria-hidden="true">
            <img class="boot-logo-wordmark" src="Nautilus_logo.png" alt="" />
            <img class="boot-logo-dim" src="Nautilus_logo.png" alt="" />
            <img class="boot-logo-reveal" src="Nautilus_logo.png" alt="" />
        </div>
    </div>
</div>
<script>
    // Update splash logos IMMEDIATELY (runs inline as HTML parses - zero delay)
    (function() {
        var logos = document.querySelectorAll('.boot-logo-wordmark, .boot-logo-dim, .boot-logo-reveal');
        for (var i = 0; i < logos.length; i++) {
            logos[i].src = window.__logoSrc;
        }
    })();
</script>
<!-- LOCAL DEV BANNER -->
<div id="dev-banner" style="display:none; position:fixed; bottom:0; left:0; right:0; background:#8b0000; color:#fff; padding:5px; text-align:center; z-index:99999; font-weight:bold; font-size:13px;" data-i18n="common.devBanner">
  ‚ö†Ô∏è LOCAL DEV - NOT PRODUCTION ‚ö†Ô∏è
</div>
<script>
  if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
    document.getElementById('dev-banner').style.display = 'block';
  }
</script>
    <!-- Lock overlay (gates the app) - DISABLED - Using new auth system -->
    <div class="overlay" id="overlay" style="display:none;">
        <div class="panel" role="dialog" aria-labelledby="heading" aria-describedby="desc">
            <div class="left">
                <img src="Nautilus_logo.png" alt="Nautilus logo" class="logo" data-i18n="common.nautilusLogoAlt" data-i18n-attr="alt" />
            </div>

            <div class="right">
                <h1 id="heading" data-i18n="lock.welcome">Welcome back</h1>
                <p id="desc" class="muted" data-i18n="lock.subtitle">Enter the access password to continue.</p>
                <div class="info-tag" data-i18n="lock.sessionHint">‚åõ Session stays signed-in for 24 hours.</div>

                <form id="unlockForm" autocomplete="off" novalidate>
                    <label for="pw" class="sr-only" data-i18n="lock.passwordLabel">Password</label>
                    <div class="inputRow">
                        <input id="pw" name="pw" type="password" inputmode="text" placeholder="Enter password" aria-label="Password" required data-i18n="lock.passwordPlaceholder" data-i18n-attr="placeholder" />
                        <div class="actions">
                            <button type="submit" class="btn primary" id="unlock" data-i18n="lock.unlock">Unlock</button>
                        </div>
                    </div>
                    <div id="status" role="alert" aria-live="polite" class="status"></div>
                </form>
            </div>
        </div>
    </div>
    <!-- <script src="lock/lock.js"></script> DISABLED - Using new auth system -->

    <!-- Auth Pages (Full-screen overlays) -->

    <!-- User Login Page -->
    <div class="auth-overlay" id="login-page" style="display:none;">
        <div class="auth-panel">
            <div class="auth-left">
                <img src="Nautilus_logo.png" alt="Nautilus logo" class="logo" id="login-logo" style="cursor: pointer;" data-i18n="common.nautilusLogoAlt" data-i18n-attr="alt" />
            </div>
            <div class="auth-right">
                <h1 data-i18n="auth.login.title">Welcome to Nautilus</h1>
                <p class="muted" data-i18n="auth.login.subtitle">Login to access your workspace</p>

                <form id="login-form" autocomplete="off" novalidate>
                    <div class="form-group">
                        <label for="login-identifier" data-i18n="auth.login.identifierLabel">Username or Email</label>
                        <input
                            id="login-identifier"
                            type="text"
                            placeholder="Enter username or email"
                            data-i18n="auth.login.identifierPlaceholder"
                            data-i18n-attr="placeholder"
                            autocomplete="username"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label data-i18n="auth.login.pinLabel">PIN (4 digits)</label>
                        <div class="pin-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <input type="hidden" id="login-pin" />
                    </div>

                    <div class="pin-pad">
                        <button type="button" class="pin-btn" data-value="1">1</button>
                        <button type="button" class="pin-btn" data-value="2">2</button>
                        <button type="button" class="pin-btn" data-value="3">3</button>
                        <button type="button" class="pin-btn" data-value="4">4</button>
                        <button type="button" class="pin-btn" data-value="5">5</button>
                        <button type="button" class="pin-btn" data-value="6">6</button>
                        <button type="button" class="pin-btn" data-value="7">7</button>
                        <button type="button" class="pin-btn" data-value="8">8</button>
                        <button type="button" class="pin-btn" data-value="9">9</button>
                        <button type="button" class="pin-btn pin-btn-clear" data-value="clear">‚Üê</button>
                        <button type="button" class="pin-btn" data-value="0">0</button>
                        <button type="button" class="pin-btn" style="visibility:hidden;"></button>
                    </div>

                    <div id="login-status" class="status" role="alert"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Login Page -->
    <div class="auth-overlay" id="admin-login-page" style="display:none;">
        <div class="auth-panel">
            <div class="auth-left">
                <img src="Nautilus_logo.png" alt="Nautilus logo" class="logo" data-i18n="common.nautilusLogoAlt" data-i18n-attr="alt" />
            </div>
            <div class="auth-right">
                <a href="#login" class="auth-back-link" style="display: inline-flex; align-items: center; gap: 6px; font-size: 13px; color: #9fb0b6; text-decoration: none; margin-bottom: 12px; cursor: pointer;">
                    <span style="font-size: 16px;">‚Üê</span> <span data-i18n="auth.backToUserLogin">Back to User Login</span>
                </a>
                <h1 data-i18n="auth.admin.title">Admin Access</h1>
                <p class="muted" data-i18n="auth.admin.subtitle">Enter master PIN to access admin dashboard</p>

                <form id="admin-login-form" autocomplete="off" novalidate>
                    <div class="form-group">
                        <label data-i18n="auth.admin.pinLabel">Master PIN (4 digits)</label>
                        <div class="pin-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <input type="hidden" id="admin-login-pin" />
                    </div>

                    <div class="pin-pad">
                        <button type="button" class="pin-btn" data-value="1">1</button>
                        <button type="button" class="pin-btn" data-value="2">2</button>
                        <button type="button" class="pin-btn" data-value="3">3</button>
                        <button type="button" class="pin-btn" data-value="4">4</button>
                        <button type="button" class="pin-btn" data-value="5">5</button>
                        <button type="button" class="pin-btn" data-value="6">6</button>
                        <button type="button" class="pin-btn" data-value="7">7</button>
                        <button type="button" class="pin-btn" data-value="8">8</button>
                        <button type="button" class="pin-btn" data-value="9">9</button>
                        <button type="button" class="pin-btn pin-btn-clear" data-value="clear">‚Üê</button>
                        <button type="button" class="pin-btn" data-value="0">0</button>
                        <button type="button" class="pin-btn" style="visibility:hidden;"></button>
                    </div>

                    <div id="admin-login-status" class="status" role="alert"></div>
                </form>

                <div class="auth-footer">
                    <a href="#login" class="auth-link"><span data-i18n="auth.backToUserLogin">‚Üê Back to User Login</span></a>
                </div>
            </div>
        </div>
    </div>

    <!-- User Setup Page (First-time login) -->
    <div class="auth-overlay" id="setup-page" style="display:none;">
        <div class="auth-panel">
            <div class="auth-left">
                <img src="Nautilus_logo.png" alt="Nautilus logo" class="logo" data-i18n="common.nautilusLogoAlt" data-i18n-attr="alt" />
            </div>
            <div class="auth-right">
                <h1 id="setup-welcome" data-i18n="auth.setup.title">Complete Your Setup</h1>
                <p class="muted" data-i18n="auth.setup.subtitle">Personalize your account</p>

                <form id="setup-form" autocomplete="off" novalidate>
                    <div class="form-group">
                        <label for="setup-username"><span data-i18n="auth.setup.usernameLabel">Username</span> <span class="required">*</span></label>
                        <input
                            id="setup-username"
                            type="text"
                            placeholder="e.g., alex"
                            data-i18n="auth.setup.usernamePlaceholder"
                            data-i18n-attr="placeholder"
                            autocomplete="username"
                            required
                        />
                        <small class="form-hint" data-i18n="auth.setup.usernameHint">3-20 characters, lowercase letters and numbers only</small>
                    </div>

                    <div class="form-group">
                        <label for="setup-name"><span data-i18n="auth.setup.displayNameLabel">Display Name</span> <span class="required">*</span></label>
                        <input
                            id="setup-name"
                            type="text"
                            placeholder="e.g., Alex Morgan"
                            data-i18n="auth.setup.displayNamePlaceholder"
                            data-i18n-attr="placeholder"
                            autocomplete="name"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="setup-email"><span data-i18n="auth.setup.emailLabel">Email</span> <span class="required">*</span></label>
                        <input
                            id="setup-email"
                            type="email"
                            placeholder="your.email@example.com"
                            data-i18n="auth.setup.emailPlaceholder"
                            data-i18n-attr="placeholder"
                            autocomplete="email"
                            required
                        />
                        <small class="form-hint" data-i18n="auth.setup.emailHint">Required for notifications</small>
                    </div>

                    <div class="form-group">
                        <label><span data-i18n="auth.setup.newPinLabel">New PIN (4 digits)</span> <span class="required">*</span></label>
                        <div class="pin-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <input type="hidden" id="setup-new-pin" />
                    </div>

                    <div class="form-group">
                        <label><span data-i18n="auth.setup.confirmPinLabel">Confirm PIN</span> <span class="required">*</span></label>
                        <div class="pin-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <input type="hidden" id="setup-confirm-pin" />
                    </div>

                    <div class="pin-pad">
                        <button type="button" class="pin-btn" data-value="1">1</button>
                        <button type="button" class="pin-btn" data-value="2">2</button>
                        <button type="button" class="pin-btn" data-value="3">3</button>
                        <button type="button" class="pin-btn" data-value="4">4</button>
                        <button type="button" class="pin-btn" data-value="5">5</button>
                        <button type="button" class="pin-btn" data-value="6">6</button>
                        <button type="button" class="pin-btn" data-value="7">7</button>
                        <button type="button" class="pin-btn" data-value="8">8</button>
                        <button type="button" class="pin-btn" data-value="9">9</button>
                        <button type="button" class="pin-btn pin-btn-clear" data-value="clear">‚Üê</button>
                        <button type="button" class="pin-btn" data-value="0">0</button>
                        <button type="button" class="pin-btn pin-btn-next" data-i18n="auth.setup.next">Next</button>
                    </div>

                    <div id="setup-status" class="status" role="alert"></div>

                    <button type="submit" class="btn primary full-width" id="setup-submit" data-i18n="auth.setup.submit">Complete Setup</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard Page -->
    <div class="auth-overlay" id="admin-page" style="display:none;">
        <div class="auth-panel admin-panel">
            <div class="admin-header">
                <h1 data-i18n="admin.title">User Management</h1>
                <button class="btn secondary" id="admin-logout" data-i18n="admin.signOut">Sign Out</button>
            </div>

            <div class="admin-content">
                <!-- User List -->
                <div class="admin-section">
                    <div class="section-header">
                        <h2 data-i18n="admin.usersTitle">Users</h2>
                    </div>

                    <div id="users-list" class="users-list">
                        <!-- Users will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Create User Form -->
                <div class="admin-section">
                    <h2 data-i18n="admin.createUserTitle">Create New User</h2>

                    <form id="create-user-form" autocomplete="off" novalidate>
                        <div class="form-group">
                            <label for="new-username"><span data-i18n="admin.usernameLabel">Username</span> <span class="required">*</span></label>
                            <input
                                id="new-username"
                                type="text"
                                placeholder="e.g., jdoe"
                                data-i18n="admin.usernamePlaceholder"
                                data-i18n-attr="placeholder"
                                autocomplete="off"
                                required
                            />
                            <small class="form-hint" data-i18n="admin.usernameHint">3-20 characters, lowercase letters and numbers only</small>
                        </div>

                        <div class="form-group">
                            <label for="new-name"><span data-i18n="admin.displayNameLabel">Display Name</span> <span class="required">*</span></label>
                            <input
                                id="new-name"
                                type="text"
                                placeholder="e.g., John Doe"
                                data-i18n="admin.displayNamePlaceholder"
                                data-i18n-attr="placeholder"
                                autocomplete="off"
                                required
                            />
                        </div>

                        <div class="form-group">
                            <label><span data-i18n="admin.tempPinLabel">Temporary PIN (4 digits)</span> <span class="required">*</span></label>
                            <div class="pin-dots">
                                <span class="dot"></span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                            </div>
                            <input type="hidden" id="new-temp-pin" />
                        </div>

                        <div class="pin-pad">
                            <button type="button" class="pin-btn" data-value="1">1</button>
                            <button type="button" class="pin-btn" data-value="2">2</button>
                            <button type="button" class="pin-btn" data-value="3">3</button>
                            <button type="button" class="pin-btn" data-value="4">4</button>
                            <button type="button" class="pin-btn" data-value="5">5</button>
                            <button type="button" class="pin-btn" data-value="6">6</button>
                            <button type="button" class="pin-btn" data-value="7">7</button>
                            <button type="button" class="pin-btn" data-value="8">8</button>
                            <button type="button" class="pin-btn" data-value="9">9</button>
                            <button type="button" class="pin-btn pin-btn-clear" data-value="clear">‚Üê</button>
                            <button type="button" class="pin-btn" data-value="0">0</button>
                            <button type="button" class="pin-btn" style="visibility:hidden;"></button>
                        </div>

                        <div id="create-user-status" class="status" role="alert"></div>

                        <button type="submit" class="btn primary" data-i18n="admin.createUserButton">Create User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="app" style="display:none;">
        <!-- Mobile Header (shown only on mobile) -->
        <div class="mobile-header">
            <div class="mobile-header-left">
                <button class="hamburger-btn" id="hamburger-btn" aria-label="Open menu" data-i18n="menu.openMenu" data-i18n-attr="aria-label">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <div>
                    <h1>Nautilus</h1>
                </div>
            </div>
        </div>

        <!-- Sidebar Overlay (for mobile drawer) -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- User Menu - Always Visible -->
        <div class="user-menu">
            <div class="notify-menu">
                <button class="notify-btn" id="notification-toggle" aria-label="Notifications" data-i18n="notifications.toggle" data-i18n-attr="aria-label">
                    <span class="notify-icon">üîî</span>
                    <span class="notify-badge" id="notification-count" aria-hidden="true"></span>
                </button>
                <div class="notify-dropdown" id="notification-dropdown" aria-hidden="true">
                    <div class="notify-header">
                        <span data-i18n="notifications.title">Notifications</span>
                        <button type="button" class="notify-clear-btn" data-action="dismissAll" data-i18n="notifications.clearAll" aria-label="Clear all">Clear all</button>
                    </div>
                    <div class="notify-list" id="notification-list"></div>
                </div>
            </div>
            <div class="user-avatar" id="shared-user-avatar">ML</div>
            <div class="user-dropdown" id="shared-user-dropdown">
                <div class="dropdown-header">
                    <div class="user-name">Moony Lambre</div>
                    <div class="user-email">malambre@ull.edu.es</div>
                </div>
                <div class="dropdown-item" data-action="toggleTheme">
                    <span>üåô</span>
                    <span id="theme-text" data-i18n="menu.darkMode">Dark mode</span>
                </div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-item" data-action="openSettingsModal">
                    <span>‚öôÔ∏è</span>
                    <span data-i18n="menu.settings">Settings</span>
                </div>
                <div class="dropdown-item disabled">
                    <span>‚ùì</span>
                    <span data-i18n="menu.help">Help</span>
                </div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-item" data-action="signOut">
                    <span>üö™</span>
                    <span data-i18n="menu.signOut">Sign out</span>
                </div>
            </div>
        </div>        
        
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="workspace-title">
                    <div class="workspace-icon">üåä</div>
                    Nautilus
                </div>
            </div>
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title" data-i18n="nav.overview">Overview</div>
                    <div class="nav-item active" data-page="dashboard">
                        <span class="nav-icon">üè†</span>
                        <span data-i18n="nav.dashboard">Dashboard</span>
                    </div>
                    <div class="nav-item calendar-nav" data-action="showCalendarView">
                        <span class="nav-icon">üìÖ</span>
                        <span data-i18n="nav.calendar">Calendar</span>
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title" data-i18n="nav.work">Work</div>
                    <div class="nav-item" data-page="projects">
                        <span class="nav-icon">üìä</span>
                        <span data-i18n="nav.projects">Projects</span>
                        <span class="nav-count" id="projects-count">0</span>
                    </div>
                    <div class="nav-item" data-page="tasks">
                        <span class="nav-icon">‚úÖ</span>
                        <span data-i18n="nav.allTasks">All Tasks</span>
                        <span class="nav-count" id="tasks-count">0</span>
                    </div>
                </div>
                <div style="margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border); display: flex; flex-direction: column; gap: 12px;">
                    <div class="nav-item" data-page="feedback">
                        <span class="nav-icon">üí¨</span>
                        <span data-i18n="nav.feedback">Feedback</span>
                        <span class="nav-count" id="feedback-count">0</span>
                    </div>
                    <!-- Release notes hidden from menu - accessible only via notification screen -->
                    <!-- <div class="nav-item" data-page="updates">
                        <span class="nav-icon">‚ú®</span>
                        <span data-i18n="nav.updates">Release notes</span>
                    </div> -->
                </div>
            </nav>
        </div>

        <div class="resizer"></div>

        <div class="main-content">
            <div class="page active" id="dashboard">
                <div class="page-header">
                    <div>
                        <h1 class="page-title" data-i18n="dashboard.title">Dashboard</h1>
                    </div>
                </div>
                <div class="page-content dashboard-content">
                    <!-- Hero Stats Section -->
                    <div class="hero-stats">
                        <div class="hero-stat-card primary">
                            <div class="hero-stat-content">
                                <div class="hero-stat-number" id="hero-active-projects">0</div>
                                <div class="hero-stat-label" data-i18n="dashboard.hero.activeProjectsLabel">Active Projects</div>
                                <div class="hero-stat-trend" id="projects-trend" data-i18n="dashboard.hero.projectsTrend">üìà +2 this month</div>
                            </div>
                            <div class="hero-stat-visual">
                                <div class="hero-chart" id="projects-sparkline"></div>
                            </div>
                        </div>
                        
                        <div class="hero-stat-card success">
                            <div class="hero-stat-content">
                                <div class="hero-stat-number" id="hero-completion-rate">0%</div>
                                <div class="hero-stat-label" data-i18n="dashboard.hero.completionRateLabel">Completion Rate</div>
                                <div class="hero-stat-trend" id="completion-trend" data-i18n="dashboard.hero.completionTrend">üéØ Target: 80%</div>
                            </div>
                            <div class="hero-stat-visual">
                                <div class="completion-ring" id="completion-ring">
                                    <svg viewBox="0 0 100 100">
                                        <circle cx="50" cy="50" r="45" fill="none" stroke="var(--bg-tertiary)" stroke-width="8"/>
                                        <circle cx="50" cy="50" r="45" fill="none" stroke="var(--accent-green)" stroke-width="8" 
                                                stroke-dasharray="283" stroke-dashoffset="283" class="progress-circle"/>
                                    </svg>
                                    <div class="ring-percentage" id="ring-percentage">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Dashboard Grid -->
                    <div class="dashboard-grid">
                        <!-- Enhanced Stats Cards -->
                        <div class="stats-section">
                            <div class="stats-header">
                                <h3 data-i18n="dashboard.projectAnalytics">üìä Project Analytics</h3>
                                <div class="time-filter">
                                    <button class="filter-chip active" data-period="week" data-i18n="dashboard.period.week">Week</button>
                                    <button class="filter-chip" data-period="month" data-i18n="dashboard.period.month">Month</button>
                                    <button class="filter-chip" data-period="quarter" data-i18n="dashboard.period.quarter">Quarter</button>
                                </div>
                            </div>
                            <div class="enhanced-stats-grid">
                                <div class="enhanced-stat-card" data-filter="status" data-value="todo">
                                    <div class="stat-icon-new amber">‚è∞</div>
                                    <div class="stat-number" id="pending-tasks-new">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title" data-i18n="dashboard.stat.pendingTasks">Pending Tasks</div>
                                        <div class="stat-change neutral" id="pending-change">On track</div>
                                    </div>
                                </div>

                                <div class="enhanced-stat-card" data-filter="status" data-value="progress">
                                    <div class="stat-icon-new blue">üèÉ‚Äç‚ôÇÔ∏è</div>
                                    <div class="stat-number" id="in-progress-tasks">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title" data-i18n="dashboard.stat.inProgress">In Progress</div>
                                        <div class="stat-change positive" id="progress-change">+2 this week</div>
                                    </div>
                                </div>

                                <div class="enhanced-stat-card" data-filter="priority" data-value="high">
                                    <div class="stat-icon-new purple">‚ö°</div>
                                    <div class="stat-number" id="high-priority-tasks">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title" data-i18n="dashboard.stat.highPriority">High Priority</div>
                                        <div class="stat-change neutral" id="priority-change" data-i18n="dashboard.highPriorityHint" data-i18n-attr="title" title="High priority tasks due within 7 days (or overdue)">2 critical</div>
                                    </div>
                                </div>

                                <div class="enhanced-stat-card" data-filter="overdue" data-value="true">
                                    <div class="stat-icon-new red">üö®</div>
                                    <div class="stat-number" id="overdue-tasks">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title" data-i18n="dashboard.stat.overdue">Overdue</div>
                                        <div class="stat-change negative" id="overdue-change">Needs attention</div>
                                    </div>
                                </div>

                                <div class="enhanced-stat-card" data-filter="status" data-value="done">
                                    <div class="stat-icon-new green">‚úÖ</div>
                                    <div class="stat-number" id="completed-tasks-new">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title" data-i18n="dashboard.stat.completed">Completed</div>
                                        <div class="stat-change positive" id="completed-change">+13 this week</div>
                                    </div>
                                </div>

                                <div class="enhanced-stat-card clickable" id="projects-stat-card">
                                    <div class="stat-icon-new teal">üéØ</div>
                                    <div class="stat-number" id="research-milestones">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title" data-i18n="dashboard.stat.projects">Projects</div>
                                        <div class="stat-change positive" id="milestones-change">In progress</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Project Progress Overview -->
                        <div class="progress-overview-card">
                            <div class="card-header">
                                <h3 data-i18n="dashboard.projectProgress">üåä Project Progress</h3>
                                <div class="progress-legend">
                                    <div class="legend-item"><span class="dot todo"></span><span data-i18n="dashboard.legend.todo">To Do</span></div>
                                    <div class="legend-item"><span class="dot progress"></span><span data-i18n="dashboard.legend.progress">In Progress</span></div>
                                    <div class="legend-item"><span class="dot review"></span><span data-i18n="dashboard.legend.review">In Review</span></div>
                                    <div class="legend-item"><span class="dot done"></span><span data-i18n="dashboard.legend.complete">Complete</span></div>
                                    <button class="view-all-btn" type="button" data-i18n="dashboard.viewAll" onclick="window.location.hash = '#projects'; showPage('projects');">View All</button>
                                </div>
                            </div>
                            <div class="progress-visualization">
                                <div class="progress-bars" id="project-progress-bars"></div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="quick-actions-card">
                            <div class="card-header">
                                <h3 data-i18n="dashboard.quickActions">‚ö° Quick Actions</h3>
                            </div>
                            <div class="quick-actions-grid">
                                <button class="quick-action" data-action="generateReport">
                                    <div class="qa-icon">üìä</div>
                                    <div class="qa-text" data-i18n="dashboard.action.generateReport">Generate Report</div>
                                </button>
                                <button class="quick-action" data-action="openTaskModal">
                                    <div class="qa-icon">‚úÖ</div>
                                    <div class="qa-text" data-i18n="dashboard.action.addTask">Add Task</div>
                                </button>
                                <button class="quick-action" data-action="showCalendarView">
                                    <div class="qa-icon">üìÖ</div>
                                    <div class="qa-text" data-i18n="dashboard.action.viewCalendar">View Calendar</div>
                                </button>
                                <button class="quick-action" data-action="openProjectModal">
                                    <div class="qa-icon">üöÄ</div>
                                    <div class="qa-text" data-i18n="dashboard.action.newProject">New Project</div>
                                </button>
                            </div>
                        </div>

                        <!-- Activity Feed -->
                        <div class="activity-feed-card">
                            <div class="card-header">
                                <h3 data-i18n="dashboard.recentActivity">üîÑ Recent Activity</h3>
                                <button class="view-all-btn" data-action="showAllActivity" data-i18n="dashboard.viewAll">View All</button>
                            </div>
                            <div class="activity-feed" id="activity-feed">
                                <div class="activity-item">
                                    <div class="activity-icon completed">‚úÖ</div>
                                    <div class="activity-content">
                                        <div class="activity-text" data-i18n="dashboard.activity.emptyTitle">Welcome to your Dashboard!</div>
                                        <div class="activity-time" data-i18n="dashboard.activity.emptySubtitle">Start creating projects and tasks to see activity</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Priority Insights -->
                        <div class="insights-card">
                            <div class="card-header">
                                <h3 data-i18n="dashboard.researchInsights">üß† Insights</h3>
                            </div>
                            <div class="insights-list" id="insights-list">
                                <div class="insight-item priority">
                                    <div class="insight-icon">üéØ</div>
                                    <div class="insight-content">
                                        <div class="insight-title">Focus Area Detected</div>
                                        <div class="insight-desc">Most tasks are related to data collection - consider specialized workflows</div>
                                    </div>
                                </div>
                                <div class="insight-item success">
                                    <div class="insight-icon">üìà</div>
                                    <div class="insight-content">
                                        <div class="insight-title" data-i18n="dashboard.insights.productivityTitle">Productivity Trend</div>
                                        <div class="insight-desc" data-i18n="dashboard.insights.productivityDesc">Task completion rate increased 23% compared to last month</div>
                                    </div>
                                </div>
                                <div class="insight-item warning">
                                    <div class="insight-icon">‚ö†Ô∏è</div>
                                    <div class="insight-content">
                                        <div class="insight-title" data-i18n="dashboard.insights.deadlineTitle">Deadline Alert</div>
                                        <div class="insight-desc" data-i18n="dashboard.insights.deadlineDesc">3 milestones due within the next 7 days</div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>

            <div class="page" id="projects">
                <div class="page-header">
                    <div>
                        <h1 class="page-title" data-i18n="projects.title">Projects</h1>
                        <p class="page-subtitle" data-i18n="projects.subtitle">Manage your projects</p>
                    </div>
                </div>
                <div class="page-content">
                    <div class="projects-header">
                        <div class="projects-filters-toolbar">
                            <input id="projects-search" class="projects-search" type="text" placeholder="üîç Search projects (title or description)" aria-label="Search projects by title or description" data-i18n="projects.searchPlaceholder" data-i18n-attr="placeholder,aria-label">

                            <div class="projects-filters">
                                <div class="filter-group" id="group-project-status">
                                    <button type="button" class="filter-button" id="btn-filter-project-status">
                                        <span data-i18n="projects.filters.status">Status</span> <span class="filter-count-badge" id="badge-project-status"></span> <span class="filter-arrow">&#x25BC;</span>
                                    </button>
                                    <div class="dropdown-panel">
                                        <div class="dropdown-section-title" data-i18n="projects.filters.statusTitle">Project Status</div>
                                        <ul class="dropdown-list">
                                            <li><label><input type="checkbox" value="planning" data-filter="project-status"> <span class="project-status-badge planning" data-i18n="projects.status.planning">PLANNING</span></label></li>
                                            <li><label><input type="checkbox" value="active" data-filter="project-status"> <span class="project-status-badge active" data-i18n="projects.status.active">ACTIVE</span></label></li>
                                            <li><label><input type="checkbox" value="completed" data-filter="project-status"> <span class="project-status-badge completed" data-i18n="projects.status.completed">COMPLETED</span></label></li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="filter-group" id="group-project-updated">
                                    <button type="button" class="filter-button" id="btn-filter-project-updated">
                                        <span data-i18n="projects.filters.updated">Updated</span> <span class="filter-count-badge" id="badge-project-updated"></span> <span class="filter-arrow">&#x25BC;</span>
                                    </button>
                                    <div class="dropdown-panel">
                                        <div class="dropdown-section-title" data-i18n="projects.filters.updatedTitle">Recently Updated</div>
                                        <ul class="dropdown-list">
                                            <li><label><input type="radio" name="project-updated-filter" value="all" data-filter="project-updated"> <span data-i18n="projects.filters.all">All</span></label></li>
                                            <li><label><input type="radio" name="project-updated-filter" value="5m" data-filter="project-updated"> <span data-i18n="projects.filters.last5m">Last 5 minutes</span></label></li>
                                            <li><label><input type="radio" name="project-updated-filter" value="30m" data-filter="project-updated"> <span data-i18n="projects.filters.last30m">Last 30 minutes</span></label></li>
                                            <li><label><input type="radio" name="project-updated-filter" value="24h" data-filter="project-updated"> <span data-i18n="projects.filters.last24h">Last 24 hours</span></label></li>
                                            <li><label><input type="radio" name="project-updated-filter" value="week" data-filter="project-updated"> <span data-i18n="projects.filters.lastWeek">Last week</span></label></li>
                                            <li><label><input type="radio" name="project-updated-filter" value="month" data-filter="project-updated"> <span data-i18n="projects.filters.lastMonth">Last month</span></label></li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="filter-group" id="group-project-tags">
                                    <button type="button" class="filter-button" id="btn-filter-project-tags">
                                        <span data-i18n="projects.filters.tags">Tags</span> <span class="filter-count-badge" id="badge-project-tags"></span> <span class="filter-arrow">&#x25BC;</span>
                                    </button>
                                    <div class="dropdown-panel">
                                        <div class="dropdown-section-title" data-i18n="projects.filters.tagsTitle">Project Tags</div>
                                        <ul class="dropdown-list" id="project-tags-options"></ul>
                                    </div>
                                </div>

                                <button class="pf-chip" data-filter="has-tasks" data-i18n="projects.filters.hasTasks">Has tasks</button>
                                <button class="pf-chip" data-filter="no-tasks" data-i18n="projects.filters.noTasks">No tasks</button>
                                <button type="button" class="btn-clear-filters" id="btn-clear-projects" style="display:none;">
    <span class="filter-icon">x</span>
    <span data-i18n="projects.filters.clear">Clear Filters</span>
</button>
                            </div>
                        </div>

                        <div class="active-filters" id="projects-active-filters"></div>

                        <div class="projects-sort-standalone">
                            <button type="button" id="projects-sort-btn" class="sort-btn" aria-haspopup="true" aria-expanded="false">
                                <span class="sort-icon">‚áÖ</span>
                                <span id="projects-sort-label" data-i18n="projects.sort.label">Sort: Status</span>
                                <span class="sort-label-arrow" aria-hidden="true"></span>
                            </button>
                            <div class="projects-sort-panel dropdown-panel" id="projects-sort-panel" role="menu" aria-hidden="true">
                                <ul class="dropdown-list">
                                    <li><button type="button" class="projects-sort-option" data-sort="default" data-i18n="projects.sort.status">Status</button></li>
                                    <li><button type="button" class="projects-sort-option" data-sort="name" data-i18n="projects.sort.name">Name</button></li>
                                    <li><button type="button" class="projects-sort-option" data-sort="created-desc" data-i18n="projects.sort.newest">Newest</button></li>
                                    <li><button type="button" class="projects-sort-option" data-sort="updated-desc" data-i18n="projects.sort.lastUpdated">Last Updated</button></li>
                                    <li><button type="button" class="projects-sort-option" data-sort="tasks-desc" data-i18n="projects.sort.mostTasks">Most tasks</button></li>
                                    <li><button type="button" class="projects-sort-option" data-sort="completion-desc" data-i18n="projects.sort.percentCompleted">% Completed</button></li>
                                </ul>
                            </div>
                        </div>

                        <div class="projects-right">
                            <button class="add-btn" data-action="openProjectModal" data-i18n="projects.newProjectButton">+ New Project</button>
                        </div>
                    </div>
                    <div class="project-list-container">
                        <div class="project-list" id="projects-list"></div>
                        <!-- Mobile Projects (shown on mobile ‚â§ 768px) -->
                        <div class="projects-list-mobile" id="projects-list-mobile"></div>
                    </div>
                </div>
            </div>

            <div class="project-details-view" id="project-details">
                <div class="page-content" style="padding-top: 24px;">
                    <div class="project-details-container" id="project-details-content"></div>
                </div>
            </div>

            <div class="page" id="tasks">
                <div class="page-header">
                    <div>
                        <h1 class="page-title" data-i18n="tasks.title">All Tasks</h1>
                        <p class="page-subtitle" data-i18n="tasks.subtitle">Manage tasks across all projects</p>
                    </div>
                </div>
                
                <div class="page-content">
                    <div id="global-filters">
                        <div class="filters-toolbar">
                            <input id="filter-search" class="filter-input" type="text" placeholder="üîç Search tasks (title or description)" data-i18n="tasks.searchPlaceholder" data-i18n-attr="placeholder">

                            <div class="filter-group" id="group-status">
                                <button type="button" class="filter-button" id="btn-filter-status">
                                    <span data-i18n="tasks.filters.status">Status</span> <span class="filter-count-badge" id="badge-status"></span> <span class="filter-arrow">&#x25BC;</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title" data-i18n="tasks.filters.statusTitle">Status</div>
                                    <ul class="dropdown-list">
                                        <li><label><input type="checkbox" value="backlog" data-filter="status"> <span class="dot backlog"></span> <span data-i18n="tasks.status.backlog">Backlog</span></label></li>
                                        <li><label><input type="checkbox" value="todo" data-filter="status"> <span class="dot todo"></span> <span data-i18n="tasks.status.todo">To Do</span></label></li>
                                        <li><label><input type="checkbox" value="progress" data-filter="status"> <span class="dot progress"></span> <span data-i18n="tasks.status.progress">In Progress</span></label></li>
                                        <li id="filter-status-review"><label><input type="checkbox" value="review" data-filter="status"> <span class="dot review"></span> <span data-i18n="tasks.status.review">In Review</span></label></li>
                                        <li><label><input type="checkbox" value="done" data-filter="status"> <span class="dot done"></span> <span data-i18n="tasks.status.done">Done</span></label></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-tags">
                                <button type="button" class="filter-button" id="btn-filter-tags">
                                    <span data-i18n="tasks.filters.tags">Tags</span> <span class="filter-count-badge" id="badge-tags"></span> <span class="filter-arrow">&#x25BC;</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title" data-i18n="tasks.filters.tagsTitle">Tags</div>
                                    <ul class="dropdown-list" id="tag-options"></ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-priority">
                                <button type="button" class="filter-button" id="btn-filter-priority">
                                    <span data-i18n="tasks.filters.priority">Priority</span> <span class="filter-count-badge" id="badge-priority"></span> <span class="filter-arrow">&#x25BC;</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title" data-i18n="tasks.filters.priorityTitle">Priority</div>
                                    <ul class="dropdown-list">
                                        <li><label><input type="checkbox" value="high" data-filter="priority"> <span class="priority-dot high"></span> <span data-i18n="tasks.priority.high">High</span></label></li>
                                        <li><label><input type="checkbox" value="medium" data-filter="priority"> <span class="priority-dot medium"></span> <span data-i18n="tasks.priority.medium">Medium</span></label></li>
                                        <li><label><input type="checkbox" value="low" data-filter="priority"> <span class="priority-dot low"></span> <span data-i18n="tasks.priority.low">Low</span></label></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-project">
                                <button type="button" class="filter-button" id="btn-filter-project">
                                    <span data-i18n="tasks.filters.project">Project</span> <span class="filter-count-badge" id="badge-project"></span> <span class="filter-arrow">&#x25BC;</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title" data-i18n="tasks.filters.projectTitle">Project</div>
                                    <ul class="dropdown-list">
                                        <li class="select-all-row">
                                            <label>
                                                <input type="checkbox" id="project-select-all">
                                                <strong data-i18n="tasks.filters.selectAll">Select / Unselect All</strong>
                                            </label>
                                        </li>
                                    </ul>
                                    <ul class="dropdown-list" id="project-options"></ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-start-date">
                                <button type="button" class="filter-button" id="btn-filter-start-date">
                                    <span data-i18n="tasks.filters.startDate">Start Date</span> <span class="filter-count-badge" id="badge-start-date"></span> <span class="filter-arrow">&#x25BC;</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title" data-i18n="tasks.filters.startDateTitle">Start Date Filters</div>
                                    <ul class="dropdown-list">
                                        <li><label><input type="checkbox" value="no-start-date" data-filter="date-preset" data-preset-value="no-start-date"> <span data-i18n="tasks.filters.noStartDate">No Start Date</span></label></li>
                                        <li><label><input type="checkbox" value="already-started" data-filter="date-preset" data-preset-value="already-started"> <span data-i18n="tasks.filters.alreadyStarted">Already Started</span></label></li>
                                        <li><label><input type="checkbox" value="start-today" data-filter="date-preset" data-preset-value="start-today"> <span data-i18n="tasks.filters.startToday">Start Date Today</span></label></li>
                                        <li><label><input type="checkbox" value="start-tomorrow" data-filter="date-preset" data-preset-value="start-tomorrow"> <span data-i18n="tasks.filters.startTomorrow">Start Date Tomorrow</span></label></li>
                                        <li><label><input type="checkbox" value="start-7days" data-filter="date-preset" data-preset-value="start-7days"> <span data-i18n="tasks.filters.start7Days">Start Date in 7 Days</span></label></li>
                                        <li><label><input type="checkbox" value="start-week" data-filter="date-preset" data-preset-value="start-week"> <span data-i18n="tasks.filters.startThisWeek">Start Date This Week</span></label></li>
                                        <li><label><input type="checkbox" value="start-month" data-filter="date-preset" data-preset-value="start-month"> <span data-i18n="tasks.filters.startThisMonth">Start Date This Month</span></label></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-end-date">
                                <button type="button" class="filter-button" id="btn-filter-end-date">
                                    <span data-i18n="tasks.filters.endDate">End Date</span> <span class="filter-count-badge" id="badge-end-date"></span> <span class="filter-arrow">&#x25BC;</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title" data-i18n="tasks.filters.endDateTitle">End Date Filters</div>
                                    <ul class="dropdown-list">
                                        <li><label><input type="checkbox" value="no-date" data-filter="date-preset" data-preset-value="no-date"> <span data-i18n="tasks.filters.noDate">No End Date</span></label></li>
                                        <li><label><input type="checkbox" value="overdue" data-filter="date-preset" data-preset-value="overdue"> <span data-i18n="tasks.filters.overdue">Overdue</span></label></li>
                                        <li><label><input type="checkbox" value="end-today" data-filter="date-preset" data-preset-value="end-today"> <span data-i18n="tasks.filters.endToday">End Date Today</span></label></li>
                                        <li><label><input type="checkbox" value="end-tomorrow" data-filter="date-preset" data-preset-value="end-tomorrow"> <span data-i18n="tasks.filters.endTomorrow">End Date Tomorrow</span></label></li>
                                        <li><label><input type="checkbox" value="end-7days" data-filter="date-preset" data-preset-value="end-7days"> <span data-i18n="tasks.filters.end7Days">End Date in 7 Days</span></label></li>
                                        <li><label><input type="checkbox" value="end-week" data-filter="date-preset" data-preset-value="end-week"> <span data-i18n="tasks.filters.endThisWeek">End Date This Week</span></label></li>
                                        <li><label><input type="checkbox" value="end-month" data-filter="date-preset" data-preset-value="end-month"> <span data-i18n="tasks.filters.endThisMonth">End Date This Month</span></label></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-kanban-updated" style="display:none">
                                <button type="button" class="filter-button" id="btn-filter-kanban-updated">
                                    <span data-i18n="tasks.filters.updated">Updated</span> <span class="filter-count-badge" id="badge-kanban-updated"></span> <span class="filter-arrow">&#x25BC;</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title" data-i18n="tasks.filters.updatedTitle">Recently Updated</div>
                                    <ul class="dropdown-list">
                                        <li><label><input type="radio" name="kanban-updated-filter" value="all" data-filter="kanban-updated"> <span data-i18n="projects.filters.all">All</span></label></li>
                                        <li><label><input type="radio" name="kanban-updated-filter" value="5m" data-filter="kanban-updated"> <span data-i18n="projects.filters.last5m">Last 5 minutes</span></label></li>
                                        <li><label><input type="radio" name="kanban-updated-filter" value="30m" data-filter="kanban-updated"> <span data-i18n="projects.filters.last30m">Last 30 minutes</span></label></li>
                                        <li><label><input type="radio" name="kanban-updated-filter" value="24h" data-filter="kanban-updated"> <span data-i18n="projects.filters.last24h">Last 24 hours</span></label></li>
                                        <li><label><input type="radio" name="kanban-updated-filter" value="week" data-filter="kanban-updated"> <span data-i18n="projects.filters.lastWeek">Last week</span></label></li>
                                        <li><label><input type="radio" name="kanban-updated-filter" value="month" data-filter="kanban-updated"> <span data-i18n="projects.filters.lastMonth">Last month</span></label></li>
                                    </ul>
                                </div>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="date" id="filter-date-from" class="filter-input" placeholder="Start date" data-placeholder="Start date" data-i18n="tasks.filters.dateFrom" data-i18n-attr="placeholder,data-placeholder" style="min-width: 140px;">
                                <input type="date" id="filter-date-to" class="filter-input" placeholder="End date" data-placeholder="End date" data-i18n="tasks.filters.dateTo" data-i18n-attr="placeholder,data-placeholder" style="min-width: 140px;">
                            </div>
                            
                            <button type="button" class="btn-clear-filters" id="btn-clear-filters" style="display:none">
    <span class="filter-icon">x</span>
    <span data-i18n="tasks.filters.clear">Clear Filters</span>
</button>
                        </div>

                        <div class="active-filters" id="active-filters"></div>
                    </div>

                <!-- Kanban tip temporarily hidden
                <div id="kanban-tip" class="info-banner" style="display: flex; align-items: center; gap: 10px; padding: 12px 16px; background: rgba(59, 130, 246, 0.1); border: 1px solid var(--accent-blue); border-radius: 8px; margin-bottom: 16px; font-size: 14px;">
                    <span style="color: var(--accent-blue);">üí°</span>
                    <span style="flex: 1; color: var(--text-secondary);">
                        <strong data-i18n="tasks.kanban.tipLabel">Tip:</strong> <span data-i18n="tasks.kanban.tipTextBefore">In the Kanban Board hold </span><kbd style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px; font-size: 12px;">Ctrl</kbd><span data-i18n="tasks.kanban.tipTextAfter"> and click to select multiple tasks, then drag to move them together</span>
                    </span>
                    <button data-action="dismissKanbanTip" style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 16px;">‚úï</button>
                </div>
                -->

                    <div class="kanban-header">
                        <div style="display: flex; gap: 16px; align-items: center;">
                            <div class="view-toggle">
                                <button class="view-btn active" data-view="kanban" data-i18n="tasks.view.kanban">Kanban</button>
                                <button class="view-btn" data-view="list" data-i18n="tasks.view.list">List</button>
                                <button class="view-btn" data-view="calendar" data-i18n="tasks.view.calendar">Calendar</button>
                            </div>
                            <div class="sort-toggle" id="sort-toggle" style="display: none;">
                                <button class="sort-btn" id="sort-btn" data-action="toggleSortMode">
                                    <span id="sort-icon">‚¨ÜÔ∏è</span>
                                    <span id="sort-label" data-i18n="tasks.sort.label">Sort: Priority</span>
                                </button>
                            </div>
                            <div class="calendar-stage">
                                <button id="kanban-settings-btn" data-action="toggleKanbanSettings" style="background: none; border: none; padding: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); border-radius: 4px; transition: all 0.2s;">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="4" y1="21" x2="4" y2="14"></line>
                                        <line x1="4" y1="10" x2="4" y2="3"></line>
                                        <line x1="12" y1="21" x2="12" y2="12"></line>
                                        <line x1="12" y1="8" x2="12" y2="3"></line>
                                        <line x1="20" y1="21" x2="20" y2="16"></line>
                                        <line x1="20" y1="12" x2="20" y2="3"></line>
                                        <line x1="1" y1="14" x2="7" y2="14"></line>
                                        <line x1="9" y1="8" x2="15" y2="8"></line>
                                        <line x1="17" y1="16" x2="23" y2="16"></line>
                                    </svg>
                                </button>
                                <!-- Kanban Settings Dropdown -->
                                <div id="kanban-settings-panel" class="user-dropdown">
                                    <label class="dropdown-item" style="cursor: pointer; user-select: none;">
                                        <input type="checkbox" id="kanban-show-backlog" onchange="toggleKanbanBacklog()" style="cursor: pointer; width: 16px; height: 16px; margin: 0;">
                                        <span data-i18n="tasks.kanban.showBacklog">Show Backlog</span>
                                    </label>
                                    <label class="dropdown-item" style="cursor: pointer; user-select: none;">
                                        <input type="checkbox" id="kanban-show-projects" onchange="toggleKanbanProjects()" checked style="cursor: pointer; width: 16px; height: 16px; margin: 0;">
                                        <span data-i18n="tasks.kanban.showProjects">Show Projects</span>
                                    </label>
                                    <label class="dropdown-item" style="cursor: pointer; user-select: none;">
                                        <input type="checkbox" id="kanban-show-no-date" onchange="toggleKanbanNoDate()" checked style="cursor: pointer; width: 16px; height: 16px; margin: 0;">
                                        <span data-i18n="tasks.kanban.showNoDate">Show "No Date"</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <button class="add-btn" data-action="openTaskModal" data-i18n="tasks.addButton">+ Add Task</button>
                    </div>
                    
                    <div class="kanban-board">
                        <div class="kanban-column" id="kanban-column-backlog" style="display: none;">
                            <div class="column-header">
                                <div class="column-title" data-i18n="tasks.kanban.columnBacklog">&#x1F9CA; Backlog</div>
                                <span class="column-count" id="backlog-count">0</span>
                            </div>
                            <div id="backlog-tasks"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title" data-i18n="tasks.kanban.columnTodo">&#x1F4CB; To Do</div>
                                <span class="column-count" id="todo-count">0</span>
                            </div>
                            <div id="todo-tasks"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title" data-i18n="tasks.kanban.columnProgress">&#x1F504; In Progress</div>
                                <span class="column-count" id="progress-count">0</span>
                            </div>
                            <div id="progress-tasks"></div>
                        </div>
                        <div class="kanban-column" id="kanban-column-review">
                            <div class="column-header">
                                <div class="column-title" data-i18n="tasks.kanban.columnReview">&#x2611;&#xFE0F; In Review</div>
                                <span class="column-count" id="review-count">0</span>
                            </div>
                            <div id="review-tasks"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title" data-i18n="tasks.kanban.columnDone">&#x2705; Done</div>
                                <span class="column-count" id="done-count">0</span>
                            </div>
                            <div id="done-tasks"></div>
                        </div>
                    </div>
                    
                    <div class="list-view" id="list-view">
                        <div class="tasks-list-meta">
                            <span class="tasks-list-count" id="tasks-list-count">0 results</span>
                        </div>
                        <table class="tasks-table">
                            <thead>
                                <tr>
                                    <th data-action="sortTable" data-param="title" style="cursor: pointer;"><span data-i18n="tasks.table.task">Task</span> <span id="sort-title" class="sort-indicator">&#x2195;</span></th>
                                    <th data-action="sortTable" data-param="priority" style="cursor: pointer;"><span data-i18n="tasks.table.priority">Priority</span> <span id="sort-priority" class="sort-indicator">&#x2195;</span></th>
                                    <th data-action="sortTable" data-param="status" style="cursor: pointer;"><span data-i18n="tasks.table.status">Status</span> <span id="sort-status" class="sort-indicator">&#x2195;</span></th>
                                    <th data-i18n="tasks.table.tags">Tags</th>
                                    <th data-action="sortTable" data-param="project" style="cursor: pointer;"><span data-i18n="tasks.table.project">Project</span> <span id="sort-project" class="sort-indicator">&#x2195;</span></th>
                                    <th data-action="sortTable" data-param="startDate" style="cursor: pointer;"><span data-i18n="tasks.table.startDate">Start Date</span> <span id="sort-startDate" class="sort-indicator">&#x2195;</span></th>
                                    <th data-action="sortTable" data-param="endDate" style="cursor: pointer;"><span data-i18n="tasks.table.endDate">End Date</span> <span id="sort-endDate" class="sort-indicator">&#x2195;</span></th>
                                    <th data-action="sortTable" data-param="updatedAt" style="cursor: pointer;"><span data-i18n="tasks.table.updated">Updated</span> <span id="sort-updatedAt" class="sort-indicator">&#x2195;</span></th>
                                </tr>
                            </thead>
                            <tbody id="tasks-table-body"></tbody>
                        </table>
                        <div class="tasks-list-meta tasks-list-meta--bottom">
                            <span class="tasks-list-count" id="tasks-list-count-bottom">0 results</span>
                        </div>

                        <!-- Premium Mobile Cards (shown on mobile ‚â§ 768px) -->
                        <div class="tasks-list-mobile" id="tasks-list-mobile"></div>
                    </div>

                    <div class="calendar-view" id="calendar-view">
                        <div class="page-header">
                            <div>
                                <h1 class="page-title" data-i18n="calendar.title">Calendar</h1>
                            </div>
                            <button class="calendar-today-btn calendar-today-btn--header" data-action="goToToday" data-i18n="calendar.today">Today</button>
                        </div>
                        <div class="calendar-container">
                            <div class="calendar-header">
                                <div class="calendar-nav">
                                    <button data-action="changeMonth" data-param="-1" class="calendar-nav-btn" aria-label="Previous month" data-i18n="calendar.prevMonth" data-i18n-attr="aria-label">
                                        <svg class="calendar-nav-icon" viewBox="0 0 24 24" aria-hidden="true">
                                            <path d="M15 6l-6 6 6 6"></path>
                                        </svg>
                                    </button>
                                    <span class="calendar-month-year" id="calendar-month-year">January 2024</span>
                                    <button data-action="changeMonth" data-param="1" class="calendar-nav-btn" aria-label="Next month" data-i18n="calendar.nextMonth" data-i18n-attr="aria-label">
                                        <svg class="calendar-nav-icon" viewBox="0 0 24 24" aria-hidden="true">
                                            <path d="M9 6l6 6-6 6"></path>
                                        </svg>
                                    </button>
                                </div>
                                <button class="calendar-today-btn calendar-today-btn--nav" data-action="goToToday" data-i18n="calendar.today">Today</button>
                            </div>
                            <div style="position: relative;">
                                <div class="calendar-grid" id="calendar-grid"></div>
                                <div class="project-overlay" id="project-overlay"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Floating Action Button (Mobile Calendar Only) -->
                    <button class="fab-calendar"
                            data-action="openModal"
                            data-param="task-modal"
                            aria-label="Add Task" data-i18n="tasks.addButton" data-i18n-attr="aria-label">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="page" id="updates">
                <div class="page-header">
                    <div>
                        <h1 class="page-title" data-i18n="updates.title">Release notes</h1>
                        <p class="page-subtitle" data-i18n="updates.subtitle">Latest change log for Nautilus</p>
                    </div>
                </div>
                <div class="page-content">
                    <div id="updates-content" aria-live="polite"></div>
                </div>
            </div>

            <div class="page" id="feedback">
                <div class="page-header">
                    <div>
                        <h1 class="page-title" data-i18n="feedback.title">Feedback & Issues</h1>
                        <div class="feedback-subtitle-row">
                            <p class="page-subtitle" data-i18n="feedback.subtitle">Report bugs and suggest features</p>
                            <div id="feedback-save-status" class="feedback-save-status is-hidden" aria-live="polite">
                                <span class="feedback-save-indicator" aria-hidden="true"></span>
                                <span class="feedback-save-text"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="page-content">
                   <div class="feedback-input-bar">
                        <div class="filter-group" id="feedback-type-group">
                            <button type="button" class="filter-button" id="feedback-type-btn">
                                <span id="feedback-type-label" data-i18n="feedback.type.bugLabel">üêû Bug</span> <span class="filter-arrow">&#x25BC;</span>
                            </button>
                            <div class="dropdown-panel">
                                <div class="dropdown-section-title" data-i18n="feedback.type.title">Feedback Type</div>
                                <ul class="dropdown-list">
                                    <li><label><input type="radio" name="feedback-type" value="bug" checked> <span data-i18n="feedback.type.bugOption">üêû Bug</span></label></li>
                                    <li><label><input type="radio" name="feedback-type" value="idea"> <span data-i18n="feedback.type.improvementOption">üí° Improvement</span></label></li>
                                </ul>
                            </div>
                        </div>
                        <input type="text" id="feedback-description" class="feedback-input" placeholder="Describe the issue or idea. You can paste an image directly into this field." data-i18n="feedback.descriptionPlaceholder" data-i18n-attr="placeholder">
                        <span class="camera-divider">üì∑</span>
                        <div
                            id="feedback-screenshot-url"
                            class="feedback-input feedback-screenshot-dropzone"
                            style="flex: 0 0 340px;"
                            role="button"
                            tabindex="0"
                        ></div>
                        <input
                            type="file"
                            id="feedback-screenshot-file"
                            accept="image/*"
                            style="display: none;"
                        >
                        <button
                            type="button"
                            id="feedback-screenshot-upload"
                            class="screenshot-upload-link"
                            title="Attach screenshot from device" data-i18n="feedback.screenshotAttachTitle" data-i18n-attr="title"
                        >
                            üì∑
                        </button>
                        <button class="add-btn" data-action="addFeedbackItem" data-i18n="feedback.addButton">Add</button>
                    </div>
                    
                    <div style="margin-top: 32px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <h3 style="font-size: 16px; font-weight: 600; color: var(--text-secondary);">‚è≥ Pending</h3>
                        </div>
                        <div style="height: 1px; background: var(--border); margin-bottom: 16px;"></div>
                        <div id="feedback-list-pending"></div>
                        <div id="feedback-pagination-pending" class="feedback-pagination"></div>
                    </div>

                    <div style="margin-top: 32px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <h3 style="font-size: 16px; font-weight: 600; color: var(--text-muted);">‚úÖ Done</h3>
                        </div>
                        <div style="height: 1px; background: var(--border); margin-bottom: 16px;"></div>
                        <div id="feedback-list-done"></div>
                        <div id="feedback-pagination-done" class="feedback-pagination"></div>
                    </div>
                </div>
            </div>
    </div>

    <!-- Modals - Outside of all pages -->
    <div id="project-modal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title" data-i18n="projects.modal.createTitle">Create New Project</h2>
            <form id="project-form">
                <div class="form-group">
                    <label class="form-label" data-i18n="projects.modal.nameLabel">Project Name</label>
                    <input type="text" class="form-input" name="name" required>
                </div>
                <div class="form-group">
                    <label class="form-label" data-i18n="projects.modal.descriptionLabel">Description</label>
                    <textarea class="form-textarea" name="description"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" data-i18n="projects.modal.startDateLabel">Start Date</label>
                    <input type="date" class="form-input" name="startDate">
                </div>
                <div class="form-group">
                    <label class="form-label" data-i18n="projects.modal.endDateLabel">End Date</label>
                    <input type="date" class="form-input" name="endDate">
                </div>
                <div class="form-group">
                    <label class="form-label" data-i18n="projects.modal.tagsLabel">Tags</label>
                    <div id="project-tags-display" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; min-height: 28px;"></div>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="project-tag-input" class="form-input" placeholder="Add tag" data-i18n="projects.modal.addTagPlaceholder" data-i18n-attr="placeholder" style="flex: 1;">
                        <button type="button" class="btn-secondary" data-action="addProjectTag">+</button>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" data-action="closeModal" data-param="project-modal" data-i18n="common.cancel">Cancel</button>
                    <button type="submit" class="btn-primary" data-i18n="projects.modal.createButton">Create Project</button>
                </div>
            </form>
        </div>
    </div>

 <div id="task-modal" class="modal">
  <div class="modal-content">

    <!-- header -->
    <div class="modal-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-shrink:0;">
      <div style="display:flex;align-items:center;gap:12px;">
        <button type="button" id="task-nav-prev" class="task-nav-btn" aria-label="Previous task" style="display:none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="15 18 9 12 15 6"></polyline>
          </svg>
        </button>
        <h2 style="font-size:20px;font-weight:600;margin:0;" data-i18n="tasks.modal.editTitle">Edit Task</h2>
        <button type="button" id="task-nav-next" class="task-nav-btn" aria-label="Next task" style="display:none;">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
        </button>
      </div>
      <div class="header-actions" style="display:flex;gap:8px;align-items:center;position:relative;">
        <button type="button" class="options-btn" id="task-options-btn"
                style="background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:20px;padding:4px;line-height:1;">‚ãØ</button>
        <button type="button" class="modal-close" data-action="closeTaskModal"
                style="background:none;border:none;font-size:20px;cursor:pointer;">‚ùå</button>

        <!-- options menu appears under the 3 dots -->
    <div class="options-menu" id="options-menu" style="position:absolute;top:calc(100% + 8px);right:28px;display:none;">
      <button type="button" data-action="duplicateTask"
          style="width: 100%; padding: 8px 16px; background: none; border: none; color: var(--text-secondary); cursor: pointer; text-align: left; font-size: 14px;" data-i18n="tasks.modal.duplicate">üìÑ Duplicate Task</button>
      <div style="height: 1px; background: var(--border); margin: 4px 0;"></div>
      <button type="button" class="delete-btn" data-action="deleteTask" data-i18n="tasks.modal.delete">üóëÔ∏è Delete Task</button>
    </div>
      </div>
    </div>

    <!-- Modal Tabs -->
    <div class="modal-tabs">
      <!-- Desktop: Shows "General" and "History" -->
      <!-- Mobile: Shows "General", "Details", and "History" -->
      <button class="modal-tab active" data-tab="general" data-i18n="tasks.modal.tab.general">General</button>
      <button class="modal-tab modal-tab-mobile" data-tab="details" data-i18n="tasks.modal.tab.details">Details</button>
      <button class="modal-tab" data-tab="history" data-i18n="tasks.modal.tab.history">History</button>
    </div>

    <!-- General Tab Content (Desktop) / General + Details Tabs (Mobile) -->
    <!-- On desktop: shows all fields in two-column layout -->
    <!-- On mobile: same content but fields shown/hidden based on active tab -->
    <div class="modal-tab-content active" id="task-details-tab" data-mobile-tabs="general,details">
    <form id="task-form">
      <div class="modal-body">
        <!-- LEFT COLUMN -->
        <div class="modal-left">
          <!-- Title: General tab on mobile -->
          <div class="form-group mobile-general-field">
            <label class="form-label" data-i18n="tasks.modal.titleLabel">Task Title</label>
         <input type="text" class="form-input" name="title" required>
          </div>

        <!-- File Attachments: General tab on mobile -->
        <div class="form-group mobile-general-field">
            <label data-i18n="tasks.modal.attachmentsLabel">Attachments</label>
            <div id="attachments-files-list"></div>

            <!-- File Upload -->
            <div id="attachment-file-dropzone" class="form-input task-attachment-dropzone" style="margin-top: 8px;" role="button" tabindex="0"></div>
            <input type="file" id="attachment-file" style="display: none;">

            <div style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
                <span data-i18n="tasks.modal.attachmentsSupported">Supported: Images (10MB), PDFs (20MB), Documents (10MB)</span>
            </div>
        </div>

        <!-- URL Links: Details tab on mobile -->
        <div class="form-group mobile-details-field">
            <div style="margin: 0 0 8px; font-size: 12px; font-weight: 700; letter-spacing: 0.4px; color: var(--text-muted); text-transform: uppercase;" data-i18n="tasks.modal.linksLabel">Links</div>
            <div id="attachments-links-list"></div>

            <!-- URL Link -->
            <div style="display: flex; gap: 8px; margin-top: 8px;">
                <input type="text" id="attachment-name" class="form-input" placeholder="Name (optional)" data-i18n="tasks.modal.attachmentNamePlaceholder" data-i18n-attr="placeholder" style="flex: 1.6;">
                <input type="text" id="attachment-url" class="form-input" placeholder="URL" data-i18n="tasks.modal.attachmentUrlPlaceholder" data-i18n-attr="placeholder" style="flex: 1.4;">
                <button type="button" class="btn-secondary" data-action="addAttachment" data-i18n="tasks.modal.addLink">Add Link</button>
            </div>
        </div>

          <!-- Description: General tab on mobile -->
          <div class="form-group mobile-general-field">
            <label class="form-label" data-i18n="projects.modal.descriptionLabel">Description</label>
            <div class="rich-editor">
              <div class="editor-toolbar">
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="bold"><strong>B</strong></button>
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="italic"><em>I</em></button>
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="underline"><u>U</u></button>
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="strikeThrough"><span style="text-decoration: line-through;">S</span></button>
                <span style="width:1px;height:20px;background:var(--border);margin:0 4px;"></span>
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="insertUnorderedList" data-i18n="tasks.modal.listBulleted">‚Ä¢ List</button>
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="insertOrderedList" data-i18n="tasks.modal.listNumbered">1. List</button>
                <span style="width:1px;height:20px;background:var(--border);margin:0 4px;"></span>
                <button type="button" class="editor-btn" data-action="insertTaskHeading" data-param="h1">H1</button>
                <button type="button" class="editor-btn" data-action="insertTaskHeading" data-param="h2">H2</button>
                <button type="button" class="editor-btn" data-action="insertTaskHeading" data-param="h3">H3</button>
<button type="button" class="editor-btn" data-action="insertTaskDivider" title="Insert horizontal divider" data-i18n="tasks.modal.insertDivider" data-i18n-attr="title">‚îÄ</button>
                                <!-- Checklist button: inserts an empty checkbox row -->
                                <button type="button" class="editor-btn" id="checklist-btn" title="Insert checkbox" data-i18n="tasks.modal.insertCheckbox" data-i18n-attr="title">‚òë</button>
              </div>
            <div class="editor-content" contenteditable="true" id="task-description-editor"></div>
            </div>
            <textarea name="description" id="task-description-hidden" style="display:none;"></textarea>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="modal-right">

          <!-- Status: General tab on mobile -->
          <div class="form-group mobile-general-field" style="position:relative;">
            <label class="form-label" data-i18n="tasks.modal.statusLabel">Status</label>
            <div class="status-dropdown">
              <button type="button" class="status-current" id="status-current">
                <span class="status-badge backlog" data-i18n="tasks.status.backlog">Backlog</span>
                <span class="dropdown-arrow">‚ñº</span>
              </button>
              <div class="status-options" id="status-options">
                <!-- no inline onclick; handled by delegated JS -->
                <div class="status-option" data-status="todo">
                  <span class="status-badge todo" data-i18n="tasks.status.todo">To Do</span>
                </div>
                <div class="status-option" data-status="progress">
                  <span class="status-badge progress" data-i18n="tasks.status.progress">In Progress</span>
                </div>
                <div class="status-option" data-status="review">
                  <span class="status-badge review" data-i18n="tasks.status.review">In Review</span>
                </div>
                <div class="status-option" data-status="done">
                  <span class="status-badge done" data-i18n="tasks.status.done">Done</span>
                </div>
                <div class="status-option" data-status="backlog">
                  <span class="status-badge backlog" data-i18n="tasks.status.backlog">Backlog</span>
                </div>
              </div>
            </div>
            <input type="hidden" name="status" id="hidden-status" value="backlog">
          </div>

          <!-- Priority: General tab on mobile -->
          <div class="form-group mobile-general-field">
            <label class="form-label" data-i18n="tasks.modal.priorityLabel">Priority</label>
            <div class="priority-dropdown">
              <button type="button" class="priority-current" id="priority-current">
                <span class="priority-dot medium"></span> <span data-i18n="tasks.priority.medium">Medium</span>
                <span class="dropdown-arrow">‚ñº</span>
              </button>
              <div class="priority-options" id="priority-options">
                <div class="priority-option" data-priority="low">
                  <span class="priority-dot low"></span> <span data-i18n="tasks.priority.low">Low</span>
                </div>
                <div class="priority-option" data-priority="medium">
                  <span class="priority-dot medium"></span> <span data-i18n="tasks.priority.medium">Medium</span>
                </div>
                <div class="priority-option" data-priority="high">
                  <span class="priority-dot high"></span> <span data-i18n="tasks.priority.high">High</span>
                </div>
              </div>
            </div>
            <input type="hidden" name="priority" id="hidden-priority" value="medium">
          </div>

        <!-- Tags: Details tab on mobile -->
        <div class="form-group mobile-details-field">
            <label class="form-label" data-i18n="tasks.modal.tagsLabel">Tags</label>
            <div id="tags-display" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; min-height: 28px;"></div>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="tag-input" class="form-input" placeholder="Add tag" data-i18n="tasks.modal.addTagPlaceholder" data-i18n-attr="placeholder" style="flex: 1;">
                <button type="button" class="btn-secondary" data-action="addTag">+</button>
            </div>
        </div>


          <!-- Start Date: Details tab on mobile -->
          <div class="form-group mobile-details-field">
            <label class="form-label" data-i18n="projects.modal.startDateLabel">Start Date</label>
            <input type="date" class="form-input" name="startDate">
          </div>

          <!-- End Date: Details tab on mobile -->
          <div class="form-group mobile-details-field">
            <label class="form-label" data-i18n="projects.modal.endDateLabel">End Date</label>
            <input type="date" class="form-input" name="endDate">
          </div>

          <!-- Project: General tab on mobile -->
          <div class="form-group mobile-general-field" style="position:relative;">
            <div style="flex:1 1 auto; min-width:0;">
              <div class="task-project-label-row">
                <label class="form-label" data-i18n="tasks.modal.projectLabel">Project</label>
                <button
                  type="button"
                  class="task-project-open-btn"
                  id="task-project-open-btn"
                  data-action="openSelectedProjectFromTask"
                  title="Open project details" data-i18n="tasks.modal.projectOpenTitle" data-i18n-attr="title"
                  style="display:none;"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </button>
              </div>
            <div class="project-dropdown">
              <button type="button" class="project-current" id="project-current">
                <span class="project-text" data-i18n="tasks.modal.projectSelect">Select a project</span>
                <span class="dropdown-arrow">‚ñº</span>
              </button>
            </div>
            <input type="hidden" name="projectId" id="hidden-project" value="">
            </div>
          </div>

        </div><!-- /modal-right -->
      </div><!-- /modal-body -->

      <!-- Modal Footer (outside modal-body so it stays visible) -->
      <div class="modal-footer" id="task-footer">
        <button type="button" class="btn-secondary" id="task-cancel-btn" data-action="closeTaskModal" data-i18n="common.cancel">Cancel</button>
        <button type="submit" class="btn-primary" id="task-submit-btn" data-i18n="tasks.modal.submitCreate">Create Task</button>
      </div>
    </form>
    </div><!-- /task-details-tab -->

    <!-- History Tab Content -->
    <div class="modal-tab-content" id="task-history-tab">
      <div class="task-history-container">
        <div class="history-timeline-inline" id="task-history-timeline">
          <!-- Timeline will be populated by JavaScript -->
        </div>
        <div class="history-empty-inline" id="task-history-empty" style="display: none;">
          <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">üìú</div>
          <h3 style="color: var(--text-secondary); margin-bottom: 8px;" data-i18n="tasks.history.emptyTitle">No Changes Yet</h3>
          <p style="color: var(--text-muted);" data-i18n="tasks.history.emptySubtitle">Changes to this task will appear here</p>
        </div>
      </div>
    </div><!-- /task-history-tab -->

  </div>
</div>


    <div id="confirm-modal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-title" data-i18n="confirm.deleteTask.title">Delete Task</div>
            <p data-i18n="confirm.deleteTask.body">This action cannot be undone. To confirm deletion, type <strong>delete</strong> below:</p>
            <input type="text" id="confirm-input" class="confirm-input" placeholder="Type delete here" data-i18n="confirm.deleteTask.inputPlaceholder" data-i18n-attr="placeholder">
            <div class="confirm-error" id="confirm-error" data-i18n="confirm.deleteTask.error">Type "delete" exactly to confirm</div>
            <div class="confirm-actions">
                <button class="btn-secondary" data-action="closeConfirmModal" data-i18n="common.cancel">Cancel</button>
                <button class="btn-secondary" data-action="confirmDelete" style="background: var(--accent-red);" data-i18n="common.delete">Delete</button>
            </div>
        </div>
    </div>

    <div id="unsaved-changes-modal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-title" data-i18n="confirm.unsaved.title">Unsaved Changes</div>
            <p data-i18n="confirm.unsaved.body">You have unsaved changes. Are you sure you want to close and lose them?</p>
            <div class="confirm-actions">
                <button class="btn-secondary" data-action="closeUnsavedChangesModal" data-i18n="common.cancel">Cancel</button>
                <button class="btn-secondary" data-action="confirmDiscardChanges" style="background: var(--accent-red);" data-i18n="confirm.unsaved.discard">Discard Changes</button>
            </div>
        </div>
    </div>

    <div id="review-status-confirm-modal" class="confirm-modal">
        <div class="confirm-content" style="max-width: 540px;">
            <div class="confirm-title" data-i18n="confirm.review.title">Disable "In Review" Status</div>
            <div id="review-status-task-list" style="margin: 20px 0;"></div>
            <div class="confirm-actions">
                <button class="btn-secondary" data-action="closeReviewStatusConfirmModal" data-i18n="common.cancel">Cancel</button>
                <button class="btn-primary" data-action="confirmDisableReviewStatus" data-i18n="common.continue">Continue</button>
            </div>
        </div>
    </div>

    <div id="calendar-create-modal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-title">No Tasks or Projects</div>
            <p id="calendar-create-message">No tasks or projects for this date. Would you like to create a new task?</p>
            <div class="confirm-actions">
                <button class="btn-secondary" data-action="closeCalendarCreateModal">Cancel</button>
                <button class="btn-primary" data-action="confirmCreateTask">Create Task</button>
            </div>
        </div>
    </div>

    <div id="feedback-delete-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <h2 class="modal-title" data-i18n="feedback.delete.title">Delete Feedback</h2>
            <p style="color: var(--text-secondary); margin-bottom: 24px;" data-i18n="feedback.delete.body">Are you sure you want to delete this feedback?</p>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" data-action="closeFeedbackDeleteModal" data-i18n="common.cancel">Cancel</button>
                <button type="button" class="btn-primary" style="background: var(--accent-red);" data-action="confirmFeedbackDelete" data-i18n="common.delete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Export Data Confirmation Modal -->
    <div id="export-data-modal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <h2 class="modal-title" data-i18n="export.title">Export Data</h2>
            <p style="color: var(--text-secondary);" data-i18n="export.body">This will download a complete backup of all your tasks, projects, and settings as a JSON file. Are you sure you want to export your data?</p>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" data-action="closeExportDataModal" data-i18n="common.cancel">Cancel</button>
                <button type="button" class="btn-primary" data-action="confirmExportData" data-i18n="export.confirm">Export</button>
            </div>
        </div>
    </div>

    <div id="project-confirm-modal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-title" data-i18n="projects.delete.title">Delete Project</div>
            <p data-i18n="confirm.deleteTask.body">This action cannot be undone. To confirm deletion, type <strong>delete</strong> below:</p>
            <div style="margin: 16px 0; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="delete-tasks-checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="font-size: 14px; color: var(--text-secondary);" data-i18n="projects.delete.deleteTasksLabel">Delete all tasks in this project</span>
                </label>
                <p style="margin: 8px 0 0 26px; font-size: 12px; color: var(--text-muted);" data-i18n="projects.delete.deleteTasksHint">If unchecked, tasks will be unassigned from the project</p>
            </div>
            <input type="text" id="project-confirm-input" class="confirm-input" placeholder="Type delete here" data-i18n="projects.delete.inputPlaceholder" data-i18n-attr="placeholder">
            <div class="confirm-error" id="project-confirm-error" data-i18n="projects.delete.error">Type "delete" exactly to confirm</div>
            <div class="confirm-actions">
                <button class="btn-secondary" data-action="closeProjectConfirmModal" data-i18n="common.cancel">Cancel</button>
                <button class="btn-secondary" data-action="confirmProjectDelete" style="background: var(--accent-red);" data-i18n="common.delete">Delete</button>
            </div>
        </div>
    </div>

    <div id="project-duplicate-modal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-title" data-i18n="projects.duplicate.title">Duplicate Project</div>
            <p style="color: var(--text-secondary); margin-bottom: 16px;" data-i18n="projects.duplicate.description">Create a copy of this project with all its settings.</p>

            <div style="margin: 16px 0; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="duplicate-tasks-checkbox" checked style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="font-size: 14px; color: var(--text-secondary);" data-i18n="projects.duplicate.includeTasksLabel">Include all tasks from this project</span>
                </label>
            </div>

            <div id="task-naming-options" style="margin: 16px 0; padding: 12px; background: var(--bg-secondary); border-radius: 6px;">
                <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 12px; font-weight: 500;" data-i18n="projects.duplicate.taskNamingTitle">Task naming:</p>

                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-bottom: 8px;">
                    <input type="radio" name="task-naming" value="none" checked style="width: 16px; height: 16px; cursor: pointer;">
                    <span style="font-size: 13px; color: var(--text-secondary);" data-i18n="projects.duplicate.namingNone">Keep original names</span>
                </label>

                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-bottom: 8px;">
                    <input type="radio" name="task-naming" value="prefix" style="width: 16px; height: 16px; cursor: pointer;">
                    <span style="font-size: 13px; color: var(--text-secondary);" data-i18n="projects.duplicate.namingPrefix">Add prefix:</span>
                </label>
                <input type="text" id="task-prefix-input" placeholder="e.g., Copy - " class="confirm-input" style="margin-left: 24px; margin-bottom: 8px; font-size: 13px;" disabled data-i18n="projects.duplicate.prefixPlaceholder" data-i18n-attr="placeholder">

                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="radio" name="task-naming" value="suffix" style="width: 16px; height: 16px; cursor: pointer;">
                    <span style="font-size: 13px; color: var(--text-secondary);" data-i18n="projects.duplicate.namingSuffix">Add suffix:</span>
                </label>
                <input type="text" id="task-suffix-input" placeholder="e.g., (Copy)" class="confirm-input" style="margin-left: 24px; font-size: 13px;" disabled data-i18n="projects.duplicate.suffixPlaceholder" data-i18n-attr="placeholder">
            </div>

            <div class="confirm-actions">
                <button class="btn-secondary" data-action="closeDuplicateProjectModal" data-i18n="common.cancel">Cancel</button>
                <button class="btn-primary" data-action="confirmDuplicateProject" data-i18n="projects.duplicate.confirm">Duplicate Project</button>
            </div>
        </div>
    </div>

    <div id="status-info-modal" class="modal" data-action="closeModalOnBackdrop" data-param="status-info-modal">
    <div class="modal-content" data-action="stopPropagation" style="max-width: 500px;">
        <h2 class="modal-title" data-i18n="projects.statusInfo.title">Project Status Logic</h2>
        <div style="margin: 24px 0; line-height: 1.8; color: var(--text-secondary);">
            <p style="margin-bottom: 16px;" data-i18n="projects.statusInfo.subtitle">Project status updates automatically based on task progress</p>
            
            <div style="margin-bottom: 12px;">
	                    <strong style="color: var(--text-muted);">‚¨ú Planning</strong><br>
                <span data-i18n="projects.statusInfo.planningDesc">All tasks are in "To Do" status</span>
            </div>
            
            <div style="margin-bottom: 12px;">
	                <strong style="color: var(--accent-blue);">üü¶ Active</strong><br>
                <span data-i18n="projects.statusInfo.activeDesc">At least one task is "In Progress" or "In Review"</span>
            </div>
            
            <div style="margin-bottom: 12px;">
                <strong style="color: var(--accent-green);">‚úÖ Completed</strong><br>
                <span data-i18n="projects.statusInfo.completedDesc">All tasks are marked as "Done"</span>
            </div>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn-primary" data-action="closeModal" data-param="status-info-modal" data-i18n="common.gotIt">Got it</button>
        </div>
    </div>
</div>

    <div id="settings-modal" class="modal">
        <div class="modal-content settings-modal-content">
            <div class="settings-modal-header">
                <div class="settings-header-left">
                    <div class="settings-icon-wrapper">‚öôÔ∏è</div>
                    <div class="settings-header-text">
                        <h2 class="settings-title" data-i18n="settings.title">Settings</h2>
                        <p class="settings-subtitle" data-i18n="settings.subtitle">Manage your preferences and application settings</p>
                    </div>
                </div>
                <button class="modal-close settings-close" data-action="closeModal" data-param="settings-modal" aria-label="Close modal" data-i18n="common.close" data-i18n-attr="aria-label">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>

              <form id="settings-form">
                  <div class="settings-modal-body">
                      <div class="settings-section">
                          <div class="settings-section-header">
                            <svg class="settings-section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                              <h3 class="settings-section-title" data-i18n="settings.section.profile">Profile</h3>
                          </div>
                          <div class="settings-section-content">
                              <div class="settings-field">
                                  <div class="settings-field-label">
                                      <label class="field-label" for="user-name" data-i18n="settings.displayName">Display Name</label>
                                      <p class="field-hint" data-i18n="settings.displayNameHint">This name is displayed throughout the application</p>
                                  </div>
                                  <div class="settings-field-input">
                                      <input
                                          type="text"
                                          id="user-name"
                                          name="userName"
                                          class="settings-input"
                                          placeholder="Enter your display name"
                                          data-i18n="settings.placeholder.displayName"
                                          data-i18n-attr="placeholder"
                                      />
                                  </div>
                              </div>
                              <div class="settings-field">
                                  <div class="settings-field-label">
                                      <label class="field-label" for="user-email" data-i18n="settings.email">Email</label>
                                      <p class="field-hint" data-i18n="settings.emailHint">Used for your account and deadline notifications</p>
                                  </div>
                                  <div class="settings-field-input">
                                      <input
                                          type="email"
                                          id="user-email"
                                          name="notificationEmail"
                                          class="settings-input"
                                          placeholder="Enter your email"
                                          data-i18n="settings.placeholder.email"
                                          data-i18n-attr="placeholder"
                                      />
                                  </div>
                              </div>
                              <div class="settings-field settings-field-avatar">
                                    <div class="settings-field-label">
                                       <label class="field-label" data-i18n="settings.avatar">Avatar</label>
                                       <p class="field-hint" data-i18n="settings.avatarHint">Upload an image for your avatar (max 2MB). It will be displayed as a circle.</p>
                                    </div>
                                  <div class="settings-field-input user-avatar-input-row">
                                      <!-- Drag & Drop Zone -->
                                      <div id="user-avatar-dropzone" class="form-input user-avatar-dropzone" role="button" tabindex="0"></div>
                                      <input type="file" id="user-avatar-input" accept="image/*" style="display: none;">

                                      <!-- Preview -->
                                      <div
                                          class="user-avatar-preview"
                                          id="user-avatar-preview"
                                          aria-hidden="true"
                                      ></div>

                                      <!-- Clear Button -->
                                      <button
                                          type="button"
                                          class="user-avatar-clear-btn"
                                          id="user-avatar-clear-btn"
                                          title="Remove avatar"
                                          data-i18n="settings.avatarRemoveTitle"
                                          data-i18n-attr="title"
                                      >
                                          x
                                      </button>
                                  </div>
                              </div>
                              <div class="settings-field settings-field-logo">
                                    <div class="settings-field-label">
                                       <label class="field-label" data-i18n="settings.workspaceLogo">Workspace Logo</label>
                                       <p class="field-hint" data-i18n="settings.workspaceLogoHint">Upload a square image to replace the Nautilus logo (max 2MB).</p>
                                    </div>
                                  <div class="settings-field-input workspace-logo-input-row">
                                      <!-- Drag & Drop Zone -->
                                      <div id="workspace-logo-dropzone" class="form-input workspace-logo-dropzone" role="button" tabindex="0"></div>
                                      <input type="file" id="workspace-logo-input" accept="image/*" style="display: none;">

                                      <!-- Preview -->
                                      <div
                                          class="workspace-logo-preview"
                                          id="workspace-logo-preview"
                                          aria-hidden="true"
                                      ></div>

                                      <!-- Clear Button -->
                                      <button
                                          type="button"
                                          class="workspace-logo-clear-btn"
                                          id="workspace-logo-clear-btn"
                                          title="Remove custom logo"
                                          data-i18n="settings.workspaceLogoRemoveTitle"
                                          data-i18n-attr="title"
                                      >
                                          x
                                      </button>
                                  </div>
                              </div>
                          </div>
                      </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg class="settings-section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                            <h3 class="settings-section-title" data-i18n="settings.section.application">Application</h3>
                        </div>
                        <div class="settings-section-content">
                            <div class="settings-field">
                                <div class="settings-field-label">
                                    <label class="field-label" for="language-select" data-i18n="settings.language">Language</label>
                                    <p class="field-hint" data-i18n="settings.languageHint">Choose the application language</p>
                                </div>
                                <div class="settings-field-input">
                                    <select id="language-select" name="language" class="settings-select">
                                        <option value="en">English</option>
                                        <option value="es">Espa√±ol</option>
                                    </select>
                                </div>
                            </div>
                            <div class="settings-field settings-field-toggle">
                                <div class="settings-field-label">
                                    <label class="field-label" for="enable-review-status-toggle" data-i18n="settings.enableReviewStatus">Enable In Review status</label>
                                    <p class="field-hint"><span data-i18n="settings.enableReviewStatusHintPrefix">Show or hide the</span> <span class="status-badge review" style="display: inline-flex; align-items: center; padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px;" data-i18n="tasks.status.review">IN REVIEW</span> <span data-i18n="settings.enableReviewStatusHintSuffix">status column and filter option</span></p>
                                </div>
                                <div class="settings-field-input">
                                    <div class="premium-toggle">
                                        <input type="checkbox" id="enable-review-status-toggle" name="enableReviewStatus">
                                        <label for="enable-review-status-toggle"></label>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-field settings-field-toggle">
                                <div class="settings-field-label">
                                    <label class="field-label" for="calendar-include-backlog-toggle" data-i18n="settings.calendarIncludeBacklog">Show backlog in calendar</label>
                                    <p class="field-hint" data-i18n="settings.calendarIncludeBacklogHint">Display backlog tasks in all calendar views</p>
                                </div>
                                <div class="settings-field-input">
                                    <div class="premium-toggle">
                                        <input type="checkbox" id="calendar-include-backlog-toggle" name="calendarIncludeBacklog">
                                        <label for="calendar-include-backlog-toggle"></label>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-field settings-field-toggle">
                                <div class="settings-field-label">
                                    <label class="field-label" for="auto-start-date-toggle" data-i18n="settings.autoStartDate">Auto-set start date</label>
                                    <p class="field-hint" data-i18n="settings.autoStartDateHint">Automatically set Start Date when task status changes to "In Progress" (if empty)</p>
                                </div>
                                <div class="settings-field-input history-sort-input">
                                    <div class="premium-toggle">
                                        <input type="checkbox" id="auto-start-date-toggle" name="autoSetStartDateOnStatusChange">
                                        <label for="auto-start-date-toggle"></label>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-field settings-field-toggle">
                                <div class="settings-field-label">
                                    <label class="field-label" for="auto-end-date-toggle" data-i18n="settings.autoEndDate">Auto-set end date</label>
                                    <p class="field-hint" data-i18n="settings.autoEndDateHint">Automatically set End Date when task status changes to "Done" (if empty)</p>
                                </div>
                                <div class="settings-field-input">
                                    <div class="premium-toggle">
                                        <input type="checkbox" id="auto-end-date-toggle" name="autoSetEndDateOnStatusChange">
                                        <label for="auto-end-date-toggle"></label>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-field settings-field-toggle history-sort-field">
                                <div class="settings-field-label">
                                    <label class="field-label" for="history-sort-order" data-i18n="settings.historySortOrder">History Sort Order</label>
                                    <p class="field-hint" data-i18n="settings.historySortOrderHint">Default sort order for task and project history timelines</p>
                                </div>
                                <div class="settings-field-input history-sort-input">
                                    <select id="history-sort-order" name="historySortOrder" class="settings-select">
                                        <option value="newest" data-i18n="settings.historySortNewest">Newest First</option>
                                        <option value="oldest" data-i18n="settings.historySortOldest">Oldest First</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg class="settings-section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                            <h3 class="settings-section-title" data-i18n="settings.section.notifications">Notifications</h3>
                        </div>
                        <div class="settings-section-content">
                            <div class="settings-field settings-field-toggle">
                                <div class="settings-field-label">
                                    <label class="field-label" for="email-notifications-enabled" data-i18n="settings.emailNotifications">Email notifications</label>
                                    <p class="field-hint" data-i18n="settings.emailNotificationsHint">Enable or disable deadline reminder emails</p>
                                </div>
                                <div class="settings-field-input">
                                    <div class="premium-toggle">
                                        <input type="checkbox" id="email-notifications-enabled" name="emailNotificationsEnabled">
                                        <label for="email-notifications-enabled"></label>
                                    </div>
                                </div>
                            </div>

                            <div id="email-notification-details" class="settings-collapsible" aria-hidden="false">
                                <div class="settings-field settings-field-toggle">
                                    <div class="settings-field-label">
                                        <label class="field-label" for="email-notifications-weekdays-only" data-i18n="settings.weekdaysOnly">Weekdays only</label>
                                        <p class="field-hint" data-i18n="settings.weekdaysOnlyHint">Skip emails on Saturday and Sunday</p>
                                    </div>
                                    <div class="settings-field-input">
                                        <div class="premium-toggle">
                                            <input type="checkbox" id="email-notifications-weekdays-only" name="emailNotificationsWeekdaysOnly">
                                            <label for="email-notifications-weekdays-only"></label>
                                        </div>
                                    </div>
                                </div>

                                <div class="settings-field settings-field-toggle">
                                    <div class="settings-field-label">
                                        <label class="field-label" for="email-notifications-include-backlog" data-i18n="settings.includeBacklog">Include backlog tasks</label>
                                        <p class="field-hint" data-i18n="settings.includeBacklogHint">Also send reminders for tasks in backlog status</p>
                                    </div>
                                    <div class="settings-field-input">
                                        <div class="premium-toggle">
                                            <input type="checkbox" id="email-notifications-include-backlog" name="emailNotificationsIncludeBacklog">
                                            <label for="email-notifications-include-backlog"></label>
                                        </div>
                                    </div>
                                </div>

                                <div class="settings-field settings-field-toggle">
                                    <div class="settings-field-label">
                                        <label class="field-label" for="email-notifications-include-start-dates" data-i18n="settings.includeStartDates">Include start dates</label>
                                        <p class="field-hint" data-i18n="settings.includeStartDatesHint">Also send reminders for tasks starting today</p>
                                    </div>
                                    <div class="settings-field-input">
                                        <div class="premium-toggle">
                                            <input type="checkbox" id="email-notifications-include-start-dates" name="emailNotificationsIncludeStartDates">
                                            <label for="email-notifications-include-start-dates"></label>
                                        </div>
                                    </div>
                                </div>

                                <div class="settings-field" id="email-notification-time-field">
                                    <div class="settings-field-label">
                                        <label class="field-label" for="email-notification-time-trigger" data-i18n="settings.sendTime">Send time</label>
                                        <p class="field-hint" data-i18n="settings.sendTimeHint">Daily time to send reminders (08:00-18:00, 30-minute increments)</p>
                                    </div>
                                    <div class="settings-field-input">
                                        <button
                                            type="button"
                                            id="email-notification-time-trigger"
                                            class="settings-select settings-select-clock settings-time-trigger"
                                            aria-haspopup="listbox"
                                            aria-expanded="false"
                                        >
                                            <span id="email-notification-time-value">09:00</span>
                                        </button>
                                        <input type="hidden" id="email-notification-time" name="emailNotificationTime" value="09:00" />
                                    </div>
                                </div>

                                <div class="settings-field" id="email-notification-timezone-field">
                                    <div class="settings-field-label">
                                        <label class="field-label" for="email-notification-timezone" data-i18n="settings.timeZone">Time zone</label>
                                        <p class="field-hint" data-i18n="settings.timeZoneHint">Keeps the same local time year-round (DST-aware)</p>
                                    </div>
                                    <div class="settings-field-input">
                                        <button
                                            type="button"
                                            id="email-notification-timezone-trigger"
                                            class="settings-select settings-timezone-trigger"
                                            aria-haspopup="listbox"
                                            aria-expanded="false"
                                        >
                                            <span id="email-notification-timezone-value" data-i18n="settings.timeZone.option.canary">Canary Islands (Atlantic/Canary)</span>
                                        </button>
                                        <select id="email-notification-timezone" name="emailNotificationTimeZone" class="settings-select">
                                            <option value="America/Argentina/Buenos_Aires" data-i18n="settings.timeZone.option.argentina">Argentina (Buenos Aires)</option>
                                            <option value="Atlantic/Canary" data-i18n="settings.timeZone.option.canary">Canary Islands (Atlantic/Canary)</option>
                                            <option value="Europe/Madrid" data-i18n="settings.timeZone.option.spain">Spain mainland (Europe/Madrid)</option>
                                            <option value="UTC" data-i18n="settings.timeZone.option.utc">UTC</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg class="settings-section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                            <h3 class="settings-section-title" data-i18n="settings.section.security">Security</h3>
                        </div>
                            <div class="settings-section-content">
                                <div class="settings-field">
                                    <div class="settings-field-label">
                                        <label class="field-label" data-i18n="settings.pinManagement">PIN Management</label>
                                    <p class="field-hint" data-i18n="settings.pinManagementHint">Reset your PIN to a new 4-digit code</p>
                                </div>
                                <div class="settings-field-input">
                                    <button type="button" class="settings-btn settings-btn-danger" id="reset-pin-btn">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36M20.49 15a9 9 0 0 1-14.85 3.36"></path></svg>
                                        <span data-i18n="settings.resetPinButton">Reset PIN</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg class="settings-section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            <h3 class="settings-section-title" data-i18n="settings.section.dataManagement">Data Management</h3>
                        </div>
                        <div class="settings-section-content">
                            <div class="settings-field">
                                <div class="settings-field-label">
                                    <label class="field-label" data-i18n="settings.exportData">Export Data</label>
                                    <p class="field-hint" data-i18n="settings.exportDataHint">Download a complete backup of all your tasks, projects, and settings as a JSON file</p>
                                </div>
                                <div class="settings-field-input">
                                    <button type="button" class="settings-btn settings-btn-cancel" data-action="exportDashboardData">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                        <span data-i18n="settings.exportButton">Export Data</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                  </div>

                  <div class="settings-modal-footer">
                      <button type="button" class="settings-btn settings-btn-cancel" data-action="closeModal" data-param="settings-modal">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                          <span data-i18n="settings.cancelButton">Cancel</span>
                      </button>
                      <button type="submit" class="settings-btn settings-btn-save">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                          <span data-i18n="settings.saveButton">Save Settings</span>
                      </button>
                  </div>
              </form>
        </div>
    </div>

    <!-- Workspace Logo Crop Modal -->
    <div id="workspace-logo-crop-modal" class="modal">
        <div class="modal-content crop-modal-content">
            <div class="crop-modal-header">
                <h2 class="modal-title" id="crop-modal-title" data-i18n="crop.title">Crop Image to Square</h2>
                <button type="button" class="modal-close settings-close" onclick="closeCropModal()" aria-label="Close crop modal" data-i18n="crop.close" data-i18n-attr="aria-label">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>

            <div class="crop-modal-body">
                <p class="crop-instructions" data-i18n="crop.instructions">
                    Drag to adjust the crop area. The image will be cropped to a square.
                </p>

                <!-- Canvas container -->
                <div class="crop-canvas-container">
                    <canvas id="crop-canvas"></canvas>
                    <div id="crop-overlay" class="crop-overlay">
                        <div id="crop-selection" class="crop-selection">
                            <!-- Resize handles -->
                            <div class="crop-handle crop-handle-nw"></div>
                            <div class="crop-handle crop-handle-ne"></div>
                            <div class="crop-handle crop-handle-sw"></div>
                            <div class="crop-handle crop-handle-se"></div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="crop-modal-footer">
                <div class="crop-info" aria-live="polite">
                    <span id="crop-dimensions">0 √ó 0 px</span>
                    <span id="crop-size-estimate">~0 KB</span>
                </div>
                <div class="crop-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCropModal()" data-i18n="common.cancel">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="applyCrop()" data-i18n="crop.apply">Crop & Apply</button>
                </div>
            </div>
        </div>
    </div>

    <script src="src/services/historyService.js"></script>
    <script src="auth.js"></script>
    <script type="module" src="app.js?v=20260112-storage-client-fix"></script>

<div id="day-items-modal" class="day-items-modal" data-action="closeDayItemsModalOnBackdrop">
    <div class="day-items-content" data-action="stopPropagation">
        <div class="day-items-header">
            <div class="day-items-title" id="day-items-modal-title"></div>
            <button class="day-items-close" data-action="closeDayItemsModal" aria-label="Close day items" data-i18n="calendar.dayItems.close" data-i18n-attr="aria-label">√ó</button>
        </div>
        <div id="day-items-modal-body"></div>
    </div>
</div>

</body>
</html>



















