{
  "version": 3,
  "sources": ["../src/services/reportGenerator.js", "../src/config/i18n.js", "../storage-client.js", "../src/services/storage.js", "../src/utils/string.js", "../src/utils/date.js", "../src/services/taskService.js", "../src/services/projectService.js", "../src/utils/html.js", "../src/utils/colors.js", "../src/config/constants.js", "../src/config/release-notes.js", "../src/utils/debug.js", "../src/ui/notification.js", "../src/utils/file.js", "../src/utils/validation.js", "../src/utils/time.js", "../src/utils/functional.js", "../src/utils/filterPredicates.js", "../src/views/dashboard.js", "../src/components/taskCard.js", "../src/views/kanban.js", "../src/views/listView.js", "../src/views/calendar.js", "../src/views/projectsView.js", "../src/components/taskDetails.js", "../src/core/events.js", "../src/core/state.js", "../app.js", "../src/main.js"],
  "sourcesContent": ["/**\r\n * Nautilus Word Report Generator (Browser Version)\r\n * Generates .docx research reports directly in the browser\r\n */\r\n\r\nimport { Document, Packer, Paragraph, Table, TableCell, TableRow, TextRun, AlignmentType, WidthType, BorderStyle, HeadingLevel, ShadingType } from 'https://esm.sh/docx@9.5.1';\r\n\r\n// ============================================================================\r\n// CONFIGURATION\r\n// ============================================================================\r\n\r\nconst ISLAND_LOCALITY_CONFIG = {\r\n    'TENERIFE': ['TAJAO', 'LOS CRISTIANOS', 'LAS TERESITAS', 'EL M\u00C9DANO', 'SAN JUAN', 'BOCA CANGREJO'],\r\n    'LA PALMA': ['LOS CANCAJOS', 'LA BOMBILLA', 'R\u00CDO MUERTO'],\r\n    'LANZAROTE': ['\u00D3RZOLA'],\r\n    'FUERTEVENTURA': ['TONELES', 'JACOMAR', 'LOBOS', 'MORRO JABLE']\r\n};\r\n\r\nconst ALL_ISLANDS = Object.keys(ISLAND_LOCALITY_CONFIG);\r\n\r\n// Color palette for document design (professional, accessible colors)\r\nconst COLORS = {\r\n    // Status colors (background shading for table cells)\r\n    status: {\r\n        'todo': 'E5E7EB',       // Gray 200 - Neutral\r\n        'progress': 'DBEAFE',   // Blue 100 - In Progress\r\n        'review': 'FEF3C7',     // Amber 100 - Under Review\r\n        'done': 'D1FAE5'        // Green 100 - Completed\r\n    },\r\n    // Priority background colors (for table cell shading)\r\n    priorityBg: {\r\n        'low': 'F3F4F6',        // Gray 100 - Light background\r\n        'medium': 'FEF3C7',     // Amber 100 - Orange background\r\n        'high': 'FEE2E2'        // Red 100 - Light red background\r\n    },\r\n    // Priority colors (for visual hierarchy)\r\n    priority: {\r\n        'low': '9CA3AF',        // Gray 400\r\n        'medium': 'F59E0B',     // Amber 500\r\n        'high': 'EF4444'        // Red 500\r\n    },\r\n    // Accent colors\r\n    primary: '0284C7',          // Sky 600\r\n    secondary: '6366F1',        // Indigo 500\r\n    success: '10B981',          // Green 500\r\n    headerBg: 'F3F4F6'          // Gray 100\r\n};\r\n\r\n// Emojis for visual hierarchy\r\nconst EMOJIS = {\r\n    priority: {\r\n        'low': '\u25A0',      // Black square (will be colored gray)\r\n        'medium': '\u25A0',   // Black square (will be colored orange)\r\n        'high': '\u25A0'      // Black square (will be colored red)\r\n    },\r\n    status: {\r\n        'todo': '\u2B1C',     // White square\r\n        'progress': '\uD83D\uDFE6', // Blue square\r\n        'review': '\uD83D\uDFE8',   // Yellow square\r\n        'done': '\u2705'      // Checkmark (done tasks will have strikethrough text)\r\n    },\r\n    sections: {\r\n        project: '\uD83D\uDCC1',\r\n        island: '\uD83C\uDFDD\uFE0F',\r\n        locality: '\uD83D\uDCCD',\r\n        summary: '\uD83D\uDCCA',\r\n        tasks: '\uD83D\uDCCB',\r\n        metrics: '\uD83D\uDCC8'\r\n    },\r\n    progress: {\r\n        full: '\uD83D\uDFE9',       // Full block - completed\r\n        high: '\uD83D\uDFE8',       // High progress\r\n        medium: '\uD83D\uDFE7',     // Medium progress\r\n        low: '\uD83D\uDFE5'         // Low progress\r\n    }\r\n};\r\n\r\n// ============================================================================\r\n// UTILITY FUNCTIONS\r\n// ============================================================================\r\n\r\n/**\r\n * Get color for completion percentage\r\n */\r\nfunction getProgressColor(percent) {\r\n    if (percent >= 75) return COLORS.success;\r\n    if (percent >= 50) return COLORS.primary;\r\n    if (percent >= 25) return COLORS.priority.medium;\r\n    return COLORS.priority.high;\r\n}\r\n\r\n// ============================================================================\r\n// DATA PROCESSING\r\n// ============================================================================\r\n\r\nfunction calculateGlobalInsights(projects, tasks) {\r\n    const activeProjectIds = new Set(\r\n        tasks\r\n            .filter(task => task.status !== 'done')\r\n            .map(task => task.projectId)\r\n            .filter(id => id !== null)\r\n    );\r\n\r\n    const totalTasks = tasks.length;\r\n    const completedTasks = tasks.filter(task => task.status === 'done').length;\r\n    const completionPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;\r\n\r\n    return {\r\n        activeProjectsCount: activeProjectIds.size,\r\n        totalTasks,\r\n        completedTasks,\r\n        completionPercent\r\n    };\r\n}\r\n\r\nfunction calculateProjectMetrics(project, tasks) {\r\n    const projectTasks = tasks.filter(task => task.projectId === project.id);\r\n    const totalTasks = projectTasks.length;\r\n    const completedTasks = projectTasks.filter(task => task.status === 'done').length;\r\n    const completionPercent = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;\r\n\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const overdueTasks = projectTasks.filter(task =>\r\n        task.status !== 'done' &&\r\n        task.endDate &&\r\n        task.endDate < today\r\n    ).length;\r\n\r\n    const tasksWithoutDates = projectTasks.filter(task =>\r\n        !task.startDate || !task.endDate\r\n    ).length;\r\n\r\n    return {\r\n        totalTasks,\r\n        completedTasks,\r\n        completionPercent,\r\n        overdueTasks,\r\n        tasksWithoutDates,\r\n        tasks: projectTasks\r\n    };\r\n}\r\n\r\nfunction getTaskTags(task) {\r\n    return (task.tags || []).map(tag => tag.toUpperCase());\r\n}\r\n\r\nfunction getProjectTags(project) {\r\n    return (project.tags || []).map(tag => tag.toUpperCase());\r\n}\r\n\r\nfunction getTaskIsland(task, project) {\r\n    const taskTags = getTaskTags(task);\r\n    const projectTags = getProjectTags(project);\r\n    const allTags = [...taskTags, ...projectTags];\r\n\r\n    for (const island of ALL_ISLANDS) {\r\n        if (allTags.includes(island)) {\r\n            return island;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction getTaskLocality(task, island) {\r\n    if (!island) return null;\r\n\r\n    const taskTags = getTaskTags(task);\r\n    const localities = ISLAND_LOCALITY_CONFIG[island];\r\n\r\n    for (const locality of localities) {\r\n        if (taskTags.includes(locality)) {\r\n            return locality;\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nfunction groupTasksByIslandAndLocality(project, tasks) {\r\n    const projectTasks = tasks.filter(task => task.projectId === project.id);\r\n    const islandGroups = {};\r\n\r\n    for (const task of projectTasks) {\r\n        const island = getTaskIsland(task, project);\r\n        if (!island) continue;\r\n\r\n        if (!islandGroups[island]) {\r\n            islandGroups[island] = {\r\n                localities: {},\r\n                otherTasks: []\r\n            };\r\n        }\r\n\r\n        const locality = getTaskLocality(task, island);\r\n        if (locality) {\r\n            if (!islandGroups[island].localities[locality]) {\r\n                islandGroups[island].localities[locality] = [];\r\n            }\r\n            islandGroups[island].localities[locality].push(task);\r\n        } else {\r\n            islandGroups[island].otherTasks.push(task);\r\n        }\r\n    }\r\n\r\n    return islandGroups;\r\n}\r\n\r\nfunction sortTasks(tasks) {\r\n    return [...tasks].sort((a, b) => {\r\n        if (!a.startDate && !b.startDate) return 0;\r\n        if (!a.startDate) return 1;\r\n        if (!b.startDate) return -1;\r\n\r\n        if (a.startDate !== b.startDate) {\r\n            return a.startDate.localeCompare(b.startDate);\r\n        }\r\n\r\n        if (!a.endDate && !b.endDate) return 0;\r\n        if (!a.endDate) return 1;\r\n        if (!b.endDate) return -1;\r\n\r\n        return a.endDate.localeCompare(b.endDate);\r\n    });\r\n}\r\n\r\n// ============================================================================\r\n// DOCUMENT GENERATION\r\n// ============================================================================\r\n\r\nfunction createHeader() {\r\n    const now = new Date();\r\n    const dateStr = now.toLocaleDateString('es-ES', {\r\n        year: 'numeric',\r\n        month: 'long',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit'\r\n    });\r\n\r\n    return [\r\n        new Paragraph({\r\n            children: [\r\n                new TextRun({ text: 'REPORTE NAUTILUS', size: 36, bold: true })\r\n            ],\r\n            heading: HeadingLevel.TITLE,\r\n            alignment: AlignmentType.CENTER,\r\n            spacing: { after: 150 }\r\n        }),\r\n        new Paragraph({\r\n            children: [\r\n                new TextRun({\r\n                    text: 'Sistema de Gesti\u00F3n de Investigaci\u00F3n Marina',\r\n                    size: 20,\r\n                    color: '6B7280'\r\n                })\r\n            ],\r\n            alignment: AlignmentType.CENTER,\r\n            spacing: { after: 100 }\r\n        }),\r\n        new Paragraph({\r\n            children: [\r\n                new TextRun({ text: dateStr, size: 18, color: '9CA3AF' })\r\n            ],\r\n            alignment: AlignmentType.CENTER,\r\n            spacing: { after: 300 }\r\n        }),\r\n        new Paragraph({\r\n            text: '',\r\n            border: {\r\n                bottom: {\r\n                    color: 'D1D5DB',\r\n                    space: 1,\r\n                    style: BorderStyle.SINGLE,\r\n                    size: 3\r\n                }\r\n            },\r\n            spacing: { after: 400 }\r\n        })\r\n    ];\r\n}\r\n\r\nfunction createGlobalSummary(insights, tasks) {\r\n    const statusCounts = {\r\n        'done': tasks.filter(t => t.status === 'done').length,\r\n        'progress': tasks.filter(t => t.status === 'progress').length,\r\n        'review': tasks.filter(t => t.status === 'review').length,\r\n        'todo': tasks.filter(t => t.status === 'todo').length\r\n    };\r\n\r\n    // Create metrics summary table (professional layout)\r\n    const metricsTable = new Table({\r\n        width: { size: 100, type: WidthType.PERCENTAGE },\r\n        borders: {\r\n            top: { style: BorderStyle.NONE },\r\n            bottom: { style: BorderStyle.NONE },\r\n            left: { style: BorderStyle.NONE },\r\n            right: { style: BorderStyle.NONE },\r\n            insideHorizontal: { style: BorderStyle.NONE },\r\n            insideVertical: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' }\r\n        },\r\n        rows: [\r\n            new TableRow({\r\n                children: [\r\n                    // Column 1: Proyectos Activos\r\n                    new TableCell({\r\n                        children: [\r\n                            new Paragraph({\r\n                                children: [new TextRun({ text: 'Proyectos Activos', size: 18, color: '6B7280' })],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { before: 200, after: 100 }\r\n                            }),\r\n                            new Paragraph({\r\n                                children: [new TextRun({ text: insights.activeProjectsCount.toString(), size: 48, bold: true, color: COLORS.primary })],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { after: 200 }\r\n                            })\r\n                        ],\r\n                        width: { size: 33.33, type: WidthType.PERCENTAGE },\r\n                        shading: { fill: 'FAFAFA', type: ShadingType.CLEAR }\r\n                    }),\r\n                    // Column 2: Tareas Completadas\r\n                    new TableCell({\r\n                        children: [\r\n                            new Paragraph({\r\n                                children: [new TextRun({ text: 'Tareas Completadas', size: 18, color: '6B7280' })],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { before: 200, after: 100 }\r\n                            }),\r\n                            new Paragraph({\r\n                                children: [new TextRun({ text: `${insights.completedTasks}/${insights.totalTasks}`, size: 48, bold: true })],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { after: 200 }\r\n                            })\r\n                        ],\r\n                        width: { size: 33.33, type: WidthType.PERCENTAGE },\r\n                        shading: { fill: 'FAFAFA', type: ShadingType.CLEAR }\r\n                    }),\r\n                    // Column 3: Progreso Global\r\n                    new TableCell({\r\n                        children: [\r\n                            new Paragraph({\r\n                                children: [new TextRun({ text: 'Progreso Global', size: 18, color: '6B7280' })],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { before: 200, after: 100 }\r\n                            }),\r\n                            new Paragraph({\r\n                                children: [new TextRun({\r\n                                    text: `${insights.completionPercent}%`,\r\n                                    size: 48,\r\n                                    bold: true,\r\n                                    color: getProgressColor(insights.completionPercent)\r\n                                })],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { after: 200 }\r\n                            })\r\n                        ],\r\n                        width: { size: 33.33, type: WidthType.PERCENTAGE },\r\n                        shading: { fill: 'FAFAFA', type: ShadingType.CLEAR }\r\n                    })\r\n                ]\r\n            })\r\n        ]\r\n    });\r\n\r\n    // Create status distribution table (reordered: Por Hacer first, Completadas last)\r\n    const statusTable = new Table({\r\n        width: { size: 100, type: WidthType.PERCENTAGE },\r\n        alignment: AlignmentType.CENTER,\r\n        borders: {\r\n            top: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' },\r\n            bottom: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' },\r\n            left: { style: BorderStyle.NONE },\r\n            right: { style: BorderStyle.NONE },\r\n            insideHorizontal: { style: BorderStyle.NONE },\r\n            insideVertical: { style: BorderStyle.NONE }\r\n        },\r\n        rows: [\r\n            new TableRow({\r\n                children: [\r\n                    new TableCell({\r\n                        children: [\r\n                            new Paragraph({\r\n                                children: [\r\n                                    new TextRun({ text: 'Por Hacer', size: 18, color: '6B7280' })\r\n                                ],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { before: 150, after: 50 }\r\n                            }),\r\n                            new Paragraph({\r\n                                children: [\r\n                                    new TextRun({ text: statusCounts.todo.toString(), size: 32, bold: true, color: '9CA3AF' })\r\n                                ],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { after: 150 }\r\n                            })\r\n                        ],\r\n                        width: { size: 25, type: WidthType.PERCENTAGE }\r\n                    }),\r\n                    new TableCell({\r\n                        children: [\r\n                            new Paragraph({\r\n                                children: [\r\n                                    new TextRun({ text: 'En Progreso', size: 18, color: '6B7280' })\r\n                                ],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { before: 150, after: 50 }\r\n                            }),\r\n                            new Paragraph({\r\n                                children: [\r\n                                    new TextRun({ text: statusCounts.progress.toString(), size: 32, bold: true, color: COLORS.primary })\r\n                                ],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { after: 150 }\r\n                            })\r\n                        ],\r\n                        width: { size: 25, type: WidthType.PERCENTAGE }\r\n                    }),\r\n                    new TableCell({\r\n                        children: [\r\n                            new Paragraph({\r\n                                children: [\r\n                                    new TextRun({ text: 'En Revisi\u00F3n', size: 18, color: '6B7280' })\r\n                                ],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { before: 150, after: 50 }\r\n                            }),\r\n                            new Paragraph({\r\n                                children: [\r\n                                    new TextRun({ text: statusCounts.review.toString(), size: 32, bold: true, color: COLORS.priority.medium })\r\n                                ],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { after: 150 }\r\n                            })\r\n                        ],\r\n                        width: { size: 25, type: WidthType.PERCENTAGE }\r\n                    }),\r\n                    new TableCell({\r\n                        children: [\r\n                            new Paragraph({\r\n                                children: [\r\n                                    new TextRun({ text: 'Completadas', size: 18, color: '6B7280' })\r\n                                ],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { before: 150, after: 50 }\r\n                            }),\r\n                            new Paragraph({\r\n                                children: [\r\n                                    new TextRun({ text: statusCounts.done.toString(), size: 32, bold: true, color: COLORS.success })\r\n                                ],\r\n                                alignment: AlignmentType.CENTER,\r\n                                spacing: { after: 150 }\r\n                            })\r\n                        ],\r\n                        width: { size: 25, type: WidthType.PERCENTAGE }\r\n                    })\r\n                ]\r\n            })\r\n        ]\r\n    });\r\n\r\n    return [\r\n        new Paragraph({\r\n            children: [\r\n                new TextRun({ text: 'Resumen Global', size: 32, bold: true })\r\n            ],\r\n            heading: HeadingLevel.HEADING_1,\r\n            spacing: { before: 200, after: 300 }\r\n        }),\r\n        metricsTable,\r\n        new Paragraph({ text: '', spacing: { before: 300, after: 200 } }),\r\n        new Paragraph({\r\n            children: [\r\n                new TextRun({ text: 'Distribuci\u00F3n de Tareas', size: 22, bold: true })\r\n            ],\r\n            spacing: { after: 150 }\r\n        }),\r\n        statusTable,\r\n        new Paragraph({ text: '', spacing: { after: 400 } })\r\n    ];\r\n}\r\n\r\nfunction createTaskTable(tasks) {\r\n    // Header row with styled background\r\n    const headerRow = new TableRow({\r\n        tableHeader: true,\r\n        children: [\r\n            new TableCell({\r\n                children: [new Paragraph({\r\n                    children: [new TextRun({ text: 'Tarea', bold: true, size: 20 })],\r\n                    alignment: AlignmentType.LEFT\r\n                })],\r\n                width: { size: 35, type: WidthType.PERCENTAGE },\r\n                shading: {\r\n                    type: ShadingType.CLEAR,\r\n                    fill: COLORS.headerBg\r\n                }\r\n            }),\r\n            new TableCell({\r\n                children: [new Paragraph({\r\n                    children: [new TextRun({ text: 'Prioridad', bold: true, size: 20 })],\r\n                    alignment: AlignmentType.CENTER\r\n                })],\r\n                width: { size: 13, type: WidthType.PERCENTAGE },\r\n                shading: {\r\n                    type: ShadingType.CLEAR,\r\n                    fill: COLORS.headerBg\r\n                }\r\n            }),\r\n            new TableCell({\r\n                children: [new Paragraph({\r\n                    children: [new TextRun({ text: 'Estado', bold: true, size: 20 })],\r\n                    alignment: AlignmentType.CENTER\r\n                })],\r\n                width: { size: 17, type: WidthType.PERCENTAGE },\r\n                shading: {\r\n                    type: ShadingType.CLEAR,\r\n                    fill: COLORS.headerBg\r\n                }\r\n            }),\r\n            new TableCell({\r\n                children: [new Paragraph({\r\n                    children: [new TextRun({ text: 'Inicio', bold: true, size: 20 })],\r\n                    alignment: AlignmentType.CENTER\r\n                })],\r\n                width: { size: 17, type: WidthType.PERCENTAGE },\r\n                shading: {\r\n                    type: ShadingType.CLEAR,\r\n                    fill: COLORS.headerBg\r\n                }\r\n            }),\r\n            new TableCell({\r\n                children: [new Paragraph({\r\n                    children: [new TextRun({ text: 'Fin', bold: true, size: 20 })],\r\n                    alignment: AlignmentType.CENTER\r\n                })],\r\n                width: { size: 18, type: WidthType.PERCENTAGE },\r\n                shading: {\r\n                    type: ShadingType.CLEAR,\r\n                    fill: COLORS.headerBg\r\n                }\r\n            })\r\n        ]\r\n    });\r\n\r\n    const priorityMap = {\r\n        'low': 'Baja',\r\n        'medium': 'Media',\r\n        'high': 'Alta'\r\n    };\r\n\r\n    const statusMap = {\r\n        'todo': 'Por Hacer',\r\n        'progress': 'En Progreso',\r\n        'review': 'En Revisi\u00F3n',\r\n        'done': 'Completada'\r\n    };\r\n\r\n    const dataRows = tasks.map(task => {\r\n        const statusColor = COLORS.status[task.status] || 'FFFFFF';\r\n        const priorityColor = COLORS.priority[task.priority] || '9CA3AF';\r\n        const priorityEmoji = EMOJIS.priority[task.priority] || '';\r\n        const statusEmoji = EMOJIS.status[task.status] || '';\r\n\r\n        return new TableRow({\r\n            children: [\r\n                // Task title cell\r\n                new TableCell({\r\n                    children: [new Paragraph({\r\n                        text: task.title || 'Sin t\u00EDtulo',\r\n                        spacing: { before: 100, after: 100 }\r\n                    })]\r\n                }),\r\n                // Priority cell with colored square\r\n                new TableCell({\r\n                    children: [new Paragraph({\r\n                        children: [\r\n                            new TextRun({ text: `${priorityEmoji} `, color: priorityColor }),\r\n                            new TextRun({ text: priorityMap[task.priority] || task.priority || '-' })\r\n                        ],\r\n                        alignment: AlignmentType.CENTER,\r\n                        spacing: { before: 100, after: 100 }\r\n                    })]\r\n                }),\r\n                // Status cell with color and emoji\r\n                new TableCell({\r\n                    children: [new Paragraph({\r\n                        children: [\r\n                            new TextRun({ text: `${statusEmoji} ` }),\r\n                            new TextRun({\r\n                                text: statusMap[task.status] || task.status || '-',\r\n                                strike: task.status === 'done'\r\n                            })\r\n                        ],\r\n                        alignment: AlignmentType.CENTER,\r\n                        spacing: { before: 100, after: 100 }\r\n                    })],\r\n                    shading: {\r\n                        type: ShadingType.CLEAR,\r\n                        fill: statusColor\r\n                    }\r\n                }),\r\n                // Start date cell\r\n                new TableCell({\r\n                    children: [new Paragraph({\r\n                        text: task.startDate || '-',\r\n                        alignment: AlignmentType.CENTER,\r\n                        spacing: { before: 100, after: 100 }\r\n                    })]\r\n                }),\r\n                // End date cell\r\n                new TableCell({\r\n                    children: [new Paragraph({\r\n                        text: task.endDate || '-',\r\n                        alignment: AlignmentType.CENTER,\r\n                        spacing: { before: 100, after: 100 }\r\n                    })]\r\n                })\r\n            ]\r\n        });\r\n    });\r\n\r\n    return new Table({\r\n        rows: [headerRow, ...dataRows],\r\n        width: {\r\n            size: 100,\r\n            type: WidthType.PERCENTAGE\r\n        },\r\n        borders: {\r\n            top: { style: BorderStyle.SINGLE, size: 1 },\r\n            bottom: { style: BorderStyle.SINGLE, size: 1 },\r\n            left: { style: BorderStyle.SINGLE, size: 1 },\r\n            right: { style: BorderStyle.SINGLE, size: 1 },\r\n            insideHorizontal: { style: BorderStyle.SINGLE, size: 1 },\r\n            insideVertical: { style: BorderStyle.SINGLE, size: 1 }\r\n        }\r\n    });\r\n}\r\n\r\nfunction createProjectSection(project, metrics, allTasks) {\r\n    const sections = [];\r\n\r\n    // Project title\r\n    sections.push(\r\n        new Paragraph({\r\n            children: [\r\n                new TextRun({ text: project.name, size: 28, bold: true })\r\n            ],\r\n            heading: HeadingLevel.HEADING_1,\r\n            spacing: { before: 600, after: 200 }\r\n        })\r\n    );\r\n\r\n    // Project metrics - clean summary line\r\n    const summaryParts = [\r\n        `${metrics.completedTasks}/${metrics.totalTasks} tareas`,\r\n        new TextRun({\r\n            text: `${metrics.completionPercent}%`,\r\n            bold: true,\r\n            color: getProgressColor(metrics.completionPercent)\r\n        })\r\n    ];\r\n\r\n    // Modern metrics summary table\r\n    const metricsRows = [];\r\n\r\n    // Progress row (always shown)\r\n    metricsRows.push(\r\n        new TableRow({\r\n            children: [\r\n                new TableCell({\r\n                    children: [new Paragraph({ children: [new TextRun({ text: '\uD83D\uDCCA Progreso', size: 16, color: '4B5563' })] })],\r\n                    width: { size: 30, type: WidthType.PERCENTAGE },\r\n                    shading: { fill: 'F9FAFB' }\r\n                }),\r\n                new TableCell({\r\n                    children: [\r\n                        new Paragraph({\r\n                            children: [\r\n                                new TextRun({\r\n                                    text: `${metrics.completionPercent}%`,\r\n                                    size: 18,\r\n                                    bold: true,\r\n                                    color: getProgressColor(metrics.completionPercent)\r\n                                }),\r\n                                new TextRun({ text: `  (${metrics.completedTasks}/${metrics.totalTasks} tareas)`, size: 14, color: '6B7280' })\r\n                            ]\r\n                        })\r\n                    ],\r\n                    width: { size: 70, type: WidthType.PERCENTAGE }\r\n                })\r\n            ]\r\n        })\r\n    );\r\n\r\n    // Overdue tasks row (conditional)\r\n    if (metrics.overdueTasks > 0) {\r\n        metricsRows.push(\r\n            new TableRow({\r\n                children: [\r\n                    new TableCell({\r\n                        children: [new Paragraph({ children: [new TextRun({ text: '\u26A0\uFE0F Vencidas', size: 16, color: '4B5563' })] })],\r\n                        width: { size: 30, type: WidthType.PERCENTAGE },\r\n                        shading: { fill: 'FEF2F2' }\r\n                    }),\r\n                    new TableCell({\r\n                        children: [new Paragraph({ children: [new TextRun({ text: `${metrics.overdueTasks} tareas`, size: 16, color: COLORS.priority.high })] })],\r\n                        width: { size: 70, type: WidthType.PERCENTAGE }\r\n                    })\r\n                ]\r\n            })\r\n        );\r\n    }\r\n\r\n    // Tasks without dates row (conditional)\r\n    if (metrics.tasksWithoutDates > 0) {\r\n        metricsRows.push(\r\n            new TableRow({\r\n                children: [\r\n                    new TableCell({\r\n                        children: [new Paragraph({ children: [new TextRun({ text: '\uD83D\uDCC5 Sin fechas', size: 16, color: '4B5563' })] })],\r\n                        width: { size: 30, type: WidthType.PERCENTAGE },\r\n                        shading: { fill: 'FFFBEB' }\r\n                    }),\r\n                    new TableCell({\r\n                        children: [new Paragraph({ children: [new TextRun({ text: `${metrics.tasksWithoutDates} tareas`, size: 16, color: '6B7280' })] })],\r\n                        width: { size: 70, type: WidthType.PERCENTAGE }\r\n                    })\r\n                ]\r\n            })\r\n        );\r\n    }\r\n\r\n    const metricsTable = new Table({\r\n        width: { size: 100, type: WidthType.PERCENTAGE },\r\n        borders: {\r\n            top: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' },\r\n            bottom: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' },\r\n            left: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' },\r\n            right: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' },\r\n            insideHorizontal: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' },\r\n            insideVertical: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' }\r\n        },\r\n        rows: metricsRows\r\n    });\r\n\r\n    sections.push(metricsTable);\r\n\r\n    // Add spacing before table\r\n    sections.push(\r\n        new Paragraph({\r\n            text: '',\r\n            spacing: { after: 200 }\r\n        })\r\n    );\r\n\r\n    const sortedTasks = sortTasks(metrics.tasks);\r\n    if (sortedTasks.length > 0) {\r\n        sections.push(createTaskTable(sortedTasks));\r\n    }\r\n\r\n    const islandGroups = groupTasksByIslandAndLocality(project, allTasks);\r\n\r\n    if (Object.keys(islandGroups).length > 0) {\r\n        sections.push(\r\n            new Paragraph({\r\n                children: [\r\n                    new TextRun({ text: 'Desglose Geogr\u00E1fico', size: 26, bold: true })\r\n                ],\r\n                heading: HeadingLevel.HEADING_2,\r\n                spacing: { before: 400, after: 300 }\r\n            })\r\n        );\r\n\r\n        for (const island of Object.keys(islandGroups).sort()) {\r\n            const islandData = islandGroups[island];\r\n\r\n            sections.push(\r\n                new Paragraph({\r\n                    children: [\r\n                        new TextRun({ text: '\uD83C\uDFDD\uFE0F ', size: 24 }),\r\n                        new TextRun({ text: island, size: 24, bold: true, color: COLORS.primary })\r\n                    ],\r\n                    heading: HeadingLevel.HEADING_3,\r\n                    spacing: { before: 350, after: 200 }\r\n                })\r\n            );\r\n\r\n            const localities = Object.keys(islandData.localities).sort();\r\n            for (const locality of localities) {\r\n                const localityTasks = sortTasks(islandData.localities[locality]);\r\n\r\n                sections.push(\r\n                    new Paragraph({\r\n                        children: [\r\n                            new TextRun({ text: '\uD83D\uDCCD ', size: 22 }),\r\n                            new TextRun({ text: locality, size: 22, bold: true, italics: false })\r\n                        ],\r\n                        spacing: { before: 250, after: 150 }\r\n                    })\r\n                );\r\n\r\n                sections.push(createTaskTable(localityTasks));\r\n                sections.push(new Paragraph({ text: '', spacing: { after: 250 } }));\r\n            }\r\n\r\n            if (islandData.otherTasks.length > 0) {\r\n                const otherTasks = sortTasks(islandData.otherTasks);\r\n\r\n                sections.push(\r\n                    new Paragraph({\r\n                        children: [\r\n                            new TextRun({ text: '\uD83D\uDCCD ', size: 22 }),\r\n                            new TextRun({ text: 'Otras Ubicaciones', size: 22, bold: true, italics: false })\r\n                        ],\r\n                        spacing: { before: 250, after: 150 }\r\n                    })\r\n                );\r\n\r\n                sections.push(createTaskTable(otherTasks));\r\n                sections.push(new Paragraph({ text: '', spacing: { after: 250 } }));\r\n            }\r\n        }\r\n    }\r\n\r\n    return sections;\r\n}\r\n\r\n// ============================================================================\r\n// PUBLIC API\r\n// ============================================================================\r\n\r\nexport async function generateWordReport(projects, tasks) {\r\n    try {\r\n        const globalInsights = calculateGlobalInsights(projects, tasks);\r\n\r\n        const sections = [];\r\n\r\n        sections.push(...createHeader());\r\n        sections.push(...createGlobalSummary(globalInsights, tasks));\r\n\r\n        // Sort projects alphabetically by name\r\n        const sortedProjects = [...projects].sort((a, b) =>\r\n            a.name.localeCompare(b.name, 'es', { sensitivity: 'base' })\r\n        );\r\n\r\n        sections.push(\r\n            new Paragraph({\r\n                children: [\r\n                    new TextRun({ text: 'Proyectos', size: 32, bold: true })\r\n                ],\r\n                heading: HeadingLevel.HEADING_1,\r\n                spacing: { before: 600, after: 300 }\r\n            })\r\n        );\r\n\r\n        // Create project summary table\r\n        const projectCells = sortedProjects.map(project => {\r\n            const metrics = calculateProjectMetrics(project, tasks);\r\n            return new TableCell({\r\n                children: [\r\n                    new Paragraph({\r\n                        children: [\r\n                            new TextRun({ text: project.name, size: 16, bold: true })\r\n                        ],\r\n                        alignment: AlignmentType.CENTER,\r\n                        spacing: { before: 150, after: 50 }\r\n                    }),\r\n                    new Paragraph({\r\n                        children: [\r\n                            new TextRun({\r\n                                text: `${metrics.completionPercent}%`,\r\n                                size: 28,\r\n                                bold: true,\r\n                                color: getProgressColor(metrics.completionPercent)\r\n                            })\r\n                        ],\r\n                        alignment: AlignmentType.CENTER,\r\n                        spacing: { after: 50 }\r\n                    }),\r\n                    new Paragraph({\r\n                        children: [\r\n                            new TextRun({\r\n                                text: `${metrics.completedTasks}/${metrics.totalTasks} tareas`,\r\n                                size: 14,\r\n                                color: '6B7280'\r\n                            })\r\n                        ],\r\n                        alignment: AlignmentType.CENTER,\r\n                        spacing: { after: 150 }\r\n                    })\r\n                ],\r\n                width: { size: 100 / sortedProjects.length, type: WidthType.PERCENTAGE }\r\n            });\r\n        });\r\n\r\n        const projectsTable = new Table({\r\n            width: { size: 100, type: WidthType.PERCENTAGE },\r\n            borders: {\r\n                top: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' },\r\n                bottom: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' },\r\n                left: { style: BorderStyle.NONE },\r\n                right: { style: BorderStyle.NONE },\r\n                insideHorizontal: { style: BorderStyle.NONE },\r\n                insideVertical: { style: BorderStyle.SINGLE, size: 1, color: 'E5E7EB' }\r\n            },\r\n            rows: [\r\n                new TableRow({\r\n                    children: projectCells\r\n                })\r\n            ]\r\n        });\r\n\r\n        sections.push(projectsTable);\r\n        sections.push(new Paragraph({ text: '', spacing: { after: 400 } }));\r\n\r\n        for (const project of sortedProjects) {\r\n            const metrics = calculateProjectMetrics(project, tasks);\r\n            sections.push(...createProjectSection(project, metrics, tasks));\r\n        }\r\n\r\n        const doc = new Document({\r\n            sections: [{\r\n                properties: {},\r\n                children: sections\r\n            }]\r\n        });\r\n\r\n        const blob = await Packer.toBlob(doc);\r\n\r\n        const url = URL.createObjectURL(blob);\r\n        const filename = `Reporte-Nautilus-${new Date().toISOString().split('T')[0]}.docx`;\r\n\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = filename;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        document.body.removeChild(a);\r\n        URL.revokeObjectURL(url);\r\n\r\n        return {\r\n            success: true,\r\n            filename,\r\n            insights: globalInsights\r\n        };\r\n    } catch (error) {\r\n        console.error('Error generating report:', error);\r\n        return {\r\n            success: false,\r\n            error: error.message\r\n        };\r\n    }\r\n}\r\n", "/**\r\n * Internationalization (I18N) Translations\r\n * Contains all UI strings for supported languages\r\n * \r\n * Languages: en (English), es (Spanish)\r\n */\r\n\r\nexport const I18N_LOCALES = {\r\n    en: 'en-US',\r\n    es: 'es-ES'\r\n};\r\n\r\nexport const I18N = {\r\n    en: {\r\n        'boot.loading': 'Loading Nautilus',\r\n        'lock.welcome': 'Welcome back',\r\n        'lock.subtitle': 'Enter the access password to continue.',\r\n        'lock.sessionHint': '? Session stays signed-in for 24 hours.',\r\n        'lock.passwordLabel': 'Password',\r\n        'lock.passwordPlaceholder': 'Enter password',\r\n        'lock.unlock': 'Unlock',\r\n        'auth.backToUserLogin': 'Back to User Login',\r\n        'auth.login.title': 'Welcome to Nautilus',\r\n        'auth.login.subtitle': 'Login to access your workspace',\r\n        'auth.login.identifierLabel': 'Username or Email',\r\n        'auth.login.identifierPlaceholder': 'Enter username or email',\r\n        'auth.login.pinLabel': 'PIN (4 digits)',\r\n        'auth.admin.title': 'Admin Access',\r\n        'auth.admin.subtitle': 'Enter master PIN to access admin dashboard',\r\n        'auth.admin.pinLabel': 'Master PIN (4 digits)',\r\n        'auth.setup.title': 'Complete Your Setup',\r\n        'auth.setup.subtitle': 'Personalize your account',\r\n        'auth.setup.usernameLabel': 'Username',\r\n        'auth.setup.usernamePlaceholder': 'e.g., alex',\r\n        'auth.setup.usernameHint': '3-20 characters, lowercase letters and numbers only',\r\n        'auth.setup.displayNameLabel': 'Display Name',\r\n        'auth.setup.displayNamePlaceholder': 'e.g., Alex Morgan',\r\n        'auth.setup.emailLabel': 'Email',\r\n        'auth.setup.emailPlaceholder': 'your.email@example.com',\r\n        'auth.setup.emailHint': 'Required for notifications and account deletion confirmation',\r\n        'auth.setup.newPinLabel': 'New PIN (4 digits)',\r\n        'auth.setup.confirmPinLabel': 'Confirm PIN',\r\n        'auth.setup.next': 'Next',\r\n        'auth.setup.submit': 'Complete Setup',\r\n        'admin.title': 'User Management',\r\n        'admin.signOut': 'Sign Out',\r\n        'admin.usersTitle': 'Users',\r\n        'admin.createUserTitle': 'Create New User',\r\n        'admin.usernameLabel': 'Username',\r\n        'admin.usernamePlaceholder': 'e.g., jdoe',\r\n        'admin.usernameHint': '3-20 characters, lowercase letters and numbers only',\r\n        'admin.displayNameLabel': 'Display Name',\r\n        'admin.displayNamePlaceholder': 'e.g., John Doe',\r\n        'admin.tempPinLabel': 'Temporary PIN (4 digits)',\r\n        'admin.createUserButton': 'Create User',\r\n        'auth.admin.resetPinPrompt': 'Enter new temporary PIN for {userName}:',\r\n        'auth.admin.pinMustBe4Digits': 'PIN must be exactly 4 digits',\r\n        'auth.admin.resetPinFailed': 'Failed to reset PIN',\r\n        'auth.admin.resetPinSuccess': 'PIN reset for {userName}. New temp PIN: {pin}',\r\n        'auth.admin.deleteUserConfirm': 'Are you sure you want to delete user \\\"{userName}\\\"? This will also delete all their tasks and projects.',\r\n        'auth.admin.deleteUserFailed': 'Failed to delete user',\r\n        'auth.admin.deleteUserSuccess': 'User \\\"{userName}\\\" deleted successfully',\r\n        'common.cancel': 'Cancel',\r\n        'common.delete': 'Delete',\r\n        'common.continue': 'Continue',\r\n        'common.gotIt': 'Got it',\r\n        'common.close': 'Close modal',\r\n        'common.done': 'Done',\r\n        'common.nautilusLogoAlt': 'Nautilus logo',\r\n        'common.devBanner': '\u26A0\uFE0F LOCAL DEV - NOT PRODUCTION \u26A0\uFE0F',\r\n        'common.datePlaceholder': 'dd/mm/yyyy',\r\n        'crop.title': 'Crop Image to Square',\r\n        'crop.instructions': 'Drag to adjust the crop area. The image will be cropped to a square.',\r\n        'crop.apply': 'Crop & Apply',\r\n        'crop.close': 'Close crop modal',\r\n        'dashboard.insights.productivityTitle': 'Productivity Trend',\r\n        'dashboard.insights.productivityDesc': 'Task completion rate increased 23% compared to last month',\r\n        'dashboard.insights.deadlineTitle': 'Deadline Alert',\r\n        'dashboard.insights.deadlineDesc': '3 milestones due within the next 7 days',\r\n        'projects.title': 'Projects',\r\n        'projects.subtitle': 'Manage your projects',\r\n        'projects.searchPlaceholder': '\\u{1F50D} Search projects (title or description)',\r\n        'projects.filters.status': 'Status',\r\n        'projects.filters.statusTitle': 'Project Status',\r\n        'projects.status.backlog': 'BACKLOG',\r\n        'projects.status.planning': 'PLANNING',\r\n        'projects.status.active': 'ACTIVE',\r\n        'projects.status.completed': 'COMPLETED',\r\n        'projects.filters.updated': 'Updated',\r\n        'projects.filters.updatedTitle': 'Recently Updated',\r\n        'projects.filters.all': 'All',\r\n        'projects.filters.last5m': 'Last 5 minutes',\r\n        'projects.filters.last30m': 'Last 30 minutes',\r\n        'projects.filters.last24h': 'Last 24 hours',\r\n        'projects.filters.lastWeek': 'Last week',\r\n        'projects.filters.lastMonth': 'Last month',\r\n        'projects.filters.hasTasks': 'Has tasks',\r\n        'projects.filters.noTasks': 'No tasks',\r\n        'projects.filters.tags': 'Tags',\r\n        'projects.filters.tagsTitle': 'Project Tags',\r\n        'projects.filters.clear': 'Clear Filters',\r\n        'projects.noDescription': 'No description',\r\n        'projects.tasksBreakdown': '{total} tasks \u00B7 {done} done',\r\n        'tasks.card.description': 'Description',\r\n        'projects.card.tasksCount': '{count} tasks',\r\n        'projects.card.percentDone': '{count}% done',\r\n        'projects.sort.label': 'Sort: Status',\r\n        'projects.sort.status': 'Status',\r\n        'projects.sort.name': 'Name',\r\n        'projects.sort.newest': 'Newest',\r\n        'projects.sort.lastUpdated': 'Last Updated',\r\n        'projects.sort.mostTasks': 'Most tasks',\r\n        'projects.sort.percentCompleted': '% Completed',\r\n        'projects.sort.prefix': 'Sort: {label}',\r\n        'projects.sort.help': 'Click the same option again to switch Asc/Desc.',\r\n        'projects.sort.statusLabel': 'Status',\r\n        'projects.sort.nameLabel': 'Name',\r\n        'projects.sort.newestLabel': 'Newest',\r\n        'projects.sort.lastUpdatedLabel': 'Last Updated',\r\n        'projects.sort.mostTasksLabel': 'Most tasks',\r\n        'projects.sort.percentCompletedLabel': '% Completed',\r\n        'projects.newProjectButton': '+ New Project',\r\n        'projects.openDetailsTitle': 'View project details',\r\n        'projects.empty.title': 'No projects yet',\r\n        'projects.empty.subtitle': 'Create your first project',\r\n        'projects.empty.searchTitle': 'No projects found',\r\n        'projects.empty.searchSubtitle': 'Create a new project to get started',\r\n        'projects.empty.filteredTitle': 'No projects matched',\r\n        'projects.modal.createTitle': 'Create New Project',\r\n        'projects.modal.nameLabel': 'Project Name',\r\n        'projects.modal.descriptionLabel': 'Description',\r\n        'projects.modal.startDateLabel': 'Start Date',\r\n        'projects.modal.endDateLabel': 'End Date',\r\n        'projects.modal.tagsLabel': 'Tags',\r\n        'projects.modal.addTagPlaceholder': 'Add tag',\r\n        'projects.modal.createButton': 'Create Project',\r\n        'projects.delete.title': 'Delete Project',\r\n        'projects.delete.body': 'This action cannot be undone. To confirm deletion, type delete below:',\r\n        'projects.delete.deleteTasksLabel': 'Delete all tasks in this project',\r\n        'projects.delete.deleteTasksHint': 'If unchecked, tasks will be unassigned from the project',\r\n        'projects.delete.inputPlaceholder': 'Type delete here',\r\n        'projects.delete.error': 'Type \\\"delete\\\" exactly to confirm',\r\n        'projects.duplicate.title': 'Duplicate Project',\r\n        'projects.duplicate.description': 'Create a copy of this project with all its settings.',\r\n        'projects.duplicate.includeTasksLabel': 'Include all tasks from this project',\r\n        'projects.duplicate.taskNamingTitle': 'Task naming:',\r\n        'projects.duplicate.namingNone': 'Keep original names',\r\n        'projects.duplicate.namingPrefix': 'Add prefix:',\r\n        'projects.duplicate.namingSuffix': 'Add suffix:',\r\n        'projects.duplicate.prefixPlaceholder': 'e.g., Copy - ',\r\n        'projects.duplicate.suffixPlaceholder': 'e.g., (Copy)',\r\n        'projects.duplicate.confirm': 'Duplicate Project',\r\n        'projects.duplicate.success': 'Project \"{name}\" duplicated successfully',\r\n        'projects.duplicate.successWithTasks': 'Project \"{name}\" and its tasks duplicated successfully',\r\n        'projects.statusInfo.title': 'Project Status Logic',\r\n        'projects.statusInfo.subtitle': 'Project status updates automatically based on task progress',\r\n        'projects.statusInfo.backlogTitle': '\u2B1B Backlog',\r\n        'projects.statusInfo.backlogDesc': 'All tasks are in \\\"Backlog\\\"',\r\n        'projects.statusInfo.planningTitle': '\u2B1C Planning',\r\n        'projects.statusInfo.planningDesc': 'All tasks are in \\\"To Do\\\"',\r\n        'projects.statusInfo.activeTitle': '\\u{2705} Active',\r\n        'projects.statusInfo.activeDesc': 'At least one task is \\\"In Progress\\\" or \\\"In Review\\\"',\r\n        'projects.statusInfo.completedTitle': '? Completed',\r\n        'projects.statusInfo.completedDesc': 'All tasks are marked as \\\"Done\\\"',\r\n        'projects.backTo.dashboard': '\u2190 Back to Dashboard',\r\n        'projects.backTo.calendar': '\u2190 Back to Calendar',\r\n        'projects.backTo.projects': '\u2190 Back to Projects',\r\n        'projects.details.tab.details': 'Details',\r\n        'projects.details.tab.history': 'History',\r\n        'projects.details.startDate': 'Start Date',\r\n        'projects.details.endDate': 'End Date',\r\n        'projects.details.duration': 'Duration',\r\n        'projects.details.durationDays': '{count} days',\r\n        'projects.details.created': 'Created',\r\n        'projects.details.calendarColor': 'Calendar Color',\r\n        'projects.details.customColor': 'Custom color',\r\n        'projects.details.progressOverview': 'Progress Overview',\r\n        'projects.details.taskProgress': 'Task Progress',\r\n        'projects.details.tasksTitle': 'Tasks ({count})',\r\n        'projects.details.changeHistory': 'Change History',\r\n        'projects.details.noChanges': 'No changes yet for this project',\r\n        'projects.details.noTasksFound': 'No tasks found',\r\n        'projects.details.viewTodo': 'View To Do tasks for this project',\r\n        'projects.details.viewProgress': 'View In Progress tasks for this project',\r\n        'projects.details.viewReview': 'View In Review tasks for this project',\r\n        'projects.details.viewCompleted': 'View Completed tasks for this project',\r\n        'projects.details.viewBacklog': 'View backlog tasks in List view',\r\n        'projects.untitled': 'Untitled Project',\r\n        'tasks.title': 'All Tasks',\r\n        'tasks.subtitle': 'Manage tasks across all projects',\r\n        'tasks.searchPlaceholder': '\\u{1F50D} Search tasks (title or description)',\r\n        'tasks.filters.status': 'Status',\r\n        'tasks.filters.statusTitle': 'Status',\r\n        'tasks.status.backlog': 'Backlog',\r\n        'tasks.status.todo': 'To Do',\r\n        'tasks.status.progress': 'In Progress',\r\n        'tasks.status.review': 'In Review',\r\n        'tasks.status.done': 'Done',\r\n        'tasks.filters.tags': 'Tags',\r\n        'tasks.filters.tagsTitle': 'Tags',\r\n        'tasks.filters.priority': 'Priority',\r\n        'tasks.filters.priorityTitle': 'Priority',\r\n        'tasks.priority.high': 'High',\r\n        'tasks.priority.medium': 'Medium',\r\n        'tasks.priority.low': 'Low',\r\n        'tasks.filters.project': 'Project',\r\n        'tasks.filters.projectTitle': 'Project',\r\n        'tasks.filters.selectAll': 'Select / Unselect All',\r\n        'tasks.filters.date': 'Date',\r\n        'tasks.filters.endDate': 'End Date',\r\n        'tasks.filters.startDate': 'Start Date',\r\n        'tasks.filters.dateTitle': 'Quick Date Filters',\r\n        'tasks.filters.endDateTitle': 'End Date Filters',\r\n        'tasks.filters.noDate': 'No End Date',\r\n        'tasks.filters.overdue': 'Overdue',\r\n        'tasks.filters.endToday': 'End Date Today',\r\n        'tasks.filters.endTomorrow': 'End Date Tomorrow',\r\n        'tasks.filters.end7Days': 'End Date in 7 Days',\r\n        'tasks.filters.endThisWeek': 'End Date This Week',\r\n        'tasks.filters.endThisMonth': 'End Date This Month',\r\n        'tasks.filters.startDateTitle': 'Start Date Filters',\r\n        'tasks.filters.noStartDate': 'No Start Date',\r\n        'tasks.filters.alreadyStarted': 'Already Started',\r\n        'tasks.filters.startToday': 'Start Date Today',\r\n        'tasks.filters.startTomorrow': 'Start Date Tomorrow',\r\n        'tasks.filters.start7Days': 'Start Date in 7 Days',\r\n        'tasks.filters.startThisWeek': 'Start Date This Week',\r\n        'tasks.filters.startThisMonth': 'Start Date This Month',\r\n        'tasks.filters.updated': 'Updated',\r\n        'tasks.filters.updatedTitle': 'Recently Updated',\r\n        'tasks.filters.dateFrom': 'Start date',\r\n        'tasks.filters.dateTo': 'End date',\r\n        'tasks.filters.clear': 'Clear Filters',\r\n        'tasks.filters.presetActive': 'Active',\r\n        'tasks.filters.presetNotDone': 'Not Done',\r\n        'tasks.filters.presetInProgress': 'In Progress',\r\n        'tasks.filters.include': 'Include',\r\n        'tasks.filters.exclude': 'Exclude',\r\n        'tasks.filters.excluding': 'Excluding',\r\n        'filters.noOtherProjects': 'No other projects',\r\n        'filters.noTags': 'No Tags',\r\n        'filters.noOtherTags': 'No other tags',\r\n        'filters.sheet.title': 'Options',\r\n        'filters.chip.search': 'Search',\r\n        'filters.chip.project': 'Project',\r\n        'filters.chip.tag': 'Tag',\r\n        'filters.chip.date': 'Date',\r\n        'filters.chip.updated': 'Updated',\r\n        'filters.chip.removeAria': 'Remove {label} filter',\r\n        'filters.dateRange.from': 'From',\r\n        'filters.dateRange.until': 'Until',\r\n        'filters.updated.week': 'Week',\r\n        'filters.updated.month': 'Month',\r\n        'tasks.kanban.tipLabel': 'Tip:',\r\n        'tasks.kanban.tipTextBefore': 'In the Kanban Board hold ',\r\n        'tasks.kanban.tipTextAfter': ' (Cmd on Mac) and click to select multiple tasks. Shift-click selects a range, then drag to move them together',\r\n        'tasks.view.kanban': 'Kanban',\r\n        'tasks.view.list': 'List',\r\n        'tasks.view.calendar': 'Calendar',\r\n        'tasks.sort.label': 'Sort: Priority',\r\n        'tasks.sort.orderByPriority': 'Order by Priority',\r\n        'tasks.kanban.showBacklog': 'Show Backlog',\r\n        'tasks.kanban.showProjects': 'Show Projects',\r\n        'tasks.kanban.showNoDate': 'Show \\\"No Date\\\"',\r\n        'tasks.addButton': '+ Add Task',\r\n        'tasks.noProject': 'No Project',\r\n        'tasks.projectIndicatorNone': 'No Project - ',\r\n        'tasks.project.selectPlaceholder': 'Select a project',\r\n        'tasks.tags.none': 'No tags',\r\n        'tasks.checklist.toggle': 'Toggle checkbox',\r\n        'tasks.untitled': 'Untitled task',\r\n        'tasks.startDatePrefix': 'Start Date: ',\r\n        'tasks.endDatePrefix': 'End Date: ',\r\n        'tasks.noDate': 'No date',\r\n        'tasks.noDatesSet': 'No dates set',\r\n        'tasks.noEndDate': 'No End Date',\r\n        'tasks.due.yesterday': 'Yesterday',\r\n        'tasks.due.daysOverdue': '{count} days overdue',\r\n        'tasks.due.tomorrow': 'Tomorrow',\r\n        'tasks.openTaskDetails': 'Open task details',\r\n        'tasks.noTasksInProject': 'No tasks in this project',\r\n        'tasks.attachments.open': 'Open',\r\n        'tasks.attachments.none': 'No attachments',\r\n        'tasks.attachments.remove': 'Remove attachment',\r\n        'tasks.attachments.removeTitle': 'Remove',\r\n        'tasks.attachments.removeLink': 'Remove link',\r\n        'tasks.attachments.googleDoc': 'Google Doc',\r\n        'tasks.attachments.googleSheet': 'Google Sheet',\r\n        'tasks.attachments.googleSlides': 'Google Slides',\r\n        'tasks.attachments.googleDriveFile': 'Google Drive File',\r\n        'tasks.attachments.pdf': 'PDF Document',\r\n        'tasks.attachments.word': 'Word Document',\r\n        'tasks.attachments.excel': 'Excel File',\r\n        'tasks.attachments.powerpoint': 'PowerPoint',\r\n        'tasks.empty.epic': 'No tasks yet. Create your first task for this epic.',\r\n        'tasks.backlogQuickTitle': 'Open Backlog tasks in List view',\r\n        'tasks.backlogQuickLabel': 'Backlog',\r\n        'tasks.kanban.columnBacklog': '\\u{1F9CA} Backlog',\r\n        'tasks.kanban.columnTodo': '\\u{1F4CB} To Do',\r\n        'tasks.kanban.columnProgress': '\\u{1F504} In Progress',\r\n        'tasks.kanban.columnReview': '\\u{2611}\\u{FE0F} In Review',\r\n        'tasks.kanban.columnDone': '\\u{2705} Done',\r\n        'tasks.table.task': 'Task',\r\n        'tasks.table.priority': 'Priority',\r\n        'tasks.table.status': 'Status',\r\n        'tasks.table.tags': 'Tags',\r\n        'tasks.table.project': 'Project',\r\n        'tasks.table.startDate': 'Start Date',\r\n        'tasks.table.endDate': 'End Date',\r\n        'tasks.table.updated': 'Updated',\r\n        'tasks.list.count': '{count} results',\r\n        'tasks.modal.editTitle': 'Edit Task',\r\n        'tasks.modal.duplicate': '\uD83D\uDCC4 Duplicate Task',\r\n        'tasks.modal.delete': '\uD83D\uDDD1\uFE0F Delete Task',\r\n        'tasks.modal.tab.general': 'General',\r\n        'tasks.modal.tab.details': 'Details',\r\n        'tasks.modal.tab.history': 'History',\r\n        'tasks.modal.titleLabel': 'Task Title',\r\n        'tasks.modal.attachmentsLabel': 'Attachments',\r\n        'tasks.modal.attachmentsSupported': 'Supported: Images (10MB), PDFs (20MB), Documents (10MB)',\r\n        'tasks.modal.attachmentsDropzoneDefault': 'Drag & drop or click to attach file',\r\n        'tasks.modal.attachmentsDropzoneTap': 'Click to attach file',\r\n        'tasks.modal.linksLabel': 'Links',\r\n        'tasks.modal.attachmentNamePlaceholder': 'Name (optional)',\r\n        'tasks.modal.attachmentUrlPlaceholder': 'URL',\r\n        'tasks.modal.addLink': 'Add Link',\r\n        'tasks.modal.statusLabel': 'Status',\r\n        'tasks.modal.priorityLabel': 'Priority',\r\n        'tasks.modal.tagsLabel': 'Tags',\r\n        'tasks.modal.addTagPlaceholder': 'Add tag',\r\n        'tasks.modal.projectLabel': 'Project',\r\n        'tasks.modal.projectOpenTitle': 'Open project details',\r\n        'tasks.modal.projectSelect': 'Select a project',\r\n        'tasks.modal.submitCreate': 'Create Task',\r\n        'tasks.modal.listBulleted': '\u2022 List',\r\n        'tasks.modal.listNumbered': '1. List',\r\n        'tasks.modal.insertDivider': 'Insert horizontal divider',\r\n        'tasks.modal.insertCheckbox': 'Insert checkbox',\r\n        'tasks.history.emptyTitle': 'No Changes Yet',\r\n        'tasks.history.emptySubtitle': 'Changes to this task will appear here',\r\n        'calendar.title': 'Calendar',\r\n        'calendar.today': 'Today',\r\n        'calendar.prevMonth': 'Previous month',\r\n        'calendar.nextMonth': 'Next month',\r\n        'calendar.dayItemsTitle': 'Items for {date}',\r\n        'calendar.dayItemsProjects': 'Projects',\r\n        'calendar.dayItemsTasks': 'Tasks',\r\n        'calendar.dayItems.close': 'Close day items',\r\n        'calendar.dayItems.addTask': '+ Add Task',\r\n        'feedback.title': 'Feedback & Issues',\r\n        'feedback.subtitle': 'Report bugs and suggest features',\r\n        'feedback.saveStatus.saved': 'Saved',\r\n        'feedback.saveStatus.saving': 'Saving...',\r\n        'feedback.saveStatus.error': 'Save failed',\r\n        'feedback.saveStatus.offline': 'Offline',\r\n        'feedback.type.bugLabel': '\\u{1F41E} Bug',\r\n        'feedback.type.title': 'Feedback Type',\r\n        'feedback.type.bugOption': '\\u{1F41E} Bug',\r\n        'feedback.type.improvementOption': '\\u{1F4A1} Improvement',\r\n        'feedback.descriptionPlaceholder': 'Describe the issue or idea. You can paste an image directly into this field.',\r\n        'feedback.descriptionPlaceholderShort': 'Describe the issue or idea.',\r\n        'feedback.screenshotAttachTitle': 'Attach screenshot from device',\r\n        'feedback.screenshotDropzoneTap': '\\u{1F4F7} Tap to attach screenshot',\r\n        'feedback.screenshotDropzoneDefault': '\\u{1F4F7} Drag & drop or click to attach screenshot',\r\n        'feedback.screenshotPreviewTitle': 'Screenshot attached',\r\n        'feedback.screenshotPreviewSubtitle': 'Will be saved with this feedback',\r\n        'feedback.screenshotRemove': 'Remove',\r\n        'feedback.screenshotPreviewAlt': 'Feedback screenshot preview',\r\n        'feedback.viewScreenshotTitle': 'View screenshot',\r\n        'feedback.pagination.first': 'First page',\r\n        'feedback.pagination.prev': 'Previous page',\r\n        'feedback.pagination.next': 'Next page',\r\n        'feedback.pagination.last': 'Last page',\r\n        'feedback.pagination.showing': 'Showing {start}-{end} of {total}',\r\n        'feedback.pagination.pageOf': 'Page {current} of {total}',\r\n        'feedback.addButton': 'Add',\r\n        'feedback.pendingTitle': '? Pending',\r\n        'feedback.doneTitle': '? Done',\r\n        'feedback.delete.title': 'Delete Feedback',\r\n        'feedback.delete.body': 'Are you sure you want to delete this feedback?',\r\n        'feedback.empty.pending': 'No pending feedback',\r\n        'feedback.empty.done': 'No completed feedback',\r\n        'export.title': 'Export Data',\r\n        'export.body': 'This will download a complete backup of all your tasks, projects, and settings as a JSON file. Are you sure you want to export your data?',\r\n        'export.confirm': 'Export',\r\n        'import.title': 'Import Data',\r\n        'import.warningTitle': 'WARNING: This is a FULL REPLACEMENT',\r\n        'import.warningBody': 'Importing data will <strong>permanently replace</strong> all your current:',\r\n        'import.warningTasks': 'All tasks',\r\n        'import.warningProjects': 'All projects',\r\n        'import.warningSettings': 'All settings and preferences',\r\n        'import.warningHistory': 'All history records',\r\n        'import.warningIrreversible': 'This action cannot be undone. Your current data will be lost.',\r\n        'import.fileLabel': 'Select backup file to import:',\r\n        'import.dropzoneDefault': 'Drag & drop or click to select backup file',\r\n        'import.fileHint': 'Only JSON files exported from Nautilus are supported',\r\n        'import.previewTitle': 'Import Preview:',\r\n        'import.confirmText': 'To confirm import and replace all your data, type <strong>import</strong> below:',\r\n        'import.inputPlaceholder': 'Type import here',\r\n        'import.error': 'Type \"import\" exactly to confirm',\r\n        'import.button': 'Import Data',\r\n        'import.processing': 'Importing data...',\r\n        'import.success': 'Data imported successfully! All data has been replaced.',\r\n        'import.errorInvalidFile': 'Invalid file type. Please select a JSON file.',\r\n        'import.errorInvalidFormat': 'Invalid file format. The file does not appear to be a valid Nautilus backup.',\r\n        'import.errorParseFailed': 'Failed to parse file. Please ensure the file is valid JSON.',\r\n        'import.errorReadFailed': 'Failed to read file. Please try again.',\r\n        'import.errorNoFile': 'Please select a file to import.',\r\n        'import.errorFailed': 'Failed to import data',\r\n        'confirm.deleteTask.title': 'Delete Task',\r\n        'confirm.deleteTask.body': 'This action cannot be undone. To confirm deletion, type delete below:',\r\n        'confirm.deleteTask.inputPlaceholder': 'Type delete here',\r\n        'confirm.deleteTask.error': 'Type \\\"delete\\\" exactly to confirm',\r\n        'confirm.unsaved.title': 'Unsaved Changes',\r\n        'confirm.unsaved.body': 'You have unsaved changes. Are you sure you want to close and lose them?',\r\n        'confirm.unsaved.discard': 'Discard Changes',\r\n        'confirm.review.title': 'Disable \\\"In Review\\\" Status',\r\n        'error.saveDataFailed': 'Failed to save data. Please try again.',\r\n        'error.saveProjectsFailed': 'Failed to save projects. Please try again.',\r\n        'error.saveTasksFailed': 'Failed to save tasks. Please try again.',\r\n        'error.saveFeedbackFailed': 'Failed to save feedback. Please try again.',\r\n        'error.saveProjectColorsFailed': 'Failed to save project colors.',\r\n        'error.saveTaskFailed': 'Failed to save task. Please try again.',\r\n        'error.saveChangesFailed': 'Failed to save changes. Please try again.',\r\n        'error.saveTaskPositionFailed': 'Failed to save task position. Please try again.',\r\n        'error.saveProjectFailed': 'Failed to save project. Please try again.',\r\n        'error.notLoggedInResetPin': 'You must be logged in to reset your PIN',\r\n        'error.resetPinFailed': 'Failed to reset PIN',\r\n        'error.unauthorized': 'You are not authorized to perform this action',\r\n        'error.deleteAccountFailed': 'Failed to delete account. Please try again.',\r\n        'success.resetPin': 'PIN reset successfully! You will need to re-login with your new PIN.',\r\n        'error.resetPinError': 'An error occurred while resetting your PIN',\r\n        'error.userNameEmpty': 'User name cannot be empty.',\r\n        'error.saveDisplayNameFailed': 'Could not save display name. Please try again.',\r\n        'error.invalidEmail': 'Please enter a valid email address.',\r\n        'error.saveEmailFailed': 'Could not save email. Please try again.',\r\n        'error.saveAvatarFailed': 'Could not save avatar. Please try again.',\r\n        'success.settingsSaved': 'Settings saved successfully!',\r\n        'error.logoSelectFile': 'Please select an image file for the workspace logo.',\r\n        'error.logoTooLarge': 'Please use an image smaller than 2MB for the workspace logo.',\r\n        'error.imageReadFailed': 'Could not read the selected image.',\r\n        'error.imageLoadFailed': 'Could not load the selected image.',\r\n        'error.logoUploadFailed': 'Error uploading logo: {message}',\r\n        'error.cropInvalid': 'Error: Crop state is invalid.',\r\n        'error.cropTooLarge': 'Cropped image is too large. Please select a smaller area or use a smaller source image.',\r\n        'success.cropApplied': 'Image cropped and applied successfully!',\r\n        'success.logoCroppedApplied': 'Workspace logo cropped and applied successfully!',\r\n        'error.cropFailed': 'Error cropping image: {message}',\r\n        'error.avatarSelectFile': 'Please select an image file for your avatar.',\r\n        'error.avatarTooLarge': 'Please use an image smaller than 2MB for your avatar.',\r\n        'error.avatarUploadFailed': 'Failed to upload avatar. Please try again.',\r\n        'error.endDateBeforeStart': 'End date cannot be before start date',\r\n        'error.startDateAfterEnd': 'Start date cannot be after end date',\r\n        'error.feedbackAttachImage': 'Please attach an image file.',\r\n        'error.feedbackReadImage': 'Could not read the image file. Please try again.',\r\n        'error.feedbackStatusFailed': 'Failed to update feedback status. Please try again.',\r\n        'error.attachmentSaveFailed': 'Failed to save attachment. Please try again.',\r\n        'error.attachmentLoadFailed': 'Failed to load image: {message}',\r\n        'success.fileDownloaded': 'File downloaded!',\r\n        'error.fileDownloadFailed': 'Failed to download file: {message}',\r\n        'success.attachmentDeletedFromStorage': '{name} deleted from storage',\r\n        'error.fileDeleteFailed': 'Failed to delete file from storage',\r\n        'success.attachmentRemoved': 'Attachment removed',\r\n        'error.fileSizeTooLarge': 'File size must be less than {maxMB}MB. Please choose a smaller file.',\r\n        'success.fileUploaded': 'File uploaded successfully!',\r\n        'error.fileUploadFailed': 'Error uploading file: {message}',\r\n        'error.selectFile': 'Please select a file',\r\n        'error.saveTagFailed': 'Failed to save tag. Please try again.',\r\n        'error.removeTagFailed': 'Failed to remove tag. Please try again.',\r\n        'error.openScreenshotFailed': 'Could not open screenshot',\r\n        'history.sort.newest': '\u2191 Newest First',\r\n        'history.sort.oldest': '\u2193 Oldest First',\r\n        'history.field.title': 'Title',\r\n        'history.field.name': 'Name',\r\n        'history.field.description': 'Description',\r\n        'history.field.status': 'Status',\r\n        'history.field.priority': 'Priority',\r\n        'history.field.category': 'Category',\r\n        'history.field.startDate': 'Start Date',\r\n        'history.field.endDate': 'End Date',\r\n        'history.field.link': 'Link',\r\n        'history.field.task': 'Link',\r\n        'history.field.projectId': 'Project',\r\n        'history.field.tags': 'Tags',\r\n        'history.field.attachments': 'Attachments',\r\n        'history.action.created': 'Created',\r\n        'history.action.deleted': 'Deleted',\r\n        'history.link.added': 'Added',\r\n        'history.link.removed': 'Removed',\r\n        'history.entity.task': 'task',\r\n        'history.value.empty': 'empty',\r\n        'history.value.none': 'none',\r\n        'history.change.beforeLabel': 'Before:',\r\n        'history.change.afterLabel': 'After:',\r\n        'history.change.notSet': 'Not set',\r\n        'history.change.removed': 'Removed',\r\n        'history.tags.none': 'No tags',\r\n        'history.attachments.none': 'No attachments',\r\n        'history.attachments.countSingle': '{count} file',\r\n        'history.attachments.countPlural': '{count} files',\r\n        'history.project.fallback': 'Project #{id}',\r\n        'history.change.arrow': '\u2192',\r\n        'menu.openMenu': 'Open menu',\r\n        'menu.language': 'Language',\r\n        'menu.darkMode': 'Dark mode',\r\n        'menu.lightMode': 'Light mode',\r\n        'menu.settings': 'Settings',\r\n        'menu.help': 'Help',\r\n        'menu.signOut': 'Sign out',\r\n        'nav.overview': 'Overview',\r\n        'nav.dashboard': 'Dashboard',\r\n        'nav.updates': 'Release notes',\r\n        'nav.calendar': 'Calendar',\r\n        'nav.work': 'Work',\r\n        'nav.projects': 'Projects',\r\n        'nav.allTasks': 'All Tasks',\r\n        'nav.feedback': 'Feedback',\r\n        'updates.title': 'Release notes',\r\n        'updates.subtitle': 'Latest change log for Nautilus',\r\n        'updates.latestLabel': 'Latest release',\r\n        'updates.historyLabel': 'Release log',\r\n        'updates.sections.new': 'New',\r\n        'updates.sections.improvements': 'Improvements',\r\n        'updates.sections.fixes': 'Fixes',\r\n        'updates.empty': 'No release notes yet.',\r\n        'updates.sectionEmpty': 'Nothing listed yet.',\r\n        'updates.historyEmpty': 'No previous releases yet.',\r\n        'notifications.title': 'Notifications',\r\n        'notifications.toggle': 'Notifications',\r\n        'notifications.today': 'Today',\r\n        'notifications.yesterday': 'Yesterday',\r\n        'notifications.clearAll': 'Clear all',\r\n        'notifications.releaseTitle': 'New release',\r\n        'notifications.releaseCta': 'View updates',\r\n        'notifications.releaseMeta': 'Released {date}',\r\n        'notifications.dueTodayTitle': 'Due today',\r\n        'notifications.dueTodayCta': 'View tasks',\r\n        'notifications.dueTodayMetaOne': '{count} task due today',\r\n        'notifications.dueTodayMetaMany': '{count} tasks due today',\r\n        'notifications.dueTodayMore': 'and {count} more tasks',\r\n        'notifications.empty': 'You are all caught up.',\r\n        'settings.title': 'Settings',\r\n        'settings.subtitle': 'Manage your preferences and application settings',\r\n        'settings.section.profile': 'Profile',\r\n        'settings.displayName': 'Display Name',\r\n        'settings.displayNameHint': 'This name is displayed throughout the application',\r\n        'settings.placeholder.displayName': 'Enter your display name',\r\n        'settings.email': 'Email',\r\n        'settings.emailHint': 'Used for your account and deadline notifications',\r\n        'settings.placeholder.email': 'Enter your email',\r\n        'settings.avatar': 'Avatar',\r\n        'settings.avatarHint': 'Upload an image for your avatar (max 2MB). It will be displayed as a circle.',\r\n        'settings.avatarRemoveTitle': 'Remove avatar',\r\n        'settings.workspaceLogo': 'Workspace Logo',\r\n        'settings.workspaceLogoHint': 'Upload a square image to replace the Nautilus logo (max 2MB).',\r\n        'settings.workspaceLogoRemoveTitle': 'Remove custom logo',\r\n        'settings.section.application': 'Application',\r\n        'settings.enableReviewStatus': 'Enable In Review status',\r\n        'settings.enableReviewStatusHint': 'Show or hide the IN REVIEW status column and filter option',\r\n        'settings.enableReviewStatusHintPrefix': 'Show or hide the',\r\n        'settings.enableReviewStatusHintSuffix': 'status column and filter option',\r\n        'settings.calendarIncludeBacklog': 'Show backlog in calendar',\r\n        'settings.calendarIncludeBacklogHint': 'Display backlog tasks in all calendar views',\r\n        'settings.autoStartDate': 'Auto-set start date',\r\n        'settings.autoStartDateHint': 'Automatically set Start Date when task status changes to \"In Progress\" (if empty)',\r\n        'settings.autoEndDate': 'Auto-set end date',\r\n        'settings.autoEndDateHint': 'Automatically set End Date when task status changes to \"Done\" (if empty)',\r\n        'settings.debugLogs': 'Enable debug logs',\r\n        'settings.debugLogsHint': 'Capture diagnostic logs in the browser console when enabled',\r\n        'settings.historySortOrder': 'History Sort Order',\r\n        'settings.historySortOrderHint': 'Default sort order for task and project history timelines',\r\n        'settings.historySortNewest': 'Newest First',\r\n        'settings.historySortOldest': 'Oldest First',\r\n        'settings.language': 'Language',\r\n        'settings.languageHint': 'Choose the application language',\r\n        'settings.section.notifications': 'Notifications',\r\n        'settings.emailNotifications': 'Email notifications',\r\n        'settings.emailNotificationsHint': 'Enable or disable deadline reminder emails',\r\n        'settings.weekdaysOnly': 'Weekdays only',\r\n        'settings.weekdaysOnlyHint': 'Skip emails on Saturday and Sunday',\r\n        'settings.includeStartDates': 'Notify when tasks start',\r\n        'settings.includeStartDatesHint': 'Send reminders when a task starts (e.g., today)',\r\n        'settings.includeBacklog': 'Include backlog tasks',\r\n        'settings.includeBacklogHint': 'Include backlog tasks in email and in-app notifications',\r\n        'settings.sendTime': 'Send time',\r\n        'settings.sendTimeHint': 'Daily time to send reminders (08:00-18:00, 30-minute increments)',\r\n        'settings.timeZone': 'Time zone',\r\n        'settings.timeZoneHint': 'Keeps the same local time year-round (DST-aware)',\r\n        'settings.timeZone.option.argentina': 'Argentina (Buenos Aires)',\r\n        'settings.timeZone.option.canary': 'Canary Islands (Atlantic/Canary)',\r\n        'settings.timeZone.option.spain': 'Spain mainland (Europe/Madrid)',\r\n        'settings.timeZone.option.utc': 'UTC',\r\n        'settings.section.security': 'Security',\r\n        'settings.pinManagement': 'PIN Management',\r\n        'settings.pinManagementHint': 'Reset your PIN to a new 4-digit code',\r\n        'settings.resetPinButton': 'Reset PIN',\r\n        'settings.section.dataManagement': 'Data Management',\r\n        'settings.exportData': 'Export Data',\r\n        'settings.exportDataHint': 'Download a complete backup of all your tasks, projects, and settings as a JSON file',\r\n        'settings.exportButton': 'Export',\r\n        'settings.importData': 'Import Data',\r\n        'settings.importDataHint': 'Import a backup file to replace all your current data. This action cannot be undone.',\r\n        'settings.importButton': 'Import Data',\r\n        'settings.section.dangerZone': 'Danger Zone',\r\n        'settings.deleteAccount': 'Delete Account',\r\n        'settings.deleteAccountHint': 'Permanently delete your account and all associated data. This action cannot be undone.',\r\n        'settings.deleteAccountButton': 'Delete Account',\r\n        'settings.deleteAccount.title': 'Delete Account',\r\n        'settings.deleteAccount.warning': 'This action <strong>cannot be undone</strong>. You will permanently lose:',\r\n        'settings.deleteAccount.loseTasks': 'All your tasks',\r\n        'settings.deleteAccount.loseProjects': 'All your projects',\r\n        'settings.deleteAccount.loseData': 'All your account data and settings',\r\n        'settings.deleteAccount.confirmText': 'To confirm account deletion, type <strong>delete</strong> below:',\r\n        'settings.deleteAccount.inputPlaceholder': 'Type delete here',\r\n        'settings.deleteAccount.error': 'Type \"delete\" exactly to confirm',\r\n        'settings.deleteAccount.button': 'Delete Account',\r\n        'settings.deleteAccount.success': 'Account deleted successfully. Redirecting to login...',\r\n        'settings.cancelButton': 'Cancel',\r\n        'settings.saveButton': 'Save Settings',\r\n        'settings.avatarUploadDefault': 'Drag & drop or click to upload avatar',\r\n        'settings.avatarUploadChange': 'Change avatar',\r\n        'settings.avatarUploadAriaUpload': 'Upload avatar',\r\n        'settings.avatarUploadAriaChange': 'Change avatar',\r\n        'settings.logoUploadDefault': 'Drag & drop or click to upload logo',\r\n        'settings.logoUploadChange': 'Change logo',\r\n        'settings.logoUploadAriaUpload': 'Upload logo',\r\n        'settings.logoUploadAriaChange': 'Change logo',\r\n        'dashboard.title': 'Dashboard',\r\n        'dashboard.hero.activeProjectsLabel': 'Active Projects',\r\n        'dashboard.hero.completionRateLabel': 'Completion Rate',\r\n        'dashboard.hero.tasksCompletionRateLabel': 'Tasks Completion',\r\n        'dashboard.hero.projectsCompletionRateLabel': 'Projects Completion',\r\n        'dashboard.hero.projectsTrend': '\uD83D\uDCC8 +2 this month',\r\n        'dashboard.hero.completionTrend': '\uD83C\uDFAF Target: 80%',\r\n        'dashboard.projectAnalytics': '\uD83D\uDCCA Project Analytics',\r\n        'dashboard.period.week': 'Week',\r\n        'dashboard.period.month': 'Month',\r\n        'dashboard.period.quarter': 'Quarter',\r\n        'dashboard.stat.pendingTasks': 'Pending Tasks',\r\n        'dashboard.stat.inProgress': 'In Progress',\r\n        'dashboard.stat.highPriority': 'High Priority',\r\n        'dashboard.stat.overdue': 'Overdue',\r\n        'dashboard.stat.completed': 'Completed',\r\n        'dashboard.stat.projects': 'Projects',\r\n        'dashboard.highPriorityHint': 'High priority tasks due within 7 days (or overdue)',\r\n        'dashboard.projectProgress': '\uD83C\uDF0A Project Progress',\r\n        'dashboard.legend.todo': 'To Do',\r\n        'dashboard.legend.progress': 'In Progress',\r\n        'dashboard.legend.review': 'In Review',\r\n        'dashboard.legend.complete': 'Complete',\r\n        'dashboard.viewAll': 'View All',\r\n        'dashboard.quickActions': '\u26A1 Quick Actions',\r\n        'dashboard.action.generateReport': 'Generate Report',\r\n        'dashboard.action.addTask': 'Add Task',\r\n        'dashboard.action.viewCalendar': 'View Calendar',\r\n        'dashboard.action.newProject': 'New Project',\r\n        'dashboard.recentActivity': '\\u{1F504} Recent Activity',\r\n        'dashboard.researchInsights': '\uD83E\uDDE0 Insights',\r\n        'dashboard.activity.emptyTitle': 'Welcome to your Dashboard!',\r\n        'dashboard.activity.emptySubtitle': 'Start creating projects and tasks to see activity',\r\n        'dashboard.activity.completed': 'Completed \"{title}\" {projectPart}',\r\n        'dashboard.activity.createdProject': 'Created new project \"{project}\"',\r\n        'dashboard.activity.addedTask': 'Added new task \"{title}\" {projectPart}',\r\n        'dashboard.activity.inProject': 'in {project}',\r\n        'dashboard.activity.toProject': 'to {project}',\r\n        'dashboard.activity.recently': 'Recently',\r\n        'dashboard.activity.justNow': 'Just now',\r\n        'dashboard.activity.today': 'Today',\r\n        'dashboard.activity.yesterday': 'Yesterday',\r\n        'dashboard.activity.daysAgoShort': '{count}d ago',\r\n        'dashboard.activity.minuteAgo': '{count} minute ago',\r\n        'dashboard.activity.minutesAgo': '{count} minutes ago',\r\n        'dashboard.activity.hourAgo': '{count} hour ago',\r\n        'dashboard.activity.hoursAgo': '{count} hours ago',\r\n        'dashboard.activity.dayAgo': '{count} day ago',\r\n        'dashboard.activity.daysAgo': '{count} days ago',\r\n        'dashboard.trend.thisWeek': 'this week',\r\n        'dashboard.trend.thisMonth': 'this month',\r\n        'dashboard.trend.thisQuarter': 'this quarter',\r\n        'dashboard.trend.dueTodayOne': '{count} due today',\r\n        'dashboard.trend.dueTodayMany': '{count} due today',\r\n        'dashboard.trend.onTrack': 'On track',\r\n        'dashboard.trend.needsAttention': 'Needs attention',\r\n        'dashboard.trend.allOnTrack': 'All on track',\r\n        'dashboard.trend.criticalOne': '{count} critical',\r\n        'dashboard.trend.criticalMany': '{count} critical',\r\n        'dashboard.trend.completedOne': '{count} completed',\r\n        'dashboard.trend.completedMany': '{count} completed',\r\n        'dashboard.trend.inProgress': 'In progress',\r\n        'dashboard.emptyProjects.title': 'No projects yet',\r\n        'dashboard.emptyProjects.subtitle': 'Create your first project to see progress visualization',\r\n        'dashboard.tasks': 'tasks',\r\n        'dashboard.activity.allTitle': 'All Recent Activity',\r\n        'dashboard.activity.allSubtitle': 'Full history of your recent work',\r\n        'dashboard.activity.backToDashboard': '\u2190 Back to Dashboard',\r\n        'dashboard.insights.excellentTitle': 'Excellent Progress',\r\n        'dashboard.insights.excellentDesc': '{percent}% completion rate exceeds target. Great momentum!',\r\n        'dashboard.insights.goodTitle': 'Good Progress',\r\n        'dashboard.insights.goodDesc': '{percent}% completion rate is solid. Consider pushing to reach 80% target.',\r\n        'dashboard.insights.opportunityTitle': 'Progress Opportunity',\r\n        'dashboard.insights.opportunityDesc': '{percent}% completion rate. Focus on completing current tasks to build momentum.',\r\n        'dashboard.insights.actionTitle': 'Action Needed',\r\n        'dashboard.insights.actionDesc': '{percent}% completion rate is low. Break down large tasks and tackle smaller ones first.',\r\n        'dashboard.insights.todayTitle': 'Today\\'s Focus',\r\n        'dashboard.insights.todayDescOne': '{count} task is due today. Prioritize it for maximum impact.',\r\n        'dashboard.insights.todayDescMany': '{count} tasks are due today. Prioritize them for maximum impact.',\r\n        'dashboard.insights.overdueTitle': 'Overdue Items',\r\n        'dashboard.insights.overdueDescOne': '{count} overdue task needs attention. Address it to prevent delays.',\r\n        'dashboard.insights.overdueDescMany': '{count} overdue tasks need attention. Address these to prevent delays.',\r\n        'dashboard.insights.highPriorityTitle': 'High Priority Focus',\r\n        'dashboard.insights.highPriorityDescOne': '{count} high-priority task needs immediate attention.',\r\n        'dashboard.insights.highPriorityDescMany': '{count} high-priority tasks need immediate attention.',\r\n        'dashboard.insights.emptyProjectsTitle': 'Empty Projects',\r\n        'dashboard.insights.emptyProjectsDescOne': '{count} project has no tasks yet. Add tasks to track progress.',\r\n        'dashboard.insights.emptyProjectsDescMany': '{count} projects have no tasks yet. Add tasks to track progress.',\r\n        'dashboard.insights.momentumTitle': 'Strong Momentum',\r\n        'dashboard.insights.momentumDescOne': '{count} task completed this week. You\\'re in a productive flow!',\r\n        'dashboard.insights.momentumDescMany': '{count} tasks completed this week. You\\'re in a productive flow!',\r\n        'dashboard.insights.readyTitle': 'Ready to Start',\r\n        'dashboard.insights.readyDesc': 'Create your first project and add some tasks to begin tracking your progress.',\r\n        'dashboard.insights.caughtUpTitle': 'All Caught Up',\r\n        'dashboard.insights.caughtUpDesc': 'Great work! No urgent items detected. Consider planning your next milestones.'\r\n    },\r\n    es: {\r\n        'boot.loading': 'Cargando Nautilus',\r\n        'lock.welcome': 'Bienvenido de nuevo',\r\n        'lock.subtitle': 'Ingresa la contrase\u00F1a de acceso para continuar.',\r\n        'lock.sessionHint': '? La sesi\u00F3n permanece iniciada por 24 horas.',\r\n        'lock.passwordLabel': 'Contrase\u00F1a',\r\n        'lock.passwordPlaceholder': 'Ingresa la contrase\u00F1a',\r\n        'lock.unlock': 'Desbloquear',\r\n        'auth.backToUserLogin': 'Volver al inicio de sesi\u00F3n',\r\n        'auth.login.title': 'Bienvenido a Nautilus',\r\n        'auth.login.subtitle': 'Inicia sesi\u00F3n para acceder a tu espacio',\r\n        'auth.login.identifierLabel': 'Usuario o correo',\r\n        'auth.login.identifierPlaceholder': 'Ingresa usuario o correo',\r\n        'auth.login.pinLabel': 'PIN (4 d\u00EDgitos)',\r\n        'auth.admin.title': 'Acceso de administraci\u00F3n',\r\n        'auth.admin.subtitle': 'Ingresa el PIN maestro para acceder al panel de administraci\u00F3n',\r\n        'auth.admin.pinLabel': 'PIN maestro (4 d\u00EDgitos)',\r\n        'auth.setup.title': 'Completa tu configuraci\u00F3n',\r\n        'auth.setup.subtitle': 'Personaliza tu cuenta',\r\n        'auth.setup.usernameLabel': 'Usuario',\r\n        'auth.setup.usernamePlaceholder': 'p. ej., alex',\r\n        'auth.setup.usernameHint': '3-20 caracteres, solo letras min\u00FAsculas y n\u00FAmeros',\r\n        'auth.setup.displayNameLabel': 'Nombre visible',\r\n        'auth.setup.displayNamePlaceholder': 'p. ej., Alex Morgan',\r\n        'auth.setup.emailLabel': 'Correo electr\u00F3nico',\r\n        'auth.setup.emailPlaceholder': 'tu.correo@ejemplo.com',\r\n        'auth.setup.emailHint': 'Necesario para notificaciones y confirmaci\u00F3n de eliminaci\u00F3n de cuenta',\r\n        'auth.setup.newPinLabel': 'Nuevo PIN (4 d\u00EDgitos)',\r\n        'auth.setup.confirmPinLabel': 'Confirmar PIN',\r\n        'auth.setup.next': 'Siguiente',\r\n        'auth.setup.submit': 'Completar configuraci\u00F3n',\r\n        'admin.title': 'Gesti\u00F3n de usuarios',\r\n        'admin.signOut': 'Cerrar sesi\u00F3n',\r\n        'admin.usersTitle': 'Usuarios',\r\n        'admin.createUserTitle': 'Crear nuevo usuario',\r\n        'admin.usernameLabel': 'Usuario',\r\n        'admin.usernamePlaceholder': 'p. ej., jdoe',\r\n        'admin.usernameHint': '3-20 caracteres, solo letras min\u00FAsculas y n\u00FAmeros',\r\n        'admin.displayNameLabel': 'Nombre visible',\r\n        'admin.displayNamePlaceholder': 'p. ej., John Doe',\r\n        'admin.tempPinLabel': 'PIN temporal (4 d\u00EDgitos)',\r\n        'admin.createUserButton': 'Crear usuario',\r\n        'auth.admin.resetPinPrompt': 'Ingresa un nuevo PIN temporal para {userName}:',\r\n        'auth.admin.pinMustBe4Digits': 'El PIN debe tener exactamente 4 d\u00EDgitos',\r\n        'auth.admin.resetPinFailed': 'No se pudo restablecer el PIN',\r\n        'auth.admin.resetPinSuccess': 'PIN restablecido para {userName}. Nuevo PIN temporal: {pin}',\r\n        'auth.admin.deleteUserConfirm': '\u00BFSeguro que deseas eliminar al usuario \\\"{userName}\\\"? Esto tambi\u00E9n eliminar\u00E1 todas sus tareas y proyectos.',\r\n        'auth.admin.deleteUserFailed': 'No se pudo eliminar el usuario',\r\n        'auth.admin.deleteUserSuccess': 'Usuario \\\"{userName}\\\" eliminado correctamente',\r\n        'common.cancel': 'Cancelar',\r\n        'common.delete': 'Eliminar',\r\n        'common.continue': 'Continuar',\r\n        'common.gotIt': 'Entendido',\r\n        'common.close': 'Cerrar modal',\r\n        'common.done': 'Listo',\r\n        'common.nautilusLogoAlt': 'Logo de Nautilus',\r\n        'common.devBanner': '\u26A0\uFE0F DESARROLLO LOCAL - NO PRODUCCI\u00D3N \u26A0\uFE0F',\r\n        'common.datePlaceholder': 'dd/mm/yyyy',\r\n        'crop.title': 'Recortar imagen a cuadrado',\r\n        'crop.instructions': 'Arrastra para ajustar el \u00E1rea de recorte. La imagen se recortar\u00E1 a un cuadrado.',\r\n        'crop.apply': 'Recortar y aplicar',\r\n        'crop.close': 'Cerrar recorte',\r\n        'dashboard.insights.productivityTitle': 'Tendencia de productividad',\r\n        'dashboard.insights.productivityDesc': 'La tasa de finalizaci\u00F3n de tareas aument\u00F3 un 23% respecto al mes pasado',\r\n        'dashboard.insights.deadlineTitle': 'Alerta de plazos',\r\n        'dashboard.insights.deadlineDesc': '3 hitos vencen en los pr\u00F3ximos 7 d\u00EDas',\r\n        'projects.title': 'Proyectos',\r\n        'projects.subtitle': 'Gestiona tus proyectos',\r\n        'projects.searchPlaceholder': '\\u{1F50D} Buscar proyectos (t\u00EDtulo o descripci\u00F3n)',\r\n        'projects.filters.status': 'Estado',\r\n        'projects.filters.statusTitle': 'Estado del proyecto',\r\n        'projects.status.backlog': 'BACKLOG',\r\n        'projects.status.planning': 'PLANIFICACI\u00D3N',\r\n        'projects.status.active': 'ACTIVO',\r\n        'projects.status.completed': 'COMPLETADO',\r\n        'projects.filters.updated': 'Actualizado',\r\n        'projects.filters.updatedTitle': 'Actualizados recientemente',\r\n        'projects.filters.all': 'Todos',\r\n        'projects.filters.last5m': '\u00DAltimos 5 minutos',\r\n        'projects.filters.last30m': '\u00DAltimos 30 minutos',\r\n        'projects.filters.last24h': '\u00DAltimas 24 horas',\r\n        'projects.filters.lastWeek': '\u00DAltima semana',\r\n        'projects.filters.lastMonth': '\u00DAltimo mes',\r\n        'projects.filters.hasTasks': 'Con tareas',\r\n        'projects.filters.noTasks': 'Sin tareas',\r\n        'projects.filters.tags': 'Etiquetas',\r\n        'projects.filters.tagsTitle': 'Etiquetas de proyectos',\r\n        'projects.filters.clear': 'Limpiar filtros',\r\n        'projects.noDescription': 'Sin descripcion',\r\n        'projects.tasksBreakdown': '{total} tareas \u00B7 {done} hechas',\r\n        'tasks.card.description': 'Descripcion',\r\n        'projects.card.tasksCount': '{count} tareas',\r\n        'projects.card.percentDone': '{count}% hecho',\r\n        'projects.sort.label': 'Ordenar: Estado',\r\n        'projects.sort.status': 'Estado',\r\n        'projects.sort.name': 'Nombre',\r\n        'projects.sort.newest': 'M\u00E1s reciente',\r\n        'projects.sort.lastUpdated': '\u00DAltima actualizaci\u00F3n',\r\n        'projects.sort.mostTasks': 'M\u00E1s tareas',\r\n        'projects.sort.percentCompleted': '% completado',\r\n        'projects.sort.prefix': 'Ordenar: {label}',\r\n        'projects.sort.help': 'Repite la misma opci\u00F3n para alternar Asc/Desc.',\r\n        'projects.sort.statusLabel': 'Estado',\r\n        'projects.sort.nameLabel': 'Nombre',\r\n        'projects.sort.newestLabel': 'M\u00E1s reciente',\r\n        'projects.sort.lastUpdatedLabel': '\u00DAltima actualizaci\u00F3n',\r\n        'projects.sort.mostTasksLabel': 'M\u00E1s tareas',\r\n        'projects.sort.percentCompletedLabel': '% completado',\r\n        'projects.newProjectButton': '+ Nuevo proyecto',\r\n        'projects.openDetailsTitle': 'Ver detalles del proyecto',\r\n        'projects.empty.title': 'A\u00FAn no hay proyectos',\r\n        'projects.empty.subtitle': 'Crea tu primer proyecto',\r\n        'projects.empty.searchTitle': 'No se encontraron proyectos',\r\n        'projects.empty.searchSubtitle': 'Crea un nuevo proyecto para empezar',\r\n        'projects.empty.filteredTitle': 'No hubo coincidencias de proyectos',\r\n        'projects.modal.createTitle': 'Crear nuevo proyecto',\r\n        'projects.modal.nameLabel': 'Nombre del proyecto',\r\n        'projects.modal.descriptionLabel': 'Descripci\u00F3n',\r\n        'projects.modal.startDateLabel': 'Fecha de inicio',\r\n        'projects.modal.endDateLabel': 'Fecha de fin',\r\n        'projects.modal.tagsLabel': 'Etiquetas',\r\n        'projects.modal.addTagPlaceholder': 'A\u00F1adir etiqueta',\r\n        'projects.modal.createButton': 'Crear proyecto',\r\n        'projects.delete.title': 'Eliminar proyecto',\r\n        'projects.delete.body': 'Esta acci\u00F3n no se puede deshacer. Para confirmar, escribe delete abajo:',\r\n        'projects.delete.deleteTasksLabel': 'Eliminar todas las tareas de este proyecto',\r\n        'projects.delete.deleteTasksHint': 'Si no se marca, las tareas se desasignar\u00E1n del proyecto',\r\n        'projects.delete.inputPlaceholder': 'Escribe delete aqu\u00ED',\r\n        'projects.delete.error': 'Escribe \\\"delete\\\" exactamente para confirmar',\r\n        'projects.duplicate.title': 'Duplicar proyecto',\r\n        'projects.duplicate.description': 'Crear una copia de este proyecto con toda su configuraci\u00F3n.',\r\n        'projects.duplicate.includeTasksLabel': 'Incluir todas las tareas de este proyecto',\r\n        'projects.duplicate.taskNamingTitle': 'Nomenclatura de tareas:',\r\n        'projects.duplicate.namingNone': 'Mantener nombres originales',\r\n        'projects.duplicate.namingPrefix': 'Agregar prefijo:',\r\n        'projects.duplicate.namingSuffix': 'Agregar sufijo:',\r\n        'projects.duplicate.prefixPlaceholder': 'ej., Copia - ',\r\n        'projects.duplicate.suffixPlaceholder': 'ej., (Copia)',\r\n        'projects.duplicate.confirm': 'Duplicar proyecto',\r\n        'projects.duplicate.success': 'Proyecto \"{name}\" duplicado exitosamente',\r\n        'projects.duplicate.successWithTasks': 'Proyecto \"{name}\" y sus tareas duplicados exitosamente',\r\n        'projects.statusInfo.title': 'L\u00F3gica del estado del proyecto',\r\n        'projects.statusInfo.subtitle': 'El estado del proyecto se actualiza autom\u00E1ticamente seg\u00FAn el progreso de las tareas',\r\n        'projects.statusInfo.backlogTitle': '\u2B1B Backlog',\r\n        'projects.statusInfo.backlogDesc': 'Todas las tareas est\u00E1n en \\\"Backlog\\\"',\r\n        'projects.statusInfo.planningTitle': '\u2B1C Planificaci\u00F3n',\r\n        'projects.statusInfo.planningDesc': 'Todas las tareas est\u00E1n en \\\"Por hacer\\\"',\r\n        'projects.statusInfo.activeTitle': '\\u{2705} Activo',\r\n        'projects.statusInfo.activeDesc': 'Al menos una tarea est\u00E1 en \\\"En progreso\\\" o \\\"En revisi\u00F3n\\\"',\r\n        'projects.statusInfo.completedTitle': '? Completado',\r\n        'projects.statusInfo.completedDesc': 'Todas las tareas est\u00E1n marcadas como \\\"Hecho\\\"',\r\n        'projects.backTo.dashboard': '\u2190 Volver al panel',\r\n        'projects.backTo.calendar': '\u2190 Volver al calendario',\r\n        'projects.backTo.projects': '\u2190 Volver a proyectos',\r\n        'projects.details.tab.details': 'Detalles',\r\n        'projects.details.tab.history': 'Historial',\r\n        'projects.details.startDate': 'Fecha de inicio',\r\n        'projects.details.endDate': 'Fecha de fin',\r\n        'projects.details.duration': 'Duraci\u00F3n',\r\n        'projects.details.durationDays': '{count} d\u00EDas',\r\n        'projects.details.created': 'Creado',\r\n        'projects.details.calendarColor': 'Color del calendario',\r\n        'projects.details.customColor': 'Color personalizado',\r\n        'projects.details.progressOverview': 'Resumen de progreso',\r\n        'projects.details.taskProgress': 'Progreso de tareas',\r\n        'projects.details.tasksTitle': 'Tareas ({count})',\r\n        'projects.details.changeHistory': 'Historial de cambios',\r\n        'projects.details.noChanges': 'A\u00FAn no hay cambios para este proyecto',\r\n        'projects.details.noTasksFound': 'No se encontraron tareas',\r\n        'projects.details.viewTodo': 'Ver tareas Por hacer de este proyecto',\r\n        'projects.details.viewProgress': 'Ver tareas En progreso de este proyecto',\r\n        'projects.details.viewReview': 'Ver tareas En revisi\u00F3n de este proyecto',\r\n        'projects.details.viewCompleted': 'Ver tareas Completadas de este proyecto',\r\n        'projects.details.viewBacklog': 'Ver tareas de backlog en vista de lista',\r\n        'projects.untitled': 'Proyecto sin t\u00EDtulo',\r\n        'tasks.title': 'Todas las tareas',\r\n        'tasks.subtitle': 'Gestiona tareas de todos los proyectos',\r\n        'tasks.searchPlaceholder': '\\u{1F50D} Buscar tareas (t\u00EDtulo o descripci\u00F3n)',\r\n        'tasks.filters.status': 'Estado',\r\n        'tasks.filters.statusTitle': 'Estado',\r\n        'tasks.status.backlog': 'Backlog',\r\n        'tasks.status.todo': 'Por hacer',\r\n        'tasks.status.progress': 'En progreso',\r\n        'tasks.status.review': 'En revisi\u00F3n',\r\n        'tasks.status.done': 'Hecho',\r\n        'tasks.filters.tags': 'Etiquetas',\r\n        'tasks.filters.tagsTitle': 'Etiquetas',\r\n        'tasks.filters.priority': 'Prioridad',\r\n        'tasks.filters.priorityTitle': 'Prioridad',\r\n        'tasks.priority.high': 'Alta',\r\n        'tasks.priority.medium': 'Media',\r\n        'tasks.priority.low': 'Baja',\r\n        'tasks.filters.project': 'Proyecto',\r\n        'tasks.filters.projectTitle': 'Proyecto',\r\n        'tasks.filters.selectAll': 'Seleccionar / deseleccionar todo',\r\n        'tasks.filters.date': 'Fecha',\r\n        'tasks.filters.endDate': 'Fecha de Fin',\r\n        'tasks.filters.startDate': 'Fecha de Inicio',\r\n        'tasks.filters.dateTitle': 'Filtros r\u00E1pidos por fecha',\r\n        'tasks.filters.endDateTitle': 'Filtros de Fecha de Fin',\r\n        'tasks.filters.noDate': 'Sin fecha de fin',\r\n        'tasks.filters.overdue': 'Vencidas',\r\n        'tasks.filters.endToday': 'Fecha de fin hoy',\r\n        'tasks.filters.endTomorrow': 'Fecha de fin ma\u00F1ana',\r\n        'tasks.filters.end7Days': 'Fecha de fin en 7 d\u00EDas',\r\n        'tasks.filters.endThisWeek': 'Fecha de fin esta semana',\r\n        'tasks.filters.endThisMonth': 'Fecha de fin este mes',\r\n        'tasks.filters.startDateTitle': 'Filtros de Fecha de Inicio',\r\n        'tasks.filters.noStartDate': 'Sin fecha de inicio',\r\n        'tasks.filters.alreadyStarted': 'Ya comenz\u00F3',\r\n        'tasks.filters.startToday': 'Fecha de inicio hoy',\r\n        'tasks.filters.startTomorrow': 'Fecha de inicio ma\u00F1ana',\r\n        'tasks.filters.start7Days': 'Fecha de inicio en 7 d\u00EDas',\r\n        'tasks.filters.startThisWeek': 'Fecha de inicio esta semana',\r\n        'tasks.filters.startThisMonth': 'Fecha de inicio este mes',\r\n        'tasks.filters.updated': 'Actualizado',\r\n        'tasks.filters.updatedTitle': 'Actualizados recientemente',\r\n        'tasks.filters.dateFrom': 'Fecha de inicio',\r\n        'tasks.filters.dateTo': 'Fecha de fin',\r\n        'tasks.filters.clear': 'Limpiar filtros',\r\n        'tasks.filters.presetActive': 'Activas',\r\n        'tasks.filters.presetNotDone': 'No hechas',\r\n        'tasks.filters.presetInProgress': 'En progreso',\r\n        'tasks.filters.include': 'Incluir',\r\n        'tasks.filters.exclude': 'Excluir',\r\n        'tasks.filters.excluding': 'Excluyendo',\r\n        'filters.noOtherProjects': 'No hay otros proyectos',\r\n        'filters.noTags': 'Sin etiquetas',\r\n        'filters.noOtherTags': 'No hay otras etiquetas',\r\n        'filters.sheet.title': 'Opciones',\r\n        'filters.chip.search': 'B\u00FAsqueda',\r\n        'filters.chip.project': 'Proyecto',\r\n        'filters.chip.tag': 'Etiqueta',\r\n        'filters.chip.date': 'Fecha',\r\n        'filters.chip.updated': 'Actualizado',\r\n        'filters.chip.removeAria': 'Quitar filtro {label}',\r\n        'filters.dateRange.from': 'Desde',\r\n        'filters.dateRange.until': 'Hasta',\r\n        'filters.updated.week': 'Semana',\r\n        'filters.updated.month': 'Mes',\r\n        'tasks.kanban.tipLabel': 'Consejo:',\r\n        'tasks.kanban.tipTextBefore': 'En el tablero Kanban manten ',\r\n        'tasks.kanban.tipTextAfter': ' (Cmd en Mac) y haz clic para seleccionar varias tareas. Shift + clic selecciona un rango, luego arrastra para moverlas juntas',\r\n        'tasks.view.kanban': 'Kanban',\r\n        'tasks.view.list': 'Lista',\r\n        'tasks.view.calendar': 'Calendario',\r\n        'tasks.sort.label': 'Ordenar: Prioridad',\r\n        'tasks.sort.orderByPriority': 'Ordenar por prioridad',\r\n        'tasks.kanban.showBacklog': 'Mostrar backlog',\r\n        'tasks.kanban.showProjects': 'Mostrar proyectos',\r\n        'tasks.kanban.showNoDate': 'Mostrar \\\"Sin fecha\\\"',\r\n        'tasks.addButton': '+ A\u00F1adir tarea',\r\n        'tasks.noProject': 'Sin proyecto',\r\n        'tasks.projectIndicatorNone': 'Sin proyecto - ',\r\n        'tasks.project.selectPlaceholder': 'Selecciona un proyecto',\r\n        'tasks.tags.none': 'Sin etiquetas',\r\n        'tasks.checklist.toggle': 'Alternar casilla',\r\n        'tasks.untitled': 'Tarea sin t\u00EDtulo',\r\n        'tasks.startDatePrefix': 'Fecha de inicio: ',\r\n        'tasks.endDatePrefix': 'Fecha de fin: ',\r\n        'tasks.noDate': 'Sin fecha',\r\n        'tasks.noDatesSet': 'Sin fechas',\r\n        'tasks.noEndDate': 'Sin fecha de fin',\r\n        'tasks.due.yesterday': 'Ayer',\r\n        'tasks.due.daysOverdue': '{count} d\u00EDas de atraso',\r\n        'tasks.due.tomorrow': 'Ma\u00F1ana',\r\n        'tasks.openTaskDetails': 'Abrir detalles de la tarea',\r\n        'tasks.noTasksInProject': 'No hay tareas en este proyecto',\r\n        'tasks.attachments.open': 'Abrir',\r\n        'tasks.attachments.none': 'Sin archivos adjuntos',\r\n        'tasks.attachments.remove': 'Quitar archivo adjunto',\r\n        'tasks.attachments.removeTitle': 'Quitar',\r\n        'tasks.attachments.removeLink': 'Quitar enlace',\r\n        'tasks.attachments.googleDoc': 'Documento de Google',\r\n        'tasks.attachments.googleSheet': 'Hoja de c\u00E1lculo de Google',\r\n        'tasks.attachments.googleSlides': 'Presentaci\u00F3n de Google',\r\n        'tasks.attachments.googleDriveFile': 'Archivo de Google Drive',\r\n        'tasks.attachments.pdf': 'Documento PDF',\r\n        'tasks.attachments.word': 'Documento de Word',\r\n        'tasks.attachments.excel': 'Archivo de Excel',\r\n        'tasks.attachments.powerpoint': 'PowerPoint',\r\n        'tasks.empty.epic': 'A\u00FAn no hay tareas. Crea tu primera tarea para este \u00E9pico.',\r\n        'tasks.backlogQuickTitle': 'Abrir tareas de backlog en vista de lista',\r\n        'tasks.backlogQuickLabel': 'Backlog',\r\n        'tasks.kanban.columnBacklog': '\\u{1F9CA} Backlog',\r\n        'tasks.kanban.columnTodo': '\\u{1F4CB} Por hacer',\r\n        'tasks.kanban.columnProgress': '\\u{1F504} En progreso',\r\n        'tasks.kanban.columnReview': '\\u{2611}\\u{FE0F} En revisi\u00F3n',\r\n        'tasks.kanban.columnDone': '\\u{2705} Hecho',\r\n        'tasks.table.task': 'Tarea',\r\n        'tasks.table.priority': 'Prioridad',\r\n        'tasks.table.status': 'Estado',\r\n        'tasks.table.tags': 'Etiquetas',\r\n        'tasks.table.project': 'Proyecto',\r\n        'tasks.table.startDate': 'Fecha de inicio',\r\n        'tasks.table.endDate': 'Fecha de fin',\r\n        'tasks.table.updated': 'Actualizado',\r\n        'tasks.list.count': '{count} resultados',\r\n        'tasks.modal.editTitle': 'Editar tarea',\r\n        'tasks.modal.duplicate': '\uD83D\uDCC4 Duplicar tarea',\r\n        'tasks.modal.delete': '\uD83D\uDDD1\uFE0F Eliminar tarea',\r\n        'tasks.modal.tab.general': 'General',\r\n        'tasks.modal.tab.details': 'Detalles',\r\n        'tasks.modal.tab.history': 'Historial',\r\n        'tasks.modal.titleLabel': 'T\u00EDtulo de la tarea',\r\n        'tasks.modal.attachmentsLabel': 'Adjuntos',\r\n        'tasks.modal.attachmentsSupported': 'Compatible: Im\u00E1genes (10MB), PDF (20MB), Documentos (10MB)',\r\n        'tasks.modal.attachmentsDropzoneDefault': 'Arrastra y suelta o haz clic para adjuntar',\r\n        'tasks.modal.attachmentsDropzoneTap': 'Haz clic para adjuntar',\r\n        'tasks.modal.linksLabel': 'Enlaces',\r\n        'tasks.modal.attachmentNamePlaceholder': 'Nombre (opcional)',\r\n        'tasks.modal.attachmentUrlPlaceholder': 'URL',\r\n        'tasks.modal.addLink': 'Agregar enlace',\r\n        'tasks.modal.statusLabel': 'Estado',\r\n        'tasks.modal.priorityLabel': 'Prioridad',\r\n        'tasks.modal.tagsLabel': 'Etiquetas',\r\n        'tasks.modal.addTagPlaceholder': 'A\u00F1adir etiqueta',\r\n        'tasks.modal.projectLabel': 'Proyecto',\r\n        'tasks.modal.projectOpenTitle': 'Abrir detalles del proyecto',\r\n        'tasks.modal.projectSelect': 'Selecciona un proyecto',\r\n        'tasks.modal.submitCreate': 'Crear tarea',\r\n        'tasks.modal.listBulleted': '\u2022 Lista',\r\n        'tasks.modal.listNumbered': '1. Lista',\r\n        'tasks.modal.insertDivider': 'Insertar separador horizontal',\r\n        'tasks.modal.insertCheckbox': 'Insertar casilla',\r\n        'tasks.history.emptyTitle': 'A\u00FAn no hay cambios',\r\n        'tasks.history.emptySubtitle': 'Los cambios en esta tarea aparecer\u00E1n aqu\u00ED',\r\n        'calendar.title': 'Calendario',\r\n        'calendar.today': 'Hoy',\r\n        'calendar.prevMonth': 'Mes anterior',\r\n        'calendar.nextMonth': 'Mes siguiente',\r\n        'calendar.dayItemsTitle': 'Elementos para {date}',\r\n        'calendar.dayItemsProjects': 'Proyectos',\r\n        'calendar.dayItemsTasks': 'Tareas',\r\n        'calendar.dayItems.close': 'Cerrar tareas del d\u00EDa',\r\n        'calendar.dayItems.addTask': '+ Agregar Tarea',\r\n        'feedback.title': 'Comentarios e incidencias',\r\n        'feedback.subtitle': 'Reporta errores y sugiere funciones',\r\n        'feedback.saveStatus.saved': 'Guardado',\r\n        'feedback.saveStatus.saving': 'Guardando...',\r\n        'feedback.saveStatus.error': 'No se pudo guardar',\r\n        'feedback.saveStatus.offline': 'Sin conexion',\r\n        'feedback.type.bugLabel': '\\u{1F41E} Error',\r\n        'feedback.type.title': 'Tipo de comentario',\r\n        'feedback.type.bugOption': '\\u{1F41E} Error',\r\n        'feedback.type.improvementOption': '\\u{1F4A1} Mejora',\r\n        'feedback.descriptionPlaceholder': 'Describe el problema o la idea. Puedes pegar una imagen directamente en este campo.',\r\n        'feedback.descriptionPlaceholderShort': 'Describe el problema o la idea.',\r\n        'feedback.screenshotAttachTitle': 'Adjuntar captura desde el dispositivo',\r\n        'feedback.screenshotDropzoneTap': '\\u{1F4F7} Adjuntar captura',\r\n        'feedback.screenshotDropzoneDefault': '\\u{1F4F7} Arrastra o haz clic para adjuntar',\r\n        'feedback.screenshotPreviewTitle': 'Captura adjunta',\r\n        'feedback.screenshotPreviewSubtitle': 'Se guardar\u00E1 con este comentario',\r\n        'feedback.screenshotRemove': 'Eliminar',\r\n        'feedback.screenshotPreviewAlt': 'Vista previa de la captura',\r\n        'feedback.viewScreenshotTitle': 'Ver captura',\r\n        'feedback.pagination.first': 'Primera p\u00E1gina',\r\n        'feedback.pagination.prev': 'P\u00E1gina anterior',\r\n        'feedback.pagination.next': 'P\u00E1gina siguiente',\r\n        'feedback.pagination.last': '\u00DAltima p\u00E1gina',\r\n        'feedback.pagination.showing': 'Mostrando {start}-{end} de {total}',\r\n        'feedback.pagination.pageOf': 'P\u00E1gina {current} de {total}',\r\n        'feedback.addButton': 'Agregar',\r\n        'feedback.pendingTitle': '? Pendiente',\r\n        'feedback.doneTitle': '? Hecho',\r\n        'feedback.delete.title': 'Eliminar comentario',\r\n        'feedback.delete.body': '\u00BFSeguro que deseas eliminar este comentario?',\r\n        'feedback.empty.pending': 'No hay feedback pendiente',\r\n        'feedback.empty.done': 'No hay feedback completado',\r\n        'export.title': 'Exportar datos',\r\n        'export.body': 'Esto descargar\u00E1 una copia completa de todas tus tareas, proyectos y ajustes como un archivo JSON. \u00BFSeguro que deseas exportar tus datos?',\r\n        'export.confirm': 'Exportar',\r\n        'import.title': 'Importar datos',\r\n        'import.warningTitle': 'ADVERTENCIA: Esto es un REEMPLAZO COMPLETO',\r\n        'import.warningBody': 'Importar datos <strong>reemplazar\u00E1 permanentemente</strong> todos tus datos actuales:',\r\n        'import.warningTasks': 'Todas las tareas',\r\n        'import.warningProjects': 'Todos los proyectos',\r\n        'import.warningSettings': 'Todas las configuraciones y preferencias',\r\n        'import.warningHistory': 'Todos los registros de historial',\r\n        'import.warningIrreversible': 'Esta acci\u00F3n no se puede deshacer. Tus datos actuales se perder\u00E1n.',\r\n        'import.fileLabel': 'Selecciona el archivo de respaldo para importar:',\r\n        'import.dropzoneDefault': 'Arrastra y suelta o haz clic para seleccionar el archivo de respaldo',\r\n        'import.fileHint': 'Solo se admiten archivos JSON exportados desde Nautilus',\r\n        'import.previewTitle': 'Vista previa de importaci\u00F3n:',\r\n        'import.confirmText': 'Para confirmar la importaci\u00F3n y reemplazar todos tus datos, escribe <strong>import</strong> a continuaci\u00F3n:',\r\n        'import.inputPlaceholder': 'Escribe import aqu\u00ED',\r\n        'import.error': 'Escribe \"import\" exactamente para confirmar',\r\n        'import.button': 'Importar datos',\r\n        'import.processing': 'Importando datos...',\r\n        'import.success': '\u00A1Datos importados exitosamente! Todos los datos han sido reemplazados.',\r\n        'import.errorInvalidFile': 'Tipo de archivo inv\u00E1lido. Por favor, selecciona un archivo JSON.',\r\n        'import.errorInvalidFormat': 'Formato de archivo inv\u00E1lido. El archivo no parece ser un respaldo v\u00E1lido de Nautilus.',\r\n        'import.errorParseFailed': 'Error al analizar el archivo. Por favor, aseg\u00FArate de que el archivo sea JSON v\u00E1lido.',\r\n        'import.errorReadFailed': 'Error al leer el archivo. Por favor, int\u00E9ntalo de nuevo.',\r\n        'import.errorNoFile': 'Por favor, selecciona un archivo para importar.',\r\n        'import.errorFailed': 'Error al importar datos',\r\n        'confirm.deleteTask.title': 'Eliminar tarea',\r\n        'confirm.deleteTask.body': 'Esta acci\u00F3n no se puede deshacer. Para confirmar, escribe delete abajo:',\r\n        'confirm.deleteTask.inputPlaceholder': 'Escribe delete aqu\u00ED',\r\n        'confirm.deleteTask.error': 'Escribe \\\"delete\\\" exactamente para confirmar',\r\n        'confirm.unsaved.title': 'Cambios sin guardar',\r\n        'confirm.unsaved.body': 'Tienes cambios sin guardar. \u00BFSeguro que quieres cerrar y perderlos?',\r\n        'confirm.unsaved.discard': 'Descartar cambios',\r\n        'confirm.review.title': 'Desactivar estado \\\"En revisi\u00F3n\\\"',\r\n        'error.saveDataFailed': 'No se pudieron guardar los datos. Int\u00E9ntalo de nuevo.',\r\n        'error.saveProjectsFailed': 'No se pudieron guardar los proyectos. Int\u00E9ntalo de nuevo.',\r\n        'error.saveTasksFailed': 'No se pudieron guardar las tareas. Int\u00E9ntalo de nuevo.',\r\n        'error.saveFeedbackFailed': 'No se pudo guardar el feedback. Int\u00E9ntalo de nuevo.',\r\n        'error.saveProjectColorsFailed': 'No se pudieron guardar los colores del proyecto.',\r\n        'error.saveTaskFailed': 'No se pudo guardar la tarea. Int\u00E9ntalo de nuevo.',\r\n        'error.saveChangesFailed': 'No se pudieron guardar los cambios. Int\u00E9ntalo de nuevo.',\r\n        'error.saveTaskPositionFailed': 'No se pudo guardar la posici\u00F3n de la tarea. Int\u00E9ntalo de nuevo.',\r\n        'error.saveProjectFailed': 'No se pudo guardar el proyecto. Int\u00E9ntalo de nuevo.',\r\n        'error.notLoggedInResetPin': 'Debes iniciar sesi\u00F3n para restablecer tu PIN',\r\n        'error.resetPinFailed': 'No se pudo restablecer el PIN',\r\n        'error.unauthorized': 'No est\u00E1s autorizado para realizar esta acci\u00F3n',\r\n        'error.deleteAccountFailed': 'No se pudo eliminar la cuenta. Por favor, int\u00E9ntalo de nuevo.',\r\n        'success.resetPin': '\u00A1PIN restablecido con \u00E9xito! Tendr\u00E1s que iniciar sesi\u00F3n de nuevo con tu nuevo PIN.',\r\n        'error.resetPinError': 'Ocurri\u00F3 un error al restablecer el PIN',\r\n        'error.userNameEmpty': 'El nombre de usuario no puede estar vac\u00EDo.',\r\n        'error.saveDisplayNameFailed': 'No se pudo guardar el nombre visible. Int\u00E9ntalo de nuevo.',\r\n        'error.invalidEmail': 'Por favor, introduce un correo v\u00E1lido.',\r\n        'error.saveEmailFailed': 'No se pudo guardar el correo. Int\u00E9ntalo de nuevo.',\r\n        'error.saveAvatarFailed': 'No se pudo guardar el avatar. Int\u00E9ntalo de nuevo.',\r\n        'success.settingsSaved': '\u00A1Ajustes guardados correctamente!',\r\n        'error.logoSelectFile': 'Selecciona un archivo de imagen para el logo del espacio de trabajo.',\r\n        'error.logoTooLarge': 'Usa una imagen menor de 2 MB para el logo del espacio de trabajo.',\r\n        'error.imageReadFailed': 'No se pudo leer la imagen seleccionada.',\r\n        'error.imageLoadFailed': 'No se pudo cargar la imagen seleccionada.',\r\n        'error.logoUploadFailed': 'Error al subir el logo: {message}',\r\n        'error.cropInvalid': 'Error: el estado del recorte no es v\u00E1lido.',\r\n        'error.cropTooLarge': 'La imagen recortada es demasiado grande. Selecciona un \u00E1rea m\u00E1s peque\u00F1a o usa una imagen m\u00E1s peque\u00F1a.',\r\n        'success.cropApplied': '\u00A1Imagen recortada y aplicada correctamente!',\r\n        'success.logoCroppedApplied': '\u00A1Logo del espacio de trabajo recortado y aplicado correctamente!',\r\n        'error.cropFailed': 'Error al recortar la imagen: {message}',\r\n        'error.avatarSelectFile': 'Selecciona un archivo de imagen para tu avatar.',\r\n        'error.avatarTooLarge': 'Usa una imagen menor de 2 MB para tu avatar.',\r\n        'error.avatarUploadFailed': 'No se pudo subir el avatar. Int\u00E9ntalo de nuevo.',\r\n        'error.endDateBeforeStart': 'La fecha de fin no puede ser anterior a la fecha de inicio',\r\n        'error.startDateAfterEnd': 'La fecha de inicio no puede ser posterior a la fecha de fin',\r\n        'error.feedbackAttachImage': 'Adjunta un archivo de imagen.',\r\n        'error.feedbackReadImage': 'No se pudo leer la imagen. Int\u00E9ntalo de nuevo.',\r\n        'error.feedbackStatusFailed': 'No se pudo actualizar el estado del feedback. Int\u00E9ntalo de nuevo.',\r\n        'error.attachmentSaveFailed': 'No se pudo guardar el adjunto. Int\u00E9ntalo de nuevo.',\r\n        'error.attachmentLoadFailed': 'No se pudo cargar la imagen: {message}',\r\n        'success.fileDownloaded': '\u00A1Archivo descargado!',\r\n        'error.fileDownloadFailed': 'No se pudo descargar el archivo: {message}',\r\n        'success.attachmentDeletedFromStorage': '{name} eliminado del almacenamiento',\r\n        'error.fileDeleteFailed': 'No se pudo eliminar el archivo del almacenamiento',\r\n        'success.attachmentRemoved': 'Adjunto eliminado',\r\n        'error.fileSizeTooLarge': 'El tama\u00F1o del archivo debe ser menor de {maxMB} MB. Elige uno m\u00E1s peque\u00F1o.',\r\n        'success.fileUploaded': '\u00A1Archivo subido correctamente!',\r\n        'error.fileUploadFailed': 'Error al subir el archivo: {message}',\r\n        'error.selectFile': 'Selecciona un archivo',\r\n        'error.saveTagFailed': 'No se pudo guardar la etiqueta. Int\u00E9ntalo de nuevo.',\r\n        'error.removeTagFailed': 'No se pudo eliminar la etiqueta. Int\u00E9ntalo de nuevo.',\r\n        'error.openScreenshotFailed': 'No se pudo abrir la captura',\r\n        'history.sort.newest': '\u2191 M\u00E1s recientes primero',\r\n        'history.sort.oldest': '\u2193 M\u00E1s antiguos primero',\r\n        'history.field.title': 'T\u00EDtulo',\r\n        'history.field.name': 'Nombre',\r\n        'history.field.description': 'Descripci\u00F3n',\r\n        'history.field.status': 'Estado',\r\n        'history.field.priority': 'Prioridad',\r\n        'history.field.category': 'Categor\u00EDa',\r\n        'history.field.startDate': 'Fecha de inicio',\r\n        'history.field.endDate': 'Fecha de fin',\r\n        'history.field.link': 'Enlace',\r\n        'history.field.task': 'Enlace',\r\n        'history.field.projectId': 'Proyecto',\r\n        'history.field.tags': 'Etiquetas',\r\n        'history.field.attachments': 'Adjuntos',\r\n        'history.action.created': 'Creado',\r\n        'history.action.deleted': 'Eliminado',\r\n        'history.link.added': 'Agregado',\r\n        'history.link.removed': 'Eliminado',\r\n        'history.entity.task': 'tarea',\r\n        'history.value.empty': 'vac\u00EDo',\r\n        'history.value.none': 'ninguno',\r\n        'history.change.beforeLabel': 'Antes:',\r\n        'history.change.afterLabel': 'Despu\u00E9s:',\r\n        'history.change.notSet': 'Sin establecer',\r\n        'history.change.removed': 'Eliminado',\r\n        'history.tags.none': 'Sin etiquetas',\r\n        'history.attachments.none': 'Sin archivos adjuntos',\r\n        'history.attachments.countSingle': '{count} archivo',\r\n        'history.attachments.countPlural': '{count} archivos',\r\n        'history.project.fallback': 'Proyecto #{id}',\r\n        'history.change.arrow': '\u2192',\r\n        'menu.openMenu': 'Abrir men\u00FA',\r\n        'menu.language': 'Idioma',\r\n        'menu.darkMode': 'Modo oscuro',\r\n        'menu.lightMode': 'Modo claro',\r\n        'menu.settings': 'Configuraci\u00F3n',\r\n        'menu.help': 'Ayuda',\r\n        'menu.signOut': 'Cerrar sesi\u00F3n',\r\n        'nav.overview': 'Resumen',\r\n        'nav.dashboard': 'Panel',\r\n        'nav.updates': 'Notas de versi\u00F3n',\r\n        'nav.calendar': 'Calendario',\r\n        'nav.work': 'Trabajo',\r\n        'nav.projects': 'Proyectos',\r\n        'nav.allTasks': 'Todas las tareas',\r\n        'nav.feedback': 'Comentarios',\r\n        'updates.title': 'Notas de versi\u00F3n',\r\n        'updates.subtitle': '\u00DAltimo registro de cambios en Nautilus',\r\n        'updates.latestLabel': 'Ultima version',\r\n        'updates.historyLabel': 'Registro de versiones',\r\n        'updates.sections.new': 'Novedades',\r\n        'updates.sections.improvements': 'Mejoras',\r\n        'updates.sections.fixes': 'Correcciones',\r\n        'updates.empty': 'Todavia no hay notas de version.',\r\n        'updates.sectionEmpty': 'Todav\u00EDa no hay entradas.',\r\n        'updates.historyEmpty': 'Sin versiones anteriores.',\r\n        'notifications.title': 'Notificaciones',\r\n        'notifications.toggle': 'Notificaciones',\r\n        'notifications.today': 'Hoy',\r\n        'notifications.yesterday': 'Ayer',\r\n        'notifications.clearAll': 'Limpiar todo',\r\n        'notifications.releaseTitle': 'Nueva versi\u00F3n',\r\n        'notifications.releaseCta': 'Ver actualizaciones',\r\n        'notifications.releaseMeta': 'Publicado {date}',\r\n        'notifications.dueTodayTitle': 'Vence hoy',\r\n        'notifications.dueTodayCta': 'Ver tareas',\r\n        'notifications.dueTodayMetaOne': '{count} tarea vence hoy',\r\n        'notifications.dueTodayMetaMany': '{count} tareas vencen hoy',\r\n        'notifications.dueTodayMore': 'y {count} tareas m\u00E1s',\r\n        'notifications.empty': 'Todo al d\u00EDa.',\r\n        'settings.title': 'Configuraci\u00F3n',\r\n        'settings.subtitle': 'Administra tus preferencias y la configuraci\u00F3n de la aplicaci\u00F3n',\r\n        'settings.section.profile': 'Perfil',\r\n        'settings.displayName': 'Nombre para mostrar',\r\n        'settings.displayNameHint': 'Este nombre se muestra en toda la aplicaci\u00F3n',\r\n        'settings.placeholder.displayName': 'Escribe tu nombre para mostrar',\r\n        'settings.email': 'Correo electr\u00F3nico',\r\n        'settings.emailHint': 'Se usa para tu cuenta y notificaciones de vencimiento',\r\n        'settings.placeholder.email': 'Escribe tu correo',\r\n        'settings.avatar': 'Avatar',\r\n        'settings.avatarHint': 'Sube una imagen para tu avatar (m\u00E1x. 2 MB). Se mostrar\u00E1 en forma circular.',\r\n        'settings.avatarRemoveTitle': 'Eliminar avatar',\r\n        'settings.workspaceLogo': 'Logo del espacio de trabajo',\r\n        'settings.workspaceLogoHint': 'Sube una imagen cuadrada para reemplazar el logo de Nautilus (m\u00E1x. 2 MB).',\r\n        'settings.workspaceLogoRemoveTitle': 'Eliminar logo personalizado',\r\n        'settings.section.application': 'Aplicaci\u00F3n',\r\n        'settings.enableReviewStatus': 'Habilitar estado En revisi\u00F3n',\r\n        'settings.enableReviewStatusHint': 'Muestra u oculta la columna y el filtro de estado EN REVISI\u00D3N',\r\n        'settings.enableReviewStatusHintPrefix': 'Muestra u oculta la columna y el filtro del estado',\r\n        'settings.enableReviewStatusHintSuffix': 'en la vista de tareas',\r\n        'settings.calendarIncludeBacklog': 'Mostrar backlog en calendario',\r\n        'settings.calendarIncludeBacklogHint': 'Muestra tareas en backlog en todas las vistas de calendario',\r\n        'settings.autoStartDate': 'Autocompletar fecha de inicio',\r\n        'settings.autoStartDateHint': 'Establece autom\u00E1ticamente la fecha de inicio cuando la tarea pasa a \"En progreso\" (si est\u00E1 vac\u00EDa)',\r\n        'settings.autoEndDate': 'Autocompletar fecha de fin',\r\n        'settings.autoEndDateHint': 'Establece autom\u00E1ticamente la fecha de fin cuando la tarea pasa a \"Hecho\" (si est\u00E1 vac\u00EDa)',\r\n        'settings.debugLogs': 'Habilitar logs de depuracion',\r\n        'settings.debugLogsHint': 'Guarda logs de diagnostico en la consola del navegador al activarlo',\r\n        'settings.historySortOrder': 'Orden de historial',\r\n        'settings.historySortOrderHint': 'Orden predeterminado para los historiales de tareas y proyectos',\r\n        'settings.historySortNewest': 'M\u00E1s reciente primero',\r\n        'settings.historySortOldest': 'M\u00E1s antiguo primero',\r\n        'settings.language': 'Idioma',\r\n        'settings.languageHint': 'Elige el idioma de la aplicaci\u00F3n',\r\n        'settings.section.notifications': 'Notificaciones',\r\n        'settings.emailNotifications': 'Notificaciones por correo',\r\n        'settings.emailNotificationsHint': 'Activa o desactiva los correos de recordatorio de vencimientos',\r\n        'settings.weekdaysOnly': 'Solo d\u00EDas laborables',\r\n        'settings.weekdaysOnlyHint': 'Omitir correos s\u00E1bado y domingo',\r\n        'settings.includeStartDates': 'Notificar cuando las tareas comienzan',\r\n        'settings.includeStartDatesHint': 'Enviar recordatorios cuando una tarea comienza (ej., hoy)',\r\n        'settings.includeBacklog': 'Incluir tareas en backlog',\r\n        'settings.includeBacklogHint': 'Incluir tareas en backlog en notificaciones por correo y en la app',\r\n        'settings.sendTime': 'Hora de env\u00EDo',\r\n        'settings.sendTimeHint': 'Hora diaria de env\u00EDo (08:00-18:00, intervalos de 30 minutos)',\r\n        'settings.timeZone': 'Zona horaria',\r\n        'settings.timeZoneHint': 'Mantiene la misma hora local todo el a\u00F1o (con horario de verano)',\r\n        'settings.timeZone.option.argentina': 'Argentina (Buenos Aires)',\r\n        'settings.timeZone.option.canary': 'Islas Canarias (Atlantic/Canary)',\r\n        'settings.timeZone.option.spain': 'Espa\u00F1a peninsular (Europe/Madrid)',\r\n        'settings.timeZone.option.utc': 'UTC',\r\n        'settings.section.security': 'Seguridad',\r\n        'settings.pinManagement': 'Gesti\u00F3n de PIN',\r\n        'settings.pinManagementHint': 'Restablece tu PIN a un nuevo c\u00F3digo de 4 d\u00EDgitos',\r\n        'settings.resetPinButton': 'Restablecer PIN',\r\n        'settings.section.dataManagement': 'Gesti\u00F3n de datos',\r\n        'settings.exportData': 'Exportar datos',\r\n        'settings.exportDataHint': 'Descarga una copia de seguridad completa de tus tareas, proyectos y configuraci\u00F3n en un archivo JSON',\r\n        'settings.exportButton': 'Exportar',\r\n        'settings.importData': 'Importar datos',\r\n        'settings.importDataHint': 'Importa un archivo de copia de seguridad para reemplazar todos tus datos actuales. Esta acci\u00F3n no se puede deshacer.',\r\n        'settings.importButton': 'Importar datos',\r\n        'settings.section.dangerZone': 'Zona de peligro',\r\n        'settings.deleteAccount': 'Eliminar cuenta',\r\n        'settings.deleteAccountHint': 'Elimina permanentemente tu cuenta y todos los datos asociados. Esta acci\u00F3n no se puede deshacer.',\r\n        'settings.deleteAccountButton': 'Eliminar cuenta',\r\n        'settings.deleteAccount.title': 'Eliminar cuenta',\r\n        'settings.deleteAccount.warning': 'Esta acci\u00F3n <strong>no se puede deshacer</strong>. Perder\u00E1s permanentemente:',\r\n        'settings.deleteAccount.loseTasks': 'Todas tus tareas',\r\n        'settings.deleteAccount.loseProjects': 'Todos tus proyectos',\r\n        'settings.deleteAccount.loseData': 'Todos tus datos de cuenta y configuraci\u00F3n',\r\n        'settings.deleteAccount.confirmText': 'Para confirmar la eliminaci\u00F3n de la cuenta, escribe <strong>delete</strong> a continuaci\u00F3n:',\r\n        'settings.deleteAccount.inputPlaceholder': 'Escribe delete aqu\u00ED',\r\n        'settings.deleteAccount.error': 'Escribe \"delete\" exactamente para confirmar',\r\n        'settings.deleteAccount.button': 'Eliminar cuenta',\r\n        'settings.deleteAccount.success': 'Cuenta eliminada exitosamente. Redirigiendo al inicio de sesi\u00F3n...',\r\n        'settings.cancelButton': 'Cancelar',\r\n        'settings.saveButton': 'Guardar configuraci\u00F3n',\r\n        'settings.avatarUploadDefault': 'Arrastra y suelta o haz clic para subir un avatar',\r\n        'settings.avatarUploadChange': 'Cambiar avatar',\r\n        'settings.avatarUploadAriaUpload': 'Subir avatar',\r\n        'settings.avatarUploadAriaChange': 'Cambiar avatar',\r\n        'settings.logoUploadDefault': 'Arrastra y suelta o haz clic para subir un logo',\r\n        'settings.logoUploadChange': 'Cambiar logo',\r\n        'settings.logoUploadAriaUpload': 'Subir logo',\r\n        'settings.logoUploadAriaChange': 'Cambiar logo',\r\n        'dashboard.title': 'Panel',\r\n        'dashboard.hero.activeProjectsLabel': 'Proyectos activos',\r\n        'dashboard.hero.completionRateLabel': 'Tasa de finalizaci\u00F3n',\r\n        'dashboard.hero.tasksCompletionRateLabel': 'Finalizaci\u00F3n de tareas',\r\n        'dashboard.hero.projectsCompletionRateLabel': 'Finalizaci\u00F3n de proyectos',\r\n        'dashboard.hero.projectsTrend': '\uD83D\uDCC8 +2 este mes',\r\n        'dashboard.hero.completionTrend': '\uD83C\uDFAF Objetivo: 80%',\r\n        'dashboard.projectAnalytics': '\uD83D\uDCCA Anal\u00EDtica de proyectos',\r\n        'dashboard.period.week': 'Semana',\r\n        'dashboard.period.month': 'Mes',\r\n        'dashboard.period.quarter': 'Trimestre',\r\n        'dashboard.stat.pendingTasks': 'Tareas pendientes',\r\n        'dashboard.stat.inProgress': 'En progreso',\r\n        'dashboard.stat.highPriority': 'Alta prioridad',\r\n        'dashboard.stat.overdue': 'Vencidas',\r\n        'dashboard.stat.completed': 'Completadas',\r\n        'dashboard.stat.projects': 'Proyectos',\r\n        'dashboard.highPriorityHint': 'Tareas de alta prioridad con vencimiento en 7 d\u00EDas (o vencidas)',\r\n        'dashboard.projectProgress': '\uD83C\uDF0A Progreso del proyecto',\r\n        'dashboard.legend.todo': 'Por hacer',\r\n        'dashboard.legend.progress': 'En progreso',\r\n        'dashboard.legend.review': 'En revisi\u00F3n',\r\n        'dashboard.legend.complete': 'Completo',\r\n        'dashboard.viewAll': 'Ver todo',\r\n        'dashboard.quickActions': '\u26A1 Acciones r\u00E1pidas',\r\n        'dashboard.action.generateReport': 'Generar informe',\r\n        'dashboard.action.addTask': 'Agregar tarea',\r\n        'dashboard.action.viewCalendar': 'Ver calendario',\r\n        'dashboard.action.newProject': 'Nuevo proyecto',\r\n        'dashboard.recentActivity': '\\u{1F504} Actividad reciente',\r\n        'dashboard.researchInsights': '\uD83E\uDDE0 Perspectivas',\r\n        'dashboard.activity.emptyTitle': 'Bienvenido a tu panel',\r\n        'dashboard.activity.emptySubtitle': 'Empieza a crear proyectos y tareas para ver actividad',\r\n        'dashboard.activity.completed': 'Completaste \"{title}\" {projectPart}',\r\n        'dashboard.activity.createdProject': 'Creaste el nuevo proyecto \"{project}\"',\r\n        'dashboard.activity.addedTask': 'Agregaste la nueva tarea \"{title}\" {projectPart}',\r\n        'dashboard.activity.inProject': 'en {project}',\r\n        'dashboard.activity.toProject': 'a {project}',\r\n        'dashboard.activity.recently': 'Recientemente',\r\n        'dashboard.activity.justNow': 'Justo ahora',\r\n        'dashboard.activity.today': 'Hoy',\r\n        'dashboard.activity.yesterday': 'Ayer',\r\n        'dashboard.activity.daysAgoShort': 'hace {count}d',\r\n        'dashboard.activity.minuteAgo': 'hace {count} minuto',\r\n        'dashboard.activity.minutesAgo': 'hace {count} minutos',\r\n        'dashboard.activity.hourAgo': 'hace {count} hora',\r\n        'dashboard.activity.hoursAgo': 'hace {count} horas',\r\n        'dashboard.activity.dayAgo': 'hace {count} d\u00EDa',\r\n        'dashboard.activity.daysAgo': 'hace {count} d\u00EDas',\r\n        'dashboard.trend.thisWeek': 'esta semana',\r\n        'dashboard.trend.thisMonth': 'este mes',\r\n        'dashboard.trend.thisQuarter': 'este trimestre',\r\n        'dashboard.trend.dueTodayOne': '{count} vence hoy',\r\n        'dashboard.trend.dueTodayMany': '{count} vencen hoy',\r\n        'dashboard.trend.onTrack': 'En buen camino',\r\n        'dashboard.trend.needsAttention': 'Necesita atenci\u00F3n',\r\n        'dashboard.trend.allOnTrack': 'Todo en buen camino',\r\n        'dashboard.trend.criticalOne': '{count} cr\u00EDtica',\r\n        'dashboard.trend.criticalMany': '{count} cr\u00EDticas',\r\n        'dashboard.trend.completedOne': '{count} completada',\r\n        'dashboard.trend.completedMany': '{count} completadas',\r\n        'dashboard.trend.inProgress': 'En progreso',\r\n        'dashboard.emptyProjects.title': 'A\u00FAn no hay proyectos',\r\n        'dashboard.emptyProjects.subtitle': 'Crea tu primer proyecto para ver la visualizaci\u00F3n de progreso',\r\n        'dashboard.tasks': 'tareas',\r\n        'dashboard.activity.allTitle': 'Toda la actividad reciente',\r\n        'dashboard.activity.allSubtitle': 'Historial completo de tu trabajo reciente',\r\n        'dashboard.activity.backToDashboard': '\u2190 Volver al panel',\r\n        'dashboard.insights.excellentTitle': 'Progreso excelente',\r\n        'dashboard.insights.excellentDesc': '{percent}% de finalizaci\u00F3n supera el objetivo. Gran impulso.',\r\n        'dashboard.insights.goodTitle': 'Buen progreso',\r\n        'dashboard.insights.goodDesc': '{percent}% de finalizaci\u00F3n es s\u00F3lido. Intenta llegar al objetivo de 80%.',\r\n        'dashboard.insights.opportunityTitle': 'Oportunidad de progreso',\r\n        'dashboard.insights.opportunityDesc': '{percent}% de finalizaci\u00F3n. Enf\u00F3cate en completar tareas actuales para ganar impulso.',\r\n        'dashboard.insights.actionTitle': 'Acci\u00F3n necesaria',\r\n        'dashboard.insights.actionDesc': '{percent}% de finalizaci\u00F3n es bajo. Divide tareas grandes y empieza con las peque\u00F1as.',\r\n        'dashboard.insights.todayTitle': 'Enfoque de hoy',\r\n        'dashboard.insights.todayDescOne': '{count} tarea vence hoy. Prior\u00EDzala para mayor impacto.',\r\n        'dashboard.insights.todayDescMany': '{count} tareas vencen hoy. Prior\u00EDzalas para mayor impacto.',\r\n        'dashboard.insights.overdueTitle': 'Elementos vencidos',\r\n        'dashboard.insights.overdueDescOne': '{count} tarea vencida necesita atenci\u00F3n. Ati\u00E9ndela para evitar retrasos.',\r\n        'dashboard.insights.overdueDescMany': '{count} tareas vencidas necesitan atenci\u00F3n. Ati\u00E9ndelas para evitar retrasos.',\r\n        'dashboard.insights.highPriorityTitle': 'Enfoque de alta prioridad',\r\n        'dashboard.insights.highPriorityDescOne': '{count} tarea de alta prioridad necesita atenci\u00F3n inmediata.',\r\n        'dashboard.insights.highPriorityDescMany': '{count} tareas de alta prioridad necesitan atenci\u00F3n inmediata.',\r\n        'dashboard.insights.emptyProjectsTitle': 'Proyectos sin tareas',\r\n        'dashboard.insights.emptyProjectsDescOne': '{count} proyecto no tiene tareas a\u00FAn. Agrega tareas para seguir el progreso.',\r\n        'dashboard.insights.emptyProjectsDescMany': '{count} proyectos no tienen tareas a\u00FAn. Agrega tareas para seguir el progreso.',\r\n        'dashboard.insights.momentumTitle': 'Buen impulso',\r\n        'dashboard.insights.momentumDescOne': '{count} tarea completada esta semana. Vas en buen ritmo.',\r\n        'dashboard.insights.momentumDescMany': '{count} tareas completadas esta semana. Vas en buen ritmo.',\r\n        'dashboard.insights.readyTitle': 'Listo para empezar',\r\n        'dashboard.insights.readyDesc': 'Crea tu primer proyecto y agrega tareas para comenzar a seguir tu progreso.',\r\n        'dashboard.insights.caughtUpTitle': 'Todo al d\u00EDa',\r\n        'dashboard.insights.caughtUpDesc': 'Buen trabajo. No hay urgencias. Considera planificar tus pr\u00F3ximos hitos.'\r\n    }\r\n};\r\n\r\n", "// storage-client.js\r\n\r\n/**\r\n * Gets the auth token from localStorage\r\n * @returns {string|null} Auth token or null\r\n */\r\nfunction getAuthToken() {\r\n    return localStorage.getItem('authToken');\r\n}\r\n\r\n/**\r\n * Gets auth headers for API requests\r\n * @returns {object} Headers object\r\n */\r\nfunction getAuthHeaders() {\r\n    const token = getAuthToken();\r\n    const headers = { \"Content-Type\": \"application/json\" };\r\n\r\n    if (token) {\r\n        headers[\"Authorization\"] = `Bearer ${token}`;\r\n    }\r\n\r\n    return headers;\r\n}\r\n\r\nconst DEFAULT_TIMEOUT_MS = 20000;\r\nconst DEBUG_LOG_LOCALSTORAGE_KEY = \"debugLogsEnabled\";\r\n\r\nfunction isDebugLogsEnabled() {\r\n    try {\r\n        return localStorage.getItem(DEBUG_LOG_LOCALSTORAGE_KEY) === \"true\";\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction logFeedbackDebug(message, meta) {\r\n    if (!isDebugLogsEnabled()) return;\r\n    if (meta) {\r\n        console.log(`[feedback-debug] ${message}`, meta);\r\n    } else {\r\n        console.log(`[feedback-debug] ${message}`);\r\n    }\r\n}\r\nasync function fetchWithTimeout(resource, options = {}, timeoutMs = DEFAULT_TIMEOUT_MS) {\r\n    const controller = new AbortController();\r\n    const id = setTimeout(() => controller.abort(), timeoutMs);\r\n    try {\r\n        return await fetch(resource, { ...options, signal: controller.signal });\r\n    } finally {\r\n        clearTimeout(id);\r\n    }\r\n}\r\n\r\nexport async function saveData(key, value) {\r\n    try {\r\n        const response = await fetchWithTimeout(`/api/storage?key=${encodeURIComponent(key)}`, {\r\n            method: \"POST\",\r\n            headers: getAuthHeaders(),\r\n            body: JSON.stringify(value),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            if (response.status === 401) {\r\n                // Unauthorized - redirect to login\r\n                window.location.hash = '#login';\r\n                throw new Error('Unauthorized - please login');\r\n            }\r\n            throw new Error(`Failed to save data: ${response.status} ${response.statusText}`);\r\n        }\r\n\r\n        return true;\r\n    } catch (error) {\r\n        console.error(`Error saving data for key \"${key}\":`, error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function deleteData(key) {\r\n    try {\r\n        const response = await fetchWithTimeout(`/api/storage?key=${encodeURIComponent(key)}`, {\r\n            method: \"DELETE\",\r\n            headers: getAuthHeaders(),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            if (response.status === 401) {\r\n                window.location.hash = '#login';\r\n                throw new Error('Unauthorized - please login');\r\n            }\r\n            throw new Error(`Failed to delete data: ${response.status} ${response.statusText}`);\r\n        }\r\n\r\n        return true;\r\n    } catch (error) {\r\n        console.error(`Error deleting data for key \"${key}\":`, error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function loadData(key) {\r\n    try {\r\n        const res = await fetchWithTimeout(`/api/storage?key=${encodeURIComponent(key)}`, {\r\n            headers: getAuthHeaders()\r\n        });\r\n\r\n        if (!res.ok) {\r\n            if (res.status === 401) {\r\n                // Unauthorized - redirect to login\r\n                window.location.hash = '#login';\r\n                return null;\r\n            }\r\n            if (res.status === 404) {\r\n                return null; // Key doesn't exist yet\r\n            }\r\n            throw new Error(`Failed to load data: ${res.status} ${res.statusText}`);\r\n        }\r\n\r\n        const text = await res.text();\r\n        return text && text !== \"null\" ? JSON.parse(text) : null;\r\n    } catch (error) {\r\n        console.error(`Error loading data for key \"${key}\":`, error);\r\n        // Return null on error to allow app to continue with empty state\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function loadManyData(keys) {\r\n    try {\r\n        const list = Array.isArray(keys) ? keys : [];\r\n        const qs = encodeURIComponent(list.join(','));\r\n        const res = await fetchWithTimeout(`/api/storage/batch?keys=${qs}`, {\r\n            headers: getAuthHeaders()\r\n        });\r\n\r\n        if (!res.ok) {\r\n            if (res.status === 401) {\r\n                window.location.hash = '#login';\r\n                return null;\r\n            }\r\n            return null;\r\n        }\r\n\r\n        const data = await res.json();\r\n        return (data && typeof data === 'object') ? data : null;\r\n    } catch (error) {\r\n        console.error('Error batch loading data:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function loadFeedbackIndex() {\r\n    return loadData(\"feedback:index\");\r\n}\r\n\r\nexport async function saveFeedbackIndex(ids) {\r\n    return saveData(\"feedback:index\", ids);\r\n}\r\n\r\nexport async function loadFeedbackItem(id) {\r\n    return loadData(`feedback:item:${id}`);\r\n}\r\n\r\nexport async function saveFeedbackItem(item) {\r\n    return saveData(`feedback:item:${item.id}`, item);\r\n}\r\n\r\nexport async function deleteFeedbackItem(id) {\r\n    return deleteData(`feedback:item:${id}`);\r\n}\r\n\r\nexport async function saveFeedbackDelta(delta) {\r\n    try {\r\n        const response = await fetchWithTimeout(`/api/storage?key=feedbackItems&op=delta`, {\r\n            method: \"POST\",\r\n            headers: getAuthHeaders(),\r\n            body: JSON.stringify(delta),\r\n        });\r\n\r\n        if (!response.ok) {\r\n            if (response.status === 401) {\r\n                window.location.hash = '#login';\r\n                throw new Error('Unauthorized - please login');\r\n            }\r\n            throw new Error(`Failed to save feedback delta: ${response.status} ${response.statusText}`);\r\n        }\r\n\r\n        return true;\r\n    } catch (error) {\r\n        console.error('Error saving feedback delta:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Batch process multiple feedback operations in a single API call.\r\n * This significantly improves performance by reducing N API calls to 1.\r\n *\r\n * @param {Array} operations - Array of operations: [{action: 'add'|'update'|'delete', item?: object, id?: number}, ...]\r\n * @param {number} timeoutMs - Optional timeout in milliseconds (default: 20000)\r\n * @returns {Promise<object>} Response containing success status, processed count, and updated index\r\n */\r\nexport async function batchFeedbackOperations(operations, timeoutMs = DEFAULT_TIMEOUT_MS) {\r\n    try {\r\n        const debugEnabled = isDebugLogsEnabled();\r\n        const requestId = `fb-${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n        const startedAt = (typeof performance !== \"undefined\" && performance.now)\r\n            ? performance.now()\r\n            : Date.now();\r\n        let payloadBytes = null;\r\n        if (debugEnabled) {\r\n            try {\r\n                payloadBytes = JSON.stringify({ operations }).length;\r\n            } catch (e) {}\r\n        }\r\n        const headers = getAuthHeaders();\r\n        if (debugEnabled) {\r\n            headers[\"X-Debug-Logs\"] = \"1\";\r\n            headers[\"X-Request-Id\"] = requestId;\r\n            logFeedbackDebug(\"batch-feedback:request\", {\r\n                requestId,\r\n                operationCount: Array.isArray(operations) ? operations.length : 0,\r\n                payloadBytes,\r\n                timeoutMs\r\n            });\r\n        }\r\n\r\n        const response = await fetchWithTimeout(`/api/batch-feedback`, {\r\n            method: \"POST\",\r\n            headers: headers,\r\n            body: JSON.stringify({ operations }),\r\n        }, timeoutMs);\r\n\r\n        if (!response.ok) {\r\n            if (response.status === 401) {\r\n                window.location.hash = '#login';\r\n                throw new Error('Unauthorized - please login');\r\n            }\r\n            throw new Error(`Failed to batch process feedback: ${response.status} ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        if (debugEnabled) {\r\n            const endedAt = (typeof performance !== \"undefined\" && performance.now)\r\n                ? performance.now()\r\n                : Date.now();\r\n            logFeedbackDebug(\"batch-feedback:response\", {\r\n                requestId,\r\n                durationMs: Math.round(endedAt - startedAt),\r\n                success: data && data.success,\r\n                processed: data && data.processed,\r\n                total: data && data.total\r\n            });\r\n        }\r\n        return data;\r\n    } catch (error) {\r\n        console.error('Error batch processing feedback:', error);\r\n        throw error;\r\n    }\r\n}\r\n", "/**\r\n * Storage Service\r\n * Wraps storage-client.js with higher-level helper functions\r\n * Provides convenient methods for common storage operations\r\n */\r\n\r\nimport {\r\n    loadData,\r\n    saveData,\r\n    loadManyData,\r\n    loadFeedbackIndex,\r\n    saveFeedbackIndex,\r\n    loadFeedbackItem,\r\n    saveFeedbackItem\r\n} from \"../../storage-client.js\";\r\n\r\n/**\r\n * Save all main application data (tasks, projects, feedback)\r\n * @param {Array} tasks - Tasks array\r\n * @param {Array} projects - Projects array\r\n * @param {Array} feedbackItems - Feedback items array\r\n * @returns {Promise<void>}\r\n */\r\nexport async function saveAll(tasks, projects, feedbackItems) {\r\n    const previousTasksCache = loadArrayCache(TASKS_CACHE_KEY);\r\n    const previousProjectsCache = loadArrayCache(PROJECTS_CACHE_KEY);\r\n    if (Array.isArray(tasks)) persistArrayCache(TASKS_CACHE_KEY, tasks);\r\n    if (Array.isArray(projects)) persistArrayCache(PROJECTS_CACHE_KEY, projects);\r\n\r\n    try {\r\n        await Promise.all([\r\n            saveData(\"tasks\", tasks),\r\n            saveData(\"projects\", projects),\r\n            saveFeedbackItems(feedbackItems)\r\n        ]);\r\n    } catch (error) {\r\n        // Rollback cache on network failure\r\n        persistArrayCache(TASKS_CACHE_KEY, previousTasksCache);\r\n        persistArrayCache(PROJECTS_CACHE_KEY, previousProjectsCache);\r\n        console.error(\"Error saving all data:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Save tasks to storage (cache-first for optimistic UI)\r\n * @param {Array} tasks - Tasks array\r\n * @returns {Promise<void>}\r\n */\r\nexport async function saveTasks(tasks) {\r\n    // Cache-first: update localStorage immediately for instant refresh persistence\r\n    const previousCache = loadArrayCache(TASKS_CACHE_KEY);\r\n    if (Array.isArray(tasks)) persistArrayCache(TASKS_CACHE_KEY, tasks);\r\n\r\n    try {\r\n        await saveData(\"tasks\", tasks);\r\n    } catch (error) {\r\n        // Rollback cache on network failure\r\n        persistArrayCache(TASKS_CACHE_KEY, previousCache);\r\n        console.error(\"Error saving tasks:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Save projects to storage (cache-first for optimistic UI)\r\n * @param {Array} projects - Projects array\r\n * @returns {Promise<void>}\r\n */\r\nexport async function saveProjects(projects) {\r\n    // Cache-first: update localStorage immediately for instant refresh persistence\r\n    const previousCache = loadArrayCache(PROJECTS_CACHE_KEY);\r\n    if (Array.isArray(projects)) persistArrayCache(PROJECTS_CACHE_KEY, projects);\r\n\r\n    try {\r\n        await saveData(\"projects\", projects);\r\n    } catch (error) {\r\n        // Rollback cache on network failure\r\n        persistArrayCache(PROJECTS_CACHE_KEY, previousCache);\r\n        console.error(\"Error saving projects:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Save feedback items to storage (cache-first for optimistic UI)\r\n * @param {Array} feedbackItems - Feedback items array\r\n * @returns {Promise<void>}\r\n */\r\nexport async function saveFeedbackItems(feedbackItems) {\r\n    const items = Array.isArray(feedbackItems) ? feedbackItems : [];\r\n\r\n    // Cache-first: update localStorage immediately for instant refresh persistence\r\n    const previousCache = loadFeedbackCache(FEEDBACK_CACHE_KEY);\r\n    persistFeedbackCache(FEEDBACK_CACHE_KEY, items);\r\n\r\n    try {\r\n        // Simple save: store entire array like tasks/projects\r\n        await saveData(\"feedbackItems\", items);\r\n    } catch (error) {\r\n        // Rollback cache on network failure\r\n        persistFeedbackCache(FEEDBACK_CACHE_KEY, previousCache);\r\n        console.error(\"Error saving feedback items:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Save project colors map to storage\r\n * @param {Object} projectColorMap - Project colors map\r\n * @returns {Promise<void>}\r\n */\r\nexport async function saveProjectColors(projectColorMap) {\r\n    try {\r\n        await saveData(\"projectColors\", projectColorMap);\r\n    } catch (error) {\r\n        console.error(\"Error saving project colors:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Save sort mode and manual task order\r\n * @param {string} sortMode - Sort mode ('priority' or 'manual')\r\n * @param {Object} manualTaskOrder - Manual task order map\r\n * @returns {Promise<void>}\r\n */\r\nexport async function saveSortState(sortMode, manualTaskOrder) {\r\n    try {\r\n        await Promise.all([\r\n            saveData('sortMode', sortMode),\r\n            saveData('manualTaskOrder', manualTaskOrder)\r\n        ]);\r\n    } catch (error) {\r\n        console.error(\"Error saving sort state:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Load all main application data\r\n * @returns {Promise<{tasks: Array, projects: Array, feedbackItems: Array}>}\r\n */\r\nexport async function loadAll(options = {}) {\r\n    const preferCache = !!options.preferCache;\r\n    const feedbackOptions = options.feedback || {};\r\n\r\n    try {\r\n        const cachedTasks = preferCache ? loadArrayCache(TASKS_CACHE_KEY) : [];\r\n        const cachedProjects = preferCache ? loadArrayCache(PROJECTS_CACHE_KEY) : [];\r\n        const feedbackPreferCache = feedbackOptions.preferCache ?? preferCache;\r\n        const cachedFeedback = await loadFeedbackItemsFromIndex({\r\n            ...feedbackOptions,\r\n            preferCache: feedbackPreferCache\r\n        });\r\n\r\n        const hasCached = (cachedTasks && cachedTasks.length > 0) || (cachedProjects && cachedProjects.length > 0);\r\n        if (preferCache && hasCached) {\r\n            const onRefresh = typeof options.onRefresh === \"function\" ? options.onRefresh : null;\r\n            const refreshOptions = {\r\n                ...options,\r\n                preferCache: false,\r\n                feedback: { ...feedbackOptions, preferCache: false }\r\n            };\r\n            void loadAllNetwork(refreshOptions).then((fresh) => {\r\n                if (onRefresh) onRefresh(fresh);\r\n            });\r\n            return {\r\n                tasks: cachedTasks || [],\r\n                projects: cachedProjects || [],\r\n                feedbackItems: cachedFeedback || []\r\n            };\r\n        }\r\n\r\n        return await loadAllNetwork({\r\n            ...options,\r\n            feedback: { ...feedbackOptions, preferCache: feedbackPreferCache }\r\n        });\r\n    } catch (error) {\r\n        console.error(\"Error loading all data:\", error);\r\n        return {\r\n            tasks: [],\r\n            projects: [],\r\n            feedbackItems: []\r\n        };\r\n    }\r\n}\r\n\r\nconst FEEDBACK_CACHE_KEY = \"feedbackItemsCache:v1\";\r\nconst TASKS_CACHE_KEY = \"tasksCache:v1\";\r\nconst PROJECTS_CACHE_KEY = \"projectsCache:v1\";\r\nconst CACHE_TOKEN_KEY = \"nautilus_cache_token:v1\";\r\n\r\nfunction getScopedCacheKey(baseKey, tokenOverride) {\r\n    try {\r\n        const token = tokenOverride ?? localStorage.getItem(\"authToken\");\r\n        return token ? `${baseKey}:${token}` : baseKey;\r\n    } catch (e) {\r\n        return baseKey;\r\n    }\r\n}\r\n\r\nfunction loadArrayCache(baseKey) {\r\n    try {\r\n        const token = localStorage.getItem(\"authToken\");\r\n        const scopedKey = getScopedCacheKey(baseKey, token);\r\n        const raw = localStorage.getItem(scopedKey);\r\n        const parsed = raw ? JSON.parse(raw) : [];\r\n        if (Array.isArray(parsed) && parsed.length > 0) return parsed;\r\n\r\n        // Do NOT migrate \"previous\" cache: that was another user's data. Returning it\r\n        // on login-as-different-user caused 1\u20133s of wrong dashboard before network refresh.\r\n        return Array.isArray(parsed) ? parsed : [];\r\n    } catch (e) {\r\n        return [];\r\n    }\r\n}\r\n\r\nfunction persistArrayCache(baseKey, items) {\r\n    try {\r\n        const token = localStorage.getItem(\"authToken\");\r\n        localStorage.setItem(getScopedCacheKey(baseKey, token), JSON.stringify(items || []));\r\n        if (token) {\r\n            localStorage.setItem(CACHE_TOKEN_KEY, token);\r\n        }\r\n    } catch (e) {}\r\n}\r\n\r\nfunction loadFeedbackCache(cacheKey) {\r\n    const key = cacheKey || FEEDBACK_CACHE_KEY;\r\n    try {\r\n        const raw = localStorage.getItem(key);\r\n        const parsed = raw ? JSON.parse(raw) : [];\r\n        return Array.isArray(parsed) ? parsed : [];\r\n    } catch (e) {\r\n        return [];\r\n    }\r\n}\r\n\r\nfunction persistFeedbackCache(cacheKey, items) {\r\n    const key = cacheKey || FEEDBACK_CACHE_KEY;\r\n    try {\r\n        localStorage.setItem(key, JSON.stringify(items || []));\r\n    } catch (e) {}\r\n}\r\n\r\nasync function loadAllNetwork(options = {}) {\r\n    const feedbackOptions = options.feedback || {};\r\n    const batch = await loadManyData([\"tasks\", \"projects\", \"feedbackItems\"]);\r\n\r\n    // Load all data in parallel to avoid waterfall\r\n    const [tasks, projects, feedbackItems] = await Promise.all([\r\n        batch ? Promise.resolve(batch.tasks) : loadData(\"tasks\"),\r\n        batch ? Promise.resolve(batch.projects) : loadData(\"projects\"),\r\n        loadFeedbackItemsFromIndex(feedbackOptions)\r\n    ]);\r\n\r\n    if (Array.isArray(tasks)) persistArrayCache(TASKS_CACHE_KEY, tasks);\r\n    if (Array.isArray(projects)) persistArrayCache(PROJECTS_CACHE_KEY, projects);\r\n\r\n    return {\r\n        tasks: tasks || [],\r\n        projects: projects || [],\r\n        feedbackItems: feedbackItems || []\r\n    };\r\n}\r\n\r\nfunction mergeFeedbackItems(baseItems, updates) {\r\n    const base = Array.isArray(baseItems) ? baseItems : [];\r\n    const incoming = Array.isArray(updates) ? updates : [];\r\n    if (base.length === 0) return incoming.filter(Boolean);\r\n\r\n    const baseIds = new Set();\r\n    const mergedBase = [];\r\n    const updateMap = new Map();\r\n\r\n    for (const item of incoming) {\r\n        if (item && item.id != null) {\r\n            updateMap.set(item.id, item);\r\n        }\r\n    }\r\n\r\n    for (const item of base) {\r\n        if (!item || item.id == null) continue;\r\n        baseIds.add(item.id);\r\n        mergedBase.push(updateMap.get(item.id) || item);\r\n    }\r\n\r\n    const newItems = [];\r\n    for (const item of incoming) {\r\n        if (item && item.id != null && !baseIds.has(item.id)) {\r\n            newItems.push(item);\r\n        }\r\n    }\r\n\r\n    return [...newItems, ...mergedBase];\r\n}\r\n\r\nasync function loadFeedbackItemsByStatus(index, limitPending, limitDone) {\r\n    const pendingLimit = Number.isInteger(limitPending) ? limitPending : null;\r\n    const doneLimit = Number.isInteger(limitDone) ? limitDone : null;\r\n\r\n    // PERFORMANCE FIX: Load all items in PARALLEL first, then filter by status\r\n    // Old approach: sequential for loop with await (SLOW!)\r\n    // New approach: Promise.all + filter (FAST!)\r\n    const allItems = await Promise.all(index.map((id) => loadFeedbackItem(id)));\r\n\r\n    const pending = [];\r\n    const done = [];\r\n\r\n    // Separate items by status\r\n    for (const item of allItems) {\r\n        if (!item) continue;\r\n        const status = item.status === 'done' ? 'done' : 'open';\r\n        if (status === 'done') {\r\n            done.push(item);\r\n        } else {\r\n            pending.push(item);\r\n        }\r\n    }\r\n\r\n    // Apply limits\r\n    const limitedPending = pendingLimit !== null ? pending.slice(0, pendingLimit) : pending;\r\n    const limitedDone = doneLimit !== null ? done.slice(0, doneLimit) : done;\r\n\r\n    return [...limitedPending, ...limitedDone];\r\n}\r\n\r\nasync function refreshFeedbackItemsFromIndex(options) {\r\n    const limitPending = options.limitPending;\r\n    const limitDone = options.limitDone;\r\n    const cacheKey = options.cacheKey || FEEDBACK_CACHE_KEY;\r\n    const cached = Array.isArray(options.cached) ? options.cached : [];\r\n    const onRefresh = typeof options.onRefresh === 'function' ? options.onRefresh : null;\r\n\r\n    try {\r\n        const index = await loadFeedbackIndex();\r\n        if (Array.isArray(index) && index.length > 0) {\r\n            let items = [];\r\n            if (Number.isInteger(limitPending) || Number.isInteger(limitDone)) {\r\n                items = await loadFeedbackItemsByStatus(index, limitPending, limitDone);\r\n            } else {\r\n                items = await Promise.all(index.map((id) => loadFeedbackItem(id)));\r\n            }\r\n            const merged = mergeFeedbackItems(cached, items.filter(Boolean));\r\n            persistFeedbackCache(cacheKey, merged);\r\n            if (onRefresh) onRefresh(merged);\r\n        }\r\n    } catch (error) {\r\n        console.error(\"Error refreshing feedback items:\", error);\r\n    }\r\n}\r\n\r\nasync function loadFeedbackItemsFromIndex(options = {}) {\r\n    // Simplified: Load feedbackItems as a simple array (like tasks/projects)\r\n    // Option C: Hybrid Approach - no index needed\r\n    let cached = [];\r\n    try {\r\n        const cacheKey = options.cacheKey || FEEDBACK_CACHE_KEY;\r\n        cached = options.useCache === false ? [] : loadFeedbackCache(cacheKey);\r\n        const preferCache = !!(options.preferCache && cached.length > 0);\r\n        \r\n        if (preferCache) {\r\n            // Return cached immediately, refresh in background\r\n            void loadData(\"feedbackItems\").then((items) => {\r\n                if (Array.isArray(items) && items.length > 0) {\r\n                    persistFeedbackCache(cacheKey, items);\r\n                    if (typeof options.onRefresh === \"function\") {\r\n                        options.onRefresh({ feedbackItems: items });\r\n                    }\r\n                }\r\n            }).catch(() => {});\r\n            return cached;\r\n        }\r\n\r\n        // Load from storage\r\n        const items = await loadData(\"feedbackItems\");\r\n        if (Array.isArray(items) && items.length > 0) {\r\n            persistFeedbackCache(cacheKey, items);\r\n            return items;\r\n        }\r\n\r\n        // Fallback to cache if storage is empty\r\n        return cached || [];\r\n    } catch (error) {\r\n        console.error(\"Error loading feedback items:\", error);\r\n        return cached || [];\r\n    }\r\n}\r\n\r\n/**\r\n * Load sort mode and manual task order\r\n * @returns {Promise<{sortMode: string, manualTaskOrder: Object}>}\r\n */\r\nexport async function loadSortState() {\r\n    try {\r\n        const [sortMode, manualTaskOrder] = await Promise.all([\r\n            loadData('sortMode'),\r\n            loadData('manualTaskOrder')\r\n        ]);\r\n\r\n        return {\r\n            // Back-compat: older versions used 'auto' to mean priority ordering\r\n            sortMode: (sortMode === 'auto' || !sortMode) ? 'priority' : sortMode,\r\n            manualTaskOrder: manualTaskOrder || { todo: [], progress: [], review: [], done: [] }\r\n        };\r\n    } catch (error) {\r\n        console.error(\"Error loading sort state:\", error);\r\n        return {\r\n            sortMode: 'priority',\r\n            manualTaskOrder: { todo: [], progress: [], review: [], done: [] }\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Load project colors map\r\n * @returns {Promise<Object>}\r\n */\r\nexport async function loadProjectColors() {\r\n    try {\r\n        const colors = await loadData(\"projectColors\");\r\n        return colors || {};\r\n    } catch (error) {\r\n        console.error(\"Error loading project colors:\", error);\r\n        return {};\r\n    }\r\n}\r\n\r\n/**\r\n * Save application settings (per user) to storage\r\n * @param {Object} settings - Settings object\r\n * @returns {Promise<void>}\r\n */\r\nexport async function saveSettings(settings) {\r\n    try {\r\n        await saveData(\"settings\", settings);\r\n    } catch (error) {\r\n        console.error(\"Error saving settings:\", error);\r\n        throw error;\r\n    }\r\n}\r\n\r\n/**\r\n * Load application settings (per user) from storage\r\n * @returns {Promise<Object>}\r\n */\r\nexport async function loadSettings() {\r\n    try {\r\n        const loaded = await loadData(\"settings\");\r\n        return loaded || {};\r\n    } catch (error) {\r\n        console.error(\"Error loading settings:\", error);\r\n        return {};\r\n    }\r\n}\r\n", "/**\r\n * String utility functions\r\n * Pure functions for string manipulation\r\n * No dependencies\r\n */\r\n\r\n/**\r\n * Capitalize the first letter of a string\r\n * @param {string} value - String to capitalize\r\n * @returns {string} String with first letter capitalized\r\n *\r\n * @example\r\n * capitalizeFirst('hello') // Returns: 'Hello'\r\n * capitalizeFirst('HELLO') // Returns: 'HELLO'\r\n * capitalizeFirst('') // Returns: ''\r\n */\r\nexport function capitalizeFirst(value) {\r\n    if (!value) return value;\r\n    return value.charAt(0).toUpperCase() + value.slice(1);\r\n}\r\n", "/**\r\n * Date utility functions\r\n * Pure functions for date formatting and conversion\r\n */\r\n\r\nimport { capitalizeFirst } from './string.js';\r\n\r\n/**\r\n * Check if string looks like DD/MM/YYYY or DD-MM-YYYY format\r\n * @param {string} s - Date string to check\r\n * @returns {boolean} True if matches DD/MM/YYYY pattern\r\n *\r\n * @example\r\n * looksLikeDMY('25/12/2025') // Returns: true\r\n * looksLikeDMY('2025-12-25') // Returns: false\r\n */\r\nexport function looksLikeDMY(s) {\r\n    return (\r\n        typeof s === \"string\" &&\r\n        /^\\d{1,2}[\\/\\-]\\d{1,2}[\\/\\-]\\d{4}$/.test(s.trim())\r\n    );\r\n}\r\n\r\n/**\r\n * Check if string looks like ISO YYYY-MM-DD format\r\n * @param {string} s - Date string to check\r\n * @returns {boolean} True if matches ISO date pattern\r\n *\r\n * @example\r\n * looksLikeISO('2025-12-25') // Returns: true\r\n * looksLikeISO('25/12/2025') // Returns: false\r\n */\r\nexport function looksLikeISO(s) {\r\n    return typeof s === \"string\" && /^\\d{4}-\\d{2}-\\d{2}$/.test(s.trim());\r\n}\r\n\r\n/**\r\n * Convert DD/MM/YYYY or DD-MM-YYYY to ISO YYYY-MM-DD\r\n * @param {string} s - Date string in DD/MM/YYYY format\r\n * @returns {string} ISO formatted date or original string if invalid\r\n *\r\n * @example\r\n * toISOFromDMY('25/12/2025') // Returns: '2025-12-25'\r\n * toISOFromDMY('invalid') // Returns: 'invalid'\r\n */\r\nexport function toISOFromDMY(s) {\r\n    if (!looksLikeDMY(s)) return s || \"\";\r\n    const parts = s.trim().split(/[\\/\\-]/);\r\n    const d = parseInt(parts[0], 10);\r\n    const m = parseInt(parts[1], 10);\r\n    const y = parseInt(parts[2], 10);\r\n    if (!d || !m || !y || d > 31 || m > 12) return \"\";\r\n    const dd = String(d).padStart(2, \"0\");\r\n    const mm = String(m).padStart(2, \"0\");\r\n    return `${y}-${mm}-${dd}`;\r\n}\r\n\r\n/**\r\n * Convert ISO YYYY-MM-DD to DD/MM/YYYY\r\n * @param {string} s - ISO date string\r\n * @returns {string} DD/MM/YYYY formatted date or original string if invalid\r\n *\r\n * @example\r\n * toDMYFromISO('2025-12-25') // Returns: '25/12/2025'\r\n * toDMYFromISO('invalid') // Returns: 'invalid'\r\n */\r\nexport function toDMYFromISO(s) {\r\n    if (!looksLikeISO(s)) return s || \"\";\r\n    const [y, m, d] = s.split(\"-\");\r\n    return `${d}/${m}/${y}`;\r\n}\r\n\r\n/**\r\n * Format date to DD/MM/YYYY for display\r\n * @param {string} s - Date string (ISO or DD/MM/YYYY)\r\n * @returns {string} Formatted date as DD/MM/YYYY\r\n *\r\n * @example\r\n * formatDate('2025-12-25') // Returns: '25/12/2025'\r\n * formatDate('25/12/2025') // Returns: '25/12/2025'\r\n * formatDate(null) // Returns: 'No date'\r\n */\r\nexport function formatDate(s) {\r\n    if (!s) return \"No date\";\r\n\r\n    // If it's already in dd/mm/yyyy format, just return it\r\n    if (looksLikeDMY(s)) {\r\n        return s.replace(/-/g, \"/\");\r\n    }\r\n\r\n    // If it's in ISO format, convert to dd/mm/yyyy\r\n    if (looksLikeISO(s)) {\r\n        const [y, m, d] = s.split(\"-\");\r\n        return `${d}/${m}/${y}`;\r\n    }\r\n\r\n    return \"No date\";\r\n}\r\n\r\n/**\r\n * Format date in human-friendly format (e.g. \"Oct 10, 2025\")\r\n * @param {string} s - Date string (ISO or DD/MM/YYYY)\r\n * @returns {string} Formatted date like \"Dec 25, 2025\"\r\n *\r\n * @example\r\n * formatDatePretty('2025-12-25') // Returns: 'Dec 25, 2025'\r\n * formatDatePretty(null) // Returns: 'No date'\r\n */\r\nexport function formatDatePretty(s, locale = undefined) {\r\n    if (!s) return \"No date\";\r\n    try {\r\n        // ISO yyyy-mm-dd\r\n        if (looksLikeISO(s)) {\r\n            const [y, m, d] = s.split(\"-\");\r\n            const date = new Date(parseInt(y, 10), parseInt(m, 10) - 1, parseInt(d, 10));\r\n            return date.toLocaleDateString(locale, { year: 'numeric', month: 'short', day: 'numeric' });\r\n        }\r\n\r\n        // dd/mm/yyyy or dd-mm-yyyy\r\n        if (looksLikeDMY(s)) {\r\n            const parts = s.split(/[\\/\\-]/);\r\n            const d = parseInt(parts[0], 10);\r\n            const m = parseInt(parts[1], 10);\r\n            const y = parseInt(parts[2], 10);\r\n            const date = new Date(y, m - 1, d);\r\n            return date.toLocaleDateString(locale, { year: 'numeric', month: 'short', day: 'numeric' });\r\n        }\r\n    } catch (e) {\r\n        // fallthrough\r\n    }\r\n    return \"No date\";\r\n}\r\n\r\n/**\r\n * Format activity timestamp in relative time (Today, Yesterday, 3d ago, etc.)\r\n * @param {string} dateString - ISO timestamp\r\n * @returns {string} Relative time description\r\n *\r\n * @example\r\n * formatActivityDate(new Date().toISOString()) // Returns: 'Today'\r\n * formatActivityDate('2025-12-20') // Returns: 'Dec 20' (if not recent)\r\n */\r\nexport function formatActivityDate(dateString) {\r\n    if (!dateString) return '';\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));\r\n\r\n    if (diffDays === 0) return 'Today';\r\n    if (diffDays === 1) return 'Yesterday';\r\n    if (diffDays < 7) return `${diffDays}d ago`;\r\n\r\n    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\r\n}\r\n\r\n/**\r\n * Get localized day names for calendar display\r\n * @param {string} locale - Locale string (e.g., 'en-US', 'es-ES')\r\n * @returns {string[]} Array of 7 day names starting from Monday\r\n *\r\n * @example\r\n * getCalendarDayNames('en-US') // Returns: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']\r\n */\r\nexport function getCalendarDayNames(locale) {\r\n    const formatter = new Intl.DateTimeFormat(locale, { weekday: 'short' });\r\n    const baseDate = new Date(2024, 0, 1); // Monday\r\n    return Array.from({ length: 7 }, (_, idx) => {\r\n        const label = formatter.format(new Date(baseDate.getFullYear(), baseDate.getMonth(), baseDate.getDate() + idx));\r\n        return capitalizeFirst(label);\r\n    });\r\n}\r\n\r\n/**\r\n * Format month and year for calendar header\r\n * @param {string} locale - Locale string (e.g., 'en-US', 'es-ES')\r\n * @param {number} year - Year number\r\n * @param {number} month - Month number (0-11)\r\n * @returns {string} Formatted month and year (e.g., 'January 2025')\r\n *\r\n * @example\r\n * formatCalendarMonthYear('en-US', 2025, 0) // Returns: 'January 2025'\r\n */\r\nexport function formatCalendarMonthYear(locale, year, month) {\r\n    const formatter = new Intl.DateTimeFormat(locale, { month: 'long', year: 'numeric' });\r\n    return capitalizeFirst(formatter.format(new Date(year, month, 1)));\r\n}\r\n\r\n/**\r\n * Strip time component from a Date, returning only the date at midnight\r\n * @param {Date} d - Date object to strip time from\r\n * @returns {Date} New Date object with time set to 00:00:00\r\n *\r\n * @example\r\n * stripTime(new Date('2025-12-25T14:30:00')) // Returns: Date for 2025-12-25T00:00:00\r\n */\r\nexport function stripTime(d) {\r\n    return new Date(d.getFullYear(), d.getMonth(), d.getDate());\r\n}\r\n", "/**\r\n * Task Service\r\n * Handles task CRUD operations and business logic\r\n * Pure data operations - UI updates handled by caller\r\n */\r\n\r\nimport { looksLikeDMY, looksLikeISO, toISOFromDMY } from \"../utils/date.js\";\r\n\r\n/**\r\n * Create a new task\r\n * @param {Object} taskData - Task data from form\r\n * @param {Array} tasks - Current tasks array\r\n * @param {number} taskCounter - Current task counter\r\n * @param {Array} tempAttachments - Temporary attachments array\r\n * @returns {{task: Object, tasks: Array, taskCounter: number}} Created task and updated arrays\r\n */\r\nexport function createTask(taskData, tasks, taskCounter, tempAttachments = []) {\r\n    const now = new Date().toISOString();\r\n    const startDate = taskData.startDate || \"\";\r\n    const endDate = taskData.endDate || \"\";\r\n    const newTask = {\r\n        id: taskCounter,\r\n        title: taskData.title || \"\",\r\n        description: taskData.description || \"\",\r\n        projectId: taskData.projectId ? parseInt(taskData.projectId, 10) : null,\r\n        startDate,\r\n        endDate,\r\n        startDateWasEverSet: typeof startDate === 'string' && startDate.trim() !== \"\",\r\n        endDateWasEverSet: typeof endDate === 'string' && endDate.trim() !== \"\",\r\n        priority: taskData.priority || \"medium\",\r\n        status: taskData.status || \"todo\",\r\n        tags: taskData.tags || [],\r\n        attachments: tempAttachments.length > 0 ? [...tempAttachments] : [],\r\n        createdAt: now,\r\n        updatedAt: now,\r\n    };\r\n\r\n    const updatedTasks = [...tasks, newTask];\r\n    const updatedCounter = taskCounter + 1;\r\n\r\n    return {\r\n        task: newTask,\r\n        tasks: updatedTasks,\r\n        taskCounter: updatedCounter\r\n    };\r\n}\r\n\r\n/**\r\n * Update an existing task\r\n * @param {number} taskId - ID of task to update\r\n * @param {Object} taskData - Updated task data\r\n * @param {Array} tasks - Current tasks array\r\n * @returns {{task: Object|null, tasks: Array, oldProjectId: number|null}} Updated task and arrays\r\n */\r\nexport function updateTask(taskId, taskData, tasks) {\r\n    const taskIndex = tasks.findIndex(t => t.id === parseInt(taskId, 10));\r\n\r\n    if (taskIndex === -1) {\r\n        return { task: null, tasks, oldProjectId: null };\r\n    }\r\n\r\n    const oldTask = tasks[taskIndex];\r\n    const oldProjectId = oldTask.projectId;\r\n\r\n    const nextProjectId = taskData.projectId !== undefined\r\n        ? (taskData.projectId ? parseInt(taskData.projectId, 10) : null)\r\n        : oldTask.projectId;\r\n\r\n    const updatedTask = {\r\n        ...oldTask,\r\n        title: taskData.title !== undefined ? taskData.title : oldTask.title,\r\n        description: taskData.description !== undefined ? taskData.description : oldTask.description,\r\n        projectId: nextProjectId,\r\n        startDate: taskData.startDate !== undefined ? taskData.startDate : oldTask.startDate,\r\n        endDate: taskData.endDate !== undefined ? taskData.endDate : oldTask.endDate,\r\n        priority: taskData.priority !== undefined ? taskData.priority : oldTask.priority,\r\n        status: taskData.status !== undefined ? taskData.status : oldTask.status,\r\n    };\r\n\r\n    if (taskData.startDate !== undefined && typeof updatedTask.startDate === 'string' && updatedTask.startDate.trim() !== \"\") {\r\n        updatedTask.startDateWasEverSet = true;\r\n    }\r\n    if (taskData.endDate !== undefined && typeof updatedTask.endDate === 'string' && updatedTask.endDate.trim() !== \"\") {\r\n        updatedTask.endDateWasEverSet = true;\r\n    }\r\n\r\n    const changed =\r\n        updatedTask.title !== oldTask.title ||\r\n        updatedTask.description !== oldTask.description ||\r\n        updatedTask.projectId !== oldTask.projectId ||\r\n        updatedTask.startDate !== oldTask.startDate ||\r\n        updatedTask.endDate !== oldTask.endDate ||\r\n        updatedTask.priority !== oldTask.priority ||\r\n        updatedTask.status !== oldTask.status;\r\n\r\n    if (!changed) {\r\n        return {\r\n            task: oldTask,\r\n            tasks,\r\n            oldProjectId\r\n        };\r\n    }\r\n\r\n    updatedTask.updatedAt = new Date().toISOString();\r\n\r\n    const updatedTasks = [...tasks];\r\n    updatedTasks[taskIndex] = updatedTask;\r\n\r\n    return {\r\n        task: updatedTask,\r\n        tasks: updatedTasks,\r\n        oldProjectId\r\n    };\r\n}\r\n\r\n/**\r\n * Update a single field of a task\r\n * @param {number} taskId - ID of task to update\r\n * @param {string} field - Field name to update\r\n * @param {any} value - New value for the field\r\n * @param {Array} tasks - Current tasks array\r\n * @returns {{task: Object|null, tasks: Array, oldProjectId: number|null}} Updated task and arrays\r\n */\r\nexport function updateTaskField(taskId, field, value, tasks, settings = {\r\n    autoSetStartDateOnStatusChange: false,\r\n    autoSetEndDateOnStatusChange: false\r\n}) {\r\n    const taskIndex = tasks.findIndex(t => t.id === parseInt(taskId, 10));\r\n\r\n    if (taskIndex === -1) {\r\n        return { task: null, tasks, oldProjectId: null };\r\n    }\r\n\r\n    const oldTask = tasks[taskIndex];\r\n    const oldProjectId = oldTask.projectId;\r\n    const updatedTask = { ...oldTask };\r\n\r\n    const prevStartDate = oldTask.startDate;\r\n    const prevEndDate = oldTask.endDate;\r\n    const prevCompletedDate = oldTask.completedDate;\r\n\r\n    // Handle date fields with conversion\r\n    if (field === 'startDate' || field === 'endDate') {\r\n        const iso = looksLikeDMY(value) ? toISOFromDMY(value)\r\n            : looksLikeISO(value) ? value\r\n            : \"\";\r\n        updatedTask[field] = iso;\r\n        if (iso) {\r\n            if (field === 'startDate') updatedTask.startDateWasEverSet = true;\r\n            if (field === 'endDate') updatedTask.endDateWasEverSet = true;\r\n        }\r\n    } else if (field === 'projectId') {\r\n        updatedTask.projectId = value ? parseInt(value, 10) : null;\r\n    } else {\r\n        updatedTask[field] = value;\r\n    }\r\n\r\n    // Auto-set dates when status changes (if setting is enabled)\r\n    if (field === 'status' && (settings.autoSetStartDateOnStatusChange || settings.autoSetEndDateOnStatusChange)) {\r\n        const today = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format\r\n\r\n        // Auto-set startDate when moving to \"In Progress\" (if empty)\r\n        if (settings.autoSetStartDateOnStatusChange && value === 'progress' && !updatedTask.startDate) {\r\n            updatedTask.startDate = today;\r\n            updatedTask.startDateWasEverSet = true;\r\n        }\r\n\r\n        // Auto-set endDate when moving to \"Done\" (if empty)\r\n        if (settings.autoSetEndDateOnStatusChange && value === 'done' && !updatedTask.endDate) {\r\n            updatedTask.endDate = today;\r\n            updatedTask.endDateWasEverSet = true;\r\n        }\r\n    }\r\n\r\n    // Set completedDate when task is marked as done\r\n    if (field === 'status' && value === 'done' && !updatedTask.completedDate) {\r\n        updatedTask.completedDate = new Date().toISOString();\r\n    }\r\n\r\n    let changed;\r\n    if (field === 'projectId') {\r\n        changed = updatedTask.projectId !== oldTask.projectId;\r\n    } else {\r\n        changed = updatedTask[field] !== oldTask[field];\r\n    }\r\n\r\n    // Status changes can also auto-set date fields / completedDate\r\n    if (field === 'status') {\r\n        if (updatedTask.startDate !== prevStartDate) changed = true;\r\n        if (updatedTask.endDate !== prevEndDate) changed = true;\r\n        if (updatedTask.completedDate !== prevCompletedDate) changed = true;\r\n    }\r\n\r\n    if (!changed) {\r\n        return {\r\n            task: oldTask,\r\n            tasks,\r\n            oldProjectId\r\n        };\r\n    }\r\n\r\n    updatedTask.updatedAt = new Date().toISOString();\r\n\r\n    const updatedTasks = [...tasks];\r\n    updatedTasks[taskIndex] = updatedTask;\r\n\r\n    return {\r\n        task: updatedTask,\r\n        tasks: updatedTasks,\r\n        oldProjectId\r\n    };\r\n}\r\n\r\n/**\r\n * Delete a task\r\n * @param {number} taskId - ID of task to delete\r\n * @param {Array} tasks - Current tasks array\r\n * @returns {{task: Object|null, tasks: Array, projectId: number|null}} Deleted task info and updated array\r\n */\r\nexport function deleteTask(taskId, tasks) {\r\n    const task = tasks.find(t => t.id === parseInt(taskId, 10));\r\n\r\n    if (!task) {\r\n        return { task: null, tasks, projectId: null };\r\n    }\r\n\r\n    const projectId = task.projectId;\r\n    const updatedTasks = tasks.filter(t => t.id !== parseInt(taskId, 10));\r\n\r\n    return {\r\n        task,\r\n        tasks: updatedTasks,\r\n        projectId\r\n    };\r\n}\r\n\r\n/**\r\n * Duplicate a task\r\n * @param {number} taskId - ID of task to duplicate\r\n * @param {Array} tasks - Current tasks array\r\n * @param {number} taskCounter - Current task counter\r\n * @returns {{task: Object|null, tasks: Array, taskCounter: number}} Duplicated task and updated arrays\r\n */\r\nexport function duplicateTask(taskId, tasks, taskCounter) {\r\n    const original = tasks.find(t => t.id === parseInt(taskId, 10));\r\n\r\n    if (!original) {\r\n        return { task: null, tasks, taskCounter };\r\n    }\r\n\r\n    // Build a new title with \"Copy \" prefix if not already\r\n    const baseTitle = original.title || \"Untitled\";\r\n    const newTitle = baseTitle.startsWith(\"Copy \") ? baseTitle : `Copy ${baseTitle}`;\r\n\r\n    const now = new Date().toISOString();\r\n    const cloned = {\r\n        id: taskCounter,\r\n        title: newTitle,\r\n        description: original.description || \"\",\r\n        projectId: original.projectId ?? null,\r\n        startDate: original.startDate || \"\",\r\n        endDate: original.endDate || \"\",\r\n        startDateWasEverSet: !!original.startDateWasEverSet || (!!original.startDate && String(original.startDate).trim() !== \"\"),\r\n        endDateWasEverSet: !!original.endDateWasEverSet || (!!original.endDate && String(original.endDate).trim() !== \"\"),\r\n        priority: original.priority || \"medium\",\r\n        status: original.status || \"todo\",\r\n        tags: Array.isArray(original.tags) ? [...original.tags] : [],\r\n        attachments: Array.isArray(original.attachments)\r\n            ? original.attachments.map(a => ({...a}))\r\n            : [],\r\n        createdAt: now,\r\n        updatedAt: now,\r\n    };\r\n\r\n    const updatedTasks = [...tasks, cloned];\r\n    const updatedCounter = taskCounter + 1;\r\n\r\n    return {\r\n        task: cloned,\r\n        tasks: updatedTasks,\r\n        taskCounter: updatedCounter\r\n    };\r\n}\r\n\r\n/**\r\n * Validate task data\r\n * @param {Object} taskData - Task data to validate\r\n * @returns {{valid: boolean, errors: Array<string>}} Validation result\r\n */\r\nexport function validateTask(taskData) {\r\n    const errors = [];\r\n\r\n    if (!taskData.title || taskData.title.trim() === \"\") {\r\n        errors.push(\"Title is required\");\r\n    }\r\n\r\n    if (taskData.priority && !['low', 'medium', 'high'].includes(taskData.priority)) {\r\n        errors.push(\"Invalid priority value\");\r\n    }\r\n\r\n    if (taskData.status && !['todo', 'progress', 'review', 'done'].includes(taskData.status)) {\r\n        errors.push(\"Invalid status value\");\r\n    }\r\n\r\n    return {\r\n        valid: errors.length === 0,\r\n        errors\r\n    };\r\n}\r\n", "/**\r\n * Project Service\r\n *\r\n * Handles all project CRUD operations.\r\n * Returns immutable updates (new arrays) rather than mutating state.\r\n */\r\n\r\nimport { looksLikeDMY, looksLikeISO, toISOFromDMY } from \"../utils/date.js\";\r\n\r\n/**\r\n * Create a new project\r\n * @param {Object} projectData - Project data { name, description, startDate, endDate }\r\n * @param {Array} projects - Current projects array\r\n * @param {number} projectCounter - Current project counter\r\n * @returns {Object} { project, projects, projectCounter }\r\n */\r\nexport function createProject(projectData, projects, projectCounter) {\r\n    const newProject = {\r\n        id: projectCounter,\r\n        name: projectData.name || \"\",\r\n        description: projectData.description || \"\",\r\n        startDate: projectData.startDate || \"\",\r\n        endDate: projectData.endDate || \"\",\r\n        tags: projectData.tags || [],\r\n        createdAt: new Date().toISOString(),\r\n    };\r\n\r\n    const updatedProjects = [...projects, newProject];\r\n    const updatedCounter = projectCounter + 1;\r\n\r\n    return {\r\n        project: newProject,\r\n        projects: updatedProjects,\r\n        projectCounter: updatedCounter\r\n    };\r\n}\r\n\r\n/**\r\n * Update an existing project\r\n * @param {number} projectId - Project ID to update\r\n * @param {Object} projectData - Updated project data\r\n * @param {Array} projects - Current projects array\r\n * @returns {Object} { project, projects } - Updated project and array (or null if not found)\r\n */\r\nexport function updateProject(projectId, projectData, projects) {\r\n    const projectIndex = projects.findIndex(p => p.id === parseInt(projectId, 10));\r\n    if (projectIndex === -1) {\r\n        return { project: null, projects };\r\n    }\r\n\r\n    const oldProject = projects[projectIndex];\r\n    const updatedProject = {\r\n        ...oldProject,\r\n        name: projectData.name !== undefined ? projectData.name : oldProject.name,\r\n        description: projectData.description !== undefined ? projectData.description : oldProject.description,\r\n        startDate: projectData.startDate !== undefined ? projectData.startDate : oldProject.startDate,\r\n        endDate: projectData.endDate !== undefined ? projectData.endDate : oldProject.endDate,\r\n        tags: projectData.tags !== undefined ? projectData.tags : oldProject.tags,\r\n    };\r\n\r\n    const updatedProjects = [...projects];\r\n    updatedProjects[projectIndex] = updatedProject;\r\n\r\n    return {\r\n        project: updatedProject,\r\n        projects: updatedProjects\r\n    };\r\n}\r\n\r\n/**\r\n * Update a single field of a project\r\n * @param {number} projectId - Project ID to update\r\n * @param {string} field - Field name to update\r\n * @param {any} value - New value for the field\r\n * @param {Array} projects - Current projects array\r\n * @returns {Object} { project, projects } - Updated project and array (or null if not found)\r\n */\r\nexport function updateProjectField(projectId, field, value, projects) {\r\n    const projectIndex = projects.findIndex(p => p.id === parseInt(projectId, 10));\r\n    if (projectIndex === -1) {\r\n        return { project: null, projects };\r\n    }\r\n\r\n    const oldProject = projects[projectIndex];\r\n    const updatedProject = { ...oldProject };\r\n\r\n    // Handle date fields with conversion\r\n    if (field === 'startDate' || field === 'endDate') {\r\n        const iso = looksLikeDMY(value) ? toISOFromDMY(value)\r\n            : looksLikeISO(value) ? value\r\n            : \"\";\r\n        updatedProject[field] = iso;\r\n    } else {\r\n        updatedProject[field] = value;\r\n    }\r\n\r\n    const updatedProjects = [...projects];\r\n    updatedProjects[projectIndex] = updatedProject;\r\n\r\n    return {\r\n        project: updatedProject,\r\n        projects: updatedProjects\r\n    };\r\n}\r\n\r\n/**\r\n * Delete a project (optionally clearing task associations)\r\n * @param {number} projectId - Project ID to delete\r\n * @param {Array} projects - Current projects array\r\n * @param {Array} tasks - Current tasks array (optional)\r\n * @param {boolean} clearTaskAssociations - If true, set tasks' projectId to null\r\n * @returns {Object} { project, projects, tasks } - Deleted project and updated arrays\r\n */\r\nexport function deleteProject(projectId, projects, tasks = null, clearTaskAssociations = false) {\r\n    const project = projects.find(p => p.id === parseInt(projectId, 10));\r\n    if (!project) {\r\n        return { project: null, projects, tasks };\r\n    }\r\n\r\n    const updatedProjects = projects.filter(p => p.id !== parseInt(projectId, 10));\r\n\r\n    // Handle task associations if tasks array provided\r\n    let updatedTasks = tasks;\r\n    if (tasks && clearTaskAssociations) {\r\n        updatedTasks = tasks.map(t => {\r\n            if (t.projectId === parseInt(projectId, 10)) {\r\n                return { ...t, projectId: null };\r\n            }\r\n            return t;\r\n        });\r\n    }\r\n\r\n    return {\r\n        project,\r\n        projects: updatedProjects,\r\n        tasks: updatedTasks\r\n    };\r\n}\r\n\r\n/**\r\n * Get tasks associated with a project\r\n * @param {number} projectId - Project ID\r\n * @param {Array} tasks - Tasks array\r\n * @returns {Array} Tasks belonging to the project\r\n */\r\nexport function getProjectTasks(projectId, tasks) {\r\n    return tasks.filter(t => t.projectId === parseInt(projectId, 10));\r\n}\r\n\r\n/**\r\n * Validate project data\r\n * @param {Object} projectData - Project data to validate\r\n * @returns {Object} { valid: boolean, errors: string[] }\r\n */\r\nexport function validateProject(projectData) {\r\n    const errors = [];\r\n\r\n    if (!projectData.name || projectData.name.trim() === \"\") {\r\n        errors.push(\"Project name is required\");\r\n    }\r\n\r\n    // Validate date format if provided\r\n    if (projectData.startDate && !looksLikeISO(projectData.startDate)) {\r\n        errors.push(\"Invalid start date format (expected YYYY-MM-DD)\");\r\n    }\r\n\r\n    if (projectData.endDate && !looksLikeISO(projectData.endDate)) {\r\n        errors.push(\"Invalid end date format (expected YYYY-MM-DD)\");\r\n    }\r\n\r\n    // Validate date logic if both provided\r\n    if (projectData.startDate && projectData.endDate) {\r\n        const start = new Date(projectData.startDate);\r\n        const end = new Date(projectData.endDate);\r\n        if (end < start) {\r\n            errors.push(\"End date cannot be before start date\");\r\n        }\r\n    }\r\n\r\n    return {\r\n        valid: errors.length === 0,\r\n        errors\r\n    };\r\n}\r\n", "/**\r\n * HTML utility functions\r\n * Pure functions for HTML escaping and sanitization\r\n * No dependencies\r\n */\r\n\r\n/**\r\n * Escape HTML special characters to prevent XSS\r\n * @param {string} str - String to escape\r\n * @returns {string} Escaped string safe for HTML insertion\r\n *\r\n * @example\r\n * escapeHtml('<script>alert(\"xss\")</script>')\r\n * // Returns: '&lt;script&gt;alert(&quot;xss&quot;)&lt;/script&gt;'\r\n */\r\nexport function escapeHtml(str) {\r\n    return (str || \"\").replace(\r\n        /[&<>\"']/g,\r\n        (m) =>\r\n            ({\r\n                \"&\": \"&amp;\",\r\n                \"<\": \"&lt;\",\r\n                \">\": \"&gt;\",\r\n                '\"': \"&quot;\",\r\n                \"'\": \"&#39;\",\r\n            }[m])\r\n    );\r\n}\r\n\r\n/**\r\n * Sanitize user input by escaping HTML and trimming whitespace\r\n * @param {string} input - User input to sanitize\r\n * @returns {string} Sanitized string\r\n *\r\n * @example\r\n * sanitizeInput('  <b>Hello</b>  ')\r\n * // Returns: '&lt;b&gt;Hello&lt;/b&gt;'\r\n */\r\nexport function sanitizeInput(input) {\r\n    if (!input) return '';\r\n    return escapeHtml(String(input).trim());\r\n}\r\n", "/**\r\n * Color utility constants\r\n * Color palettes for tags and projects\r\n * No dependencies\r\n */\r\n\r\n/**\r\n * Tag color palette - darker, high-contrast colors for white text legibility\r\n * Each color is carefully selected for accessibility and readability\r\n */\r\nexport const TAG_COLORS = [\r\n    // Darker, high-contrast colors for reliable white text legibility\r\n    '#dc2626', // red-600\r\n    '#ea580c', // orange-600\r\n    '#b45309', // amber-700\r\n    '#ca8a04', // yellow-700 (darker)\r\n    '#16a34a', // green-600\r\n    '#059669', // emerald-600\r\n    '#0ea5a4', // teal-500\r\n    '#0284c7', // blue-600\r\n    '#0369a1', // sky-700\r\n    '#4338ca', // indigo-700\r\n    '#7c3aed', // violet-600\r\n    '#6b21a8', // purple-800\r\n    '#be185d', // pink-600\r\n    '#e11d48', // rose-600\r\n    '#065f46', // emerald-800 (deep)\r\n    '#334155'  // slate-700 neutral\r\n];\r\n\r\n/**\r\n * Project color palette - optimized for dark mode with white text\r\n * Each color provides good contrast against dark backgrounds\r\n */\r\nexport const PROJECT_COLORS = [\r\n    '#6C5CE7', // Purple - good contrast\r\n    '#3742FA', // Indigo - good contrast\r\n    '#E84393', // Pink - good contrast\r\n    '#00B894', // Teal - good contrast\r\n    '#74B9FF', // Light blue - replaced with darker blue\r\n    '#0984E3', // Blue - better contrast than light blue\r\n    '#0891b2', // Cyan-600 - darker cyan for better tag readability\r\n    '#E17055', // Orange - good contrast\r\n    '#9B59B6', // Purple variant - good contrast\r\n    '#2F3542', // Dark gray - good contrast\r\n    '#FF3838', // Red - good contrast\r\n    '#6C5B7B', // Mauve - good contrast\r\n    '#C44569', // Berry - good contrast\r\n    '#F8B500', // Amber - good contrast\r\n    '#5758BB'  // Deep purple - good contrast\r\n];\r\n\r\n/**\r\n * Convert a hex color to RGBA format\r\n * @param {string} hex - Hex color code (e.g., '#ff0000' or '#f00')\r\n * @param {number} alpha - Alpha value between 0 and 1 (default: 1)\r\n * @returns {string} RGBA color string (e.g., 'rgba(255, 0, 0, 1)')\r\n *\r\n * @example\r\n * hexToRGBA('#ff0000', 0.5) // Returns: 'rgba(255, 0, 0, 0.5)'\r\n * hexToRGBA('#f00', 0.5)    // Returns: 'rgba(255, 0, 0, 0.5)'\r\n */\r\nexport function hexToRGBA(hex = '', alpha = 1) {\r\n    if (!hex) return '';\r\n    const cleaned = hex.replace('#', '').trim();\r\n    const normalized = cleaned.length === 3\r\n        ? cleaned.split('').map((char) => char + char).join('')\r\n        : cleaned;\r\n    if (normalized.length < 6) return '';\r\n    const values = [0, 2, 4].map((offset) => parseInt(normalized.substr(offset, 2), 16) || 0);\r\n    return `rgba(${values[0]}, ${values[1]}, ${values[2]}, ${alpha})`;\r\n}\r\n", "/**\r\n * Application constants\r\n * Status, priority labels and orderings\r\n * No dependencies\r\n */\r\n\r\n/**\r\n * Valid task statuses\r\n */\r\nexport const VALID_STATUSES = ['backlog', 'todo', 'progress', 'review', 'done'];\r\n\r\n/**\r\n * Valid task priorities\r\n */\r\nexport const VALID_PRIORITIES = ['low', 'medium', 'high'];\r\n\r\n/**\r\n * Human-readable status labels\r\n * Maps status values to display labels\r\n */\r\nexport const STATUS_LABELS = {\r\n    backlog: \"Backlog\",\r\n    todo: \"To Do\",\r\n    progress: \"In Progress\",\r\n    review: \"In Review\",\r\n    done: \"Done\"\r\n};\r\n\r\n/**\r\n * Human-readable priority labels\r\n * Maps priority values to display labels\r\n */\r\nexport const PRIORITY_LABELS = {\r\n    low: \"Low\",\r\n    medium: \"Medium\",\r\n    high: \"High\"\r\n};\r\n\r\n/**\r\n * Priority ordering for sorting (descending)\r\n * Higher number = higher priority\r\n * Used for sorting tasks high to low priority\r\n */\r\nexport const PRIORITY_ORDER = {\r\n    high: 3,\r\n    medium: 2,\r\n    low: 1\r\n};\r\n\r\n/**\r\n * Status ordering for sorting (ascending)\r\n * Lower number = earlier in workflow\r\n * Used for sorting tasks by completion stage\r\n */\r\nexport const STATUS_ORDER = {\r\n    done: 1,\r\n    progress: 2,\r\n    review: 3,\r\n    todo: 4,\r\n    backlog: 5\r\n};\r\n\r\n/**\r\n * All priority options for dropdowns\r\n */\r\nexport const PRIORITY_OPTIONS = [\r\n    { value: \"high\", label: \"High\" },\r\n    { value: \"medium\", label: \"Medium\" },\r\n    { value: \"low\", label: \"Low\" }\r\n];\r\n\r\n/**\r\n * Priority color mappings for visual indicators\r\n */\r\nexport const PRIORITY_COLORS = {\r\n    high: \"var(--accent-red)\",\r\n    medium: \"var(--accent-amber)\",\r\n    low: \"var(--accent-green)\"\r\n};\r\n", "export const RELEASE_NOTES = [\r\n    {\r\n        id: \"2026.01.06\",\r\n        version: \"2.7.0\",\r\n        title: {\r\n            en: \"Signal and Flow\",\r\n            es: \"Se\u00F1al y flujo\"\r\n        },\r\n        date: \"2026-01-06\",\r\n        summary: {\r\n            en: \"A focused release that makes changes visible and deadlines clearer.\",\r\n            es: \"Una versi\u00F3n enfocada que hace visibles los cambios y aclara los plazos.\"\r\n        },\r\n        sections: {\r\n            new: [\r\n                {\r\n                    en: \"Release Notes page with a clean breakdown of changes.\",\r\n                    es: \"P\u00E1gina de notas de versi\u00F3n con un desglose claro de cambios.\"\r\n                },\r\n                {\r\n                    en: \"Top bar notification bell for new releases.\",\r\n                    es: \"Campana de notificaciones en la barra superior para nuevas versiones.\"\r\n                },\r\n                {\r\n                    en: \"Due today reminders with quick navigation.\",\r\n                    es: \"Recordatorios de vencimiento hoy con navegaci\u00F3n r\u00E1pida.\"\r\n                }\r\n            ],\r\n            improvements: [\r\n                {\r\n                    en: \"Updates page tuned for fast scanning.\",\r\n                    es: \"P\u00E1gina de novedades ajustada para lectura r\u00E1pida.\"\r\n                },\r\n                {\r\n                    en: \"Notification badge aggregates releases and due today tasks.\",\r\n                    es: \"La insignia de notificaciones agrupa versiones y tareas que vencen hoy.\"\r\n                },\r\n                {\r\n                    en: \"Release dates formatted per locale.\",\r\n                    es: \"Fechas de versi\u00F3n formateadas seg\u00FAn la configuraci\u00F3n regional.\"\r\n                }\r\n            ],\r\n            fixes: [\r\n                {\r\n                    en: \"Notifications now stay focused on tasks due today.\",\r\n                    es: \"Las notificaciones ahora se enfocan en tareas que vencen hoy.\"\r\n                },\r\n                {\r\n                    en: \"Release history stays consistent across sessions.\",\r\n                    es: \"El historial de versiones se mantiene consistente entre sesiones.\"\r\n                }\r\n            ]\r\n        }\r\n    },\r\n    {\r\n        id: \"2025.12.20\",\r\n        version: \"2.6.1\",\r\n        title: {\r\n            en: \"Stability Pass\",\r\n            es: \"Pase de estabilidad\"\r\n        },\r\n        date: \"2025-12-20\",\r\n        summary: {\r\n            en: \"Polish across projects, tasks, and reporting.\",\r\n            es: \"Pulido en proyectos, tareas y reportes.\"\r\n        },\r\n        sections: {\r\n            new: [\r\n                {\r\n                    en: \"Task sorting refinements in list view.\",\r\n                    es: \"Mejoras en el ordenamiento de tareas en vista de lista.\"\r\n                },\r\n                {\r\n                    en: \"Improved history timeline labels.\",\r\n                    es: \"Etiquetas mejoradas en la l\u00EDnea de tiempo del historial.\"\r\n                }\r\n            ],\r\n            improvements: [\r\n                {\r\n                    en: \"Cleaner spacing for project detail views.\",\r\n                    es: \"Espaciado m\u00E1s limpio en vistas de detalle de proyecto.\"\r\n                },\r\n                {\r\n                    en: \"Faster dashboard rendering on large datasets.\",\r\n                    es: \"Renderizado del panel m\u00E1s r\u00E1pido con datos grandes.\"\r\n                }\r\n            ],\r\n            fixes: [\r\n                {\r\n                    en: \"Resolved occasional drag reorder glitches.\",\r\n                    es: \"Corregidos fallos ocasionales al reordenar arrastrando.\"\r\n                },\r\n                {\r\n                    en: \"Fixed missing labels in calendar tooltips.\",\r\n                    es: \"Corregidas etiquetas faltantes en los tooltips del calendario.\"\r\n                }\r\n            ]\r\n        }\r\n    },\r\n    {\r\n        id: \"2025.12.04\",\r\n        version: \"2.6.0\",\r\n        title: {\r\n            en: \"Project Clarity\",\r\n            es: \"Claridad de proyecto\"\r\n        },\r\n        date: \"2025-12-04\",\r\n        summary: {\r\n            en: \"Better project visibility and smarter filters.\",\r\n            es: \"Mejor visibilidad de proyectos y filtros m\u00E1s inteligentes.\"\r\n        },\r\n        sections: {\r\n            new: [\r\n                {\r\n                    en: \"Enhanced project filters for recency.\",\r\n                    es: \"Filtros de proyectos mejorados por recencia.\"\r\n                },\r\n                {\r\n                    en: \"Quick access backlog button in Kanban.\",\r\n                    es: \"Bot\u00F3n de acceso r\u00E1pido al backlog en Kanban.\"\r\n                }\r\n            ],\r\n            improvements: [\r\n                {\r\n                    en: \"Refined status badges for contrast.\",\r\n                    es: \"Insignias de estado refinadas para mejor contraste.\"\r\n                },\r\n                {\r\n                    en: \"Clearer labels across filters and chips.\",\r\n                    es: \"Etiquetas m\u00E1s claras en filtros y chips.\"\r\n                }\r\n            ],\r\n            fixes: [\r\n                {\r\n                    en: \"Fixed filter chips not clearing on reset.\",\r\n                    es: \"Corregido que los chips de filtros no se limpiaban al restablecer.\"\r\n                },\r\n                {\r\n                    en: \"Resolved layout shifts in mobile task list.\",\r\n                    es: \"Corregidos saltos de dise\u00F1o en la lista de tareas m\u00F3vil.\"\r\n                }\r\n            ]\r\n        }\r\n    }\r\n];\r\n", "/**\r\n * Debug and logging utilities\r\n * Provides conditional debug logging with timing support\r\n * No dependencies\r\n */\r\n\r\nconst DEBUG_LOG_LOCALSTORAGE_KEY = \"debugLogsEnabled\";\r\nconst debugTimers = new Map();\r\n\r\n// Track page load start time for performance measurement\r\nconst PAGE_LOAD_START = (typeof window !== \"undefined\" && typeof window.__pageLoadStart === \"number\")\r\n    ? window.__pageLoadStart\r\n    : (typeof performance !== \"undefined\" ? performance.now() : Date.now());\r\n\r\n/**\r\n * Get time since page load started\r\n * @returns {number} Milliseconds since page load\r\n */\r\nexport function getTimeSincePageLoad() {\r\n    const now = typeof performance !== \"undefined\" ? performance.now() : Date.now();\r\n    return Math.round(now - PAGE_LOAD_START);\r\n}\r\n\r\n/**\r\n * Log a performance milestone with time since page load\r\n * @param {string} milestone - Name of the milestone\r\n * @param {Object} [meta] - Optional metadata\r\n */\r\nexport function logPerformanceMilestone(milestone, meta) {\r\n    if (!isDebugLogsEnabled()) return;\r\n    const timeSinceLoad = getTimeSincePageLoad();\r\n    console.log(`[perf] ${milestone} @ ${timeSinceLoad}ms`, meta || '');\r\n}\r\n\r\n/**\r\n * Apply debug log setting and persist to localStorage\r\n * @param {boolean} enabled - Whether debug logs should be enabled\r\n */\r\nexport function applyDebugLogSetting(enabled) {\r\n    const next = !!enabled;\r\n    window.debugLogsEnabled = next;\r\n    try {\r\n        localStorage.setItem(DEBUG_LOG_LOCALSTORAGE_KEY, String(next));\r\n    } catch (e) {\r\n        // localStorage may be unavailable\r\n    }\r\n}\r\n\r\n/**\r\n * Check if debug logs are enabled\r\n * @returns {boolean} True if debug logging is enabled\r\n */\r\nexport function isDebugLogsEnabled() {\r\n    if (typeof window.debugLogsEnabled === \"boolean\") return window.debugLogsEnabled;\r\n    try {\r\n        return localStorage.getItem(DEBUG_LOG_LOCALSTORAGE_KEY) === \"true\";\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/**\r\n * Log a debug message with optional metadata\r\n * @param {string} scope - The logging scope/category\r\n * @param {string} message - The message to log\r\n * @param {Object} [meta] - Optional metadata object\r\n */\r\nexport function logDebug(scope, message, meta) {\r\n    if (!isDebugLogsEnabled()) return;\r\n    if (meta) {\r\n        console.log(`[debug:${scope}] ${message}`, meta);\r\n    } else {\r\n        console.log(`[debug:${scope}] ${message}`);\r\n    }\r\n}\r\n\r\n/**\r\n * Start a debug timer for performance measurement\r\n * @param {string} scope - The logging scope/category\r\n * @param {string} label - Timer label\r\n * @param {Object} [meta] - Optional metadata object\r\n * @returns {string|undefined} Timer key for use with debugTimeEnd\r\n */\r\nexport function debugTimeStart(scope, label, meta) {\r\n    if (!isDebugLogsEnabled()) return;\r\n    const key = `${scope}:${label}:${Date.now()}-${Math.random().toString(36).slice(2)}`;\r\n    debugTimers.set(key, (typeof performance !== \"undefined\" && performance.now) ? performance.now() : Date.now());\r\n    logDebug(scope, `${label}:start`, meta);\r\n    return key;\r\n}\r\n\r\n/**\r\n * End a debug timer and log the duration\r\n * @param {string} scope - The logging scope/category\r\n * @param {string} key - Timer key from debugTimeStart\r\n * @param {Object} [meta] - Optional metadata object\r\n */\r\nexport function debugTimeEnd(scope, key, meta) {\r\n    if (!isDebugLogsEnabled()) return;\r\n    const startedAt = debugTimers.get(key);\r\n    if (startedAt == null) return;\r\n    debugTimers.delete(key);\r\n    const endedAt = (typeof performance !== \"undefined\" && performance.now) ? performance.now() : Date.now();\r\n    logDebug(scope, \"duration\", { durationMs: Math.round(endedAt - startedAt), ...meta });\r\n}\r\n", "/**\r\n * Notification UI Module\r\n * \r\n * Provides toast-style notifications for user feedback.\r\n * \r\n * @module src/ui/notification\r\n */\r\n\r\n/**\r\n * Display a notification toast message\r\n * \r\n * @param {string} message - The message to display\r\n * @param {'info'|'error'|'success'} [type='info'] - The notification type\r\n */\r\nexport function showNotification(message, type = 'info') {\r\n    const notification = document.createElement('div');\r\n    notification.className = `notification notification-${type}`;\r\n    notification.style.cssText = `\r\n        position: fixed;\r\n        bottom: 24px;\r\n        right: 24px;\r\n        padding: 16px 24px;\r\n        background: ${type === 'error' ? 'var(--accent-red)' : type === 'success' ? 'var(--accent-green)' : 'var(--accent-blue)'};\r\n        color: white;\r\n        border-radius: 8px;\r\n        box-shadow: 0 4px 12px rgba(0,0,0,0.15);\r\n        z-index: 10001;\r\n        font-size: 14px;\r\n        font-weight: 500;\r\n        max-width: 400px;\r\n        animation: slideIn 0.3s ease-out;\r\n    `;\r\n    notification.textContent = message;\r\n\r\n    document.body.appendChild(notification);\r\n\r\n    setTimeout(() => {\r\n        notification.style.animation = 'slideOut 0.3s ease-out';\r\n        setTimeout(() => notification.remove(), 300);\r\n    }, 4000);\r\n}\r\n\r\n/**\r\n * Display an error notification\r\n * \r\n * @param {string} message - The error message to display\r\n */\r\nexport function showErrorNotification(message) {\r\n    showNotification(message, 'error');\r\n}\r\n\r\n/**\r\n * Display a success notification\r\n * \r\n * @param {string} message - The success message to display\r\n */\r\nexport function showSuccessNotification(message) {\r\n    showNotification(message, 'success');\r\n}\r\n", "/**\r\n * File utility functions\r\n * Functions for file conversion and API operations\r\n * No dependencies on app state\r\n */\r\n\r\n/**\r\n * Convert a File object to base64 data URL\r\n * @param {File} file - File object to convert\r\n * @returns {Promise<string>} Base64 data URL\r\n *\r\n * @example\r\n * const base64 = await convertFileToBase64(fileInput.files[0]);\r\n * // Returns: 'data:image/png;base64,iVBORw0KGgo...'\r\n */\r\nexport function convertFileToBase64(file) {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.onload = (e) => resolve(e.target.result);\r\n        reader.onerror = (error) => reject(error);\r\n        reader.readAsDataURL(file);\r\n    });\r\n}\r\n\r\n/**\r\n * Upload a file to the server\r\n * @param {string} fileKey - Unique key for the file\r\n * @param {string} base64Data - Base64 encoded file data\r\n * @throws {Error} If upload fails\r\n *\r\n * @example\r\n * await uploadFile('task_123_attachment_1', base64Data);\r\n */\r\nexport async function uploadFile(fileKey, base64Data) {\r\n    const response = await fetch(`/api/files?key=${encodeURIComponent(fileKey)}`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'text/plain' },\r\n        body: base64Data\r\n    });\r\n\r\n    if (!response.ok) {\r\n        // Try to parse JSON error response for better error messages\r\n        let errorMessage = `Failed to upload file: ${response.status} ${response.statusText}`;\r\n        try {\r\n            const errorData = await response.json();\r\n            if (errorData.message) {\r\n                errorMessage = errorData.message;\r\n            }\r\n            if (errorData.troubleshooting) {\r\n                errorMessage += '\\n\\nTroubleshooting: ' + errorData.troubleshooting;\r\n            }\r\n        } catch (e) {\r\n            // If JSON parsing fails, use default error message\r\n        }\r\n        throw new Error(errorMessage);\r\n    }\r\n}\r\n\r\n/**\r\n * Download a file from the server\r\n * @param {string} fileKey - Unique key for the file\r\n * @returns {Promise<string>} File content as text\r\n * @throws {Error} If download fails\r\n *\r\n * @example\r\n * const content = await downloadFile('task_123_attachment_1');\r\n */\r\nexport async function downloadFile(fileKey) {\r\n    const response = await fetch(`/api/files?key=${encodeURIComponent(fileKey)}`);\r\n\r\n    if (!response.ok) {\r\n        throw new Error(`Failed to download file: ${response.status} ${response.statusText}`);\r\n    }\r\n\r\n    return await response.text();\r\n}\r\n\r\n/**\r\n * Delete a file from the server\r\n * @param {string} fileKey - Unique key for the file\r\n * @throws {Error} If deletion fails\r\n *\r\n * @example\r\n * await deleteFile('task_123_attachment_1');\r\n */\r\nexport async function deleteFile(fileKey) {\r\n    const response = await fetch(`/api/files?key=${encodeURIComponent(fileKey)}`, {\r\n        method: 'DELETE'\r\n    });\r\n\r\n    if (!response.ok) {\r\n        throw new Error(`Failed to delete file: ${response.status} ${response.statusText}`);\r\n    }\r\n}\r\n", "/**\r\n * Validation utility functions\r\n * Pure functions for input validation\r\n * No dependencies\r\n */\r\n\r\n/**\r\n * Validate email address format\r\n * @param {string} email - Email address to validate\r\n * @returns {boolean} True if valid email format\r\n *\r\n * @example\r\n * isValidEmailAddress('user@example.com') // Returns: true\r\n * isValidEmailAddress('invalid-email') // Returns: false\r\n * isValidEmailAddress('') // Returns: false\r\n */\r\nexport function isValidEmailAddress(email) {\r\n    return /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(String(email || \"\").trim());\r\n}\r\n", "/**\r\n * Time utility functions\r\n * Pure functions for time manipulation (HH:MM format)\r\n * No dependencies\r\n */\r\n\r\n/**\r\n * Normalize a time string to HH:MM format\r\n * @param {string} value - Time string to normalize\r\n * @returns {string} Normalized time string or empty string if invalid\r\n *\r\n * @example\r\n * normalizeHHMM('9:05') // Returns: '09:05'\r\n * normalizeHHMM('23:59') // Returns: '23:59'\r\n * normalizeHHMM('invalid') // Returns: ''\r\n */\r\nexport function normalizeHHMM(value) {\r\n    if (!value || typeof value !== \"string\") return \"\";\r\n    const match = value.trim().match(/^(\\d{1,2}):(\\d{2})$/);\r\n    if (!match) return \"\";\r\n    const hours = Number(match[1]);\r\n    const minutes = Number(match[2]);\r\n    if (!Number.isInteger(hours) || !Number.isInteger(minutes)) return \"\";\r\n    if (hours < 0 || hours > 23) return \"\";\r\n    if (minutes < 0 || minutes > 59) return \"\";\r\n    return `${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}`;\r\n}\r\n\r\n/**\r\n * Snap a time to the nearest step interval\r\n * @param {string} hhmm - Time string in HH:MM format\r\n * @param {number} stepMinutes - Step interval in minutes\r\n * @returns {string} Snapped time string or empty string if invalid\r\n *\r\n * @example\r\n * snapHHMMToStep('09:07', 15) // Returns: '09:00'\r\n * snapHHMMToStep('09:08', 15) // Returns: '09:15'\r\n */\r\nexport function snapHHMMToStep(hhmm, stepMinutes) {\r\n    const normalized = normalizeHHMM(hhmm);\r\n    if (!normalized) return \"\";\r\n    const [hoursStr, minutesStr] = normalized.split(\":\");\r\n    const total = Number(hoursStr) * 60 + Number(minutesStr);\r\n    const step = Number(stepMinutes) || 1;\r\n    const snapped = Math.round(total / step) * step;\r\n    const wrapped = ((snapped % (24 * 60)) + (24 * 60)) % (24 * 60);\r\n    const outHours = Math.floor(wrapped / 60);\r\n    const outMinutes = wrapped % 60;\r\n    return `${String(outHours).padStart(2, \"0\")}:${String(outMinutes).padStart(2, \"0\")}`;\r\n}\r\n\r\n/**\r\n * Convert HH:MM time string to total minutes\r\n * @param {string} hhmm - Time string in HH:MM format\r\n * @returns {number|null} Total minutes or null if invalid\r\n *\r\n * @example\r\n * hhmmToMinutes('09:30') // Returns: 570\r\n * hhmmToMinutes('00:00') // Returns: 0\r\n * hhmmToMinutes('invalid') // Returns: null\r\n */\r\nexport function hhmmToMinutes(hhmm) {\r\n    const normalized = normalizeHHMM(hhmm);\r\n    if (!normalized) return null;\r\n    const [hoursStr, minutesStr] = normalized.split(\":\");\r\n    return Number(hoursStr) * 60 + Number(minutesStr);\r\n}\r\n\r\n/**\r\n * Convert total minutes to HH:MM time string\r\n * @param {number} totalMinutes - Total minutes (0-1439)\r\n * @returns {string} Time string in HH:MM format\r\n *\r\n * @example\r\n * minutesToHHMM(570) // Returns: '09:30'\r\n * minutesToHHMM(0) // Returns: '00:00'\r\n * minutesToHHMM(1439) // Returns: '23:59'\r\n */\r\nexport function minutesToHHMM(totalMinutes) {\r\n    const clamped = Math.max(0, Math.min(23 * 60 + 59, Number(totalMinutes)));\r\n    const hours = Math.floor(clamped / 60);\r\n    const minutes = clamped % 60;\r\n    return `${String(hours).padStart(2, \"0\")}:${String(minutes).padStart(2, \"0\")}`;\r\n}\r\n\r\n/**\r\n * Clamp a time value to a range\r\n * @param {string} hhmm - Time string to clamp\r\n * @param {string} startHHMM - Range start time\r\n * @param {string} endHHMM - Range end time\r\n * @returns {string} Clamped time string or empty string if invalid\r\n *\r\n * @example\r\n * clampHHMMToRange('08:00', '09:00', '17:00') // Returns: '09:00'\r\n * clampHHMMToRange('12:00', '09:00', '17:00') // Returns: '12:00'\r\n * clampHHMMToRange('18:00', '09:00', '17:00') // Returns: '17:00'\r\n */\r\nexport function clampHHMMToRange(hhmm, startHHMM, endHHMM) {\r\n    const valueMinutes = hhmmToMinutes(hhmm);\r\n    const startMinutes = hhmmToMinutes(startHHMM);\r\n    const endMinutes = hhmmToMinutes(endHHMM);\r\n    if (valueMinutes == null || startMinutes == null || endMinutes == null) return \"\";\r\n    if (valueMinutes < startMinutes) return startHHMM;\r\n    if (valueMinutes > endMinutes) return endHHMM;\r\n    return hhmm;\r\n}\r\n\r\n/**\r\n * Get cutoff timestamp for \"updated within\" filter\r\n * @param {string} value - Filter value ('5m', '30m', '24h', 'week', 'month', 'all')\r\n * @returns {number|null} Cutoff timestamp in milliseconds, or null for 'all'\r\n *\r\n * @example\r\n * getKanbanUpdatedCutoffTime('5m')  // Returns: Date.now() - 5 minutes\r\n * getKanbanUpdatedCutoffTime('all') // Returns: null\r\n */\r\nexport function getKanbanUpdatedCutoffTime(value) {\r\n    const now = Date.now();\r\n    switch (value) {\r\n        case '5m': return now - 5 * 60 * 1000;\r\n        case '30m': return now - 30 * 60 * 1000;\r\n        case '24h': return now - 24 * 60 * 60 * 1000;\r\n        case 'week': return now - 7 * 24 * 60 * 60 * 1000;\r\n        case 'month': return now - 30 * 24 * 60 * 60 * 1000;\r\n        case 'all':\r\n        default:\r\n            return null;\r\n    }\r\n}\r\n\r\n/**\r\n * Get the updated timestamp from a task object\r\n * @param {Object} task - Task object with updatedAt, createdAt, or createdDate\r\n * @returns {number} Timestamp in milliseconds, or 0 if invalid\r\n *\r\n * @example\r\n * getTaskUpdatedTime({ updatedAt: '2024-01-15T10:30:00Z' }) // Returns: timestamp\r\n * getTaskUpdatedTime({}) // Returns: 0\r\n */\r\nexport function getTaskUpdatedTime(task) {\r\n    const raw = (task && (task.updatedAt || task.createdAt || task.createdDate)) || \"\";\r\n    const time = new Date(raw).getTime();\r\n    return Number.isFinite(time) ? time : 0;\r\n}\r\n\r\n/**\r\n * Format a task's updated/created date for display\r\n * @param {Object} task - Task object with updatedAt, createdAt, or createdDate\r\n * @returns {string} Formatted date string or empty string if invalid\r\n *\r\n * @example\r\n * formatTaskUpdatedDateTime({ updatedAt: '2024-01-15T10:30:00Z' })\r\n * // Returns: '2024/01/15, 10:30' (locale-dependent)\r\n */\r\nexport function formatTaskUpdatedDateTime(task) {\r\n    const raw = (task && (task.updatedAt || task.createdAt || task.createdDate)) || \"\";\r\n    const d = new Date(raw);\r\n    const t = d.getTime();\r\n    if (!Number.isFinite(t) || t === 0) return \"\";\r\n    try {\r\n        return d.toLocaleString(undefined, {\r\n            year: \"numeric\",\r\n            month: \"2-digit\",\r\n            day: \"2-digit\",\r\n            hour: \"2-digit\",\r\n            minute: \"2-digit\",\r\n            hour12: false\r\n        });\r\n    } catch (e) {\r\n        return d.toISOString().slice(0, 16).replace(\"T\", \" \");\r\n    }\r\n}\r\n", "/**\r\n * Functional utility functions\r\n * Pure functions for common operations\r\n * No dependencies\r\n */\r\n\r\n/**\r\n * Creates a debounced version of a function that delays execution\r\n * until after `wait` milliseconds have elapsed since the last call.\r\n * @param {Function} fn - Function to debounce\r\n * @param {number} wait - Milliseconds to wait before executing\r\n * @returns {Function} Debounced function\r\n *\r\n * @example\r\n * const debouncedSearch = debounce(search, 300);\r\n * input.addEventListener('input', debouncedSearch);\r\n */\r\nexport function debounce(fn, wait) {\r\n    let t = null;\r\n    return function(...args) {\r\n        if (t) clearTimeout(t);\r\n        t = setTimeout(() => fn.apply(this, args), wait);\r\n    };\r\n}\r\n\r\n/**\r\n * Toggle an item in a Set - adds if `on` is true, removes if false\r\n * @param {Set} setObj - The Set to modify\r\n * @param {*} val - Value to add or remove\r\n * @param {boolean} on - Whether to add (true) or remove (false)\r\n *\r\n * @example\r\n * const selected = new Set();\r\n * toggleSet(selected, 'item1', true);  // adds 'item1'\r\n * toggleSet(selected, 'item1', false); // removes 'item1'\r\n */\r\nexport function toggleSet(setObj, val, on) {\r\n    if (on) setObj.add(val);\r\n    else setObj.delete(val);\r\n}\r\n", "/**\r\n * Filter Predicate Functions\r\n * \r\n * Pure functions for filtering tasks based on various criteria.\r\n * These predicates are used by getFilteredTasks() and can be composed.\r\n * \r\n * @module filterPredicates\r\n */\r\n\r\n/**\r\n * Get today's date as ISO string (YYYY-MM-DD)\r\n * @returns {string} Today's date in ISO format\r\n */\r\nexport function getTodayISO() {\r\n    return new Date().toISOString().split('T')[0];\r\n}\r\n\r\n/**\r\n * Get a date offset from today as ISO string\r\n * @param {number} days - Number of days to offset (positive = future, negative = past)\r\n * @returns {string} Date in ISO format\r\n */\r\nexport function getDateOffsetISO(days) {\r\n    const date = new Date();\r\n    date.setDate(date.getDate() + days);\r\n    return date.toISOString().split('T')[0];\r\n}\r\n\r\n/**\r\n * Check if task matches search query\r\n * @param {Object} task - Task object\r\n * @param {string} search - Search query (lowercase)\r\n * @returns {boolean} True if task matches search\r\n */\r\nexport function matchesSearch(task, search) {\r\n    if (!search) return true;\r\n    return (\r\n        (task.title && task.title.toLowerCase().includes(search)) ||\r\n        (task.description && task.description.toLowerCase().includes(search))\r\n    );\r\n}\r\n\r\n/**\r\n * Check if task matches status filter\r\n * @param {Object} task - Task object\r\n * @param {Set<string>} statuses - Set of selected statuses\r\n * @param {boolean} [excludeMode=false] - If true, statuses are excluded; if false, included only\r\n * @returns {boolean} True if task matches status filter\r\n */\r\nexport function matchesStatus(task, statuses, excludeMode = false) {\r\n    if (statuses.size === 0) return true;\r\n    if (excludeMode) return !statuses.has(task.status);\r\n    return statuses.has(task.status);\r\n}\r\n\r\n/**\r\n * Check if task matches priority filter\r\n * @param {Object} task - Task object\r\n * @param {Set<string>} priorities - Set of selected priorities\r\n * @param {boolean} [excludeMode=false] - If true, priorities are excluded; if false, included only\r\n * @returns {boolean} True if task matches priority filter\r\n */\r\nexport function matchesPriority(task, priorities, excludeMode = false) {\r\n    if (priorities.size === 0) return true;\r\n    if (excludeMode) return !priorities.has(task.priority);\r\n    return priorities.has(task.priority);\r\n}\r\n\r\n/**\r\n * Check if task matches project filter\r\n * @param {Object} task - Task object\r\n * @param {Set<string>} projects - Set of selected project IDs (as strings)\r\n * @param {boolean} [excludeMode=false] - If true, projects are excluded; if false, included only\r\n * @returns {boolean} True if task matches project filter\r\n */\r\nexport function matchesProject(task, projects, excludeMode = false) {\r\n    if (projects.size === 0) return true;\r\n    const matches = (task.projectId && projects.has(task.projectId.toString())) || \r\n                   (!task.projectId && projects.has(\"none\"));\r\n    if (excludeMode) return !matches;\r\n    return matches;\r\n}\r\n\r\n/**\r\n * Check if task matches tag filter\r\n * @param {Object} task - Task object\r\n * @param {Set<string>} tags - Set of selected tags\r\n * @param {boolean} [excludeMode=false] - If true, tags are excluded; if false, included only\r\n * @returns {boolean} True if task matches tag filter\r\n */\r\nexport function matchesTags(task, tags, excludeMode = false) {\r\n    if (tags.size === 0) return true;\r\n    const matches = (task.tags && task.tags.some(tag => tags.has(tag))) || \r\n                   ((!task.tags || task.tags.length === 0) && tags.has(\"none\"));\r\n    if (excludeMode) return !matches;\r\n    return matches;\r\n}\r\n\r\n/**\r\n * Check if task matches a date preset\r\n * @param {Object} task - Task object\r\n * @param {string} preset - Date preset name\r\n * @param {string} today - Today's date in ISO format\r\n * @returns {boolean} True if task matches the preset\r\n */\r\nexport function matchesDatePreset(task, preset, today) {\r\n    const todayDate = new Date(today + 'T00:00:00');\r\n    \r\n    switch (preset) {\r\n        // END DATE FILTERS\r\n        case \"no-date\":\r\n            return !task.endDate || task.endDate === \"\";\r\n\r\n        case \"overdue\":\r\n            return task.endDate && task.endDate < today;\r\n\r\n        case \"end-today\":\r\n            return task.endDate === today;\r\n\r\n        case \"end-tomorrow\": {\r\n            const endTomorrow = new Date(todayDate);\r\n            endTomorrow.setDate(endTomorrow.getDate() + 1);\r\n            return task.endDate === endTomorrow.toISOString().split('T')[0];\r\n        }\r\n\r\n        case \"end-7days\": {\r\n            const endSevenDays = new Date(todayDate);\r\n            endSevenDays.setDate(endSevenDays.getDate() + 7);\r\n            return task.endDate === endSevenDays.toISOString().split('T')[0];\r\n        }\r\n\r\n        case \"end-week\": {\r\n            const endWeekEnd = new Date(todayDate);\r\n            endWeekEnd.setDate(endWeekEnd.getDate() + 7);\r\n            const endWeekEndStr = endWeekEnd.toISOString().split('T')[0];\r\n            return task.endDate && task.endDate >= today && task.endDate <= endWeekEndStr;\r\n        }\r\n\r\n        case \"end-month\": {\r\n            const endMonthEnd = new Date(todayDate);\r\n            endMonthEnd.setDate(endMonthEnd.getDate() + 30);\r\n            const endMonthEndStr = endMonthEnd.toISOString().split('T')[0];\r\n            return task.endDate && task.endDate >= today && task.endDate <= endMonthEndStr;\r\n        }\r\n\r\n        // START DATE FILTERS\r\n        case \"no-start-date\":\r\n            return !task.startDate || task.startDate === \"\";\r\n\r\n        case \"already-started\":\r\n            return task.startDate && task.startDate < today && task.status !== 'done';\r\n\r\n        case \"start-today\":\r\n            return task.startDate === today;\r\n\r\n        case \"start-tomorrow\": {\r\n            const startTomorrow = new Date(todayDate);\r\n            startTomorrow.setDate(startTomorrow.getDate() + 1);\r\n            return task.startDate === startTomorrow.toISOString().split('T')[0];\r\n        }\r\n\r\n        case \"start-7days\": {\r\n            const startSevenDays = new Date(todayDate);\r\n            startSevenDays.setDate(startSevenDays.getDate() + 7);\r\n            return task.startDate === startSevenDays.toISOString().split('T')[0];\r\n        }\r\n\r\n        case \"start-week\": {\r\n            const startWeekEnd = new Date(todayDate);\r\n            startWeekEnd.setDate(startWeekEnd.getDate() + 7);\r\n            const startWeekEndStr = startWeekEnd.toISOString().split('T')[0];\r\n            return task.startDate && task.startDate >= today && task.startDate <= startWeekEndStr;\r\n        }\r\n\r\n        case \"start-month\": {\r\n            const startMonthEnd = new Date(todayDate);\r\n            startMonthEnd.setDate(startMonthEnd.getDate() + 30);\r\n            const startMonthEndStr = startMonthEnd.toISOString().split('T')[0];\r\n            return task.startDate && task.startDate >= today && task.startDate <= startMonthEndStr;\r\n        }\r\n\r\n        default:\r\n            return true;\r\n    }\r\n}\r\n\r\n/**\r\n * Check if task matches any of the selected date presets (OR logic)\r\n * @param {Object} task - Task object\r\n * @param {Set<string>} datePresets - Set of selected date presets\r\n * @param {string} today - Today's date in ISO format\r\n * @returns {boolean} True if task matches any preset\r\n */\r\nexport function matchesAnyDatePreset(task, datePresets, today) {\r\n    if (datePresets.size === 0) return true;\r\n    return Array.from(datePresets).some(preset => matchesDatePreset(task, preset, today));\r\n}\r\n\r\n/**\r\n * Check if task matches date range filter\r\n * @param {Object} task - Task object\r\n * @param {string} dateFrom - Start date in ISO format (or empty)\r\n * @param {string} dateTo - End date in ISO format (or empty)\r\n * @param {string} dateField - Which date field to check ('startDate' or 'endDate')\r\n * @returns {boolean} True if task matches date range\r\n */\r\nexport function matchesDateRange(task, dateFrom, dateTo, dateField = 'endDate') {\r\n    if (!dateFrom && !dateTo) return true;\r\n    \r\n    const taskDateValue = dateField === 'startDate' ? task.startDate : task.endDate;\r\n    \r\n    // Task must have the appropriate date field to be filtered by date\r\n    if (!taskDateValue) return false;\r\n    \r\n    // For same date filtering, only check the specified date field\r\n    if (dateFrom && dateTo) {\r\n        if (dateFrom === dateTo) {\r\n            return taskDateValue === dateTo;\r\n        } else {\r\n            return taskDateValue >= dateFrom && taskDateValue <= dateTo;\r\n        }\r\n    } else if (dateFrom) {\r\n        return taskDateValue >= dateFrom;\r\n    } else if (dateTo) {\r\n        return taskDateValue <= dateTo;\r\n    }\r\n    \r\n    return true;\r\n}\r\n\r\n/**\r\n * Filter tasks based on filter state\r\n * Pure function that takes tasks array and filter state, returns filtered array\r\n * \r\n * @param {Array} tasks - Array of task objects\r\n * @param {Object} filterState - Filter state object\r\n * @param {string} filterState.search - Search query\r\n * @param {Set<string>} filterState.statuses - Selected statuses\r\n * @param {boolean} [filterState.statusExcludeMode] - If true, exclude selected statuses\r\n * @param {Set<string>} filterState.priorities - Selected priorities\r\n * @param {boolean} [filterState.priorityExcludeMode] - If true, exclude selected priorities\r\n * @param {Set<string>} filterState.projects - Selected project IDs\r\n * @param {boolean} [filterState.projectExcludeMode] - If true, exclude selected projects\r\n * @param {Set<string>} filterState.tags - Selected tags\r\n * @param {boolean} [filterState.tagExcludeMode] - If true, exclude selected tags\r\n * @param {Set<string>} filterState.datePresets - Selected date presets\r\n * @param {string} filterState.dateFrom - Date range start\r\n * @param {string} filterState.dateTo - Date range end\r\n * @param {string} [filterState.dateField] - Which date field to use for range filter\r\n * @returns {Array} Filtered tasks array\r\n */\r\nexport function filterTasks(tasks, filterState) {\r\n    const {\r\n        search = \"\",\r\n        statuses = new Set(),\r\n        statusExcludeMode = false,\r\n        priorities = new Set(),\r\n        priorityExcludeMode = false,\r\n        projects = new Set(),\r\n        projectExcludeMode = false,\r\n        tags = new Set(),\r\n        tagExcludeMode = false,\r\n        datePresets = new Set(),\r\n        dateFrom = \"\",\r\n        dateTo = \"\",\r\n        dateField = \"endDate\"\r\n    } = filterState;\r\n    \r\n    const today = getTodayISO();\r\n    const searchLower = search.toLowerCase();\r\n    \r\n    return tasks.filter(task => {\r\n        // Search filter\r\n        if (!matchesSearch(task, searchLower)) return false;\r\n        \r\n        // Status filter (include or exclude)\r\n        if (!matchesStatus(task, statuses, statusExcludeMode)) return false;\r\n        \r\n        // Priority filter (include or exclude)\r\n        if (!matchesPriority(task, priorities, priorityExcludeMode)) return false;\r\n        \r\n        // Project filter (include or exclude)\r\n        if (!matchesProject(task, projects, projectExcludeMode)) return false;\r\n        \r\n        // Tag filter (include or exclude)\r\n        if (!matchesTags(task, tags, tagExcludeMode)) return false;\r\n        \r\n        // Date preset filter (OR logic)\r\n        if (datePresets.size > 0) {\r\n            if (!matchesAnyDatePreset(task, datePresets, today)) return false;\r\n        }\r\n        // Date range filter (only if no presets)\r\n        else if (dateFrom || dateTo) {\r\n            if (!matchesDateRange(task, dateFrom, dateTo, dateField)) return false;\r\n        }\r\n        \r\n        return true;\r\n    });\r\n}\r\n", "/**\r\n * Dashboard View Module\r\n * \r\n * Pure computation functions for dashboard statistics and insights.\r\n * These functions take data as parameters and return computed results,\r\n * making them testable and reusable.\r\n * \r\n * @module views/dashboard\r\n */\r\n\r\n/**\r\n * Calculate dashboard statistics from tasks and projects\r\n * @param {Array} tasks - Array of task objects\r\n * @param {Array} projects - Array of project objects\r\n * @returns {Object} Dashboard statistics\r\n */\r\nexport function calculateDashboardStats(tasks, projects) {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    \r\n    // Exclude backlog from statistics\r\n    const activeTasks = tasks.filter(t => t.status !== 'backlog');\r\n    const totalTasks = activeTasks.length;\r\n    const completedTasks = activeTasks.filter(t => t.status === 'done').length;\r\n    const tasksCompletionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;\r\n    \r\n    // Calculate projects completion rate (projects where all tasks are done, excluding backlog)\r\n    const projectsWithTasks = projects.filter(p => {\r\n        const projectTasks = tasks.filter(t => t.projectId === p.id && t.status !== 'backlog');\r\n        return projectTasks.length > 0;\r\n    });\r\n    \r\n    const completedProjects = projectsWithTasks.filter(p => {\r\n        const projectTasks = tasks.filter(t => t.projectId === p.id && t.status !== 'backlog');\r\n        const completedProjectTasks = projectTasks.filter(t => t.status === 'done');\r\n        return projectTasks.length > 0 && completedProjectTasks.length === projectTasks.length;\r\n    }).length;\r\n    \r\n    const projectsCompletionRate = projectsWithTasks.length > 0 \r\n        ? Math.round((completedProjects / projectsWithTasks.length) * 100) \r\n        : 0;\r\n    \r\n    const totalProjectsWithTasks = projectsWithTasks.length;\r\n    \r\n    const inProgressTasks = activeTasks.filter(t => t.status === 'progress').length;\r\n    const pendingTasks = activeTasks.filter(t => t.status === 'todo').length;\r\n    const reviewTasks = activeTasks.filter(t => t.status === 'review').length;\r\n    const overdueTasks = activeTasks.filter(t => t.endDate && t.endDate < today && t.status !== 'done').length;\r\n    const highPriorityTasks = activeTasks.filter(t => t.priority === 'high' && t.status !== 'done').length;\r\n    const milestones = projects.filter(p => p.endDate).length;\r\n    \r\n    return {\r\n        activeProjects: projects.length,\r\n        totalTasks,\r\n        completedTasks,\r\n        completionRate: tasksCompletionRate, // Keep for backward compatibility\r\n        tasksCompletionRate,\r\n        projectsCompletionRate,\r\n        completedProjects,\r\n        totalProjectsWithTasks,\r\n        inProgressTasks,\r\n        pendingTasks,\r\n        reviewTasks,\r\n        overdueTasks,\r\n        highPriorityTasks,\r\n        milestones\r\n    };\r\n}\r\n\r\n/**\r\n * Calculate trend indicators for dashboard\r\n * @param {Array} tasks - Array of task objects\r\n * @param {Array} projects - Array of project objects\r\n * @returns {Object} Trend indicator data\r\n */\r\nexport function calculateTrendIndicators(tasks, projects) {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const todayDate = new Date();\r\n\r\n    // Exclude backlog from all trend calculations (match calculateDashboardStats)\r\n    const activeTasks = tasks.filter(t => t.status !== 'backlog');\r\n\r\n    // Tasks completed this week\r\n    const weekAgo = new Date();\r\n    weekAgo.setDate(weekAgo.getDate() - 7);\r\n    const thisWeekCompleted = activeTasks.filter(t => {\r\n        if (t.status !== 'done' || !t.completedDate) return false;\r\n        return new Date(t.completedDate) > weekAgo;\r\n    }).length;\r\n\r\n    // Tasks due today\r\n    const dueTodayCount = activeTasks.filter(t => {\r\n        if (!t.endDate || t.status === 'done') return false;\r\n        return new Date(t.endDate).toDateString() === todayDate.toDateString();\r\n    }).length;\r\n\r\n    // Overdue count\r\n    const overdueCount = activeTasks.filter(t =>\r\n        t.status !== 'done' &&\r\n        t.endDate &&\r\n        t.endDate < today\r\n    ).length;\r\n\r\n    // Critical high-priority tasks (due within 7 days)\r\n    const criticalHighPriority = activeTasks.filter(t => {\r\n        if (t.status === 'done') return false;\r\n        if (t.priority !== 'high') return false;\r\n        if (!t.endDate) return false;\r\n        const todayMidnight = new Date(todayDate.getFullYear(), todayDate.getMonth(), todayDate.getDate());\r\n        const end = new Date(t.endDate);\r\n        const endMidnight = new Date(end.getFullYear(), end.getMonth(), end.getDate());\r\n        const diffDays = Math.round((endMidnight - todayMidnight) / (1000 * 60 * 60 * 24));\r\n        return diffDays <= 7;\r\n    }).length;\r\n\r\n    // Completed projects\r\n    const completedProjects = projects.filter(p => {\r\n        const projectTasks = tasks.filter(t => t.projectId === p.id);\r\n        const completedProjectTasks = projectTasks.filter(t => t.status === 'done');\r\n        return projectTasks.length > 0 && completedProjectTasks.length === projectTasks.length;\r\n    }).length;\r\n\r\n    return {\r\n        thisWeekCompleted,\r\n        dueTodayCount,\r\n        overdueCount,\r\n        criticalHighPriority,\r\n        completedProjects,\r\n        progressChange: Math.max(1, Math.floor(activeTasks.length * 0.1))\r\n    };\r\n}\r\n\r\n/**\r\n * Calculate project progress data for progress bars\r\n * @param {Array} projects - Array of project objects\r\n * @param {Array} tasks - Array of task objects\r\n * @param {number} [limit=5] - Maximum number of projects to return\r\n * @returns {Array} Array of project progress objects\r\n */\r\nexport function calculateProjectProgress(projects, tasks, limit = 5) {\r\n    return projects.slice(0, limit).map(project => {\r\n        const projectId = Number(project?.id);\r\n        // Exclude backlog from project progress\r\n        const projectTasks = tasks.filter(t => Number(t?.projectId) === projectId && t.status !== 'backlog');\r\n        const completed = projectTasks.filter(t => t.status === 'done').length;\r\n        const inProgress = projectTasks.filter(t => t.status === 'progress').length;\r\n        const review = projectTasks.filter(t => t.status === 'review').length;\r\n        const todo = projectTasks.filter(t => t.status === 'todo').length;\r\n        const total = projectTasks.length;\r\n        \r\n        return {\r\n            id: project.id,\r\n            name: project.name,\r\n            completed,\r\n            inProgress,\r\n            review,\r\n            todo,\r\n            total,\r\n            completedPercent: total > 0 ? (completed / total) * 100 : 0,\r\n            inProgressPercent: total > 0 ? (inProgress / total) * 100 : 0,\r\n            reviewPercent: total > 0 ? (review / total) * 100 : 0,\r\n            todoPercent: total > 0 ? (todo / total) * 100 : 0\r\n        };\r\n    });\r\n}\r\n\r\n/**\r\n * Generate activity feed data\r\n * @param {Array} tasks - Array of task objects\r\n * @param {Array} projects - Array of project objects\r\n * @param {number} [completedLimit=3] - Max completed tasks to show\r\n * @param {number} [projectLimit=2] - Max projects to show\r\n * @param {number} [taskLimit=2] - Max new tasks to show\r\n * @returns {Array} Array of activity objects sorted by date\r\n */\r\nexport function generateActivityFeed(tasks, projects, completedLimit = 3, projectLimit = 2, taskLimit = 2) {\r\n    const activities = [];\r\n    \r\n    // Recent completed tasks\r\n    const recentCompleted = tasks\r\n        .filter(t => t.status === 'done')\r\n        .sort((a, b) => new Date(b.completedDate || b.createdAt || b.createdDate) - new Date(a.completedDate || a.createdAt || a.createdDate))\r\n        .slice(0, completedLimit);\r\n    \r\n    recentCompleted.forEach(task => {\r\n        const project = projects.find(p => p.id === task.projectId);\r\n        const activityDate = task.completedDate || task.createdAt || task.createdDate;\r\n        activities.push({\r\n            type: 'completed',\r\n            taskTitle: task.title,\r\n            projectName: project ? project.name : null,\r\n            date: activityDate,\r\n            icon: '\\u{2705}'\r\n        });\r\n    });\r\n    \r\n    // Recent new projects\r\n    const recentProjects = projects\r\n        .sort((a, b) => new Date(b.createdAt || b.createdDate) - new Date(a.createdAt || a.createdDate))\r\n        .slice(0, projectLimit);\r\n    \r\n    recentProjects.forEach(project => {\r\n        activities.push({\r\n            type: 'created',\r\n            projectName: project.name,\r\n            date: project.createdAt || project.createdDate,\r\n            icon: '\uD83D\uDE80'\r\n        });\r\n    });\r\n    \r\n    // Recent new tasks\r\n    const recentTasks = tasks\r\n        .filter(t => t.status !== 'done')\r\n        .sort((a, b) => new Date(b.createdAt || b.createdDate) - new Date(a.createdAt || a.createdDate))\r\n        .slice(0, taskLimit);\r\n    \r\n    recentTasks.forEach(task => {\r\n        const project = projects.find(p => p.id === task.projectId);\r\n        activities.push({\r\n            type: 'created',\r\n            taskTitle: task.title,\r\n            projectName: project ? project.name : null,\r\n            date: task.createdAt || task.createdDate,\r\n            icon: '\uD83D\uDCDD'\r\n        });\r\n    });\r\n    \r\n    // Sort by most recent first\r\n    activities.sort((a, b) => new Date(b.date) - new Date(a.date));\r\n    \r\n    return activities;\r\n}\r\n\r\n/**\r\n * Generate all activity data (for \"View All\" page)\r\n * @param {Array} tasks - Array of task objects\r\n * @param {Array} projects - Array of project objects\r\n * @returns {Array} Array of all activity objects sorted by date\r\n */\r\nexport function generateAllActivity(tasks, projects) {\r\n    const activities = [];\r\n    \r\n    // All completed tasks\r\n    tasks\r\n        .filter(t => t.status === 'done')\r\n        .forEach(task => {\r\n            const project = projects.find(p => p.id === task.projectId);\r\n            activities.push({\r\n                type: 'completed',\r\n                taskTitle: task.title,\r\n                projectName: project ? project.name : null,\r\n                date: task.completedDate || task.createdAt || task.createdDate,\r\n                icon: '\\u{2705}'\r\n            });\r\n        });\r\n    \r\n    // All projects\r\n    projects.forEach(project => {\r\n        activities.push({\r\n            type: 'created',\r\n            projectName: project.name,\r\n            date: project.createdAt || project.createdDate,\r\n            icon: '\uD83D\uDE80'\r\n        });\r\n    });\r\n    \r\n    // All tasks\r\n    tasks.forEach(task => {\r\n        const project = projects.find(p => p.id === task.projectId);\r\n        activities.push({\r\n            type: 'created',\r\n            taskTitle: task.title,\r\n            projectName: project ? project.name : null,\r\n            date: task.createdAt || task.createdDate,\r\n            icon: '\uD83D\uDCDD'\r\n        });\r\n    });\r\n    \r\n    // Sort by most recent\r\n    activities.sort((a, b) => new Date(b.date) - new Date(a.date));\r\n    \r\n    return activities;\r\n}\r\n\r\n/**\r\n * Generate insights based on task and project data\r\n * @param {Array} tasks - Array of task objects\r\n * @param {Array} projects - Array of project objects\r\n * @returns {Array} Array of insight objects\r\n */\r\nexport function generateInsightsData(tasks, projects) {\r\n    const insights = [];\r\n    \r\n    const totalTasks = tasks.length;\r\n    const completedTasks = tasks.filter(t => t.status === 'done').length;\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const overdueTasks = tasks.filter(t => t.endDate && t.endDate < today && t.status !== 'done').length;\r\n    const highPriorityTasks = tasks.filter(t => t.priority === 'high').length;\r\n    const todayTasks = tasks.filter(t => {\r\n        if (!t.endDate) return false;\r\n        const todayStr = new Date().toDateString();\r\n        return new Date(t.endDate).toDateString() === todayStr && t.status !== 'done';\r\n    }).length;\r\n    \r\n    // Completion rate insight\r\n    if (totalTasks > 0) {\r\n        const completionRate = (completedTasks / totalTasks) * 100;\r\n        if (completionRate >= 80) {\r\n            insights.push({\r\n                type: 'success',\r\n                icon: '\uD83C\uDFAF',\r\n                insightKey: 'excellent',\r\n                percent: completionRate.toFixed(0)\r\n            });\r\n        } else if (completionRate >= 60) {\r\n            insights.push({\r\n                type: 'success',\r\n                icon: '\uD83D\uDCC8',\r\n                insightKey: 'good',\r\n                percent: completionRate.toFixed(0)\r\n            });\r\n        } else if (completionRate >= 30) {\r\n            insights.push({\r\n                type: 'warning',\r\n                icon: '\u26A1',\r\n                insightKey: 'opportunity',\r\n                percent: completionRate.toFixed(0)\r\n            });\r\n        } else {\r\n            insights.push({\r\n                type: 'priority',\r\n                icon: '\uD83D\uDEA8',\r\n                insightKey: 'action',\r\n                percent: completionRate.toFixed(0)\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Due today tasks\r\n    if (todayTasks > 0) {\r\n        insights.push({\r\n            type: 'priority',\r\n            icon: '\uD83D\uDCC5',\r\n            insightKey: 'today',\r\n            count: todayTasks\r\n        });\r\n    }\r\n    \r\n    // Overdue tasks\r\n    if (overdueTasks > 0 && todayTasks === 0) {\r\n        insights.push({\r\n            type: 'warning',\r\n            icon: '\u23F0',\r\n            insightKey: 'overdue',\r\n            count: overdueTasks\r\n        });\r\n    }\r\n    \r\n    // High priority tasks\r\n    if (highPriorityTasks > 0) {\r\n        const urgentCount = tasks.filter(t => t.priority === 'high' && t.status !== 'done').length;\r\n        if (urgentCount > 0) {\r\n            insights.push({\r\n                type: 'priority',\r\n                icon: '\uD83D\uDD25',\r\n                insightKey: 'highPriority',\r\n                count: urgentCount\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Project insights\r\n    if (projects.length > 1) {\r\n        const projectsWithTasks = projects.filter(p => tasks.some(t => t.projectId === p.id)).length;\r\n        const projectsWithoutTasks = projects.length - projectsWithTasks;\r\n        \r\n        if (projectsWithoutTasks > 0) {\r\n            insights.push({\r\n                type: 'warning',\r\n                icon: '\uD83D\uDCC1',\r\n                insightKey: 'emptyProjects',\r\n                count: projectsWithoutTasks\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Productivity pattern insights\r\n    if (totalTasks >= 5) {\r\n        const weekAgo = new Date();\r\n        weekAgo.setDate(weekAgo.getDate() - 7);\r\n        const recentlyCompleted = tasks.filter(t => {\r\n            if (t.status !== 'done' || !t.completedDate) return false;\r\n            return new Date(t.completedDate) > weekAgo;\r\n        }).length;\r\n        \r\n        if (recentlyCompleted >= 3) {\r\n            insights.push({\r\n                type: 'success',\r\n                icon: '\uD83D\uDE80',\r\n                insightKey: 'momentum',\r\n                count: recentlyCompleted\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Default insights for empty state\r\n    if (insights.length === 0) {\r\n        if (totalTasks === 0) {\r\n            insights.push({\r\n                type: 'priority',\r\n                icon: '\uD83C\uDF0A',\r\n                insightKey: 'ready'\r\n            });\r\n        } else {\r\n            insights.push({\r\n                type: 'success',\r\n                icon: '\u2728',\r\n                insightKey: 'balanced'\r\n            });\r\n        }\r\n    }\r\n    \r\n    return insights;\r\n}\r\n\r\n/**\r\n * Format relative time for activity feed\r\n * @param {string|Date} dateInput - Date to format\r\n * @returns {Object} Object with relative time info\r\n */\r\nexport function getRelativeTimeInfo(dateInput) {\r\n    const date = new Date(dateInput);\r\n    const now = new Date();\r\n    const diffMs = now - date;\r\n    const diffMins = Math.floor(diffMs / 60000);\r\n    const diffHours = Math.floor(diffMs / 3600000);\r\n    const diffDays = Math.floor(diffMs / 86400000);\r\n\r\n    if (diffMins < 1) {\r\n        return { key: 'justNow', value: null };\r\n    } else if (diffMins < 60) {\r\n        return { key: 'minutesAgo', value: diffMins };\r\n    } else if (diffHours < 24) {\r\n        return { key: 'hoursAgo', value: diffHours };\r\n    } else if (diffDays < 7) {\r\n        return { key: 'daysAgo', value: diffDays };\r\n    } else {\r\n        return { key: 'date', value: date };\r\n    }\r\n}\r\n\r\n/**\r\n * Generate HTML for project progress bars\r\n * @param {Array} progressData - Array of project progress data from calculateProjectProgress\r\n * @param {Object} helpers - Helper translations\r\n * @param {string} helpers.tasksLabel - Label for \"tasks\"\r\n * @returns {string} HTML string for progress bars\r\n */\r\nexport function generateProgressBarsHTML(progressData, helpers) {\r\n    const { tasksLabel } = helpers;\r\n\r\n    return progressData.map(p => `\r\n        <div class=\"progress-bar-item clickable-project\" data-action=\"showProjectDetails\" data-param=\"${p.id}\" style=\"cursor: pointer; transition: all 0.2s ease;\">\r\n            <div class=\"project-progress-header\">\r\n                <span class=\"project-name\">${p.name}</span>\r\n                <span class=\"task-count\">${p.completed}/${p.total} ${tasksLabel}</span>\r\n            </div>\r\n            <div style=\"height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; display: flex;\">\r\n                <div style=\"background: var(--accent-green); width: ${p.completedPercent}%; transition: width 0.5s ease;\"></div>\r\n                <div style=\"background: var(--accent-blue); width: ${p.inProgressPercent}%; transition: width 0.5s ease;\"></div>\r\n                <div style=\"background: var(--accent-amber); width: ${p.reviewPercent}%; transition: width 0.5s ease;\"></div>\r\n                <div style=\"background: var(--text-muted); width: ${p.todoPercent}%; transition: width 0.5s ease;\"></div>\r\n            </div>\r\n        </div>\r\n    `).join('');\r\n}\r\n\r\n/**\r\n * Generate HTML for activity feed items\r\n * @param {Array} activities - Array of activity objects\r\n * @param {Function} formatDate - Function to format activity date\r\n * @returns {string} HTML string for activity feed\r\n */\r\nexport function generateActivityFeedHTML(activities, formatDate) {\r\n    return activities.map(activity => `\r\n        <div class=\"activity-item\">\r\n            <div class=\"activity-icon ${activity.type}\">${activity.icon}</div>\r\n            <div class=\"activity-content\">\r\n                <div class=\"activity-text\">${activity.text}</div>\r\n            </div>\r\n            <div class=\"activity-date\">${formatDate(activity.date)}</div>\r\n        </div>\r\n    `).join('');\r\n}\r\n", "/**\r\n * Task Card Component Module\r\n *\r\n * Pure computation functions for kanban task card rendering.\r\n *\r\n * @module components/taskCard\r\n */\r\n\r\n/**\r\n * Calculate date urgency info for a task\r\n * @param {string|null} endDate - Task end date in ISO format\r\n * @param {string} status - Task status\r\n * @returns {Object} Urgency info with colors and styling\r\n */\r\nexport function calculateDateUrgency(endDate, status) {\r\n    if (!endDate) {\r\n        return {\r\n            hasDate: false,\r\n            urgency: 'none',\r\n            bgColor: null,\r\n            textColor: 'var(--text-muted)',\r\n            borderColor: null,\r\n            icon: '',\r\n            iconColor: ''\r\n        };\r\n    }\r\n\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n    const dueDate = new Date(endDate);\r\n    dueDate.setHours(0, 0, 0, 0);\r\n    const diffTime = dueDate - today;\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n    // Completed tasks: no urgency styling\r\n    if (status === 'done') {\r\n        return {\r\n            hasDate: true,\r\n            urgency: 'completed',\r\n            diffDays,\r\n            bgColor: 'rgba(148, 163, 184, 0.12)',\r\n            textColor: '#94a3b8',\r\n            borderColor: 'rgba(148, 163, 184, 0.25)',\r\n            icon: '',\r\n            iconColor: ''\r\n        };\r\n    }\r\n\r\n    // Overdue - orange/yellow warning\r\n    if (diffDays < 0) {\r\n        return {\r\n            hasDate: true,\r\n            urgency: 'overdue',\r\n            diffDays,\r\n            bgColor: 'rgba(249, 115, 22, 0.2)',\r\n            textColor: '#fb923c',\r\n            borderColor: 'rgba(249, 115, 22, 0.4)',\r\n            icon: '\u26A0 ',\r\n            iconColor: '#f97316'\r\n        };\r\n    }\r\n\r\n    // Within 1 week - purple/violet\r\n    if (diffDays <= 7) {\r\n        return {\r\n            hasDate: true,\r\n            urgency: 'soon',\r\n            diffDays,\r\n            bgColor: 'rgba(192, 132, 252, 0.25)',\r\n            textColor: '#c084fc',\r\n            borderColor: 'rgba(192, 132, 252, 0.5)',\r\n            icon: '',\r\n            iconColor: ''\r\n        };\r\n    }\r\n\r\n    // Normal - blue glassmorphic\r\n    return {\r\n        hasDate: true,\r\n        urgency: 'normal',\r\n        diffDays,\r\n        bgColor: 'rgba(59, 130, 246, 0.15)',\r\n        textColor: '#93c5fd',\r\n        borderColor: 'rgba(59, 130, 246, 0.3)',\r\n        icon: '',\r\n        iconColor: ''\r\n    };\r\n}\r\n\r\n/**\r\n * Generate HTML for a single kanban task card\r\n * @param {Object} task - Task object\r\n * @param {Object} helpers - Helper functions and data\r\n * @param {Function} helpers.escapeHtml - HTML escape function\r\n * @param {Function} helpers.formatDate - Date format function\r\n * @param {Function} helpers.getProjectColor - Get project color function\r\n * @param {Function} helpers.getTagColor - Get tag color function\r\n * @param {Function} helpers.getPriorityLabel - Get priority label function\r\n * @param {Array} helpers.projects - Array of projects\r\n * @param {Set} helpers.selectedCards - Set of selected card IDs\r\n * @param {boolean} helpers.showProjects - Show projects on cards\r\n * @param {boolean} helpers.showNoDate - Show \"No date\" text\r\n * @param {string} helpers.noProjectText - Text for \"No project\"\r\n * @param {string} helpers.noDateText - Text for \"No date\"\r\n * @returns {string} HTML string for task card\r\n */\r\nexport function generateTaskCardHTML(task, helpers) {\r\n    const {\r\n        escapeHtml,\r\n        formatDate,\r\n        getProjectColor,\r\n        getTagColor,\r\n        getPriorityLabel,\r\n        projects,\r\n        selectedCards,\r\n        showProjects = true,\r\n        showNoDate = true,\r\n        noProjectText,\r\n        noDateText\r\n    } = helpers;\r\n\r\n    const proj = projects.find(p => p.id === task.projectId);\r\n    const projName = proj ? proj.name : noProjectText;\r\n    const dueText = task.endDate ? formatDate(task.endDate) : noDateText;\r\n\r\n    // Calculate date urgency\r\n    const urgency = calculateDateUrgency(task.endDate, task.status);\r\n    let dueHTML;\r\n    if (urgency.hasDate) {\r\n        const { bgColor, textColor, borderColor, icon, iconColor } = urgency;\r\n        dueHTML = `<span style=\"\r\n            background: ${bgColor};\r\n            backdrop-filter: blur(8px);\r\n            -webkit-backdrop-filter: blur(8px);\r\n            color: ${textColor};\r\n            border: 1px solid ${borderColor};\r\n            padding: 4px 10px;\r\n            border-radius: 12px;\r\n            font-size: 12px;\r\n            font-weight: 500;\r\n            display: inline-flex;\r\n            align-items: center;\r\n            gap: 4px;\r\n            text-decoration: none;\r\n            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\r\n        \">${icon ? `<span style=\"color: ${iconColor};\">${icon}</span>` : ''}${escapeHtml(dueText)}</span>`;\r\n    } else {\r\n        dueHTML = showNoDate\r\n            ? `<span style=\"color: var(--text-muted); font-size: 12px;\">${dueText}</span>`\r\n            : '';\r\n    }\r\n\r\n    const isSelected = selectedCards && selectedCards.has(task.id);\r\n    const selectedClass = isSelected ? ' selected' : '';\r\n    const doneClass = task.status === 'done' ? ' is-done' : '';\r\n\r\n    const projectIndicator = proj\r\n        ? `<span style=\"display: inline-block; width: 10px; height: 10px; background-color: ${getProjectColor(proj.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;\"></span>`\r\n        : '';\r\n\r\n    const tagsAndDateHTML = `<div style=\"display: flex; flex-wrap: wrap; align-items: center; gap: 4px; margin-top: 12px;\">\r\n        ${task.tags && task.tags.length > 0 ? task.tags.map(tag => `<span style=\"background-color: ${getTagColor(tag)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;\">${escapeHtml(tag.toUpperCase())}</span>`).join('') : ''}\r\n        <span style=\"margin-left: auto;\">${dueHTML}</span>\r\n    </div>`;\r\n\r\n    return `\r\n        <div class=\"task-card${selectedClass}${doneClass}\" draggable=\"true\" data-task-id=\"${task.id}\">\r\n            <div style=\"display: flex; justify-content: space-between; align-items: flex-start; gap: 8px;\">\r\n                <div class=\"task-title\" style=\"flex: 1;\">${projectIndicator}${escapeHtml(task.title || \"\")}</div>\r\n                <div class=\"task-priority priority-${task.priority}\" style=\"flex-shrink: 0;\">${getPriorityLabel(task.priority || \"\").toUpperCase()}</div>\r\n            </div>\r\n            ${showProjects ? `\r\n            <div style=\"margin-top:8px; font-size:12px;\">\r\n                ${proj ?\r\n                    `<span style=\"background-color: ${getProjectColor(proj.id)}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500; display: inline-block; max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\" title=\"${escapeHtml(proj.name)}\">${escapeHtml(proj.name)}</span>` :\r\n                    `<span style=\"color: var(--text-muted);\">${noProjectText}</span>`\r\n                }\r\n            </div>\r\n            ` : ''}\r\n            ${tagsAndDateHTML}\r\n        </div>\r\n    `;\r\n}\r\n", "/**\r\n * Kanban View Module\r\n * \r\n * Pure computation functions for kanban board logic.\r\n * These functions handle task grouping, sorting, and date urgency calculations.\r\n * \r\n * @module views/kanban\r\n */\r\n\r\nimport { PRIORITY_ORDER } from '../config/constants.js';\r\nimport { generateTaskCardHTML } from '../components/taskCard.js';\r\n\r\n/**\r\n * Group tasks by status\r\n * @param {Array} tasks - Array of task objects\r\n * @param {boolean} [showBacklog=false] - Whether to include backlog tasks\r\n * @returns {Object} Tasks grouped by status\r\n */\r\nexport function groupTasksByStatus(tasks, showBacklog = false) {\r\n    const byStatus = { backlog: [], todo: [], progress: [], review: [], done: [] };\r\n    \r\n    tasks.forEach(task => {\r\n        // Exclude BACKLOG status unless showBacklog is enabled\r\n        if (task.status === 'backlog' && !showBacklog) return;\r\n        if (byStatus[task.status]) {\r\n            byStatus[task.status].push(task);\r\n        }\r\n    });\r\n    \r\n    return byStatus;\r\n}\r\n\r\n/**\r\n * Sort tasks by priority (high to low)\r\n * @param {Array} tasks - Array of task objects\r\n * @returns {Array} Sorted tasks array\r\n */\r\nexport function sortTasksByPriority(tasks) {\r\n    return [...tasks].sort((a, b) => {\r\n        const priorityA = PRIORITY_ORDER[a.priority] || 0;\r\n        const priorityB = PRIORITY_ORDER[b.priority] || 0;\r\n        return priorityB - priorityA;\r\n    });\r\n}\r\n\r\n/**\r\n * Sort tasks by manual order with priority fallback\r\n * @param {Array} tasks - Array of task objects\r\n * @param {Array} manualOrder - Array of task IDs in desired order\r\n * @returns {Array} Sorted tasks array\r\n */\r\nexport function sortTasksByManualOrder(tasks, manualOrder) {\r\n    if (!manualOrder || manualOrder.length === 0) {\r\n        return sortTasksByPriority(tasks);\r\n    }\r\n    \r\n    const orderMap = new Map(manualOrder.map((id, idx) => [id, idx]));\r\n    \r\n    return [...tasks].sort((a, b) => {\r\n        const oa = orderMap.has(a.id) ? orderMap.get(a.id) : 9999;\r\n        const ob = orderMap.has(b.id) ? orderMap.get(b.id) : 9999;\r\n        if (oa !== ob) return oa - ob;\r\n        // Fallback to priority\r\n        const pa = PRIORITY_ORDER[a.priority] || 0;\r\n        const pb = PRIORITY_ORDER[b.priority] || 0;\r\n        return pb - pa;\r\n    });\r\n}\r\n\r\n/**\r\n * Sort grouped tasks by status\r\n * @param {Object} byStatus - Tasks grouped by status\r\n * @param {string} sortMode - 'manual' or 'priority'\r\n * @param {Object} [manualTaskOrder] - Manual order map by status\r\n * @returns {Object} Sorted tasks grouped by status\r\n */\r\nexport function sortGroupedTasks(byStatus, sortMode, manualTaskOrder = null) {\r\n    const sorted = {};\r\n    \r\n    Object.keys(byStatus).forEach(status => {\r\n        if (sortMode === 'manual' && manualTaskOrder && manualTaskOrder[status]) {\r\n            sorted[status] = sortTasksByManualOrder(byStatus[status], manualTaskOrder[status]);\r\n        } else {\r\n            sorted[status] = sortTasksByPriority(byStatus[status]);\r\n        }\r\n    });\r\n    \r\n    return sorted;\r\n}\r\n\r\n/**\r\n * Calculate date urgency info for a task\r\n * @param {string|null} endDate - Task end date in ISO format\r\n * @param {string} status - Task status\r\n * @returns {Object} Urgency info with colors and styling\r\n */\r\n/**\r\n * Get status counts from grouped tasks\r\n * @param {Object} byStatus - Tasks grouped by status\r\n * @returns {Object} Count for each status\r\n */\r\nexport function getStatusCounts(byStatus) {\r\n    return {\r\n        backlog: byStatus.backlog ? byStatus.backlog.length : 0,\r\n        todo: byStatus.todo ? byStatus.todo.length : 0,\r\n        progress: byStatus.progress ? byStatus.progress.length : 0,\r\n        review: byStatus.review ? byStatus.review.length : 0,\r\n        done: byStatus.done ? byStatus.done.length : 0\r\n    };\r\n}\r\n\r\n/**\r\n * Filter tasks by updated time cutoff\r\n * @param {Array} tasks - Array of task objects\r\n * @param {number|null} cutoffTime - Cutoff timestamp (null = no filter)\r\n * @param {Function} getTaskUpdatedTime - Function to get task updated time\r\n * @returns {Array} Filtered tasks\r\n */\r\nexport function filterTasksByUpdatedTime(tasks, cutoffTime, getTaskUpdatedTime) {\r\n    if (cutoffTime === null) {\r\n        return tasks;\r\n    }\r\n    return tasks.filter(task => getTaskUpdatedTime(task) >= cutoffTime);\r\n}\r\n\r\n/**\r\n * Prepare kanban data for rendering\r\n * @param {Array} tasks - All tasks\r\n * @param {Object} options - Kanban options\r\n * @param {boolean} options.showBacklog - Show backlog column\r\n * @param {string} options.sortMode - 'manual' or 'priority'\r\n * @param {Object} options.manualTaskOrder - Manual order by status\r\n * @param {number|null} options.updatedCutoff - Updated time cutoff\r\n * @param {Function} options.getTaskUpdatedTime - Function to get task updated time\r\n * @returns {Object} Prepared kanban data\r\n */\r\nexport function prepareKanbanData(tasks, options = {}) {\r\n    const {\r\n        showBacklog = false,\r\n        sortMode = 'priority',\r\n        manualTaskOrder = null,\r\n        updatedCutoff = null,\r\n        getTaskUpdatedTime = null\r\n    } = options;\r\n    \r\n    // Filter by updated time if cutoff provided\r\n    let filteredTasks = tasks;\r\n    if (updatedCutoff !== null && getTaskUpdatedTime) {\r\n        filteredTasks = filterTasksByUpdatedTime(tasks, updatedCutoff, getTaskUpdatedTime);\r\n    }\r\n    \r\n    // Group by status\r\n    const byStatus = groupTasksByStatus(filteredTasks, showBacklog);\r\n    \r\n    // Sort each group\r\n    const sorted = sortGroupedTasks(byStatus, sortMode, manualTaskOrder);\r\n    \r\n    // Get counts\r\n    const counts = getStatusCounts(sorted);\r\n    \r\n    return {\r\n        byStatus: sorted,\r\n        counts,\r\n        totalFiltered: filteredTasks.length,\r\n        totalOriginal: tasks.length\r\n    };\r\n}\r\n\r\n/**\r\n * Generate HTML for a single kanban task card\r\n * @param {Object} task - Task object\r\n * @param {Object} helpers - Helper functions and data\r\n * @param {Function} helpers.escapeHtml - HTML escape function\r\n * @param {Function} helpers.formatDate - Date format function\r\n * @param {Function} helpers.getProjectColor - Get project color function\r\n * @param {Function} helpers.getTagColor - Get tag color function\r\n * @param {Function} helpers.getPriorityLabel - Get priority label function\r\n * @param {Array} helpers.projects - Array of projects\r\n * @param {Set} helpers.selectedCards - Set of selected card IDs\r\n * @param {boolean} helpers.showProjects - Show projects on cards\r\n * @param {boolean} helpers.showNoDate - Show \"No date\" text\r\n * @param {string} helpers.noProjectText - Text for \"No project\"\r\n * @param {string} helpers.noDateText - Text for \"No date\"\r\n * @returns {string} HTML string for task card\r\n */\r\n/**\r\n * Generate HTML for all task cards in a status column\r\n * @param {Array} tasks - Array of tasks for this status\r\n * @param {Object} helpers - Helper functions (same as generateTaskCardHTML)\r\n * @returns {string} HTML string for all task cards\r\n */\r\nexport function generateKanbanColumnHTML(tasks, helpers) {\r\n    return tasks.map(task => generateTaskCardHTML(task, helpers)).join('');\r\n}\r\n", "/**\r\n * List View Module\r\n * \r\n * Pure computation functions for list view logic.\r\n * These functions handle task sorting and date formatting for list display.\r\n * \r\n * @module views/listView\r\n */\r\n\r\nimport { PRIORITY_ORDER, STATUS_ORDER } from '../config/constants.js';\r\n\r\n/**\r\n * Sort tasks by priority (high to low) then by end date (closest first, no date last)\r\n * @param {Array} tasks - Array of task objects\r\n * @returns {Array} Sorted tasks array\r\n */\r\nexport function sortTasksByPriorityAndDate(tasks) {\r\n    return [...tasks].sort((a, b) => {\r\n        const priorityA = PRIORITY_ORDER[a.priority] || 0;\r\n        const priorityB = PRIORITY_ORDER[b.priority] || 0;\r\n\r\n        // Primary sort: priority (high to low)\r\n        if (priorityA !== priorityB) {\r\n            return priorityB - priorityA;\r\n        }\r\n\r\n        // Secondary sort: end date (closest first, no date last)\r\n        const dateA = a.endDate ? new Date(a.endDate) : null;\r\n        const dateB = b.endDate ? new Date(b.endDate) : null;\r\n\r\n        // Both have dates: sort by date (earliest first)\r\n        if (dateA && dateB) {\r\n            return dateA - dateB;\r\n        }\r\n\r\n        // Tasks with dates come before tasks without dates\r\n        if (dateA && !dateB) return -1;\r\n        if (!dateA && dateB) return 1;\r\n\r\n        // Both have no date: keep original order\r\n        return 0;\r\n    });\r\n}\r\n\r\n/**\r\n * Get sort value for a task based on column\r\n * @param {Object} task - Task object\r\n * @param {string} column - Column name to sort by\r\n * @param {Array} projects - Array of project objects (for project column)\r\n * @param {Function} getTaskUpdatedTime - Function to get task updated time\r\n * @returns {*} Sort value for comparison\r\n */\r\nexport function getColumnSortValue(task, column, projects = [], getTaskUpdatedTime = null) {\r\n    switch (column) {\r\n        case \"title\":\r\n            return (task.title || \"\").toLowerCase();\r\n        case \"status\": {\r\n            const order = STATUS_ORDER || { backlog: 0, todo: 1, progress: 2, review: 3, done: 4 };\r\n            return order[task.status] ?? 0;\r\n        }\r\n        case \"priority\": {\r\n            const order = { low: 0, medium: 1, high: 2 };\r\n            return order[task.priority] ?? 0;\r\n        }\r\n        case \"project\": {\r\n            const proj = projects.find((p) => p.id === task.projectId);\r\n            return proj ? proj.name.toLowerCase() : \"\";\r\n        }\r\n        case \"startDate\":\r\n            return task.startDate || \"\";\r\n        case \"endDate\":\r\n            return task.endDate || \"\";\r\n        case \"updatedAt\":\r\n            return getTaskUpdatedTime ? getTaskUpdatedTime(task) : 0;\r\n        default:\r\n            return \"\";\r\n    }\r\n}\r\n\r\n/**\r\n * Sort tasks by a specific column\r\n * @param {Array} tasks - Array of task objects\r\n * @param {string} column - Column name to sort by\r\n * @param {string} direction - Sort direction ('asc' or 'desc')\r\n * @param {Array} projects - Array of project objects (for project column)\r\n * @param {Function} getTaskUpdatedTime - Function to get task updated time\r\n * @returns {Array} Sorted tasks array\r\n */\r\nexport function sortTasksByColumn(tasks, column, direction, projects = [], getTaskUpdatedTime = null) {\r\n    if (!column) {\r\n        return tasks;\r\n    }\r\n    \r\n    return [...tasks].sort((a, b) => {\r\n        const aVal = getColumnSortValue(a, column, projects, getTaskUpdatedTime);\r\n        const bVal = getColumnSortValue(b, column, projects, getTaskUpdatedTime);\r\n        \r\n        if (aVal < bVal) return direction === \"asc\" ? -1 : 1;\r\n        if (aVal > bVal) return direction === \"asc\" ? 1 : -1;\r\n        return 0;\r\n    });\r\n}\r\n\r\n/**\r\n * Calculate smart date info for display (urgency indication)\r\n * @param {string|null} endDate - Task end date in ISO format\r\n * @param {string|null} status - Task status (to check if done)\r\n * @returns {Object} Date info with text, class, and showPrefix\r\n */\r\nexport function calculateSmartDateInfo(endDate, status = null) {\r\n    if (!endDate) {\r\n        return { \r\n            text: null, // Caller should provide translated \"No end date\" text\r\n            class: \"\", \r\n            showPrefix: false,\r\n            hasDate: false\r\n        };\r\n    }\r\n\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n\r\n    const dueDate = new Date(endDate);\r\n    dueDate.setHours(0, 0, 0, 0);\r\n\r\n    const diffTime = dueDate - today;\r\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n    if (diffDays < 0) {\r\n        // Only show \"overdue\" styling if task is not done\r\n        if (status === 'done') {\r\n            return { \r\n                text: null, // Caller should format the date\r\n                class: \"\", \r\n                showPrefix: true,\r\n                hasDate: true,\r\n                diffDays,\r\n                urgency: 'completed'\r\n            };\r\n        }\r\n        return {\r\n            text: null, // Caller should provide translated overdue text\r\n            class: \"overdue\",\r\n            showPrefix: true,\r\n            hasDate: true,\r\n            diffDays,\r\n            daysOverdue: Math.abs(diffDays),\r\n            urgency: 'overdue'\r\n        };\r\n    } else if (diffDays === 0) {\r\n        return { \r\n            text: null, // Caller should provide \"Today\" text\r\n            class: \"today\", \r\n            showPrefix: true,\r\n            hasDate: true,\r\n            diffDays,\r\n            urgency: 'today'\r\n        };\r\n    } else if (diffDays === 1) {\r\n        return { \r\n            text: null, // Caller should provide \"Tomorrow\" text\r\n            class: \"soon\", \r\n            showPrefix: true,\r\n            hasDate: true,\r\n            diffDays,\r\n            urgency: 'tomorrow'\r\n        };\r\n    } else if (diffDays <= 7) {\r\n        return { \r\n            text: null, // Caller should format the date\r\n            class: \"soon\", \r\n            showPrefix: true,\r\n            hasDate: true,\r\n            diffDays,\r\n            urgency: 'soon'\r\n        };\r\n    } else {\r\n        // For all other dates (future), just show the formatted date\r\n        return { \r\n            text: null, // Caller should format the date\r\n            class: \"\", \r\n            showPrefix: true,\r\n            hasDate: true,\r\n            diffDays,\r\n            urgency: 'normal'\r\n        };\r\n    }\r\n}\r\n\r\n/**\r\n * Generate HTML for a single task row in list view\r\n * @param {Object} task - Task object\r\n * @param {Object} helpers - Helper functions and data\r\n * @param {Function} helpers.escapeHtml - HTML escape function\r\n * @param {Function} helpers.formatDate - Date formatting function\r\n * @param {Function} helpers.getTagColor - Get tag color function\r\n * @param {Function} helpers.getProjectColor - Get project color function\r\n * @param {Function} helpers.getPriorityLabel - Get priority label function\r\n * @param {Function} helpers.getStatusLabel - Get status label function\r\n * @param {Function} helpers.formatTaskUpdatedDateTime - Format updated time function\r\n * @param {Array} helpers.projects - Array of projects\r\n * @param {string} helpers.noProjectText - Text for \"No project\"\r\n * @param {string} helpers.noDateText - Text for \"No date\"\r\n * @returns {string} HTML string for the table row\r\n */\r\nexport function generateTaskRowHTML(task, helpers) {\r\n    const {\r\n        escapeHtml,\r\n        formatDate,\r\n        getTagColor,\r\n        getProjectColor,\r\n        getPriorityLabel,\r\n        getStatusLabel,\r\n        formatTaskUpdatedDateTime,\r\n        projects,\r\n        noProjectText,\r\n        noDateText\r\n    } = helpers;\r\n\r\n    const statusClass = `status-badge ${task.status}`;\r\n    const proj = projects.find((p) => p.id === task.projectId);\r\n    const projName = proj ? proj.name : noProjectText;\r\n    const start = task.startDate ? formatDate(task.startDate) : noDateText;\r\n    const due = task.endDate ? formatDate(task.endDate) : noDateText;\r\n    const updated = formatTaskUpdatedDateTime(task) || \"\";\r\n    const prText = task.priority ? getPriorityLabel(task.priority) : \"\";\r\n\r\n    const tagsHTML = task.tags && task.tags.length > 0\r\n        ? task.tags.map(tag => `<span style=\"background-color: ${getTagColor(tag)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; margin-right: 4px; font-weight: 500;\">${escapeHtml(tag.toUpperCase())}</span>`).join('')\r\n        : '';\r\n\r\n    const projectIndicator = proj\r\n        ? `<span style=\"display: inline-block; width: 10px; height: 10px; background-color: ${getProjectColor(proj.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;\"></span>`\r\n        : '';\r\n\r\n    const rowClass = task.status === 'done' ? ' task-row-done' : '';\r\n\r\n    return `\r\n        <tr class=\"task-row${rowClass}\" data-action=\"openTaskDetails\" data-param=\"${task.id}\">\r\n            <td>${projectIndicator}${escapeHtml(task.title || \"\")}</td>\r\n            <td><span class=\"priority-badge priority-${task.priority}\">${prText}</span></td>\r\n            <td><span class=\"${statusClass}\">${(getStatusLabel(task.status)).toUpperCase()}</span></td>\r\n            <td>${tagsHTML || '<span style=\"color: var(--text-muted); font-size: 12px;\">-</span>'}</td>\r\n            <td>${escapeHtml(projName)}</td>\r\n            <td>${start}</td>\r\n            <td>${due}</td>\r\n            <td>${escapeHtml(updated)}</td>\r\n        </tr>\r\n    `;\r\n}\r\n\r\n/**\r\n * Generate HTML for all task rows in list view\r\n * @param {Array} tasks - Array of task objects\r\n * @param {Object} helpers - Helper functions and data (same as generateTaskRowHTML)\r\n * @returns {string} HTML string for all table rows\r\n */\r\nexport function generateListViewHTML(tasks, helpers) {\r\n    return tasks.map(task => generateTaskRowHTML(task, helpers)).join('');\r\n}\r\n\r\n/**\r\n * Prepare list view data for rendering\r\n * @param {Array} tasks - All tasks\r\n * @param {Object} options - List view options\r\n * @param {Object} options.currentSort - Current sort state { column, direction }\r\n * @param {Array} options.projects - Array of project objects\r\n * @param {number|null} options.updatedCutoff - Updated time cutoff\r\n * @param {Function} options.getTaskUpdatedTime - Function to get task updated time\r\n * @returns {Object} Prepared list view data\r\n */\r\nexport function prepareListViewData(tasks, options = {}) {\r\n    const {\r\n        currentSort = null,\r\n        projects = [],\r\n        updatedCutoff = null,\r\n        getTaskUpdatedTime = null\r\n    } = options;\r\n    \r\n    // Filter by updated time if cutoff provided\r\n    let filteredTasks = tasks;\r\n    if (updatedCutoff !== null && getTaskUpdatedTime) {\r\n        filteredTasks = tasks.filter((t) => getTaskUpdatedTime(t) >= updatedCutoff);\r\n    }\r\n    \r\n    // Apply default sort (priority then date)\r\n    let sortedTasks = sortTasksByPriorityAndDate(filteredTasks);\r\n    \r\n    // Apply column sort if specified\r\n    if (currentSort && currentSort.column) {\r\n        sortedTasks = sortTasksByColumn(\r\n            sortedTasks, \r\n            currentSort.column, \r\n            currentSort.direction,\r\n            projects,\r\n            getTaskUpdatedTime\r\n        );\r\n    }\r\n    \r\n    return {\r\n        tasks: sortedTasks,\r\n        count: sortedTasks.length,\r\n        totalOriginal: tasks.length\r\n    };\r\n}\r\n", "/**\r\n * Calendar View Module\r\n * \r\n * Pure computation functions for calendar view logic.\r\n * These functions handle date calculations, grid generation, and project overlap detection.\r\n * \r\n * @module views/calendar\r\n */\r\n\r\n/**\r\n * Calculate calendar grid parameters for a given month\r\n * @param {number} year - Full year (e.g., 2024)\r\n * @param {number} month - Month (0-11)\r\n * @returns {Object} Calendar grid parameters\r\n */\r\nexport function calculateCalendarGrid(year, month) {\r\n    // Calculate first day of month (adjusted so Monday = 0, Sunday = 6)\r\n    let firstDayOfWeek = new Date(year, month, 1).getDay();\r\n    firstDayOfWeek = (firstDayOfWeek + 6) % 7; // Convert Sunday=0 to Sunday=6\r\n    \r\n    const daysInMonth = new Date(year, month + 1, 0).getDate();\r\n    const daysInPrevMonth = new Date(year, month, 0).getDate();\r\n    \r\n    // Calculate total cells needed (complete weeks)\r\n    const totalCells = firstDayOfWeek + daysInMonth;\r\n    const cellsNeeded = Math.ceil(totalCells / 7) * 7;\r\n    const nextMonthDays = cellsNeeded - totalCells;\r\n    \r\n    return {\r\n        firstDayOfWeek,\r\n        daysInMonth,\r\n        daysInPrevMonth,\r\n        totalCells,\r\n        cellsNeeded,\r\n        nextMonthDays,\r\n        totalRows: Math.ceil(cellsNeeded / 7)\r\n    };\r\n}\r\n\r\n/**\r\n * Generate array of day cells for calendar grid\r\n * @param {number} year - Full year\r\n * @param {number} month - Month (0-11)\r\n * @param {Object} options - Options\r\n * @param {Date} options.today - Today's date\r\n * @returns {Array} Array of day cell objects\r\n */\r\nexport function generateCalendarDays(year, month, options = {}) {\r\n    const { today = new Date() } = options;\r\n    const grid = calculateCalendarGrid(year, month);\r\n    const days = [];\r\n    \r\n    const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;\r\n    const todayDate = today.getDate();\r\n    \r\n    let cellIndex = 0;\r\n    \r\n    // Previous month's trailing days\r\n    for (let i = grid.firstDayOfWeek - 1; i >= 0; i--) {\r\n        const day = grid.daysInPrevMonth - i;\r\n        days.push({\r\n            day,\r\n            type: 'prev-month',\r\n            row: Math.floor(cellIndex / 7),\r\n            column: cellIndex % 7,\r\n            isWeekend: (cellIndex % 7) >= 5,\r\n            dateStr: null // Not clickable\r\n        });\r\n        cellIndex++;\r\n    }\r\n    \r\n    // Current month's days\r\n    for (let day = 1; day <= grid.daysInMonth; day++) {\r\n        const dateStr = formatDateISO(year, month, day);\r\n        const isToday = isCurrentMonth && day === todayDate;\r\n        const column = cellIndex % 7;\r\n        \r\n        days.push({\r\n            day,\r\n            type: 'current-month',\r\n            row: Math.floor(cellIndex / 7),\r\n            column,\r\n            isWeekend: column >= 5,\r\n            isToday,\r\n            dateStr\r\n        });\r\n        cellIndex++;\r\n    }\r\n    \r\n    // Next month's leading days\r\n    for (let day = 1; day <= grid.nextMonthDays; day++) {\r\n        days.push({\r\n            day,\r\n            type: 'next-month',\r\n            row: Math.floor(cellIndex / 7),\r\n            column: cellIndex % 7,\r\n            isWeekend: (cellIndex % 7) >= 5,\r\n            dateStr: null // Not clickable\r\n        });\r\n        cellIndex++;\r\n    }\r\n    \r\n    return days;\r\n}\r\n\r\n/**\r\n * Format a date as ISO string (YYYY-MM-DD)\r\n * @param {number} year - Full year\r\n * @param {number} month - Month (0-11)\r\n * @param {number} day - Day of month\r\n * @returns {string} ISO date string\r\n */\r\nexport function formatDateISO(year, month, day) {\r\n    return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;\r\n}\r\n\r\n/**\r\n * Check if a date falls within a project's date range\r\n * @param {string} dateStr - Date string (YYYY-MM-DD)\r\n * @param {Object} project - Project object with startDate and optional endDate\r\n * @returns {boolean} True if date is within project range\r\n */\r\nexport function isDateInProjectRange(dateStr, project) {\r\n    if (!project.startDate) return false;\r\n    \r\n    const currentDate = new Date(dateStr);\r\n    const startDate = new Date(project.startDate);\r\n    const endDate = project.endDate \r\n        ? new Date(project.endDate) \r\n        : new Date(project.startDate);\r\n    \r\n    return currentDate >= startDate && currentDate <= endDate;\r\n}\r\n\r\n/**\r\n * Count projects overlapping a specific date\r\n * @param {string} dateStr - Date string (YYYY-MM-DD)\r\n * @param {Array} projects - Array of project objects\r\n * @param {Set|null} filteredProjectIds - Set of filtered project IDs (null = all)\r\n * @returns {number} Count of overlapping projects\r\n */\r\nexport function countOverlappingProjects(dateStr, projects, filteredProjectIds = null) {\r\n    return projects.filter(project => {\r\n        // Check if project matches filter\r\n        if (filteredProjectIds && !filteredProjectIds.has(project.id)) {\r\n            return false;\r\n        }\r\n        return isDateInProjectRange(dateStr, project);\r\n    }).length;\r\n}\r\n\r\n/**\r\n * Get projects overlapping a specific date\r\n * @param {string} dateStr - Date string (YYYY-MM-DD)\r\n * @param {Array} projects - Array of project objects\r\n * @param {Set|null} filteredProjectIds - Set of filtered project IDs (null = all)\r\n * @returns {Array} Array of overlapping projects\r\n */\r\nexport function getOverlappingProjects(dateStr, projects, filteredProjectIds = null) {\r\n    return projects.filter(project => {\r\n        // Check if project matches filter\r\n        if (filteredProjectIds && !filteredProjectIds.has(project.id)) {\r\n            return false;\r\n        }\r\n        return isDateInProjectRange(dateStr, project);\r\n    });\r\n}\r\n\r\n/**\r\n * Get tasks for a specific date\r\n * @param {string} dateStr - Date string (YYYY-MM-DD)\r\n * @param {Array} tasks - Array of task objects\r\n * @param {Object} options - Options\r\n * @param {boolean} options.includeBacklog - Include backlog tasks\r\n * @param {boolean} options.useStartDate - Also match by start date\r\n * @returns {Array} Array of tasks for the date\r\n */\r\nexport function getTasksForDate(dateStr, tasks, options = {}) {\r\n    const { includeBacklog = false, useStartDate = false } = options;\r\n    \r\n    return tasks.filter(task => {\r\n        // Exclude backlog unless explicitly included\r\n        if (!includeBacklog && task.status === 'backlog') {\r\n            return false;\r\n        }\r\n        \r\n        // Match by end date\r\n        if (task.endDate === dateStr) {\r\n            return true;\r\n        }\r\n        \r\n        // Optionally match by start date\r\n        if (useStartDate && task.startDate === dateStr) {\r\n            return true;\r\n        }\r\n        \r\n        return false;\r\n    });\r\n}\r\n\r\n/**\r\n * Calculate month navigation (handles year rollover)\r\n * @param {number} year - Current year\r\n * @param {number} month - Current month (0-11)\r\n * @param {number} delta - Change in months (+1 or -1)\r\n * @returns {Object} New year and month\r\n */\r\nexport function calculateMonthNavigation(year, month, delta) {\r\n    let newMonth = month + delta;\r\n    let newYear = year;\r\n    \r\n    if (newMonth < 0) {\r\n        newMonth = 11;\r\n        newYear--;\r\n    } else if (newMonth > 11) {\r\n        newMonth = 0;\r\n        newYear++;\r\n    }\r\n    \r\n    return { year: newYear, month: newMonth };\r\n}\r\n\r\n/**\r\n * Check if viewing current month\r\n * @param {number} year - Displayed year\r\n * @param {number} month - Displayed month (0-11)\r\n * @param {Date} today - Today's date\r\n * @returns {boolean} True if viewing current month\r\n */\r\nexport function isCurrentMonth(year, month, today = new Date()) {\r\n    return today.getMonth() === month && today.getFullYear() === year;\r\n}\r\n\r\n/**\r\n * Prepare calendar data for rendering\r\n * @param {number} year - Year to display\r\n * @param {number} month - Month to display (0-11)\r\n * @param {Object} options - Options\r\n * @param {Array} options.tasks - Array of task objects\r\n * @param {Array} options.projects - Array of project objects\r\n * @param {Set|null} options.filteredProjectIds - Filtered project IDs\r\n * @param {boolean} options.includeBacklog - Include backlog tasks\r\n * @param {Date} options.today - Today's date\r\n * @returns {Object} Prepared calendar data\r\n */\r\nexport function prepareCalendarData(year, month, options = {}) {\r\n    const {\r\n        tasks = [],\r\n        projects = [],\r\n        filteredProjectIds = null,\r\n        includeBacklog = false,\r\n        today = new Date()\r\n    } = options;\r\n    \r\n    const grid = calculateCalendarGrid(year, month);\r\n    const days = generateCalendarDays(year, month, { today });\r\n    \r\n    // Enhance days with task and project counts\r\n    const enhancedDays = days.map(day => {\r\n        if (day.type !== 'current-month') {\r\n            return { ...day, taskCount: 0, projectCount: 0 };\r\n        }\r\n        \r\n        const dayTasks = getTasksForDate(day.dateStr, tasks, { includeBacklog });\r\n        const projectCount = countOverlappingProjects(day.dateStr, projects, filteredProjectIds);\r\n        \r\n        return {\r\n            ...day,\r\n            taskCount: dayTasks.length,\r\n            projectCount,\r\n            hasProjects: projectCount > 0\r\n        };\r\n    });\r\n    \r\n    return {\r\n        year,\r\n        month,\r\n        grid,\r\n        days: enhancedDays,\r\n        isCurrentMonth: isCurrentMonth(year, month, today),\r\n        totalRows: grid.totalRows\r\n    };\r\n}\r\n\r\n/**\r\n * Generate HTML for calendar day headers\r\n * @param {Array} dayNames - Array of day name strings\r\n * @returns {string} HTML string for day headers\r\n */\r\nexport function generateCalendarHeadersHTML(dayNames) {\r\n    return dayNames.map((day, idx) => {\r\n        const isWeekend = idx >= 5;\r\n        return `<div class=\"calendar-day-header${isWeekend ? ' weekend' : ''}\">${day}</div>`;\r\n    }).join('');\r\n}\r\n\r\n/**\r\n * Generate HTML for a single calendar day cell\r\n * @param {Object} dayInfo - Day info object\r\n * @param {number} dayInfo.day - Day number\r\n * @param {string} dayInfo.dateStr - ISO date string\r\n * @param {string} dayInfo.type - 'prev-month', 'current-month', or 'next-month'\r\n * @param {number} dayInfo.row - Row index\r\n * @param {boolean} dayInfo.isToday - Is today\r\n * @param {boolean} dayInfo.isWeekend - Is weekend\r\n * @param {boolean} dayInfo.hasProjects - Has overlapping projects\r\n * @returns {string} HTML string for day cell\r\n */\r\nexport function generateCalendarDayHTML(dayInfo) {\r\n    const { day, dateStr, type, row, isToday, isWeekend, hasProjects } = dayInfo;\r\n\r\n    if (type !== 'current-month') {\r\n        return `<div class=\"calendar-day other-month\" data-row=\"${row}\">\r\n            <div class=\"calendar-day-number\">${day}</div>\r\n            <div class=\"project-spacer\" style=\"height:0px;\"></div>\r\n        </div>`;\r\n    }\r\n\r\n    const todayClass = isToday ? ' today' : '';\r\n    const weekendClass = isWeekend ? ' weekend' : '';\r\n\r\n    return `<div class=\"calendar-day${todayClass}${weekendClass}\" data-row=\"${row}\" data-action=\"showDayTasks\" data-param=\"${dateStr}\" data-has-project=\"${hasProjects}\">\r\n        <div class=\"calendar-day-number\">${day}</div>\r\n        <div class=\"project-spacer\" style=\"height:0px;\"></div>\r\n        <div class=\"tasks-container\"></div>\r\n    </div>`;\r\n}\r\n\r\n/**\r\n * Generate HTML for entire calendar grid\r\n * @param {Object} calendarData - Calendar data from prepareCalendarData\r\n * @param {Array} dayNames - Array of day name strings\r\n * @returns {string} HTML string for calendar grid\r\n */\r\nexport function generateCalendarGridHTML(calendarData, dayNames) {\r\n    const { days } = calendarData;\r\n\r\n    // Day headers\r\n    let html = generateCalendarHeadersHTML(dayNames);\r\n\r\n    // Day cells\r\n    days.forEach((day, cellIndex) => {\r\n        const row = Math.floor(cellIndex / 7);\r\n        const isWeekend = (cellIndex % 7) >= 5;\r\n\r\n        html += generateCalendarDayHTML({\r\n            ...day,\r\n            row,\r\n            isWeekend\r\n        });\r\n    });\r\n\r\n    return html;\r\n}\r\n", "/**\r\n * Projects View Module\r\n *\r\n * Pure computation functions for projects view logic.\r\n * These functions handle project statistics, sorting, and filtering.\r\n *\r\n * @module views/projectsView\r\n */\r\n\r\nimport { PRIORITY_ORDER, STATUS_ORDER } from '../config/constants.js';\r\n\r\n/**\r\n * Calculate task statistics for a project\r\n * @param {Array} tasks - Array of all task objects\r\n * @param {number} projectId - Project ID to calculate stats for\r\n * @returns {Object} Task statistics by status\r\n */\r\nexport function calculateProjectTaskStats(tasks, projectId) {\r\n    const projectTasks = tasks.filter(t => t.projectId === projectId);\r\n    \r\n    const stats = {\r\n        total: projectTasks.length,\r\n        backlog: 0,\r\n        todo: 0,\r\n        progress: 0,\r\n        review: 0,\r\n        done: 0\r\n    };\r\n    \r\n    projectTasks.forEach(task => {\r\n        if (stats.hasOwnProperty(task.status)) {\r\n            stats[task.status]++;\r\n        }\r\n    });\r\n    \r\n    return stats;\r\n}\r\n\r\n/**\r\n * Calculate completion percentage for a project\r\n * @param {Object} stats - Task statistics from calculateProjectTaskStats\r\n * @returns {number} Completion percentage (0-100)\r\n */\r\nexport function calculateCompletionPercentage(stats) {\r\n    if (stats.total === 0) return 0;\r\n    return Math.round((stats.done / stats.total) * 100);\r\n}\r\n\r\n/**\r\n * Determine project status based on dates and task completion\r\n * @param {Object} project - Project object\r\n * @param {Object} stats - Task statistics from calculateProjectTaskStats\r\n * @param {Date} today - Today's date\r\n * @returns {Object} Project status info\r\n */\r\nexport function determineProjectStatus(project, stats, today = new Date()) {\r\n    const todayStr = today.toISOString().split('T')[0];\r\n    \r\n    // Check if all tasks are done\r\n    if (stats.total > 0 && stats.done === stats.total) {\r\n        return {\r\n            status: 'completed',\r\n            label: 'Completed',\r\n            class: 'status-completed'\r\n        };\r\n    }\r\n    \r\n    // Check if project has ended (past end date)\r\n    if (project.endDate && project.endDate < todayStr) {\r\n        return {\r\n            status: 'ended',\r\n            label: 'Ended',\r\n            class: 'status-ended'\r\n        };\r\n    }\r\n    \r\n    // Check if project hasn't started yet\r\n    if (project.startDate && project.startDate > todayStr) {\r\n        return {\r\n            status: 'upcoming',\r\n            label: 'Upcoming',\r\n            class: 'status-upcoming'\r\n        };\r\n    }\r\n    \r\n    // Check if project is in progress (has tasks in progress or review)\r\n    if (stats.progress > 0 || stats.review > 0) {\r\n        return {\r\n            status: 'active',\r\n            label: 'Active',\r\n            class: 'status-active'\r\n        };\r\n    }\r\n    \r\n    // Default: project exists but no active work\r\n    return {\r\n        status: 'idle',\r\n        label: 'Idle',\r\n        class: 'status-idle'\r\n    };\r\n}\r\n\r\n/**\r\n * Sort projects by a specific field\r\n * @param {Array} projects - Array of project objects\r\n * @param {string} sortBy - Field to sort by ('name', 'startDate', 'endDate', 'progress')\r\n * @param {string} direction - Sort direction ('asc' or 'desc')\r\n * @param {Array} tasks - Array of all tasks (needed for progress sorting)\r\n * @returns {Array} Sorted projects array\r\n */\r\nexport function sortProjects(projects, sortBy, direction = 'asc', tasks = []) {\r\n    return [...projects].sort((a, b) => {\r\n        let aVal, bVal;\r\n        \r\n        switch (sortBy) {\r\n            case 'name':\r\n                aVal = (a.name || '').toLowerCase();\r\n                bVal = (b.name || '').toLowerCase();\r\n                break;\r\n            case 'startDate':\r\n                aVal = a.startDate || '';\r\n                bVal = b.startDate || '';\r\n                break;\r\n            case 'endDate':\r\n                aVal = a.endDate || '';\r\n                bVal = b.endDate || '';\r\n                break;\r\n            case 'progress':\r\n                const statsA = calculateProjectTaskStats(tasks, a.id);\r\n                const statsB = calculateProjectTaskStats(tasks, b.id);\r\n                aVal = calculateCompletionPercentage(statsA);\r\n                bVal = calculateCompletionPercentage(statsB);\r\n                break;\r\n            case 'taskCount':\r\n                aVal = tasks.filter(t => t.projectId === a.id).length;\r\n                bVal = tasks.filter(t => t.projectId === b.id).length;\r\n                break;\r\n            default:\r\n                aVal = a.id;\r\n                bVal = b.id;\r\n        }\r\n        \r\n        if (aVal < bVal) return direction === 'asc' ? -1 : 1;\r\n        if (aVal > bVal) return direction === 'asc' ? 1 : -1;\r\n        return 0;\r\n    });\r\n}\r\n\r\n/**\r\n * Filter projects by search term\r\n * @param {Array} projects - Array of project objects\r\n * @param {string} searchTerm - Search term to filter by\r\n * @returns {Array} Filtered projects array\r\n */\r\nexport function filterProjectsBySearch(projects, searchTerm) {\r\n    if (!searchTerm || searchTerm.trim() === '') {\r\n        return projects;\r\n    }\r\n    \r\n    const term = searchTerm.toLowerCase().trim();\r\n    \r\n    return projects.filter(project => {\r\n        const name = (project.name || '').toLowerCase();\r\n        const description = (project.description || '').toLowerCase();\r\n        \r\n        return name.includes(term) || description.includes(term);\r\n    });\r\n}\r\n\r\n/**\r\n * Filter projects by status\r\n * @param {Array} projects - Array of project objects\r\n * @param {Set|Array} statusFilter - Set or array of status values to include\r\n * @param {Array} tasks - Array of all tasks (needed for status calculation)\r\n * @param {Date} today - Today's date\r\n * @returns {Array} Filtered projects array\r\n */\r\nexport function filterProjectsByStatus(projects, statusFilter, tasks = [], today = new Date()) {\r\n    if (!statusFilter || (statusFilter.size === 0 && statusFilter.length === 0)) {\r\n        return projects;\r\n    }\r\n    \r\n    const statusSet = statusFilter instanceof Set ? statusFilter : new Set(statusFilter);\r\n    \r\n    return projects.filter(project => {\r\n        const stats = calculateProjectTaskStats(tasks, project.id);\r\n        const statusInfo = determineProjectStatus(project, stats, today);\r\n        return statusSet.has(statusInfo.status);\r\n    });\r\n}\r\n\r\n/**\r\n * Prepare projects view data for rendering\r\n * @param {Array} projects - Array of project objects\r\n * @param {Array} tasks - Array of all task objects\r\n * @param {Object} options - Options\r\n * @param {string} options.searchTerm - Search term to filter by\r\n * @param {Set|null} options.statusFilter - Status filter\r\n * @param {string} options.sortBy - Field to sort by\r\n * @param {string} options.sortDirection - Sort direction\r\n * @param {Date} options.today - Today's date\r\n * @returns {Object} Prepared projects view data\r\n */\r\nexport function prepareProjectsViewData(projects, tasks, options = {}) {\r\n    const {\r\n        searchTerm = '',\r\n        statusFilter = null,\r\n        sortBy = 'name',\r\n        sortDirection = 'asc',\r\n        today = new Date()\r\n    } = options;\r\n    \r\n    // Apply search filter\r\n    let filteredProjects = filterProjectsBySearch(projects, searchTerm);\r\n    \r\n    // Apply status filter\r\n    if (statusFilter && statusFilter.size > 0) {\r\n        filteredProjects = filterProjectsByStatus(filteredProjects, statusFilter, tasks, today);\r\n    }\r\n    \r\n    // Apply sorting\r\n    const sortedProjects = sortProjects(filteredProjects, sortBy, sortDirection, tasks);\r\n    \r\n    // Enhance with stats\r\n    const enhancedProjects = sortedProjects.map(project => {\r\n        const stats = calculateProjectTaskStats(tasks, project.id);\r\n        const statusInfo = determineProjectStatus(project, stats, today);\r\n        const completionPct = calculateCompletionPercentage(stats);\r\n        \r\n        return {\r\n            ...project,\r\n            stats,\r\n            statusInfo,\r\n            completionPct\r\n        };\r\n    });\r\n    \r\n    return {\r\n        projects: enhancedProjects,\r\n        count: enhancedProjects.length,\r\n        totalOriginal: projects.length\r\n    };\r\n}\r\n\r\n/**\r\n * Sort project tasks by priority (desc) and status (asc)\r\n * @param {Array} tasks - Array of task objects\r\n * @returns {Array} Sorted tasks\r\n */\r\nexport function sortProjectTasks(tasks) {\r\n    return [...tasks].sort((a, b) => {\r\n        const aPriority = PRIORITY_ORDER[a.priority || 'low'] || 1;\r\n        const bPriority = PRIORITY_ORDER[b.priority || 'low'] || 1;\r\n        if (aPriority !== bPriority) {\r\n            return bPriority - aPriority;\r\n        }\r\n        const aStatus = STATUS_ORDER[a.status || 'todo'] || 4;\r\n        const bStatus = STATUS_ORDER[b.status || 'todo'] || 4;\r\n        return aStatus - bStatus;\r\n    });\r\n}\r\n\r\n/**\r\n * Generate HTML for a single project item (desktop view)\r\n * @param {Object} project - Project object\r\n * @param {Array} allTasks - All tasks array\r\n * @param {Object} helpers - Helper functions and translations\r\n * @returns {string} HTML string\r\n */\r\nexport function generateProjectItemHTML(project, allTasks, helpers) {\r\n    const {\r\n        escapeHtml,\r\n        formatDatePretty,\r\n        getProjectColor,\r\n        getProjectStatus,\r\n        getProjectStatusLabel,\r\n        getTagColor,\r\n        getPriorityLabel,\r\n        getStatusLabel,\r\n        getLocale,\r\n        t\r\n    } = helpers;\r\n\r\n    const projectTasks = allTasks.filter(task => task.projectId === project.id);\r\n    const stats = calculateProjectTaskStats(allTasks, project.id);\r\n    const { done: completed, progress: inProgress, review, todo, backlog, total } = stats;\r\n\r\n    const completedPct = total > 0 ? (completed / total) * 100 : 0;\r\n    const completionPct = total > 0 ? Math.round((completed / total) * 100) : 0;\r\n\r\n    const swatchColor = getProjectColor(project.id);\r\n    const projectStatus = getProjectStatus(project.id);\r\n\r\n    const sortedTasks = sortProjectTasks(projectTasks);\r\n\r\n    const tasksHtml = sortedTasks.length > 0\r\n        ? sortedTasks.map(task => {\r\n            const priority = task.priority || 'low';\r\n            const hasStartDate = task.startDate && task.startDate !== '';\r\n            const hasEndDate = task.endDate && task.endDate !== '';\r\n            let dateRangeHtml = '';\r\n            if (hasStartDate && hasEndDate) {\r\n                dateRangeHtml = `<span class=\"date-badge\">${formatDatePretty(task.startDate, getLocale())}</span><span class=\"date-arrow\">\u2192</span><span class=\"date-badge\">${formatDatePretty(task.endDate, getLocale())}</span>`;\r\n            } else if (hasEndDate) {\r\n                dateRangeHtml = `<span class=\"date-badge\">${formatDatePretty(task.endDate, getLocale())}</span>`;\r\n            } else if (hasStartDate) {\r\n                dateRangeHtml = `<span class=\"date-badge\">${formatDatePretty(task.startDate, getLocale())}</span>`;\r\n            }\r\n\r\n            return `\r\n                <div class=\"expanded-task-item\" data-action=\"openTaskDetails\" data-param=\"${task.id}\" data-stop-propagation=\"true\">\r\n                    <div class=\"expanded-task-info\">\r\n                        <div class=\"expanded-task-name\">${escapeHtml(task.title)}</div>\r\n                        ${(dateRangeHtml || (task.tags && task.tags.length > 0)) ? `\r\n                            <div class=\"expanded-task-meta\">\r\n                                ${task.tags && task.tags.length > 0 ? `\r\n                                    <div class=\"task-tags\">\r\n                                        ${task.tags.map(tag => `<span style=\"background-color: ${getTagColor(tag)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;\">${escapeHtml(tag.toUpperCase())}</span>`).join(' ')}\r\n                                    </div>\r\n                                ` : ''}\r\n                                ${dateRangeHtml ? `<div class=\"expanded-task-dates\">${dateRangeHtml}</div>` : ''}\r\n                            </div>\r\n                        ` : ''}\r\n                    </div>\r\n                    <div class=\"expanded-task-priority\">\r\n                        <div class=\"priority-chip priority-${priority}\">${getPriorityLabel(priority)}</div>\r\n                    </div>\r\n                    <div class=\"expanded-task-status-col\">\r\n                        <div class=\"expanded-task-status ${task.status}\">${getStatusLabel(task.status)}</div>\r\n                    </div>\r\n                </div>\r\n            `;\r\n        }).join('')\r\n        : `<div class=\"no-tasks-message\">${t('tasks.noTasksInProject')}</div>`;\r\n\r\n    return `\r\n        <div class=\"project-list-item\" id=\"project-item-${project.id}\">\r\n            <div class=\"project-row\" data-action=\"toggleProjectExpand\" data-param=\"${project.id}\">\r\n                <div class=\"project-chevron\">\u25B8</div>\r\n                <div class=\"project-info\">\r\n                    <div class=\"project-swatch\" style=\"background: ${swatchColor};\"></div>\r\n                    <div class=\"project-name-desc\">\r\n                        <div class=\"project-title project-title-link\" data-action=\"showProjectDetails\" data-param=\"${project.id}\" data-stop-propagation=\"true\">${escapeHtml(project.name || t('projects.untitled'))}</div>\r\n                        ${project.tags && project.tags.length > 0 ? `\r\n                            <div class=\"project-tags-row\">\r\n                                ${project.tags.map(tag => `<span class=\"project-tag\" style=\"background-color: ${getProjectColor(project.id)};\">${escapeHtml(tag.toUpperCase())}</span>`).join('')}\r\n                            </div>\r\n                        ` : ''}\r\n                        <div class=\"project-description\">${escapeHtml(project.description || t('projects.noDescription'))}</div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"project-status-col\">\r\n                    <span class=\"project-status-badge ${projectStatus}\">${getProjectStatusLabel(projectStatus).toUpperCase()}</span>\r\n                </div>\r\n                <div class=\"project-progress-col\">\r\n                    <div class=\"progress-bar-wrapper\">\r\n                        <div class=\"progress-segment done\" style=\"width: ${completedPct}%;\"></div>\r\n                    </div>\r\n                    <div class=\"progress-percent\">${completionPct}%</div>\r\n                </div>\r\n                <div class=\"project-tasks-col\">\r\n                    <span class=\"project-tasks-breakdown\">${t('projects.tasksBreakdown', { total, done: completed })}</span>\r\n                </div>\r\n                <div class=\"project-dates-col\">\r\n                    <span class=\"date-badge\">${formatDatePretty(project.startDate, getLocale())}</span>\r\n                    <span class=\"date-arrow\">\u2192</span>\r\n                    <span class=\"date-badge\">${formatDatePretty(project.endDate, getLocale())}</span>\r\n                </div>\r\n            </div>\r\n            <div class=\"project-tasks-expanded\">\r\n                <div class=\"expanded-tasks-container\">\r\n                    <div class=\"expanded-tasks-header\">\r\n                        <span>\\u{1F4CB} ${t('projects.details.tasksTitle', { count: total })}</span>\r\n                        <button class=\"add-btn expanded-add-task-btn\" type=\"button\" data-action=\"openTaskModalForProject\" data-param=\"${project.id}\" data-stop-propagation=\"true\">${t('tasks.addButton')}</button>\r\n                    </div>\r\n                    ${tasksHtml}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    `;\r\n}\r\n\r\n/**\r\n * Generate HTML for all project items\r\n * @param {Array} projects - Array of project objects\r\n * @param {Array} allTasks - All tasks array\r\n * @param {Object} helpers - Helper functions\r\n * @returns {string} HTML string for all projects\r\n */\r\nexport function generateProjectsListHTML(projects, allTasks, helpers) {\r\n    return projects.map(project => generateProjectItemHTML(project, allTasks, helpers)).join('');\r\n}\r\n", "/**\r\n * Task Details Component Module\r\n *\r\n * Pure computation functions for task details modal logic.\r\n * These functions handle mobile field organization and tag display.\r\n *\r\n * @module components/taskDetails\r\n */\r\n\r\n/**\r\n * Determine which fields should be in General vs Details tab on mobile\r\n * @param {Object} task - Task object\r\n * @param {Object} options - Configuration options\r\n * @param {boolean} options.startDateWasEverSet - If start date was ever set\r\n * @param {boolean} options.endDateWasEverSet - If end date was ever set\r\n * @returns {Object} Field placement decisions\r\n */\r\nexport function calculateMobileFieldPlacement(task, options = {}) {\r\n    const { startDateWasEverSet = false, endDateWasEverSet = false } = options;\r\n\r\n    const hasTags = Array.isArray(task?.tags) && task.tags.length > 0;\r\n    const hasStartDate = typeof task?.startDate === 'string' && task.startDate.trim() !== '';\r\n    const hasEndDate = typeof task?.endDate === 'string' && task.endDate.trim() !== '';\r\n    const hasLinks = Array.isArray(task?.attachments) && task.attachments.some(att =>\r\n        att.type === 'link' || (att.url && att.type !== 'file')\r\n    );\r\n\r\n    // Start/End dates: Once set, ALWAYS stay in General (even if cleared)\r\n    const startDateInGeneral = startDateWasEverSet || hasStartDate;\r\n    const endDateInGeneral = endDateWasEverSet || hasEndDate;\r\n\r\n    // Tags and Links: Move dynamically based on current value\r\n    const tagsInGeneral = hasTags;\r\n    const linksInGeneral = hasLinks;\r\n\r\n    return {\r\n        hasTags,\r\n        hasStartDate,\r\n        hasEndDate,\r\n        hasLinks,\r\n        startDateInGeneral,\r\n        endDateInGeneral,\r\n        tagsInGeneral,\r\n        linksInGeneral\r\n    };\r\n}\r\n\r\n/**\r\n * Determine if the Details tab should be hidden\r\n * Details tab is hidden only when BOTH Tags AND Links are filled\r\n * (Dates don't affect this since they stay in General regardless)\r\n * @param {Object} fieldState - Field state from calculateMobileFieldPlacement\r\n * @returns {boolean} True if Details tab should be hidden\r\n */\r\nexport function shouldHideDetailsTab(fieldState) {\r\n    return fieldState.hasTags && fieldState.hasLinks;\r\n}\r\n\r\n/**\r\n * Generate HTML for a single tag with remove button\r\n * @param {string} tag - Tag name\r\n * @param {Object} options - Display options\r\n * @param {boolean} options.isMobile - Is mobile view\r\n * @param {Function} options.getTagColor - Function to get tag color\r\n * @param {Function} options.escapeHtml - HTML escape function\r\n * @returns {string} HTML string for the tag\r\n */\r\nexport function generateTagHTML(tag, options) {\r\n    const { isMobile = false, getTagColor, escapeHtml } = options;\r\n\r\n    const padding = isMobile ? '3px 6px' : '4px 8px';\r\n    const fontSize = isMobile ? '11px' : '12px';\r\n    const gap = isMobile ? '4px' : '4px';\r\n    const buttonSize = isMobile ? '12px' : '14px';\r\n    const lineHeight = isMobile ? '1.2' : '1.4';\r\n    const color = getTagColor(tag);\r\n\r\n    return `\r\n        <span class=\"task-tag\" style=\"background-color: ${color}; color: white; padding: ${padding}; border-radius: 4px; font-size: ${fontSize}; display: inline-flex; align-items: center; gap: ${gap}; line-height: ${lineHeight};\">\r\n            ${escapeHtml(tag.toUpperCase())}\r\n            <button type=\"button\" data-action=\"removeTag\" data-param=\"${escapeHtml(tag)}\" style=\"background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${buttonSize}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;\">\u00D7</button>\r\n        </span>\r\n    `;\r\n}\r\n\r\n/**\r\n * Generate HTML for all tags display\r\n * @param {Array} tags - Array of tag names\r\n * @param {Object} options - Display options\r\n * @param {boolean} options.isMobile - Is mobile view\r\n * @param {Function} options.getTagColor - Function to get tag color\r\n * @param {Function} options.escapeHtml - HTML escape function\r\n * @param {string} options.noTagsText - Text to show when no tags\r\n * @returns {string} HTML string for tags display\r\n */\r\nexport function generateTagsDisplayHTML(tags, options) {\r\n    const { noTagsText = 'No tags' } = options;\r\n\r\n    if (!tags || tags.length === 0) {\r\n        return `<span style=\"color: var(--text-muted); font-size: 13px;\">${noTagsText}</span>`;\r\n    }\r\n\r\n    return tags.map(tag => generateTagHTML(tag, options)).join('');\r\n}\r\n\r\n/**\r\n * Get tag display options based on viewport\r\n * @param {number} viewportWidth - Current viewport width\r\n * @returns {Object} Display options for tags\r\n */\r\nexport function getTagDisplayOptions(viewportWidth) {\r\n    const isMobile = viewportWidth <= 768;\r\n\r\n    return {\r\n        isMobile,\r\n        padding: isMobile ? '3px 6px' : '4px 8px',\r\n        fontSize: isMobile ? '11px' : '12px',\r\n        gap: isMobile ? '4px' : '4px',\r\n        buttonSize: isMobile ? '12px' : '14px',\r\n        lineHeight: isMobile ? '1.2' : '1.4'\r\n    };\r\n}\r\n\r\n/**\r\n * Determine initial date state for a task\r\n * Used to track if dates were ever set (for mobile field persistence)\r\n * @param {Object} task - Task object\r\n * @returns {Object} Initial date state\r\n */\r\nexport function getInitialDateState(task) {\r\n    const hasStartDate = typeof task?.startDate === 'string' && task.startDate.trim() !== '';\r\n    const hasEndDate = typeof task?.endDate === 'string' && task.endDate.trim() !== '';\r\n\r\n    return {\r\n        startDateWasEverSet: !!task?.startDateWasEverSet || hasStartDate,\r\n        endDateWasEverSet: !!task?.endDateWasEverSet || hasEndDate\r\n    };\r\n}\r\n\r\n/**\r\n * Calculate task navigation context info\r\n * @param {Object} navigationContext - Navigation context object\r\n * @param {number} currentTaskId - Current task ID\r\n * @returns {Object} Navigation info with prev/next task IDs\r\n */\r\nexport function calculateTaskNavigation(navigationContext, currentTaskId) {\r\n    if (!navigationContext || !navigationContext.taskIds || navigationContext.taskIds.length === 0) {\r\n        return {\r\n            hasPrev: false,\r\n            hasNext: false,\r\n            prevTaskId: null,\r\n            nextTaskId: null,\r\n            currentIndex: -1,\r\n            totalTasks: 0\r\n        };\r\n    }\r\n\r\n    const { taskIds } = navigationContext;\r\n    const currentIndex = taskIds.indexOf(currentTaskId);\r\n\r\n    if (currentIndex === -1) {\r\n        return {\r\n            hasPrev: false,\r\n            hasNext: false,\r\n            prevTaskId: null,\r\n            nextTaskId: null,\r\n            currentIndex: -1,\r\n            totalTasks: taskIds.length\r\n        };\r\n    }\r\n\r\n    return {\r\n        hasPrev: currentIndex > 0,\r\n        hasNext: currentIndex < taskIds.length - 1,\r\n        prevTaskId: currentIndex > 0 ? taskIds[currentIndex - 1] : null,\r\n        nextTaskId: currentIndex < taskIds.length - 1 ? taskIds[currentIndex + 1] : null,\r\n        currentIndex,\r\n        totalTasks: taskIds.length\r\n    };\r\n}\r\n", "/**\r\n * Event delegation system\r\n *\r\n * Centralized click handler for all data-action elements.\r\n *\r\n * @module core/events\r\n */\r\n\r\nexport function setupEventDelegation(deps) {\r\n    document.addEventListener('click', (event) => {\r\n        const target = event.target.closest('[data-action]');\r\n        if (!target) return;\r\n\r\n        const action = target.dataset.action;\r\n        const param = target.dataset.param;\r\n        const param2 = target.dataset.param2;\r\n\r\n        // Action map - all functions that were previously in onclick handlers\r\n        const actions = {\r\n            // Theme & UI\r\n            'toggleTheme': () => deps.toggleTheme(),\r\n            'showCalendarView': () => deps.showCalendarView(),\r\n            'toggleKanbanSettings': () => deps.toggleKanbanSettings(event),\r\n\r\n            // Modals\r\n            'openProjectModal': () => deps.openProjectModal(),\r\n            'openTaskModal': () => deps.openTaskModal(),\r\n            'openSettingsModal': () => { deps.closeUserDropdown(); deps.openSettingsModal(); },\r\n            'openTaskModalForProject': () => deps.openTaskModalForProject(parseInt(param)),\r\n            'openSelectedProjectFromTask': () => deps.openSelectedProjectFromTask(),\r\n            'closeModal': () => deps.closeModal(param),\r\n            'closeTaskModal': () => deps.closeTaskModal(),\r\n            'closeConfirmModal': () => deps.closeConfirmModal(),\r\n            'closeFeedbackDeleteModal': () => deps.closeFeedbackDeleteModal(),\r\n            'closeProjectConfirmModal': () => deps.closeProjectConfirmModal(),\r\n            'closeUnsavedChangesModal': () => deps.closeUnsavedChangesModal(),\r\n            'closeDayItemsModal': () => deps.closeDayItemsModal(),\r\n            'closeDayItemsModalOnBackdrop': () => deps.closeDayItemsModalOnBackdrop(event),\r\n            'openDeleteAccountModal': () => deps.openDeleteAccountModal(),\r\n            'closeDeleteAccountModal': () => deps.closeDeleteAccountModal(),\r\n            'confirmDeleteAccount': () => deps.confirmDeleteAccount(),\r\n\r\n            // Task operations\r\n            'openTaskDetails': () => {\r\n                if (target.dataset.stopPropagation) event.stopPropagation();\r\n                const taskId = parseInt(param);\r\n\r\n                // Check if we're opening from project details page\r\n                const projectTasksList = target.closest('#project-tasks-list');\r\n                if (projectTasksList) {\r\n                    // We're in project details - build navigation context\r\n                    const projectDetailsPage = document.getElementById('project-details');\r\n                    if (projectDetailsPage && projectDetailsPage.classList.contains('active')) {\r\n                        // Get all task items in order\r\n                        const taskItems = Array.from(projectTasksList.querySelectorAll('.project-task-item[data-param]'));\r\n                        const taskIds = taskItems.map(item => parseInt(item.dataset.param));\r\n                        const currentIndex = taskIds.indexOf(taskId);\r\n\r\n                        if (currentIndex !== -1 && taskIds.length > 1) {\r\n                            // Find project ID from URL\r\n                            const hash = window.location.hash;\r\n                            const projectIdMatch = hash.match(/project-(\\d+)/);\r\n                            const projectId = projectIdMatch ? parseInt(projectIdMatch[1]) : null;\r\n\r\n                            const navContext = {\r\n                                projectId,\r\n                                taskIds,\r\n                                currentIndex\r\n                            };\r\n                            deps.openTaskDetails(taskId, navContext);\r\n                            return;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Check if we're opening from expanded project card on Projects page\r\n                const expandedTaskItem = target.closest('.expanded-task-item');\r\n                if (expandedTaskItem) {\r\n                    // Try mobile structure first (.project-card-mobile)\r\n                    let projectCard = expandedTaskItem.closest('.project-card-mobile');\r\n                    let projectId = null;\r\n\r\n                    if (projectCard) {\r\n                        projectId = parseInt(projectCard.dataset.projectId);\r\n                    } else {\r\n                        // Try desktop structure (.project-list-item)\r\n                        const projectListItem = expandedTaskItem.closest('.project-list-item');\r\n                        if (projectListItem && projectListItem.id) {\r\n                            // Extract project ID from id=\"project-item-123\"\r\n                            const match = projectListItem.id.match(/project-item-(\\d+)/);\r\n                            if (match) {\r\n                                projectId = parseInt(match[1]);\r\n                            }\r\n                        }\r\n                    }\r\n\r\n                    if (projectId) {\r\n                        // Get all task items in this expanded project in order\r\n                        const taskContainer = expandedTaskItem.closest('.expanded-tasks-container');\r\n                        if (taskContainer) {\r\n                            const taskItems = Array.from(taskContainer.querySelectorAll('.expanded-task-item[data-param]'));\r\n                            const taskIds = taskItems.map(item => parseInt(item.dataset.param));\r\n                            const currentIndex = taskIds.indexOf(taskId);\r\n\r\n                            if (currentIndex !== -1 && taskIds.length > 1) {\r\n                                const navContext = {\r\n                                    projectId,\r\n                                    taskIds,\r\n                                    currentIndex\r\n                                };\r\n                                deps.openTaskDetails(taskId, navContext);\r\n                                return;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Default: open without navigation context\r\n                deps.openTaskDetails(taskId);\r\n            },\r\n            'deleteTask': () => deps.deleteTask(),\r\n            'duplicateTask': () => deps.duplicateTask(),\r\n            'confirmDelete': () => deps.confirmDelete(),\r\n\r\n            // Project operations\r\n            'showProjectDetails': () => {\r\n                if (target.dataset.stopPropagation) event.stopPropagation();\r\n                const isDashboard = document.getElementById('dashboard').classList.contains('active');\r\n                const referrer = isDashboard ? 'dashboard' : 'projects';\r\n                deps.showProjectDetails(parseInt(param), referrer);\r\n            },\r\n            'toggleProjectExpand': () => deps.toggleProjectExpand(parseInt(param)),\r\n            'toggleProjectMenu': () => deps.toggleProjectMenu(event),\r\n            'editProjectTitle': () => deps.editProjectTitle(parseInt(param), param2),\r\n            'saveProjectTitle': () => deps.saveProjectTitle(parseInt(param)),\r\n            'cancelProjectTitle': () => deps.cancelProjectTitle(),\r\n            'handleDeleteProject': () => deps.handleDeleteProject(parseInt(param)),\r\n            'handleDuplicateProject': () => deps.handleDuplicateProject(parseInt(param)),\r\n            'toggleProjectColorPicker': () => deps.toggleProjectColorPicker(parseInt(param)),\r\n            'updateProjectColor': () => deps.updateProjectColor(parseInt(param), param2),\r\n            'openCustomProjectColorPicker': () => deps.openCustomProjectColorPicker(parseInt(param)),\r\n            'navigateToProjectStatus': () => deps.navigateToProjectStatus(parseInt(param), param2),\r\n            'deleteProject': () => deps.deleteProject(),\r\n            'confirmProjectDelete': () => deps.confirmProjectDelete(),\r\n            'closeDuplicateProjectModal': () => deps.closeDuplicateProjectModal(),\r\n            'confirmDuplicateProject': () => deps.confirmDuplicateProject(),\r\n\r\n            // Feedback operations\r\n            'addFeedbackItem': () => deps.addFeedbackItem(),\r\n            'deleteFeedbackItem': () => deps.deleteFeedbackItem(parseInt(param)),\r\n            'confirmFeedbackDelete': () => deps.confirmFeedbackDelete(),\r\n\r\n            // History operations\r\n            'toggleHistoryEntryInline': () => deps.toggleHistoryEntryInline(parseInt(param)),\r\n\r\n            // Formatting\r\n            'formatTaskText': () => deps.formatTaskText(param),\r\n            'insertTaskHeading': () => deps.insertTaskHeading(param),\r\n            'insertTaskDivider': () => deps.insertTaskDivider(),\r\n\r\n            // Sorting & filtering\r\n            'sortTable': () => deps.sortTable(param),\r\n            'toggleSortMode': () => deps.toggleSortMode(),\r\n\r\n            // Calendar\r\n            'changeMonth': () => deps.animateCalendarMonthChange(parseInt(param)),\r\n            'goToToday': () => deps.goToToday(),\r\n            'showDayTasks': () => deps.showDayTasks(param),\r\n\r\n            // Attachments & tags\r\n            'addAttachment': () => deps.addAttachment(),\r\n            'addFileAttachment': () => deps.addFileAttachment(event),\r\n            'addTag': () => deps.addTag(),\r\n            'removeTag': () => deps.removeTag(param),\r\n            'addProjectTag': () => deps.addProjectTag(),\r\n            'removeProjectTag': () => deps.removeProjectTag(param),\r\n            'addProjectDetailsTag': () => deps.addProjectDetailsTag(param),\r\n            'removeProjectDetailsTag': () => deps.removeProjectDetailsTag(param),\r\n            'removeAttachment': () => { deps.removeAttachment(parseInt(param)); event.preventDefault(); },\r\n            'openUrlAttachment': () => {\r\n                if (!param) return;\r\n                try {\r\n                    const href = decodeURIComponent(param);\r\n                    window.open(href, '_blank', 'noopener,noreferrer');\r\n                } catch (e) {\r\n                    console.error('Failed to open URL attachment:', e);\r\n                }\r\n            },\r\n            'downloadFileAttachment': () => deps.downloadFileAttachment(param, param2, target.dataset.param3),\r\n            'viewFile': () => deps.viewFile(param, param2, target.dataset.param3),\r\n            'viewImageLegacy': () => deps.viewImageLegacy(param, param2),\r\n            'viewFeedbackScreenshot': () => {\r\n                if (!param) return;\r\n                try {\r\n                    const decoded = decodeURIComponent(param);\r\n                    const src = decoded;\r\n                    const title = 'Feedback Screenshot';\r\n                    deps.viewImageLegacy(src, title);\r\n                } catch (e) {\r\n                    console.error('Failed to open feedback screenshot', e);\r\n                    deps.showErrorNotification && deps.showErrorNotification(deps.t('error.openScreenshotFailed'));\r\n                }\r\n            },\r\n\r\n            // Navigation\r\n            'backToProjects': () => deps.backToProjects(),\r\n            'showAllActivity': () => deps.showAllActivity(),\r\n            'backToDashboard': () => deps.backToDashboard(),\r\n            'backToCalendar': () => deps.backToCalendar(),\r\n            'openUpdatesFromNotification': () => deps.openUpdatesFromNotification(),\r\n            'openDueTodayFromNotification': () => deps.openDueTodayFromNotification(),\r\n\r\n            // Other\r\n            'dismissKanbanTip': () => deps.dismissKanbanTip(),\r\n            'confirmDiscardChanges': () => deps.confirmDiscardChanges(),\r\n            'closeReviewStatusConfirmModal': () => deps.closeReviewStatusConfirmModal(),\r\n            'confirmDisableReviewStatus': () => deps.confirmDisableReviewStatus(),\r\n            'closeCalendarCreateModal': () => deps.closeCalendarCreateModal(),\r\n            'confirmCreateTask': () => deps.confirmCreateTask(),\r\n            'addTaskFromDayItemsModal': () => deps.addTaskFromDayItemsModal(),\r\n            'signOut': () => deps.signOut(),\r\n            'exportDashboardData': () => deps.exportDashboardData(),\r\n            'closeExportDataModal': () => deps.closeExportDataModal(),\r\n            'confirmExportData': () => deps.confirmExportData(),\r\n            'openImportDataModal': () => deps.openImportDataModal(),\r\n            'closeImportDataModal': () => deps.closeImportDataModal(),\r\n            'confirmImportData': () => deps.confirmImportData(),\r\n            'generateReport': () => deps.generateReport(),\r\n            'showStatusInfoModal': () => {\r\n                event.stopPropagation();\r\n                deps.showStatusInfoModal();\r\n            },\r\n\r\n            // Special case: stopPropagation\r\n            'stopPropagation': () => event.stopPropagation(),\r\n\r\n            // Special case: close modal only if backdrop is clicked\r\n            'closeModalOnBackdrop': () => {\r\n                // target is the element with data-action (the modal backdrop)\r\n                // event.target is the actual clicked element\r\n                if (event.target === target) {\r\n                    deps.closeModal(param);\r\n                }\r\n            },\r\n\r\n            // Combined actions\r\n            'closeDayItemsAndOpenTask': () => {\r\n                deps.closeDayItemsModal();\r\n                deps.openTaskDetails(parseInt(param));\r\n            },\r\n            'closeDayItemsAndShowProject': () => {\r\n                deps.closeDayItemsModal();\r\n                deps.showProjectDetails(parseInt(param), 'calendar', {\r\n                    month: deps.getCurrentMonth(),\r\n                    year: deps.getCurrentYear()\r\n                });\r\n            },\r\n            'deleteFeedbackItemWithStop': () => {\r\n                deps.deleteFeedbackItem(parseInt(param));\r\n                event.stopPropagation();\r\n            },\r\n        };\r\n\r\n        // Execute the action if it exists\r\n        if (actions[action]) {\r\n            actions[action]();\r\n        } else {\r\n            console.warn(`No handler found for action: ${action}`);\r\n        }\r\n    });\r\n}\r\n", "/**\r\n * Core application state container.\r\n * Transitional module to centralize mutable globals while refactoring.\r\n */\r\n\r\nexport const appState = {\r\n    projects: null,\r\n    tasks: null,\r\n    feedbackItems: null,\r\n    feedbackIndex: null,\r\n    projectCounter: null,\r\n    taskCounter: null,\r\n    feedbackCounter: null,\r\n    projectsSortedView: null,\r\n    selectedCards: null,\r\n    lastSelectedCardId: null,\r\n    projectToDelete: null,\r\n    tempAttachments: null,\r\n    projectNavigationReferrer: null,\r\n    calendarNavigationState: null,\r\n    previousPage: null,\r\n    currentFeedbackScreenshotData: null,\r\n    feedbackPendingPage: null,\r\n    feedbackDonePage: null,\r\n    settings: null\r\n};\r\n\r\n// For now appState is a shared container; accessors are defined in app.js\r\n", "// Performance: Track when app.js starts parsing\r\nconst APP_JS_PARSE_START = typeof performance !== 'undefined' ? performance.now() : Date.now();\r\nconst PERF_MARKS_SEEN = new Set();\r\nif (typeof performance !== 'undefined' && typeof performance.mark === 'function') {\r\n    performance.mark('app_start');\r\n    PERF_MARKS_SEEN.add('app_start');\r\n}\r\n\r\nlet isMobileCache = null;\r\nlet isMobileCacheRaf = 0;\r\nfunction computeIsMobile() {\r\n    if (typeof window.matchMedia === 'function') {\r\n        return window.matchMedia('(max-width: 768px)').matches || window.matchMedia('(pointer: coarse)').matches;\r\n    }\r\n    return window.innerWidth <= 768;\r\n}\r\n\r\nfunction getIsMobileCached() {\r\n    if (isMobileCache === null) {\r\n        isMobileCache = computeIsMobile();\r\n        if (!isMobileCacheRaf && typeof requestAnimationFrame === 'function') {\r\n            isMobileCacheRaf = requestAnimationFrame(() => {\r\n                isMobileCache = null;\r\n                isMobileCacheRaf = 0;\r\n            });\r\n        }\r\n    }\r\n    return isMobileCache;\r\n}\r\n\r\nconst APP_VERSION = '2.7.1';\r\nconst APP_VERSION_LABEL = `v${APP_VERSION}`;\r\n\r\n// Bridge appState getters/setters to current module-scope state.\r\nfunction bindAppState() {\r\n    const bindings = {\r\n        projects: () => projects,\r\n        tasks: () => tasks,\r\n        feedbackItems: () => feedbackItems,\r\n        projectCounter: () => projectCounter,\r\n        taskCounter: () => taskCounter,\r\n        feedbackCounter: () => feedbackCounter,\r\n        projectsSortedView: () => projectsSortedView,\r\n        selectedCards: () => selectedCards,\r\n        lastSelectedCardId: () => lastSelectedCardId,\r\n        projectToDelete: () => projectToDelete,\r\n        tempAttachments: () => tempAttachments,\r\n        projectNavigationReferrer: () => projectNavigationReferrer,\r\n        calendarNavigationState: () => calendarNavigationState,\r\n        previousPage: () => previousPage,\r\n        currentFeedbackScreenshotData: () => currentFeedbackScreenshotData,\r\n        feedbackPendingPage: () => feedbackPendingPage,\r\n        feedbackDonePage: () => feedbackDonePage,\r\n        settings: () => settings\r\n    };\r\n\r\n    Object.entries(bindings).forEach(([key, getter]) => {\r\n        Object.defineProperty(appState, key, {\r\n            get: getter,\r\n            set: (val) => {\r\n                switch (key) {\r\n                    case 'projects': projects = val; break;\r\n                    case 'tasks': tasks = val; break;\r\n                    case 'feedbackItems': feedbackItems = val; break;\r\n                    case 'feedbackIndex': feedbackIndex = val; break;\r\n                    case 'projectCounter': projectCounter = val; break;\r\n                    case 'taskCounter': taskCounter = val; break;\r\n                    case 'feedbackCounter': feedbackCounter = val; break;\r\n                    case 'projectsSortedView': projectsSortedView = val; break;\r\n                    case 'selectedCards': selectedCards = val; break;\r\n                    case 'lastSelectedCardId': lastSelectedCardId = val; break;\r\n                    case 'projectToDelete': projectToDelete = val; break;\r\n                    case 'tempAttachments': tempAttachments = val; break;\r\n                    case 'projectNavigationReferrer': projectNavigationReferrer = val; break;\r\n                    case 'calendarNavigationState': calendarNavigationState = val; break;\r\n                    case 'previousPage': previousPage = val; break;\r\n                    case 'currentFeedbackScreenshotData': currentFeedbackScreenshotData = val; break;\r\n                    case 'feedbackPendingPage': feedbackPendingPage = val; break;\r\n                    case 'feedbackDonePage': feedbackDonePage = val; break;\r\n                    case 'settings': settings = val; break;\r\n                }\r\n            },\r\n            configurable: true,\r\n            enumerable: true\r\n        });\r\n    });\r\n}\r\nbindAppState();\r\n\r\nfunction clearSelectedCards() {\r\n    appState.selectedCards.clear();\r\n    appState.lastSelectedCardId = null;\r\n    document.querySelectorAll(\".task-card.selected\").forEach((card) => {\r\n        card.classList.remove(\"selected\");\r\n    });\r\n}\r\n\r\n// settings now bound via appState.settings\r\n\r\n// Debug utilities imported from src/utils/debug.js\r\n\r\nconst SUPPORTED_LANGUAGES = ['en', 'es'];\r\n\r\n// I18N translations loaded from separate module for better code splitting\r\nimport { I18N_LOCALES, I18N } from './src/config/i18n.js';\r\n\r\n// Note: I18N block moved to src/config/i18n.js (1314 lines extracted)\r\n// This reduces app.js parsing time significantly\r\n\r\nfunction normalizeLanguage(value) {\r\n    return SUPPORTED_LANGUAGES.includes(value) ? value : 'en';\r\n}\r\n\r\nfunction getCurrentLanguage() {\r\n    return normalizeLanguage(settings.language || 'en');\r\n}\r\n\r\nfunction getLocale() {\r\n    const lang = getCurrentLanguage();\r\n    return I18N_LOCALES[lang] || I18N_LOCALES.en;\r\n}\r\n\r\nfunction t(key, vars) {\r\n    const lang = getCurrentLanguage();\r\n    const dict = I18N[lang] || I18N.en;\r\n    let text = dict[key] || I18N.en[key] || key;\r\n    if (!vars) return text;\r\n    return text.replace(/\\{(\\w+)\\}/g, (match, name) => {\r\n        if (Object.prototype.hasOwnProperty.call(vars, name)) {\r\n            return String(vars[name]);\r\n        }\r\n        return match;\r\n    });\r\n}\r\n\r\nfunction applyTranslations(root = document) {\r\n    const elements = root.querySelectorAll('[data-i18n]');\r\n    elements.forEach((el) => {\r\n        const key = el.getAttribute('data-i18n');\r\n        if (!key) return;\r\n        const attr = el.getAttribute('data-i18n-attr');\r\n        if (attr) {\r\n            attr.split(',').map((name) => name.trim()).filter(Boolean).forEach((name) => {\r\n                el.setAttribute(name, t(key));\r\n            });\r\n        } else {\r\n            el.textContent = t(key);\r\n        }\r\n    });\r\n}\r\n\r\nwindow.i18n = {\r\n    t,\r\n    applyTranslations,\r\n    getCurrentLanguage\r\n};\r\n\r\nfunction getStatusLabel(status) {\r\n    const map = {\r\n        backlog: t('tasks.status.backlog'),\r\n        todo: t('tasks.status.todo'),\r\n        progress: t('tasks.status.progress'),\r\n        review: t('tasks.status.review'),\r\n        done: t('tasks.status.done')\r\n    };\r\n    return map[status] || STATUS_LABELS[status] || status || '';\r\n}\r\n\r\nfunction getProjectStatusLabel(status) {\r\n    const map = {\r\n        backlog: t('projects.status.backlog'),\r\n        planning: t('projects.status.planning'),\r\n        active: t('projects.status.active'),\r\n        completed: t('projects.status.completed')\r\n    };\r\n    return map[status] || status || '';\r\n}\r\n\r\nfunction getPriorityLabel(priority) {\r\n    const map = {\r\n        high: t('tasks.priority.high'),\r\n        medium: t('tasks.priority.medium'),\r\n        low: t('tasks.priority.low')\r\n    };\r\n    return map[priority] || getPriorityLabel(priority) || priority || '';\r\n}\r\n\r\nfunction applyLanguage() {\r\n    settings.language = getCurrentLanguage();\r\n    document.documentElement.lang = settings.language;\r\n    applyTranslations();\r\n    updateFeedbackPlaceholderForViewport();\r\n    const timeZoneSelect = document.getElementById('email-notification-timezone');\r\n    const timeZoneValue = document.getElementById('email-notification-timezone-value');\r\n    if (timeZoneSelect && timeZoneValue) {\r\n        timeZoneValue.textContent =\r\n            timeZoneSelect.options?.[timeZoneSelect.selectedIndex]?.textContent ||\r\n            timeZoneSelect.value ||\r\n            '';\r\n    }\r\n    const avatarDropzone = document.getElementById('user-avatar-dropzone');\r\n    if (avatarDropzone) {\r\n        avatarDropzone.dataset.defaultText = t('settings.avatarUploadDefault');\r\n        avatarDropzone.dataset.changeText = t('settings.avatarUploadChange');\r\n    }\r\n    const logoDropzone = document.getElementById('workspace-logo-dropzone');\r\n    if (logoDropzone) {\r\n        logoDropzone.dataset.defaultText = t('settings.logoUploadDefault');\r\n        logoDropzone.dataset.changeText = t('settings.logoUploadChange');\r\n    }\r\n    const taskAttachmentDropzone = document.getElementById('attachment-file-dropzone');\r\n    if (taskAttachmentDropzone) {\r\n        const isMobileScreen = getIsMobileCached();\r\n        const attachmentText = isMobileScreen\r\n            ? t('tasks.modal.attachmentsDropzoneTap')\r\n            : t('tasks.modal.attachmentsDropzoneDefault');\r\n        taskAttachmentDropzone.dataset.defaultText = attachmentText;\r\n        const textEl = taskAttachmentDropzone.querySelector('.task-attachment-dropzone-text');\r\n        if (textEl) textEl.textContent = attachmentText;\r\n    }\r\n    const screenshotInput = document.getElementById('feedback-screenshot-url');\r\n    if (screenshotInput) {\r\n        const isMobileScreen = (typeof window.matchMedia === 'function')\r\n            ? window.matchMedia('(max-width: 768px)').matches\r\n            : getIsMobileCached();\r\n        const screenshotDefaultText = isMobileScreen\r\n        ? t('feedback.screenshotDropzoneTap')\r\n        : t('feedback.screenshotDropzoneDefault');\r\n        screenshotInput.dataset.defaultText = screenshotDefaultText;\r\n        if (!screenshotInput.dataset.hasInlineImage) {\r\n            screenshotInput.textContent = screenshotDefaultText;\r\n        }\r\n    }\r\n    updateThemeMenuText();\r\n    refreshUserAvatarSettingsUI();\r\n    document.dispatchEvent(new CustomEvent('refresh-workspace-logo-ui'));\r\n    updateTrendIndicators();\r\n    try { updateSortUI(); } catch (e) {}\r\n    try { updateProjectsUpdatedFilterUI(); } catch (e) {}\r\n    try { updateKanbanUpdatedFilterUI(); } catch (e) {}\r\n    try { refreshProjectsSortLabel(); } catch (e) {}\r\n    renderProjectProgressBars();\r\n    renderActivityFeed();\r\n    renderUpdatesPage();\r\n    updateNotificationState();\r\n    renderInsights();\r\n    try { refreshFlatpickrLocale(); } catch (e) {}\r\n    const activePeriod = document.querySelector('.filter-chip.active')?.dataset?.period || 'week';\r\n    updateDashboardForPeriod(activePeriod);\r\n    const activityPage = document.getElementById('activity-page');\r\n    if (activityPage && activityPage.classList.contains('active')) {\r\n        renderAllActivity();\r\n    }\r\n    // Refresh active pages to ensure all text updates immediately after language change.\r\n    try {\r\n        if (document.getElementById('projects')?.classList.contains('active')) {\r\n            renderProjects();\r\n        }\r\n        if (document.getElementById('tasks')?.classList.contains('active')) {\r\n            renderTasks();\r\n            if (document.getElementById('list-view')?.classList.contains('active')) {\r\n                renderListView();\r\n            }\r\n        }\r\n        if (document.getElementById('calendar')?.classList.contains('active')) {\r\n            renderCalendar();\r\n        }\r\n        if (document.getElementById('feedback')?.classList.contains('active')) {\r\n            renderFeedback();\r\n            updateFeedbackSaveStatus();\r\n        }\r\n    } catch (e) {}\r\n}\r\n\r\nlet workspaceLogoDraft = {\r\n    hasPendingChange: false,\r\n    dataUrl: null\r\n};\r\n\r\nlet avatarDraft = {\r\n    hasPendingChange: false,\r\n    dataUrl: null\r\n};\r\n\r\n// Workspace logo crop state\r\nlet cropState = {\r\n    originalImage: null,        // Image object\r\n    originalDataUrl: null,      // Original data URL\r\n    canvas: null,               // Canvas element\r\n    ctx: null,                  // Canvas context\r\n    selection: {\r\n        x: 0,\r\n        y: 0,\r\n        size: 0                 // Square size\r\n    },\r\n    isDragging: false,\r\n    isResizing: false,\r\n    dragStartX: 0,\r\n    dragStartY: 0,\r\n    activeHandle: null,\r\n    shape: 'square',            // 'square' | 'circle' (UI + output mask)\r\n    outputMimeType: 'image/jpeg',\r\n    outputMaxSize: null,        // number (px) or null\r\n    onApply: null,\r\n    successMessage: null\r\n};\r\n\r\nlet defaultWorkspaceIconText = null;\r\n\r\nimport {\r\n    loadData,\r\n    saveData,\r\n    saveFeedbackItem,\r\n    saveFeedbackIndex,\r\n    deleteFeedbackItem as deleteFeedbackItemStorage,\r\n    batchFeedbackOperations\r\n} from \"./storage-client.js\";\r\nimport {\r\n    saveAll as saveAllData,\r\n    saveTasks as saveTasksData,\r\n    saveProjects as saveProjectsData,\r\n    saveFeedbackItems as saveFeedbackItemsData,\r\n    saveProjectColors as saveProjectColorsData,\r\n    saveSortState as saveSortStateData,\r\n    loadAll as loadAllData,\r\n    loadSortState as loadSortStateData,\r\n    loadProjectColors as loadProjectColorsData,\r\n    saveSettings as saveSettingsData,\r\n    loadSettings as loadSettingsData\r\n} from \"./src/services/storage.js?v=20260125-cache-first-optimistic\";\r\nimport {\r\n    createTask as createTaskService,\r\n    updateTask as updateTaskService,\r\n    updateTaskField as updateTaskFieldService,\r\n    deleteTask as deleteTaskService,\r\n    duplicateTask as duplicateTaskService,\r\n    validateTask\r\n} from \"./src/services/taskService.js\";\r\nimport {\r\n    createProject as createProjectService,\r\n    updateProject as updateProjectService,\r\n    updateProjectField as updateProjectFieldService,\r\n    deleteProject as deleteProjectService,\r\n    getProjectTasks,\r\n    validateProject\r\n} from \"./src/services/projectService.js\";\r\nimport { escapeHtml, sanitizeInput } from \"./src/utils/html.js\";\r\nimport {\r\n    looksLikeDMY,\r\n    looksLikeISO,\r\n    toISOFromDMY,\r\n    toDMYFromISO,\r\n    formatDate,\r\n    formatDatePretty,\r\n    formatActivityDate\r\n} from \"./src/utils/date.js\";\r\nimport { TAG_COLORS, PROJECT_COLORS, hexToRGBA } from \"./src/utils/colors.js\";\r\nimport {\r\n    VALID_STATUSES,\r\n    VALID_PRIORITIES,\r\n    STATUS_LABELS,\r\n    PRIORITY_LABELS,\r\n    PRIORITY_ORDER,\r\n    STATUS_ORDER,\r\n    PRIORITY_OPTIONS,\r\n    PRIORITY_COLORS\r\n} from \"./src/config/constants.js\";\r\nimport { RELEASE_NOTES } from \"./src/config/release-notes.js\";\r\n// User profile is now managed by auth.js via window.authSystem\r\n// NOTE: generateWordReport is dynamically imported in generateReport() to avoid blocking load\r\nimport {\r\n    applyDebugLogSetting,\r\n    isDebugLogsEnabled,\r\n    logDebug,\r\n    logPerformanceMilestone,\r\n    debugTimeStart,\r\n    debugTimeEnd\r\n} from \"./src/utils/debug.js\";\r\nimport {\r\n    showNotification,\r\n    showErrorNotification,\r\n    showSuccessNotification\r\n} from \"./src/ui/notification.js\";\r\nimport {\r\n    convertFileToBase64,\r\n    uploadFile,\r\n    downloadFile,\r\n    deleteFile\r\n} from \"./src/utils/file.js\";\r\nimport { isValidEmailAddress } from \"./src/utils/validation.js\";\r\nimport { capitalizeFirst } from \"./src/utils/string.js\";\r\nimport {\r\n    getCalendarDayNames,\r\n    formatCalendarMonthYear,\r\n    stripTime\r\n} from \"./src/utils/date.js\";\r\nimport {\r\n    normalizeHHMM,\r\n    snapHHMMToStep,\r\n    hhmmToMinutes,\r\n    minutesToHHMM,\r\n    clampHHMMToRange,\r\n    getKanbanUpdatedCutoffTime,\r\n    getTaskUpdatedTime,\r\n    formatTaskUpdatedDateTime\r\n} from \"./src/utils/time.js\";\r\nimport {\r\n    debounce,\r\n    toggleSet\r\n} from \"./src/utils/functional.js\";\r\nimport {\r\n    filterTasks,\r\n    getTodayISO,\r\n    matchesSearch,\r\n    matchesStatus,\r\n    matchesPriority,\r\n    matchesProject,\r\n    matchesTags,\r\n    matchesAnyDatePreset,\r\n    matchesDateRange\r\n} from \"./src/utils/filterPredicates.js\";\r\nimport {\r\n    calculateDashboardStats,\r\n    calculateTrendIndicators,\r\n    calculateProjectProgress,\r\n    generateActivityFeed,\r\n    generateAllActivity,\r\n    generateInsightsData,\r\n    getRelativeTimeInfo,\r\n    generateProgressBarsHTML,\r\n    generateActivityFeedHTML\r\n} from \"./src/views/dashboard.js\";\r\nimport {\r\n    groupTasksByStatus,\r\n    sortGroupedTasks,\r\n    getStatusCounts,\r\n    prepareKanbanData,\r\n    generateKanbanColumnHTML\r\n} from \"./src/views/kanban.js\";\r\nimport {\r\n    sortTasksByPriorityAndDate,\r\n    sortTasksByColumn,\r\n    calculateSmartDateInfo,\r\n    prepareListViewData,\r\n    generateListViewHTML\r\n} from \"./src/views/listView.js\";\r\nimport {\r\n    calculateCalendarGrid,\r\n    generateCalendarDays,\r\n    formatDateISO,\r\n    countOverlappingProjects,\r\n    getTasksForDate,\r\n    calculateMonthNavigation,\r\n    isCurrentMonth as isCurrentMonthFn,\r\n    prepareCalendarData,\r\n    generateCalendarGridHTML\r\n} from \"./src/views/calendar.js\";\r\nimport {\r\n    calculateProjectTaskStats,\r\n    calculateCompletionPercentage,\r\n    determineProjectStatus,\r\n    sortProjects as sortProjectsFn,\r\n    filterProjectsBySearch,\r\n    filterProjectsByStatus,\r\n    prepareProjectsViewData,\r\n    generateProjectItemHTML as generateProjectItemHTMLModule,\r\n    generateProjectsListHTML\r\n} from \"./src/views/projectsView.js\";\r\nimport {\r\n    calculateMobileFieldPlacement,\r\n    shouldHideDetailsTab,\r\n    generateTagsDisplayHTML,\r\n    getInitialDateState,\r\n    calculateTaskNavigation\r\n} from \"./src/components/taskDetails.js\";\r\nimport { setupEventDelegation } from \"./src/core/events.js\";\r\nimport { appState } from \"./src/core/state.js\";\r\n\r\nconst APP_JS_IMPORTS_READY = typeof performance !== 'undefined' ? performance.now() : Date.now();\r\nconst APP_JS_NAV_START = (typeof window !== 'undefined' && typeof window.__pageLoadStart === 'number')\r\n    ? window.__pageLoadStart\r\n    : APP_JS_PARSE_START;\r\nlogPerformanceMilestone('app-js-executed', {\r\n    sinceNavStartMs: Math.round(APP_JS_IMPORTS_READY - APP_JS_NAV_START)\r\n});\r\n\r\ntry {\r\n    window.addEventListener('resize', debounce(() => { isMobileCache = null; }, 150));\r\n    window.addEventListener('orientationchange', () => { isMobileCache = null; });\r\n} catch (e) {}\r\n\r\nconst PERF_DEBUG_QUERY_KEY = 'debugPerf';\r\nlet perfDebugForced = false;\r\n\r\nfunction isPerfDebugQueryEnabled() {\r\n    try {\r\n        const url = new URL(window.location.href);\r\n        const value = url.searchParams.get(PERF_DEBUG_QUERY_KEY);\r\n        return value === '1' || value === 'true';\r\n    } catch (e) {\r\n        return false;\r\n    }\r\n}\r\n\r\nfunction markPerfOnce(label, meta) {\r\n    if (PERF_MARKS_SEEN.has(label)) return;\r\n    PERF_MARKS_SEEN.add(label);\r\n    if (typeof performance !== 'undefined' && typeof performance.mark === 'function') {\r\n        performance.mark(label);\r\n    }\r\n    logPerformanceMilestone(label, meta);\r\n}\r\n\r\n// ==== CORE STATE BINDINGS ====\r\nlet projects = [];\r\nlet tasks = [];\r\nlet feedbackItems = [];\r\nlet projectCounter = 1;\r\nlet taskCounter = 1;\r\nlet feedbackCounter = 1;\r\nlet projectsSortedView = null;\r\nlet selectedCards = new Set();\r\nlet lastSelectedCardId = null;\r\nlet projectToDelete = null;\r\nlet tempAttachments = [];\r\nlet projectNavigationReferrer = 'projects';\r\nlet calendarNavigationState = null;\r\nlet previousPage = '';\r\nlet currentFeedbackScreenshotData = \"\";\r\nlet feedbackPendingPage = 1;\r\nlet feedbackDonePage = 1;\r\nconst FEEDBACK_ITEMS_PER_PAGE = 10;\r\nconst FEEDBACK_CACHE_KEY = \"feedbackItemsCache:v1\";\r\n// settings defaults\r\nlet settings = {\r\n    autoSetStartDateOnStatusChange: false,\r\n    autoSetEndDateOnStatusChange: false,\r\n    enableReviewStatus: true,\r\n    calendarIncludeBacklog: false,\r\n    debugLogsEnabled: false,\r\n    historySortOrder: 'newest',\r\n    language: 'en',\r\n    customWorkspaceLogo: null,\r\n    notificationEmail: \"\",\r\n    emailNotificationsEnabled: true,\r\n    emailNotificationsWeekdaysOnly: false,\r\n    emailNotificationsIncludeStartDates: false,\r\n    emailNotificationsIncludeBacklog: false,\r\n    emailNotificationTime: \"09:00\",\r\n    emailNotificationTimeZone: (() => {\r\n        // Detect browser timezone and match to available options\r\n        try {\r\n            const browserTz = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n            // Available timezone options in the select\r\n            const availableTimezones = [\r\n                \"America/Argentina/Buenos_Aires\",\r\n                \"Atlantic/Canary\",\r\n                \"Europe/Madrid\",\r\n                \"UTC\"\r\n            ];\r\n            // If browser timezone matches an available option, use it\r\n            if (availableTimezones.includes(browserTz)) {\r\n                return browserTz;\r\n            }\r\n        } catch (e) {\r\n            // Fallback if timezone detection fails\r\n        }\r\n        // Default fallback\r\n        return \"Atlantic/Canary\";\r\n    })()\r\n};\r\n\r\nif (isPerfDebugQueryEnabled()) {\r\n    perfDebugForced = true;\r\n    settings.debugLogsEnabled = true;\r\n    applyDebugLogSetting(true);\r\n}\r\n\r\n// keep appState in sync via accessors (live bindings)\r\n[\r\n    'projects',\r\n    'tasks',\r\n    'feedbackItems',\r\n    'projectCounter',\r\n    'taskCounter',\r\n    'feedbackCounter',\r\n    'projectsSortedView',\r\n    'selectedCards',\r\n    'lastSelectedCardId',\r\n    'projectToDelete',\r\n    'tempAttachments',\r\n    'projectNavigationReferrer',\r\n    'calendarNavigationState',\r\n    'previousPage',\r\n    'currentFeedbackScreenshotData',\r\n    'feedbackPendingPage',\r\n    'feedbackDonePage',\r\n    'settings'\r\n].forEach((key) => {\r\n    Object.defineProperty(appState, key, {\r\n        get: () => {\r\n            // Explicit getters (eval doesn't work with bundling)\r\n            switch (key) {\r\n                case 'projects': return projects;\r\n                case 'tasks': return tasks;\r\n                case 'feedbackItems': return feedbackItems;\r\n                case 'projectCounter': return projectCounter;\r\n                case 'taskCounter': return taskCounter;\r\n                case 'feedbackCounter': return feedbackCounter;\r\n                case 'projectsSortedView': return projectsSortedView;\r\n                case 'selectedCards': return selectedCards;\r\n                case 'lastSelectedCardId': return lastSelectedCardId;\r\n                case 'projectToDelete': return projectToDelete;\r\n                case 'tempAttachments': return tempAttachments;\r\n                case 'projectNavigationReferrer': return projectNavigationReferrer;\r\n                case 'calendarNavigationState': return calendarNavigationState;\r\n                case 'previousPage': return previousPage;\r\n                case 'currentFeedbackScreenshotData': return currentFeedbackScreenshotData;\r\n                case 'feedbackPendingPage': return feedbackPendingPage;\r\n                case 'feedbackDonePage': return feedbackDonePage;\r\n                case 'settings': return settings;\r\n            }\r\n        },\r\n        set: (val) => {\r\n            switch (key) {\r\n                case 'projects': projects = val; break;\r\n                case 'tasks': tasks = val; break;\r\n                case 'feedbackItems': feedbackItems = val; break;\r\n                case 'projectCounter': projectCounter = val; break;\r\n                case 'taskCounter': taskCounter = val; break;\r\n                case 'feedbackCounter': feedbackCounter = val; break;\r\n                case 'projectsSortedView': projectsSortedView = val; break;\r\n                case 'selectedCards': selectedCards = val; break;\r\n                case 'lastSelectedCardId': lastSelectedCardId = val; break;\r\n                case 'projectToDelete': projectToDelete = val; break;\r\n                case 'tempAttachments': tempAttachments = val; break;\r\n                case 'projectNavigationReferrer': projectNavigationReferrer = val; break;\r\n                case 'calendarNavigationState': calendarNavigationState = val; break;\r\n                case 'previousPage': previousPage = val; break;\r\n                case 'currentFeedbackScreenshotData': currentFeedbackScreenshotData = val; break;\r\n                case 'feedbackPendingPage': feedbackPendingPage = val; break;\r\n                case 'feedbackDonePage': feedbackDonePage = val; break;\r\n                case 'settings': settings = val; break;\r\n            }\r\n        },\r\n        configurable: true,\r\n        enumerable: true\r\n    });\r\n});\r\n\r\n// Expose storage functions for historyService\r\nwindow.saveData = saveData;\r\nwindow.loadData = loadData;\r\n\r\n// Guard to avoid persisting to storage while the app is initializing/loading\r\nlet isInitializing = false;\r\n\r\n// Track pending save operations to prevent data loss on page unload\r\n// This counter tracks all async save operations in flight. The beforeunload\r\n// listener warns users if they try to close the tab/browser with pending saves.\r\n// Combined with await on all save calls, this provides two layers of protection:\r\n// 1. await prevents in-app navigation before saves complete\r\n// 2. beforeunload warns user before browser/tab close with pending saves\r\nlet pendingSaves = 0;\r\n\r\n// Notification functions imported from src/ui/notification.js\r\n\r\n// Debounced project field updates (used to ensure fields like description save even if the DOM is removed before blur/change fires)\r\nconst __projectFieldDebounceTimers = new Map();\r\nfunction debouncedUpdateProjectField(projectId, field, value, options) {\r\n    const opts = options || {};\r\n    const delayMs = Number.isFinite(opts.delayMs) ? opts.delayMs : 500;\r\n    const key = `${projectId}:${field}`;\r\n    const existing = __projectFieldDebounceTimers.get(key);\r\n    if (existing) clearTimeout(existing);\r\n    const timer = setTimeout(() => {\r\n        __projectFieldDebounceTimers.delete(key);\r\n        updateProjectField(projectId, field, value, opts);\r\n    }, delayMs);\r\n    __projectFieldDebounceTimers.set(key, timer);\r\n}\r\n\r\nfunction flushDebouncedProjectField(projectId, field, value, options) {\r\n    const key = `${projectId}:${field}`;\r\n    const existing = __projectFieldDebounceTimers.get(key);\r\n    if (existing) {\r\n        clearTimeout(existing);\r\n        __projectFieldDebounceTimers.delete(key);\r\n    }\r\n    updateProjectField(projectId, field, value, options || {});\r\n}\r\n\r\nfunction validateDateRange() {\r\n    // Validation removed - flatpickr constraints prevent invalid date selection\r\n    // No need to validate or disable buttons since users can't pick invalid dates\r\n    return true;\r\n}\r\n\r\nconst RELEASE_SEEN_STORAGE_KEY = 'nautilusLastSeenReleaseId';\r\nconst DUE_TODAY_SEEN_STORAGE_KEY = 'nautilusDueTodaySeen';\r\nconst NOTIFICATION_HISTORY_KEY = 'nautilusNotificationHistory';\r\nconst NOTIFICATION_HISTORY_MAX_DAYS = 30;\r\nconst NOTIFICATION_STATE_CACHE_TTL = 30000;\r\nconst NOTIFICATION_PENDING_SEEN_KEY = 'nautilusNotificationPendingSeen';\r\nconst USE_SERVER_NOTIFICATIONS = true;\r\nlet notificationStateCache = { timestamp: 0, data: null };\r\nlet notificationPendingFlushInFlight = false;\r\n\r\nfunction normalizeReleaseDate(dateStr) {\r\n    if (!dateStr) return 0;\r\n    const normalized = looksLikeDMY(dateStr) ? toISOFromDMY(dateStr) : dateStr;\r\n    const time = Date.parse(normalized);\r\n    return Number.isNaN(time) ? 0 : time;\r\n}\r\n\r\nfunction resolveReleaseText(value) {\r\n    if (!value) return '';\r\n    if (typeof value === 'string') return value;\r\n    if (typeof value === 'object') {\r\n        const locale = getLocale();\r\n        const lang = locale && locale.startsWith('es') ? 'es' : 'en';\r\n        return value[lang] || value.en || value.es || '';\r\n    }\r\n    return String(value);\r\n}\r\n\r\nfunction getSortedReleaseNotes() {\r\n    const list = Array.isArray(RELEASE_NOTES) ? [...RELEASE_NOTES] : [];\r\n    return list.sort((a, b) => normalizeReleaseDate(b.date) - normalizeReleaseDate(a.date));\r\n}\r\n\r\nfunction getLatestReleaseNote() {\r\n    const list = getSortedReleaseNotes();\r\n    return list[0] || null;\r\n}\r\n\r\nfunction getLastSeenReleaseId() {\r\n    try {\r\n        return localStorage.getItem(RELEASE_SEEN_STORAGE_KEY) || '';\r\n    } catch (e) {\r\n        return '';\r\n    }\r\n}\r\n\r\nfunction setLastSeenReleaseId(releaseId) {\r\n    if (!releaseId) return;\r\n    try {\r\n        localStorage.setItem(RELEASE_SEEN_STORAGE_KEY, releaseId);\r\n    } catch (e) {}\r\n}\r\n\r\nfunction formatReleaseDate(dateStr) {\r\n    if (!dateStr) return '';\r\n    return formatDatePretty(dateStr, getLocale());\r\n}\r\n\r\nfunction normalizeISODate(dateStr) {\r\n    if (!dateStr) return '';\r\n    if (looksLikeISO(dateStr)) return dateStr;\r\n    if (looksLikeDMY(dateStr)) return toISOFromDMY(dateStr);\r\n    return '';\r\n}\r\n\r\nfunction getSeenDueToday() {\r\n    try {\r\n        const raw = localStorage.getItem(DUE_TODAY_SEEN_STORAGE_KEY);\r\n        if (!raw) return null;\r\n        const data = JSON.parse(raw);\r\n        const today = new Date().toISOString().split('T')[0];\r\n        if (!data || data.date !== today || !Array.isArray(data.ids)) return null;\r\n        return data;\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction setSeenDueToday(taskIds) {\r\n    try {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        localStorage.setItem(\r\n            DUE_TODAY_SEEN_STORAGE_KEY,\r\n            JSON.stringify({ date: today, ids: taskIds || [] })\r\n        );\r\n    } catch (e) {}\r\n}\r\n\r\nfunction getUnseenDueTodayCount(dueToday) {\r\n    if (!dueToday || dueToday.length === 0) return 0;\r\n    const seen = getSeenDueToday();\r\n    if (!seen) return dueToday.length;\r\n    const seenSet = new Set(seen.ids || []);\r\n    return dueToday.filter((task) => !task || !task.id || !seenSet.has(task.id)).length;\r\n}\r\n\r\nfunction getDueTodayTasks() {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    return tasks.filter((task) => {\r\n        if (!task || task.status === 'done') return false;\r\n        const due = normalizeISODate(task.endDate || '');\r\n        const start = normalizeISODate(task.startDate || '');\r\n        return (due !== '' && due === today) || (start !== '' && start === today);\r\n    });\r\n}\r\n\r\n// ============================================================================\r\n// Notification History System\r\n// ============================================================================\r\n\r\nfunction getNotificationHistory() {\r\n    try {\r\n        const raw = localStorage.getItem(NOTIFICATION_HISTORY_KEY);\r\n        if (!raw) return { notifications: [], lastChecked: null };\r\n        const data = JSON.parse(raw);\r\n        return {\r\n            notifications: Array.isArray(data.notifications) ? data.notifications : [],\r\n            lastChecked: data.lastChecked || null\r\n        };\r\n    } catch (e) {\r\n        return { notifications: [], lastChecked: null };\r\n    }\r\n}\r\n\r\nfunction saveNotificationHistory(history) {\r\n    try {\r\n        localStorage.setItem(NOTIFICATION_HISTORY_KEY, JSON.stringify(history));\r\n    } catch (e) {}\r\n}\r\n\r\nfunction createNotificationId(type, taskId, date) {\r\n    return `notif_${date}_${type}_${taskId}`;\r\n}\r\n\r\nfunction addTaskNotification(taskId, dueDate) {\r\n    const history = getNotificationHistory();\r\n    const notifId = createNotificationId('task_due', taskId, dueDate);\r\n\r\n    // Check if notification already exists\r\n    const exists = history.notifications.some(n => n.id === notifId);\r\n    if (exists) return;\r\n\r\n    const notification = {\r\n        id: notifId,\r\n        type: 'task_due',\r\n        taskId: taskId,\r\n        date: dueDate,\r\n        read: false,\r\n        dismissed: false,\r\n        createdAt: new Date().toISOString()\r\n    };\r\n\r\n    history.notifications.push(notification);\r\n    saveNotificationHistory(history);\r\n}\r\n\r\n// OPTIMIZED: Batch all notification creation to reduce localStorage operations\r\nfunction checkAndCreateDueTodayNotifications() {\r\n    // Safety check: don't run if tasks array is not initialized\r\n    if (!Array.isArray(tasks) || tasks.length === 0) return;\r\n\r\n    const notifyTimer = debugTimeStart(\"notifications\", \"create-due-today\", {\r\n        taskCount: tasks.length\r\n    });\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const history = getNotificationHistory();\r\n\r\n    // Build a Set of existing notification IDs for fast lookup\r\n    const existingIds = new Set(history.notifications.map(n => n.id));\r\n    const newNotifications = [];\r\n\r\n    // Collect tasks starting and due today\r\n    // Check if start date notifications are enabled\r\n    const includeStartDates = settings.emailNotificationsIncludeStartDates !== false;\r\n    const includeBacklog = !!settings.emailNotificationsIncludeBacklog; // Default to false (exclude backlog)\r\n\r\n    tasks.forEach(task => {\r\n        if (!task || task.status === 'done' || !task.id) return;\r\n\r\n        // Skip backlog tasks unless user has enabled them in settings\r\n        if (task.status === 'backlog' && !includeBacklog) return;\r\n\r\n        const start = normalizeISODate(task.startDate || '');\r\n        const due = normalizeISODate(task.endDate || '');\r\n\r\n        // Create start notification if starting today (only if setting is enabled)\r\n        if (includeStartDates && start === today) {\r\n            const notifId = createNotificationId('task_starting', task.id, today);\r\n            if (!existingIds.has(notifId)) {\r\n                newNotifications.push({\r\n                    id: notifId,\r\n                    type: 'task_starting',\r\n                    taskId: task.id,\r\n                    date: today,\r\n                    read: false,\r\n                    dismissed: false,\r\n                    createdAt: new Date().toISOString()\r\n                });\r\n            }\r\n        }\r\n\r\n        // Create due notification if due today\r\n        if (due === today) {\r\n            const notifId = createNotificationId('task_due', task.id, today);\r\n            if (!existingIds.has(notifId)) {\r\n                newNotifications.push({\r\n                    id: notifId,\r\n                    type: 'task_due',\r\n                    taskId: task.id,\r\n                    date: today,\r\n                    read: false,\r\n                    dismissed: false,\r\n                    createdAt: new Date().toISOString()\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n    // CATCH-UP: Collect notifications for tasks in past 7 days\r\n    const pastDays = 7;\r\n    for (let i = 1; i <= pastDays; i++) {\r\n        const pastDate = new Date();\r\n        pastDate.setDate(pastDate.getDate() - i);\r\n        const pastDateStr = pastDate.toISOString().split('T')[0];\r\n\r\n        tasks.forEach(task => {\r\n            if (!task || task.status === 'done' || !task.id) return;\r\n\r\n            const start = normalizeISODate(task.startDate || '');\r\n            const due = normalizeISODate(task.endDate || '');\r\n\r\n            // Create past start notification (only if setting is enabled)\r\n            if (includeStartDates && start === pastDateStr) {\r\n                const notifId = createNotificationId('task_starting', task.id, pastDateStr);\r\n                if (!existingIds.has(notifId)) {\r\n                    newNotifications.push({\r\n                        id: notifId,\r\n                        type: 'task_starting',\r\n                        taskId: task.id,\r\n                        date: pastDateStr,\r\n                        read: false,\r\n                        dismissed: false,\r\n                        createdAt: new Date().toISOString()\r\n                    });\r\n                }\r\n            }\r\n\r\n            // Create past due notification\r\n            if (due === pastDateStr) {\r\n                const notifId = createNotificationId('task_due', task.id, pastDateStr);\r\n                if (!existingIds.has(notifId)) {\r\n                    newNotifications.push({\r\n                        id: notifId,\r\n                        type: 'task_due',\r\n                        taskId: task.id,\r\n                        date: pastDateStr,\r\n                        read: false,\r\n                        dismissed: false,\r\n                        createdAt: new Date().toISOString()\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    // Only write to localStorage if there are new notifications\r\n    if (newNotifications.length > 0) {\r\n        history.notifications.push(...newNotifications);\r\n    }\r\n\r\n    // Update last checked\r\n    history.lastChecked = new Date().toISOString();\r\n\r\n    // Single localStorage write instead of multiple\r\n    saveNotificationHistory(history);\r\n    debugTimeEnd(\"notifications\", notifyTimer, {\r\n        newCount: newNotifications.length,\r\n        totalCount: history.notifications.length\r\n    });\r\n}\r\n\r\nfunction markNotificationRead(notificationId) {\r\n    const history = getNotificationHistory();\r\n    const notif = history.notifications.find(n => n.id === notificationId);\r\n    if (notif) {\r\n        notif.read = true;\r\n        saveNotificationHistory(history);\r\n    }\r\n}\r\n\r\nfunction markAllNotificationsRead() {\r\n    const history = getNotificationHistory();\r\n    history.notifications.forEach(n => {\r\n        if (!n.dismissed) {\r\n            n.read = true;\r\n        }\r\n    });\r\n    saveNotificationHistory(history);\r\n}\r\n\r\nfunction dismissNotification(notificationId) {\r\n    const history = getNotificationHistory();\r\n    const notif = history.notifications.find(n => n.id === notificationId);\r\n    if (notif) {\r\n        notif.dismissed = true;\r\n        saveNotificationHistory(history);\r\n    }\r\n}\r\n\r\nfunction dismissNotificationsByDate(date) {\r\n    const history = getNotificationHistory();\r\n    history.notifications.forEach(n => {\r\n        if (n.date === date) {\r\n            n.dismissed = true;\r\n        }\r\n    });\r\n    saveNotificationHistory(history);\r\n}\r\n\r\nfunction dismissAllNotifications() {\r\n    const history = getNotificationHistory();\r\n    history.notifications.forEach(n => {\r\n        n.dismissed = true;\r\n    });\r\n    saveNotificationHistory(history);\r\n}\r\n\r\nfunction cleanupOldNotifications() {\r\n    const cleanupTimer = debugTimeStart(\"notifications\", \"cleanup\");\r\n    const history = getNotificationHistory();\r\n    const beforeCount = history.notifications.length;\r\n    const cutoffDate = new Date();\r\n    cutoffDate.setDate(cutoffDate.getDate() - NOTIFICATION_HISTORY_MAX_DAYS);\r\n    const cutoffISO = cutoffDate.toISOString().split('T')[0];\r\n\r\n    history.notifications = history.notifications.filter(n => {\r\n        return n.date >= cutoffISO;\r\n    });\r\n\r\n    saveNotificationHistory(history);\r\n    debugTimeEnd(\"notifications\", cleanupTimer, {\r\n        beforeCount,\r\n        afterCount: history.notifications.length\r\n    });\r\n}\r\n\r\nfunction getActiveNotifications() {\r\n    const history = getNotificationHistory();\r\n    return history.notifications.filter(n => !n.dismissed);\r\n}\r\n\r\nfunction getUnreadNotificationCount() {\r\n    const active = getActiveNotifications();\r\n    return active.filter(n => !n.read).length;\r\n}\r\n\r\nfunction getTaskNotificationsByDate() {\r\n    const active = getActiveNotifications();\r\n    const taskNotifs = active.filter(n => n.type === 'task_due' || n.type === 'task_starting');\r\n\r\n    // Group by date\r\n    const grouped = new Map();\r\n    taskNotifs.forEach(notif => {\r\n        if (!grouped.has(notif.date)) {\r\n            grouped.set(notif.date, []);\r\n        }\r\n        grouped.get(notif.date).push(notif);\r\n    });\r\n\r\n    // Sort dates descending (most recent first)\r\n    const sorted = Array.from(grouped.entries()).sort((a, b) => {\r\n        return b[0].localeCompare(a[0]);\r\n    });\r\n\r\n    return sorted;\r\n}\r\n\r\n// ============================================================================\r\n\r\nfunction buildNotificationState() {\r\n    const stateTimer = debugTimeStart(\"notifications\", \"build-state\");\r\n    // Notification creation happens once at app init, not on every state build\r\n    const latest = getLatestReleaseNote();\r\n    const lastSeen = getLastSeenReleaseId();\r\n    // Release notifications are currently hidden from the dropdown, so suppress their badge.\r\n    const releaseUnseen = false;\r\n\r\n    const taskNotificationsByDate = getTaskNotificationsByDate();\r\n    const unreadCount = getUnreadNotificationCount();\r\n\r\n    const state = {\r\n        latest,\r\n        releaseUnseen,\r\n        taskNotificationsByDate,\r\n        unreadCount\r\n    };\r\n    debugTimeEnd(\"notifications\", stateTimer, {\r\n        unreadCount,\r\n        taskGroups: taskNotificationsByDate.length\r\n    });\r\n    return state;\r\n}\r\n\r\nfunction getNotificationAuthToken() {\r\n    return window.authSystem?.getAuthToken?.() || localStorage.getItem('authToken');\r\n}\r\n\r\nfunction loadPendingNotificationSeen() {\r\n    const raw = localStorage.getItem(NOTIFICATION_PENDING_SEEN_KEY);\r\n    if (!raw) return null;\r\n    try {\r\n        const parsed = JSON.parse(raw);\r\n        if (!parsed || !parsed.seenAt) return null;\r\n        return parsed;\r\n    } catch (e) {\r\n        return null;\r\n    }\r\n}\r\n\r\nfunction savePendingNotificationSeen(payload) {\r\n    if (!payload || !payload.seenAt) return;\r\n    localStorage.setItem(NOTIFICATION_PENDING_SEEN_KEY, JSON.stringify(payload));\r\n}\r\n\r\nfunction queueNotificationSeen(seenAt, clearAll = false) {\r\n    const existing = loadPendingNotificationSeen();\r\n    if (!existing) {\r\n        savePendingNotificationSeen({ seenAt, clearAll: !!clearAll });\r\n        return;\r\n    }\r\n    const existingTime = new Date(existing.seenAt).getTime();\r\n    const nextTime = new Date(seenAt).getTime();\r\n    const merged = {\r\n        seenAt: Number.isFinite(existingTime) && Number.isFinite(nextTime) && existingTime > nextTime\r\n            ? existing.seenAt\r\n            : seenAt,\r\n        clearAll: !!(existing.clearAll || clearAll)\r\n    };\r\n    savePendingNotificationSeen(merged);\r\n}\r\n\r\nasync function flushPendingNotificationSeen() {\r\n    if (!USE_SERVER_NOTIFICATIONS || notificationPendingFlushInFlight) return;\r\n    const pending = loadPendingNotificationSeen();\r\n    if (!pending) return;\r\n    const token = getNotificationAuthToken();\r\n    if (!token) return;\r\n\r\n    notificationPendingFlushInFlight = true;\r\n    try {\r\n        const payload = {\r\n            seenAt: pending.seenAt,\r\n            clearAll: !!pending.clearAll\r\n        };\r\n        // Include dismissDate if present\r\n        if (pending.dismissDate) {\r\n            payload.dismissDate = pending.dismissDate;\r\n        }\r\n\r\n        const response = await fetch('/api/notifications/state', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify(payload)\r\n        });\r\n        if (response.ok) {\r\n            localStorage.removeItem(NOTIFICATION_PENDING_SEEN_KEY);\r\n        }\r\n    } catch (error) {\r\n        console.warn('[notifications] failed to flush pending seen', error);\r\n    } finally {\r\n        notificationPendingFlushInFlight = false;\r\n    }\r\n}\r\n\r\nasync function fetchNotificationState({ force = false } = {}) {\r\n    if (USE_SERVER_NOTIFICATIONS) {\r\n        await flushPendingNotificationSeen();\r\n        const now = Date.now();\r\n        if (!force && notificationStateCache.data && (now - notificationStateCache.timestamp) < NOTIFICATION_STATE_CACHE_TTL) {\r\n            return notificationStateCache.data;\r\n        }\r\n\r\n        const token = getNotificationAuthToken();\r\n        if (token) {\r\n            try {\r\n                const response = await fetch('/api/notifications/state', {\r\n                    headers: {\r\n                        'Authorization': `Bearer ${token}`\r\n                    }\r\n                });\r\n                if (response.ok) {\r\n                    const payload = await response.json();\r\n                    const latest = getLatestReleaseNote();\r\n                    const releaseUnseen = false;\r\n                    const state = {\r\n                        latest,\r\n                        releaseUnseen,\r\n                        taskNotificationsByDate: Array.isArray(payload.taskNotificationsByDate) ? payload.taskNotificationsByDate : [],\r\n                        unreadCount: Number(payload.unreadCount) || 0\r\n                    };\r\n                    notificationStateCache = { timestamp: now, data: state };\r\n                    return state;\r\n                }\r\n            } catch (error) {\r\n                console.warn('[notifications] failed to fetch server state', error);\r\n            }\r\n        }\r\n    }\r\n\r\n    return buildNotificationState();\r\n}\r\n\r\nfunction updateNotificationBadge(state = buildNotificationState()) {\r\n    const badge = document.getElementById('notification-count');\r\n    if (!badge) return;\r\n    const releaseCount = state.releaseUnseen && state.latest ? 1 : 0;\r\n    const total = releaseCount + state.unreadCount;\r\n    if (total > 0) {\r\n        badge.textContent = total > 99 ? '99+' : String(total);\r\n        badge.classList.add('is-visible');\r\n    } else {\r\n        badge.textContent = '';\r\n        badge.classList.remove('is-visible');\r\n    }\r\n}\r\n\r\nfunction getRelativeDateLabel(dateStr) {\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const yesterday = new Date();\r\n    yesterday.setDate(yesterday.getDate() - 1);\r\n    const yesterdayStr = yesterday.toISOString().split('T')[0];\r\n\r\n    if (dateStr === today) return t('notifications.today') || 'Today';\r\n    if (dateStr === yesterdayStr) return t('notifications.yesterday') || 'Yesterday';\r\n    return formatDatePretty(dateStr, getLocale());\r\n}\r\n\r\nfunction renderNotificationDropdown(state = buildNotificationState()) {\r\n    const list = document.getElementById('notification-list');\r\n    if (!list) return;\r\n    const renderTimer = debugTimeStart(\"notifications\", \"render-dropdown\", {\r\n        taskGroups: state.taskNotificationsByDate.length,\r\n        unreadCount: state.unreadCount\r\n    });\r\n    const sections = [];\r\n\r\n    // Release notification - HIDDEN FOR NOW, will add in future\r\n    /*\r\n    if (state.releaseUnseen && state.latest) {\r\n        const release = state.latest;\r\n        const titleParts = [];\r\n        if (release.version) titleParts.push(escapeHtml(release.version));\r\n        const releaseTitle = resolveReleaseText(release.title);\r\n        if (releaseTitle) titleParts.push(escapeHtml(releaseTitle));\r\n        const headline = titleParts.join(' - ');\r\n        const dateLabel = t('notifications.releaseMeta', { date: formatReleaseDate(release.date) });\r\n        const summary = release.summary ? escapeHtml(resolveReleaseText(release.summary)) : '';\r\n        sections.push(`\r\n            <div class=\"notify-section notify-section--release\">\r\n                <div class=\"notify-section-heading\">\r\n                    <div class=\"notify-section-title\">${t('notifications.releaseTitle')}</div>\r\n                    <div class=\"notify-section-meta\">${dateLabel}</div>\r\n                </div>\r\n                <div class=\"notify-section-body\">\r\n                    <div class=\"notify-section-release-title\">${headline}</div>\r\n                    ${summary ? `<div class=\"notify-section-release-summary\">${summary}</div>` : ''}\r\n                </div>\r\n                <div class=\"notify-section-actions\">\r\n                    <button type=\"button\" class=\"notify-link\" data-action=\"openUpdatesFromNotification\">${t('notifications.releaseCta')}</button>\r\n                </div>\r\n            </div>\r\n        `);\r\n    }\r\n    */\r\n\r\n    // Task notifications grouped by date\r\n    const projectMap = new Map(projects.map((project) => [project.id, project]));\r\n    const taskMap = new Map(tasks.map((task) => [task.id, task]));\r\n    const includeBacklog = !!settings.emailNotificationsIncludeBacklog;\r\n\r\n    state.taskNotificationsByDate.forEach(([date, notifications]) => {\r\n        const dateLabel = getRelativeDateLabel(date);\r\n\r\n        const startingTasks = notifications\r\n            .filter(notif => notif.type === 'task_starting')\r\n            .map(notif => taskMap.get(notif.taskId))\r\n            .filter(task => task && task.status !== 'done' && (includeBacklog || task.status !== 'backlog'))\r\n            .filter(task => normalizeISODate(task.startDate || '') === date);\r\n\r\n        const dueTasks = notifications\r\n            .filter(notif => notif.type === 'task_due')\r\n            .map(notif => taskMap.get(notif.taskId))\r\n            .filter(task => task && task.status !== 'done' && (includeBacklog || task.status !== 'backlog'))\r\n            .filter(task => normalizeISODate(task.endDate || '') === date);\r\n\r\n        if (startingTasks.length === 0 && dueTasks.length === 0) return; // Skip if all tasks are completed or filtered out\r\n\r\n        // Sort by priority\r\n        const sortTasks = (tasksArr) => [...tasksArr].sort((a, b) => {\r\n            const pa = PRIORITY_ORDER[a.priority || 'low'] || 0;\r\n            const pb = PRIORITY_ORDER[b.priority || 'low'] || 0;\r\n            if (pa !== pb) return pb - pa;\r\n            return String(a.title || '').localeCompare(String(b.title || ''));\r\n        });\r\n\r\n        const sortedStartingTasks = sortTasks(startingTasks);\r\n        const sortedDueTasks = sortTasks(dueTasks);\r\n\r\n        const renderTaskList = (tasksArr) => {\r\n            return tasksArr.slice(0, 3).map((task) => {\r\n                const project = task.projectId ? projectMap.get(task.projectId) : null;\r\n                const projectName = project ? project.name : '';\r\n                const projectColor = project ? getProjectColor(project.id) : '';\r\n                const priorityKey = (task.priority || 'low').toLowerCase();\r\n                const priorityLabel = ['high', 'medium', 'low'].includes(priorityKey)\r\n                    ? getPriorityLabel(priorityKey)\r\n                    : (priorityKey || '');\r\n\r\n                return `\r\n                    <div class=\"notify-task\" data-task-id=\"${task.id}\">\r\n                        <div class=\"notify-task-header\">\r\n                            <div class=\"notify-task-title\">${escapeHtml(task.title || t('tasks.untitled'))}</div>\r\n                            <span class=\"notify-priority notify-priority--${priorityKey}\">${escapeHtml(priorityLabel)}</span>\r\n                        </div>\r\n                    </div>\r\n                `;\r\n            }).join('');\r\n        };\r\n\r\n        let taskListHTML = '';\r\n        let totalCount = 0;\r\n        let totalOverflow = 0;\r\n\r\n        if (sortedStartingTasks.length > 0) {\r\n            const preview = sortedStartingTasks.slice(0, 3);\r\n            const overflow = Math.max(sortedStartingTasks.length - preview.length, 0);\r\n            totalCount += sortedStartingTasks.length;\r\n            totalOverflow += overflow;\r\n            taskListHTML += `<div class=\"notify-section-subheader notify-section-subheader--starting\">\uD83D\uDE80 STARTING <span class=\"notify-section-count notify-section-count--starting\" aria-label=\"${sortedStartingTasks.length} starting tasks\">${sortedStartingTasks.length}</span></div>`;\r\n            taskListHTML += renderTaskList(preview);\r\n            if (overflow > 0) {\r\n                taskListHTML += `<div class=\"notify-task-overflow\">+${overflow} more starting</div>`;\r\n                taskListHTML += `<button type=\"button\" class=\"notify-link notify-link--starting notify-link--full\" data-action=\"openDueTodayFromNotification\" data-date=\"${date}\" data-date-field=\"startDate\">View ${sortedStartingTasks.length} starting</button>`;\r\n            }\r\n        }\r\n\r\n        if (sortedDueTasks.length > 0) {\r\n            const preview = sortedDueTasks.slice(0, 3);\r\n            const overflow = Math.max(sortedDueTasks.length - preview.length, 0);\r\n            totalCount += sortedDueTasks.length;\r\n            totalOverflow += overflow;\r\n            if (sortedStartingTasks.length > 0) {\r\n                taskListHTML += `<div style=\"height: 1px; background: var(--border); margin: 10px 0;\"></div>`;\r\n            }\r\n            taskListHTML += `<div class=\"notify-section-subheader notify-section-subheader--due\">\uD83C\uDFAF DUE <span class=\"notify-section-count notify-section-count--due\" aria-label=\"${sortedDueTasks.length} due tasks\">${sortedDueTasks.length}</span></div>`;\r\n            taskListHTML += renderTaskList(preview);\r\n            if (overflow > 0) {\r\n                taskListHTML += `<div class=\"notify-task-overflow\">+${overflow} more due</div>`;\r\n                taskListHTML += `<button type=\"button\" class=\"notify-link notify-link--due notify-link--full\" data-action=\"openDueTodayFromNotification\" data-date=\"${date}\" data-date-field=\"endDate\">View ${sortedDueTasks.length} due</button>`;\r\n            }\r\n        }\r\n\r\n        const today = new Date().toISOString().split('T')[0];\r\n        const isToday = date === today;\r\n\r\n        sections.push(`\r\n            <div class=\"notify-section notify-section--due\" data-date=\"${date}\">\r\n                <div class=\"notify-section-heading\">\r\n                    <div class=\"notify-section-title\">\r\n                        <span class=\"notify-section-title-text\">${dateLabel}</span>\r\n                        ${!isToday ? `<div class=\"notify-section-title-actions\"><button type=\"button\" class=\"notify-dismiss-btn\" data-action=\"dismissDate\" data-date=\"${date}\" aria-label=\"Dismiss\" title=\"Dismiss\">x</button></div>` : ''}\r\n                    </div>\r\n                </div>\r\n                <div class=\"notify-task-list\">\r\n                    ${taskListHTML}\r\n                </div>\r\n            </div>\r\n        `);\r\n    });\r\n\r\n    if (sections.length === 0) {\r\n        sections.push(`<div class=\"notify-empty\">${t('notifications.empty')}</div>`);\r\n    }\r\n\r\n    list.innerHTML = sections.join('');\r\n    debugTimeEnd(\"notifications\", renderTimer, {\r\n        sections: sections.length,\r\n        taskGroups: state.taskNotificationsByDate.length\r\n    });\r\n}\r\n\r\n// Debounced version to prevent excessive updates\r\nlet updateNotificationStateTimer = null;\r\nfunction updateNotificationState({ force = false } = {}) {\r\n    // Clear any pending update\r\n    if (updateNotificationStateTimer) {\r\n        clearTimeout(updateNotificationStateTimer);\r\n    }\r\n\r\n    // Debounce by 100ms to batch rapid updates\r\n    updateNotificationStateTimer = setTimeout(async () => {\r\n        const state = await fetchNotificationState({ force });\r\n        updateNotificationBadge(state);\r\n        const dropdown = document.getElementById('notification-dropdown');\r\n        if (dropdown && dropdown.classList.contains('active')) {\r\n            renderNotificationDropdown(state);\r\n        }\r\n        updateNotificationStateTimer = null;\r\n    }, 100);\r\n}\r\n\r\n// Immediate version for when you need instant update (e.g., opening dropdown)\r\nasync function updateNotificationStateImmediate({ force = false } = {}) {\r\n    if (updateNotificationStateTimer) {\r\n        clearTimeout(updateNotificationStateTimer);\r\n        updateNotificationStateTimer = null;\r\n    }\r\n    const state = await fetchNotificationState({ force });\r\n    updateNotificationBadge(state);\r\n    const dropdown = document.getElementById('notification-dropdown');\r\n    if (dropdown && dropdown.classList.contains('active')) {\r\n        renderNotificationDropdown(state);\r\n    }\r\n}\r\n\r\nasync function markNotificationsSeen(state = null, { clearAll = false } = {}) {\r\n    if (state && state.latest && state.latest.id) {\r\n        setLastSeenReleaseId(state.latest.id);\r\n    }\r\n    if (USE_SERVER_NOTIFICATIONS) {\r\n        const seenAt = new Date().toISOString();\r\n        const token = getNotificationAuthToken();\r\n        if (!token) {\r\n            queueNotificationSeen(seenAt, clearAll);\r\n            const cached = state || notificationStateCache.data || buildNotificationState();\r\n            const updatedState = {\r\n                ...cached,\r\n                unreadCount: 0\r\n            };\r\n            notificationStateCache = { timestamp: Date.now(), data: updatedState };\r\n            updateNotificationBadge(updatedState);\r\n            return;\r\n        }\r\n        if (token) {\r\n            try {\r\n                const response = await fetch('/api/notifications/state', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': `Bearer ${token}`\r\n                    },\r\n                    body: JSON.stringify({\r\n                        seenAt,\r\n                        clearAll: !!clearAll\r\n                    })\r\n                });\r\n                if (response.ok) {\r\n                    const cached = state || notificationStateCache.data || buildNotificationState();\r\n                    const updatedState = {\r\n                        ...cached,\r\n                        unreadCount: 0\r\n                    };\r\n                    notificationStateCache = { timestamp: Date.now(), data: updatedState };\r\n                    updateNotificationBadge(updatedState);\r\n                    return;\r\n                }\r\n                queueNotificationSeen(seenAt, clearAll);\r\n            } catch (error) {\r\n                console.warn('[notifications] failed to mark seen', error);\r\n                queueNotificationSeen(new Date().toISOString(), clearAll);\r\n            }\r\n        }\r\n    }\r\n\r\n    markAllNotificationsRead();\r\n    const updatedState = buildNotificationState();\r\n    updateNotificationBadge(updatedState);\r\n}\r\n\r\nasync function dismissNotificationByDate(date) {\r\n    if (USE_SERVER_NOTIFICATIONS) {\r\n        const seenAt = new Date().toISOString();\r\n        const token = getNotificationAuthToken();\r\n        if (!token) {\r\n            // Offline mode - store in pending queue\r\n            savePendingNotificationSeen({ seenAt, dismissDate: date });\r\n            // Immediately update UI to hide the dismissed date\r\n            if (notificationStateCache.data && notificationStateCache.data.taskNotificationsByDate) {\r\n                const updatedState = {\r\n                    ...notificationStateCache.data,\r\n                    taskNotificationsByDate: notificationStateCache.data.taskNotificationsByDate.filter(([d]) => d !== date)\r\n                };\r\n                notificationStateCache = { timestamp: Date.now(), data: updatedState };\r\n                updateNotificationBadge(updatedState);\r\n                renderNotificationDropdown(updatedState);\r\n            }\r\n            return;\r\n        }\r\n        try {\r\n            const response = await fetch('/api/notifications/state', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({\r\n                    seenAt,\r\n                    dismissDate: date\r\n                })\r\n            });\r\n            if (response.ok) {\r\n                // Immediately update UI to hide the dismissed date\r\n                if (notificationStateCache.data && notificationStateCache.data.taskNotificationsByDate) {\r\n                    const updatedState = {\r\n                        ...notificationStateCache.data,\r\n                        taskNotificationsByDate: notificationStateCache.data.taskNotificationsByDate.filter(([d]) => d !== date)\r\n                    };\r\n                    notificationStateCache = { timestamp: Date.now(), data: updatedState };\r\n                    updateNotificationBadge(updatedState);\r\n                    renderNotificationDropdown(updatedState);\r\n                }\r\n                return;\r\n            }\r\n            // If failed, queue for later\r\n            savePendingNotificationSeen({ seenAt, dismissDate: date });\r\n        } catch (error) {\r\n            console.warn('[notifications] failed to dismiss date', error);\r\n            savePendingNotificationSeen({ seenAt, dismissDate: date });\r\n        }\r\n    } else {\r\n        // Local storage mode\r\n        dismissNotificationsByDate(date);\r\n        updateNotificationState();\r\n    }\r\n}\r\n\r\nfunction markLatestReleaseSeen() {\r\n    const latest = getLatestReleaseNote();\r\n    if (!latest || !latest.id) return;\r\n    setLastSeenReleaseId(latest.id);\r\n    updateNotificationState();\r\n}\r\n\r\nfunction closeNotificationDropdown() {\r\n    const dropdown = document.getElementById('notification-dropdown');\r\n    const toggle = document.getElementById('notification-toggle');\r\n    if (dropdown) {\r\n        dropdown.classList.remove('active');\r\n    }\r\n    if (toggle) toggle.classList.remove('active');\r\n    setNotificationScrollLock(false);\r\n}\r\n\r\nfunction setNotificationScrollLock(isLocked) {\r\n    const isMobile = (typeof window.matchMedia === 'function')\r\n        ? window.matchMedia('(max-width: 768px)').matches\r\n        : false;\r\n    if (!isMobile) return;\r\n    document.body.classList.toggle('notify-scroll-lock', !!isLocked);\r\n}\r\n\r\nfunction setupNotificationMenu() {\r\n    const toggle = document.getElementById('notification-toggle');\r\n    const dropdown = document.getElementById('notification-dropdown');\r\n    if (!toggle || !dropdown || toggle.dataset.bound) return;\r\n    toggle.dataset.bound = 'true';\r\n\r\n    toggle.addEventListener('click', async (event) => {\r\n        event.stopPropagation();\r\n        const isOpen = dropdown.classList.contains('active');\r\n        if (isOpen) {\r\n            closeNotificationDropdown();\r\n            return;\r\n        }\r\n        closeUserDropdown();\r\n        const state = await fetchNotificationState({ force: true });\r\n        renderNotificationDropdown(state);\r\n        dropdown.classList.add('active');\r\n        toggle.classList.add('active');\r\n        setNotificationScrollLock(true);\r\n        await markNotificationsSeen(state);\r\n    });\r\n\r\n    if (!dropdown.dataset.outsideListener) {\r\n        dropdown.dataset.outsideListener = 'true';\r\n        document.addEventListener('click', (event) => {\r\n            if (!dropdown.classList.contains('active')) return;\r\n            const target = event.target;\r\n            if (!target) return;\r\n            if (dropdown.contains(target) || toggle.contains(target)) return;\r\n            closeNotificationDropdown();\r\n        });\r\n    }\r\n\r\n    // Event delegation for notification actions\r\n    if (!dropdown.dataset.actionListener) {\r\n        dropdown.dataset.actionListener = 'true';\r\n        dropdown.addEventListener('click', async (event) => {\r\n            const target = event.target;\r\n            if (!target) return;\r\n\r\n            // Check if clicking on a task card\r\n            const taskCard = target.closest('.notify-task');\r\n            if (taskCard && taskCard.dataset.taskId) {\r\n                event.preventDefault();\r\n                event.stopPropagation();\r\n                const taskId = parseInt(taskCard.dataset.taskId, 10);\r\n                if (!isNaN(taskId)) {\r\n                    closeNotificationDropdown();\r\n                    openTaskDetails(taskId);\r\n                }\r\n                return;\r\n            }\r\n\r\n            const actionBtn = target.closest('[data-action]');\r\n            if (!actionBtn) return;\r\n\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n\r\n            const action = actionBtn.dataset.action;\r\n            const date = actionBtn.dataset.date;\r\n\r\n            if (action === 'dismissDate' && date) {\r\n                await dismissNotificationByDate(date);\r\n            } else if (action === 'dismissAll') {\r\n                if (USE_SERVER_NOTIFICATIONS) {\r\n                    const currentState = notificationStateCache.data || await fetchNotificationState({ force: true });\r\n                    await markNotificationsSeen(currentState, { clearAll: true });\r\n                    updateNotificationState({ force: true });\r\n                } else {\r\n                    dismissAllNotifications();\r\n                    updateNotificationState();\r\n                }\r\n            } else if (action === 'openUpdatesFromNotification') {\r\n                openUpdatesFromNotification();\r\n            } else if (action === 'openDueTodayFromNotification') {\r\n                if (date) {\r\n                    const dateField = actionBtn.getAttribute('data-date-field') || 'endDate';\r\n                    openDueTodayFromNotification(date, dateField);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    updateNotificationState();\r\n}\r\n\r\nfunction openUpdatesFromNotification() {\r\n    closeNotificationDropdown();\r\n    if (window.location.hash.replace('#', '') === 'updates') {\r\n        showPage('updates');\r\n        return;\r\n    }\r\n    window.location.hash = 'updates';\r\n}\r\n\r\nfunction openDueTodayFromNotification(dateStr, dateField = 'endDate') {\r\n    closeNotificationDropdown();\r\n\r\n    // Check if date is today\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const isToday = dateStr === today;\r\n    const includeBacklog = !!settings.emailNotificationsIncludeBacklog;\r\n    const statusList = includeBacklog\r\n        ? 'backlog,todo,progress,review'\r\n        : 'todo,progress,review';\r\n\r\n    // Use preset filters for today, date range filters for other dates\r\n    let targetHash;\r\n    if (isToday) {\r\n        const preset = dateField === 'startDate' ? 'start-today' : 'end-today';\r\n        targetHash = `#tasks?view=list&datePreset=${preset}&status=${statusList}`;\r\n    } else {\r\n        // For past/future dates, use date range filter\r\n        targetHash = `#tasks?view=list&dateFrom=${dateStr}&dateTo=${dateStr}&dateField=${dateField}&status=${statusList}`;\r\n    }\r\n\r\n    if (window.location.hash === targetHash) {\r\n        showPage('tasks');\r\n        return;\r\n    }\r\n    window.location.hash = targetHash.replace('#', '');\r\n}\r\n\r\n// Kanban sort state: 'priority' (default) or 'manual'\r\nlet sortMode = 'priority'; // 'priority' or 'manual'\r\nlet manualTaskOrder = {}; // { columnName: [taskId, ...] }\r\n\r\n// Toggle between priority/manual sorting\r\nfunction toggleSortMode() {\r\n    // One-way action: enforce priority ordering\r\n    sortMode = 'priority';\r\n    // Clear any manual order so we show true priority ordering\r\n    manualTaskOrder = {};\r\n    const sortBtn = document.getElementById('sort-btn');\r\n    const sortLabel = document.getElementById('sort-label');\r\n    const sortIcon = document.getElementById('sort-icon');\r\n    if (sortBtn) sortBtn.classList.remove('manual');\r\n    if (sortLabel) sortLabel.textContent = t('tasks.sort.orderByPriority');\r\n    if (sortIcon) sortIcon.textContent = '\u2B06\uFE0F';\r\n    renderTasks();\r\n    saveSortPreferences();\r\n}\r\n\r\nasync function saveSortPreferences() {\r\n    try {\r\n        await saveSortStateData(sortMode, manualTaskOrder);\r\n    } catch (e) {\r\n        // Storage client may be unavailable in some environments; fallback to localStorage\r\n        try {\r\n            localStorage.setItem('sortMode', sortMode);\r\n            localStorage.setItem('manualTaskOrder', JSON.stringify(manualTaskOrder));\r\n        } catch (err) {}\r\n    }\r\n}\r\n\r\nasync function loadSortPreferences() {\r\n    try {\r\n        const { sortMode: savedMode, manualTaskOrder: savedOrder } = await loadSortStateData();\r\n        if (savedMode) sortMode = savedMode;\r\n        if (savedOrder) manualTaskOrder = savedOrder;\r\n    } catch (e) {\r\n        try {\r\n            const lm = localStorage.getItem('sortMode');\r\n            const lo = localStorage.getItem('manualTaskOrder');\r\n            if (lm) sortMode = lm;\r\n            if (lo) manualTaskOrder = JSON.parse(lo);\r\n        } catch (err) {}\r\n    }\r\n    // Normalize/guard persisted values (older versions used 'auto' to mean priority ordering)\r\n    if (sortMode === 'auto' || (sortMode !== 'priority' && sortMode !== 'manual')) {\r\n        sortMode = 'priority';\r\n    }\r\n    updateSortUI();\r\n}\r\n\r\nfunction updateSortUI() {\r\n    const sortToggle = document.getElementById('sort-toggle');\r\n    const sortBtn = document.getElementById('sort-btn');\r\n    const sortLabel = document.getElementById('sort-label');\r\n    const sortIcon = document.getElementById('sort-icon');\r\n    const kanbanUpdatedGroup = document.getElementById('group-kanban-updated');\r\n    if (!sortToggle || !sortBtn) return;\r\n    // Show only when Kanban board is visible\r\n    const kanban = document.querySelector('.kanban-board');\r\n    const isKanban = kanban && !kanban.classList.contains('hidden');\r\n    sortToggle.style.display = isKanban ? 'flex' : 'none';\r\n    const isList = document.getElementById('list-view')?.classList.contains('active');\r\n    const isCalendar = document.getElementById('calendar-view')?.classList.contains('active');\r\n    const showUpdated = isKanban || isList || isCalendar;\r\n    if (kanbanUpdatedGroup) kanbanUpdatedGroup.style.display = showUpdated ? '' : 'none';\r\n    try { updateKanbanUpdatedFilterUI(); } catch (e) {}\r\n    // Keep the button as a static one-time action label (Order by Priority).\r\n    // Manual mode may exist internally (via dragging), but the button UI should not change to \"Manual\".\r\n    try { sortBtn.classList.remove('manual'); } catch (e) {}\r\n    if (sortLabel) sortLabel.textContent = t('tasks.sort.orderByPriority');\r\n    if (sortIcon) sortIcon.textContent = '\u21C5';\r\n\r\n    // If the currently visible ordering already matches priority ordering, disable the button\r\n    try {\r\n        // Using imported PRIORITY_ORDER\r\n        const statuses = window.kanbanShowBacklog === true\r\n            ? ['backlog', 'todo', 'progress', 'review', 'done']\r\n            : ['todo', 'progress', 'review', 'done'];\r\n        let filtered = typeof getFilteredTasks === 'function' ? getFilteredTasks() : tasks.slice();\r\n        const cutoff = getKanbanUpdatedCutoffTime(window.kanbanUpdatedFilter);\r\n        if (cutoff !== null) {\r\n            filtered = filtered.filter((t) => getTaskUpdatedTime(t) >= cutoff);\r\n        }\r\n\r\n        const arraysEqual = (a, b) => {\r\n            if (a.length !== b.length) return false;\r\n            for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;\r\n            return true;\r\n        };\r\n\r\n        let allMatch = true;\r\n        for (const status of statuses) {\r\n            const visibleNodes = Array.from(document.querySelectorAll(`#${status}-tasks .task-card`));\r\n            const visibleIds = visibleNodes.map(n => parseInt(n.dataset.taskId, 10)).filter(n => !Number.isNaN(n));\r\n\r\n            const expected = filtered\r\n                .filter(t => t.status === status)\r\n                .slice()\r\n                .sort((a, b) => (PRIORITY_ORDER[b.priority] || 0) - (PRIORITY_ORDER[a.priority] || 0))\r\n                .map(t => t.id);\r\n\r\n            if (!arraysEqual(visibleIds, expected)) {\r\n                allMatch = false;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (allMatch) {\r\n            sortBtn.disabled = true;\r\n            sortBtn.classList.add('disabled');\r\n            sortBtn.setAttribute('aria-disabled', 'true');\r\n        } else {\r\n            sortBtn.disabled = false;\r\n            sortBtn.classList.remove('disabled');\r\n            sortBtn.removeAttribute('aria-disabled');\r\n        }\r\n    } catch (e) {\r\n        // If anything goes wrong, keep the button enabled\r\n        sortBtn.disabled = false;\r\n        sortBtn.classList.remove('disabled');\r\n    }\r\n}\r\n\r\n// Add this near the top of app.js after imports\r\n\r\nasync function persistAll() {\r\n    if (isInitializing) return;\r\n    pendingSaves++;\r\n    try {\r\n        await saveAllData(tasks, projects, feedbackItems);\r\n    } catch (error) {\r\n        console.error(\"Error persisting data:\", error);\r\n        showErrorNotification(t('error.saveDataFailed'));\r\n        throw error;\r\n    } finally {\r\n        pendingSaves--;\r\n    }\r\n}\r\n\r\nasync function saveProjects() {\r\n    if (isInitializing) return;\r\n    pendingSaves++;\r\n    const timer = debugTimeStart(\"storage\", \"save-projects\", { projectCount: projects.length });\r\n    let success = false;\r\n    try {\r\n        await saveProjectsData(projects);\r\n        success = true;\r\n    } catch (error) {\r\n        console.error(\"Error saving projects:\", error);\r\n        showErrorNotification(t('error.saveProjectsFailed'));\r\n        throw error;\r\n    } finally {\r\n        debugTimeEnd(\"storage\", timer, { success, projectCount: projects.length });\r\n        pendingSaves--;\r\n    }\r\n}\r\n\r\nasync function saveTasks() {\r\n    if (isInitializing) return;\r\n    pendingSaves++;\r\n    const timer = debugTimeStart(\"storage\", \"save-tasks\", { taskCount: tasks.length });\r\n    let success = false;\r\n    try {\r\n        await saveTasksData(tasks);\r\n        success = true;\r\n    } catch (error) {\r\n        console.error(\"Error saving tasks:\", error);\r\n        showErrorNotification(t('error.saveTasksFailed'));\r\n        throw error;\r\n    } finally {\r\n        debugTimeEnd(\"storage\", timer, { success, taskCount: tasks.length });\r\n        pendingSaves--;\r\n    }\r\n}\r\n\r\nasync function persistFeedbackItemsToStorage() {\r\n    await saveFeedbackItemsData(feedbackItems);\r\n}\r\n\r\n// Simplified feedback save state (Option C: Hybrid Approach)\r\nlet feedbackSaveInProgress = false;\r\nlet feedbackSaveError = false;\r\nlet feedbackShowSavedStatus = false;\r\nlet feedbackSaveStatusHideTimer = null;\r\nconst FEEDBACK_MAX_RETRY_ATTEMPTS = 3;\r\nconst FEEDBACK_RETRY_DELAY_BASE_MS = 1000; // 1s, 2s, 4s\r\n\r\n// Delta queue system removed - using simple direct save (Option C)\r\n\r\nfunction persistFeedbackCache() {\r\n    try {\r\n        localStorage.setItem(FEEDBACK_CACHE_KEY, JSON.stringify(feedbackItems));\r\n    } catch (e) {}\r\n}\r\n\r\n/**\r\n * Save feedback items with retry logic (Option C: Simple direct save)\r\n * Optimistic UI updates happen immediately, save happens in background\r\n */\r\nasync function saveFeedbackWithRetry(attempt = 1) {\r\n    if (feedbackSaveInProgress) return; // Prevent concurrent saves\r\n    if (!navigator.onLine) {\r\n        updateFeedbackSaveStatus();\r\n        return;\r\n    }\r\n\r\n    feedbackSaveInProgress = true;\r\n    pendingSaves++;\r\n    updateFeedbackSaveStatus();\r\n\r\n    try {\r\n        await saveFeedbackItemsData(feedbackItems);\r\n        feedbackSaveError = false;\r\n        markFeedbackSaved();\r\n    } catch (error) {\r\n        console.error('Feedback save error:', error);\r\n        feedbackSaveError = true;\r\n        updateFeedbackSaveStatus();\r\n\r\n        // Retry with exponential backoff\r\n        if (attempt < FEEDBACK_MAX_RETRY_ATTEMPTS) {\r\n            const retryDelay = FEEDBACK_RETRY_DELAY_BASE_MS * Math.pow(2, attempt - 1);\r\n            setTimeout(() => {\r\n                saveFeedbackWithRetry(attempt + 1);\r\n            }, retryDelay);\r\n        } else {\r\n            console.error(`Feedback save failed after ${FEEDBACK_MAX_RETRY_ATTEMPTS} attempts`);\r\n            showErrorNotification(t('error.saveFeedbackFailed'));\r\n        }\r\n    } finally {\r\n        feedbackSaveInProgress = false;\r\n        pendingSaves = Math.max(0, pendingSaves - 1);\r\n        updateFeedbackSaveStatus();\r\n    }\r\n}\r\n\r\nfunction clearFeedbackSaveStatusHideTimer() {\r\n    if (feedbackSaveStatusHideTimer !== null) {\r\n        clearTimeout(feedbackSaveStatusHideTimer);\r\n        feedbackSaveStatusHideTimer = null;\r\n    }\r\n}\r\n\r\nfunction hideFeedbackSaveStatusSoon() {\r\n    clearFeedbackSaveStatusHideTimer();\r\n    feedbackSaveStatusHideTimer = setTimeout(() => {\r\n        const statusEl = document.getElementById('feedback-save-status');\r\n        if (!statusEl) return;\r\n        statusEl.classList.add('is-hidden');\r\n        feedbackShowSavedStatus = false;\r\n        const textEl = statusEl.querySelector('.feedback-save-text');\r\n        if (textEl) textEl.textContent = '';\r\n    }, 1600);\r\n}\r\n\r\nfunction updateFeedbackSaveStatus() {\r\n    const statusEl = document.getElementById('feedback-save-status');\r\n    if (!statusEl) return;\r\n\r\n    const textEl = statusEl.querySelector('.feedback-save-text') || statusEl;\r\n    let status = 'saved';\r\n    if (feedbackSaveInProgress) {\r\n        if (!navigator.onLine) {\r\n            status = 'offline';\r\n        } else {\r\n            status = 'saving';\r\n        }\r\n    } else if (feedbackSaveError) {\r\n        status = 'error';\r\n    }\r\n\r\n    const statusKey = {\r\n        saved: 'feedback.saveStatus.saved',\r\n        saving: 'feedback.saveStatus.saving',\r\n        error: 'feedback.saveStatus.error',\r\n        offline: 'feedback.saveStatus.offline'\r\n    }[status];\r\n\r\n    textEl.textContent = t(statusKey);\r\n    const shouldShow = status !== 'saved' || feedbackShowSavedStatus;\r\n    statusEl.classList.toggle('is-hidden', !shouldShow);\r\n    statusEl.classList.toggle('is-saving', status === 'saving');\r\n    statusEl.classList.toggle('is-error', status === 'error');\r\n    statusEl.classList.toggle('is-offline', status === 'offline');\r\n    statusEl.classList.toggle('is-saved', status === 'saved');\r\n}\r\n\r\nfunction updateFeedbackPlaceholderForViewport() {\r\n    const input = document.getElementById('feedback-description');\r\n    if (!input) return;\r\n    const isCompact = window.matchMedia('(max-width: 768px)').matches;\r\n    const key = isCompact ? 'feedback.descriptionPlaceholderShort' : 'feedback.descriptionPlaceholder';\r\n    input.setAttribute('placeholder', t(key));\r\n}\r\n\r\n// markFeedbackDirty removed - not needed with simple save\r\n\r\nfunction markFeedbackSaved() {\r\n    feedbackSaveError = false;\r\n    feedbackShowSavedStatus = true;\r\n    updateFeedbackSaveStatus();\r\n    hideFeedbackSaveStatusSoon();\r\n}\r\n\r\nfunction markFeedbackSaveError() {\r\n    feedbackSaveError = true;\r\n    clearFeedbackSaveStatusHideTimer();\r\n    updateFeedbackSaveStatus();\r\n}\r\n\r\nfunction queueFeedbackSave(options = {}) {\r\n    const delayMs =\r\n        typeof options === 'number'\r\n            ? options\r\n            : (options.delayMs ? options.delayMs : FEEDBACK_SAVE_DEBOUNCE_MS);\r\n    const onError =\r\n        typeof options === 'object' && typeof options.onError === 'function'\r\n            ? options.onError\r\n            : null;\r\n\r\n    if (isInitializing) return;\r\n    markFeedbackDirty();\r\n\r\n    if (onError) {\r\n        if (feedbackSaveInProgress) {\r\n            feedbackSaveNextErrorHandlers.push(onError);\r\n        } else {\r\n            feedbackSavePendingErrorHandlers.push(onError);\r\n        }\r\n    }\r\n\r\n    // If a save is already queued, it will persist the latest state.\r\n    if (feedbackSaveTimeoutId !== null) return;\r\n\r\n    // If a save is currently running, queue one more pass afterwards.\r\n    if (feedbackSaveInProgress) {\r\n        feedbackSaveNeedsRun = true;\r\n        return;\r\n    }\r\n\r\n    pendingSaves++;\r\n    feedbackSaveTimeoutId = setTimeout(() => {\r\n        feedbackSaveTimeoutId = null;\r\n        flushFeedbackSave();\r\n    }, delayMs);\r\n}\r\n\r\nasync function flushFeedbackSave() {\r\n    if (feedbackSaveInProgress) {\r\n        feedbackSaveNeedsRun = true;\r\n        return;\r\n    }\r\n\r\n    const errorHandlers = feedbackSavePendingErrorHandlers;\r\n    feedbackSavePendingErrorHandlers = [];\r\n\r\n    feedbackSaveInProgress = true;\r\n    try {\r\n        await persistFeedbackItemsToStorage();\r\n        markFeedbackSaved();\r\n    } catch (error) {\r\n        console.error(\"Error saving feedback:\", error);\r\n        markFeedbackSaveError();\r\n        showErrorNotification(t('error.saveFeedbackFailed'));\r\n        for (const handler of errorHandlers) {\r\n            try {\r\n                handler(error);\r\n            } catch (e) {\r\n                console.error('Feedback save error handler failed:', e);\r\n            }\r\n        }\r\n    } finally {\r\n        feedbackSaveInProgress = false;\r\n        pendingSaves = Math.max(0, pendingSaves - 1);\r\n\r\n        if (feedbackSaveNeedsRun) {\r\n            feedbackSaveNeedsRun = false;\r\n            if (feedbackSaveNextErrorHandlers.length > 0) {\r\n                feedbackSavePendingErrorHandlers.push(...feedbackSaveNextErrorHandlers);\r\n                feedbackSaveNextErrorHandlers = [];\r\n            }\r\n            queueFeedbackSave({ delayMs: 200 });\r\n        }\r\n    }\r\n}\r\n\r\nasync function saveFeedback() {\r\n    if (isInitializing) return;\r\n    markFeedbackDirty();\r\n    pendingSaves++;\r\n    try {\r\n        await persistFeedbackItemsToStorage();\r\n        markFeedbackSaved();\r\n    } catch (error) {\r\n        console.error(\"Error saving feedback:\", error);\r\n        markFeedbackSaveError();\r\n        showErrorNotification(t('error.saveFeedbackFailed'));\r\n        throw error;\r\n    } finally {\r\n        pendingSaves--;\r\n    }\r\n}\r\n\r\nasync function saveProjectColors() {\r\n    if (isInitializing) return;\r\n    try {\r\n        await saveProjectColorsData(projectColorMap);\r\n    } catch (error) {\r\n        console.error(\"Error saving project colors:\", error);\r\n        showErrorNotification(t('error.saveProjectColorsFailed'));\r\n    }\r\n}\r\n\r\nasync function loadProjectColors() {\r\n    try {\r\n        projectColorMap = await loadProjectColorsData();\r\n    } catch (error) {\r\n        console.error(\"Error loading project colors:\", error);\r\n        projectColorMap = {};\r\n    }\r\n}\r\n\r\nasync function saveSettings() {\r\n    const timer = debugTimeStart(\"settings\", \"save\");\r\n    let success = false;\r\n    try {\r\n        await saveSettingsData(settings);\r\n        success = true;\r\n    } catch (e) {\r\n        console.error(\"Error saving settings:\", e);\r\n    } finally {\r\n        debugTimeEnd(\"settings\", timer, { success });\r\n    }\r\n\r\n    // Clear dirty state when settings are successfully saved (or attempted)\r\n    window.initialSettingsFormState = null;\r\n    window.settingsFormIsDirty = false;\r\n}\r\n\r\nasync function loadSettings() {\r\n    try {\r\n        const loadedSettings = await loadSettingsData();\r\n        if (loadedSettings && typeof loadedSettings === \"object\") {\r\n            settings = { ...settings, ...loadedSettings };\r\n            settings.language = normalizeLanguage(settings.language);\r\n        }\r\n    } catch (e) {\r\n        console.error(\"Error loading settings:\", e);\r\n    }\r\n    applyDebugLogSetting(settings.debugLogsEnabled);\r\n}\r\n\r\n// Time utilities imported from src/utils/time.js\r\n// isValidEmailAddress imported from src/utils/validation.js\r\n\r\n// ===== Portal-based floating dropdown for notification time =====\r\nlet notificationTimePortalEl = null;\r\nlet notificationTimePortalAnchor = null;\r\nlet notificationTimeZonePortalEl = null;\r\nlet notificationTimeZonePortalAnchor = null;\r\n\r\nfunction buildNotificationTimeOptionsHTML(selectedValue) {\r\n    const start = 8 * 60;\r\n    const end = 18 * 60;\r\n    const step = 30;\r\n    const selected = String(selectedValue || \"\");\r\n    const bits = [];\r\n    for (let minutes = start; minutes <= end; minutes += step) {\r\n        const hhmm = minutesToHHMM(minutes);\r\n        const selectedClass = hhmm === selected ? \" selected\" : \"\";\r\n        bits.push(`<div class=\"time-option${selectedClass}\" role=\"option\" data-value=\"${hhmm}\">${hhmm}</div>`);\r\n    }\r\n    return bits.join(\"\");\r\n}\r\n\r\nfunction buildNotificationTimeZoneOptionsHTML(selectEl) {\r\n    if (!selectEl || !selectEl.options) return \"\";\r\n    const selected = String(selectEl.value || \"\");\r\n    const bits = [];\r\n    Array.from(selectEl.options).forEach((opt) => {\r\n        const value = String(opt.value || \"\");\r\n        const label = String(opt.textContent || value);\r\n        const selectedClass = value === selected ? \" selected\" : \"\";\r\n        bits.push(`<div class=\"tz-option${selectedClass}\" role=\"option\" data-value=\"${escapeHtml(value)}\">${escapeHtml(label)}</div>`);\r\n    });\r\n    return bits.join(\"\");\r\n}\r\n\r\nfunction showNotificationTimeZonePortal(triggerBtn, selectEl, valueEl) {\r\n    if (!triggerBtn || !selectEl) return;\r\n\r\n    if (!notificationTimeZonePortalEl) {\r\n        notificationTimeZonePortalEl = document.createElement(\"div\");\r\n        notificationTimeZonePortalEl.className = \"tz-options-portal\";\r\n        document.body.appendChild(notificationTimeZonePortalEl);\r\n    }\r\n\r\n    notificationTimeZonePortalEl.innerHTML = buildNotificationTimeZoneOptionsHTML(selectEl);\r\n    notificationTimeZonePortalEl.style.display = \"block\";\r\n\r\n    notificationTimeZonePortalAnchor = triggerBtn;\r\n    positionNotificationTimeZonePortal(triggerBtn, notificationTimeZonePortalEl);\r\n    requestAnimationFrame(() => positionNotificationTimeZonePortal(triggerBtn, notificationTimeZonePortalEl));\r\n\r\n    triggerBtn.setAttribute(\"aria-expanded\", \"true\");\r\n\r\n    const onClick = (evt) => {\r\n        evt.stopPropagation();\r\n        const opt = evt.target.closest(\".tz-option\");\r\n        if (!opt) return;\r\n        const value = opt.dataset.value;\r\n        if (!value) return;\r\n        selectEl.value = value;\r\n        if (valueEl) {\r\n            const label = selectEl.options?.[selectEl.selectedIndex]?.textContent || value;\r\n            valueEl.textContent = label;\r\n        }\r\n        selectEl.dispatchEvent(new Event(\"change\", { bubbles: true }));\r\n        hideNotificationTimeZonePortal();\r\n    };\r\n\r\n    notificationTimeZonePortalEl.onclick = onClick;\r\n    setTimeout(() => document.addEventListener(\"click\", handleNotificationTimeZoneOutsideClick, true), 0);\r\n    window.addEventListener(\"scroll\", handleNotificationTimeZoneReposition, true);\r\n    window.addEventListener(\"resize\", handleNotificationTimeZoneReposition, true);\r\n    document.addEventListener(\"keydown\", handleNotificationTimeZoneEsc, true);\r\n}\r\n\r\nfunction hideNotificationTimeZonePortal() {\r\n    if (!notificationTimeZonePortalEl) return;\r\n    notificationTimeZonePortalEl.style.display = \"none\";\r\n    notificationTimeZonePortalEl.innerHTML = \"\";\r\n    notificationTimeZonePortalEl.onclick = null;\r\n    if (notificationTimeZonePortalAnchor) {\r\n        notificationTimeZonePortalAnchor.setAttribute(\"aria-expanded\", \"false\");\r\n    }\r\n    notificationTimeZonePortalAnchor = null;\r\n    document.removeEventListener(\"click\", handleNotificationTimeZoneOutsideClick, true);\r\n    window.removeEventListener(\"scroll\", handleNotificationTimeZoneReposition, true);\r\n    window.removeEventListener(\"resize\", handleNotificationTimeZoneReposition, true);\r\n    document.removeEventListener(\"keydown\", handleNotificationTimeZoneEsc, true);\r\n}\r\n\r\nfunction handleNotificationTimeZoneOutsideClick(evt) {\r\n    const target = evt.target;\r\n    if (!notificationTimeZonePortalEl || notificationTimeZonePortalEl.style.display === \"none\") return;\r\n    if (notificationTimeZonePortalEl.contains(target)) return;\r\n    if (notificationTimeZonePortalAnchor && notificationTimeZonePortalAnchor.contains(target)) return;\r\n    hideNotificationTimeZonePortal();\r\n}\r\n\r\nfunction handleNotificationTimeZoneReposition() {\r\n    if (!notificationTimeZonePortalAnchor || !notificationTimeZonePortalEl || notificationTimeZonePortalEl.style.display === \"none\") return;\r\n    positionNotificationTimeZonePortal(notificationTimeZonePortalAnchor, notificationTimeZonePortalEl);\r\n}\r\n\r\nfunction handleNotificationTimeZoneEsc(evt) {\r\n    if (evt.key !== \"Escape\") return;\r\n    if (!notificationTimeZonePortalEl || notificationTimeZonePortalEl.style.display === \"none\") return;\r\n    evt.preventDefault();\r\n    hideNotificationTimeZonePortal();\r\n}\r\n\r\nfunction positionNotificationTimeZonePortal(button, portal) {\r\n    const rect = button.getBoundingClientRect();\r\n    portal.style.width = `${rect.width}px`;\r\n    const viewportH = window.innerHeight;\r\n    const portalHeight = Math.min(portal.scrollHeight, 240);\r\n    const spaceBelow = viewportH - rect.bottom;\r\n    const showAbove = spaceBelow < portalHeight + 12;\r\n    const top = showAbove ? Math.max(8, rect.top - portalHeight - 4) : rect.bottom + 4;\r\n    const viewportW = window.innerWidth;\r\n    const portalWidth = portal.getBoundingClientRect().width || rect.width;\r\n    const desiredLeft = rect.left;\r\n    const clampedLeft = Math.min(\r\n        Math.max(8, desiredLeft),\r\n        Math.max(8, viewportW - portalWidth - 8)\r\n    );\r\n    portal.style.left = `${clampedLeft}px`;\r\n    portal.style.top = `${top}px`;\r\n}\r\n\r\nfunction showNotificationTimePortal(triggerBtn, hiddenInput, valueEl) {\r\n    if (!triggerBtn || !hiddenInput) return;\r\n\r\n    if (!notificationTimePortalEl) {\r\n        notificationTimePortalEl = document.createElement(\"div\");\r\n        notificationTimePortalEl.className = \"time-options-portal\";\r\n        document.body.appendChild(notificationTimePortalEl);\r\n    }\r\n\r\n    const currentValue = String(hiddenInput.value || \"\").trim();\r\n    notificationTimePortalEl.innerHTML = buildNotificationTimeOptionsHTML(currentValue);\r\n    notificationTimePortalEl.style.display = \"block\";\r\n\r\n    notificationTimePortalAnchor = triggerBtn;\r\n    positionNotificationTimePortal(triggerBtn, notificationTimePortalEl);\r\n    requestAnimationFrame(() => positionNotificationTimePortal(triggerBtn, notificationTimePortalEl));\r\n\r\n    triggerBtn.setAttribute(\"aria-expanded\", \"true\");\r\n\r\n    const onClick = (evt) => {\r\n        evt.stopPropagation();\r\n        const opt = evt.target.closest(\".time-option\");\r\n        if (!opt) return;\r\n        const value = opt.dataset.value;\r\n        if (!value) return;\r\n        hiddenInput.value = value;\r\n        if (valueEl) valueEl.textContent = value;\r\n        if (window.markSettingsDirtyIfNeeded) window.markSettingsDirtyIfNeeded();\r\n        hideNotificationTimePortal();\r\n    };\r\n\r\n    notificationTimePortalEl.addEventListener(\"click\", onClick);\r\n    setTimeout(() => document.addEventListener(\"click\", handleNotificationTimeOutsideClick, true), 0);\r\n    window.addEventListener(\"scroll\", handleNotificationTimeReposition, true);\r\n    window.addEventListener(\"resize\", handleNotificationTimeReposition, true);\r\n    document.addEventListener(\"keydown\", handleNotificationTimeEsc, true);\r\n}\r\n\r\nfunction hideNotificationTimePortal() {\r\n    if (!notificationTimePortalEl) return;\r\n    notificationTimePortalEl.style.display = \"none\";\r\n    notificationTimePortalEl.innerHTML = \"\";\r\n    if (notificationTimePortalAnchor) {\r\n        notificationTimePortalAnchor.setAttribute(\"aria-expanded\", \"false\");\r\n    }\r\n    notificationTimePortalAnchor = null;\r\n    document.removeEventListener(\"click\", handleNotificationTimeOutsideClick, true);\r\n    window.removeEventListener(\"scroll\", handleNotificationTimeReposition, true);\r\n    window.removeEventListener(\"resize\", handleNotificationTimeReposition, true);\r\n    document.removeEventListener(\"keydown\", handleNotificationTimeEsc, true);\r\n}\r\n\r\nfunction handleNotificationTimeOutsideClick(evt) {\r\n    const target = evt.target;\r\n    if (!notificationTimePortalEl || notificationTimePortalEl.style.display === \"none\") return;\r\n    if (notificationTimePortalEl.contains(target)) return;\r\n    if (notificationTimePortalAnchor && notificationTimePortalAnchor.contains(target)) return;\r\n    hideNotificationTimePortal();\r\n}\r\n\r\nfunction handleNotificationTimeReposition() {\r\n    if (!notificationTimePortalAnchor || !notificationTimePortalEl || notificationTimePortalEl.style.display === \"none\") return;\r\n    positionNotificationTimePortal(notificationTimePortalAnchor, notificationTimePortalEl);\r\n}\r\n\r\nfunction handleNotificationTimeEsc(evt) {\r\n    if (evt.key !== \"Escape\") return;\r\n    if (!notificationTimePortalEl || notificationTimePortalEl.style.display === \"none\") return;\r\n    evt.preventDefault();\r\n    hideNotificationTimePortal();\r\n}\r\n\r\nfunction positionNotificationTimePortal(button, portal) {\r\n    const rect = button.getBoundingClientRect();\r\n    portal.style.width = `${rect.width}px`;\r\n    const viewportH = window.innerHeight;\r\n    const portalHeight = Math.min(portal.scrollHeight, 260);\r\n    const spaceBelow = viewportH - rect.bottom;\r\n    const showAbove = spaceBelow < portalHeight + 12;\r\n    const top = showAbove ? Math.max(8, rect.top - portalHeight - 4) : rect.bottom + 4;\r\n    const viewportW = window.innerWidth;\r\n    const portalWidth = portal.getBoundingClientRect().width || rect.width;\r\n    const desiredLeft = rect.left;\r\n    const clampedLeft = Math.min(\r\n        Math.max(8, desiredLeft),\r\n        Math.max(8, viewportW - portalWidth - 8)\r\n    );\r\n    portal.style.left = `${clampedLeft}px`;\r\n    portal.style.top = `${top}px`;\r\n}\r\n\r\nfunction applyWorkspaceLogo() {\r\n    const iconEl = document.querySelector('.workspace-icon');\r\n    if (!iconEl) return;\r\n\r\n    if (defaultWorkspaceIconText === null) {\r\n        defaultWorkspaceIconText = iconEl.textContent || '';\r\n    }\r\n\r\n    if (settings.customWorkspaceLogo) {\r\n        iconEl.style.backgroundImage = `url(${settings.customWorkspaceLogo})`;\r\n        iconEl.textContent = '';\r\n    } else {\r\n        iconEl.style.backgroundImage = '';\r\n        iconEl.textContent = defaultWorkspaceIconText;\r\n    }\r\n}\r\n\r\nfunction applyLoadedAllData({ tasks: loadedTasks, projects: loadedProjects, feedbackItems: loadedFeedback } = {}) {\r\n    projects = loadedProjects || [];\r\n    tasks = loadedTasks || [];\r\n    feedbackItems = loadedFeedback || [];\r\n\r\n    // Normalize IDs to numbers\r\n    projects.forEach(p => {\r\n        if (p && p.id != null) p.id = parseInt(p.id, 10);\r\n        // Migration: Ensure all projects have tags array\r\n        if (!Array.isArray(p.tags)) {\r\n            p.tags = [];\r\n        }\r\n    });\r\n    tasks.forEach(t => {\r\n        if (t) {\r\n            if (t.id != null) t.id = parseInt(t.id, 10);\r\n            if (t.projectId != null && t.projectId !== \"null\") {\r\n                t.projectId = parseInt(t.projectId, 10);\r\n            } else {\r\n                t.projectId = null;\r\n            }\r\n            // Normalize date fields to strings (older versions may have missing fields)\r\n            if (t.startDate === undefined || t.startDate === null) t.startDate = \"\";\r\n            if (t.endDate === undefined || t.endDate === null) t.endDate = \"\";\r\n            if (typeof t.startDate !== \"string\") t.startDate = String(t.startDate || \"\");\r\n            if (typeof t.endDate !== \"string\") t.endDate = String(t.endDate || \"\");\r\n\r\n            // Normalize tags/attachments to arrays\r\n            if (!Array.isArray(t.tags)) {\r\n                if (typeof t.tags === 'string' && t.tags.trim() !== '') {\r\n                    t.tags = t.tags.split(',').map(s => s.trim()).filter(Boolean);\r\n                } else {\r\n                    t.tags = [];\r\n                }\r\n            }\r\n            if (!Array.isArray(t.attachments)) t.attachments = [];\r\n\r\n            // Migration: Track whether dates were ever set (used for mobile modal organization).\r\n            // IMPORTANT: We can't use property-existence because we add missing fields during migration.\r\n            if (t.startDateWasEverSet === undefined) t.startDateWasEverSet = t.startDate.trim() !== \"\";\r\n            if (t.endDateWasEverSet === undefined) t.endDateWasEverSet = t.endDate.trim() !== \"\";\r\n\r\n            // Migration: Convert dueDate to endDate\r\n            if (t.dueDate && !t.endDate) {\r\n                t.endDate = t.dueDate;\r\n                t.endDateWasEverSet = true;\r\n            }\r\n            // Remove dueDate field (no longer used)\r\n            delete t.dueDate;\r\n        }\r\n    });\r\n    feedbackItems.forEach(f => {\r\n        if (f && f.id != null) f.id = parseInt(f.id, 10);\r\n    });\r\n\r\n    // Delta queue removed - using simple direct save\r\n\r\n    persistFeedbackCache();\r\n\r\n    // Calculate counters from existing IDs (no need to store separately)\r\n    if (projects.length > 0) {\r\n        projectCounter = Math.max(...projects.map(p => p.id || 0)) + 1;\r\n    } else {\r\n        projectCounter = 1;\r\n    }\r\n\r\n    if (tasks.length > 0) {\r\n        taskCounter = Math.max(...tasks.map(t => t.id || 0)) + 1;\r\n    } else {\r\n        taskCounter = 1;\r\n    }\r\n\r\n    if (feedbackItems.length > 0) {\r\n        feedbackCounter = Math.max(...feedbackItems.map(f => f.id || 0)) + 1;\r\n    } else {\r\n        feedbackCounter = 1;\r\n    }\r\n}\r\n\r\nasync function loadDataFromKV() {\r\n    // Load fresh data directly (no SWR caching)\r\n    const all = await loadAllData({\r\n        feedback: {\r\n            limitPending: FEEDBACK_ITEMS_PER_PAGE,\r\n            limitDone: FEEDBACK_ITEMS_PER_PAGE,\r\n            cacheKey: FEEDBACK_CACHE_KEY\r\n        }\r\n    });\r\n    applyLoadedAllData(all);\r\n}\r\n\r\n\r\n// Color state management (constants imported from utils/colors.js)\r\nlet tagColorMap = {}; // Maps tag names to colors\r\nlet projectColorMap = {}; // Maps project IDs to custom colors\r\nlet colorIndex = 0; // For cycling through tag colors\r\n\r\nfunction getTagColor(tagName) {\r\n    if (!tagColorMap[tagName]) {\r\n        tagColorMap[tagName] = TAG_COLORS[colorIndex % TAG_COLORS.length];\r\n        colorIndex++;\r\n    }\r\n    return tagColorMap[tagName];\r\n}\r\n\r\nfunction getProjectColor(projectId) {\r\n    if (!projectColorMap[projectId]) {\r\n        const usedColors = new Set(Object.values(projectColorMap));\r\n        const availableColors = PROJECT_COLORS.filter(color => !usedColors.has(color));\r\n        projectColorMap[projectId] = availableColors.length > 0\r\n            ? availableColors[0]\r\n            : PROJECT_COLORS[Object.keys(projectColorMap).length % PROJECT_COLORS.length];\r\n    }\r\n    return projectColorMap[projectId];\r\n}\r\n\r\nfunction setProjectColor(projectId, color) {\r\n    projectColorMap[projectId] = color;\r\n    saveProjectColors();\r\n    // Refresh calendar if it's active\r\n    if (document.getElementById(\"calendar-view\").classList.contains(\"active\")) {\r\n        renderCalendar();\r\n    }\r\n}\r\n\r\nfunction toggleProjectColorPicker(projectId) {\r\n    const picker = document.getElementById(`color-picker-${projectId}`);\r\n    if (picker) {\r\n        const isVisible = picker.style.display !== 'none';\r\n        // Close all other color pickers\r\n        document.querySelectorAll('.color-picker-dropdown').forEach(p => p.style.display = 'none');\r\n        // Toggle this one\r\n        picker.style.display = isVisible ? 'none' : 'block';\r\n    }\r\n}\r\n\r\nfunction updateProjectColor(projectId, color) {\r\n    setProjectColor(projectId, color);\r\n    // Update the current color display\r\n    const currentColorDiv = document.querySelector(`#color-picker-${projectId}`).previousElementSibling;\r\n    if (currentColorDiv) {\r\n        currentColorDiv.style.backgroundColor = color;\r\n    }\r\n    // Update color picker borders\r\n    const picker = document.getElementById(`color-picker-${projectId}`);\r\n    if (picker) {\r\n        picker.querySelectorAll('.color-option').forEach(option => {\r\n            const optionColor = option.style.backgroundColor;\r\n            const rgbColor = optionColor.replace(/rgb\\(|\\)|\\s/g, '').split(',');\r\n            const hexColor = '#' + rgbColor.map(x => parseInt(x, 10).toString(16).padStart(2, '0')).join('');\r\n            option.style.border = hexColor.toUpperCase() === color.toUpperCase() ? '2px solid white' : '2px solid transparent';\r\n        });\r\n\r\n        const customSwatch = picker.querySelector('.custom-color-swatch');\r\n        if (customSwatch) {\r\n            customSwatch.style.border = '2px solid transparent';\r\n        }\r\n    }\r\n\r\n    // Refresh project tags to show new color\r\n    const project = projects.find(p => p.id === projectId);\r\n    if (project && project.tags) {\r\n        renderProjectDetailsTags(project.tags, projectId);\r\n    }\r\n\r\n    // Refresh projects list to update tag colors in cards\r\n    if (document.getElementById('projects')?.classList.contains('active')) {\r\n        appState.projectsSortedView = null;\r\n        renderProjects();\r\n    }\r\n}\r\n\r\nfunction handleProjectCustomColorChange(projectId, color) {\r\n    if (!color) return;\r\n\r\n    setProjectColor(projectId, color);\r\n\r\n    const pickerRoot = document.getElementById(`color-picker-${projectId}`);\r\n    if (pickerRoot) {\r\n        const currentColorDiv = pickerRoot.previousElementSibling;\r\n        if (currentColorDiv) {\r\n            currentColorDiv.style.backgroundColor = color;\r\n        }\r\n\r\n        const customSwatch = pickerRoot.querySelector('.custom-color-swatch');\r\n        if (customSwatch) {\r\n            customSwatch.style.backgroundColor = color;\r\n        }\r\n    }\r\n\r\n    const picker = document.getElementById(`color-picker-${projectId}`);\r\n    if (picker) {\r\n        picker.querySelectorAll('.color-option').forEach(option => {\r\n            option.style.border = '2px solid transparent';\r\n        });\r\n        const customSwatch = picker.querySelector('.custom-color-swatch');\r\n        if (customSwatch) {\r\n            customSwatch.style.border = '2px solid white';\r\n        }\r\n    }\r\n\r\n    // Refresh project tags to show new color\r\n    const project = projects.find(p => p.id === projectId);\r\n    if (project && project.tags) {\r\n        renderProjectDetailsTags(project.tags, projectId);\r\n    }\r\n\r\n    // Refresh projects list to update tag colors in cards\r\n    if (document.getElementById('projects')?.classList.contains('active')) {\r\n        appState.projectsSortedView = null;\r\n        renderProjects();\r\n    }\r\n}\r\n\r\nfunction openCustomProjectColorPicker(projectId) {\r\n    const input = document.getElementById(`project-color-input-${projectId}`);\r\n    if (!input) return;\r\n    ignoreNextOutsideColorClick = true;\r\n    input.click();\r\n}\r\n\r\n\r\n// === Global filter state ===\r\nlet filterState = {\r\n    search: \"\",\r\n    statuses: new Set(),\r\n    statusExcludeMode: false, // true = exclude selected statuses; false = include only selected\r\n    priorities: new Set(),\r\n    priorityExcludeMode: false,\r\n    projects: new Set(),\r\n    projectExcludeMode: false,\r\n    tags: new Set(),\r\n    tagExcludeMode: false,\r\n    datePresets: new Set(), // Quick date filters: overdue, today, tomorrow, week, month (multi-select)\r\n    dateFrom: \"\",\r\n    dateTo: \"\",\r\n};\r\n\r\n// === Project filter state ===\r\nlet projectFilterState = {\r\n    search: \"\",\r\n    statuses: new Set(), // planning, active, completed\r\n    taskFilter: \"\", // 'has-tasks', 'no-tasks', or empty\r\n    updatedFilter: \"all\", // all | 5m | 30m | 24h | week | month\r\n    tags: new Set(), // project tags filter\r\n};\r\n\r\n// === Project sort state for ASC/DESC toggle ===\r\nlet projectSortState = {\r\n    lastSort: '',\r\n    direction: 'asc' // 'asc' or 'desc'\r\n};\r\n\r\n// Initialize filters UI - only call once on page load\r\nlet filtersUIInitialized = false;\r\nfunction initFiltersUI() {\r\n    if (filtersUIInitialized) return; // Prevent duplicate initialization\r\n    filtersUIInitialized = true;\r\n\r\n    populateProjectOptions();\r\n    populateTagOptions();\r\n    updateNoDateOptionVisibility();\r\n    setupFilterEventListeners();\r\n}\r\n\r\n// Separate function to only update project options\r\nfunction populateProjectOptions() {\r\n    const ul = document.getElementById(\"project-options\");\r\n    if (ul) {\r\n        // Preserve current selection\r\n        const selected = new Set(filterState.projects);\r\n\r\n        ul.innerHTML = \"\";\r\n\r\n        // Add \"No Project\" option only if there are tasks without assigned projects\r\n        const hasNoProjectTasks = tasks.some(t => !t.projectId);\r\n        if (hasNoProjectTasks) {\r\n            const noProjectLi = document.createElement(\"li\");\r\n            const checked = selected.has('none') ? 'checked' : '';\r\n            noProjectLi.innerHTML = `<label><input type=\"checkbox\" id=\"proj-none\" value=\"none\" data-filter=\"project\" ${checked}> ${t('tasks.noProject')}</label>`;\r\n            ul.appendChild(noProjectLi);\r\n        } else {\r\n            // Ensure state is consistent if 'none' was previously selected\r\n            if (selected.has('none')) {\r\n                filterState.projects.delete('none');\r\n                updateFilterBadges();\r\n            }\r\n        }\r\n\r\n        if (projects.length === 0) {\r\n            const li = document.createElement(\"li\");\r\n            li.textContent = t('filters.noOtherProjects');\r\n            li.style.color = \"var(--text-muted)\";\r\n            li.style.padding = \"8px 12px\";\r\n            ul.appendChild(li);\r\n        } else {\r\n            // Sort alphabetically by name (case-insensitive)\r\n            projects\r\n              .slice()\r\n              .sort((a, b) => (a.name || \"\").localeCompare(b.name || \"\", undefined, { sensitivity: \"base\" }))\r\n              .forEach((p) => {\r\n                const li = document.createElement(\"li\");\r\n                const id = `proj-${p.id}`;\r\n                const checked = selected.has(String(p.id)) ? 'checked' : '';\r\n                li.innerHTML = `<label><input type=\"checkbox\" id=\"${id}\" value=\"${p.id}\" data-filter=\"project\" ${checked}> ${p.name}</label>`;\r\n                ul.appendChild(li);\r\n            });\r\n        }\r\n\r\n        // Re-attach change listeners for project checkboxes\r\n        ul.querySelectorAll('input[type=\"checkbox\"][data-filter=\"project\"]').forEach((cb) => {\r\n            cb.addEventListener(\"change\", () => {\r\n                toggleSet(filterState.projects, cb.value, cb.checked);\r\n                updateFilterBadges();\r\n                renderAfterFilterChange();\r\n                const calendarView = document.getElementById(\"calendar-view\");\r\n                if (calendarView) {\r\n                    renderCalendar();\r\n                }\r\n                updateClearButtonVisibility();\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\n// Separate function to only update tag options (can be called independently)\r\nfunction populateTagOptions() {\r\n    const tagUl = document.getElementById(\"tag-options\");\r\n    if (tagUl) {\r\n        // Preserve previously selected tags from state instead of reading DOM\r\n        const currentlySelected = new Set(filterState.tags);\r\n\r\n        // Collect all unique tags from all tasks\r\n        const allTags = new Set();\r\n        tasks.forEach(t => {\r\n            if (t.tags && t.tags.length > 0) {\r\n                t.tags.forEach(tag => allTags.add(tag));\r\n            }\r\n        });\r\n        \r\n        tagUl.innerHTML = \"\";\r\n        \r\n        // Add \"No Tags\" only if there are tasks without tags\r\n        const hasNoTagTasks = tasks.some(t => !t.tags || t.tags.length === 0);\r\n        if (hasNoTagTasks) {\r\n            const noTagsLi = document.createElement(\"li\");\r\n            const noTagsChecked = currentlySelected.has('none') ? 'checked' : '';\r\n            noTagsLi.innerHTML = `<label><input type=\"checkbox\" id=\"tag-none\" value=\"none\" data-filter=\"tag\" ${noTagsChecked}> ${t('filters.noTags')}</label>`;\r\n            tagUl.appendChild(noTagsLi);\r\n        } else {\r\n            if (currentlySelected.has('none')) {\r\n                filterState.tags.delete('none');\r\n                updateFilterBadges();\r\n            }\r\n        }\r\n        \r\n        if (allTags.size === 0) {\r\n            const li = document.createElement(\"li\");\r\n            li.textContent = t('filters.noOtherTags');\r\n            li.style.color = \"var(--text-muted)\";\r\n            li.style.padding = \"8px 12px\";\r\n            tagUl.appendChild(li);\r\n        } else {\r\n            Array.from(allTags).sort().forEach((tag) => {\r\n                const li = document.createElement(\"li\");\r\n                const id = `tag-${tag}`;\r\n                const checked = currentlySelected.has(tag) ? 'checked' : '';\r\n                li.innerHTML = `<label><input type=\"checkbox\" id=\"${id}\" value=\"${tag}\" data-filter=\"tag\" ${checked}> ${tag.toUpperCase()}</label>`;\r\n                tagUl.appendChild(li);\r\n            });\r\n        }\r\n        \r\n        // Re-attach event listeners for new checkboxes\r\n        tagUl.querySelectorAll('input[type=\"checkbox\"]').forEach(cb => {\r\n            cb.addEventListener(\"change\", () => {\r\n                const type = cb.dataset.filter;\r\n                if (type === \"tag\") toggleSet(filterState.tags, cb.value, cb.checked);\r\n                updateFilterBadges();\r\n                renderAfterFilterChange();\r\n                \r\n                // Same calendar fix as task deletion/creation\r\n                const calendarView = document.getElementById(\"calendar-view\");\r\n                if (calendarView) {\r\n                    renderCalendar();\r\n                }\r\n                \r\n                updateClearButtonVisibility();\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\n// Setup event listeners (only call once)\r\nfunction setupFilterEventListeners() {\r\n\r\n    const isMobile =\r\n        !!(window.matchMedia && (\r\n            window.matchMedia(\"(max-width: 768px)\").matches ||\r\n            window.matchMedia(\"(pointer: coarse)\").matches\r\n        ));\r\n\r\n    // Show/hide project select-all based on number of projects\r\n    const selectAllProjectRow = document.getElementById(\"project-select-all\");\r\n    if (selectAllProjectRow && selectAllProjectRow.parentElement.parentElement) {\r\n        if (projects.length > 1) {\r\n            selectAllProjectRow.parentElement.parentElement.style.display = 'block';\r\n        } else {\r\n            selectAllProjectRow.parentElement.parentElement.style.display = 'none';\r\n        }\r\n    }\r\n\r\n    // Open/close dropdown panels for Status, Priority, Project, Tags, End Date, Start Date\r\n    const groups = [\r\n        document.getElementById(\"group-status\"),\r\n        document.getElementById(\"group-priority\"),\r\n        document.getElementById(\"group-project\"),\r\n        document.getElementById(\"group-tags\"),\r\n        document.getElementById(\"group-end-date\"),\r\n        document.getElementById(\"group-start-date\"),\r\n        document.getElementById(\"group-kanban-updated\"),\r\n        document.getElementById(\"group-project-status\"),\r\n        document.getElementById(\"group-project-updated\"),\r\n        document.getElementById(\"group-project-tags\"),\r\n    ].filter(Boolean);\r\n\r\n    const ensureBackdrop = () => {\r\n        let backdrop = document.getElementById(\"dropdown-backdrop\");\r\n        if (!backdrop) {\r\n            backdrop = document.createElement(\"div\");\r\n            backdrop.id = \"dropdown-backdrop\";\r\n            backdrop.setAttribute(\"aria-hidden\", \"true\");\r\n            backdrop.addEventListener(\"click\", () => closeAllPanels());\r\n            document.body.appendChild(backdrop);\r\n        }\r\n        return backdrop;\r\n    };\r\n\r\n    const closeAllPanels = () => {\r\n        groups.forEach((g) => g.classList.remove(\"open\"));\r\n        document.body.classList.remove(\"dropdown-sheet-open\");\r\n        const backdrop = document.getElementById(\"dropdown-backdrop\");\r\n        if (backdrop) backdrop.classList.remove(\"open\");\r\n    };\r\n\r\n    const enhanceMobilePanel = (g) => {\r\n        const panel = g.querySelector(\".dropdown-panel\");\r\n        if (!panel) return;\r\n\r\n        panel.classList.add(\"has-sheet-header\");\r\n\r\n        // Mobile-specific positioning and backdrop\r\n        if (isMobile) {\r\n        // Default to anchored under the trigger; fall back to bottom sheet when space is tight.\r\n        try {\r\n            const rect = g.getBoundingClientRect();\r\n            const margin = 12;\r\n            const gap = 8;\r\n            const vh = window.innerHeight || document.documentElement.clientHeight || 0;\r\n            const availableBelow = Math.max(0, vh - rect.bottom - margin);\r\n            const availableAbove = Math.max(0, rect.top - margin);\r\n            const preferredMax = Math.min(460, Math.floor(vh * 0.6));\r\n\r\n            let placeBelow = availableBelow >= 260 || availableBelow >= availableAbove;\r\n            let maxH = Math.min(preferredMax, placeBelow ? availableBelow : availableAbove);\r\n            const useBottomSheet = maxH < 220; // too cramped to be useful when anchored\r\n\r\n            panel.classList.toggle(\"sheet-bottom\", useBottomSheet);\r\n            panel.classList.toggle(\"sheet-anchored\", !useBottomSheet);\r\n\r\n            if (!useBottomSheet) {\r\n                if (maxH < 240) maxH = Math.min(240, Math.max(0, placeBelow ? availableBelow : availableAbove));\r\n                let top = placeBelow ? rect.bottom + gap : rect.top - gap - maxH;\r\n                top = Math.max(margin, Math.min(top, vh - margin - 140));\r\n                panel.style.setProperty(\"--sheet-top\", `${Math.round(top)}px`);\r\n                panel.style.setProperty(\"--sheet-maxh\", `${Math.round(maxH)}px`);\r\n            } else {\r\n                panel.style.removeProperty(\"--sheet-top\");\r\n                panel.style.removeProperty(\"--sheet-maxh\");\r\n            }\r\n        } catch (e) {\r\n            panel.classList.add(\"sheet-bottom\");\r\n            panel.classList.remove(\"sheet-anchored\");\r\n        }\r\n\r\n        ensureBackdrop().classList.add(\"open\");\r\n        document.body.classList.add(\"dropdown-sheet-open\");\r\n        } // End mobile-specific\r\n\r\n        if (!panel.querySelector(\".dropdown-sheet-header\")) {\r\n            const titleText =\r\n                panel.querySelector(\".dropdown-section-title\")?.textContent?.trim() ||\r\n                g.querySelector(\".filter-button\")?.textContent?.trim() ||\r\n                t('filters.sheet.title');\r\n\r\n            const header = document.createElement(\"div\");\r\n            header.className = \"dropdown-sheet-header\";\r\n\r\n            const handle = document.createElement(\"div\");\r\n            handle.className = \"dropdown-sheet-handle\";\r\n\r\n            const title = document.createElement(\"div\");\r\n            title.className = \"dropdown-sheet-title\";\r\n            title.textContent = titleText.toUpperCase();\r\n\r\n            const done = document.createElement(\"button\");\r\n            done.type = \"button\";\r\n            done.className = \"dropdown-sheet-done\";\r\n            done.textContent = t('common.done');\r\n            done.addEventListener(\"click\", () => closeAllPanels());\r\n\r\n            header.appendChild(handle);\r\n            header.appendChild(title);\r\n            header.appendChild(done);\r\n            panel.insertBefore(header, panel.firstChild);\r\n        }\r\n    };\r\n\r\n    groups.forEach((g) => {\r\n        const btn = g.querySelector(\".filter-button\");\r\n        btn.addEventListener(\"click\", (e) => {\r\n            e.stopPropagation();\r\n            const isOpen = g.classList.contains(\"open\");\r\n            closeAllPanels();\r\n            if (!isOpen) {\r\n                if (g.id === \"group-status\" && typeof applyBacklogFilterVisibility === \"function\") {\r\n                    try { applyBacklogFilterVisibility(); } catch (err) {}\r\n                }\r\n                g.classList.add(\"open\");\r\n                enhanceMobilePanel(g);\r\n            }\r\n        });\r\n\r\n        // keep panel open when clicking inside (so multiple checks don't close it)\r\n        const panel = g.querySelector(\".dropdown-panel\");\r\n        if (panel) {\r\n            panel.addEventListener(\"click\", (e) => e.stopPropagation());\r\n        }\r\n    });\r\n\r\n    // Clicking anywhere else closes panels\r\n    document.addEventListener(\"click\", () => closeAllPanels());\r\n\r\n    // Escape closes panels\r\n    document.addEventListener(\"keydown\", (e) => {\r\n        if (e.key === \"Escape\") closeAllPanels();\r\n    });\r\n\r\n    // Checkboxes for status, priority, and project (task filters only)\r\n    document.querySelectorAll(\r\n        '.dropdown-panel input[type=\"checkbox\"][data-filter=\"status\"],' +\r\n        '.dropdown-panel input[type=\"checkbox\"][data-filter=\"priority\"],' +\r\n        '.dropdown-panel input[type=\"checkbox\"][data-filter=\"project\"]'\r\n    ).forEach((cb) => {\r\n        cb.addEventListener(\"change\", () => {\r\n            const type = cb.dataset.filter;\r\n            if (type === \"status\") toggleSet(filterState.statuses, cb.value, cb.checked);\r\n            if (type === \"priority\") toggleSet(filterState.priorities, cb.value, cb.checked);\r\n            if (type === \"project\") toggleSet(filterState.projects, cb.value, cb.checked);\r\n            // Tags are handled separately in populateTagOptions()\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n\r\n            // Same calendar fix as task deletion/creation\r\n            const calendarView = document.getElementById(\"calendar-view\");\r\n            if (calendarView) {\r\n                renderCalendar();\r\n            }\r\n\r\n            updateClearButtonVisibility();\r\n        });\r\n    });\r\n\r\n    // Filter Include / Exclude toggles (Status, Priority, Tags, Project)\r\n    document.querySelectorAll(\".filter-mode-toggle\").forEach((toggle) => {\r\n        const filterType = toggle.dataset.filterType;\r\n        const includeBtn = toggle.querySelector('.filter-mode-btn[data-mode=\"include\"]');\r\n        const excludeBtn = toggle.querySelector('.filter-mode-btn[data-mode=\"exclude\"]');\r\n        \r\n        if (includeBtn) {\r\n            includeBtn.addEventListener(\"click\", (e) => {\r\n                e.stopPropagation();\r\n                // Map filterType to filterState key (tags -> tag)\r\n                const stateKey = filterType === \"tags\" ? \"tag\" : filterType;\r\n                const excludeModeKey = `${stateKey}ExcludeMode`;\r\n                if (filterState[excludeModeKey]) {\r\n                    filterState[excludeModeKey] = false;\r\n                    updateFilterModeUI(filterType);\r\n                    updateFilterBadges();\r\n                    renderAfterFilterChange();\r\n                    const cal = document.getElementById(\"calendar-view\");\r\n                    if (cal) renderCalendar();\r\n                    updateClearButtonVisibility();\r\n                }\r\n            });\r\n        }\r\n        if (excludeBtn) {\r\n            excludeBtn.addEventListener(\"click\", (e) => {\r\n                e.stopPropagation();\r\n                // Map filterType to filterState key (tags -> tag)\r\n                const stateKey = filterType === \"tags\" ? \"tag\" : filterType;\r\n                const excludeModeKey = `${stateKey}ExcludeMode`;\r\n                if (!filterState[excludeModeKey]) {\r\n                    filterState[excludeModeKey] = true;\r\n                    updateFilterModeUI(filterType);\r\n                    updateFilterBadges();\r\n                    renderAfterFilterChange();\r\n                    const cal = document.getElementById(\"calendar-view\");\r\n                    if (cal) renderCalendar();\r\n                    updateClearButtonVisibility();\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    // Checkboxes for date preset filter (multi-select)\r\n    document.querySelectorAll('input[type=\"checkbox\"][data-filter=\"date-preset\"]').forEach((checkbox) => {\r\n        checkbox.addEventListener(\"change\", () => {\r\n            const val = checkbox.value;\r\n\r\n            if (checkbox.checked) {\r\n                filterState.datePresets.add(val);\r\n\r\n                // Clear manual date inputs when any preset is selected\r\n                if (filterState.datePresets.size > 0) {\r\n                    filterState.dateFrom = \"\";\r\n                    filterState.dateTo = \"\";\r\n                    const dateFromEl = document.getElementById(\"filter-date-from\");\r\n                    const dateToEl = document.getElementById(\"filter-date-to\");\r\n                    if (dateFromEl) dateFromEl.value = \"\";\r\n                    if (dateToEl) dateToEl.value = \"\";\r\n                }\r\n            } else {\r\n                filterState.datePresets.delete(val);\r\n            }\r\n\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n\r\n            const calendarView = document.getElementById(\"calendar-view\");\r\n            if (calendarView) {\r\n                renderCalendar();\r\n            }\r\n\r\n            updateClearButtonVisibility();\r\n        });\r\n    });\r\n\r\n    // \"Select / Unselect All\" for Projects\r\n    const selectAllProject = document.getElementById(\"project-select-all\");\r\n    if (selectAllProject) {\r\n        selectAllProject.addEventListener(\"change\", () => {\r\n            const projectCheckboxes = document.querySelectorAll(\r\n                '.dropdown-panel input[type=\"checkbox\"][data-filter=\"project\"]'\r\n            );\r\n            const allChecked = selectAllProject.checked;\r\n            projectCheckboxes.forEach((cb) => {\r\n                cb.checked = allChecked;\r\n                if (allChecked) {\r\n                    filterState.projects.add(cb.value);\r\n                } else {\r\n                    filterState.projects.delete(cb.value);\r\n                }\r\n            });\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n            \r\n            // Same calendar fix as task deletion/creation\r\n            const calendarView = document.getElementById(\"calendar-view\");\r\n            if (calendarView) {\r\n                renderCalendar();\r\n            }\r\n            \r\n            updateClearButtonVisibility();\r\n        });\r\n    }\r\n\r\n    // Search field\r\n    const searchEl = document.getElementById(\"filter-search\");\r\n    if (searchEl) {\r\n        searchEl.addEventListener(\"input\", () => {\r\n            filterState.search = (searchEl.value || \"\").trim().toLowerCase();\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n            \r\n            // Same calendar fix as task deletion/creation\r\n            const calendarView = document.getElementById(\"calendar-view\");\r\n            if (calendarView) {\r\n                renderCalendar();\r\n            }\r\n            \r\n            updateClearButtonVisibility();\r\n        });\r\n    }\r\n\r\n    // Radio for Kanban-only updated-recency filter\r\n    document.querySelectorAll('input[type=\"radio\"][data-filter=\"kanban-updated\"][name=\"kanban-updated-filter\"]').forEach((rb) => {\r\n        rb.addEventListener(\"change\", () => {\r\n            if (!rb.checked) return;\r\n            setKanbanUpdatedFilter(rb.value);\r\n            updateClearButtonVisibility();\r\n        });\r\n    });\r\n\r\n    // Date range inputs\r\n    const dateFromEl = document.getElementById(\"filter-date-from\");\r\n    const dateToEl = document.getElementById(\"filter-date-to\");\r\n\r\nif (dateFromEl) {\r\n        dateFromEl.addEventListener(\"change\", () => {\r\n            filterState.dateFrom = dateFromEl.value;\r\nupdateFilterBadges();\r\n            renderAfterFilterChange();\r\n\r\n            const calendarView = document.getElementById(\"calendar-view\");\r\n            if (calendarView) {\r\n                renderCalendar();\r\n            }\r\n\r\n            updateClearButtonVisibility();\r\n        });\r\n    } else {\r\n        console.error(\"[Filter] Date From element not found!\");\r\n    }\r\n\r\n    if (dateToEl) {\r\n        dateToEl.addEventListener(\"change\", () => {\r\n            filterState.dateTo = dateToEl.value;\r\nupdateFilterBadges();\r\n            renderAfterFilterChange();\r\n\r\n            const calendarView = document.getElementById(\"calendar-view\");\r\n            if (calendarView) {\r\n                renderCalendar();\r\n            }\r\n\r\n            updateClearButtonVisibility();\r\n        });\r\n    } else {\r\n        console.error(\"[Filter] Date To element not found!\");\r\n    }\r\n\r\n    // Clear all filters\r\n    const clearBtn = document.getElementById(\"btn-clear-filters\");\r\n    if (clearBtn) {\r\n        clearBtn.addEventListener(\"click\", () => {\r\n            filterState.search = \"\";\r\n            filterState.statuses.clear();\r\n            filterState.statusExcludeMode = false;\r\n            filterState.priorities.clear();\r\n            filterState.priorityExcludeMode = false;\r\n            filterState.projects.clear();\r\n            filterState.projectExcludeMode = false;\r\n            filterState.tags.clear();\r\n            filterState.tagExcludeMode = false;\r\n            filterState.datePresets.clear();\r\n            filterState.dateFrom = \"\";\r\n            filterState.dateTo = \"\";\r\n            try { setKanbanUpdatedFilter('all', { render: false }); } catch (e) {}\r\n\r\n            // Reset UI elements\r\n            document\r\n                .querySelectorAll('.dropdown-panel input[type=\"checkbox\"]')\r\n                .forEach((cb) => (cb.checked = false));\r\n\r\n            if (searchEl) searchEl.value = \"\";\r\n\r\n            // Clear date filter inputs and their Flatpickr instances\r\n            if (dateFromEl) {\r\n                dateFromEl.value = \"\";\r\n                // Clear the Flatpickr display input\r\n                const dateFromWrapper = dateFromEl.closest('.date-input-wrapper');\r\n                if (dateFromWrapper) {\r\n                    const displayInput = dateFromWrapper.querySelector('.date-display');\r\n                    if (displayInput && displayInput._flatpickr) {\r\n                        displayInput._flatpickr.clear();\r\n                    }\r\n                }\r\n            }\r\n            if (dateToEl) {\r\n                dateToEl.value = \"\";\r\n                // Clear the Flatpickr display input\r\n                const dateToWrapper = dateToEl.closest('.date-input-wrapper');\r\n                if (dateToWrapper) {\r\n                    const displayInput = dateToWrapper.querySelector('.date-display');\r\n                    if (displayInput && displayInput._flatpickr) {\r\n                        displayInput._flatpickr.clear();\r\n                    }\r\n                }\r\n            }\r\n\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n            \r\n            // Same calendar fix as task deletion/creation\r\n            const calendarView = document.getElementById(\"calendar-view\");\r\n            if (calendarView) {\r\n                renderCalendar();\r\n            }\r\n            \r\n            updateClearButtonVisibility();\r\n        });\r\n    }\r\n\r\n    // First run\r\n    updateFilterBadges();\r\n    renderActiveFilterChips();\r\n    updateKanbanUpdatedFilterUI();\r\n    updateClearButtonVisibility();\r\n    }\r\n\r\nfunction syncFilterCheckboxesFromState(filterType) {\r\n    // Map filterType to data-filter attribute (tags -> tag)\r\n    const dataFilterAttr = filterType === \"tags\" ? \"tag\" : filterType;\r\n    document.querySelectorAll(`input[type=\"checkbox\"][data-filter=\"${dataFilterAttr}\"]`).forEach((cb) => {\r\n        const filterSet = filterState[filterType === \"status\" ? \"statuses\" : \r\n                          filterType === \"priority\" ? \"priorities\" :\r\n                          filterType === \"project\" ? \"projects\" : \"tags\"];\r\n        cb.checked = filterSet.has(cb.value);\r\n    });\r\n}\r\n\r\nfunction updateFilterModeUI(filterType) {\r\n    const toggle = document.querySelector(`.filter-mode-toggle[data-filter-type=\"${filterType}\"]`);\r\n    if (!toggle) return;\r\n    // Map filterType to filterState key (tags -> tag)\r\n    const stateKey = filterType === \"tags\" ? \"tag\" : filterType;\r\n    const excludeModeKey = `${stateKey}ExcludeMode`;\r\n    const excludeMode = filterState[excludeModeKey] || false;\r\n    const includeBtn = toggle.querySelector('.filter-mode-btn[data-mode=\"include\"]');\r\n    const excludeBtn = toggle.querySelector('.filter-mode-btn[data-mode=\"exclude\"]');\r\n    if (includeBtn) includeBtn.classList.toggle(\"active\", !excludeMode);\r\n    if (excludeBtn) excludeBtn.classList.toggle(\"active\", !!excludeMode);\r\n    syncFilterCheckboxesFromState(filterType);\r\n}\r\n\r\nfunction updateAllFilterModeUI() {\r\n    [\"status\", \"priority\", \"tags\", \"project\"].forEach(type => updateFilterModeUI(type));\r\n}\r\n\r\nfunction updateClearButtonVisibility() {\r\n    const btn = document.getElementById(\"btn-clear-filters\");\r\n    if (!btn) return;\r\n\r\n    const kanban = document.querySelector('.kanban-board');\r\n    const isKanban = kanban && !kanban.classList.contains('hidden');\r\n    const isList = document.getElementById('list-view')?.classList.contains('active');\r\n    const isCalendar = document.getElementById('calendar-view')?.classList.contains('active');\r\n    const showUpdated = isKanban || isList || isCalendar;\r\n    const hasKanbanUpdated =\r\n        showUpdated &&\r\n        window.kanbanUpdatedFilter &&\r\n        window.kanbanUpdatedFilter !== 'all';\r\n\r\n    const hasFilters =\r\n        (filterState.search && filterState.search.trim() !== \"\") ||\r\n        filterState.statuses.size > 0 ||\r\n        filterState.priorities.size > 0 ||\r\n        filterState.projects.size > 0 ||\r\n        filterState.tags.size > 0 ||\r\n        filterState.datePresets.size > 0 ||\r\n        (filterState.dateFrom && filterState.dateFrom !== \"\") ||\r\n        (filterState.dateTo && filterState.dateTo !== \"\") ||\r\n        hasKanbanUpdated;\r\n\r\n    btn.style.display = hasFilters ? \"inline-flex\" : \"none\";\r\n}\r\n\r\n// Update numeric badges for each dropdown\r\nfunction updateFilterBadges() {\r\n    const b1 = document.getElementById(\"badge-status\");\r\n    const b2 = document.getElementById(\"badge-priority\");\r\n    const b3 = document.getElementById(\"badge-project\");\r\n    const b4 = document.getElementById(\"badge-tags\");\r\n    const bEndDate = document.getElementById(\"badge-end-date\");\r\n    const bStartDate = document.getElementById(\"badge-start-date\");\r\n\r\n    // Show count when active, empty when inactive (no more \"All\")\r\n    if (b1) b1.textContent = filterState.statuses.size === 0 ? \"\" : filterState.statuses.size;\r\n    if (b2) b2.textContent = filterState.priorities.size === 0 ? \"\" : filterState.priorities.size;\r\n    if (b3) b3.textContent = filterState.projects.size === 0 ? \"\" : filterState.projects.size;\r\n    if (b4) b4.textContent = filterState.tags.size === 0 ? \"\" : filterState.tags.size;\r\n\r\n    // Count end date and start date filters separately\r\n    const endDatePresets = [\"no-date\", \"overdue\", \"end-today\", \"end-tomorrow\", \"end-7days\", \"end-week\", \"end-month\"];\r\n    const startDatePresets = [\"no-start-date\", \"already-started\", \"start-today\", \"start-tomorrow\", \"start-7days\", \"start-week\", \"start-month\"];\r\n\r\n    let endDateCount = 0;\r\n    let startDateCount = 0;\r\n\r\n    filterState.datePresets.forEach(preset => {\r\n        if (endDatePresets.includes(preset)) {\r\n            endDateCount++;\r\n        } else if (startDatePresets.includes(preset)) {\r\n            startDateCount++;\r\n        }\r\n    });\r\n\r\n    if (bEndDate) bEndDate.textContent = endDateCount === 0 ? \"\" : endDateCount;\r\n    if (bStartDate) bStartDate.textContent = startDateCount === 0 ? \"\" : startDateCount;\r\n\r\n    // Update active state on filter buttons\r\n    const updateButtonState = (badgeId, isActive) => {\r\n        const badge = document.getElementById(badgeId);\r\n        if (badge) {\r\n            const button = badge.closest('.filter-button');\r\n            if (button) {\r\n                if (isActive) {\r\n                    button.classList.add('active');\r\n                } else {\r\n                    button.classList.remove('active');\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    updateButtonState(\"badge-status\", filterState.statuses.size > 0);\r\n    updateButtonState(\"badge-priority\", filterState.priorities.size > 0);\r\n    updateButtonState(\"badge-project\", filterState.projects.size > 0);\r\n    updateButtonState(\"badge-tags\", filterState.tags.size > 0);\r\n    updateButtonState(\"badge-end-date\", endDateCount > 0);\r\n    updateButtonState(\"badge-start-date\", startDateCount > 0);\r\n\r\n    updateAllFilterModeUI();\r\n    renderActiveFilterChips();\r\n    updateClearButtonVisibility();\r\n    logDebug(\"filters\", \"badges\", {\r\n        statusCount: filterState.statuses.size,\r\n        priorityCount: filterState.priorities.size,\r\n        projectCount: filterState.projects.size,\r\n        tagCount: filterState.tags.size,\r\n        endDateCount,\r\n        startDateCount\r\n    });\r\n}\r\n\r\n// Show active filter \"chips\" under the toolbar\r\nfunction renderActiveFilterChips() {\r\n    const wrap = document.getElementById(\"active-filters\");\r\n    if (!wrap) return;\r\n    const chipsTimer = debugTimeStart(\"filters\", \"chips\");\r\n    wrap.innerHTML = \"\";\r\n\r\n    const addChip = (label, value, onRemove, type, rawValue) => {\r\n        const chip = document.createElement(\"span\");\r\n        chip.className = \"filter-chip\";\r\n\r\n        // Add type-specific class for styling\r\n        if (type === \"status\") {\r\n            chip.classList.add(\"chip-status\");\r\n        } else if (type === \"priority\") {\r\n            chip.classList.add(\"chip-priority\");\r\n        }\r\n\r\n        const text = document.createElement(\"span\");\r\n        text.className = \"chip-text\";\r\n\r\n        // Add colored dot for status chips\r\n        if (type === \"status\" && rawValue) {\r\n            const dot = document.createElement(\"span\");\r\n            dot.className = `dot ${rawValue}`;\r\n            text.appendChild(dot);\r\n            text.appendChild(document.createTextNode(` ${label}: ${value}`));\r\n        } else {\r\n            text.textContent = `${label}: ${value}`;\r\n        }\r\n\r\n        const btn = document.createElement(\"button\");\r\n        btn.type = \"button\";\r\n        btn.className = \"chip-remove\";\r\n        btn.setAttribute(\"aria-label\", t('filters.chip.removeAria', { label }));\r\n        btn.textContent = \"\u00D7\";\r\n        btn.addEventListener(\"click\", onRemove);\r\n\r\n        chip.appendChild(text);\r\n        chip.appendChild(btn);\r\n        wrap.appendChild(chip);\r\n    };\r\n\r\n    // Search chip\r\n    if (filterState.search)\r\n        addChip(t('filters.chip.search'), filterState.search, () => {\r\n            filterState.search = \"\";\r\n            const el = document.getElementById(\"filter-search\");\r\n            if (el) el.value = \"\";\r\n            updateFilterBadges(); // Ensure badges are updated\r\n            updateClearButtonVisibility(); // Update clear button state\r\n            renderAfterFilterChange();\r\n        });\r\n\r\n    // Status chips (label = \"Status\" or \"Excluding\" when exclude mode)\r\n    const statusChipLabel = filterState.statusExcludeMode ? t('tasks.filters.excluding') : t('tasks.filters.status');\r\n    filterState.statuses.forEach((v) =>\r\n        addChip(statusChipLabel, getStatusLabel(v), () => {\r\n            filterState.statuses.delete(v);\r\n            const cb = document.querySelector(\r\n                `input[type=\"checkbox\"][data-filter=\"status\"][value=\"${v}\"]`\r\n            );\r\n            if (cb) cb.checked = false;\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n        }, \"status\", v)\r\n    );\r\n\r\n    // Priority chips (label = \"Priority\" or \"Excluding\" when exclude mode)\r\n    const priorityChipLabel = filterState.priorityExcludeMode ? t('tasks.filters.excluding') : t('tasks.filters.priority');\r\n    filterState.priorities.forEach((v) =>\r\n        addChip(priorityChipLabel, getPriorityLabel(v), () => {\r\n            filterState.priorities.delete(v);\r\n            const cb = document.querySelector(\r\n                `input[type=\"checkbox\"][data-filter=\"priority\"][value=\"${v}\"]`\r\n            );\r\n            if (cb) cb.checked = false;\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n        }, \"priority\", v)\r\n    );\r\n\r\n    // Project chips (label = \"Project\" or \"Excluding\" when exclude mode)\r\n    const projectChipLabel = filterState.projectExcludeMode ? t('tasks.filters.excluding') : t('filters.chip.project');\r\n    filterState.projects.forEach((pid) => {\r\n        const proj = projects.find((p) => p.id.toString() === pid.toString());\r\n        addChip(projectChipLabel, proj ? proj.name : pid, () => {\r\n            filterState.projects.delete(pid);\r\n            const cb = document.querySelector(\r\n                `input[type=\"checkbox\"][data-filter=\"project\"][value=\"${pid}\"]`\r\n            );\r\n            if (cb) cb.checked = false;\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n        });\r\n    });\r\n\r\n    // Tags chips (label = \"Tag\" or \"Excluding\" when exclude mode)\r\n    const tagChipLabel = filterState.tagExcludeMode ? t('tasks.filters.excluding') : t('filters.chip.tag');\r\n    filterState.tags.forEach((tag) =>\r\n        addChip(tagChipLabel, tag, () => {\r\n            filterState.tags.delete(tag);\r\n            const cb = document.querySelector(\r\n                `input[type=\"checkbox\"][data-filter=\"tag\"][value=\"${tag}\"]`\r\n            );\r\n            if (cb) cb.checked = false;\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n        })\r\n    );\r\n\r\n    // Date preset chips (one chip per selected preset)\r\n    filterState.datePresets.forEach((preset) => {\r\n        const datePresetLabels = {\r\n            \"no-date\": t('tasks.filters.noDate'),\r\n            \"overdue\": t('tasks.filters.overdue'),\r\n            \"end-today\": t('tasks.filters.endToday'),\r\n            \"end-tomorrow\": t('tasks.filters.endTomorrow'),\r\n            \"end-7days\": t('tasks.filters.end7Days'),\r\n            \"end-week\": t('tasks.filters.endThisWeek'),\r\n            \"end-month\": t('tasks.filters.endThisMonth'),\r\n            \"no-start-date\": t('tasks.filters.noStartDate'),\r\n            \"already-started\": t('tasks.filters.alreadyStarted'),\r\n            \"start-today\": t('tasks.filters.startToday'),\r\n            \"start-tomorrow\": t('tasks.filters.startTomorrow'),\r\n            \"start-7days\": t('tasks.filters.start7Days'),\r\n            \"start-week\": t('tasks.filters.startThisWeek'),\r\n            \"start-month\": t('tasks.filters.startThisMonth')\r\n        };\r\n        const label = datePresetLabels[preset] || preset;\r\n        addChip(t('filters.chip.date'), label, () => {\r\n            filterState.datePresets.delete(preset);\r\n            // Uncheck the corresponding checkbox\r\n            const checkbox = document.querySelector(`input[type=\"checkbox\"][data-filter=\"date-preset\"][value=\"${preset}\"]`);\r\n            if (checkbox) checkbox.checked = false;\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n        });\r\n    });\r\n\r\n    // Kanban/List Updated filter chip (not shown on Calendar)\r\n    try {\r\n        const kanban = document.querySelector('.kanban-board');\r\n        const isKanban = kanban && !kanban.classList.contains('hidden');\r\n        const isList = document.getElementById('list-view')?.classList.contains('active');\r\n        const isCalendar = document.getElementById('calendar-view')?.classList.contains('active');\r\n        const showUpdated = isKanban || isList || isCalendar;\r\n        if (showUpdated && window.kanbanUpdatedFilter && window.kanbanUpdatedFilter !== 'all') {\r\n            addChip(t('filters.chip.updated'), getKanbanUpdatedFilterLabel(window.kanbanUpdatedFilter), () => {\r\n                setKanbanUpdatedFilter('all');\r\n                updateClearButtonVisibility();\r\n            });\r\n        }\r\n    } catch (e) {}\r\n\r\n    // Date range chips\r\n    if (filterState.dateFrom || filterState.dateTo) {\r\n        let dateLabel = \"\";\r\n        if (filterState.dateFrom && filterState.dateTo) {\r\n            dateLabel = `${formatDate(filterState.dateFrom)} - ${formatDate(filterState.dateTo)}`;\r\n        } else if (filterState.dateFrom) {\r\n            dateLabel = `${t('filters.dateRange.from')} ${formatDate(filterState.dateFrom)}`;\r\n        } else if (filterState.dateTo) {\r\n            dateLabel = `${t('filters.dateRange.until')} ${formatDate(filterState.dateTo)}`;\r\n        }\r\n        addChip(t('filters.chip.date'), dateLabel, () => {\r\n            filterState.dateFrom = \"\";\r\n            filterState.dateTo = \"\";\r\n            const fromEl = document.getElementById(\"filter-date-from\");\r\n            const toEl = document.getElementById(\"filter-date-to\");\r\n\r\n            // Clear date filter inputs and their Flatpickr instances\r\n            if (fromEl) {\r\n                fromEl.value = \"\";\r\n                const dateFromWrapper = fromEl.closest('.date-input-wrapper');\r\n                if (dateFromWrapper) {\r\n                    const displayInput = dateFromWrapper.querySelector('.date-display');\r\n                    if (displayInput && displayInput._flatpickr) {\r\n                        displayInput._flatpickr.clear();\r\n                    }\r\n                }\r\n            }\r\n            if (toEl) {\r\n                toEl.value = \"\";\r\n                const dateToWrapper = toEl.closest('.date-input-wrapper');\r\n                if (dateToWrapper) {\r\n                    const displayInput = dateToWrapper.querySelector('.date-display');\r\n                    if (displayInput && displayInput._flatpickr) {\r\n                        displayInput._flatpickr.clear();\r\n                    }\r\n                }\r\n            }\r\n\r\n            renderAfterFilterChange();\r\n        });\r\n    }\r\n    debugTimeEnd(\"filters\", chipsTimer, { chipCount: wrap.children.length });\r\n}\r\n\r\n// Sync current filter state to URL for shareable links and browser history\r\nfunction syncURLWithFilters() {\r\n    const params = new URLSearchParams();\r\n\r\n    // Add view parameter (kanban, list, or calendar)\r\n    const isListView = document.getElementById(\"list-view\")?.classList.contains(\"active\");\r\n    const isCalendarView = document.getElementById(\"calendar-view\")?.classList.contains(\"active\");\r\n    if (isListView) {\r\n        params.set(\"view\", \"list\");\r\n    } else if (isCalendarView) {\r\n        params.set(\"view\", \"calendar\");\r\n    }\r\n    // Don't add 'kanban' as it's the default\r\n\r\n    // Add search query\r\n    if (filterState.search && filterState.search.trim() !== \"\") {\r\n        params.set(\"search\", filterState.search.trim());\r\n    }\r\n\r\n    // Add status filters (comma-separated)\r\n    if (filterState.statuses.size > 0) {\r\n        params.set(\"status\", Array.from(filterState.statuses).join(\",\"));\r\n        if (filterState.statusExcludeMode) params.set(\"statusExclude\", \"1\");\r\n    }\r\n\r\n    // Add priority filters (comma-separated)\r\n    if (filterState.priorities.size > 0) {\r\n        params.set(\"priority\", Array.from(filterState.priorities).join(\",\"));\r\n        if (filterState.priorityExcludeMode) params.set(\"priorityExclude\", \"1\");\r\n    }\r\n\r\n    // Add project filters (comma-separated)\r\n    if (filterState.projects.size > 0) {\r\n        params.set(\"project\", Array.from(filterState.projects).join(\",\"));\r\n        if (filterState.projectExcludeMode) params.set(\"projectExclude\", \"1\");\r\n    }\r\n\r\n    // Add tag filters (comma-separated)\r\n    if (filterState.tags.size > 0) {\r\n        params.set(\"tags\", Array.from(filterState.tags).join(\",\"));\r\n        if (filterState.tagExcludeMode) params.set(\"tagExclude\", \"1\");\r\n    }\r\n\r\n    // Add date preset filters (comma-separated)\r\n    if (filterState.datePresets.size > 0) {\r\n        params.set(\"datePreset\", Array.from(filterState.datePresets).join(\",\"));\r\n    }\r\n\r\n    // Add date range filters\r\n    if (filterState.dateFrom && filterState.dateFrom !== \"\") {\r\n        params.set(\"dateFrom\", filterState.dateFrom);\r\n        if (filterState.dateField && filterState.dateField !== 'endDate') {\r\n            params.set(\"dateField\", filterState.dateField);\r\n        }\r\n    }\r\n    if (filterState.dateTo && filterState.dateTo !== \"\") {\r\n        params.set(\"dateTo\", filterState.dateTo);\r\n    }\r\n\r\n    // Add updated filter (kanban/list/calendar)\r\n    if (window.kanbanUpdatedFilter && window.kanbanUpdatedFilter !== 'all') {\r\n        params.set(\"updated\", window.kanbanUpdatedFilter);\r\n    }\r\n\r\n    // Build new URL\r\n    const queryString = params.toString();\r\n    const newHash = queryString ? `#tasks?${queryString}` : \"#tasks\";\r\n\r\n    // Update URL without triggering hashchange event (prevents infinite loop)\r\n    if (window.location.hash !== newHash) {\r\n        window.history.replaceState(null, \"\", newHash);\r\n    }\r\n}\r\n\r\n// Called whenever filters change\r\nfunction renderAfterFilterChange() {\r\n    syncURLWithFilters(); // Keep URL in sync with filters\r\n    renderActiveFilterChips(); // Update filter chips display\r\n    renderTasks(); // Kanban\r\n\r\n    // Always render list view on mobile (for mobile cards) or when active on desktop\r\n    const isMobile = getIsMobileCached();\r\n    if (isMobile || document.getElementById(\"list-view\").classList.contains(\"active\")) {\r\n        renderListView(); // List (includes mobile cards)\r\n    }\r\n\r\n    if (document.getElementById(\"calendar-view\").classList.contains(\"active\")) {\r\n        renderCalendar(); // Calendar\r\n    }\r\n}\r\n\r\n// Return filtered tasks array\r\n// Uses filterTasks from src/utils/filterPredicates.js for pure filtering logic\r\nfunction getFilteredTasks() {\r\n    const filterTimer = debugTimeStart(\"filters\", \"tasks\", {\r\n        totalTasks: tasks.length,\r\n        hasSearch: !!filterState.search,\r\n        statusCount: filterState.statuses.size,\r\n        priorityCount: filterState.priorities.size,\r\n        projectCount: filterState.projects.size,\r\n        tagCount: filterState.tags.size,\r\n        datePresetCount: filterState.datePresets.size,\r\n        hasDateRange: !!(filterState.dateFrom || filterState.dateTo)\r\n    });\r\n\r\n    // Use the pure filterTasks function from filterPredicates module\r\n    const filtered = filterTasks(tasks, {\r\n        search: filterState.search,\r\n        statuses: filterState.statuses,\r\n        statusExcludeMode: filterState.statusExcludeMode,\r\n        priorities: filterState.priorities,\r\n        priorityExcludeMode: filterState.priorityExcludeMode,\r\n        projects: filterState.projects,\r\n        projectExcludeMode: filterState.projectExcludeMode,\r\n        tags: filterState.tags,\r\n        tagExcludeMode: filterState.tagExcludeMode,\r\n        datePresets: filterState.datePresets,\r\n        dateFrom: filterState.dateFrom,\r\n        dateTo: filterState.dateTo,\r\n        dateField: filterState.dateField || 'endDate'\r\n    });\r\n\r\n    debugTimeEnd(\"filters\", filterTimer, {\r\n        totalTasks: tasks.length,\r\n        filteredCount: filtered.length\r\n    });\r\n    return filtered;\r\n}\r\n\r\nfunction initializeDatePickers() {\r\n  const flatpickrFn = window.flatpickr;\r\n  if (typeof flatpickrFn !== \"function\") {\r\n    const retry = (initializeDatePickers.__retryCount || 0) + 1;\r\n    initializeDatePickers.__retryCount = retry;\r\n    if (retry <= 50) {\r\n      setTimeout(initializeDatePickers, 100);\r\n    } else {\r\n      console.warn(\"flatpickr is not available; date pickers disabled\");\r\n    }\r\n    return;\r\n  }\r\n\r\n  const flatpickrLocale = getFlatpickrLocale();\r\n  const dateConfig = {\r\n    dateFormat: \"d/m/Y\",\r\n    altInput: false,\r\n    allowInput: true,\r\n    locale: flatpickrLocale,\r\n    disableMobile: true,\r\n  };\r\n\r\n  // Helper: mask for dd/mm/yyyy and sync into flatpickr without triggering persistence\r\n  function addDateMask(input, flatpickrInstance) {\r\n    let clearedOnFirstKey = false;\r\n\r\n    input.addEventListener(\"keydown\", function (e) {\r\n      if (\r\n        !clearedOnFirstKey &&\r\n        input.value.match(/^\\d{2}\\/\\d{2}\\/\\d{4}$/) &&\r\n        e.key.length === 1 &&\r\n        /\\d/.test(e.key)\r\n      ) {\r\n        input.value = \"\";\r\n        clearedOnFirstKey = true;\r\n      }\r\n      if (e.key === \"Backspace\" && input.selectionStart === 0 && input.selectionEnd === 0) {\r\n        input.value = \"\";\r\n        clearedOnFirstKey = true;\r\n        e.preventDefault();\r\n      }\r\n    });\r\n\r\n    input.addEventListener(\"input\", function (e) {\r\n      let value = e.target.value;\r\n      let numbers = value.replace(/\\D/g, \"\");\r\n\r\n      let formatted = \"\";\r\n      if (numbers.length >= 1) {\r\n        let day = numbers.substring(0, 2);\r\n        if (parseInt(day, 10) > 31) day = \"31\";\r\n        formatted = day;\r\n      }\r\n      if (numbers.length >= 3) {\r\n        let month = numbers.substring(2, 4);\r\n        if (parseInt(month, 10) > 12) month = \"12\";\r\n        formatted += \"/\" + month;\r\n      }\r\n      if (numbers.length >= 5) {\r\n        formatted += \"/\" + numbers.substring(4, 8);\r\n      }\r\n\r\n      if (value !== formatted) {\r\n        e.target.value = formatted;\r\n      }\r\n\r\n      if (formatted.match(/^\\d{2}\\/\\d{2}\\/\\d{4}$/)) {\r\n        const [dd, mm, yyyy] = formatted.split(\"/\");\r\n        const dateObj = new Date(+yyyy, +mm - 1, +dd);\r\n        if (flatpickrInstance && flatpickrInstance.config) {\r\n          try {\r\n            flatpickrInstance.__suppressChange = true;\r\n            flatpickrInstance.setDate(dateObj, false);\r\n            setTimeout(() => (flatpickrInstance.__suppressChange = false), 0);\r\n          } catch (e) {}\r\n        }\r\n      }\r\n    });\r\n\r\n    input.addEventListener(\"keypress\", function (e) {\r\n      const char = String.fromCharCode(e.which);\r\n      if (!/[\\d\\/]/.test(char) && e.which !== 8 && e.which !== 46) {\r\n        e.preventDefault();\r\n      }\r\n    });\r\n\r\n    input.addEventListener(\"blur\", function () {\r\n      clearedOnFirstKey = false;\r\n    });\r\n\r\n    if (flatpickrInstance) {\r\n      flatpickrInstance.config.onChange.push(() => (clearedOnFirstKey = false));\r\n    }\r\n  }\r\n\r\n  // Patch flatpickr instance to mark programmatic changes\r\n  function patchProgrammaticGuards(fp) {\r\n    if (fp.__patchedProgrammaticGuards) return;\r\n    fp.__patchedProgrammaticGuards = true;\r\n\r\n    const origClear = fp.clear.bind(fp);\r\n    fp.clear = function () {\r\n      fp.__suppressChange = true;\r\n      const res = origClear();\r\n      setTimeout(() => (fp.__suppressChange = false), 0);\r\n      return res;\r\n    };\r\n\r\n    const origSetDate = fp.setDate.bind(fp);\r\n    fp.__origSetDate = origSetDate;\r\n    fp.setDate = function (date, triggerChange, ...rest) {\r\n      // Any programmatic set should not persist. Even if triggerChange is true, we guard it.\r\n      fp.__suppressChange = true;\r\n      const res = origSetDate(date, triggerChange, ...rest);\r\n      setTimeout(() => (fp.__suppressChange = false), 0);\r\n      return res;\r\n    };\r\n  }\r\n\r\n  function addTodayButton(fp) {\r\n    if (!fp || !fp.calendarContainer) return;\r\n\r\n    if (fp.calendarContainer.querySelector('.flatpickr-today-btn')) return;\r\n\r\n    const footer = document.createElement('div');\r\n    footer.className = 'flatpickr-today-footer';\r\n\r\n    const todayBtn = document.createElement('button');\r\n    todayBtn.type = 'button';\r\n    todayBtn.className = 'flatpickr-today-btn';\r\n    todayBtn.textContent = t('calendar.today') || 'Today';\r\n\r\n    todayBtn.addEventListener('click', (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      const today = new Date();\r\n      fp.jumpToDate(today);\r\n\r\n      // Use the original setDate so onChange behaves like a user selection.\r\n      fp.__suppressChange = false;\r\n      if (typeof fp.__origSetDate === 'function') {\r\n        fp.__origSetDate(today, true);\r\n      } else {\r\n        fp.setDate(today, true);\r\n      }\r\n    });\r\n\r\n    footer.appendChild(todayBtn);\r\n    fp.calendarContainer.appendChild(footer);\r\n  }\r\n\r\n  // Attach pickers\r\n  document.querySelectorAll('input[type=\"date\"], input.datepicker').forEach((input) => {\r\n    if (input._flatpickrInstance) return;\r\n\r\n    if (input.type === \"date\") {\r\n      // One-time wrap into display input + hidden ISO input\r\n      if (input._wrapped) return;\r\n      input._wrapped = true;\r\n\r\n      const wrapper = document.createElement(\"div\");\r\n      wrapper.className = \"date-input-wrapper\";\r\n\r\n      const displayInput = document.createElement(\"input\");\r\n      displayInput.type = \"text\";\r\n      displayInput.className = \"form-input date-display\";\r\n\r\n      // Set placeholder - all date inputs use the same format\r\n      displayInput.placeholder = t('common.datePlaceholder');\r\n      displayInput.maxLength = \"10\";\r\n\r\n      // Hide original date input and keep ISO value there\r\n      input.style.display = \"none\";\r\n      input.type = \"hidden\";\r\n\r\n      input.parentNode.insertBefore(wrapper, input);\r\n      wrapper.appendChild(input);\r\n      wrapper.appendChild(displayInput);\r\n\r\n      const initialISO = input.value && looksLikeISO(input.value) ? input.value : \"\";\r\n      if (initialISO) {\r\n        displayInput.value = toDMYFromISO(initialISO);\r\n      } else {\r\n        displayInput.value = \"\";\r\n      }\r\n\r\n      const fp = flatpickrFn(displayInput, {\r\n        ...dateConfig,\r\n        defaultDate: initialISO ? new Date(initialISO) : null,\r\n        onReady(_, __, inst) {\r\n          addTodayButton(inst);\r\n        },\r\n        onOpen(_, __, inst) {\r\n          if (!input.value && !inst.selectedDates.length) {\r\n            inst.jumpToDate(new Date());\r\n          }\r\n        },\r\n        onChange: function (selectedDates) {\r\n          const previousValue = input.value || '';\r\n          let iso = \"\";\r\n          if (selectedDates.length > 0) {\r\n            const d = selectedDates[0];\r\n            iso = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}-${String(\r\n              d.getDate()\r\n            ).padStart(2, \"0\")}`;\r\n          }\r\n          input.value = iso;\r\n\r\n          const form = document.getElementById(\"task-form\");\r\n          if (form && (input.name === \"startDate\" || input.name === \"endDate\")) {\r\n            const modal = document.querySelector('.modal.active');\r\n            if (modal) {\r\n              const startInput = modal.querySelector('input[name=\"startDate\"]');\r\n              const endInput = modal.querySelector('input[name=\"endDate\"]');\r\n\r\n              if (startInput && endInput) {\r\n                const startValue = (startInput.value || '').trim();\r\n                const endValue = (endInput.value || '').trim();\r\n\r\n                if (startValue && endValue && endValue < startValue) {\r\n                  input.value = previousValue;\r\n                  if (previousValue) {\r\n                    displayInput._flatpickr.setDate(new Date(previousValue), false);\r\n                  } else {\r\n                    displayInput._flatpickr.clear();\r\n                  }\r\n\r\n                  const wrapper = displayInput.closest('.date-input-wrapper');\r\n                  const formGroup = wrapper ? wrapper.closest('.form-group') : null;\r\n\r\n                  if (formGroup) {\r\n                    const existingError = formGroup.querySelector('.date-validation-error');\r\n                    if (existingError) existingError.remove();\r\n\r\n                    const errorMsg = document.createElement('div');\r\n                    errorMsg.className = 'date-validation-error';\r\n                    errorMsg.style.cssText = 'color: var(--error); font-size: 12px; margin-top: 6px; padding: 8px 12px; background: var(--bg-error, rgba(239, 68, 68, 0.08)); border-left: 3px solid var(--error); border-radius: 4px;';\r\n                    errorMsg.innerHTML = '\u26A0\uFE0F ' + (input.name === \"endDate\" ? 'End Date cannot be before Start Date' : 'Start Date cannot be after End Date');\r\n\r\n                    wrapper.parentNode.insertBefore(errorMsg, wrapper.nextSibling);\r\n                    setTimeout(() => { if (errorMsg.parentElement) errorMsg.remove(); }, 5000);\r\n                  }\r\n                  return;\r\n                } else {\r\n                  const wrapper = displayInput.closest('.date-input-wrapper');\r\n                  const formGroup = wrapper ? wrapper.closest('.form-group') : null;\r\n                  if (formGroup) {\r\n                    const existingError = formGroup.querySelector('.date-validation-error');\r\n                    if (existingError) existingError.remove();\r\n                  }\r\n                }\r\n              }\r\n            }\r\n          }\r\n\r\n          // Handle filter date inputs\r\n          if (input.id === \"filter-date-from\") {\r\n            filterState.dateFrom = iso;\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n            const calendarView = document.getElementById(\"calendar-view\");\r\n            if (calendarView) {\r\n              renderCalendar();\r\n            }\r\n            updateClearButtonVisibility();\r\n            return;\r\n          } else if (input.id === \"filter-date-to\") {\r\n            filterState.dateTo = iso;\r\n            updateFilterBadges();\r\n            renderAfterFilterChange();\r\n            const calendarView = document.getElementById(\"calendar-view\");\r\n            if (calendarView) {\r\n              renderCalendar();\r\n            }\r\n            updateClearButtonVisibility();\r\n            return;\r\n          }\r\n\r\n          // Persist only when:\r\n          // - this field is a task date field (startDate or endDate)\r\n          // - a task is being edited\r\n          // - the change was user-initiated (not programmatic)\r\n          const isEditing = !!(form && form.dataset.editingTaskId);\r\n          const fieldName = input.name;\r\n          const isDateField = fieldName === \"startDate\" || fieldName === \"endDate\";\r\n          if (isEditing && isDateField && !fp.__suppressChange) {\r\n            updateTaskField(fieldName, iso);\r\n            return;\r\n          }\r\n\r\n          // Handle project date changes (si usan type=\"date\" envueltos)\r\n          if (displayInput.classList.contains('editable-date') && !fp.__suppressChange) {\r\n            // Extraer info del atributo onchange original (m\u00E9todo modular)\r\n            const onchangeAttr = displayInput.getAttribute('onchange');\r\n            if (onchangeAttr && onchangeAttr.includes('updateProjectField')) {\r\n              const match = onchangeAttr.match(/updateProjectField\\((\\d+),\\s*['\"](\\w+)['\"]/);\r\n              if (match) {\r\n                const projectId = parseInt(match[1], 10);\r\n                const field = match[2];\r\n                // Llamada directa a la funci\u00F3n modular (sin window)\r\n                updateProjectField(projectId, field, displayInput.value);\r\n              }\r\n            }\r\n          }\r\n        },\r\n      });\r\n\r\n      patchProgrammaticGuards(fp);\r\n      addDateMask(displayInput, fp);\r\n      input._flatpickrInstance = fp;\r\n\r\n      // Add an explicit Clear button for task date fields\r\n      const inTaskForm = !!displayInput.closest('#task-form');\r\n      const isTaskDateField = input.name === 'startDate' || input.name === 'endDate';\r\n      if (inTaskForm && isTaskDateField) {\r\n        const clearBtn = document.createElement('button');\r\n        clearBtn.type = 'button';\r\n        clearBtn.textContent = 'Clear';\r\n        clearBtn.style.padding = '6px 10px';\r\n        clearBtn.style.border = '1px solid var(--border)';\r\n        clearBtn.style.background = 'var(--bg-tertiary)';\r\n        clearBtn.style.color = 'var(--text-secondary)';\r\n        clearBtn.style.borderRadius = '6px';\r\n        clearBtn.style.cursor = 'pointer';\r\n        clearBtn.style.flex = '0 0 auto';\r\n\r\n        const wrapperNode = displayInput.parentElement;\r\n        if (wrapperNode) {\r\n          wrapperNode.style.display = 'flex';\r\n          wrapperNode.style.gap = '8px';\r\n        }\r\n\r\n        wrapperNode.appendChild(clearBtn);\r\n        clearBtn.addEventListener('click', () => {\r\n          displayInput.value = '';\r\n          input.value = '';\r\n          if (fp) {\r\n            fp.__suppressChange = true;\r\n            fp.clear();\r\n            setTimeout(() => (fp.__suppressChange = false), 0);\r\n          }\r\n          const form = document.getElementById('task-form');\r\n          const isEditing = !!(form && form.dataset.editingTaskId);\r\n          if (isEditing) {\r\n            updateTaskField(input.name, '');\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      // \uD83C\uDF1F CORRECCI\u00D3N AQUI: Plain text inputs with .datepicker (Project Fields)\r\n      input.maxLength = \"10\";\r\n      const fp = flatpickrFn(input, {\r\n        ...dateConfig,\r\n        defaultDate: null,\r\n        onReady(_, __, inst) {\r\n          addTodayButton(inst);\r\n        },\r\n        onChange: function (selectedDates, dateStr) {\r\n          if (fp.__suppressChange) return;\r\n\r\n          // Check if this is a project date field using data attributes\r\n          const projectId = input.dataset.projectId;\r\n          const fieldName = input.dataset.field;\r\n\r\n          if (projectId && fieldName) {\r\n            // This is a project date field - call updateProjectField directly\r\n            updateProjectField(parseInt(projectId, 10), fieldName, dateStr);\r\n          }\r\n        },\r\n      });\r\n\r\n      patchProgrammaticGuards(fp);\r\n      addDateMask(input, fp);\r\n      input._flatpickrInstance = fp;\r\n    }\r\n  });\r\n}\r\n\r\nfunction getFlatpickrLocale() {\r\n  const lang = getCurrentLanguage();\r\n  const l10n = window.flatpickr?.l10ns;\r\n  let locale = null;\r\n  if (lang === 'es' && l10n?.es) {\r\n    locale = l10n.es;\r\n  } else {\r\n    locale = l10n?.default || l10n?.en || l10n?.es || null;\r\n  }\r\n  return locale ? { ...locale, firstDayOfWeek: 1 } : { firstDayOfWeek: 1 };\r\n}\r\n\r\nfunction refreshFlatpickrLocale() {\r\n  const locale = getFlatpickrLocale();\r\n  document.querySelectorAll('input').forEach((input) => {\r\n    const fp = input._flatpickrInstance;\r\n    if (fp && typeof fp.set === 'function') {\r\n      fp.set('locale', locale);\r\n      if (typeof fp.redraw === 'function') {\r\n        fp.redraw();\r\n      }\r\n    }\r\n  });\r\n}\r\n\r\nlet lastDataFingerprint = null;\r\nlet lastCalendarFingerprint = null;\r\nlet calendarRenderDebounceId = null;\r\n\r\nfunction getMaxUpdatedTime(items, getTimeFn) {\r\n    let maxTime = 0;\r\n    const list = Array.isArray(items) ? items : [];\r\n    for (const item of list) {\r\n        const time = getTimeFn ? getTimeFn(item) : Date.parse(item?.updatedAt || item?.createdAt || item?.createdDate || \"\") || 0;\r\n        if (Number.isFinite(time) && time > maxTime) maxTime = time;\r\n    }\r\n    return maxTime;\r\n}\r\n\r\nfunction getIdSum(items) {\r\n    let sum = 0;\r\n    const list = Array.isArray(items) ? items : [];\r\n    for (const item of list) {\r\n        const id = Number(item?.id);\r\n        if (!Number.isNaN(id)) sum += id;\r\n    }\r\n    return sum;\r\n}\r\n\r\nfunction buildDataFingerprint(data) {\r\n    const t = Array.isArray(data?.tasks) ? data.tasks : [];\r\n    const p = Array.isArray(data?.projects) ? data.projects : [];\r\n    const f = Array.isArray(data?.feedbackItems) ? data.feedbackItems : [];\r\n    const tMax = getMaxUpdatedTime(t, typeof getTaskUpdatedTime === \"function\" ? getTaskUpdatedTime : null);\r\n    const pMax = getMaxUpdatedTime(p, (proj) => Date.parse(proj?.updatedAt || proj?.createdAt || \"\") || 0);\r\n    const fMax = getMaxUpdatedTime(f, (fb) => Date.parse(fb?.updatedAt || fb?.createdAt || fb?.createdDate || \"\") || 0);\r\n    return `t:${t.length}:${tMax}:${getIdSum(t)}|p:${p.length}:${pMax}:${getIdSum(p)}|f:${f.length}:${fMax}:${getIdSum(f)}`;\r\n}\r\n\r\nfunction buildCalendarFingerprint(sourceTasks = tasks, sourceProjects = projects) {\r\n    const includeBacklog = !!settings.calendarIncludeBacklog;\r\n    const projectFilter = filterState?.projects;\r\n    const filteredProjectIds = projectFilter && projectFilter.size > 0\r\n        ? new Set(Array.from(projectFilter).map((id) => parseInt(id, 10)))\r\n        : null;\r\n\r\n    let hash = 0;\r\n    let count = 0;\r\n    const list = Array.isArray(sourceTasks) ? sourceTasks : [];\r\n    for (const task of list) {\r\n        if (!task) continue;\r\n        if (!includeBacklog && task.status === 'backlog') continue;\r\n        if (filteredProjectIds && !filteredProjectIds.has(Number(task.projectId))) continue;\r\n        const start = task.startDate || \"\";\r\n        const end = task.endDate || \"\";\r\n        const hasStart = typeof start === 'string' && start.length === 10 && start.includes('-');\r\n        const hasEnd = typeof end === 'string' && end.length === 10 && end.includes('-');\r\n        if (!hasStart && !hasEnd) continue;\r\n\r\n        count++;\r\n        const id = Number(task.id) || 0;\r\n        const status = task.status ? String(task.status) : \"\";\r\n        const proj = Number(task.projectId) || 0;\r\n        const title = task.title ? String(task.title) : \"\";\r\n        const updated = Date.parse(task.updatedAt || task.createdAt || task.createdDate || \"\") || 0;\r\n        hash = ((hash * 31) + id + proj + updated) | 0;\r\n        for (let i = 0; i < start.length; i++) hash = ((hash * 31) + start.charCodeAt(i)) | 0;\r\n        for (let i = 0; i < end.length; i++) hash = ((hash * 31) + end.charCodeAt(i)) | 0;\r\n        for (let i = 0; i < status.length; i++) hash = ((hash * 31) + status.charCodeAt(i)) | 0;\r\n        for (let i = 0; i < title.length; i++) hash = ((hash * 31) + title.charCodeAt(i)) | 0;\r\n    }\r\n\r\n    const projectList = Array.isArray(sourceProjects) ? sourceProjects : [];\r\n    let projectHash = 0;\r\n    let projectCount = 0;\r\n    for (const project of projectList) {\r\n        if (!project) continue;\r\n        if (filteredProjectIds && !filteredProjectIds.has(Number(project.id))) continue;\r\n        projectCount++;\r\n        const pid = Number(project.id) || 0;\r\n        const name = project.name ? String(project.name) : \"\";\r\n        const startDate = project.startDate ? String(project.startDate) : \"\";\r\n        const endDate = project.endDate ? String(project.endDate) : \"\";\r\n        const updatedAt = Date.parse(project.updatedAt || project.createdAt || \"\") || 0;\r\n        projectHash = ((projectHash * 31) + pid + updatedAt) | 0;\r\n        for (let i = 0; i < name.length; i++) projectHash = ((projectHash * 31) + name.charCodeAt(i)) | 0;\r\n        for (let i = 0; i < startDate.length; i++) projectHash = ((projectHash * 31) + startDate.charCodeAt(i)) | 0;\r\n        for (let i = 0; i < endDate.length; i++) projectHash = ((projectHash * 31) + endDate.charCodeAt(i)) | 0;\r\n    }\r\n\r\n    return `m:${currentYear}-${currentMonth + 1}|b:${includeBacklog ? 1 : 0}|pf:${filteredProjectIds ? filteredProjectIds.size : 0}|c:${count}|h:${hash}|pc:${projectCount}|ph:${projectHash}`;\r\n}\r\n\r\nfunction scheduleCalendarRenderDebounced(delayMs = 500) {\r\n    if (calendarRenderDebounceId !== null) {\r\n        clearTimeout(calendarRenderDebounceId);\r\n    }\r\n    calendarRenderDebounceId = setTimeout(() => {\r\n        calendarRenderDebounceId = null;\r\n        renderCalendar();\r\n        lastCalendarFingerprint = buildCalendarFingerprint();\r\n    }, delayMs);\r\n}\r\n\r\nfunction renderWithoutCalendar() {\r\n    updateCounts();\r\n    renderDashboard();\r\n    renderProjects();\r\n    renderTasks();\r\n    renderFeedback();\r\n    renderUpdatesPage();\r\n    renderListView();\r\n    renderAppVersionLabel();\r\n}\r\n\r\nfunction getActivePageId() {\r\n    const active = document.querySelector('.page.active');\r\n    return active ? active.id : null;\r\n}\r\n\r\nfunction applyInitialRouteShell() {\r\n    const hash = window.location.hash.slice(1);\r\n    if (!hash) return;\r\n\r\n    const validPages = ['dashboard', 'projects', 'tasks', 'updates', 'feedback', 'calendar'];\r\n    let pageToShow = 'dashboard';\r\n\r\n    if (hash === 'dashboard/recent_activity') {\r\n        pageToShow = 'dashboard';\r\n    } else if (hash.startsWith('project-')) {\r\n        pageToShow = 'projects';\r\n    } else if (validPages.includes(hash)) {\r\n        pageToShow = hash === 'calendar' ? 'tasks' : hash;\r\n    } else {\r\n        return;\r\n    }\r\n\r\n    document.querySelectorAll(\".page\").forEach((page) => page.classList.remove(\"active\"));\r\n    document.getElementById(pageToShow)?.classList.add(\"active\");\r\n    document.getElementById(\"project-details\")?.classList.remove(\"active\");\r\n\r\n    document.querySelectorAll(\".nav-item\").forEach((nav) => nav.classList.remove(\"active\"));\r\n    if (hash === 'calendar') {\r\n        document.querySelector('.nav-item.calendar-nav')?.classList.add('active');\r\n    } else {\r\n        document.querySelector(`.nav-item[data-page=\"${pageToShow}\"]`)?.classList.add(\"active\");\r\n    }\r\n}\r\n\r\nfunction renderActivePageOnly(options = {}) {\r\n    const calendarChanged = !!options.calendarChanged;\r\n    updateCounts();\r\n    renderAppVersionLabel();\r\n\r\n    const activeId = getActivePageId();\r\n    if (activeId === \"dashboard\") {\r\n        renderDashboard();\r\n        return;\r\n    }\r\n    if (activeId === \"projects\") {\r\n        renderProjects();\r\n        return;\r\n    }\r\n    if (activeId === \"tasks\") {\r\n        try { applyBacklogFilterVisibility(); } catch (e) {}\r\n        const kanbanBoard = document.querySelector(\".kanban-board\");\r\n        if (kanbanBoard && !kanbanBoard.classList.contains(\"hidden\")) {\r\n            renderTasks();\r\n        }\r\n        if (getIsMobileCached() || document.getElementById(\"list-view\")?.classList.contains(\"active\")) {\r\n            renderListView();\r\n        }\r\n        if (document.getElementById(\"calendar-view\")?.classList.contains(\"active\")) {\r\n            if (calendarChanged) {\r\n                logPerformanceMilestone('calendar-refresh-debounced', { reason: 'data-changed' });\r\n                scheduleCalendarRenderDebounced(500);\r\n            } else {\r\n                logPerformanceMilestone('calendar-refresh-skipped', { reason: 'fingerprint-match' });\r\n            }\r\n        }\r\n        return;\r\n    }\r\n    if (activeId === \"updates\") {\r\n        renderUpdatesPage();\r\n        return;\r\n    }\r\n    if (activeId === \"feedback\") {\r\n        renderFeedback();\r\n    }\r\n\r\n    const projectDetailsView = document.getElementById(\"project-details\");\r\n    if (projectDetailsView && projectDetailsView.classList.contains(\"active\")) {\r\n        const hash = window.location.hash.slice(1);\r\n        if (hash.startsWith('project-')) {\r\n            const projectId = parseInt(hash.replace('project-', ''), 10);\r\n            if (!Number.isNaN(projectId)) {\r\n                showProjectDetails(projectId);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// Prevent double initialization\r\nlet isInitialized = false;\r\n\r\nexport async function init(options = {}) {\r\n    // Prevent multiple simultaneous initializations\r\n    if (isInitialized) {\r\n        // console.log('[PERF] Init already completed, skipping duplicate call');\r\n        return;\r\n    }\r\n    isInitialized = true;\r\n    const skipCache = !!options.skipCache;\r\n    logPerformanceMilestone('init-start', {\r\n        hasAuth: !!localStorage.getItem('authToken'),\r\n        hasAdmin: !!localStorage.getItem('adminToken')\r\n    });\r\n    const initTimer = debugTimeStart(\"init\", \"init\", {\r\n        hasAuth: !!localStorage.getItem('authToken'),\r\n        hasAdmin: !!localStorage.getItem('adminToken')\r\n    });\r\n\r\n    // console.time('[PERF] Total Init Time');\r\n\r\n    // Don't initialize if not authenticated (auth.js will call this when ready)\r\n    if (!localStorage.getItem('authToken') && !localStorage.getItem('adminToken')) {\r\n        console.log('Waiting for authentication before initializing app...');\r\n        isInitialized = false;\r\n        return;\r\n    }\r\n\r\n    // console.time('[PERF] Authentication Check');\r\n    // Progress tracking\r\n    if (typeof updateBootSplashProgress === 'function') {\r\n        updateBootSplashProgress(10); // Starting initialization\r\n    }\r\n    // console.timeEnd('[PERF] Authentication Check');\r\n\r\n    // Clear old data before loading new user's data\r\n    // This ensures clean state when switching users\r\n    projects = [];\r\n    tasks = [];\r\n    feedbackItems = [];\r\n    projectCounter = 1;\r\n    taskCounter = 1;\r\n\r\n    isInitializing = true;\r\n\r\n    if (typeof updateBootSplashProgress === 'function') {\r\n        updateBootSplashProgress(20); // Loading data...\r\n    }\r\n\r\n    // Pre-apply the route shell to avoid dashboard flash on deep links (e.g. /tasks).\r\n    // Rendering still waits for data load, but the correct page is visible immediately.\r\n    applyInitialRouteShell();\r\n    markPerfOnce('first_skeleton_paint', { reason: 'route-shell' });\r\n\r\n    // console.time('[PERF] Load All Data');\r\n    // Load fresh data directly (no SWR caching - simpler and avoids stale data bugs)\r\n    const handleAllDataRefresh = (fresh) => {\r\n        if (!fresh) return;\r\n        const nextFingerprint = buildDataFingerprint(fresh);\r\n        const currentFingerprint = buildDataFingerprint({ tasks, projects, feedbackItems });\r\n        if (nextFingerprint === currentFingerprint) return;\r\n\r\n        applyLoadedAllData(fresh);\r\n        // Delta queue removed - saves happen on change\r\n\r\n        const nextCalendarFingerprint = buildCalendarFingerprint(fresh.tasks || tasks, fresh.projects || projects);\r\n        const calendarChanged = lastCalendarFingerprint && nextCalendarFingerprint !== lastCalendarFingerprint;\r\n        lastDataFingerprint = nextFingerprint;\r\n        lastCalendarFingerprint = nextCalendarFingerprint;\r\n        renderActivePageOnly({ calendarChanged });\r\n    };\r\n\r\n    const allDataPromise = loadAllData({\r\n        preferCache: !skipCache,\r\n        onRefresh: skipCache ? null : handleAllDataRefresh,\r\n        feedback: {\r\n            limitPending: FEEDBACK_ITEMS_PER_PAGE,\r\n            limitDone: FEEDBACK_ITEMS_PER_PAGE,\r\n            cacheKey: FEEDBACK_CACHE_KEY,\r\n            preferCache: !skipCache\r\n        }\r\n    });\r\n    const sortStatePromise = loadSortStateData().catch(() => null);\r\n    const projectColorsPromise = loadProjectColorsData().catch(() => ({}));\r\n    const settingsPromise = loadSettingsData().catch(() => ({}));\r\n    const historyPromise = window.historyService?.loadHistory\r\n        ? window.historyService.loadHistory().catch(() => null)\r\n        : Promise.resolve(null);\r\n\r\n    const loadTimer = debugTimeStart(\"init\", \"load-data\");\r\n\r\n    // Apply cached data ASAP so the UI isn't blank while other async loads finish.\r\n    const allData = await allDataPromise;\r\n    if (typeof updateBootSplashProgress === 'function') {\r\n        updateBootSplashProgress(50); // Cached data ready (if available)\r\n    }\r\n    applyLoadedAllData(allData);\r\n    // Delta queue removed - saves happen on change\r\n    // Fast render from cached data so the UI isn't empty while other async loads finish.\r\n    renderActivePageOnly();\r\n\r\n    const [sortState, loadedProjectColors, loadedSettings] = await Promise.all([\r\n        sortStatePromise,\r\n        projectColorsPromise,\r\n        settingsPromise,\r\n        historyPromise,\r\n    ]);\r\n    debugTimeEnd(\"init\", loadTimer, {\r\n        taskCount: allData?.tasks?.length || 0,\r\n        projectCount: allData?.projects?.length || 0,\r\n        feedbackCount: allData?.feedbackItems?.length || 0\r\n    });\r\n    logPerformanceMilestone('init-data-loaded', {\r\n        taskCount: allData?.tasks?.length || 0,\r\n        projectCount: allData?.projects?.length || 0,\r\n        feedbackCount: allData?.feedbackItems?.length || 0\r\n    });\r\n    // console.timeEnd('[PERF] Load All Data');\r\n\r\n    if (typeof updateBootSplashProgress === 'function') {\r\n        updateBootSplashProgress(60); // Data loaded, applying...\r\n    }\r\n\r\n    // Apply sort prefs (keep the same normalization behavior as loadSortPreferences)\r\n    if (sortState && typeof sortState === \"object\") {\r\n        const savedMode = sortState.sortMode;\r\n        const savedOrder = sortState.manualTaskOrder;\r\n        if (savedMode) sortMode = savedMode;\r\n        if (savedOrder) manualTaskOrder = savedOrder;\r\n    } else {\r\n        try {\r\n            const lm = localStorage.getItem('sortMode');\r\n            const lo = localStorage.getItem('manualTaskOrder');\r\n            if (lm) sortMode = lm;\r\n            if (lo) manualTaskOrder = JSON.parse(lo);\r\n        } catch (err) {}\r\n    }\r\n    // Normalize/guard persisted values (older versions used 'auto' to mean priority ordering)\r\n    if (sortMode === 'auto' || (sortMode !== 'priority' && sortMode !== 'manual')) {\r\n        sortMode = 'priority';\r\n    }\r\n    updateSortUI();\r\n\r\n    projectColorMap = loadedProjectColors && typeof loadedProjectColors === \"object\" ? loadedProjectColors : {};\r\n\r\n    if (loadedSettings && typeof loadedSettings === \"object\") {\r\n        settings = { ...settings, ...loadedSettings };\r\n    }\r\n    settings.language = normalizeLanguage(settings.language);\r\n    applyDebugLogSetting(settings.debugLogsEnabled);\r\n    if (perfDebugForced) {\r\n        settings.debugLogsEnabled = true;\r\n        applyDebugLogSetting(true);\r\n    }\r\n    applyWorkspaceLogo(); // Apply any custom workspace logo\r\n\r\n    // Sync window.enableReviewStatus with settings\r\n    if (typeof settings.enableReviewStatus !== 'undefined') {\r\n        window.enableReviewStatus = settings.enableReviewStatus;\r\n        localStorage.setItem('enableReviewStatus', String(settings.enableReviewStatus));\r\n    }\r\n    applyReviewStatusVisibility(); // Apply review status visibility\r\n    applyBacklogColumnVisibility(); // Apply backlog column visibility\r\n\r\n    if (typeof updateBootSplashProgress === 'function') {\r\n        updateBootSplashProgress(75); // Setting up UI...\r\n    }\r\n\r\n    // console.time('[PERF] Setup UI');\r\n    // Basic app setup\r\n    setupNavigation();\r\n    setupStatusDropdown();\r\n    setupPriorityDropdown();\r\n    setupProjectDropdown();\r\n    setupUserMenus();\r\n    setupNotificationMenu();\r\n    hydrateUserProfile();\r\n    initializeDatePickers();\r\n    initFiltersUI();\r\n    setupModalTabs();\r\n    applyLanguage();\r\n    logPerformanceMilestone('init-ui-ready');\r\n    // console.timeEnd('[PERF] Setup UI');\r\n\r\n    if (typeof updateBootSplashProgress === 'function') {\r\n        updateBootSplashProgress(90); // Rendering...\r\n    }\r\n\r\n    // Finished initializing - allow saves again\r\n    isInitializing = false;\r\n\r\n    // console.time('[PERF] Initial Rendering');\r\n    // On a full refresh, always start with a clean slate (no persisted filters).\r\n    // This intentionally ignores any hash query params and clears any saved view state.\r\n    filterState.search = \"\";\r\n    filterState.statuses.clear();\r\n    filterState.priorities.clear();\r\n    filterState.projects.clear();\r\n    filterState.tags.clear();\r\n    filterState.datePresets.clear();\r\n    filterState.dateFrom = \"\";\r\n    filterState.dateTo = \"\";\r\n\r\n    projectFilterState.search = \"\";\r\n    projectFilterState.statuses.clear();\r\n    projectFilterState.taskFilter = \"\";\r\n    projectFilterState.updatedFilter = \"all\";\r\n\r\n    try { localStorage.removeItem('projectsViewState'); } catch (e) {}\r\n    try { localStorage.removeItem('kanbanUpdatedFilter'); } catch (e) {}\r\n    window.kanbanUpdatedFilter = 'all';\r\n\r\n    // Allow URL parameters to persist for deep linking and sharing filtered views\r\n\r\n    // Check for URL hash\r\n    const hash = window.location.hash.slice(1);\r\n    const validPages = ['dashboard', 'projects', 'tasks', 'updates', 'feedback', 'calendar'];\r\n\r\n    // Clear all nav highlights first\r\n    document.querySelectorAll(\".nav-item\").forEach((nav) => nav.classList.remove(\"active\"));\r\n\r\n    if (hash === 'calendar') {\r\n        // Show calendar view directly on initial load\r\n        showCalendarView();\r\n    } else if (hash === 'dashboard/recent_activity') {\r\n        // Handle recent activity subpage\r\n        document.querySelector('.nav-item[data-page=\"dashboard\"]')?.classList.add(\"active\");\r\n        showPage('dashboard/recent_activity');\r\n    } else if (hash.startsWith('project-')) {\r\n        // Handle project detail URLs\r\n        const projectId = parseInt(hash.replace('project-', ''));\r\n        document.querySelector('.nav-item[data-page=\"projects\"]')?.classList.add(\"active\");\r\n        showProjectDetails(projectId);\r\n    } else {\r\n        // Normal page navigation\r\n        const pageToShow = validPages.includes(hash) ? (hash === 'calendar' ? 'tasks' : hash) : 'dashboard';\r\n        const navItem = document.querySelector(`.nav-item[data-page=\"${pageToShow}\"]`);\r\n        if (hash === 'calendar') {\r\n            // Ensure calendar nav is highlighted\r\n            document.querySelector('.nav-item.calendar-nav')?.classList.add('active');\r\n        } else {\r\n            if (navItem) navItem.classList.add(\"active\");\r\n        }\r\n        // Just show the page without rendering - routing below handles the first render\r\n        document.querySelectorAll(\".page\").forEach((page) => page.classList.remove(\"active\"));\r\n        document.getElementById(pageToShow).classList.add(\"active\");\r\n        if (hash === 'calendar') {\r\n            // Switch to calendar sub-view after tasks page mounts\r\n            document.querySelector('.kanban-board')?.classList.add('hidden');\r\n            document.getElementById('list-view')?.classList.remove('active');\r\n            document.getElementById('calendar-view')?.classList.add('active');\r\n            const viewToggle = document.querySelector('.view-toggle');\r\n            if (viewToggle) viewToggle.classList.add('hidden');\r\n            // Hide filters in calendar view\r\n            const globalFilters = document.getElementById('global-filters');\r\n            if (globalFilters) globalFilters.style.display = 'none';\r\n            renderCalendar();\r\n        }\r\n    }\r\n\r\n    // Initial rendering is handled by routing below.\r\n    // console.timeEnd('[PERF] Initial Rendering');\r\n\r\n    // Initialization complete\r\n    if (typeof updateBootSplashProgress === 'function') {\r\n        updateBootSplashProgress(100); // Complete!\r\n    }\r\n\r\n    // console.time('[PERF] Initialize Notifications');\r\n    // Initialize notifications ONCE after app is fully loaded\r\n    // This is much faster than running on every notification state build\r\n    if (!USE_SERVER_NOTIFICATIONS) {\r\n        checkAndCreateDueTodayNotifications();\r\n        cleanupOldNotifications();\r\n    }\r\n    logPerformanceMilestone('init-notifications-ready');\r\n    // console.timeEnd('[PERF] Initialize Notifications');\r\n    // console.timeEnd('[PERF] Paint & Finalize');\r\n\r\n    // console.timeEnd('[PERF] Total Init Time');\r\n    debugTimeEnd(\"init\", initTimer, {\r\n        taskCount: tasks.length,\r\n        projectCount: projects.length,\r\n        feedbackCount: feedbackItems.length,\r\n        pendingSaves\r\n    });\r\n    logPerformanceMilestone('init-complete', {\r\n        taskCount: tasks.length,\r\n        projectCount: projects.length,\r\n        feedbackCount: feedbackItems.length\r\n    });\r\n    markPerfOnce('interactive_ready', {\r\n        taskCount: tasks.length,\r\n        projectCount: projects.length\r\n    });\r\n\r\n    // Route handler function (used for both initial load and hashchange)\r\n    function handleRouting() {\r\n        const hash = window.location.hash.slice(1); // Remove #\r\n\r\n        // Parse hash and query parameters\r\n        const [page, queryString] = hash.split('?');\r\n        const params = new URLSearchParams(queryString || '');\r\n\r\n        // Skip auth-related hashes (let auth.js handle these)\r\n        if (page === 'login' || page === 'admin-login' || page === 'setup') {\r\n            return;\r\n        }\r\n\r\n        // Clear all nav highlights first\r\n        document.querySelectorAll(\".nav-item\").forEach((nav) => nav.classList.remove(\"active\"));\r\n\r\n        if (page === 'dashboard/recent_activity') {\r\n            projectNavigationReferrer = 'projects'; // Reset referrer when leaving project details\r\n            document.querySelector('.nav-item[data-page=\"dashboard\"]')?.classList.add(\"active\");\r\n            showPage('dashboard/recent_activity');\r\n            previousPage = page;\r\n        } else if (page.startsWith('project-')) {\r\n            const projectId = parseInt(page.replace('project-', ''));\r\n            document.querySelector('.nav-item[data-page=\"projects\"]')?.classList.add(\"active\");\r\n            showProjectDetails(projectId);\r\n            previousPage = page;\r\n        } else if (page === 'calendar') {\r\n            projectNavigationReferrer = 'projects'; // Reset referrer when leaving project details\r\n            // Avoid thrashing: highlight and ensure calendar is visible\r\n            document.querySelector('.nav-item.calendar-nav')?.classList.add('active');\r\n            showCalendarView();\r\n            previousPage = page;\r\n        } else if (page === 'tasks') {\r\n            projectNavigationReferrer = 'projects'; // Reset referrer when leaving project details\r\n            document.querySelector('.nav-item[data-page=\"tasks\"]')?.classList.add(\"active\");\r\n\r\n            // Apply ALL filters from URL parameters BEFORE showing page\r\n\r\n            // Search filter\r\n            if (params.has('search')) {\r\n                filterState.search = (params.get('search') || '').trim().toLowerCase();\r\n            } else {\r\n                filterState.search = '';\r\n            }\r\n\r\n            // Status filters\r\n            if (params.has('status')) {\r\n                const statuses = params.get('status').split(',').filter(Boolean);\r\n                filterState.statuses.clear();\r\n                statuses.forEach(s => filterState.statuses.add(s.trim()));\r\n                filterState.statusExcludeMode = params.get('statusExclude') === '1';\r\n            } else {\r\n                filterState.statuses.clear();\r\n                filterState.statusExcludeMode = false;\r\n            }\r\n\r\n            // Priority filters\r\n            if (params.has('priority')) {\r\n                const priorities = params.get('priority').split(',').filter(Boolean);\r\n                filterState.priorities.clear();\r\n                priorities.forEach(p => filterState.priorities.add(p.trim()));\r\n                filterState.priorityExcludeMode = params.get('priorityExclude') === '1';\r\n            } else {\r\n                filterState.priorities.clear();\r\n                filterState.priorityExcludeMode = false;\r\n            }\r\n\r\n            // Project filters\r\n            if (params.has('project')) {\r\n                const projectIds = params.get('project').split(',').filter(Boolean);\r\n                filterState.projects.clear();\r\n                projectIds.forEach(id => filterState.projects.add(id.trim()));\r\n                filterState.projectExcludeMode = params.get('projectExclude') === '1';\r\n            } else {\r\n                filterState.projects.clear();\r\n                filterState.projectExcludeMode = false;\r\n            }\r\n\r\n            // Tag filters\r\n            if (params.has('tags')) {\r\n                const tags = params.get('tags').split(',').filter(Boolean);\r\n                filterState.tags.clear();\r\n                tags.forEach(t => filterState.tags.add(t.trim()));\r\n                filterState.tagExcludeMode = params.get('tagExclude') === '1';\r\n            } else {\r\n                filterState.tags.clear();\r\n                filterState.tagExcludeMode = false;\r\n            }\r\n\r\n            // Date preset filters\r\n            if (params.has('datePreset')) {\r\n                const datePresetParam = params.get('datePreset') || '';\r\n                const presets = datePresetParam.split(',').filter(Boolean);\r\n                filterState.datePresets.clear();\r\n                presets.forEach(p => filterState.datePresets.add(p.trim()));\r\n                // Clear manual date inputs when preset is set\r\n                filterState.dateFrom = '';\r\n                filterState.dateTo = '';\r\n                filterState.dateField = 'endDate'; // Default to end date\r\n            } else if (params.has('dateFrom') || params.has('dateTo')) {\r\n                const dateFrom = params.get('dateFrom') || '';\r\n                const dateTo = params.get('dateTo') || '';\r\n                filterState.dateFrom = dateFrom;\r\n                filterState.dateTo = dateTo;\r\n                filterState.dateField = params.get('dateField') || 'endDate'; // Use startDate or endDate\r\n                // Clear preset when manual dates are set\r\n                filterState.datePresets.clear();\r\n            } else {\r\n                filterState.datePresets.clear();\r\n                filterState.dateFrom = '';\r\n                filterState.dateTo = '';\r\n                filterState.dateField = 'endDate';\r\n            }\r\n\r\n            // Handle updated filter (last 5 minutes, etc.)\r\n            if (params.has('updated')) {\r\n                const updatedValue = params.get('updated');\r\n                const allowed = new Set(['all', '5m', '30m', '24h', 'week', 'month']);\r\n                if (allowed.has(updatedValue)) {\r\n                    try {\r\n                        setKanbanUpdatedFilter(updatedValue, { render: false });\r\n                    } catch (e) {\r\n                        console.error('Failed to set kanbanUpdatedFilter from URL:', e);\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Handle view parameter (kanban, list, or calendar)\r\n            if (params.has('view')) {\r\n                const view = params.get('view');\r\n                if (view === 'list' || view === 'kanban' || view === 'calendar') {\r\n                    setTimeout(() => {\r\n                        const viewButtons = document.querySelectorAll('.view-btn');\r\n                        const viewButton = Array.from(viewButtons).find(btn => btn.dataset.view === view);\r\n                        if (viewButton && !viewButton.classList.contains('active')) {\r\n                            viewButton.click();\r\n                        }\r\n                    }, 100);\r\n                }\r\n            }\r\n\r\n            // Now show the page (which will render with updated filters and handle view logic)\r\n            showPage('tasks');\r\n\r\n            // Update ALL filter UI inputs after page is shown (use setTimeout to ensure DOM is ready)\r\n            setTimeout(() => {\r\n                // Search input - always update to match filterState\r\n                const searchEl = document.getElementById('filter-search');\r\n                if (searchEl) searchEl.value = filterState.search;\r\n\r\n                // Status checkboxes\r\n                document.querySelectorAll('input[data-filter=\"status\"]').forEach(cb => {\r\n                    cb.checked = filterState.statuses.has(cb.value);\r\n                });\r\n\r\n                // Priority checkboxes\r\n                document.querySelectorAll('input[data-filter=\"priority\"]').forEach(cb => {\r\n                    cb.checked = filterState.priorities.has(cb.value);\r\n                });\r\n\r\n                // Project checkboxes\r\n                document.querySelectorAll('input[data-filter=\"project\"]').forEach(cb => {\r\n                    cb.checked = filterState.projects.has(cb.value);\r\n                });\r\n\r\n                // Tag checkboxes\r\n                document.querySelectorAll('input[data-filter=\"tag\"]').forEach(cb => {\r\n                    cb.checked = filterState.tags.has(cb.value);\r\n                });\r\n\r\n                // Date preset checkboxes\r\n                document.querySelectorAll('input[data-filter=\"date-preset\"]').forEach(cb => {\r\n                    cb.checked = filterState.datePresets.has(cb.value);\r\n                });\r\n\r\n                // Date range inputs\r\n                const dateFromEl = document.getElementById('filter-date-from');\r\n                const dateToEl = document.getElementById('filter-date-to');\r\n\r\n                if (dateFromEl && filterState.dateFrom) {\r\n                    dateFromEl.value = filterState.dateFrom;\r\n                    const displayInput = dateFromEl.closest('.date-input-wrapper')?.querySelector('.date-display');\r\n                    if (displayInput) displayInput.value = formatDate(filterState.dateFrom);\r\n                }\r\n\r\n                if (dateToEl && filterState.dateTo) {\r\n                    dateToEl.value = filterState.dateTo;\r\n                    const displayInput = dateToEl.closest('.date-input-wrapper')?.querySelector('.date-display');\r\n                    if (displayInput) displayInput.value = formatDate(filterState.dateTo);\r\n                }\r\n\r\n                // Update filter badges and active chips to reflect URL filters\r\n                updateAllFilterModeUI();\r\n                updateFilterBadges();\r\n                renderActiveFilterChips();\r\n                updateClearButtonVisibility();\r\n            }, 100);\r\n\r\n            previousPage = page;\r\n        } else if (page === 'projects') {\r\n            projectNavigationReferrer = 'projects'; // Reset referrer when leaving project details\r\n            document.querySelector('.nav-item[data-page=\"projects\"]')?.classList.add(\"active\");\r\n\r\n            // Parse URL parameters for deep linking (similar to Tasks page)\r\n            const urlProjectFilters = {};\r\n\r\n            if (params.has('search')) {\r\n                urlProjectFilters.search = params.get('search');\r\n            }\r\n\r\n            // Status filter (comma-separated: planning, active, completed)\r\n            if (params.has('status')) {\r\n                const statuses = params.get('status').split(',').filter(Boolean);\r\n                const validStatuses = ['backlog', 'planning', 'active', 'completed'];\r\n                urlProjectFilters.statuses = statuses.filter(s => validStatuses.includes(s.trim()));\r\n            }\r\n\r\n            // Chip filter (has-tasks or no-tasks)\r\n            if (params.has('filter')) {\r\n                const filter = params.get('filter');\r\n                const validFilters = ['has-tasks', 'no-tasks'];\r\n                if (validFilters.includes(filter)) {\r\n                    urlProjectFilters.filter = filter;\r\n                }\r\n            }\r\n\r\n            if (params.has('sort')) {\r\n                const sort = params.get('sort');\r\n                const validSorts = ['default', 'name', 'created-desc', 'updated-desc', 'tasks-desc', 'completion-desc'];\r\n                if (validSorts.includes(sort)) {\r\n                    urlProjectFilters.sort = sort;\r\n                }\r\n            }\r\n\r\n            if (params.has('sortDirection')) {\r\n                const sortDirection = params.get('sortDirection');\r\n                if (sortDirection === 'asc' || sortDirection === 'desc') {\r\n                    urlProjectFilters.sortDirection = sortDirection;\r\n                }\r\n            }\r\n\r\n            if (params.has('updatedFilter')) {\r\n                const updatedFilter = params.get('updatedFilter');\r\n                const validUpdatedFilters = ['all', '5m', '30m', '24h', 'week', 'month'];\r\n                if (validUpdatedFilters.includes(updatedFilter)) {\r\n                    urlProjectFilters.updatedFilter = updatedFilter;\r\n                }\r\n            }\r\n\r\n            // Store URL filters temporarily for setupProjectsControls to use\r\n            window.urlProjectFilters = urlProjectFilters;\r\n\r\n            showPage('projects');\r\n            previousPage = page;\r\n        } else if (page === 'updates') {\r\n            projectNavigationReferrer = 'projects'; // Reset referrer when leaving project details\r\n            document.querySelector('.nav-item[data-page=\"updates\"]')?.classList.add(\"active\");\r\n            showPage('updates');\r\n            previousPage = page;\r\n        } else if (page === 'feedback') {\r\n            projectNavigationReferrer = 'projects'; // Reset referrer when leaving project details\r\n            document.querySelector('.nav-item[data-page=\"feedback\"]')?.classList.add(\"active\");\r\n            showPage('feedback');\r\n            previousPage = page;\r\n        } else if (page === '' || page === 'dashboard') {\r\n            projectNavigationReferrer = 'projects'; // Reset referrer when leaving project details\r\n            document.querySelector('.nav-item[data-page=\"dashboard\"]')?.classList.add(\"active\");\r\n            showPage('dashboard');\r\n            previousPage = page || 'dashboard';\r\n        }\r\n    }\r\n\r\n    // Handle initial URL on page load\r\n    handleRouting();\r\n\r\n    markPerfOnce('first_contentful_page_ready', {\r\n        page: document.querySelector('.page.active')?.id || 'unknown'\r\n    });\r\n    lastDataFingerprint = buildDataFingerprint({ tasks, projects, feedbackItems });\r\n    lastCalendarFingerprint = buildCalendarFingerprint(tasks, projects);\r\n    markPerfOnce('init-render-complete');\r\n\r\n    // Ensure the first render is actually painted before we claim \"ready\"\r\n    await new Promise(requestAnimationFrame);\r\n    await new Promise(requestAnimationFrame);\r\n    markPerfOnce('init-first-paint');\r\n\r\n    // Add hashchange event listener for URL routing\r\n    window.addEventListener('hashchange', handleRouting);\r\n\r\n    // View switching between Kanban, List, and Calendar\r\n    document.querySelectorAll(\".view-btn\").forEach((btn) => {\r\n        btn.addEventListener(\"click\", (e) => {\r\n            document.querySelectorAll(\".view-btn\").forEach((b) => b.classList.remove(\"active\"));\r\n            const button = e.currentTarget;\r\n            button.classList.add(\"active\");\r\n\r\n            const view = (button.dataset.view || '').toLowerCase();\r\n            try {\r\n                const backlogBtn = document.getElementById('backlog-quick-btn');\r\n                if (backlogBtn) backlogBtn.style.display = (view === 'kanban') ? 'inline-flex' : 'none';\r\n            } catch (e) {}\r\n\r\n            document.querySelector(\".kanban-board\").classList.add(\"hidden\");\r\n            document.getElementById(\"list-view\").classList.remove(\"active\");\r\n            document.getElementById(\"calendar-view\").classList.remove(\"active\");\r\n\r\n            // Restore \"All Tasks\" title when leaving calendar\r\n            const pageTitle = document.querySelector('#tasks .page-title');\r\n            if (pageTitle) pageTitle.textContent = t('tasks.title');\r\n\r\n            if (view === \"list\") {\r\n                // Show filters in list view\r\n                const globalFilters = document.getElementById('global-filters');\r\n                if (globalFilters) globalFilters.style.display = '';\r\n                document.getElementById(\"list-view\").classList.add(\"active\");\r\n                renderListView();\r\n                updateSortUI();\r\n                // ensure kanban header is in default state\r\n                try{ document.querySelector('.kanban-header')?.classList.remove('calendar-mode'); }catch(e){}\r\n                // Hide kanban settings in list view\r\n                const kanbanSettingsContainer = document.getElementById('kanban-settings-btn')?.parentElement;\r\n                if (kanbanSettingsContainer) kanbanSettingsContainer.style.display = 'none';\r\n                // Update URL to include view parameter\r\n                syncURLWithFilters();\r\n                try { applyBacklogFilterVisibility(); } catch (e) {}\r\n            } else if (view === \"kanban\") {\r\n                // Show backlog button in kanban view\r\n                const backlogBtn = document.getElementById('backlog-quick-btn');\r\n                if (backlogBtn) backlogBtn.style.display = 'inline-flex';\r\n                // Show filters in kanban view\r\n                const globalFilters = document.getElementById('global-filters');\r\n                if (globalFilters) globalFilters.style.display = '';\r\n                document.querySelector(\".kanban-board\").classList.remove(\"hidden\");\r\n                renderTasks();\r\n                updateSortUI();\r\n                // ensure kanban header is in default state\r\n                try{ document.querySelector('.kanban-header')?.classList.remove('calendar-mode'); }catch(e){}\r\n                // Show kanban settings in kanban view\r\n                const kanbanSettingsContainer = document.getElementById('kanban-settings-btn')?.parentElement;\r\n                if (kanbanSettingsContainer) kanbanSettingsContainer.style.display = '';\r\n                // Update URL to remove view parameter (kanban is default)\r\n                syncURLWithFilters();\r\n                try { applyBacklogFilterVisibility(); } catch (e) {}\r\n            } else if (view === \"calendar\") {\r\n                const cal = document.getElementById(\"calendar-view\");\r\n                if (!cal) return;\r\n                // Hide only the backlog quick button in calendar view (keep filters visible)\r\n                const backlogBtn = document.getElementById('backlog-quick-btn');\r\n                if (backlogBtn) backlogBtn.style.display = 'none';\r\n                // Hide kanban settings in calendar view\r\n                const kanbanSettingsContainer = document.getElementById('kanban-settings-btn')?.parentElement;\r\n                if (kanbanSettingsContainer) kanbanSettingsContainer.style.display = 'none';\r\n                // Step 1: mark as preparing and render offscreen\r\n                cal.classList.add('preparing');\r\n                // Ensure grid exists to populate\r\n                renderCalendar();\r\n                // Step 2: after bars are drawn, swap to active and clear preparing\r\n                requestAnimationFrame(() => {\r\n                    requestAnimationFrame(() => {\r\n                        // One more draw to be safe\r\n                        renderProjectBars();\r\n                        cal.classList.remove('preparing');\r\n                        cal.classList.add('active');\r\n                        updateSortUI();\r\n                        // Update URL to include view parameter\r\n                        syncURLWithFilters();\r\n                        try { applyBacklogFilterVisibility(); } catch (e) {}\r\n                    });\r\n                });\r\n            }\r\n        });\r\n    });\r\n\r\n    // Kanban quick access: open Backlog in List view\r\n    try {\r\n        const existing = document.getElementById('backlog-quick-btn');\r\n        const viewToggle = document.querySelector('.kanban-header .view-toggle');\r\n        if (!existing && viewToggle && viewToggle.parentElement) {\r\n            const backlogBtn = document.createElement('button');\r\n            backlogBtn.type = 'button';\r\n            backlogBtn.id = 'backlog-quick-btn';\r\n            backlogBtn.className = 'backlog-quick-btn';\r\n            backlogBtn.title = t('tasks.backlogQuickTitle');\r\n            backlogBtn.textContent = t('tasks.backlogQuickLabel');\r\n            backlogBtn.addEventListener('click', (evt) => {\r\n                evt.preventDefault();\r\n                window.location.hash = '#tasks?view=list&status=backlog';\r\n            });\r\n            viewToggle.insertAdjacentElement('afterend', backlogBtn);\r\n\r\n            // Only show in Kanban view\r\n            const activeView = (document.querySelector('.view-btn.active')?.dataset.view || '').trim().toLowerCase();\r\n            backlogBtn.style.display = (activeView === 'kanban') ? 'inline-flex' : 'none';\r\n        }\r\n    } catch (e) {}\r\n    \r\n    // Setup dashboard interactions\r\n    setupDashboardInteractions();\r\n}\r\n\r\nfunction setupDashboardInteractions() {\r\n    // Time filter chips\r\n    const filterChips = document.querySelectorAll('.filter-chip');\r\n    filterChips.forEach(chip => {\r\n        chip.addEventListener('click', function() {\r\n            filterChips.forEach(c => c.classList.remove('active'));\r\n            this.classList.add('active');\r\n            const period = this.dataset.period;\r\n            updateDashboardForPeriod(period);\r\n        });\r\n    });\r\n    \r\n    // Enhanced stat card interactions\r\n    const statCards = document.querySelectorAll('.enhanced-stat-card');\r\n    statCards.forEach(card => {\r\n        // Hover effects\r\n        card.addEventListener('mouseenter', function() {\r\n            this.style.transform = 'translateY(-4px) scale(1.02)';\r\n        });\r\n        \r\n        card.addEventListener('mouseleave', function() {\r\n            this.style.transform = 'translateY(0) scale(1)';\r\n        });\r\n        \r\n        // Click to navigate to filtered tasks\r\n        card.addEventListener('click', function() {\r\n            const filterType = this.dataset.filter;\r\n            const filterValue = this.dataset.value;\r\n            \r\n            if (filterType && filterValue) {\r\n                navigateToFilteredTasks(filterType, filterValue);\r\n            }\r\n        });\r\n    });\r\n    \r\n    // Quick action interactions\r\n    const quickActions = document.querySelectorAll('.quick-action');\r\n    quickActions.forEach(action => {\r\n        action.addEventListener('click', function() {\r\n            this.style.transform = 'scale(0.95)';\r\n            setTimeout(() => {\r\n                this.style.transform = 'scale(1)';\r\n            }, 150);\r\n        });\r\n    });\r\n}\r\n\r\nfunction navigateToFilteredTasks(filterType, filterValue) {\r\n    // Navigate to tasks page\r\n    window.location.hash = 'tasks';\r\n    \r\n    // Clear all nav highlights and set tasks as active\r\n    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));\r\n    const tasksNavItem = document.querySelector('.nav-item[data-page=\"tasks\"]');\r\n    if (tasksNavItem) tasksNavItem.classList.add('active');\r\n    \r\n    // Show tasks page\r\n    showPage('tasks');\r\n    \r\n    // Ensure view toggle is visible\r\n    const viewToggle = document.querySelector('.view-toggle');\r\n    if (viewToggle) viewToggle.classList.remove('hidden');\r\n    \r\n    // Switch to Kanban view\r\n    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));\r\n    const kanbanBtn = document.querySelector('.view-btn:first-child');\r\n    if (kanbanBtn) kanbanBtn.classList.add('active');\r\n    \r\n    // Show kanban, hide list and calendar\r\n    const kanbanBoard = document.querySelector('.kanban-board');\r\n    const listView = document.getElementById('list-view');\r\n    const calendarView = document.getElementById('calendar-view');\r\n    \r\n    if (kanbanBoard) kanbanBoard.classList.remove('hidden');\r\n    if (calendarView) calendarView.classList.remove('active');\r\n    if (listView) listView.classList.remove('active');\r\n\r\n    // ensure header returns to default when navigating to filtered Kanban\r\n    try{ document.querySelector('.kanban-header')?.classList.remove('calendar-mode'); }catch(e){}\r\n    \r\n    // Clear existing filters first\r\n    clearAllFilters();\r\n    \r\n    // Apply the specific filter\r\n    setTimeout(() => {\r\n        applyDashboardFilter(filterType, filterValue);\r\n        renderTasks(); // Use renderTasks for Kanban view\r\n    }, 100);\r\n}\r\n\r\nfunction applyDashboardFilter(filterType, filterValue) {\r\n    if (filterType === 'status') {\r\n        // Apply status filter\r\n        filterState.statuses.clear();\r\n        filterState.statuses.add(filterValue);\r\n        filterState.statusExcludeMode = false;\r\n        filterState.priorityExcludeMode = false;\r\n        filterState.projectExcludeMode = false;\r\n        filterState.tagExcludeMode = false;\r\n        \r\n        // Update status filter UI\r\n        const statusCheckboxes = document.querySelectorAll('input[data-filter=\"status\"]');\r\n        statusCheckboxes.forEach(checkbox => {\r\n            checkbox.checked = checkbox.value === filterValue;\r\n        });\r\n    } else if (filterType === 'priority') {\r\n        // Apply priority filter\r\n        filterState.priorities.clear();\r\n        filterState.priorities.add(filterValue);\r\n        filterState.priorityExcludeMode = false;\r\n        filterState.projectExcludeMode = false;\r\n        filterState.tagExcludeMode = false;\r\n        \r\n        // Also exclude completed tasks for priority filters\r\n        filterState.statuses.clear();\r\n        filterState.statuses.add('todo');\r\n        filterState.statuses.add('progress');\r\n        filterState.statuses.add('review');\r\n        filterState.statusExcludeMode = false;\r\n        \r\n        // Update priority filter UI\r\n        const priorityCheckboxes = document.querySelectorAll('input[data-filter=\"priority\"]');\r\n        priorityCheckboxes.forEach(checkbox => {\r\n            checkbox.checked = checkbox.value === filterValue;\r\n        });\r\n        \r\n        // Update status checkboxes\r\n        const statusCheckboxes = document.querySelectorAll('input[data-filter=\"status\"]');\r\n        statusCheckboxes.forEach(checkbox => {\r\n            checkbox.checked = ['todo', 'progress', 'review'].includes(checkbox.value);\r\n        });\r\n    } else if (filterType === 'overdue') {\r\n        // Apply overdue filter by setting dateTo to today\r\n        const today = new Date().toISOString().split('T')[0];\r\n        filterState.dateTo = today;\r\n\r\n        // Update the date filter inputs\r\n        const dateToEl = document.getElementById('filter-date-to');\r\n        if (dateToEl) {\r\n            dateToEl.value = today;\r\n        }\r\n        \r\n        // Exclude completed tasks\r\n        filterState.statuses.clear();\r\n        filterState.statuses.add('todo');\r\n        filterState.statuses.add('progress');\r\n        filterState.statuses.add('review');\r\n        filterState.statusExcludeMode = false;\r\n        filterState.priorityExcludeMode = false;\r\n        filterState.projectExcludeMode = false;\r\n        filterState.tagExcludeMode = false;\r\n        \r\n        // Update status checkboxes\r\n        const statusCheckboxes = document.querySelectorAll('input[data-filter=\"status\"]');\r\n        statusCheckboxes.forEach(checkbox => {\r\n            checkbox.checked = ['todo', 'progress', 'review'].includes(checkbox.value);\r\n        });\r\n    }\r\n    \r\n    // Update filter badges and render\r\n    updateFilterBadges();\r\n    renderAfterFilterChange();\r\n}\r\n\r\nfunction updateDashboardForPeriod(period) {\r\n    // This function would filter data based on the selected period\r\n    // For now, we'll just update the stats labels to show the period\r\n    const periodLabels = {\r\n        week: t('dashboard.trend.thisWeek'),\r\n        month: t('dashboard.trend.thisMonth'),\r\n        quarter: t('dashboard.trend.thisQuarter')\r\n    };\r\n    \r\n    const label = periodLabels[period] || t('dashboard.trend.thisWeek');\r\n    \r\n    // Update trend text with the selected period\r\n    const progressChange = document.getElementById('progress-change');\r\n    const completedChange = document.getElementById('completed-change');\r\n    \r\n    if (progressChange) {\r\n        progressChange.textContent = `+${Math.max(1, Math.floor(tasks.length * 0.1))} ${label}`;\r\n    }\r\n    if (completedChange) {\r\n        completedChange.textContent = `+${tasks.filter(t => t.status === 'done').length} ${label}`;\r\n    }\r\n    \r\n    // Could add more sophisticated filtering here based on actual dates\r\n}\r\n\r\nfunction setupNavigation() {\r\n    document.querySelectorAll(\".nav-item\").forEach((item) => {\r\n        item.addEventListener(\"click\", () => {\r\n            const page = item.dataset.page;\r\n            if (page) {\r\n                if (page === 'calendar') {\r\n                    // Calendar nav: do not hard switch to tasks every time; call dedicated handler\r\n                    showCalendarView();\r\n                    // Highlight calendar nav explicitly\r\n                    document.querySelectorAll('.nav-item').forEach((nav) => nav.classList.remove('active'));\r\n                    item.classList.add('active');\r\n                    return;\r\n                }\r\n\r\n                // CRITICAL: If navigating to Tasks, remove calendar/list active classes FIRST\r\n                if (page === \"tasks\") {\r\n                    document.getElementById(\"calendar-view\")?.classList.remove(\"active\");\r\n                    document.getElementById(\"list-view\")?.classList.remove(\"active\");\r\n                }\r\n\r\n                // Update URL hash for bookmarking\r\n                window.location.hash = page;\r\n\r\n                // If navigating to Tasks without query params, clear any in-memory filters first\r\n                // so the first render can't show stale/ghost results.\r\n                if (page === \"tasks\") {\r\n                    const hash = window.location.hash.slice(1);\r\n                    const [hashPage, queryString] = hash.split(\"?\");\r\n                    const params = new URLSearchParams(queryString || \"\");\r\n                    if (hashPage === \"tasks\" && params.toString() === \"\") {\r\n                        filterState.search = \"\";\r\n                        filterState.statuses.clear();\r\n                        filterState.priorities.clear();\r\n                        filterState.projects.clear();\r\n                        filterState.tags.clear();\r\n                        filterState.datePresets.clear();\r\n                        filterState.dateFrom = \"\";\r\n                        filterState.dateTo = \"\";\r\n                        try { setKanbanUpdatedFilter('all', { render: false }); } catch (e) {}\r\n\r\n                        const searchEl = document.getElementById(\"filter-search\");\r\n                        if (searchEl) searchEl.value = \"\";\r\n                        document\r\n                            .querySelectorAll('#global-filters input[type=\"checkbox\"]')\r\n                            .forEach((cb) => (cb.checked = false));\r\n                    }\r\n                }\r\n\r\n                // Clear all nav highlights and set the clicked one\r\n                document.querySelectorAll(\".nav-item\").forEach((nav) => nav.classList.remove(\"active\"));\r\n                item.classList.add(\"active\");\r\n\r\n                showPage(page);\r\n\r\n                // Show view toggle only for tasks page\r\n                const viewToggle = document.querySelector(\".view-toggle\");\r\n                if (viewToggle) {\r\n                    if (page === \"tasks\") {\r\n                        viewToggle.classList.remove(\"hidden\");\r\n                    } else {\r\n                        viewToggle.classList.add(\"hidden\");\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction showPage(pageId) {\r\n    // Handle subpages (like dashboard/recent_activity)\r\n    if (pageId.includes('/')) {\r\n        const [mainPage, subPage] = pageId.split('/');\r\n        if (mainPage === 'dashboard' && subPage === 'recent_activity') {\r\n            showRecentActivityPage();\r\n            return;\r\n        }\r\n    }\r\n\r\n    // Scroll to top on mobile when switching pages (ensures mobile header is visible)\r\n    if (getIsMobileCached()) {\r\n        window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n\r\n    // Hide ALL pages including project-details\r\n    document.querySelectorAll(\".page\").forEach((page) => page.classList.remove(\"active\"));\r\n    document.getElementById(\"project-details\").classList.remove(\"active\");\r\n\r\n    // Hide activity page when returning to main dashboard\r\n    const activityPage = document.getElementById('activity-page');\r\n    if (activityPage) activityPage.style.display = 'none';\r\n    const dashboardGrid = document.querySelector('.dashboard-grid');\r\n    if (dashboardGrid) dashboardGrid.style.display = 'grid';\r\n    const insightsCard = document.querySelector('.insights-card');\r\n    if (insightsCard) insightsCard.style.display = '';\r\n\r\n    // Restore user menu when exiting project details\r\n    const userMenu = document.querySelector(\".user-menu\");\r\n    if (userMenu) userMenu.style.display = \"\";\r\n\r\n    // Show the requested page\r\n    document.getElementById(pageId).classList.add(\"active\");\r\n\r\n    if (pageId === \"dashboard\") {\r\n        updateCounts();\r\n        // Only render if not already rendered during initialization\r\n        // This prevents duplicate renders when handleRouting() is called right after renderWithoutCalendar()\r\n        // dashboardRendered is set to true after the first render completes\r\n        if (!dashboardRendered) {\r\n            renderDashboard();\r\n        } else {\r\n            // Reset flag so future navigations can render (e.g., coming back from another page)\r\n            dashboardRendered = false;\r\n        }\r\n    } else if (pageId === \"projects\") {\r\n        updateCounts();\r\n        // Don't call renderProjects() here - setupProjectsControls() handles initial render with filters applied\r\n        // Initialize projects header controls fresh whenever Projects page is shown\r\n        try {\r\n            populateProjectTagOptions();\r\n            setupProjectsControls();\r\n        } catch (e) { /* ignore */ }\r\n    } else if (pageId === \"tasks\") {\r\n        updateCounts();\r\n\r\n        // Check if URL has a view parameter - if not, default to Kanban\r\n        // This ensures \"All Tasks\" nav always defaults to Kanban view regardless of previous page\r\n        const hash = window.location.hash.slice(1);\r\n        const [, queryString] = hash.split('?');\r\n        const params = new URLSearchParams(queryString || '');\r\n        const hasViewParam = params.has('view');\r\n\r\n        // Always reset to Kanban when no view parameter (e.g., clicking \"All Tasks\" from nav)\r\n        if (!hasViewParam) {\r\n            document.querySelectorAll(\".view-btn\").forEach((b) => b.classList.remove(\"active\"));\r\n            document.querySelector(\".view-btn:nth-child(1)\").classList.add(\"active\");\r\n            document.querySelector(\".kanban-board\").classList.remove(\"hidden\");\r\n            document.getElementById(\"list-view\").classList.remove(\"active\");\r\n            document.getElementById(\"calendar-view\").classList.remove(\"active\");\r\n            // Restore \"All Tasks\" title\r\n            const pageTitle = document.querySelector('#tasks .page-title');\r\n            if (pageTitle) pageTitle.textContent = t('tasks.title');\r\n            // ensure header is in default (kanban) layout so Add Task stays right-aligned\r\n            try{ document.querySelector('.kanban-header')?.classList.remove('calendar-mode'); }catch(e){}\r\n            // Show kanban settings in tasks kanban view\r\n            const kanbanSettingsContainer = document.getElementById('kanban-settings-btn')?.parentElement;\r\n            if (kanbanSettingsContainer) kanbanSettingsContainer.style.display = '';\r\n            // Show backlog button in kanban view\r\n            const backlogBtn = document.getElementById('backlog-quick-btn');\r\n            if (backlogBtn) backlogBtn.style.display = 'inline-flex';\r\n        }\r\n\r\n        renderTasks();\r\n        renderListView();\r\n    } else if (pageId === \"updates\") {\r\n        updateCounts();\r\n        renderUpdatesPage();\r\n        markLatestReleaseSeen();\r\n    } else if (pageId === \"feedback\") {\r\n        renderFeedback();\r\n    }\r\n}\r\n\r\nlet renderCallsThisTick = 0;\r\nlet renderResetScheduled = false;\r\nlet renderExtraCallLogged = false;\r\n\r\nfunction trackRenderCall() {\r\n    renderCallsThisTick += 1;\r\n    if (renderCallsThisTick > 1 && !renderExtraCallLogged && isDebugLogsEnabled()) {\r\n        renderExtraCallLogged = true;\r\n        console.warn('[perf] render called multiple times in the same tick', new Error().stack);\r\n    }\r\n    if (!renderResetScheduled) {\r\n        renderResetScheduled = true;\r\n        queueMicrotask(() => {\r\n            renderCallsThisTick = 0;\r\n            renderResetScheduled = false;\r\n        });\r\n    }\r\n}\r\n\r\nfunction render() {\r\n    trackRenderCall();\r\n    renderActivePageOnly();\r\n}\r\n\r\nfunction renderAppVersionLabel() {\r\n    const label = APP_VERSION_LABEL;\r\n    document.querySelectorAll('.app-version').forEach((el) => (el.textContent = label));\r\n    document.querySelectorAll('.mobile-version').forEach((el) => (el.textContent = label));\r\n}\r\n\r\nfunction renderReleaseSectionList(items) {\r\n    const normalizedItems = (items || []).map((item) => resolveReleaseText(item)).filter(Boolean);\r\n    if (!normalizedItems.length) {\r\n        return `<div class=\"release-section-empty\">${t('updates.sectionEmpty')}</div>`;\r\n    }\r\n    return `\r\n        <ul class=\"release-list\">\r\n            ${normalizedItems.map((item) => `<li><span class=\"release-point-icon\" aria-hidden=\"true\"></span><span>${escapeHtml(item)}</span></li>`).join('')}\r\n        </ul>\r\n    `;\r\n}\r\n\r\nfunction renderUpdatesPage() {\r\n    const container = document.getElementById('updates-content');\r\n    if (!container) return;\r\n    const releases = getSortedReleaseNotes();\r\n    if (releases.length === 0) {\r\n        container.innerHTML = `<div class=\"updates-empty\">${t('updates.empty')}</div>`;\r\n        return;\r\n    }\r\n\r\n    const latest = releases[0];\r\n    const history = releases.slice(1);\r\n    const latestTitle = [latest.version, resolveReleaseText(latest.title)].filter(Boolean).join(' - ');\r\n    const latestMeta = t('notifications.releaseMeta', { date: formatReleaseDate(latest.date) });\r\n    const latestSummary = latest.summary ? escapeHtml(resolveReleaseText(latest.summary)) : '';\r\n    const sections = latest.sections || {};\r\n    const sectionDefs = [\r\n        { key: 'new', label: t('updates.sections.new') },\r\n        { key: 'improvements', label: t('updates.sections.improvements') },\r\n        { key: 'fixes', label: t('updates.sections.fixes') }\r\n    ];\r\n    const sectionHtml = sectionDefs.map((def) => {\r\n        const items = sections[def.key] || [];\r\n        return `\r\n            <div class=\"release-section-card release-section-card--${def.key}\">\r\n                <div class=\"release-section-card-header\">\r\n                    <span class=\"release-section-icon\" data-kind=\"${def.key}\" aria-hidden=\"true\"></span>\r\n                    <div>\r\n                        <div class=\"release-section-title\">${def.label}</div>\r\n                    </div>\r\n                </div>\r\n                ${renderReleaseSectionList(items)}\r\n            </div>\r\n        `;\r\n    }).join('');\r\n\r\n    const historyHtml = history.length\r\n        ? history.map((release) => {\r\n            const title = [release.version, resolveReleaseText(release.title)].filter(Boolean).join(' - ');\r\n            const meta = formatReleaseDate(release.date);\r\n            const summary = release.summary ? escapeHtml(resolveReleaseText(release.summary)) : '';\r\n            return `\r\n                <div class=\"release-history-item\">\r\n                    <div class=\"release-history-title\">${escapeHtml(title)}</div>\r\n                    <div class=\"release-history-meta\">${meta}</div>\r\n                    ${summary ? `<div class=\"release-history-summary\">${summary}</div>` : ''}\r\n                </div>\r\n            `;\r\n        }).join('')\r\n        : `<div class=\"release-history-empty\">${t('updates.historyEmpty')}</div>`;\r\n\r\n    container.innerHTML = `\r\n        <div class=\"release-notes-stack\">\r\n            <article class=\"release-hero\" data-release-id=\"${latest.id}\" aria-label=\"${t('updates.latestLabel')}\">\r\n                <div class=\"release-hero-top\">\r\n                    <span class=\"release-badge\">${t('updates.latestLabel')}</span>\r\n                    <span class=\"release-hero-meta\">${latestMeta}</span>\r\n                </div>\r\n                <div class=\"release-hero-title\">${escapeHtml(latestTitle)}</div>\r\n                ${latestSummary ? `<p class=\"release-hero-summary\">${latestSummary}</p>` : ''}\r\n            </article>\r\n            <div class=\"release-section-stack\">\r\n                ${sectionHtml}\r\n            </div>\r\n            <section class=\"release-history-block\" aria-label=\"${t('updates.historyLabel')}\">\r\n                <div class=\"release-history-header\">\r\n                    <div>\r\n                        <div class=\"release-history-label\">${t('updates.historyLabel')}</div>\r\n                        <div class=\"release-history-subtitle\">${t('updates.subtitle')}</div>\r\n                    </div>\r\n                </div>\r\n                <div class=\"release-history-list\">\r\n                    ${historyHtml}\r\n                </div>\r\n            </section>\r\n        </div>\r\n    `;\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n// Track if dashboard has been rendered to prevent duplicate renders\r\nlet dashboardRendered = false;\r\nlet dashboardRenderInProgress = false;\r\n\r\nfunction renderDashboard() {\r\n    // Prevent duplicate renders during initialization\r\n    if (dashboardRenderInProgress) {\r\n        return;\r\n    }\r\n    \r\n    dashboardRenderInProgress = true;\r\n    const renderTimer = debugTimeStart(\"render\", \"dashboard\", {\r\n        taskCount: tasks.length,\r\n        projectCount: projects.length\r\n    });\r\n    updateDashboardStats();\r\n    renderProjectProgressBars();\r\n    renderActivityFeed();\r\n    renderInsights();\r\n    animateDashboardElements();\r\n\r\n    // Add click handler for Projects stat card\r\n    const projectsStatCard = document.getElementById('projects-stat-card');\r\n    if (projectsStatCard) {\r\n        projectsStatCard.onclick = () => {\r\n            window.location.hash = 'projects';\r\n        };\r\n    }\r\n    debugTimeEnd(\"render\", renderTimer, {\r\n        taskCount: tasks.length,\r\n        projectCount: projects.length\r\n    });\r\n}\r\n\r\nfunction updateDashboardStats() {\r\n    const statsTimer = debugTimeStart(\"render\", \"dashboard-stats\", {\r\n        taskCount: tasks.length,\r\n        projectCount: projects.length\r\n    });\r\n    \r\n    // Use pure function from dashboard module for calculations\r\n    const stats = calculateDashboardStats(tasks, projects);\r\n\r\n    // Update hero numbers\r\n    document.getElementById('hero-active-projects').textContent = stats.activeProjects;\r\n    \r\n    // Update tasks completion ring (percentage only inside circle - no redundant number)\r\n    const tasksCircle = document.querySelector('.tasks-progress-circle');\r\n    if (tasksCircle) {\r\n        const circumference = 2 * Math.PI * 45; // radius = 45\r\n        const offset = circumference - (stats.tasksCompletionRate / 100) * circumference;\r\n        tasksCircle.style.strokeDashoffset = offset;\r\n    }\r\n    const tasksRingPercentage = document.getElementById('tasks-ring-percentage');\r\n    if (tasksRingPercentage) {\r\n        tasksRingPercentage.textContent = `${stats.tasksCompletionRate}%`;\r\n    }\r\n    const tasksCompletionCount = document.getElementById('tasks-completion-count');\r\n    if (tasksCompletionCount) {\r\n        const numerator = tasksCompletionCount.querySelector('.count-numerator');\r\n        const denominator = tasksCompletionCount.querySelector('.count-denominator');\r\n        if (numerator) numerator.textContent = stats.completedTasks;\r\n        if (denominator) denominator.textContent = stats.totalTasks;\r\n    }\r\n    \r\n    // Update projects completion ring (percentage only inside circle - no redundant number)\r\n    const projectsCircle = document.querySelector('.projects-progress-circle');\r\n    if (projectsCircle) {\r\n        const circumference = 2 * Math.PI * 45; // radius = 45\r\n        const offset = circumference - (stats.projectsCompletionRate / 100) * circumference;\r\n        projectsCircle.style.strokeDashoffset = offset;\r\n    }\r\n    const projectsRingPercentage = document.getElementById('projects-ring-percentage');\r\n    if (projectsRingPercentage) {\r\n        projectsRingPercentage.textContent = `${stats.projectsCompletionRate}%`;\r\n    }\r\n    const projectsCompletionCount = document.getElementById('projects-completion-count');\r\n    if (projectsCompletionCount) {\r\n        const numerator = projectsCompletionCount.querySelector('.count-numerator');\r\n        const denominator = projectsCompletionCount.querySelector('.count-denominator');\r\n        if (numerator) numerator.textContent = stats.completedProjects;\r\n        if (denominator) denominator.textContent = stats.totalProjectsWithTasks;\r\n    }\r\n\r\n    // Update enhanced stats\r\n    document.getElementById('in-progress-tasks').textContent = stats.inProgressTasks;\r\n    document.getElementById('pending-tasks-new').textContent = stats.pendingTasks;\r\n    document.getElementById('completed-tasks-new').textContent = stats.completedTasks;\r\n    document.getElementById('overdue-tasks').textContent = stats.overdueTasks;\r\n    document.getElementById('high-priority-tasks').textContent = stats.highPriorityTasks;\r\n    document.getElementById('research-milestones').textContent = stats.milestones;\r\n    \r\n    // Update trend indicators with dynamic data\r\n    updateTrendIndicators();\r\n    debugTimeEnd(\"render\", statsTimer, {\r\n        activeProjects: stats.activeProjects,\r\n        totalTasks: stats.totalTasks,\r\n        tasksCompletionRate: stats.tasksCompletionRate,\r\n        projectsCompletionRate: stats.projectsCompletionRate\r\n    });\r\n}\r\n\r\nfunction updateTrendIndicators() {\r\n    // Use pure function from dashboard module for calculations\r\n    const trends = calculateTrendIndicators(tasks, projects);\r\n    \r\n    document.getElementById('progress-change').textContent = `+${trends.progressChange} ${t('dashboard.trend.thisWeek')}`;\r\n    document.getElementById('pending-change').textContent = trends.dueTodayCount > 0\r\n        ? t(trends.dueTodayCount === 1 ? 'dashboard.trend.dueTodayOne' : 'dashboard.trend.dueTodayMany', { count: trends.dueTodayCount })\r\n        : t('dashboard.trend.onTrack');\r\n    document.getElementById('completed-change').textContent = `+${trends.thisWeekCompleted} ${t('dashboard.trend.thisWeek')}`;\r\n    \r\n    const overdueChangeEl = document.getElementById('overdue-change');\r\n    if (overdueChangeEl) {\r\n        overdueChangeEl.textContent = trends.overdueCount > 0\r\n            ? t('dashboard.trend.needsAttention')\r\n            : t('dashboard.trend.allOnTrack');\r\n        overdueChangeEl.classList.toggle('negative', trends.overdueCount > 0);\r\n        overdueChangeEl.classList.toggle('positive', trends.overdueCount === 0);\r\n        overdueChangeEl.classList.remove('neutral');\r\n    }\r\n\r\n    document.getElementById('priority-change').textContent =\r\n        trends.criticalHighPriority > 0\r\n            ? t(trends.criticalHighPriority === 1 ? 'dashboard.trend.criticalOne' : 'dashboard.trend.criticalMany', { count: trends.criticalHighPriority })\r\n            : t('dashboard.trend.onTrack');\r\n    document.getElementById('milestones-change').textContent = trends.completedProjects > 0\r\n        ? t(trends.completedProjects === 1 ? 'dashboard.trend.completedOne' : 'dashboard.trend.completedMany', { count: trends.completedProjects })\r\n        : t('dashboard.trend.inProgress');\r\n}\r\n\r\nfunction renderProjectProgressBars() {\r\n    const container = document.getElementById('project-progress-bars');\r\n    if (!container) return;\r\n\r\n    const activeProjects = projects.filter((project) => getProjectStatus(project.id) === 'active');\r\n\r\n    if (activeProjects.length === 0) {\r\n        container.innerHTML = `\r\n            <div style=\"text-align: center; padding: 40px; color: var(--text-muted);\">\r\n                <div style=\"font-size: 48px; margin-bottom: 16px;\">\uD83C\uDF0A</div>\r\n                <div style=\"font-size: 16px; margin-bottom: 8px;\">${t('dashboard.emptyProjects.title')}</div>\r\n                <div style=\"font-size: 14px;\">${t('dashboard.emptyProjects.subtitle')}</div>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    // Use pure function from dashboard module for calculations\r\n    const projectProgressData = calculateProjectProgress(activeProjects, tasks, 5);\r\n\r\n    // Use module function for HTML generation\r\n    container.innerHTML = generateProgressBarsHTML(projectProgressData, {\r\n        tasksLabel: t('dashboard.tasks')\r\n    });\r\n}\r\n\r\nfunction renderActivityFeed() {\r\n    const container = document.getElementById('activity-feed');\r\n    if (!container) return;\r\n    \r\n    // Create recent activity from tasks and projects\r\n    const activities = [];\r\n    \r\n    // Recent completed tasks\r\n    const recentCompleted = tasks\r\n        .filter(t => t.status === 'done')\r\n        .sort((a, b) => new Date(b.completedDate || b.createdAt || b.createdDate) - new Date(a.completedDate || a.createdAt || a.createdDate))\r\n        .slice(0, 3);\r\n    \r\n    recentCompleted.forEach(task => {\r\n        const project = projects.find(p => p.id === task.projectId);\r\n        const activityDate = task.completedDate || task.createdAt || task.createdDate;\r\n        const projectPart = project ? t('dashboard.activity.inProject', { project: project.name }) : '';\r\n        activities.push({\r\n            type: 'completed',\r\n            text: t('dashboard.activity.completed', { title: task.title, projectPart }).trim(),\r\n            timeText: formatRelativeTime(activityDate),\r\n            date: activityDate,\r\n            icon: '\\u{2705}'\r\n        });\r\n    });\r\n    \r\n    // Recent new projects\r\n    const recentProjects = projects\r\n        .sort((a, b) => new Date(b.createdAt || b.createdDate) - new Date(a.createdAt || a.createdDate))\r\n        .slice(0, 2);\r\n    \r\n    recentProjects.forEach(project => {\r\n        const projectDate = project.createdAt || project.createdDate;\r\n        activities.push({\r\n            type: 'created',\r\n            text: t('dashboard.activity.createdProject', { project: project.name }),\r\n            timeText: formatRelativeTime(projectDate),\r\n            date: projectDate,\r\n            icon: '\uD83D\uDE80'\r\n        });\r\n    });\r\n    \r\n    // Recent new tasks\r\n    const recentTasks = tasks\r\n        .filter(t => t.status !== 'done')\r\n        .sort((a, b) => new Date(b.createdAt || b.createdDate) - new Date(a.createdAt || a.createdDate))\r\n        .slice(0, 2);\r\n    \r\n    recentTasks.forEach(task => {\r\n        const taskDate = task.createdAt || task.createdDate;\r\n        const project = projects.find(p => p.id === task.projectId);\r\n        const projectPart = project ? t('dashboard.activity.toProject', { project: project.name }) : '';\r\n        activities.push({\r\n            type: 'created',\r\n            text: t('dashboard.activity.addedTask', { title: task.title, projectPart }).trim(),\r\n            timeText: formatRelativeTime(taskDate),\r\n            date: taskDate,\r\n            icon: '\uD83D\uDCDD'\r\n        });\r\n    });\r\n    \r\n    // Sort by most recent first using actual dates\r\n    activities.sort((a, b) => new Date(b.date) - new Date(a.date));\r\n    \r\n    if (activities.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"activity-item\">\r\n                <div class=\"activity-icon completed\">\uD83C\uDF0A</div>\r\n                <div class=\"activity-content\">\r\n                    <div class=\"activity-text\">${t('dashboard.activity.emptyTitle')}</div>\r\n                    <div class=\"activity-time\">${t('dashboard.activity.emptySubtitle')}</div>\r\n                </div>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n    \r\n    // Use module function for HTML generation\r\n    container.innerHTML = generateActivityFeedHTML(activities.slice(0, 4), formatDashboardActivityDate);\r\n}\r\n\r\n\r\nfunction showAllActivity() {\r\n    // Update URL hash to create proper page routing\r\n    window.location.hash = 'dashboard/recent_activity';\r\n}\r\n\r\nfunction backToDashboard() {\r\n    // Navigate back to main dashboard\r\n    window.location.hash = 'dashboard';\r\n}\r\n\r\nfunction showRecentActivityPageLegacy() {\r\n    // Hide all main pages\r\n    document.querySelectorAll('.page').forEach(page => {\r\n        page.classList.remove('active');\r\n    });\r\n    \r\n    // Show dashboard page but hide its main content\r\n    document.getElementById('dashboard').classList.add('active');\r\n    document.querySelector('.dashboard-grid').style.display = 'none';\r\n    const insightsCard = document.querySelector('.insights-card');\r\n    if (insightsCard) insightsCard.style.display = 'none';\r\n    \r\n    // Create or show activity page\r\n    let activityPage = document.getElementById('activity-page');\r\n    if (!activityPage) {\r\n        activityPage = document.createElement('div');\r\n        activityPage.id = 'activity-page';\r\n        activityPage.className = 'activity-page';\r\n        activityPage.innerHTML = `\r\n            <div class=\"activity-page-header\">\r\n                <button class=\"back-btn\" data-action=\"backToDashboard\" data-i18n=\"dashboard.activity.backToDashboard\">${t('dashboard.activity.backToDashboard')}</button>\r\n                <h2 data-i18n=\"dashboard.activity.allTitle\">${t('dashboard.activity.allTitle')}</h2>\r\n            </div>\r\n            <div id=\"all-activity-list\" class=\"all-activity-list\"></div>\r\n        `;\r\n        document.querySelector('.dashboard-content').appendChild(activityPage);\r\n    }\r\n    \r\n    activityPage.style.display = 'block';\r\n    renderAllActivity();\r\n\r\n    // Ensure the activity view is scrolled into view (important on mobile)\r\n    try {\r\n        activityPage.scrollIntoView({ behavior: 'auto', block: 'start' });\r\n    } catch (e) {\r\n        window.scrollTo(0, 0);\r\n    }\r\n\r\n    // Update active nav item\r\n    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));\r\n    document.querySelector('.nav-item[data-page=\"dashboard\"]').classList.add('active');\r\n}\r\n\r\nfunction showRecentActivityPage() {\r\n    // Hide all main pages\r\n    document.querySelectorAll('.page').forEach(page => {\r\n        page.classList.remove('active');\r\n    });\r\n\r\n    // Create or show dedicated activity page as a full page (sibling of dashboard/projects/tasks)\r\n    let activityPage = document.getElementById('activity-page');\r\n    if (!activityPage) {\r\n        activityPage = document.createElement('div');\r\n        activityPage.id = 'activity-page';\r\n        activityPage.className = 'page';\r\n        activityPage.innerHTML = `\r\n            <div class=\"page-header\">\r\n                <div>\r\n                    <h1 class=\"page-title\" data-i18n=\"dashboard.activity.allTitle\">${t('dashboard.activity.allTitle')}</h1>\r\n                    <p class=\"page-subtitle\" data-i18n=\"dashboard.activity.allSubtitle\">${t('dashboard.activity.allSubtitle')}</p>\r\n                </div>\r\n                <button class=\"view-all-btn back-btn\" data-action=\"backToDashboard\" data-i18n=\"dashboard.activity.backToDashboard\">${t('dashboard.activity.backToDashboard')}</button>\r\n            </div>\r\n            <div class=\"page-content\">\r\n                <div id=\"all-activity-list\" class=\"all-activity-list\"></div>\r\n            </div>\r\n        `;\r\n        const mainContent = document.querySelector('.main-content');\r\n        if (mainContent) {\r\n            mainContent.appendChild(activityPage);\r\n        }\r\n    }\r\n\r\n    activityPage.classList.add('active');\r\n    activityPage.style.display = 'flex';\r\n    renderAllActivity();\r\n\r\n    // Ensure the activity view is scrolled into view (important on mobile)\r\n    try {\r\n        activityPage.scrollIntoView({ behavior: 'auto', block: 'start' });\r\n    } catch (e) {\r\n        window.scrollTo(0, 0);\r\n    }\r\n\r\n    // Update active nav item\r\n    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));\r\n    document.querySelector('.nav-item[data-page=\"dashboard\"]').classList.add('active');\r\n}\r\n\r\nfunction renderAllActivity() {\r\n    // Generate all activities (same logic as recent activity but show all)\r\n    const activities = [];\r\n    \r\n    // All completed tasks\r\n    const allCompleted = tasks\r\n        .filter(t => t.status === 'done')\r\n        .sort((a, b) => new Date(b.completedDate || b.createdAt || b.createdDate) - new Date(a.completedDate || a.createdAt || a.createdDate));\r\n    \r\n    allCompleted.forEach(task => {\r\n        const project = projects.find(p => p.id === task.projectId);\r\n        const activityDate = task.completedDate || task.createdAt || task.createdDate;\r\n        const projectPart = project ? t('dashboard.activity.inProject', { project: project.name }) : '';\r\n        activities.push({\r\n            type: 'completed',\r\n            text: t('dashboard.activity.completed', { title: task.title, projectPart }).trim(),\r\n            date: activityDate,\r\n            icon: '\\u{2705}'\r\n        });\r\n    });\r\n    \r\n    // All projects\r\n    projects\r\n        .sort((a, b) => new Date(b.createdAt || b.createdDate) - new Date(a.createdAt || a.createdDate))\r\n        .forEach(project => {\r\n            activities.push({\r\n                type: 'created',\r\n                text: t('dashboard.activity.createdProject', { project: project.name }),\r\n                date: project.createdAt || project.createdDate,\r\n                icon: '\uD83D\uDE80'\r\n            });\r\n        });\r\n    \r\n    // All tasks\r\n    tasks\r\n        .sort((a, b) => new Date(b.createdAt || b.createdDate) - new Date(a.createdAt || a.createdDate))\r\n        .forEach(task => {\r\n            const project = projects.find(p => p.id === task.projectId);\r\n            const projectPart = project ? t('dashboard.activity.toProject', { project: project.name }) : '';\r\n            activities.push({\r\n                type: 'created',\r\n                text: t('dashboard.activity.addedTask', { title: task.title, projectPart }).trim(),\r\n                date: task.createdAt || task.createdDate,\r\n                icon: '\uD83D\uDCDD'\r\n            });\r\n        });\r\n    \r\n    // Sort by most recent\r\n    activities.sort((a, b) => new Date(b.date) - new Date(a.date));\r\n    \r\n    const container = document.getElementById('all-activity-list');\r\n    if (!container) return;\r\n    \r\n    const activityHTML = activities.map(activity => `\r\n        <div class=\"activity-item-full\">\r\n            <div class=\"activity-icon ${activity.type}\">${activity.icon}</div>\r\n            <div class=\"activity-content\">\r\n                <div class=\"activity-text\">${activity.text}</div>\r\n            </div>\r\n            <div class=\"activity-full-date\">${new Date(activity.date).toLocaleDateString(getLocale(), { \r\n                year: 'numeric', \r\n                month: 'short', \r\n                day: 'numeric',\r\n                hour: '2-digit',\r\n                minute: '2-digit'\r\n            })}</div>\r\n        </div>\r\n    `).join('');\r\n    \r\n    container.innerHTML = activityHTML;\r\n}\r\n\r\nfunction renderInsights() {\r\n    const container = document.getElementById('insights-list');\r\n    if (!container) return;\r\n\r\n    const insights = generateInsights();    const insightsHTML = insights.map(insight => `\r\n        <div class=\"insight-item ${insight.type}\">\r\n            <div class=\"insight-icon\">${insight.icon}</div>\r\n            <div class=\"insight-content\">\r\n                <div class=\"insight-title\">${insight.title}</div>\r\n                <div class=\"insight-desc\">${insight.description}</div>\r\n            </div>\r\n        </div>\r\n    `).join('');\r\n    \r\n    container.innerHTML = insightsHTML;\r\n    // Insights count badge removed\r\n}\r\n\r\nfunction generateInsights() {\r\n    const insights = [];\r\n    \r\n    const totalTasks = tasks.length;\r\n    const completedTasks = tasks.filter(t => t.status === 'done').length;\r\n    const today = new Date().toISOString().split('T')[0];\r\n    const overdueTasks = tasks.filter(t => t.endDate && t.endDate < today && t.status !== 'done').length;\r\n    const highPriorityTasks = tasks.filter(t => t.priority === 'high').length;\r\n    const todayTasks = tasks.filter(t => {\r\n        if (!t.endDate) return false;\r\n        const today = new Date().toDateString();\r\n        return new Date(t.endDate).toDateString() === today && t.status !== 'done';\r\n    }).length;\r\n    \r\n    // Real task completion insights\r\n    if (totalTasks > 0) {\r\n        const completionRate = (completedTasks / totalTasks) * 100;\r\n        if (completionRate >= 80) {\r\n            insights.push({\r\n                type: 'success',\r\n                icon: '\uD83C\uDFAF',\r\n                title: t('dashboard.insights.excellentTitle'),\r\n                description: t('dashboard.insights.excellentDesc', { percent: completionRate.toFixed(0) })\r\n            });\r\n        } else if (completionRate >= 60) {\r\n            insights.push({\r\n                type: 'success',\r\n                icon: '\uD83D\uDCC8',\r\n                title: t('dashboard.insights.goodTitle'),\r\n                description: t('dashboard.insights.goodDesc', { percent: completionRate.toFixed(0) })\r\n            });\r\n        } else if (completionRate >= 30) {\r\n            insights.push({\r\n                type: 'warning',\r\n                icon: '\u26A1',\r\n                title: t('dashboard.insights.opportunityTitle'),\r\n                description: t('dashboard.insights.opportunityDesc', { percent: completionRate.toFixed(0) })\r\n            });\r\n        } else {\r\n            insights.push({\r\n                type: 'priority',\r\n                icon: '\uD83D\uDEA8',\r\n                title: t('dashboard.insights.actionTitle'),\r\n                description: t('dashboard.insights.actionDesc', { percent: completionRate.toFixed(0) })\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Due today tasks\r\n    if (todayTasks > 0) {\r\n        insights.push({\r\n            type: 'priority',\r\n            icon: '\uD83D\uDCC5',\r\n            title: t('dashboard.insights.todayTitle'),\r\n            description: t(todayTasks === 1 ? 'dashboard.insights.todayDescOne' : 'dashboard.insights.todayDescMany', { count: todayTasks })\r\n        });\r\n    }\r\n    \r\n    // Overdue tasks (only if not already covered by today's tasks)\r\n    if (overdueTasks > 0 && todayTasks === 0) {\r\n        insights.push({\r\n            type: 'warning',\r\n            icon: '\u23F0',\r\n            title: t('dashboard.insights.overdueTitle'),\r\n            description: t(overdueTasks === 1 ? 'dashboard.insights.overdueDescOne' : 'dashboard.insights.overdueDescMany', { count: overdueTasks })\r\n        });\r\n    }\r\n    \r\n    // High priority tasks\r\n    if (highPriorityTasks > 0) {\r\n        const urgentCount = tasks.filter(t => t.priority === 'high' && t.status !== 'done').length;\r\n        if (urgentCount > 0) {\r\n            insights.push({\r\n                type: 'priority',\r\n                icon: '\uD83D\uDD25',\r\n                title: t('dashboard.insights.highPriorityTitle'),\r\n                description: t(urgentCount === 1 ? 'dashboard.insights.highPriorityDescOne' : 'dashboard.insights.highPriorityDescMany', { count: urgentCount })\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Project insights\r\n    if (projects.length > 1) {\r\n        const projectsWithTasks = projects.filter(p => tasks.some(t => t.projectId === p.id)).length;\r\n        const projectsWithoutTasks = projects.length - projectsWithTasks;\r\n        \r\n        if (projectsWithoutTasks > 0) {\r\n            insights.push({\r\n                type: 'warning',\r\n                icon: '\uFFFD',\r\n                title: t('dashboard.insights.emptyProjectsTitle'),\r\n                description: t(projectsWithoutTasks === 1 ? 'dashboard.insights.emptyProjectsDescOne' : 'dashboard.insights.emptyProjectsDescMany', { count: projectsWithoutTasks })\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Productivity pattern insights\r\n    if (totalTasks >= 5) {\r\n        const recentlyCompleted = tasks.filter(t => {\r\n            if (t.status !== 'done' || !t.completedDate) return false;\r\n            const weekAgo = new Date();\r\n            weekAgo.setDate(weekAgo.getDate() - 7);\r\n            return new Date(t.completedDate) > weekAgo;\r\n        }).length;\r\n        \r\n        if (recentlyCompleted >= 3) {\r\n            insights.push({\r\n                type: 'success',\r\n                icon: '\uD83D\uDE80',\r\n                title: t('dashboard.insights.momentumTitle'),\r\n                description: t(recentlyCompleted === 1 ? 'dashboard.insights.momentumDescOne' : 'dashboard.insights.momentumDescMany', { count: recentlyCompleted })\r\n            });\r\n        }\r\n    }\r\n    \r\n    // Default insights for empty state\r\n    if (insights.length === 0) {\r\n        if (totalTasks === 0) {\r\n            insights.push({\r\n                type: 'priority',\r\n                icon: '\uD83C\uDF0A',\r\n                title: t('dashboard.insights.readyTitle'),\r\n                description: t('dashboard.insights.readyDesc')\r\n            });\r\n        } else {\r\n            insights.push({\r\n                type: 'success',\r\n                icon: '\\u{2705}',\r\n                title: t('dashboard.insights.caughtUpTitle'),\r\n                description: t('dashboard.insights.caughtUpDesc')\r\n            });\r\n        }\r\n    }\r\n    \r\n    return insights.slice(0, 3); // Limit to 3 most relevant insights\r\n}\r\n\r\nfunction animateDashboardElements() {\r\n    // Animate stat cards with staggered entrance\r\n    const statCards = document.querySelectorAll('.enhanced-stat-card');\r\n    statCards.forEach((card, index) => {\r\n        card.style.opacity = '0';\r\n        card.style.transform = 'translateY(20px)';\r\n        setTimeout(() => {\r\n            card.style.transition = 'all 0.4s ease';\r\n            card.style.opacity = '1';\r\n            card.style.transform = 'translateY(0)';\r\n        }, index * 100);\r\n    });\r\n    \r\n    // Animate hero stats\r\n    const heroCards = document.querySelectorAll('.hero-stat-card');\r\n    heroCards.forEach((card, index) => {\r\n        card.style.opacity = '0';\r\n        card.style.transform = 'translateX(-30px)';\r\n        setTimeout(() => {\r\n            card.style.transition = 'all 0.6s ease';\r\n            card.style.opacity = '1';\r\n            card.style.transform = 'translateX(0)';\r\n        }, index * 200);\r\n    });\r\n}\r\n\r\nfunction formatRelativeTime(dateString) {\r\n    if (!dateString) return t('dashboard.activity.recently');\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const diffInSeconds = Math.floor((now - date) / 1000);\r\n    \r\n    if (diffInSeconds < 60) return t('dashboard.activity.justNow');\r\n    if (diffInSeconds < 3600) {\r\n        const minutes = Math.floor(diffInSeconds / 60);\r\n        return t(minutes === 1 ? 'dashboard.activity.minuteAgo' : 'dashboard.activity.minutesAgo', { count: minutes });\r\n    }\r\n    if (diffInSeconds < 86400) {\r\n        const hours = Math.floor(diffInSeconds / 3600);\r\n        return t(hours === 1 ? 'dashboard.activity.hourAgo' : 'dashboard.activity.hoursAgo', { count: hours });\r\n    }\r\n    if (diffInSeconds < 604800) {\r\n        const days = Math.floor(diffInSeconds / 86400);\r\n        return t(days === 1 ? 'dashboard.activity.dayAgo' : 'dashboard.activity.daysAgo', { count: days });\r\n    }\r\n    return date.toLocaleDateString(getLocale());\r\n}\r\n\r\nfunction formatDashboardActivityDate(dateString) {\r\n    if (!dateString) return '';\r\n    const date = new Date(dateString);\r\n    const now = new Date();\r\n    const diffDays = Math.floor((now - date) / (1000 * 60 * 60 * 24));\r\n\r\n    if (diffDays === 0) return t('dashboard.activity.today');\r\n    if (diffDays === 1) return t('dashboard.activity.yesterday');\r\n    if (diffDays < 7) return t('dashboard.activity.daysAgoShort', { count: diffDays });\r\n\r\n    return date.toLocaleDateString(getLocale(), { month: 'short', day: 'numeric' });\r\n}\r\n\r\n// Quick action functions\r\nfunction signOut() {\r\n    if (window.authSystem && window.authSystem.logout) {\r\n        window.authSystem.logout();\r\n    }\r\n}\r\n\r\n// Show export confirmation modal\r\nfunction exportDashboardData() {\r\n    document.getElementById('export-data-modal').classList.add('active');\r\n}\r\n\r\n// Close export confirmation modal\r\nfunction closeExportDataModal() {\r\n    document.getElementById('export-data-modal').classList.remove('active');\r\n}\r\n\r\n// Perform the actual export after confirmation\r\nfunction confirmExportData() {\r\n    // Close the modal\r\n    closeExportDataModal();\r\n\r\n    // Get current user info\r\n    const currentUser = window.authSystem ? window.authSystem.getCurrentUser() : null;\r\n\r\n    // Export EVERYTHING - complete backup of all user data\r\n    const completeBackup = {\r\n        // User info\r\n        user: currentUser ? {\r\n            id: currentUser.id,\r\n            username: currentUser.username,\r\n            name: currentUser.name,\r\n            email: currentUser.email\r\n        } : null,\r\n\r\n        // Core data\r\n        projects: projects,\r\n        tasks: tasks,\r\n        feedbackItems: feedbackItems,\r\n\r\n        // Metadata\r\n        projectColors: projectColorMap,\r\n        sortMode: sortMode,\r\n        manualTaskOrder: manualTaskOrder,\r\n        settings: settings,\r\n\r\n        // History (if available)\r\n        history: window.historyService ? window.historyService.getHistory() : [],\r\n\r\n        // Counters (for import/restore)\r\n        projectCounter: projectCounter,\r\n        taskCounter: taskCounter,\r\n\r\n        // Statistics (for user info)\r\n        statistics: {\r\n            totalProjects: projects.length,\r\n            totalTasks: tasks.length,\r\n            completedTasks: tasks.filter(t => t.status === 'done').length,\r\n            completionRate: tasks.length > 0 ? ((tasks.filter(t => t.status === 'done').length / tasks.length) * 100).toFixed(1) : 0,\r\n            feedbackCount: feedbackItems.length\r\n        },\r\n\r\n        // Export metadata\r\n        exportDate: new Date().toISOString(),\r\n        exportVersion: '2.0', // Version for tracking export format\r\n        sourceSystem: 'Nautilus Multi-User'\r\n    };\r\n\r\n    const dataStr = JSON.stringify(completeBackup, null, 2);\r\n    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);\r\n\r\n    // Include username in filename if available\r\n    const username = currentUser?.username || 'user';\r\n    const exportFileDefaultName = `nautilus-complete-backup-${username}-${new Date().toISOString().split('T')[0]}.json`;\r\n\r\n    const linkElement = document.createElement('a');\r\n    linkElement.setAttribute('href', dataUri);\r\n    linkElement.setAttribute('download', exportFileDefaultName);\r\n    linkElement.click();\r\n\r\n    // Show success notification\r\n    showNotification('Complete backup exported successfully! All data, settings, and history included.', 'success');\r\n}\r\n\r\n// Import Data Functions\r\nlet importFileData = null;\r\n\r\nfunction openImportDataModal() {\r\n    const modal = document.getElementById('import-data-modal');\r\n    modal.classList.add('active');\r\n    \r\n    // Reset state\r\n    importFileData = null;\r\n    document.getElementById('import-file-input').value = '';\r\n    document.getElementById('import-confirm-input').value = '';\r\n    document.getElementById('import-confirm-error').classList.remove('show');\r\n    document.getElementById('import-preview').style.display = 'none';\r\n    \r\n    // Find elements that need HTML rendering BEFORE applyTranslations runs\r\n    const warningBodyEl = modal.querySelector('[data-i18n=\"import.warningBody\"]');\r\n    const confirmTextEl = modal.querySelector('[data-i18n=\"import.confirmText\"]');\r\n    \r\n    // Temporarily remove data-i18n so applyTranslations skips them\r\n    if (warningBodyEl) warningBodyEl.removeAttribute('data-i18n');\r\n    if (confirmTextEl) confirmTextEl.removeAttribute('data-i18n');\r\n    \r\n    // Apply translations for elements that don't need HTML rendering\r\n    applyTranslations(modal);\r\n    \r\n    // Now set HTML content for elements that need HTML rendering\r\n    if (warningBodyEl) {\r\n        warningBodyEl.innerHTML = t('import.warningBody');\r\n    }\r\n    \r\n    if (confirmTextEl) {\r\n        confirmTextEl.innerHTML = t('import.confirmText');\r\n    }\r\n    \r\n    // Setup drag-and-drop dropzone\r\n    const dropzone = document.getElementById('import-file-dropzone');\r\n    const fileInput = document.getElementById('import-file-input');\r\n    const dropzoneText = dropzone.querySelector('.import-dropzone-text');\r\n    \r\n    // Update dropzone text\r\n    if (dropzoneText) {\r\n        dropzoneText.textContent = t('import.dropzoneDefault');\r\n    }\r\n    \r\n    // Click to open file picker\r\n    dropzone.addEventListener('click', () => fileInput.click());\r\n    dropzone.addEventListener('keydown', (e) => {\r\n        if (e.key === 'Enter' || e.key === ' ') {\r\n            e.preventDefault();\r\n            fileInput.click();\r\n        }\r\n    });\r\n    \r\n    // File input change handler\r\n    fileInput.addEventListener('change', handleImportFileSelect, { once: true });\r\n    \r\n    // Drag and drop handlers\r\n    let dragDepth = 0;\r\n    \r\n    dropzone.addEventListener('dragenter', (e) => {\r\n        e.preventDefault();\r\n        dragDepth++;\r\n        dropzone.classList.add('import-dropzone-dragover');\r\n        dropzone.style.borderColor = 'var(--accent-blue)';\r\n        dropzone.style.background = 'var(--hover-bg)';\r\n    });\r\n    \r\n    dropzone.addEventListener('dragover', (e) => {\r\n        e.preventDefault();\r\n        dropzone.classList.add('import-dropzone-dragover');\r\n        dropzone.style.borderColor = 'var(--accent-blue)';\r\n        dropzone.style.background = 'var(--hover-bg)';\r\n    });\r\n    \r\n    dropzone.addEventListener('dragleave', (e) => {\r\n        e.preventDefault();\r\n        dragDepth = Math.max(0, dragDepth - 1);\r\n        if (dragDepth === 0) {\r\n            dropzone.classList.remove('import-dropzone-dragover');\r\n            dropzone.style.borderColor = 'var(--border-primary)';\r\n            dropzone.style.background = 'var(--bg-secondary)';\r\n        }\r\n    });\r\n    \r\n    dropzone.addEventListener('drop', (e) => {\r\n        e.preventDefault();\r\n        dragDepth = 0;\r\n        dropzone.classList.remove('import-dropzone-dragover');\r\n        dropzone.style.borderColor = 'var(--border-primary)';\r\n        dropzone.style.background = 'var(--bg-secondary)';\r\n        \r\n        const files = e.dataTransfer?.files;\r\n        if (files && files.length > 0) {\r\n            const file = files[0];\r\n            if (file.name.endsWith('.json') || file.type === 'application/json') {\r\n                handleImportFileFromDrop(file, dropzoneText);\r\n            } else {\r\n                showErrorNotification(t('import.errorInvalidFile'));\r\n            }\r\n        }\r\n    });\r\n    \r\n    dropzone.addEventListener('dragend', () => {\r\n        dragDepth = 0;\r\n        dropzone.classList.remove('import-dropzone-dragover');\r\n        dropzone.style.borderColor = 'var(--border-primary)';\r\n        dropzone.style.background = 'var(--bg-secondary)';\r\n    });\r\n    \r\n    // Setup lowercase handler for confirm input\r\n    const confirmInput = document.getElementById('import-confirm-input');\r\n    const lowercaseHandler = function(e) {\r\n        const start = e.target.selectionStart;\r\n        const end = e.target.selectionEnd;\r\n        e.target.value = e.target.value.toLowerCase();\r\n        e.target.setSelectionRange(start, end);\r\n    };\r\n    confirmInput.addEventListener('input', lowercaseHandler);\r\n    \r\n    // Handle Enter key\r\n    confirmInput.addEventListener('keydown', function(e) {\r\n        if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            confirmImportData();\r\n        }\r\n    }, { once: true });\r\n    \r\n    confirmInput.focus();\r\n}\r\n\r\nfunction closeImportDataModal() {\r\n    const modal = document.getElementById('import-data-modal');\r\n    modal.classList.remove('active');\r\n    \r\n    // Reset state\r\n    importFileData = null;\r\n    const fileInput = document.getElementById('import-file-input');\r\n    fileInput.value = '';\r\n    \r\n    // Reset dropzone text\r\n    updateImportDropzoneText(null);\r\n    const dropzone = document.getElementById('import-file-dropzone');\r\n    if (dropzone) {\r\n        dropzone.classList.remove('import-dropzone-dragover');\r\n        dropzone.style.borderColor = 'var(--border-primary)';\r\n        dropzone.style.background = 'var(--bg-secondary)';\r\n    }\r\n    \r\n    // Clone input to remove event listeners\r\n    const confirmInput = document.getElementById('import-confirm-input');\r\n    const newInput = confirmInput.cloneNode(true);\r\n    confirmInput.parentNode.replaceChild(newInput, confirmInput);\r\n    \r\n    document.getElementById('import-confirm-error').classList.remove('show');\r\n    document.getElementById('import-preview').style.display = 'none';\r\n}\r\n\r\nfunction handleImportFileSelect(event) {\r\n    const file = event.target.files[0];\r\n    if (!file) {\r\n        importFileData = null;\r\n        document.getElementById('import-preview').style.display = 'none';\r\n        updateImportDropzoneText(null);\r\n        return;\r\n    }\r\n    \r\n    handleImportFileFromDrop(file);\r\n}\r\n\r\nfunction handleImportFileFromDrop(file, dropzoneTextEl = null) {\r\n    if (!file) {\r\n        importFileData = null;\r\n        document.getElementById('import-preview').style.display = 'none';\r\n        updateImportDropzoneText(null);\r\n        return;\r\n    }\r\n    \r\n    if (!file.name.endsWith('.json') && file.type !== 'application/json') {\r\n        showErrorNotification(t('import.errorInvalidFile'));\r\n        const fileInput = document.getElementById('import-file-input');\r\n        if (fileInput) fileInput.value = '';\r\n        importFileData = null;\r\n        document.getElementById('import-preview').style.display = 'none';\r\n        updateImportDropzoneText(null);\r\n        return;\r\n    }\r\n    \r\n    // Update dropzone text to show filename\r\n    updateImportDropzoneText(file.name, dropzoneTextEl);\r\n    \r\n    const reader = new FileReader();\r\n    reader.onload = function(e) {\r\n        try {\r\n            const jsonData = JSON.parse(e.target.result);\r\n            \r\n            // Validate JSON structure\r\n            if (!validateImportData(jsonData)) {\r\n                showErrorNotification(t('import.errorInvalidFormat'));\r\n                const fileInput = document.getElementById('import-file-input');\r\n                if (fileInput) fileInput.value = '';\r\n                importFileData = null;\r\n                document.getElementById('import-preview').style.display = 'none';\r\n                updateImportDropzoneText(null);\r\n                return;\r\n            }\r\n            \r\n            // Store valid data\r\n            importFileData = jsonData;\r\n            \r\n            // Show preview\r\n            showImportPreview(jsonData);\r\n        } catch (error) {\r\n            console.error('Import file parse error:', error);\r\n            showErrorNotification(t('import.errorParseFailed'));\r\n            const fileInput = document.getElementById('import-file-input');\r\n            if (fileInput) fileInput.value = '';\r\n            importFileData = null;\r\n            document.getElementById('import-preview').style.display = 'none';\r\n            updateImportDropzoneText(null);\r\n        }\r\n    };\r\n    \r\n    reader.onerror = function() {\r\n        showErrorNotification(t('import.errorReadFailed'));\r\n        const fileInput = document.getElementById('import-file-input');\r\n        if (fileInput) fileInput.value = '';\r\n        importFileData = null;\r\n        document.getElementById('import-preview').style.display = 'none';\r\n        updateImportDropzoneText(null);\r\n    };\r\n    \r\n    reader.readAsText(file);\r\n}\r\n\r\nfunction updateImportDropzoneText(filename, dropzoneTextEl = null) {\r\n    const dropzone = document.getElementById('import-file-dropzone');\r\n    if (!dropzone) return;\r\n    \r\n    const textEl = dropzoneTextEl || dropzone.querySelector('.import-dropzone-text');\r\n    if (!textEl) return;\r\n    \r\n    if (filename) {\r\n        textEl.textContent = filename;\r\n        textEl.style.fontWeight = '500';\r\n        textEl.style.color = 'var(--text-primary)';\r\n    } else {\r\n        textEl.textContent = t('import.dropzoneDefault');\r\n        textEl.style.fontWeight = 'normal';\r\n        textEl.style.color = 'var(--text-secondary)';\r\n    }\r\n}\r\n\r\nfunction validateImportData(data) {\r\n    // Must be an object\r\n    if (!data || typeof data !== 'object') {\r\n        return false;\r\n    }\r\n    \r\n    // Must have tasks and projects arrays (at minimum)\r\n    if (!Array.isArray(data.tasks) || !Array.isArray(data.projects)) {\r\n        return false;\r\n    }\r\n    \r\n    // Validate tasks structure (basic check)\r\n    for (const task of data.tasks) {\r\n        if (!task || typeof task !== 'object' || !task.id || !task.title) {\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    // Validate projects structure (basic check)\r\n    for (const project of data.projects) {\r\n        if (!project || typeof project !== 'object' || !project.id || !project.name) {\r\n            return false;\r\n        }\r\n    }\r\n    \r\n    return true;\r\n}\r\n\r\nfunction showImportPreview(data) {\r\n    const previewEl = document.getElementById('import-preview');\r\n    const contentEl = document.getElementById('import-preview-content');\r\n    \r\n    const stats = {\r\n        projects: data.projects?.length || 0,\r\n        tasks: data.tasks?.length || 0,\r\n        feedbackItems: data.feedbackItems?.length || 0,\r\n        exportDate: data.exportDate || 'Unknown',\r\n        exportVersion: data.exportVersion || 'Unknown'\r\n    };\r\n    \r\n    contentEl.innerHTML = `\r\n        <div style=\"margin-bottom: 8px;\">\r\n            <strong>${stats.projects}</strong> ${stats.projects === 1 ? 'project' : 'projects'}\r\n        </div>\r\n        <div style=\"margin-bottom: 8px;\">\r\n            <strong>${stats.tasks}</strong> ${stats.tasks === 1 ? 'task' : 'tasks'}\r\n        </div>\r\n        ${stats.feedbackItems > 0 ? `<div style=\"margin-bottom: 8px;\"><strong>${stats.feedbackItems}</strong> feedback ${stats.feedbackItems === 1 ? 'item' : 'items'}</div>` : ''}\r\n        <div style=\"margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border-primary); color: var(--text-muted); font-size: 12px;\">\r\n            Exported: ${new Date(stats.exportDate).toLocaleDateString()} (v${stats.exportVersion})\r\n        </div>\r\n    `;\r\n    \r\n    previewEl.style.display = 'block';\r\n}\r\n\r\nasync function confirmImportData() {\r\n    const input = document.getElementById('import-confirm-input');\r\n    const errorMsg = document.getElementById('import-confirm-error');\r\n    const confirmText = input.value.trim().toLowerCase();\r\n    \r\n    if (confirmText !== 'import') {\r\n        errorMsg.classList.add('show');\r\n        input.focus();\r\n        return;\r\n    }\r\n    \r\n    if (!importFileData) {\r\n        showErrorNotification(t('import.errorNoFile'));\r\n        return;\r\n    }\r\n    \r\n    // Validate one more time\r\n    if (!validateImportData(importFileData)) {\r\n        showErrorNotification(t('import.errorInvalidFormat'));\r\n        return;\r\n    }\r\n    \r\n    try {\r\n        // Show loading notification\r\n        showNotification(t('import.processing'), 'info');\r\n        \r\n        // REPLACE all data (not merge!)\r\n        const importedData = importFileData;\r\n        \r\n        // Replace tasks\r\n        if (Array.isArray(importedData.tasks)) {\r\n            tasks = importedData.tasks;\r\n            // Update task counter if provided\r\n            if (importedData.taskCounter && typeof importedData.taskCounter === 'number') {\r\n                taskCounter = importedData.taskCounter;\r\n            } else {\r\n                // Calculate max ID if counter not provided\r\n                const maxTaskId = tasks.length > 0 ? Math.max(...tasks.map(t => t.id || 0)) : 0;\r\n                taskCounter = maxTaskId + 1;\r\n            }\r\n        }\r\n        \r\n        // Replace projects\r\n        if (Array.isArray(importedData.projects)) {\r\n            projects = importedData.projects;\r\n            // Update project counter if provided\r\n            if (importedData.projectCounter && typeof importedData.projectCounter === 'number') {\r\n                projectCounter = importedData.projectCounter;\r\n            } else {\r\n                // Calculate max ID if counter not provided\r\n                const maxProjectId = projects.length > 0 ? Math.max(...projects.map(p => p.id || 0)) : 0;\r\n                projectCounter = maxProjectId + 1;\r\n            }\r\n        }\r\n        \r\n        // Replace feedback items if provided\r\n        if (Array.isArray(importedData.feedbackItems)) {\r\n            feedbackItems = importedData.feedbackItems;\r\n        }\r\n        \r\n        // Replace project colors if provided\r\n        if (importedData.projectColors && typeof importedData.projectColors === 'object') {\r\n            projectColorMap = importedData.projectColors;\r\n        }\r\n        \r\n        // Replace sort mode if provided\r\n        if (importedData.sortMode) {\r\n            sortMode = importedData.sortMode;\r\n        }\r\n        \r\n        // Replace manual task order if provided\r\n        if (importedData.manualTaskOrder && typeof importedData.manualTaskOrder === 'object') {\r\n            manualTaskOrder = importedData.manualTaskOrder;\r\n        }\r\n        \r\n        // Replace settings if provided (but be careful - don't overwrite critical settings)\r\n        if (importedData.settings && typeof importedData.settings === 'object') {\r\n            // Merge settings carefully - keep some current settings like language, theme\r\n            const currentLanguage = settings.language;\r\n            const currentTheme = document.documentElement.getAttribute('data-theme');\r\n            \r\n            settings = {\r\n                ...settings,\r\n                ...importedData.settings\r\n            };\r\n            \r\n            // Restore critical settings\r\n            settings.language = currentLanguage;\r\n            if (currentTheme) {\r\n                document.documentElement.setAttribute('data-theme', currentTheme);\r\n            }\r\n        }\r\n        \r\n        // Import history if available (optional - historyService may not have importHistory method)\r\n        if (importedData.history && window.historyService && Array.isArray(importedData.history)) {\r\n            try {\r\n                if (typeof window.historyService.importHistory === 'function') {\r\n                    window.historyService.importHistory(importedData.history);\r\n                } else {\r\n                    console.warn('History import not available - historyService.importHistory not found');\r\n                }\r\n            } catch (err) {\r\n                console.warn('Failed to import history:', err);\r\n            }\r\n        }\r\n        \r\n        // Save all imported data\r\n        await Promise.all([\r\n            saveTasks().catch(err => {\r\n                console.error('Failed to save imported tasks:', err);\r\n                throw new Error('Failed to save tasks');\r\n            }),\r\n            saveProjects().catch(err => {\r\n                console.error('Failed to save imported projects:', err);\r\n                throw new Error('Failed to save projects');\r\n            }),\r\n            saveFeedback().catch(err => {\r\n                console.error('Failed to save imported feedback:', err);\r\n                // Don't throw - feedback save failure is less critical\r\n            }),\r\n            saveSettings().catch(err => {\r\n                console.error('Failed to save imported settings:', err);\r\n                // Don't throw - settings save failure is less critical\r\n            })\r\n        ]);\r\n        \r\n        // Save project colors if changed\r\n        if (importedData.projectColors) {\r\n            try {\r\n                await saveProjectColors();\r\n            } catch (err) {\r\n                console.warn('Failed to save project colors:', err);\r\n            }\r\n        }\r\n        \r\n        // Close modal\r\n        closeImportDataModal();\r\n        \r\n        // Show success notification\r\n        showSuccessNotification(t('import.success'));\r\n        \r\n        // Refresh UI\r\n        render();\r\n        \r\n        // Navigate to dashboard to show imported data\r\n        window.location.hash = '#dashboard';\r\n        showPage('dashboard');\r\n        \r\n    } catch (error) {\r\n        console.error('Import error:', error);\r\n        showErrorNotification(t('import.errorFailed') + ': ' + (error.message || 'Unknown error'));\r\n    }\r\n}\r\n\r\nasync function generateReport() {\r\n    // Show loading notification\r\n    showNotification('Generando reporte...', 'info');\r\n\r\n    try {\r\n        // Dynamic import to avoid blocking app load (docx library is ~500KB from CDN)\r\n        const { generateWordReport } = await import('./src/services/reportGenerator.js');\r\n        const result = await generateWordReport(projects, tasks);\r\n\r\n        if (result.success) {\r\n            showNotification(`\\u{2705} Reporte generado: ${result.filename}`, 'success');\r\n\r\n            // Show summary in console for debugging\r\n            console.log('Report Summary:', {\r\n                activeProjects: result.insights.activeProjectsCount,\r\n                completedTasks: `${result.insights.completedTasks}/${result.insights.totalTasks}`,\r\n                progress: `${result.insights.completionPercent}%`\r\n            });\r\n        } else {\r\n            throw new Error(result.error);\r\n        }\r\n    } catch (error) {\r\n        console.error('Error generating report:', error);\r\n        showNotification('\u274C Error al generar el reporte: ' + error.message, 'error');\r\n    }\r\n}\r\n\r\nfunction updateCounts() {\r\n    document.getElementById(\"projects-count\").textContent = projects.length;\r\n    document.getElementById(\"tasks-count\").textContent = tasks.length;\r\n    \r\n    // Legacy dashboard stats (keep for backward compatibility)\r\n    const activeProjectsEl = document.getElementById(\"active-projects\");\r\n    const pendingTasksEl = document.getElementById(\"pending-tasks\");\r\n    const completedTasksEl = document.getElementById(\"completed-tasks\");\r\n    \r\n    if (activeProjectsEl) activeProjectsEl.textContent = projects.length;\r\n    if (pendingTasksEl) pendingTasksEl.textContent = tasks.filter((t) => t.status !== \"done\").length;\r\n    if (completedTasksEl) completedTasksEl.textContent = tasks.filter((t) => t.status === \"done\").length;\r\n\r\n    // Kanban counts\r\n    const todoCountEl = document.getElementById(\"todo-count\");\r\n    const progressCountEl = document.getElementById(\"progress-count\");\r\n    const reviewCountEl = document.getElementById(\"review-count\");\r\n    const doneCountEl = document.getElementById(\"done-count\");\r\n    \r\n    if (todoCountEl) todoCountEl.textContent = tasks.filter((t) => t.status === \"todo\").length;\r\n    if (progressCountEl) progressCountEl.textContent = tasks.filter((t) => t.status === \"progress\").length;\r\n    if (reviewCountEl) reviewCountEl.textContent = tasks.filter((t) => t.status === \"review\").length;\r\n    if (doneCountEl) doneCountEl.textContent = tasks.filter((t) => t.status === \"done\").length;\r\n    \r\n    // Feedback count\r\n    const feedbackCount = feedbackItems.filter(f => f.status === 'open').length;\r\n    const feedbackCountEl = document.getElementById(\"feedback-count\");\r\n    if (feedbackCountEl) feedbackCountEl.textContent = feedbackCount;\r\n\r\n    updateNotificationState();\r\n}\r\n\r\nlet currentSort = { column: null, direction: \"asc\" };\r\n\r\nfunction sortTable(column) {\r\n    if (currentSort.column === column) {\r\n        currentSort.direction =\r\n            currentSort.direction === \"asc\" ? \"desc\" : \"asc\";\r\n    } else {\r\n        currentSort.column = column;\r\n        currentSort.direction = \"asc\";\r\n    }\r\n\r\n    document.querySelectorAll(\".tasks-table th .sort-indicator\").forEach((span) => {\r\n        span.textContent = \"\u2195\";\r\n        span.style.opacity = \"0.5\";\r\n    });\r\n\r\n    const indicator = document.getElementById(`sort-${column}`);\r\n    if (indicator) {\r\n        indicator.textContent = currentSort.direction === \"asc\" ? \"\u2191\" : \"\u2193\";\r\n        indicator.style.opacity = \"1\";\r\n    }\r\n\r\n    renderListView();\r\n}\r\n\r\nfunction renderListView() {\r\n    const tbody = document.getElementById(\"tasks-table-body\");\r\n\r\n    const source = typeof getFilteredTasks === \"function\" ? getFilteredTasks() : tasks.slice();\r\n    const cutoff = getKanbanUpdatedCutoffTime(window.kanbanUpdatedFilter);\r\n    \r\n    // Use list view module for filtering and sorting\r\n    const listData = prepareListViewData(source, {\r\n        currentSort: currentSort,\r\n        projects: projects,\r\n        updatedCutoff: cutoff,\r\n        getTaskUpdatedTime: getTaskUpdatedTime\r\n    });\r\n    \r\n    const rows = listData.tasks;\r\n\r\n    const listCountText = t('tasks.list.count', { count: rows.length }) || `${rows.length} results`;\r\n    const listCountEl = document.getElementById('tasks-list-count');\r\n    if (listCountEl) {\r\n        listCountEl.textContent = listCountText;\r\n    }\r\n    const listCountBottomEl = document.getElementById('tasks-list-count-bottom');\r\n    if (listCountBottomEl) {\r\n        listCountBottomEl.textContent = listCountText;\r\n    }\r\n\r\n    if (tbody) {\r\n        // Use module function for HTML generation\r\n        const helpers = {\r\n            escapeHtml,\r\n            formatDate,\r\n            getTagColor,\r\n            getProjectColor,\r\n            getPriorityLabel,\r\n            getStatusLabel,\r\n            formatTaskUpdatedDateTime,\r\n            projects,\r\n            noProjectText: t('tasks.noProject'),\r\n            noDateText: t('tasks.noDate')\r\n        };\r\n        tbody.innerHTML = generateListViewHTML(rows, helpers);\r\n    }\r\n\r\n    // Also render mobile cards (shown on mobile, hidden on desktop)\r\n    renderMobileCardsPremium(rows);\r\n}\r\n\r\n// ================================\r\n// PREMIUM MOBILE CARDS\r\n// ================================\r\n\r\n// Smart date formatter with urgency indication\r\n// Uses calculateSmartDateInfo from listView module for pure calculation\r\nfunction getSmartDateInfo(endDate, status = null) {\r\n    const info = calculateSmartDateInfo(endDate, status);\r\n    \r\n    if (!info.hasDate) {\r\n        return { text: t('tasks.noEndDate'), class: \"\", showPrefix: false };\r\n    }\r\n    \r\n    // Apply translations based on urgency\r\n    let text;\r\n    switch (info.urgency) {\r\n        case 'overdue':\r\n            text = info.daysOverdue === 1\r\n                ? t('tasks.due.yesterday')\r\n                : t('tasks.due.daysOverdue', { count: info.daysOverdue });\r\n            break;\r\n        case 'tomorrow':\r\n            text = t('tasks.due.tomorrow');\r\n            break;\r\n        default:\r\n            text = formatDate(endDate);\r\n    }\r\n    \r\n    return { text, class: info.class, showPrefix: info.showPrefix };\r\n}\r\n\r\n// Render premium mobile cards\r\nfunction renderMobileCardsPremium(tasks) {\r\n    const container = document.getElementById(\"tasks-list-mobile\");\r\n    if (!container) return;\r\n\r\n    // Preserve expanded card state across re-renders.\r\n    const expandedIds = new Set(\r\n        Array.from(container.querySelectorAll('.task-card-mobile.expanded'))\r\n            .map(card => parseInt(card.dataset.taskId, 10))\r\n            .filter(Number.isFinite)\r\n    );\r\n\r\n    const getDescriptionForMobileCard = (html) => {\r\n        const tempDiv = document.createElement(\"div\");\r\n        tempDiv.innerHTML = html || \"\";\r\n\r\n        const checkboxRows = Array.from(tempDiv.querySelectorAll(\".checkbox-row\"));\r\n        const checklistLines = checkboxRows\r\n            .map((row) => {\r\n                const toggle = row.querySelector(\".checkbox-toggle\");\r\n                const isChecked =\r\n                    toggle?.getAttribute(\"aria-pressed\") === \"true\" ||\r\n                    toggle?.classList?.contains(\"checked\");\r\n                const text = (row.querySelector(\".check-text\")?.textContent || \"\").trim();\r\n                if (!text) return null;\r\n                return `${isChecked ? \"\u2713\" : \"\u2610\"} ${text}`;\r\n            })\r\n            .filter(Boolean);\r\n\r\n        checkboxRows.forEach((row) => row.remove());\r\n\r\n        const baseText = (tempDiv.textContent || tempDiv.innerText || \"\").replace(/\\s+/g, \" \").trim();\r\n        const checklistText = checklistLines.join(\"\\n\").trim();\r\n        if (baseText && checklistText) return `${baseText}\\n${checklistText}`;\r\n        return baseText || checklistText;\r\n    };\r\n\r\n    // Empty state\r\n    if (tasks.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"tasks-list-mobile-empty\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2\" />\r\n                </svg>\r\n                <h3>${t('projects.details.noTasksFound')}</h3>\r\n                <p>Try adjusting your filters or create a new task</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n\r\n    // Render cards\r\n    container.innerHTML = tasks.map((task) => {\r\n        const proj = projects.find((p) => p.id === task.projectId);\r\n        const projColor = proj ? getProjectColor(proj.id) : \"#999\";\r\n        const dateInfo = getSmartDateInfo(task.endDate, task.status);\r\n\r\n        const descText = getDescriptionForMobileCard(task.description);\r\n\r\n        // Tags\r\n        const tagsHTML = task.tags && task.tags.length > 0\r\n            ? task.tags.map(tag => {\r\n                const tagColor = getTagColor(tag);\r\n                return `<span class=\"card-tag-premium\" style=\"background:${tagColor}; border-color:${tagColor}; color:#ffffff;\">${escapeHtml(tag.toUpperCase())}</span>`;\r\n            }).join('')\r\n            : '';\r\n\r\n        // Attachments count\r\n        const attachmentCount = task.attachments && task.attachments.length > 0 ? task.attachments.length : 0;\r\n\r\n        const doneClass = task.status === 'done' ? ' is-done' : '';\r\n\r\n        return `\r\n            <div class=\"task-card-mobile${doneClass}\" data-priority=\"${task.priority}\" data-task-id=\"${task.id}\">\r\n                <!-- Header (always visible) -->\r\n                <div class=\"card-header-premium\">\r\n                    <div class=\"card-header-content\" data-card-action=\"toggle\">\r\n                        <h3 class=\"card-title-premium\">${escapeHtml(task.title || t('tasks.untitled'))}</h3>\r\n                        <div class=\"card-meta-premium\">\r\n                            <span class=\"status-badge-mobile ${task.status}\">${getStatusLabel(task.status)}</span>\r\n                            ${dateInfo.text ? `<span class=\"card-date-smart ${dateInfo.class}\">${dateInfo.showPrefix ? t('tasks.endDatePrefix') : ''}${dateInfo.text}</span>` : ''}\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"card-actions-premium\">\r\n                        <button class=\"card-open-btn-premium\" data-card-action=\"open\" title=\"${t('tasks.openTaskDetails')}\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\" />\r\n                            </svg>\r\n                        </button>\r\n                        <svg class=\"card-chevron-premium\" data-card-action=\"toggle\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\r\n                        </svg>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Expandable body -->\r\n                <div class=\"card-body-premium\">\r\n                    ${descText ? `\r\n                    <div class=\"card-description-premium\">\r\n                        <div class=\"card-description-premium-label\">${t('tasks.card.description')}</div>\r\n                        <div class=\"card-description-premium-text\">${escapeHtml(descText)}</div>\r\n                    </div>\r\n                    ` : ''}\r\n\r\n                    ${tagsHTML ? `\r\n                    <div class=\"card-tags-premium\">${tagsHTML}</div>\r\n                    ` : ''}\r\n\r\n                    ${proj ? `\r\n                    <div class=\"card-project-premium\">\r\n                        <span class=\"card-project-dot-premium\" style=\"background-color: ${projColor};\"></span>\r\n                        <span class=\"card-project-name-premium\">${escapeHtml(proj.name)}</span>\r\n                    </div>\r\n                    ` : ''}\r\n\r\n                    <div class=\"card-footer-premium\">\r\n                        ${task.startDate ? `\r\n                        <div class=\"card-meta-item-premium\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                            </svg>\r\n                            <span>${t('tasks.startDatePrefix')}${formatDate(task.startDate)}</span>\r\n                        </div>\r\n                        ` : ''}\r\n                        ${task.endDate ? `\r\n                        <div class=\"card-meta-item-premium\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                            </svg>\r\n                            <span>${t('tasks.endDatePrefix')}${formatDate(task.endDate)}</span>\r\n                        </div>\r\n                        ` : ''}\r\n                        ${attachmentCount > 0 ? `\r\n                        <div class=\"card-meta-item-premium\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13\" />\r\n                            </svg>\r\n                            <span>${attachmentCount}</span>\r\n                        </div>\r\n                        ` : ''}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }).join(\"\");\r\n\r\n    // Attach event listeners\r\n    attachMobileCardListeners();\r\n\r\n    // Restore expanded state after re-render.\r\n    if (expandedIds.size > 0) {\r\n        expandedIds.forEach((id) => {\r\n            const card = container.querySelector(`.task-card-mobile[data-task-id=\"${id}\"]`);\r\n            if (card) card.classList.add('expanded');\r\n        });\r\n    }\r\n}\r\n\r\n// Attach event listeners to cards\r\nfunction attachMobileCardListeners() {\r\n    const cards = document.querySelectorAll('.task-card-mobile');\r\n\r\n    cards.forEach(card => {\r\n        const taskId = parseInt(card.dataset.taskId);\r\n        const toggleElements = card.querySelectorAll('[data-card-action=\"toggle\"]');\r\n        const openButton = card.querySelector('[data-card-action=\"open\"]');\r\n\r\n        // Toggle expand/collapse on header content or chevron click\r\n        toggleElements.forEach(element => {\r\n            element.addEventListener('click', (e) => {\r\n                e.stopPropagation();\r\n\r\n                // Close other expanded cards for cleaner UX\r\n                document.querySelectorAll('.task-card-mobile.expanded').forEach(otherCard => {\r\n                    if (otherCard !== card) {\r\n                        otherCard.classList.remove('expanded');\r\n                    }\r\n                });\r\n\r\n                // Toggle this card\r\n                card.classList.toggle('expanded');\r\n            });\r\n        });\r\n\r\n        // Open full modal on button click\r\n        if (openButton) {\r\n            openButton.addEventListener('click', (e) => {\r\n                e.stopPropagation();\r\n                openTaskDetails(taskId);\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\nfunction updateSelectDisplay(selectId) {\r\n    const select = document.getElementById(selectId);\r\n    const display = select.parentElement.querySelector(\".select-display\");\r\n    const selected = Array.from(select.selectedOptions);\r\n    const hasAll = selected.some((o) => o.hasAttribute(\"data-all\"));\r\n\r\n    // Remove/add selection styling\r\n    if (selected.length === 0 || hasAll) {\r\n        display.classList.remove(\"has-selection\");\r\n    } else {\r\n        display.classList.add(\"has-selection\");\r\n    }\r\n\r\n    if (selected.length === 0 || hasAll) {\r\n        if (selectId === \"filter-status\")\r\n            display.textContent = \"All Statuses \u25BC\";\r\n        else if (selectId === \"filter-priority\")\r\n            display.textContent = \"All Priorities \u25BC\";\r\n        else if (selectId === \"filter-project\")\r\n            display.textContent = \"All Projects \u25BC\";\r\n    } else if (selected.length === 1) {\r\n        display.textContent = selected[0].textContent + \" \u25BC\";\r\n    } else {\r\n        display.textContent = `${selected.length} selected \u25BC`;\r\n    }\r\n}\r\n\r\nfunction toggleMultiSelect(selectId) {\r\n    const select = document.getElementById(selectId);\r\n    const isActive = select.classList.contains(\"active\");\r\n\r\n    // Close all other multi-selects\r\n    document\r\n        .querySelectorAll(\".multi-select.active\")\r\n        .forEach((s) => s.classList.remove(\"active\"));\r\n\r\n    if (!isActive) {\r\n        select.classList.add(\"active\");\r\n        select.focus();\r\n    }\r\n}\r\n\r\n// Close multi-selects when clicking outside\r\ndocument.addEventListener(\"click\", function (e) {\r\n    if (!e.target.closest(\".multi-select-wrapper\")) {\r\n        document\r\n            .querySelectorAll(\".multi-select.active\")\r\n            .forEach((s) => s.classList.remove(\"active\"));\r\n    }\r\n});\r\n\r\n// Helper function to generate HTML for a single project list item\r\n// Uses module function with helper dependencies\r\nfunction generateProjectItemHTML(project) {\r\n    const helpers = {\r\n        escapeHtml,\r\n        formatDatePretty,\r\n        getProjectColor,\r\n        getProjectStatus,\r\n        getProjectStatusLabel,\r\n        getTagColor,\r\n        getPriorityLabel,\r\n        getStatusLabel,\r\n        getLocale,\r\n        t\r\n    };\r\n    return generateProjectItemHTMLModule(project, tasks, helpers);\r\n}\r\n\r\nlet expandedTaskLayoutRafId = null;\r\nfunction updateExpandedTaskRowLayouts(root = document) {\r\n    const taskItems = root.querySelectorAll?.('.expanded-task-item') || [];\r\n    taskItems.forEach((item) => {\r\n        // Skip hidden items (collapsed project)\r\n        if (item.offsetParent === null) return;\r\n\r\n        item.classList.remove('expanded-task-item--stacked');\r\n\r\n        const meta = item.querySelector('.expanded-task-meta');\r\n        if (!meta) return;\r\n\r\n        const tags = meta.querySelector('.task-tags');\r\n        const dates = meta.querySelector('.expanded-task-dates');\r\n\r\n        const overflows = (el) => el && el.clientWidth > 0 && el.scrollWidth > el.clientWidth + 1;\r\n\r\n        const shouldStack =\r\n            overflows(item) ||\r\n            overflows(meta) ||\r\n            overflows(tags) ||\r\n            overflows(dates);\r\n\r\n        if (shouldStack) item.classList.add('expanded-task-item--stacked');\r\n    });\r\n}\r\n\r\nfunction scheduleExpandedTaskRowLayoutUpdate(root = document) {\r\n    if (expandedTaskLayoutRafId !== null) cancelAnimationFrame(expandedTaskLayoutRafId);\r\n    expandedTaskLayoutRafId = requestAnimationFrame(() => {\r\n        expandedTaskLayoutRafId = null;\r\n        updateExpandedTaskRowLayouts(root);\r\n    });\r\n}\r\n\r\nfunction renderProjects() {\r\n    const renderTimer = debugTimeStart(\"render\", \"projects\", { projectCount: projects.length });\r\n    const container = document.getElementById(\"projects-list\");\r\n    if (projects.length === 0) {\r\n        container.innerHTML =\r\n            `<div class=\"empty-state\"><h3>${t('projects.empty.title')}</h3><p>${t('projects.empty.subtitle')}</p></div>`;\r\n        // Also clear mobile container if it exists\r\n        const mobileContainer = document.getElementById(\"projects-list-mobile\");\r\n        if (mobileContainer) mobileContainer.innerHTML = '';\r\n        debugTimeEnd(\"render\", renderTimer, { projectCount: projects.length, rendered: 0 });\r\n        return;\r\n    }\r\n\r\n    // Save expanded state before re-rendering\r\n    const expandedProjects = new Set();\r\n    container.querySelectorAll('.project-list-item.expanded').forEach(item => {\r\n        const projectId = item.id.replace('project-item-', '');\r\n        expandedProjects.add(projectId);\r\n    });\r\n// Use sorted view if active, otherwise use full projects array\r\n    const projectsToRender = appState.projectsSortedView || projects;\r\n// Re-render\r\n    container.innerHTML = projectsToRender.map(generateProjectItemHTML).join(\"\");\r\n// Restore expanded state\r\n    expandedProjects.forEach(projectId => {\r\n        const item = document.getElementById(`project-item-${projectId}`);\r\n        if (item) {\r\n            item.classList.add('expanded');\r\n} else {\r\n}\r\n    });\r\n\r\n    // Render mobile cards\r\n    renderMobileProjects(projectsToRender);\r\n\r\n    scheduleExpandedTaskRowLayoutUpdate(container);\r\n    debugTimeEnd(\"render\", renderTimer, { projectCount: projects.length, rendered: projectsToRender.length });\r\n}\r\n\r\nfunction toggleProjectExpand(projectId) {\r\n    const item = document.getElementById(`project-item-${projectId}`);\r\n    if (item) {\r\n        item.classList.toggle('expanded');\r\n        scheduleExpandedTaskRowLayoutUpdate(item);\r\n    }\r\n}\r\n// Make function globally accessible for inline onclick handlers\r\nwindow.toggleProjectExpand = toggleProjectExpand;\r\n\r\n// ================================\r\n// MOBILE PROJECT CARDS\r\n// ================================\r\n\r\nfunction renderMobileProjects(projects) {\r\n    const container = document.getElementById(\"projects-list-mobile\");\r\n    if (!container) return;\r\n\r\n    if (projects.length === 0) {\r\n        container.innerHTML = `\r\n            <div class=\"projects-list-mobile-empty\">\r\n                <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\" stroke-width=\"2\">\r\n                    <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z\" />\r\n                </svg>\r\n                <h3>${t('projects.empty.searchTitle')}</h3>\r\n                <p>${t('projects.empty.searchSubtitle')}</p>\r\n            </div>\r\n        `;\r\n        return;\r\n    }\r\n\r\n    container.innerHTML = projects.map((project) => {\r\n        const projectTasks = tasks.filter((t) => t.projectId === project.id);\r\n        const completed = projectTasks.filter((t) => t.status === 'done').length;\r\n        const inProgress = projectTasks.filter((t) => t.status === 'progress').length;\r\n        const review = projectTasks.filter((t) => t.status === 'review').length;\r\n        const todo = projectTasks.filter((t) => t.status === 'todo').length;\r\n        const backlog = projectTasks.filter((t) => t.status === 'backlog').length;\r\n        const total = projectTasks.length;\r\n        const completionPct = total > 0 ? Math.round((completed / total) * 100) : 0;\r\n\r\n        const swatchColor = getProjectColor(project.id);\r\n        const projectStatus = getProjectStatus(project.id);\r\n\r\n        return `\r\n            <div class=\"project-card-mobile\" data-project-id=\"${project.id}\">\r\n                <!-- Header (always visible) -->\r\n                <div class=\"project-card-header-premium\">\r\n                    <div class=\"project-card-header-content\" data-card-action=\"toggle\">\r\n                        <div class=\"project-card-title-row\">\r\n                            <span class=\"project-swatch-mobile\" style=\"background: ${swatchColor};\"></span>\r\n                            <h3 class=\"project-card-title-premium\">${escapeHtml(project.name || \"Untitled Project\")}</h3>\r\n                        </div>\r\n                        <div class=\"project-card-meta-premium\">\r\n                            <span class=\"project-status-badge-mobile ${projectStatus}\">${getProjectStatusLabel(projectStatus)}</span>\r\n                            <span class=\"project-card-tasks-count\">${t('projects.card.tasksCount', { count: total })}</span>\r\n                            ${completionPct > 0 ? `<span class=\"project-card-completion\">${t('projects.card.percentDone', { count: completionPct })}</span>` : ''}\r\n                        </div>\r\n                    </div>\r\n                    <div class=\"project-card-actions-premium\">\r\n                        <button class=\"project-card-open-btn-premium\" data-action=\"showProjectDetails\" data-param=\"${project.id}\" title=\"${t('projects.openDetailsTitle')}\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14\" />\r\n                            </svg>\r\n                        </button>\r\n                        <svg class=\"project-card-chevron-premium\" data-card-action=\"toggle\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                            <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M19 9l-7 7-7-7\" />\r\n                        </svg>\r\n                    </div>\r\n                </div>\r\n\r\n                <!-- Expandable body -->\r\n                <div class=\"project-card-body-premium\">\r\n                    ${project.tags && project.tags.length > 0 ? `\r\n                    <div class=\"project-card-tags-premium\" style=\"display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px;\">\r\n                        ${project.tags.map(tag => `<span style=\"background-color: ${getProjectColor(project.id)}; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: 500;\">${escapeHtml(tag.toUpperCase())}</span>`).join('')}\r\n                    </div>\r\n                    ` : ''}\r\n\r\n                    ${project.description ? `\r\n                    <div class=\"project-card-description-premium\">\r\n                        <div class=\"project-card-description-label\">${t('tasks.card.description')}</div>\r\n                        <div class=\"project-card-description-text\">${escapeHtml(project.description)}</div>\r\n                    </div>\r\n                    ` : ''}\r\n\r\n                    <div class=\"project-card-footer-premium\">\r\n                        ${project.startDate ? `\r\n                        <div class=\"project-card-meta-item-premium\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                            </svg>\r\n                            <span>${t('projects.details.startDate')}: ${formatDate(project.startDate)}</span>\r\n                        </div>\r\n                        ` : ''}\r\n                        ${project.endDate ? `\r\n                        <div class=\"project-card-meta-item-premium\">\r\n                            <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\r\n                                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                            </svg>\r\n                            <span>${t('tasks.endDatePrefix')}${formatDate(project.endDate)}</span>\r\n                        </div>\r\n                        ` : ''}\r\n                    </div>\r\n\r\n                    ${total > 0 ? `\r\n                    <div class=\"project-card-progress-premium\">\r\n                        <div class=\"project-card-progress-label\">${t('projects.details.taskProgress')}</div>\r\n                        <div class=\"project-card-progress-bar\">\r\n                            <div class=\"progress-segment done\" style=\"width: ${(completed/total)*100}%;\"></div>\r\n                            <div class=\"progress-segment progress\" style=\"width: ${(inProgress/total)*100}%;\"></div>\r\n                            <div class=\"progress-segment review\" style=\"width: ${(review/total)*100}%;\"></div>\r\n                            <div class=\"progress-segment todo\" style=\"width: ${(todo/total)*100}%;\"></div>\r\n                            <div class=\"progress-segment backlog\" style=\"width: ${(backlog/total)*100}%;\"></div>\r\n                        </div>\r\n                        <div class=\"project-card-breakdown\">\r\n                            ${completed > 0 ? `<span class=\"breakdown-item done\">${completed} ${t('tasks.status.done')}</span>` : ''}\r\n                            ${inProgress > 0 ? `<span class=\"breakdown-item progress\">${inProgress} ${t('tasks.status.progress')}</span>` : ''}\r\n                            ${review > 0 ? `<span class=\"breakdown-item review\">${review} ${t('tasks.status.review')}</span>` : ''}\r\n                            ${todo > 0 ? `<span class=\"breakdown-item todo\">${todo} ${t('tasks.status.todo')}</span>` : ''}\r\n                            ${backlog > 0 ? `<span class=\"breakdown-item backlog\">${backlog} ${t('tasks.status.backlog')}</span>` : ''}\r\n                        </div>\r\n                    </div>\r\n                    ` : ''}\r\n                </div>\r\n            </div>\r\n        `;\r\n    }).join(\"\");\r\n\r\n    // Attach event listeners\r\n    attachMobileProjectCardListeners();\r\n}\r\n\r\nfunction attachMobileProjectCardListeners() {\r\n    const cards = document.querySelectorAll('.project-card-mobile');\r\n\r\n    cards.forEach(card => {\r\n        const projectId = parseInt(card.dataset.projectId);\r\n        const toggleElements = card.querySelectorAll('[data-card-action=\"toggle\"]');\r\n        const openButton = card.querySelector('[data-action=\"showProjectDetails\"]');\r\n\r\n        // Toggle expand/collapse on header content or chevron click\r\n        toggleElements.forEach(element => {\r\n            element.addEventListener('click', (e) => {\r\n                e.stopPropagation();\r\n\r\n                // Close other expanded cards for cleaner UX\r\n                document.querySelectorAll('.project-card-mobile.expanded').forEach(otherCard => {\r\n                    if (otherCard !== card) {\r\n                        otherCard.classList.remove('expanded');\r\n                    }\r\n                });\r\n\r\n                // Toggle this card\r\n                card.classList.toggle('expanded');\r\n            });\r\n        });\r\n\r\n        // Open project details on button click\r\n        if (openButton) {\r\n            openButton.addEventListener('click', (e) => {\r\n                e.stopPropagation();\r\n                showProjectDetails(projectId);\r\n            });\r\n        }\r\n    });\r\n}\r\n\r\nfunction renderTasks() {\r\n    const renderTimer = debugTimeStart(\"render\", \"tasks\", { taskCount: tasks.length });\r\n    const source =\r\n        typeof getFilteredTasks === \"function\"\r\n            ? getFilteredTasks()\r\n            : tasks.slice();\r\n\r\n    const cutoff = getKanbanUpdatedCutoffTime(window.kanbanUpdatedFilter);\r\n    \r\n    // Use kanban module for grouping and sorting\r\n    const kanbanData = prepareKanbanData(source, {\r\n        showBacklog: window.kanbanShowBacklog === true,\r\n        sortMode: sortMode,\r\n        manualTaskOrder: manualTaskOrder,\r\n        updatedCutoff: cutoff,\r\n        getTaskUpdatedTime: getTaskUpdatedTime\r\n    });\r\n    \r\n    const byStatus = kanbanData.byStatus;\r\n    const sourceForKanban = kanbanData.totalFiltered;\r\n\r\n    const cols = {\r\n        backlog: document.getElementById(\"backlog-tasks\"),\r\n        todo: document.getElementById(\"todo-tasks\"),\r\n        progress: document.getElementById(\"progress-tasks\"),\r\n        review: document.getElementById(\"review-tasks\"),\r\n        done: document.getElementById(\"done-tasks\"),\r\n    };\r\n\r\n    // Update counts using kanban module data\r\n    const counts = kanbanData.counts;\r\n    const cBacklog = document.getElementById(\"backlog-count\");\r\n    const cTodo = document.getElementById(\"todo-count\");\r\n    const cProg = document.getElementById(\"progress-count\");\r\n    const cRev = document.getElementById(\"review-count\");\r\n    const cDone = document.getElementById(\"done-count\");\r\n    if (cBacklog) cBacklog.textContent = counts.backlog;\r\n    if (cTodo) cTodo.textContent = counts.todo;\r\n    if (cProg) cProg.textContent = counts.progress;\r\n    if (cRev) cRev.textContent = counts.review;\r\n    if (cDone) cDone.textContent = counts.done;\r\n\r\n    // Render cards using module function\r\n    const cardHelpers = {\r\n        escapeHtml,\r\n        formatDate,\r\n        getProjectColor,\r\n        getTagColor,\r\n        getPriorityLabel,\r\n        projects,\r\n        selectedCards: appState.selectedCards,\r\n        showProjects: window.kanbanShowProjects !== false,\r\n        showNoDate: window.kanbanShowNoDate !== false,\r\n        noProjectText: t('tasks.noProject'),\r\n        noDateText: t('tasks.noDate')\r\n    };\r\n\r\n    [\"backlog\", \"todo\", \"progress\", \"review\", \"done\"].forEach((status) => {\r\n        const wrap = cols[status];\r\n        if (!wrap) return;\r\n        wrap.innerHTML = generateKanbanColumnHTML(byStatus[status], cardHelpers);\r\n    });\r\n        \r\n    setupDragAndDrop();\r\n    updateSortUI();\r\n    debugTimeEnd(\"render\", renderTimer, {\r\n        taskCount: tasks.length,\r\n        filteredCount: source.length,\r\n        kanbanCount: sourceForKanban\r\n    });\r\n}\r\n\r\n\r\n// Dynamically reorganize Details fields based on which are filled (mobile only)\r\n// SIMPLIFIED LOGIC:\r\n// - Start/End Date: If task was EVER created with dates, they ALWAYS stay in General (even if cleared)\r\n// - Tags/Links: Move between General (filled) and Details (empty) dynamically\r\nfunction reorganizeMobileTaskFields() {\r\n    if (window.innerWidth > 768) return; // Desktop only\r\n\r\n    const modal = document.getElementById(\"task-modal\");\r\n    if (!modal) return;\r\n\r\n    const form = modal.querySelector(\"#task-form\");\r\n    const editingTaskId = form?.dataset.editingTaskId;\r\n\r\n    // Only reorganize when editing existing task\r\n    if (!editingTaskId) return;\r\n\r\n    // Check if dates were INITIALLY set when modal opened (stored as data attributes)\r\n    const startDateWasEverSet = modal.dataset.initialStartDate === 'true';\r\n    const endDateWasEverSet = modal.dataset.initialEndDate === 'true';\r\n\r\n    // Get task data for calculation\r\n    let taskData = null;\r\n    if (editingTaskId) {\r\n        taskData = tasks.find(t => t.id === parseInt(editingTaskId, 10));\r\n    }\r\n    if (!taskData) {\r\n        // Fallback to temp data when creating\r\n        taskData = {\r\n            tags: window.tempTags || [],\r\n            attachments: tempAttachments || []\r\n        };\r\n    }\r\n\r\n    // Calculate field placement using pure function\r\n    const fieldState = calculateMobileFieldPlacement(taskData, {\r\n        startDateWasEverSet,\r\n        endDateWasEverSet\r\n    });\r\n\r\n    // Get form groups for DOM manipulation\r\n    const tagInput = modal.querySelector('#tag-input');\r\n    const tagsGroup = tagInput ? tagInput.closest('.form-group') : null;\r\n\r\n    const startDateInputs = modal.querySelectorAll('input[name=\"startDate\"]');\r\n    let startDateGroup = null;\r\n    for (const input of startDateInputs) {\r\n        const group = input.closest('.form-group');\r\n        if (group) {\r\n            startDateGroup = group;\r\n            break;\r\n        }\r\n    }\r\n\r\n    const endDateInputs = modal.querySelectorAll('input[name=\"endDate\"]');\r\n    let endDateGroup = null;\r\n    for (const input of endDateInputs) {\r\n        const group = input.closest('.form-group');\r\n        if (group) {\r\n            endDateGroup = group;\r\n            break;\r\n        }\r\n    }\r\n\r\n    const linksList = modal.querySelector('#attachments-links-list');\r\n    const linksGroup = linksList ? linksList.closest('.form-group') : null;\r\n\r\n    // Apply field placement from calculation\r\n    if (tagsGroup) {\r\n        tagsGroup.classList.toggle('mobile-general-field', fieldState.tagsInGeneral);\r\n        tagsGroup.classList.toggle('mobile-details-field', !fieldState.tagsInGeneral);\r\n    }\r\n\r\n    if (startDateGroup) {\r\n        startDateGroup.classList.toggle('mobile-general-field', fieldState.startDateInGeneral);\r\n        startDateGroup.classList.toggle('mobile-details-field', !fieldState.startDateInGeneral);\r\n    }\r\n\r\n    if (endDateGroup) {\r\n        endDateGroup.classList.toggle('mobile-general-field', fieldState.endDateInGeneral);\r\n        endDateGroup.classList.toggle('mobile-details-field', !fieldState.endDateInGeneral);\r\n    }\r\n\r\n    if (linksGroup) {\r\n        linksGroup.classList.toggle('mobile-general-field', fieldState.linksInGeneral);\r\n        linksGroup.classList.toggle('mobile-details-field', !fieldState.linksInGeneral);\r\n    }\r\n\r\n    // Update Details tab visibility using pure function\r\n    const detailsTab = modal.querySelector('.modal-tab[data-tab=\"details\"]');\r\n    const hideDetailsTab = shouldHideDetailsTab(fieldState);\r\n\r\n    console.log('\\u{1F504} Reorganizing fields:', {\r\n        ...fieldState,\r\n        hideDetailsTab\r\n    });\r\n\r\n    if (detailsTab) {\r\n        if (hideDetailsTab) {\r\n            console.log('\\u{2705} Hiding Details tab - Tags and Links both filled');\r\n            detailsTab.classList.add('hide-details-tab');\r\n        } else {\r\n            console.log('\uD83D\uDC41\uFE0F Showing Details tab - some dynamic fields empty');\r\n            detailsTab.classList.remove('hide-details-tab');\r\n        }\r\n    }\r\n}\r\n\r\n// Task navigation context for navigating between tasks in a project\r\nlet currentTaskNavigationContext = null;\r\n\r\nfunction openTaskDetails(taskId, navigationContext = null) {\r\n    const task = tasks.find((t) => t.id === taskId);\r\n    if (!task) return;\r\n\r\n    const modal = document.getElementById(\"task-modal\");\r\n    if (!modal) return;\r\n\r\n    // Store navigation context if provided\r\n    currentTaskNavigationContext = navigationContext;\r\n\r\n    // Reset tabs to General tab\r\n    const generalTab = modal.querySelector('.modal-tab[data-tab=\"general\"]');\r\n    const detailsTab = modal.querySelector('.modal-tab[data-tab=\"details\"]');\r\n    const historyTab = modal.querySelector('.modal-tab[data-tab=\"history\"]');\r\n    const generalContent = modal.querySelector('#task-details-tab');\r\n    const historyContent = modal.querySelector('#task-history-tab');\r\n\r\n    // Activate General tab (both desktop and mobile)\r\n    if (generalTab) generalTab.classList.add('active');\r\n    if (detailsTab) detailsTab.classList.remove('active');\r\n    if (historyTab) historyTab.classList.remove('active');\r\n    if (generalContent) generalContent.classList.add('active');\r\n    if (historyContent) historyContent.classList.remove('active');\r\n\r\n    // Remove mobile tab state\r\n    document.body.classList.remove('mobile-tab-details-active');\r\n\r\n    // Show History tab for editing existing tasks\r\n    if (historyTab) historyTab.style.display = '';\r\n\r\n    const modalContent = modal.querySelector('.modal-content');\r\n    if (modalContent) {\r\n        modalContent.style.minHeight = '';\r\n        modalContent.style.maxHeight = '';\r\n    }\r\n\r\n    // Title\r\n    const titleEl = modal.querySelector(\"h2\");\r\n    if (titleEl) titleEl.textContent = \"Edit Task\";\r\n\r\n    // Show \u274C and \u22EF in edit mode\r\n    const closeBtn = modal.querySelector(\".modal-close\");\r\n    if (closeBtn) closeBtn.style.display = \"inline-block\";\r\n    const optionsBtn = modal.querySelector(\"#task-options-btn\");\r\n    if (optionsBtn) optionsBtn.style.display = \"inline-block\";\r\n\r\n    // Hide footer with \"Create Task\"\r\n    const footer = modal.querySelector(\"#task-footer\");\r\n    if (footer) footer.style.display = \"none\";\r\n\r\n    // Project dropdown (custom dropdown)\r\n    populateProjectDropdownOptions();\r\n    const hiddenProject = modal.querySelector(\"#hidden-project\");\r\n    const projectCurrentBtn = modal.querySelector(\"#project-current\");\r\n    if (hiddenProject && projectCurrentBtn) {\r\n        hiddenProject.value = task.projectId || \"\";\r\n        const projectTextSpan = projectCurrentBtn.querySelector(\".project-text\");\r\n        if (projectTextSpan) {\r\n            if (task.projectId) {\r\n                const project = projects.find(p => p.id === task.projectId);\r\n                if (project) {\r\n                    const colorSquare = `<span style=\"display: inline-block; width: 10px; height: 10px; background-color: ${getProjectColor(project.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;\"></span>`;\r\n                    projectTextSpan.innerHTML = colorSquare + escapeHtml(project.name);\r\n                } else {\r\n                    projectTextSpan.textContent = t('tasks.project.selectPlaceholder');\r\n                }\r\n            } else {\r\n                projectTextSpan.textContent = t('tasks.project.selectPlaceholder');\r\n            }\r\n        }\r\n        updateTaskProjectOpenBtn(task.projectId || \"\");\r\n    }\r\n\r\n    // Title/description\r\n    const titleInput = modal.querySelector('#task-form input[name=\"title\"]');\r\n    if (titleInput) titleInput.value = task.title || \"\";\r\n\r\n    const descEditor = modal.querySelector(\"#task-description-editor\");\r\n    // Note: innerHTML used intentionally for rich text editing with contenteditable\r\n    // Task descriptions support HTML formatting (bold, lists, links, etc.)\r\n    if (descEditor) descEditor.innerHTML = task.description || \"\";\r\n    const descHidden = modal.querySelector(\"#task-description-hidden\");\r\n    if (descHidden) descHidden.value = task.description || \"\";\r\n\r\n    // Priority\r\n    const hiddenPriority = modal.querySelector(\"#hidden-priority\");\r\n    if (hiddenPriority) hiddenPriority.value = task.priority || \"medium\";\r\n    const priorityCurrentBtn = modal.querySelector(\"#priority-current\");\r\n    if (priorityCurrentBtn) {\r\n        const priority = task.priority || \"medium\";\r\n        const priorityLabel = getPriorityLabel(priority).toUpperCase();\r\n        priorityCurrentBtn.innerHTML = `<span class=\"priority-pill priority-${priority}\">${priorityLabel}</span> <span class=\"dropdown-arrow\">\u25BC</span>`;\r\n        updatePriorityOptions(priority);\r\n    }\r\n\r\n    // Status\r\n    const hiddenStatus = modal.querySelector(\"#hidden-status\");\r\n    if (hiddenStatus) hiddenStatus.value = task.status || \"todo\";\r\n  const currentBtn = modal.querySelector(\"#status-current\");\r\n  if (currentBtn) {\r\n    const statusBadge = currentBtn.querySelector(\".status-badge\");\r\n    if (statusBadge) {\r\n      statusBadge.className = \"status-badge \" + (task.status || \"todo\");\r\n      statusBadge.textContent = getStatusLabel(task.status || \"todo\");\r\n    }\r\n    updateStatusOptions(task.status || \"todo\");\r\n  }\r\n\r\n    // Prepare date values from task\r\n    let startIso = \"\";\r\n    if (typeof task.startDate === \"string\") {\r\n        if (looksLikeISO(task.startDate)) startIso = task.startDate;\r\n        else if (looksLikeDMY(task.startDate)) startIso = toISOFromDMY(task.startDate);\r\n    }\r\n\r\n    let endIso = \"\";\r\n    if (typeof task.endDate === \"string\") {\r\n        if (looksLikeISO(task.endDate)) endIso = task.endDate;\r\n        else if (looksLikeDMY(task.endDate)) endIso = toISOFromDMY(task.endDate);\r\n    }\r\n\r\n    // Get input references\r\n    const startInput = modal.querySelector('#task-form input[name=\"startDate\"]');\r\n    const endInput = modal.querySelector('#task-form input[name=\"endDate\"]');\r\n\r\n    // Check if flatpickr is already initialized (to avoid flicker when navigating)\r\n    // Flatpickr is attached to the display input, not the hidden input\r\n    const startWrapper = startInput ? startInput.parentElement : null;\r\n    const endWrapper = endInput ? endInput.parentElement : null;\r\n    const startDisplayInput = startWrapper && startWrapper.classList.contains('date-input-wrapper')\r\n        ? startWrapper.querySelector('input.date-display') : null;\r\n    const endDisplayInput = endWrapper && endWrapper.classList.contains('date-input-wrapper')\r\n        ? endWrapper.querySelector('input.date-display') : null;\r\n\r\n    const startDateAlreadyWrapped = startDisplayInput && startDisplayInput._flatpickr;\r\n    const endDateAlreadyWrapped = endDisplayInput && endDisplayInput._flatpickr;\r\n\r\n    // If flatpickr is already initialized, just update the values (no flicker)\r\n    if (startDateAlreadyWrapped && endDateAlreadyWrapped) {\r\n        // Update values directly through flatpickr API (attached to display inputs)\r\n        if (startDisplayInput && startDisplayInput._flatpickr) {\r\n            // Set hidden input value first (critical for validation)\r\n            startInput.value = startIso || '';\r\n            if (startIso) {\r\n                startDisplayInput._flatpickr.setDate(new Date(startIso), false);\r\n            } else {\r\n                startDisplayInput._flatpickr.clear();\r\n            }\r\n        }\r\n        if (endDisplayInput && endDisplayInput._flatpickr) {\r\n            // Set hidden input value first (critical for validation)\r\n            endInput.value = endIso || '';\r\n            if (endIso) {\r\n                endDisplayInput._flatpickr.setDate(new Date(endIso), false);\r\n            } else {\r\n                endDisplayInput._flatpickr.clear();\r\n            }\r\n        }\r\n    } else {\r\n        // First time opening or flatpickr not initialized - do full reset\r\n        const dateInputs = modal.querySelectorAll('input[name=\"startDate\"], input[name=\"endDate\"]');\r\n        dateInputs.forEach(input => {\r\n            if (input._flatpickrInstance) {\r\n                input._flatpickrInstance.destroy();\r\n                input._flatpickrInstance = null;\r\n            }\r\n            input._wrapped = false;\r\n\r\n            // Remove wrapper if it exists\r\n            const wrapper = input.closest('.date-input-wrapper');\r\n            if (wrapper) {\r\n                const parent = wrapper.parentNode;\r\n                parent.insertBefore(input, wrapper);\r\n                wrapper.remove();\r\n            }\r\n\r\n            // Restore to type=\"date\"\r\n            input.type = \"date\";\r\n            input.style.display = \"\";\r\n        });\r\n    }\r\n\r\n    // Editing ID\r\n    const form = modal.querySelector(\"#task-form\");\r\n    if (form) form.dataset.editingTaskId = String(taskId);\r\n\r\n    renderAttachments(task.attachments || []);\r\n    renderTags(task.tags || []);\r\n\r\n    // MOBILE: Dynamic field organization - move filled Details fields to General\r\n    // Only applies when editing existing task (not creating new)\r\n    if (getIsMobileCached() && taskId) {\r\n        const hasTags = Array.isArray(task.tags) && task.tags.length > 0;\r\n        const hasStartDate = typeof task.startDate === 'string' && task.startDate.trim() !== '';\r\n        const hasEndDate = typeof task.endDate === 'string' && task.endDate.trim() !== '';\r\n        const hasLinks = Array.isArray(task.attachments) && task.attachments.some(att =>\r\n            att.type === 'link' || (att.url && att.type !== 'file')\r\n        );\r\n\r\n        // Store initial date state - dates stay in General if they were ever set (even if cleared later)\r\n        // NOTE: Don't use property-existence because we add empty fields during migration.\r\n        const startDateWasEverSet = !!task.startDateWasEverSet || hasStartDate;\r\n        const endDateWasEverSet = !!task.endDateWasEverSet || hasEndDate;\r\n        modal.dataset.initialStartDate = startDateWasEverSet ? 'true' : 'false';\r\n        modal.dataset.initialEndDate = endDateWasEverSet ? 'true' : 'false';\r\n\r\n        // Get form groups for Details fields (using parent traversal instead of :has())\r\n        const tagInput = modal.querySelector('#tag-input');\r\n        const tagsGroup = tagInput ? tagInput.closest('.form-group') : null;\r\n\r\n        const startDateInputs = modal.querySelectorAll('input[name=\"startDate\"]');\r\n        let startDateGroup = null;\r\n        for (const input of startDateInputs) {\r\n            const group = input.closest('.form-group');\r\n            if (group && group.classList.contains('mobile-details-field')) {\r\n                startDateGroup = group;\r\n                break;\r\n            }\r\n        }\r\n\r\n        const endDateInputs = modal.querySelectorAll('input[name=\"endDate\"]');\r\n        let endDateGroup = null;\r\n        for (const input of endDateInputs) {\r\n            const group = input.closest('.form-group');\r\n            if (group && group.classList.contains('mobile-details-field')) {\r\n                endDateGroup = group;\r\n                break;\r\n            }\r\n        }\r\n\r\n        const linksList = modal.querySelector('#attachments-links-list');\r\n        const linksGroup = linksList ? linksList.closest('.form-group') : null;\r\n\r\n        // Move filled fields to General, keep empty in Details\r\n        if (tagsGroup) {\r\n            if (hasTags) {\r\n                tagsGroup.classList.remove('mobile-details-field');\r\n                tagsGroup.classList.add('mobile-general-field');\r\n            } else {\r\n                tagsGroup.classList.remove('mobile-general-field');\r\n                tagsGroup.classList.add('mobile-details-field');\r\n            }\r\n        }\r\n\r\n        if (startDateGroup) {\r\n            if (startDateWasEverSet) {\r\n                startDateGroup.classList.remove('mobile-details-field');\r\n                startDateGroup.classList.add('mobile-general-field');\r\n            } else {\r\n                startDateGroup.classList.remove('mobile-general-field');\r\n                startDateGroup.classList.add('mobile-details-field');\r\n            }\r\n        }\r\n\r\n        if (endDateGroup) {\r\n            if (endDateWasEverSet) {\r\n                endDateGroup.classList.remove('mobile-details-field');\r\n                endDateGroup.classList.add('mobile-general-field');\r\n            } else {\r\n                endDateGroup.classList.remove('mobile-general-field');\r\n                endDateGroup.classList.add('mobile-details-field');\r\n            }\r\n        }\r\n\r\n        if (linksGroup) {\r\n            if (hasLinks) {\r\n                linksGroup.classList.remove('mobile-details-field');\r\n                linksGroup.classList.add('mobile-general-field');\r\n            } else {\r\n                linksGroup.classList.remove('mobile-general-field');\r\n                linksGroup.classList.add('mobile-details-field');\r\n            }\r\n        }\r\n\r\n        // Hide Details tab only if Tags AND Links are filled (dates don't matter, they stay in General)\r\n        const allDetailsFilled = hasTags && hasLinks;\r\n        console.log('\\u{1F50D} Details Tab Logic:', {\r\n            hasTags,\r\n            hasStartDate,\r\n            hasEndDate,\r\n            hasLinks,\r\n            allDetailsFilled,\r\n            tags: task.tags,\r\n            startDate: task.startDate,\r\n            endDate: task.endDate,\r\n            attachments: task.attachments\r\n        });\r\n        if (detailsTab) {\r\n            if (allDetailsFilled) {\r\n                console.log('\\u{2705} Hiding Details tab - all fields filled');\r\n                detailsTab.classList.add('hide-details-tab');\r\n            } else {\r\n                console.log('\uD83D\uDC41\uFE0F Showing Details tab - some fields empty');\r\n                detailsTab.classList.remove('hide-details-tab');\r\n            }\r\n        }\r\n    }\r\n\r\n    // CRITICAL: Make modal visible FIRST (mobile browsers require visible inputs to accept values)\r\n    modal.classList.add(\"active\");\r\n\r\n    // Update navigation buttons based on context\r\n    updateTaskNavigationButtons();\r\n\r\n    // Use setTimeout to ensure modal is rendered and visible before setting date values\r\n    setTimeout(() => {\r\n        // Only do full initialization if not already wrapped (reduces flicker)\r\n        if (!startDateAlreadyWrapped || !endDateAlreadyWrapped) {\r\n            // Set values BEFORE wrapping (now that modal is visible)\r\n            if (startInput) startInput.value = startIso || \"\";\r\n            if (endInput) endInput.value = endIso || \"\";\r\n\r\n            // Initialize date pickers (creates wrappers)\r\n            initializeDatePickers();\r\n        }\r\n\r\n        // ALWAYS update display values after wrapping (critical for both first load and navigation)\r\n        if (startInput) {\r\n            const wrapper = startInput.parentElement;\r\n            if (wrapper && wrapper.classList.contains('date-input-wrapper')) {\r\n                const displayInput = wrapper.querySelector('input.date-display');\r\n                if (displayInput) {\r\n                    // Set hidden input value (critical for validation)\r\n                    startInput.value = startIso || '';\r\n\r\n                    // Update flatpickr instance (attached to display input)\r\n                    if (displayInput._flatpickr) {\r\n                        if (startIso) {\r\n                            displayInput._flatpickr.setDate(new Date(startIso), false);\r\n                        } else {\r\n                            displayInput._flatpickr.clear();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (endInput) {\r\n            const wrapper = endInput.parentElement;\r\n            if (wrapper && wrapper.classList.contains('date-input-wrapper')) {\r\n                const displayInput = wrapper.querySelector('input.date-display');\r\n                if (displayInput) {\r\n                    // Set hidden input value (critical for validation)\r\n                    endInput.value = endIso || '';\r\n\r\n                    // Update flatpickr instance (attached to display input)\r\n                    if (displayInput._flatpickr) {\r\n                        if (endIso) {\r\n                            displayInput._flatpickr.setDate(new Date(endIso), false);\r\n                        } else {\r\n                            displayInput._flatpickr.clear();\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }, 0);\r\n\r\n    // Add event listeners for real-time field reorganization\r\n    setTimeout(() => {\r\n        const dateInputsForListeners = modal.querySelectorAll('input[name=\"startDate\"], input[name=\"endDate\"]');\r\n        dateInputsForListeners.forEach(input => {\r\n            // Remove any existing listeners to prevent duplicates\r\n            input.removeEventListener('change', reorganizeMobileTaskFields);\r\n            // Add new listeners for the hidden input\r\n            input.addEventListener('change', reorganizeMobileTaskFields);\r\n        });\r\n    }, 50);\r\n\r\n    // Reset scroll position AFTER modal is active and rendered\r\n    setTimeout(() => {\r\n        const modalBody = modal.querySelector('.modal-body');\r\n        if (modalBody) modalBody.scrollTop = 0;\r\n    }, 0);\r\n}\r\n\r\n\r\nfunction deleteTask() {\r\n    const taskId = document.getElementById(\"task-form\").dataset.editingTaskId;\r\n    if (!taskId) return;\r\n\r\n    const task = tasks.find((t) => t.id === parseInt(taskId));\r\n    if (!task) return;\r\n\r\n    // Show custom confirmation modal\r\n    document.getElementById(\"confirm-modal\").classList.add(\"active\");\r\n    const confirmInput = document.getElementById(\"confirm-input\");\r\n    confirmInput.value = \"\";\r\n    confirmInput.focus();\r\n\r\n    // Auto-convert to lowercase as user types for better UX\r\n    const lowercaseHandler = function(e) {\r\n        const start = e.target.selectionStart;\r\n        const end = e.target.selectionEnd;\r\n        e.target.value = e.target.value.toLowerCase();\r\n        e.target.setSelectionRange(start, end);\r\n    };\r\n    confirmInput.addEventListener('input', lowercaseHandler);\r\n\r\n    // Add keyboard support for task delete modal\r\n    document.addEventListener('keydown', function(e) {\r\n        const confirmModal = document.getElementById('confirm-modal');\r\n        if (!confirmModal || !confirmModal.classList.contains('active')) return;\r\n        \r\n        if (e.key === 'Escape') {\r\n            e.preventDefault();\r\n            closeConfirmModal();\r\n        } else if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            confirmDelete();\r\n        }\r\n    });  \r\n}\r\n\r\n// Duplicate the currently open task in the task modal\r\nasync function duplicateTask() {\r\n    const form = document.getElementById(\"task-form\");\r\n    const editingTaskId = form?.dataset.editingTaskId;\r\n    if (!editingTaskId) return;\r\n\r\n    // Use task service to duplicate task\r\n    const result = duplicateTaskService(parseInt(editingTaskId, 10), tasks, taskCounter);\r\n    if (!result.task) return;\r\n\r\n    // Update global state\r\n    tasks = result.tasks;\r\n    taskCounter = result.taskCounter;\r\n    const cloned = result.task;\r\n\r\n    // Mark project as updated and record project history when a task is duplicated into a project\r\n    if (cloned && cloned.projectId) {\r\n        touchProjectUpdatedAt(cloned.projectId);\r\n        recordProjectTaskLinkChange(cloned.projectId, 'added', cloned);\r\n        saveProjects().catch(() => {});\r\n    }\r\n\r\n    // Close options menu to avoid overlaying issues\r\n    const menu = document.getElementById(\"options-menu\");\r\n    if (menu) menu.style.display = \"none\";\r\n\r\n    // Close the task modal immediately after duplicating\r\n    closeModal(\"task-modal\");\r\n\r\n    // Sync date filter option visibility\r\n    populateProjectOptions();\r\n    populateTagOptions();\r\n    updateNoDateOptionVisibility();\r\n\r\n    // Update UI immediately (optimistic update)\r\n    const inProjectDetails = document.getElementById(\"project-details\").classList.contains(\"active\");\r\n    if (inProjectDetails && cloned.projectId) {\r\n        showProjectDetails(cloned.projectId);\r\n    } else {\r\n        render();\r\n    }\r\n\r\n    // Refresh calendar if present\r\n    const calendarView = document.getElementById(\"calendar-view\");\r\n    if (calendarView) {\r\n        renderCalendar();\r\n    }\r\n\r\n    updateCounts();\r\n\r\n    // Save in background (don't block UI)\r\n    saveTasks().catch(err => {\r\n        console.error('Failed to save duplicated task:', err);\r\n        showErrorNotification(t('error.saveTaskFailed'));\r\n    });\r\n\r\n    // Optionally, open the duplicated task for quick edits\r\n    // openTaskDetails(cloned.id);\r\n}\r\n\r\nfunction closeConfirmModal() {\r\n    document.getElementById(\"confirm-modal\").classList.remove(\"active\");\r\n    document.getElementById(\"confirm-error\").classList.remove(\"show\");\r\n}\r\n\r\nfunction showStatusInfoModal() {\r\n    const modal = document.getElementById('status-info-modal');\r\n    if (modal) modal.classList.add('active');\r\n}\r\n\r\nasync function confirmDelete() {\r\n    const input = document.getElementById(\"confirm-input\");\r\n    const errorMsg = document.getElementById(\"confirm-error\");\r\n    const confirmText = input.value;\r\n\r\n    if (confirmText === \"delete\") {\r\n        const taskId = document.getElementById(\"task-form\").dataset.editingTaskId;\r\n\r\n        // Use task service to delete task\r\n        const result = deleteTaskService(parseInt(taskId, 10), tasks);\r\n        if (!result.task) return;\r\n\r\n        // Record history for task deletion\r\n        if (window.historyService) {\r\n            window.historyService.recordTaskDeleted(result.task);\r\n        }\r\n\r\n        const wasInProjectDetails = result.task && result.projectId &&\r\n            document.getElementById(\"project-details\").classList.contains(\"active\");\r\n        const projectId = result.projectId;\r\n\r\n        // Update global tasks array\r\n        tasks = result.tasks;\r\n\r\n        // Mark project as updated and record project history when task is removed from a project\r\n        if (projectId) {\r\n            touchProjectUpdatedAt(projectId);\r\n            recordProjectTaskLinkChange(projectId, 'removed', result.task);\r\n            saveProjects().catch(() => {});\r\n        }\r\n\r\n        // Close modals and update UI immediately (optimistic update)\r\n        closeConfirmModal();\r\n        closeModal(\"task-modal\");\r\n\r\n        // Keep filter dropdowns in sync with removed task data\r\n        populateProjectOptions();\r\n        populateTagOptions();\r\n        updateNoDateOptionVisibility();\r\n\r\n        // If we were viewing project details, refresh them immediately\r\n        if (wasInProjectDetails && projectId) {\r\n            showProjectDetails(projectId);\r\n        } else {\r\n            // Otherwise refresh the main views immediately\r\n            render();\r\n        }\r\n\r\n        // Always refresh calendar if it exists\r\n        const calendarView = document.getElementById(\"calendar-view\");\r\n        if (calendarView) {\r\n            renderCalendar();\r\n        }\r\n\r\n        updateCounts();\r\n\r\n        // Save in background (don't block UI)\r\n        saveTasks().catch(err => {\r\n            console.error('Failed to save task deletion:', err);\r\n            showErrorNotification(t('error.saveChangesFailed'));\r\n        });\r\n    } else {\r\n        errorMsg.classList.add('show');\r\n        input.focus();\r\n    }\r\n}\r\n\r\nfunction setupDragAndDrop() {\r\n    let draggedTaskIds = [];\r\n    let draggedFromStatus = null;\r\n    let isSingleDrag = true;\r\n    let dragPlaceholder = null;\r\n\r\n    // Auto-scroll while dragging when near edges\r\n    let autoScrollTimer = null;\r\n    const SCROLL_ZONE = 80;\r\n    const SCROLL_SPEED = 20;\r\n    \r\n    function getScrollableAncestor(el) {\r\n        let node = el;\r\n        while (node && node !== document.body) {\r\n            const style = getComputedStyle(node);\r\n            const overflowY = style.overflowY;\r\n            if ((overflowY === 'auto' || overflowY === 'scroll' || overflowY === 'overlay') && node.scrollHeight > node.clientHeight) {\r\n                return node;\r\n            }\r\n            node = node.parentElement;\r\n        }\r\n        return window;\r\n    }\r\n\r\n    function startAutoScroll(direction, container) {\r\n        stopAutoScroll();\r\n        autoScrollTimer = setInterval(() => {\r\n            try {\r\n                if (container === window) {\r\n                    window.scrollBy({ top: direction === 'down' ? SCROLL_SPEED : -SCROLL_SPEED, left: 0 });\r\n                } else {\r\n                    container.scrollTop += direction === 'down' ? SCROLL_SPEED : -SCROLL_SPEED;\r\n                }\r\n            } catch (err) {}\r\n        }, 50);\r\n    }\r\n\r\n    function stopAutoScroll() {\r\n        if (autoScrollTimer) {\r\n            clearInterval(autoScrollTimer);\r\n            autoScrollTimer = null;\r\n        }\r\n    }\r\n\r\n    const kanbanBoard = document.querySelector(\".kanban-board\");\r\n    if (!kanbanBoard) return;\r\n    if (kanbanBoard.dataset.dragDelegation === \"1\") return;\r\n    kanbanBoard.dataset.dragDelegation = \"1\";\r\n\r\n    const resolveStatusFromColumn = (column) => {\r\n        const tasksContainer = column?.querySelector('[id$=\"-tasks\"]');\r\n        const id = tasksContainer?.id || '';\r\n        return id ? id.replace('-tasks', '') : null;\r\n    };\r\n\r\n    kanbanBoard.addEventListener(\"dragstart\", (e) => {\r\n        const card = e.target.closest(\".task-card\");\r\n        if (!card || !kanbanBoard.contains(card)) return;\r\n\r\n        const taskId = parseInt(card.dataset.taskId, 10);\r\n        if (Number.isNaN(taskId)) return;\r\n        const taskObj = tasks.find(t => t.id === taskId);\r\n        draggedFromStatus = taskObj ? taskObj.status : null;\r\n\r\n        if (appState.selectedCards.has(taskId)) {\r\n            draggedTaskIds = Array.from(appState.selectedCards);\r\n        } else {\r\n            draggedTaskIds = [taskId];\r\n        }\r\n        isSingleDrag = draggedTaskIds.length === 1;\r\n\r\n        card.classList.add('dragging');\r\n        card.style.opacity = \"0.5\";\r\n\r\n        // Create placeholder with the SAME height as the dragged card\r\n        dragPlaceholder = document.createElement('div');\r\n        dragPlaceholder.className = 'drag-placeholder active';\r\n        dragPlaceholder.setAttribute('aria-hidden', 'true');\r\n        const cardHeight = card.offsetHeight;\r\n        dragPlaceholder.style.height = cardHeight + 'px';\r\n        dragPlaceholder.style.margin = '8px 0';\r\n        dragPlaceholder.style.opacity = '1';\r\n\r\n        document.querySelectorAll(\".kanban-column\").forEach((col) => {\r\n            col.style.backgroundColor = \"var(--bg-tertiary)\";\r\n            col.style.border = \"2px dashed var(--accent-blue)\";\r\n        });\r\n\r\n        e.dataTransfer.effectAllowed = 'move';\r\n        try { e.dataTransfer.setData('text/plain', String(taskId)); } catch (err) {}\r\n    });\r\n\r\n    kanbanBoard.addEventListener(\"dragend\", (e) => {\r\n        const card = e.target.closest(\".task-card\");\r\n        if (!card || !kanbanBoard.contains(card)) return;\r\n\r\n        card.classList.remove('dragging');\r\n        card.style.opacity = \"1\";\r\n        draggedTaskIds = [];\r\n        draggedFromStatus = null;\r\n        isSingleDrag = true;\r\n\r\n        // Remove placeholder\r\n        try {\r\n            if (dragPlaceholder && dragPlaceholder.parentNode) {\r\n                dragPlaceholder.parentNode.removeChild(dragPlaceholder);\r\n            }\r\n        } catch (err) {}\r\n        dragPlaceholder = null;\r\n\r\n        document.querySelectorAll(\".kanban-column\").forEach((col) => {\r\n            col.style.backgroundColor = \"\";\r\n            col.style.border = \"\";\r\n            col.classList.remove('drag-over');\r\n        });\r\n\r\n        document.querySelectorAll(\".task-card\").forEach((c) => {\r\n            c.classList.remove('drag-over-top', 'drag-over-bottom');\r\n        });\r\n        stopAutoScroll();\r\n    });\r\n\r\n    // \uD83D\uDD25 CLICK HANDLER - This is where selection happens\r\n    kanbanBoard.addEventListener(\"click\", (e) => {\r\n        const card = e.target.closest(\".task-card\");\r\n        if (!card || !kanbanBoard.contains(card)) return;\r\n        const taskId = parseInt(card.dataset.taskId, 10);\r\n\r\n        if (isNaN(taskId)) return;\r\n\r\n        const isToggleClick = e.ctrlKey || e.metaKey;\r\n        const isRangeClick = e.shiftKey;\r\n\r\n        if (isRangeClick) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            const column = card.closest('.kanban-column');\r\n            const scope = column || document;\r\n            const cardsInScope = Array.from(scope.querySelectorAll('.task-card'));\r\n            let anchorCard = null;\r\n\r\n            if (Number.isInteger(appState.lastSelectedCardId)) {\r\n                anchorCard = cardsInScope.find((c) => parseInt(c.dataset.taskId, 10) === appState.lastSelectedCardId);\r\n            }\r\n            if (!anchorCard) {\r\n                anchorCard = cardsInScope.find((c) => appState.selectedCards.has(parseInt(c.dataset.taskId, 10))) || card;\r\n            }\r\n\r\n            const startIndex = cardsInScope.indexOf(anchorCard);\r\n            const endIndex = cardsInScope.indexOf(card);\r\n\r\n            if (!isToggleClick) {\r\n                clearSelectedCards();\r\n            }\r\n\r\n            if (startIndex === -1 || endIndex === -1) {\r\n                card.classList.add('selected');\r\n                appState.selectedCards.add(taskId);\r\n                appState.lastSelectedCardId = taskId;\r\n                return;\r\n            }\r\n\r\n            const from = Math.min(startIndex, endIndex);\r\n            const to = Math.max(startIndex, endIndex);\r\n            for (let i = from; i <= to; i++) {\r\n                const rangeCard = cardsInScope[i];\r\n                const rangeId = parseInt(rangeCard.dataset.taskId, 10);\r\n                if (isNaN(rangeId)) continue;\r\n                rangeCard.classList.add('selected');\r\n                appState.selectedCards.add(rangeId);\r\n            }\r\n\r\n            appState.lastSelectedCardId = taskId;\r\n            return;\r\n        }\r\n\r\n        if (isToggleClick) {\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            card.classList.toggle('selected');\r\n\r\n            if (card.classList.contains('selected')) {\r\n                appState.selectedCards.add(taskId);\r\n            } else {\r\n                appState.selectedCards.delete(taskId);\r\n            }\r\n\r\n            appState.lastSelectedCardId = taskId;\r\n            return;\r\n        }\r\n\r\n        // Normal click opens task details\r\n        openTaskDetails(taskId);\r\n    });\r\n\r\n    const columns = document.querySelectorAll(\".kanban-column\");\r\n\r\n    columns.forEach((column) => {\r\n        column.addEventListener(\"dragover\", (e) => {\r\n            e.preventDefault();\r\n            column.classList.add('drag-over');\r\n            column.style.backgroundColor = \"var(--hover-bg)\";\r\n            \r\n            if (!dragPlaceholder) return;\r\n            \r\n            // \u2B50 KEY FIX: Get the actual tasks container, not the column wrapper\r\n            const tasksContainer = column.querySelector('[id$=\"-tasks\"]');\r\n            if (!tasksContainer) return;\r\n            const newStatus = resolveStatusFromColumn(column);\r\n            if (!newStatus) return;\r\n            \r\n            // Get all non-dragging cards in this container\r\n            const cards = Array.from(tasksContainer.querySelectorAll('.task-card:not(.dragging)'));\r\n            const mouseY = e.clientY;\r\n            \r\n            // Remove placeholder from current position\r\n            if (dragPlaceholder.parentNode) {\r\n                dragPlaceholder.remove();\r\n            }\r\n            \r\n            if (cards.length === 0) {\r\n                // Empty column - append to tasks container\r\n                tasksContainer.appendChild(dragPlaceholder);\r\n            } else {\r\n                // Find where to insert based on mouse position\r\n                let insertBeforeCard = null;\r\n                \r\n                for (const card of cards) {\r\n                    const rect = card.getBoundingClientRect();\r\n                    const cardMiddle = rect.top + (rect.height / 2);\r\n                    \r\n                    if (mouseY < cardMiddle) {\r\n                        insertBeforeCard = card;\r\n                        break;\r\n                    }\r\n                }\r\n                \r\n                if (insertBeforeCard) {\r\n                    tasksContainer.insertBefore(dragPlaceholder, insertBeforeCard);\r\n                } else {\r\n                    // Mouse is below all cards\r\n                    tasksContainer.appendChild(dragPlaceholder);\r\n                }\r\n            }\r\n\r\n            // Auto-scroll logic\r\n            try {\r\n                const scrollContainer = getScrollableAncestor(column);\r\n                const y = e.clientY;\r\n                const topDist = y;\r\n                const bottomDist = window.innerHeight - y;\r\n                if (topDist < SCROLL_ZONE) startAutoScroll('up', scrollContainer);\r\n                else if (bottomDist < SCROLL_ZONE) startAutoScroll('down', scrollContainer);\r\n                else stopAutoScroll();\r\n            } catch (err) { stopAutoScroll(); }\r\n        });\r\n\r\n        column.addEventListener(\"dragleave\", (e) => {\r\n            if (!column.contains(e.relatedTarget)) {\r\n                column.classList.remove('drag-over');\r\n                column.style.backgroundColor = \"var(--bg-tertiary)\";\r\n            }\r\n        });\r\n\r\n        column.addEventListener(\"drop\", async (e) => {\r\n            e.preventDefault();\r\n            column.classList.remove('drag-over');\r\n            column.style.backgroundColor = \"var(--bg-tertiary)\";\r\n\r\n            if (draggedTaskIds.length === 0) return;\r\n\r\n            const newStatus = resolveStatusFromColumn(column);\r\n            if (!newStatus) return;\r\n            \r\n            // \u2B50 KEY FIX: Use the tasks container to get accurate position\r\n            const tasksContainer = column.querySelector('[id$=\"-tasks\"]');\r\n            if (!tasksContainer) return;\r\n\r\n            // Single-card drag: treat as reorder (enable manual mode)\r\n            if (isSingleDrag) {\r\n                // Ensure manual sorting mode is initialized from priority ordering when needed\r\n                if (sortMode !== 'manual') {\r\n                    sortMode = 'manual';\r\n                    ['backlog','todo','progress','review','done'].forEach(st => {\r\n                        // Using imported PRIORITY_ORDER\r\n                        manualTaskOrder[st] = tasks\r\n                            .filter(t => t.status === st)\r\n                            .slice()\r\n                            .sort((a,b) => (PRIORITY_ORDER[b.priority]||0) - (PRIORITY_ORDER[a.priority]||0))\r\n                            .map(t => t.id);\r\n                    });\r\n                    updateSortUI();\r\n                    saveSortPreferences();\r\n                }\r\n\r\n                // Remove dragged ids from any existing manual orders to avoid duplicates\r\n                Object.keys(manualTaskOrder).forEach(st => {\r\n                    if (!Array.isArray(manualTaskOrder[st])) return;\r\n                    manualTaskOrder[st] = manualTaskOrder[st].filter(id => !draggedTaskIds.includes(id));\r\n                });\r\n\r\n                // Build the canonical ordered list of IDs for the destination column (excluding dragged cards)\r\n                // Using imported PRIORITY_ORDER\r\n                const currentColumnTasks = tasks.filter(t => t.status === newStatus && !draggedTaskIds.includes(t.id));\r\n\r\n                let orderedIds;\r\n                if (Array.isArray(manualTaskOrder[newStatus]) && manualTaskOrder[newStatus].length) {\r\n                    const presentIds = new Set(currentColumnTasks.map(t => t.id));\r\n                    orderedIds = manualTaskOrder[newStatus].filter(id => presentIds.has(id));\r\n\r\n                    const missing = currentColumnTasks\r\n                        .filter(t => !orderedIds.includes(t.id))\r\n                        .slice()\r\n                        .sort((a,b) => (PRIORITY_ORDER[b.priority]||0) - (PRIORITY_ORDER[a.priority]||0))\r\n                        .map(t => t.id);\r\n                    orderedIds = orderedIds.concat(missing);\r\n                } else {\r\n                    orderedIds = currentColumnTasks\r\n                        .slice()\r\n                        .sort((a,b) => (PRIORITY_ORDER[b.priority]||0) - (PRIORITY_ORDER[a.priority]||0))\r\n                        .map(t => t.id);\r\n                }\r\n\r\n                // \u2B50 CRITICAL FIX: Find insertion position based on placeholder location in DOM\r\n                let insertIndex = orderedIds.length; // Default: append at end\r\n\r\n                if (dragPlaceholder && dragPlaceholder.parentNode === tasksContainer) {\r\n                    // Get all cards currently in the DOM (in visual order)\r\n                    const cardsInDOM = Array.from(tasksContainer.querySelectorAll('.task-card:not(.dragging)'));\r\n                    \r\n                    // Find where the placeholder is in relation to visible cards\r\n                    let placeholderIndex = -1;\r\n                    const children = Array.from(tasksContainer.children);\r\n                    \r\n                    for (let i = 0; i < children.length; i++) {\r\n                        if (children[i] === dragPlaceholder) {\r\n                            placeholderIndex = i;\r\n                            break;\r\n                        }\r\n                    }\r\n                    \r\n                    if (placeholderIndex !== -1) {\r\n                        // Count how many cards are BEFORE the placeholder\r\n                        let cardsBefore = 0;\r\n                        for (let i = 0; i < placeholderIndex; i++) {\r\n                            if (children[i].classList && children[i].classList.contains('task-card')) {\r\n                                cardsBefore++;\r\n                            }\r\n                        }\r\n                        \r\n                        // The insertion index should be at this position\r\n                        insertIndex = cardsBefore;\r\n                    }\r\n                }\r\n\r\n                // Insert the dragged card at the calculated position\r\n                orderedIds.splice(insertIndex, 0, ...draggedTaskIds);\r\n                manualTaskOrder[newStatus] = orderedIds;\r\n\r\n                draggedTaskIds.forEach(id => {\r\n                    const t = tasks.find(x => x.id === id);\r\n                    if (t) {\r\n                        const statusChanged = t.status !== newStatus;\r\n                        if (statusChanged) {\r\n                            // Store old state for history\r\n                            const oldTaskCopy = JSON.parse(JSON.stringify(t));\r\n\r\n                            t.status = newStatus;\r\n                            t.updatedAt = new Date().toISOString();\r\n\r\n                            // Auto-set dates when status changes (if setting is enabled)\r\n                            if (settings.autoSetStartDateOnStatusChange || settings.autoSetEndDateOnStatusChange) {\r\n                                const today = new Date().toISOString().split('T')[0];\r\n                                if (settings.autoSetStartDateOnStatusChange && newStatus === 'progress' && !t.startDate) {\r\n                                    t.startDate = today;\r\n                                }\r\n                                if (settings.autoSetEndDateOnStatusChange && newStatus === 'done' && !t.endDate) {\r\n                                    t.endDate = today;\r\n                                }\r\n                            }\r\n\r\n                            // Set completedDate when marked as done\r\n                            if (newStatus === 'done' && !t.completedDate) {\r\n                                t.completedDate = new Date().toISOString();\r\n                            }\r\n\r\n                            // Record history for drag and drop changes\r\n                            if (window.historyService) {\r\n                                window.historyService.recordTaskUpdated(oldTaskCopy, t);\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n\r\n                saveSortPreferences();\r\n                clearSelectedCards();\r\n                render(); // Update UI immediately for instant drag feedback\r\n                const calendarView = document.getElementById(\"calendar-view\");\r\n                if (calendarView) renderCalendar();\r\n                try { if (dragPlaceholder && dragPlaceholder.parentNode) dragPlaceholder.parentNode.removeChild(dragPlaceholder); } catch (err) {}\r\n                dragPlaceholder = null;\r\n                stopAutoScroll();\r\n\r\n                // Save in background after UI updates\r\n                saveTasks().catch(error => {\r\n                    console.error('Failed to save drag-and-drop changes:', error);\r\n                    showErrorNotification(t('error.saveTaskPositionFailed'));\r\n                });\r\n            } else {\r\n                // Multi-drag - same fix applies\r\n                if (sortMode !== 'manual') {\r\n                    sortMode = 'manual';\r\n                    ['backlog','todo','progress','review','done'].forEach(st => {\r\n                        // Using imported PRIORITY_ORDER\r\n                        manualTaskOrder[st] = tasks\r\n                            .filter(t => t.status === st)\r\n                            .slice()\r\n                            .sort((a,b) => (PRIORITY_ORDER[b.priority]||0) - (PRIORITY_ORDER[a.priority]||0))\r\n                            .map(t => t.id);\r\n                    });\r\n                    updateSortUI();\r\n                    saveSortPreferences();\r\n                }\r\n\r\n                Object.keys(manualTaskOrder).forEach(st => {\r\n                    if (!Array.isArray(manualTaskOrder[st])) return;\r\n                    manualTaskOrder[st] = manualTaskOrder[st].filter(id => !draggedTaskIds.includes(id));\r\n                });\r\n\r\n                // Using imported PRIORITY_ORDER\r\n                const currentColumnTasks = tasks.filter(t => t.status === newStatus && !draggedTaskIds.includes(t.id));\r\n\r\n                let orderedIds;\r\n                if (Array.isArray(manualTaskOrder[newStatus]) && manualTaskOrder[newStatus].length) {\r\n                    const presentIds = new Set(currentColumnTasks.map(t => t.id));\r\n                    orderedIds = manualTaskOrder[newStatus].filter(id => presentIds.has(id));\r\n\r\n                    const missing = currentColumnTasks\r\n                        .filter(t => !orderedIds.includes(t.id))\r\n                        .slice()\r\n                        .sort((a,b) => (PRIORITY_ORDER[b.priority]||0) - (PRIORITY_ORDER[a.priority]||0))\r\n                        .map(t => t.id);\r\n                    orderedIds = orderedIds.concat(missing);\r\n                } else {\r\n                    orderedIds = currentColumnTasks\r\n                        .slice()\r\n                        .sort((a,b) => (PRIORITY_ORDER[b.priority]||0) - (PRIORITY_ORDER[a.priority]||0))\r\n                        .map(t => t.id);\r\n                }\r\n\r\n                // \u2B50 SAME FIX for multi-drag\r\n                let insertIndex = orderedIds.length;\r\n\r\n                if (dragPlaceholder && dragPlaceholder.parentNode === tasksContainer) {\r\n                    const children = Array.from(tasksContainer.children);\r\n                    let placeholderIndex = children.indexOf(dragPlaceholder);\r\n                    \r\n                    if (placeholderIndex !== -1) {\r\n                        let cardsBefore = 0;\r\n                        for (let i = 0; i < placeholderIndex; i++) {\r\n                            if (children[i].classList && children[i].classList.contains('task-card')) {\r\n                                cardsBefore++;\r\n                            }\r\n                        }\r\n                        insertIndex = cardsBefore;\r\n                    }\r\n                }\r\n\r\n                orderedIds.splice(insertIndex, 0, ...draggedTaskIds);\r\n                manualTaskOrder[newStatus] = orderedIds;\r\n\r\n                draggedTaskIds.forEach(id => {\r\n                    const t = tasks.find(x => x.id === id);\r\n                    if (t) {\r\n                        const statusChanged = t.status !== newStatus;\r\n                        if (statusChanged) {\r\n                            // Store old state for history\r\n                            const oldTaskCopy = JSON.parse(JSON.stringify(t));\r\n\r\n                            t.status = newStatus;\r\n                            t.updatedAt = new Date().toISOString();\r\n\r\n                            // Auto-set dates when status changes (if setting is enabled)\r\n                            if (settings.autoSetStartDateOnStatusChange || settings.autoSetEndDateOnStatusChange) {\r\n                                const today = new Date().toISOString().split('T')[0];\r\n                                if (settings.autoSetStartDateOnStatusChange && newStatus === 'progress' && !t.startDate) {\r\n                                    t.startDate = today;\r\n                                }\r\n                                if (settings.autoSetEndDateOnStatusChange && newStatus === 'done' && !t.endDate) {\r\n                                    t.endDate = today;\r\n                                }\r\n                            }\r\n\r\n                            // Set completedDate when marked as done\r\n                            if (newStatus === 'done' && !t.completedDate) {\r\n                                t.completedDate = new Date().toISOString();\r\n                            }\r\n\r\n                            // Record history for drag and drop changes\r\n                            if (window.historyService) {\r\n                                window.historyService.recordTaskUpdated(oldTaskCopy, t);\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n\r\n                saveSortPreferences();\r\n                clearSelectedCards();\r\n                render(); // Update UI immediately for instant drag feedback\r\n                const calendarView = document.getElementById(\"calendar-view\");\r\n                if (calendarView) renderCalendar();\r\n                try { if (dragPlaceholder && dragPlaceholder.parentNode) dragPlaceholder.parentNode.removeChild(dragPlaceholder); } catch (err) {}\r\n                dragPlaceholder = null;\r\n                stopAutoScroll();\r\n\r\n                // Save in background after UI updates\r\n                saveTasks().catch(error => {\r\n                    console.error('Failed to save drag-and-drop changes:', error);\r\n                    showErrorNotification(t('error.saveTaskPositionFailed'));\r\n                });\r\n            }\r\n        });\r\n    });\r\n\r\n    document.addEventListener('dragend', () => stopAutoScroll());\r\n}\r\n\r\n\r\nfunction openProjectModal() {\r\n    const modal = document.getElementById(\"project-modal\");\r\n\r\n    // Clear temp project tags for new project\r\n    window.tempProjectTags = [];\r\n    renderProjectTags([]);\r\n\r\n    // Clear editingProjectId since this is a new project\r\n    document.getElementById('project-form').dataset.editingProjectId = '';\r\n\r\n    // CRITICAL: Make modal visible FIRST (mobile browsers require visible inputs to accept values)\r\n    modal.classList.add(\"active\");\r\n\r\n    // Use setTimeout to ensure modal is rendered and visible before setting date values\r\n    setTimeout(() => {\r\n        // Clear start date (allow user to optionally set it)\r\n        document.querySelector('#project-form input[name=\"startDate\"]').value = '';\r\n\r\n        // Clear any existing flatpickr instances first\r\n        const dateInputs = document.querySelectorAll('#project-modal input[type=\"date\"]');\r\n        dateInputs.forEach(input => {\r\n            if (input._flatpickrInstance) {\r\n                input._flatpickrInstance.destroy();\r\n                input._flatpickrInstance = null;\r\n                input._wrapped = false;\r\n            }\r\n        });\r\n\r\n        // Initialize date pickers AFTER modal is visible and values are set\r\n        initializeDatePickers();\r\n    }, 150);\r\n\r\n    // Reset scroll position AFTER modal is active and rendered\r\n    setTimeout(() => {\r\n        const modalBody = modal.querySelector('.modal-body');\r\n        if (modalBody) modalBody.scrollTop = 0;\r\n    }, 0);\r\n}\r\n\r\n// Task navigation functions\r\nfunction updateTaskNavigationButtons() {\r\n    const prevBtn = document.getElementById('task-nav-prev');\r\n    const nextBtn = document.getElementById('task-nav-next');\r\n\r\n    if (!prevBtn || !nextBtn) return;\r\n\r\n    if (!currentTaskNavigationContext) {\r\n        // No navigation context - hide buttons\r\n        prevBtn.style.display = 'none';\r\n        nextBtn.style.display = 'none';\r\n        return;\r\n    }\r\n\r\n    const { taskIds, currentIndex } = currentTaskNavigationContext;\r\n\r\n    // Show buttons\r\n    prevBtn.style.display = 'flex';\r\n    nextBtn.style.display = 'flex';\r\n\r\n    // Enable/disable based on position\r\n    prevBtn.disabled = currentIndex <= 0;\r\n    nextBtn.disabled = currentIndex >= taskIds.length - 1;\r\n}\r\n\r\nfunction navigateToTask(direction) {\r\n    if (!currentTaskNavigationContext) return;\r\n\r\n    const { taskIds, currentIndex, projectId } = currentTaskNavigationContext;\r\n    const newIndex = direction === 'next' ? currentIndex + 1 : currentIndex - 1;\r\n\r\n    if (newIndex < 0 || newIndex >= taskIds.length) return;\r\n\r\n    const newTaskId = taskIds[newIndex];\r\n\r\n    // Create new navigation context with updated index\r\n    const newContext = {\r\n        projectId,\r\n        taskIds,\r\n        currentIndex: newIndex\r\n    };\r\n\r\n    // Open task with new context\r\n    openTaskDetails(newTaskId, newContext);\r\n}\r\n\r\nfunction navigateToPreviousTask() {\r\n    navigateToTask('prev');\r\n}\r\n\r\nfunction navigateToNextTask() {\r\n    navigateToTask('next');\r\n}\r\n\r\n// Initialize task navigation event listeners (once)\r\nif (!window.taskNavigationInitialized) {\r\n    window.taskNavigationInitialized = true;\r\n\r\n    document.addEventListener('DOMContentLoaded', () => {\r\n        const prevBtn = document.getElementById('task-nav-prev');\r\n        const nextBtn = document.getElementById('task-nav-next');\r\n\r\n        if (prevBtn) {\r\n            prevBtn.addEventListener('click', (e) => {\r\n                e.stopPropagation();\r\n                navigateToPreviousTask();\r\n            });\r\n        }\r\n\r\n        if (nextBtn) {\r\n            nextBtn.addEventListener('click', (e) => {\r\n                e.stopPropagation();\r\n                navigateToNextTask();\r\n            });\r\n        }\r\n\r\n        // Keyboard shortcuts for task navigation\r\n        document.addEventListener('keydown', (e) => {\r\n            // Only handle if task modal is active\r\n            const taskModal = document.getElementById('task-modal');\r\n            if (!taskModal || !taskModal.classList.contains('active')) return;\r\n\r\n            // Only handle if we have navigation context\r\n            if (!currentTaskNavigationContext) return;\r\n\r\n            // Ignore if user is typing in an input/textarea/contenteditable\r\n            const target = e.target;\r\n            if (target.tagName === 'INPUT' ||\r\n                target.tagName === 'TEXTAREA' ||\r\n                target.isContentEditable) {\r\n                return;\r\n            }\r\n\r\n            // Left arrow = previous task\r\n            if (e.key === 'ArrowLeft' && !e.ctrlKey && !e.metaKey && !e.shiftKey && !e.altKey) {\r\n                e.preventDefault();\r\n                navigateToPreviousTask();\r\n            }\r\n\r\n            // Right arrow = next task\r\n            if (e.key === 'ArrowRight' && !e.ctrlKey && !e.metaKey && !e.shiftKey && !e.altKey) {\r\n                e.preventDefault();\r\n                navigateToNextTask();\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction openTaskModal() {\r\n    const modal = document.getElementById(\"task-modal\");\r\n    if (!modal) return;\r\n\r\n    // Clear navigation context when opening new task modal\r\n    currentTaskNavigationContext = null;\r\n\r\n    // Reset tabs to General tab\r\n    const generalTab = modal.querySelector('.modal-tab[data-tab=\"general\"]');\r\n    const detailsTab = modal.querySelector('.modal-tab[data-tab=\"details\"]');\r\n    const historyTab = modal.querySelector('.modal-tab[data-tab=\"history\"]');\r\n    const generalContent = modal.querySelector('#task-details-tab');\r\n    const historyContent = modal.querySelector('#task-history-tab');\r\n\r\n    // Activate General tab (both desktop and mobile)\r\n    if (generalTab) generalTab.classList.add('active');\r\n    if (detailsTab) detailsTab.classList.remove('active');\r\n    if (historyTab) historyTab.classList.remove('active');\r\n    if (generalContent) generalContent.classList.add('active');\r\n    if (historyContent) historyContent.classList.remove('active');\r\n\r\n    // Remove mobile tab state\r\n    document.body.classList.remove('mobile-tab-details-active');\r\n\r\n    // Hide History tab for new tasks (no history yet)\r\n    if (historyTab) historyTab.style.display = 'none';\r\n\r\n    const modalContent = modal.querySelector('.modal-content');\r\n    if (modalContent) {\r\n        modalContent.style.minHeight = '';\r\n        modalContent.style.maxHeight = '';\r\n    }\r\n\r\n    // Re-initialize date pickers for task modal\r\n    setTimeout(() => {\r\n        // CRITICAL: Query by name, not type, since wrapped inputs become type=\"hidden\"\r\n        const dateInputs = modal.querySelectorAll('input[name=\"startDate\"], input[name=\"endDate\"]');\r\n        dateInputs.forEach(input => {\r\n            if (input._flatpickrInstance) {\r\n                input._flatpickrInstance.destroy();\r\n                input._flatpickrInstance = null;\r\n            }\r\n            input._wrapped = false;\r\n\r\n            // Remove wrapper if it exists\r\n            const wrapper = input.closest('.date-input-wrapper');\r\n            if (wrapper) {\r\n                const parent = wrapper.parentNode;\r\n                parent.insertBefore(input, wrapper);\r\n                wrapper.remove();\r\n            }\r\n\r\n            // Restore to type=\"date\"\r\n            input.type = \"date\";\r\n            input.style.display = \"\";\r\n        });\r\n        initializeDatePickers();\r\n    }, 150);\r\n\r\n    // Title\r\n    const titleEl = modal.querySelector(\"h2\");\r\n    if (titleEl) titleEl.textContent = \"Create New Task\";\r\n\r\n    // Hide \u274C and \u22EF in create mode\r\n    const closeBtn = modal.querySelector(\".modal-close\");\r\n    if (closeBtn) closeBtn.style.display = \"none\";\r\n\r\n    const optionsBtn = modal.querySelector(\"#task-options-btn\");\r\n    if (optionsBtn) optionsBtn.style.display = \"none\";\r\n\r\n    // Show footer with \"Create Task\"\r\n    const footer = modal.querySelector(\"#task-footer\");\r\n    if (footer) footer.style.display = \"flex\";\r\n\r\n    // DEBUG: Log modal dimensions\r\n    setTimeout(() => {\r\n        const modalContent = modal.querySelector('.modal-content');\r\n        const modalBody = modal.querySelector('.modal-body');\r\n        const modalFooter = modal.querySelector('.modal-footer');\r\n\r\n        if (modalContent && modalFooter) {\r\n            const contentRect = modalContent.getBoundingClientRect();\r\n            const footerRect = modalFooter.getBoundingClientRect();\r\n            const contentStyle = window.getComputedStyle(modalContent);\r\n            const footerStyle = window.getComputedStyle(modalFooter);\r\n\r\n            console.log('=== MODAL DEBUG ===');\r\n            console.log('Viewport:', window.innerWidth, 'x', window.innerHeight);\r\n            console.log('Zoom:', window.devicePixelRatio * 100 + '%');\r\n            console.log('');\r\n            console.log('MODAL-CONTENT:');\r\n            console.log('  Position:', contentRect.top.toFixed(1), 'to', contentRect.bottom.toFixed(1));\r\n            console.log('  Height:', contentRect.height.toFixed(1), '/', contentStyle.height, '/', contentStyle.maxHeight);\r\n            console.log('  Padding:', contentStyle.padding);\r\n            console.log('  Display:', contentStyle.display);\r\n            console.log('  Overflow:', contentStyle.overflow);\r\n            console.log('');\r\n            console.log('MODAL-FOOTER:');\r\n            console.log('  Position:', footerRect.top.toFixed(1), 'to', footerRect.bottom.toFixed(1));\r\n            console.log('  Height:', footerRect.height.toFixed(1));\r\n            console.log('  Flex-shrink:', footerStyle.flexShrink);\r\n            console.log('  Padding:', footerStyle.padding);\r\n            console.log('');\r\n            const overflow = footerRect.bottom - contentRect.bottom;\r\n            if (overflow > 1) {\r\n                console.error('\u274C FOOTER OVERFLOW:', overflow.toFixed(1) + 'px OUTSIDE modal-content');\r\n            } else {\r\n                console.log('\\u{2705} Footer is inside modal-content');\r\n            }\r\n            console.log('==================');\r\n        }\r\n    }, 100);\r\n\r\n    // Reset editing mode and clear fields\r\n    const form = modal.querySelector(\"#task-form\");\r\n    if (form) {\r\n        delete form.dataset.editingTaskId;\r\n        form.reset(); // This properly clears all form fields when opening\r\n    }\r\n\r\n    // Clear additional fields that might not be cleared by form.reset()\r\n    const descEditor = modal.querySelector(\"#task-description-editor\");\r\n    if (descEditor) descEditor.innerHTML = \"\";\r\n\r\n    const descHidden = modal.querySelector(\"#task-description-hidden\");\r\n    if (descHidden) descHidden.value = \"\";\r\n\r\n    // Reset custom Project field to default (no project)\r\n    const hiddenProject = modal.querySelector('#hidden-project');\r\n    if (hiddenProject) hiddenProject.value = \"\";\r\n    const projectCurrentBtn = modal.querySelector('#project-current .project-text');\r\n    if (projectCurrentBtn) projectCurrentBtn.textContent = t('tasks.project.selectPlaceholder');\r\n    updateTaskProjectOpenBtn('');\r\n    // Ensure floating portal is closed if it was open\r\n    if (typeof hideProjectDropdownPortal === 'function') hideProjectDropdownPortal();\r\n\r\n    // Reset priority\r\n    const hiddenPriority = modal.querySelector(\"#hidden-priority\");\r\n    if (hiddenPriority) hiddenPriority.value = \"medium\";\r\n    const priorityCurrentBtn = modal.querySelector(\"#priority-current\");\r\n    if (priorityCurrentBtn) {\r\n        const priorityLabel = getPriorityLabel(\"medium\").toUpperCase();\r\n        priorityCurrentBtn.innerHTML = `<span class=\"priority-pill priority-medium\">${priorityLabel}</span> <span class=\"dropdown-arrow\">\u25BC</span>`;\r\n        updatePriorityOptions(\"medium\");\r\n    }\r\n\r\n    // Reset status (default for new tasks). Kanban + column hidden \u2192 To Do; else Backlog (plan: backlog-ux-golden-standard)\r\n    const activeId = typeof getActivePageId === 'function' ? getActivePageId() : null;\r\n    const kanbanBoard = document.querySelector('.kanban-board');\r\n    const isKanban = kanbanBoard && !kanbanBoard.classList.contains('hidden');\r\n    const defaultStatus = (activeId === 'tasks' && isKanban && window.kanbanShowBacklog !== true) ? 'todo' : 'backlog';\r\n\r\n    const hiddenStatus = modal.querySelector(\"#hidden-status\");\r\n    if (hiddenStatus) hiddenStatus.value = defaultStatus;\r\n\r\n    const currentBtn = modal.querySelector(\"#status-current\");\r\n    if (currentBtn) {\r\n        const statusBadge = currentBtn.querySelector(\".status-badge\");\r\n        if (statusBadge) {\r\n            statusBadge.className = \"status-badge \" + defaultStatus;\r\n            statusBadge.textContent = getStatusLabel(defaultStatus);\r\n        }\r\n    }\r\n\r\n    // Clear attachments and tags\r\n    tempAttachments = [];\r\n    window.tempTags = [];\r\n    filterState.tags.clear();\r\n    renderAttachments([]);\r\n    renderTags([]);\r\n\r\n    // MOBILE: Reset field organization for new task - all Details fields should be in Details tab\r\n    if (getIsMobileCached()) {\r\n        // Clear initial date state for new tasks - dates start in Details\r\n        modal.dataset.initialStartDate = 'false';\r\n        modal.dataset.initialEndDate = 'false';\r\n\r\n        const tagsGroup = modal.querySelector('.form-group:has(#tag-input)');\r\n        const startDateGroup = modal.querySelector('.form-group:has([name=\"startDate\"])');\r\n        const endDateGroup = modal.querySelector('.form-group:has([name=\"endDate\"])');\r\n        const linksGroup = modal.querySelector('.form-group:has(#attachments-links-list)');\r\n\r\n        // Ensure all Details fields are in Details tab for new tasks\r\n        if (tagsGroup) {\r\n            tagsGroup.classList.remove('mobile-general-field');\r\n            tagsGroup.classList.add('mobile-details-field');\r\n        }\r\n        if (startDateGroup) {\r\n            startDateGroup.classList.remove('mobile-general-field');\r\n            startDateGroup.classList.add('mobile-details-field');\r\n        }\r\n        if (endDateGroup) {\r\n            endDateGroup.classList.remove('mobile-general-field');\r\n            endDateGroup.classList.add('mobile-details-field');\r\n        }\r\n        if (linksGroup) {\r\n            linksGroup.classList.remove('mobile-general-field');\r\n            linksGroup.classList.add('mobile-details-field');\r\n        }\r\n\r\n        // Show Details tab for new tasks\r\n        if (detailsTab) {\r\n            detailsTab.classList.remove('hide-details-tab');\r\n        }\r\n    }\r\n\r\n    // Explicitly clear date pickers to prevent dirty form state\r\n    const hiddenStart = modal.querySelector('#task-form input[name=\"startDate\"]');\r\n    if (hiddenStart) {\r\n        const fp = hiddenStart._flatpickrInstance;\r\n        if (fp) {\r\n            fp.clear();\r\n            fp.jumpToDate(new Date());\r\n        }\r\n        hiddenStart.value = \"\";\r\n        const displayStart = hiddenStart.parentElement\r\n            ? hiddenStart.parentElement.querySelector(\"input.date-display\")\r\n            : null;\r\n        if (displayStart) displayStart.value = \"\";\r\n    }\r\n\r\n    const hiddenEnd = modal.querySelector('#task-form input[name=\"endDate\"]');\r\n    if (hiddenEnd) {\r\n        const fp = hiddenEnd._flatpickrInstance;\r\n        if (fp) {\r\n            fp.clear();\r\n            fp.jumpToDate(new Date());\r\n        }\r\n        hiddenEnd.value = \"\";\r\n        const displayEnd = hiddenEnd.parentElement\r\n            ? hiddenEnd.parentElement.querySelector(\"input.date-display\")\r\n            : null;\r\n        if (displayEnd) displayEnd.value = \"\";\r\n    }\r\n\r\n    modal.classList.add(\"active\");\r\n\r\n    // Reset scroll position AFTER modal is active and rendered\r\n    setTimeout(() => {\r\n        const modalBody = modal.querySelector('.modal-body');\r\n        if (modalBody) modalBody.scrollTop = 0;\r\n    }, 0);\r\n\r\n    setTimeout(() => {\r\n        initializeDatePickers();\r\n        // Capture initial state after all defaults are set\r\n        captureInitialTaskFormState();\r\n    }, 100);\r\n\r\n}\r\n\r\n\r\n\r\nfunction closeModal(modalId) {\r\n    const modal = document.getElementById(modalId);\r\n    if (!modal) return;\r\n\r\n    // If closing settings modal and there are unsaved changes, show confirmation instead\r\n    if (modalId === 'settings-modal' && window.settingsFormIsDirty) {\r\n        showUnsavedChangesModal(modalId);\r\n        return;\r\n    }\r\n\r\n    // Call specific close functions for modals that need cleanup\r\n    if (modalId === 'import-data-modal') {\r\n        closeImportDataModal();\r\n        return;\r\n    }\r\n    if (modalId === 'delete-account-modal') {\r\n        closeDeleteAccountModal();\r\n        return;\r\n    }\r\n\r\n    modal.classList.remove(\"active\");\r\n\r\n    // Close any floating portals associated with Settings\r\n    if (modalId === 'settings-modal') {\r\n        if (typeof hideNotificationTimePortal === 'function') hideNotificationTimePortal();\r\n        if (typeof hideNotificationTimeZonePortal === 'function') hideNotificationTimeZonePortal();\r\n    }\r\n\r\n    // Clear any task-modal height pinning used for History tab stability\r\n    if (modalId === 'task-modal') {\r\n        try {\r\n            const content = modal.querySelector('.modal-content');\r\n            if (content) content.style.minHeight = '';\r\n        } catch (e) {}\r\n    }\r\n\r\n    // Only reset forms when manually closing (not after successful submission)\r\n    // This prevents clearing user input after task creation\r\n    if (modalId === \"project-modal\") {\r\n        document.getElementById(\"project-form\").reset();\r\n    }\r\n}\r\n\r\n// Separate function for manually closing task modal with reset\r\nfunction closeTaskModal() {\r\n    // If there are unsaved fields in NEW task, show confirmation instead\r\n    if (hasUnsavedNewTask && hasUnsavedNewTask()) {\r\n        showUnsavedChangesModal('task-modal');\r\n        return;\r\n    }\r\n\r\n    // For existing tasks, persist latest description (including checkboxes) before closing\r\n    const form = document.getElementById(\"task-form\");\r\n    if (form && form.dataset.editingTaskId) {\r\n        const descEditor = form.querySelector('#task-description-editor');\r\n        if (descEditor) {\r\n            updateTaskField('description', descEditor.innerHTML);\r\n        }\r\n    }\r\n\r\n    if (form) {\r\n        form.reset();\r\n        delete form.dataset.editingTaskId;\r\n\r\n        // Reset status dropdown to default (keep in sync with create-mode defaults)\r\n        const statusBadge = document.querySelector(\"#status-current .status-badge\");\r\n        if (statusBadge) {\r\n            statusBadge.className = \"status-badge backlog\";\r\n            statusBadge.textContent = getStatusLabel(\"backlog\");\r\n        }\r\n        const hiddenStatus = document.getElementById(\"hidden-status\");\r\n        if (hiddenStatus) hiddenStatus.value = \"backlog\";\r\n\r\n        // Reset priority dropdown to default\r\n        const priorityCurrentBtn = document.querySelector(\"#priority-current\");\r\n        if (priorityCurrentBtn) {\r\n            const priorityLabel = getPriorityLabel(\"medium\").toUpperCase();\r\n            priorityCurrentBtn.innerHTML = `<span class=\"priority-pill priority-medium\">${priorityLabel}</span> <span class=\"dropdown-arrow\">\u25BC</span>`;\r\n        }\r\n        const hiddenPriority = document.getElementById(\"hidden-priority\");\r\n        if (hiddenPriority) hiddenPriority.value = \"medium\";\r\n    }\r\n\r\n    // Clear initial state tracking\r\n    initialTaskFormState = null;\r\n\r\n    // Clear navigation context\r\n    currentTaskNavigationContext = null;\r\n\r\n    closeModal(\"task-modal\");\r\n}\r\n\r\ndocument\r\n    .getElementById(\"project-form\")\r\n    .addEventListener(\"submit\", function (e) {\r\n        e.preventDefault();\r\n        const submitTimer = debugTimeStart(\"projects\", \"submit\", {\r\n            projectCount: projects.length,\r\n            tagCount: (window.tempProjectTags || []).length\r\n        });\r\n        const formData = new FormData(e.target);\r\n\r\n        // Get tags from temp storage or empty array\r\n        const tags = window.tempProjectTags || [];\r\n\r\n        // Use project service to create project\r\n        const result = createProjectService({\r\n            name: formData.get(\"name\"),\r\n            description: formData.get(\"description\"),\r\n            startDate: formData.get(\"startDate\"),\r\n            endDate: formData.get(\"endDate\"),\r\n            tags: tags\r\n        }, projects, projectCounter);\r\n\r\n        projects = result.projects;\r\n        projectCounter = result.projectCounter;\r\n        const project = result.project;\r\n\r\n        // Record history for project creation\r\n        if (window.historyService) {\r\n            window.historyService.recordProjectCreated(project);\r\n        }\r\n\r\n        // Close modal and update UI immediately (optimistic update)\r\n        closeModal(\"project-modal\");\r\n        e.target.reset();\r\n\r\n        // Clear temp tags\r\n        window.tempProjectTags = [];\r\n\r\n        // Clear sorted view cache to force refresh with new project\r\n        appState.projectsSortedView = null;\r\n\r\n        // Navigate to projects page and show the new project immediately\r\n        window.location.hash = 'projects';\r\n        showPage('projects');\r\n        render(); // Refresh the projects list immediately\r\n\r\n        // Save in background (don't block UI)\r\n        saveProjects().catch(err => {\r\n            console.error('Failed to save project:', err);\r\n            showErrorNotification(t('error.saveProjectFailed'));\r\n        });\r\n        debugTimeEnd(\"projects\", submitTimer, {\r\n            projectCount: projects.length\r\n        });\r\n    });\r\n\r\n// Reset PIN handler\r\nfunction resetPINFlow() {\r\n    // Create a modal for PIN reset - ask for current PIN and new PIN\r\n    const resetPinModal = document.createElement('div');\r\n    resetPinModal.className = 'modal active';\r\n    resetPinModal.id = 'reset-pin-modal-temp';\r\n    resetPinModal.innerHTML = `\r\n        <div class=\"modal-content reset-pin-modal-content\">\r\n            <div class=\"reset-pin-modal-inner\">\r\n                <div class=\"reset-pin-header\">\r\n                    <div>\r\n                        <h2 class=\"reset-pin-title\">Reset PIN</h2>\r\n                        <p class=\"reset-pin-description\">Verify your current PIN to set a new one</p>\r\n                    </div>\r\n                </div>\r\n                \r\n                <form id=\"reset-pin-form\" class=\"reset-pin-form\">\r\n                    <div class=\"reset-pin-field\">\r\n                        <label class=\"reset-pin-label\">Current PIN</label>\r\n                        <input\r\n                            type=\"password\"\r\n                            id=\"current-pin-input\"\r\n                            maxlength=\"4\"\r\n                            placeholder=\"\u2022\u2022\u2022\u2022\"\r\n                            class=\"reset-pin-input\"\r\n                            inputmode=\"numeric\"\r\n                            autocomplete=\"off\"\r\n                            required\r\n                        />\r\n                        <div id=\"current-pin-error\" class=\"reset-pin-error\" style=\"display: none;\"></div>\r\n                    </div>\r\n\r\n                    <div class=\"reset-pin-actions\">\r\n                        <button type=\"button\" class=\"reset-pin-btn reset-pin-btn-cancel\" onclick=\"document.getElementById('reset-pin-modal-temp').remove()\">\r\n                            Cancel\r\n                        </button>\r\n                        <button type=\"submit\" class=\"reset-pin-btn reset-pin-btn-primary\">\r\n                            Continue\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    document.body.appendChild(resetPinModal);\r\n    \r\n    // Add form handler\r\n    document.getElementById('reset-pin-form').addEventListener('submit', function(e) {\r\n        e.preventDefault();\r\n        const currentPin = document.getElementById('current-pin-input').value.trim();\r\n        const errorEl = document.getElementById('current-pin-error');\r\n\r\n        // Clear previous errors\r\n        errorEl.style.display = 'none';\r\n        errorEl.textContent = '';\r\n\r\n        if (!currentPin || currentPin.length !== 4) {\r\n            errorEl.textContent = 'PIN must be 4 digits';\r\n            errorEl.style.display = 'block';\r\n            return;\r\n        }\r\n\r\n        if (!/^\\d{4}$/.test(currentPin)) {\r\n            errorEl.textContent = 'PIN must contain only digits';\r\n            errorEl.style.display = 'block';\r\n            return;\r\n        }\r\n\r\n        // Remove current modal and show new PIN entry\r\n        document.getElementById('reset-pin-modal-temp').remove();\r\n        showNewPinEntry(currentPin);\r\n    });\r\n    \r\n    document.getElementById('current-pin-input').focus();\r\n}\r\n\r\nfunction showNewPinEntry(currentPin) {\r\n    const newPinModal = document.createElement('div');\r\n    newPinModal.className = 'modal active';\r\n    newPinModal.id = 'new-pin-modal-temp';\r\n    newPinModal.innerHTML = `\r\n        <div class=\"modal-content reset-pin-modal-content\">\r\n            <div class=\"reset-pin-modal-inner\">\r\n                <div class=\"reset-pin-header\">\r\n                    <div>\r\n                        <h2 class=\"reset-pin-title\">Set New PIN</h2>\r\n                        <p class=\"reset-pin-description\">Create your new 4-digit PIN</p>\r\n                    </div>\r\n                </div>\r\n                \r\n                <form id=\"new-pin-form\" class=\"reset-pin-form\">\r\n                    <div class=\"reset-pin-field\">\r\n                        <label class=\"reset-pin-label\">New PIN</label>\r\n                        <input \r\n                            type=\"password\" \r\n                            id=\"new-pin-input\" \r\n                            maxlength=\"4\" \r\n                            placeholder=\"\u2022\u2022\u2022\u2022\"\r\n                            class=\"reset-pin-input\"\r\n                            inputmode=\"numeric\"\r\n                            autocomplete=\"off\"\r\n                            required\r\n                        />\r\n                    </div>\r\n                    \r\n                    <div class=\"reset-pin-field\">\r\n                        <label class=\"reset-pin-label\">Confirm PIN</label>\r\n                        <input\r\n                            type=\"password\"\r\n                            id=\"confirm-pin-input\"\r\n                            maxlength=\"4\"\r\n                            placeholder=\"\u2022\u2022\u2022\u2022\"\r\n                            class=\"reset-pin-input\"\r\n                            inputmode=\"numeric\"\r\n                            autocomplete=\"off\"\r\n                            required\r\n                        />\r\n                        <div id=\"new-pin-error\" class=\"reset-pin-error\" style=\"display: none;\"></div>\r\n                    </div>\r\n\r\n                    <div class=\"reset-pin-actions\">\r\n                        <button type=\"button\" class=\"reset-pin-btn reset-pin-btn-cancel\" onclick=\"document.getElementById('new-pin-modal-temp').remove()\">\r\n                            Cancel\r\n                        </button>\r\n                        <button type=\"submit\" class=\"reset-pin-btn reset-pin-btn-primary\">\r\n                            Reset PIN\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            </div>\r\n        </div>\r\n    `;\r\n    \r\n    document.body.appendChild(newPinModal);\r\n    \r\n    document.getElementById('new-pin-form').addEventListener('submit', function(e) {\r\n        e.preventDefault();\r\n        const newPin = document.getElementById('new-pin-input').value.trim();\r\n        const confirmPin = document.getElementById('confirm-pin-input').value.trim();\r\n        const errorEl = document.getElementById('new-pin-error');\r\n\r\n        // Clear previous errors\r\n        errorEl.style.display = 'none';\r\n        errorEl.textContent = '';\r\n\r\n        if (!newPin || newPin.length !== 4) {\r\n            errorEl.textContent = 'New PIN must be 4 digits';\r\n            errorEl.style.display = 'block';\r\n            return;\r\n        }\r\n\r\n        if (!/^\\d{4}$/.test(newPin)) {\r\n            errorEl.textContent = 'PIN must contain only digits';\r\n            errorEl.style.display = 'block';\r\n            return;\r\n        }\r\n\r\n        if (newPin !== confirmPin) {\r\n            errorEl.textContent = 'PINs do not match';\r\n            errorEl.style.display = 'block';\r\n            return;\r\n        }\r\n\r\n        // Call the API to reset the PIN\r\n        submitPINReset(currentPin, newPin);\r\n    });\r\n    \r\n    document.getElementById('new-pin-input').focus();\r\n}\r\n\r\nasync function submitPINReset(currentPin, newPin) {\r\n    try {\r\n        const token = localStorage.getItem('authToken');\r\n        if (!token) {\r\n            showErrorNotification(t('error.notLoggedInResetPin'));\r\n            return;\r\n        }\r\n        \r\n        const response = await fetch('/api/auth/change-pin', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token}`\r\n            },\r\n            body: JSON.stringify({\r\n                currentPin: currentPin,\r\n                newPin: newPin\r\n            })\r\n        });\r\n        \r\n        const data = await response.json();\r\n        \r\n        if (!response.ok) {\r\n            showErrorNotification(data.error || t('error.resetPinFailed'));\r\n            return;\r\n        }\r\n        \r\n        // Remove modal\r\n        const modal = document.getElementById('new-pin-modal-temp');\r\n        if (modal) modal.remove();\r\n        \r\n        showSuccessNotification(t('success.resetPin'));\r\n        \r\n        // Optional: redirect to login after a delay\r\n        setTimeout(() => {\r\n            window.location.hash = '';\r\n            location.reload();\r\n        }, 2000);\r\n        \r\n    } catch (error) {\r\n        console.error('PIN reset error:', error);\r\n        showErrorNotification(t('error.resetPinError'));\r\n    }\r\n}\r\n\r\n  document\r\n      .getElementById(\"settings-form\")\r\n      .addEventListener(\"submit\", async function (e) {\r\n        e.preventDefault();\r\n\r\n        // If nothing has changed, ignore submit\r\n        const saveBtn = this.querySelector('.settings-btn-save');\r\n        if (saveBtn && saveBtn.disabled && !window.settingsFormIsDirty) {\r\n            return;\r\n        }\r\n        \r\n        // Save display name to KV-backed user record (persists across sign-out)\r\n        const newName = document.getElementById('user-name').value.trim();\r\n        if (!newName) {\r\n            showErrorNotification(t('error.userNameEmpty'));\r\n            return; // prevent closing modal if name is empty\r\n        }\r\n\r\n        try {\r\n            const token = window.authSystem?.getAuthToken?.() || localStorage.getItem('authToken');\r\n            if (!token) throw new Error('Missing auth token');\r\n\r\n            const resp = await fetch('/api/auth/change-name', {\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/json',\r\n                    'Authorization': `Bearer ${token}`\r\n                },\r\n                body: JSON.stringify({ newName })\r\n            });\r\n\r\n            const data = await resp.json().catch(() => ({}));\r\n            if (!resp.ok) {\r\n                throw new Error(data.error || 'Failed to update display name');\r\n            }\r\n\r\n            // Update in-memory user + UI immediately\r\n            const currentUser = window.authSystem?.getCurrentUser?.();\r\n            if (currentUser) currentUser.name = data.name || newName;\r\n            updateUserDisplay(data.name || newName, window.authSystem?.getCurrentUser?.()?.avatarDataUrl);\r\n        } catch (err) {\r\n            console.error('Failed to save display name:', err);\r\n            showErrorNotification(t('error.saveDisplayNameFailed'));\r\n            return;\r\n        }\r\n\r\n        // Save email to KV-backed user record (authoritative for notification delivery)\r\n        const emailInput = document.getElementById('user-email');\r\n        const newEmail = String(emailInput?.value || '').trim().toLowerCase();\r\n        if (!newEmail || !isValidEmailAddress(newEmail)) {\r\n            showErrorNotification(t('error.invalidEmail'));\r\n            return;\r\n        }\r\n\r\n        try {\r\n            const currentUser = window.authSystem?.getCurrentUser?.();\r\n            const currentEmail = String(currentUser?.email || '').trim().toLowerCase();\r\n\r\n            if (newEmail && newEmail !== currentEmail) {\r\n                const token = window.authSystem?.getAuthToken?.() || localStorage.getItem('authToken');\r\n                if (!token) throw new Error('Missing auth token');\r\n\r\n                const resp = await fetch('/api/auth/change-email', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': `Bearer ${token}`\r\n                    },\r\n                    body: JSON.stringify({ newEmail })\r\n                });\r\n\r\n                const data = await resp.json().catch(() => ({}));\r\n                if (!resp.ok) {\r\n                    throw new Error(data.error || 'Failed to update email');\r\n                }\r\n\r\n                // Update in-memory user + UI immediately\r\n                if (currentUser) currentUser.email = data.email || newEmail;\r\n                document.querySelectorAll('.user-email').forEach(el => {\r\n                    if (el) el.textContent = data.email || newEmail;\r\n                });\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to save email:', err);\r\n            showErrorNotification(t('error.saveEmailFailed'));\r\n            return;\r\n        }\r\n\r\n        // Save avatar to KV-backed user record\r\n        try {\r\n            if (avatarDraft.hasPendingChange) {\r\n                const token = window.authSystem?.getAuthToken?.() || localStorage.getItem('authToken');\r\n                if (!token) throw new Error('Missing auth token');\r\n\r\n                const resp = await fetch('/api/auth/change-avatar', {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': `Bearer ${token}`\r\n                    },\r\n                    body: JSON.stringify({ avatarDataUrl: avatarDraft.dataUrl || null })\r\n                });\r\n\r\n                const data = await resp.json().catch(() => ({}));\r\n                if (!resp.ok) {\r\n                    throw new Error(data.error || 'Failed to update avatar');\r\n                }\r\n\r\n                const currentUser = window.authSystem?.getCurrentUser?.();\r\n                if (currentUser) currentUser.avatarDataUrl = data.avatarDataUrl || null;\r\n                applyUserAvatarToHeader();\r\n                refreshUserAvatarSettingsUI();\r\n\r\n                avatarDraft.hasPendingChange = false;\r\n                avatarDraft.dataUrl = null;\r\n            }\r\n        } catch (err) {\r\n            console.error('Failed to save avatar:', err);\r\n            showErrorNotification(t('error.saveAvatarFailed'));\r\n            return;\r\n        }\r\n\r\n        // Save application settings\r\n        const autoStartToggle = document.getElementById('auto-start-date-toggle');\r\n        const autoEndToggle = document.getElementById('auto-end-date-toggle');\r\n        const enableReviewStatusToggle = document.getElementById('enable-review-status-toggle');\r\n        const calendarIncludeBacklogToggle = document.getElementById('calendar-include-backlog-toggle');\r\n        const debugLogsToggle = document.getElementById('debug-logs-toggle');\r\n        const historySortOrderSelect = document.getElementById('history-sort-order');\r\n        const languageSelect = document.getElementById('language-select');\r\n\r\n        settings.autoSetStartDateOnStatusChange = !!autoStartToggle?.checked;\r\n        settings.autoSetEndDateOnStatusChange = !!autoEndToggle?.checked;\r\n        settings.debugLogsEnabled = !!debugLogsToggle?.checked;\r\n        applyDebugLogSetting(settings.debugLogsEnabled);\r\n\r\n        // Check if disabling IN REVIEW status with existing review tasks\r\n        const wasEnabled = window.enableReviewStatus;\r\n        const willBeEnabled = !!enableReviewStatusToggle?.checked;\r\n\r\n        if (wasEnabled && !willBeEnabled) {\r\n            // User is trying to disable IN REVIEW - check for existing review tasks\r\n            const reviewTasks = tasks.filter(t => t.status === 'review');\r\n\r\n            if (reviewTasks.length > 0) {\r\n                // Show custom modal with task list\r\n                const taskListContainer = document.getElementById('review-status-task-list');\r\n                const displayTasks = reviewTasks.slice(0, 5);\r\n                const hasMore = reviewTasks.length > 5;\r\n\r\n                const taskListHTML = `\r\n                    <div style=\"\r\n                        color: var(--text-primary);\r\n                        font-size: 14px;\r\n                        line-height: 1.6;\r\n                        margin-bottom: 16px;\r\n                        display: flex;\r\n                        align-items: center;\r\n                        gap: 8px;\r\n                        flex-wrap: wrap;\r\n                    \">\r\n                        <span style=\"color: var(--text-secondary);\">You have</span>\r\n                        <span style=\"\r\n                            color: var(--text-primary);\r\n                            font-weight: 600;\r\n                            font-size: 16px;\r\n                        \">${reviewTasks.length}</span>\r\n                        <span style=\"color: var(--text-secondary);\">${reviewTasks.length === 1 ? 'task' : 'tasks'} with</span>\r\n                        <span class=\"status-badge review\" style=\"\r\n                            display: inline-flex;\r\n                            align-items: center;\r\n                            padding: 4px 10px;\r\n                            border-radius: 6px;\r\n                            font-size: 11px;\r\n                            font-weight: 600;\r\n                            text-transform: uppercase;\r\n                            letter-spacing: 0.5px;\r\n                        \">IN REVIEW</span>\r\n                        <span style=\"color: var(--text-secondary);\">status</span>\r\n                    </div>\r\n                    <div style=\"margin: 20px 0;\">\r\n                        ${displayTasks.map(t => `\r\n                            <div style=\"\r\n                                display: flex;\r\n                                align-items: center;\r\n                                gap: 10px;\r\n                                padding: 8px 0;\r\n                                color: var(--text-primary);\r\n                                font-size: 14px;\r\n                            \">\r\n                                <svg width=\"18\" height=\"18\" viewBox=\"0 0 16 16\" fill=\"none\" style=\"flex-shrink: 0; color: var(--accent-green);\">\r\n                                    <rect x=\"2\" y=\"2\" width=\"12\" height=\"12\" rx=\"2\" stroke=\"currentColor\" stroke-width=\"1.5\" fill=\"none\"/>\r\n                                    <path d=\"M5 8L7 10L11 6\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                                </svg>\r\n                                <span style=\"flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">\r\n                                    ${escapeHtml(t.title)}\r\n                                </span>\r\n                            </div>\r\n                        `).join('')}\r\n                        ${hasMore ? `\r\n                            <div style=\"\r\n                                margin-top: 12px;\r\n                                padding-top: 12px;\r\n                                border-top: 1px solid var(--border-color);\r\n                            \">\r\n                                <button type=\"button\" style=\"\r\n                                    background: none;\r\n                                    border: none;\r\n                                    color: var(--accent-blue);\r\n                                    text-decoration: none;\r\n                                    font-size: 13px;\r\n                                    display: inline-flex;\r\n                                    align-items: center;\r\n                                    gap: 6px;\r\n                                    cursor: pointer;\r\n                                    padding: 0;\r\n                                    font-family: inherit;\r\n                                \" onclick=\"\r\n                                    const baseUrl = window.location.href.split('#')[0];\r\n                                    const url = baseUrl + '#tasks?status=review&view=list';\r\n                                    window.open(url, '_blank');\r\n                                \">\r\n                                    <span>View all ${reviewTasks.length} tasks in List view</span>\r\n                                    <svg width=\"14\" height=\"14\" viewBox=\"0 0 16 16\" fill=\"none\" style=\"flex-shrink: 0;\">\r\n                                        <path d=\"M6 4L10 8L6 12\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\r\n                                    </svg>\r\n                                </button>\r\n                            </div>\r\n                        ` : ''}\r\n                    </div>\r\n                    <div style=\"\r\n                        color: var(--text-primary);\r\n                        font-size: 14px;\r\n                        line-height: 1.6;\r\n                        margin-top: 20px;\r\n                        padding: 16px;\r\n                        background: var(--bg-tertiary);\r\n                        border-radius: 8px;\r\n                        border-left: 3px solid var(--accent-blue);\r\n                        display: flex;\r\n                        align-items: center;\r\n                        gap: 8px;\r\n                        flex-wrap: wrap;\r\n                    \">\r\n                        <svg width=\"18\" height=\"18\" viewBox=\"0 0 16 16\" fill=\"none\" style=\"flex-shrink: 0; color: var(--accent-blue);\">\r\n                            <path d=\"M8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2Z\" stroke=\"currentColor\" stroke-width=\"1.5\"/>\r\n                            <path d=\"M8 5V8L10 10\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\"/>\r\n                        </svg>\r\n                        <span style=\"color: var(--text-secondary);\">These tasks will be moved to</span>\r\n                        <span class=\"status-badge progress\" style=\"\r\n                            display: inline-flex;\r\n                            align-items: center;\r\n                            padding: 4px 10px;\r\n                            border-radius: 6px;\r\n                            font-size: 11px;\r\n                            font-weight: 600;\r\n                            text-transform: uppercase;\r\n                            letter-spacing: 0.5px;\r\n                        \">IN PROGRESS</span>\r\n                    </div>\r\n                `;\r\n                taskListContainer.innerHTML = taskListHTML;\r\n\r\n                // Store tasks to migrate and toggle reference for later\r\n                window.pendingReviewTaskMigration = reviewTasks;\r\n                window.pendingReviewStatusToggle = enableReviewStatusToggle;\r\n\r\n                // Show modal and exit early - will continue in confirmDisableReviewStatus\r\n                document.getElementById('review-status-confirm-modal').classList.add('active');\r\n                return;\r\n            }\r\n        }\r\n\r\n        settings.enableReviewStatus = willBeEnabled;\r\n        settings.calendarIncludeBacklog = !!calendarIncludeBacklogToggle?.checked;\r\n        settings.historySortOrder = historySortOrderSelect.value;\r\n        settings.language = normalizeLanguage(languageSelect?.value || 'en');\r\n\r\n        // Update global variable and localStorage\r\n        window.enableReviewStatus = settings.enableReviewStatus;\r\n        localStorage.setItem('enableReviewStatus', String(settings.enableReviewStatus));\r\n\r\n        // Apply review status visibility\r\n        applyReviewStatusVisibility();\r\n        applyLanguage();\r\n        \r\n          settings.notificationEmail = newEmail;\r\n\r\n          const emailNotificationsEnabledToggle = document.getElementById('email-notifications-enabled');\r\n          const emailNotificationsWeekdaysOnlyToggle = document.getElementById('email-notifications-weekdays-only');\r\n          const emailNotificationsIncludeStartDatesToggle = document.getElementById('email-notifications-include-start-dates');\r\n          const emailNotificationsIncludeBacklogToggle = document.getElementById('email-notifications-include-backlog');\r\n          const emailNotificationTimeInput = document.getElementById('email-notification-time');\r\n          const emailNotificationTimeZoneSelect = document.getElementById('email-notification-timezone');\r\n\r\n          settings.emailNotificationsEnabled = !!emailNotificationsEnabledToggle?.checked;\r\n          settings.emailNotificationsWeekdaysOnly = !!emailNotificationsWeekdaysOnlyToggle?.checked;\r\n          settings.emailNotificationsIncludeStartDates = !!emailNotificationsIncludeStartDatesToggle?.checked;\r\n          settings.emailNotificationsIncludeBacklog = !!emailNotificationsIncludeBacklogToggle?.checked;\r\n          const snappedTime = snapHHMMToStep(\r\n              normalizeHHMM(emailNotificationTimeInput?.value) || \"09:00\",\r\n              30\r\n          );\r\n          settings.emailNotificationTime =\r\n              clampHHMMToRange(snappedTime || \"09:00\", \"08:00\", \"18:00\") || \"09:00\";\r\n          settings.emailNotificationTimeZone = String(\r\n              emailNotificationTimeZoneSelect?.value || \"Atlantic/Canary\"\r\n          );\r\n\r\n          if (emailNotificationTimeInput) {\r\n              emailNotificationTimeInput.value = settings.emailNotificationTime;\r\n          }\r\n\r\n          if (workspaceLogoDraft.hasPendingChange) {\r\n              settings.customWorkspaceLogo = workspaceLogoDraft.dataUrl || null;\r\n          }\r\n  \r\n          saveSettings();\r\n          applyWorkspaceLogo();\r\n\r\n          // Refresh notification state to reflect new settings (e.g., backlog filter changes)\r\n          updateNotificationState({ force: true });\r\n\r\n          // Refresh calendar if it's currently active (to apply backlog filter changes)\r\n          const calendarView = document.getElementById('calendar-view');\r\n          if (calendarView && calendarView.classList.contains('active')) {\r\n              renderCalendar();\r\n          }\r\n\r\n          workspaceLogoDraft.hasPendingChange = false;\r\n          workspaceLogoDraft.dataUrl = null;\r\n\r\n          // Also update the display in the user menu\r\n          const userEmailEl = document.querySelector('.user-email');\r\n          if (userEmailEl) userEmailEl.textContent = newEmail;\r\n\r\n          showSuccessNotification(t('success.settingsSaved'));\r\n          // Mark form as clean and close\r\n          window.initialSettingsFormState = null;\r\n          window.settingsFormIsDirty = false;\r\n          if (saveBtn) {\r\n              saveBtn.classList.remove('dirty');\r\n              saveBtn.disabled = true;\r\n          }\r\n          closeModal('settings-modal');\r\n      });\r\n\r\n  function refreshUserAvatarSettingsUI() {\r\n      const preview = document.getElementById('user-avatar-preview');\r\n      const clearButton = document.getElementById('user-avatar-clear-btn');\r\n      const dropzone = document.getElementById('user-avatar-dropzone');\r\n      const row = preview?.closest?.('.user-avatar-input-row') || dropzone?.closest?.('.user-avatar-input-row') || null;\r\n\r\n      const currentUser = window.authSystem?.getCurrentUser?.();\r\n      const effectiveAvatar = avatarDraft.hasPendingChange\r\n          ? avatarDraft.dataUrl\r\n          : (currentUser?.avatarDataUrl || null);\r\n      const hasAvatar = !!effectiveAvatar;\r\n\r\n      if (preview && clearButton) {\r\n          if (effectiveAvatar) {\r\n              preview.style.display = 'block';\r\n              preview.style.backgroundImage = `url(${effectiveAvatar})`;\r\n              clearButton.style.display = 'inline-flex';\r\n          } else {\r\n              preview.style.display = 'none';\r\n              preview.style.backgroundImage = '';\r\n              clearButton.style.display = 'none';\r\n          }\r\n      }\r\n\r\n      if (dropzone) {\r\n          const uploadAria = t('settings.avatarUploadAriaUpload');\r\n          const changeAria = t('settings.avatarUploadAriaChange');\r\n          dropzone.setAttribute('aria-label', hasAvatar ? changeAria : uploadAria);\r\n\r\n          const textEl = dropzone.querySelector('.workspace-logo-dropzone-text');\r\n          if (textEl) {\r\n              const defaultText = dropzone.dataset.defaultText || t('settings.avatarUploadDefault');\r\n              const changeText = dropzone.dataset.changeText || t('settings.avatarUploadChange');\r\n              textEl.textContent = hasAvatar ? changeText : defaultText;\r\n          }\r\n\r\n          // Make the dropzone more compact once an avatar exists.\r\n          dropzone.style.minHeight = hasAvatar ? '40px' : '48px';\r\n          dropzone.style.padding = hasAvatar ? '10px 12px' : '12px 16px';\r\n      }\r\n\r\n      if (row) {\r\n          row.classList.toggle('has-avatar', hasAvatar);\r\n      }\r\n  }\r\n\r\n  function applyUserAvatarToHeader() {\r\n      const currentUser = window.authSystem?.getCurrentUser?.();\r\n      if (!currentUser) return;\r\n      updateUserDisplay(currentUser.name, currentUser.avatarDataUrl || null);\r\n  }\r\n\r\n  function setupWorkspaceLogoControls() {\r\n      const dropzone = document.getElementById('workspace-logo-dropzone');\r\n      const fileInput = document.getElementById('workspace-logo-input');\r\n      const clearButton = document.getElementById('workspace-logo-clear-btn');\r\n      const preview = document.getElementById('workspace-logo-preview');\r\n\r\n      if (!dropzone || !fileInput) return;\r\n\r\n      const defaultText = t('settings.logoUploadDefault');\r\n\r\n      dropzone.dataset.defaultText = defaultText;\r\n\r\n      function setDropzoneText(text) {\r\n          dropzone.innerHTML = '';\r\n          const textEl = document.createElement('span');\r\n          textEl.className = 'workspace-logo-dropzone-text';\r\n          textEl.textContent = text;\r\n          dropzone.appendChild(textEl);\r\n      }\r\n\r\n      function applyDropzoneBaseStyles(el) {\r\n          el.style.display = 'flex';\r\n          el.style.alignItems = 'center';\r\n          el.style.justifyContent = 'center';\r\n          el.style.gap = '10px';\r\n          el.style.padding = '12px 16px';\r\n          el.style.textAlign = 'center';\r\n          el.style.cursor = 'pointer';\r\n          el.style.userSelect = 'none';\r\n          el.style.minHeight = '48px';\r\n          el.style.border = '2px dashed var(--border)';\r\n          el.style.borderRadius = '10px';\r\n          el.style.background = 'var(--bg-tertiary)';\r\n          el.style.boxShadow = 'none';\r\n          el.style.color = 'var(--text-muted)';\r\n          el.style.fontWeight = '500';\r\n          el.style.transition = 'border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease';\r\n      }\r\n\r\n      function setDropzoneDragoverStyles(el, isActive) {\r\n          if (isActive) {\r\n              el.style.borderColor = 'var(--accent-blue)';\r\n              el.style.background = 'rgba(59, 130, 246, 0.08)';\r\n              el.style.boxShadow = '0 0 0 1px var(--accent-blue)';\r\n          } else {\r\n              el.style.border = '2px dashed var(--border)';\r\n              el.style.background = 'var(--bg-tertiary)';\r\n              el.style.boxShadow = 'none';\r\n          }\r\n      }\r\n\r\n      function refreshWorkspaceLogoUI() {\r\n          if (!preview || !clearButton) return;\r\n\r\n          const row = preview.closest('.workspace-logo-input-row') || dropzone?.closest?.('.workspace-logo-input-row') || null;\r\n          const effectiveLogo = workspaceLogoDraft.hasPendingChange\r\n              ? workspaceLogoDraft.dataUrl\r\n              : settings.customWorkspaceLogo;\r\n          const hasLogo = !!effectiveLogo;\r\n\r\n          if (effectiveLogo) {\r\n              preview.style.display = 'block';\r\n              preview.style.backgroundImage = `url(${effectiveLogo})`;\r\n              clearButton.style.display = 'inline-flex';\r\n          } else {\r\n              preview.style.display = 'none';\r\n              preview.style.backgroundImage = '';\r\n              clearButton.style.display = 'none';\r\n          }\r\n\r\n          if (dropzone) {\r\n              const uploadAria = t('settings.logoUploadAriaUpload');\r\n              const changeAria = t('settings.logoUploadAriaChange');\r\n              dropzone.setAttribute('aria-label', hasLogo ? changeAria : uploadAria);\r\n              const defaultText = dropzone.dataset.defaultText || t('settings.logoUploadDefault');\r\n              const changeText = dropzone.dataset.changeText || t('settings.logoUploadChange');\r\n              if (dropzone.getAttribute('aria-busy') !== 'true' && !dropzone.classList.contains('workspace-logo-uploading')) {\r\n                  setDropzoneText(hasLogo ? changeText : defaultText);\r\n              }\r\n\r\n              dropzone.style.minHeight = hasLogo ? '40px' : '48px';\r\n              dropzone.style.padding = hasLogo ? '10px 12px' : '12px 16px';\r\n          }\r\n\r\n          if (row) {\r\n              row.classList.toggle('has-logo', hasLogo);\r\n          }\r\n      }\r\n\r\n      async function handleWorkspaceLogoFile(file, event) {\r\n          if (!file) return;\r\n          if (event) {\r\n              event.preventDefault();\r\n              event.stopPropagation();\r\n          }\r\n\r\n          if (!file.type.startsWith('image/')) {\r\n              showErrorNotification(t('error.logoSelectFile'));\r\n              return;\r\n          }\r\n\r\n          const maxSizeBytes = 2048 * 1024; // 2MB limit for workspace logo\r\n          if (file.size > maxSizeBytes) {\r\n              showErrorNotification(t('error.logoTooLarge'));\r\n              return;\r\n          }\r\n\r\n          const defaultText = dropzone.dataset.defaultText || t('settings.logoUploadDefault');\r\n\r\n          try {\r\n              // Show uploading state\r\n              dropzone.innerHTML = '';\r\n              const textEl = document.createElement('span');\r\n              textEl.className = 'workspace-logo-dropzone-text';\r\n              textEl.textContent = `Uploading ${file.name}...`;\r\n              dropzone.appendChild(textEl);\r\n              dropzone.classList.add('workspace-logo-uploading');\r\n              dropzone.setAttribute('aria-busy', 'true');\r\n\r\n              const reader = new FileReader();\r\n              reader.onload = function (event) {\r\n                  const dataUrl = event.target && event.target.result;\r\n                  if (!dataUrl) {\r\n                      showErrorNotification(t('error.imageReadFailed'));\r\n                      setDropzoneText(defaultText);\r\n                      dropzone.classList.remove('workspace-logo-uploading');\r\n                      dropzone.removeAttribute('aria-busy');\r\n                      return;\r\n                  }\r\n\r\n                  const img = new Image();\r\n                  img.onload = function () {\r\n                      // Always open crop modal for user to adjust\r\n                      openCropModal(dataUrl, img);\r\n                      setDropzoneText(defaultText);\r\n                      dropzone.classList.remove('workspace-logo-uploading');\r\n                      dropzone.removeAttribute('aria-busy');\r\n                  };\r\n                  img.onerror = function () {\r\n                      showErrorNotification(t('error.imageLoadFailed'));\r\n                      setDropzoneText(defaultText);\r\n                      dropzone.classList.remove('workspace-logo-uploading');\r\n                      dropzone.removeAttribute('aria-busy');\r\n                  };\r\n                  img.src = dataUrl;\r\n              };\r\n              reader.onerror = function () {\r\n                  showErrorNotification(t('error.imageReadFailed'));\r\n                  setDropzoneText(defaultText);\r\n                  dropzone.classList.remove('workspace-logo-uploading');\r\n                  dropzone.removeAttribute('aria-busy');\r\n              };\r\n\r\n              reader.readAsDataURL(file);\r\n          } catch (error) {\r\n              showErrorNotification(t('error.logoUploadFailed', { message: error.message }));\r\n              setDropzoneText(defaultText);\r\n              dropzone.classList.remove('workspace-logo-uploading');\r\n              dropzone.removeAttribute('aria-busy');\r\n          }\r\n      }\r\n\r\n      // Initialize dropzone styles and text\r\n      applyDropzoneBaseStyles(dropzone);\r\n      setDropzoneText(defaultText);\r\n\r\n      // Initialize preview UI\r\n      refreshWorkspaceLogoUI();\r\n\r\n      let dragDepth = 0;\r\n\r\n      // Drag & Drop event handlers\r\n      dropzone.addEventListener('dragenter', function(e) {\r\n          e.preventDefault();\r\n          dragDepth += 1;\r\n          dropzone.classList.add('workspace-logo-dragover');\r\n          setDropzoneDragoverStyles(dropzone, true);\r\n      });\r\n\r\n      dropzone.addEventListener('dragover', function(e) {\r\n          e.preventDefault();\r\n          dropzone.classList.add('workspace-logo-dragover');\r\n          setDropzoneDragoverStyles(dropzone, true);\r\n      });\r\n\r\n      dropzone.addEventListener('dragleave', function(e) {\r\n          e.preventDefault();\r\n          dragDepth = Math.max(0, dragDepth - 1);\r\n          if (dragDepth === 0) {\r\n              dropzone.classList.remove('workspace-logo-dragover');\r\n              setDropzoneDragoverStyles(dropzone, false);\r\n          }\r\n      });\r\n\r\n      dropzone.addEventListener('drop', function(e) {\r\n          dragDepth = 0;\r\n          dropzone.classList.remove('workspace-logo-dragover');\r\n          setDropzoneDragoverStyles(dropzone, false);\r\n          const files = e.dataTransfer && e.dataTransfer.files;\r\n          if (files && files.length > 0) {\r\n              handleWorkspaceLogoFile(files[0], e);\r\n          }\r\n      });\r\n\r\n      dropzone.addEventListener('dragend', function() {\r\n          dragDepth = 0;\r\n          dropzone.classList.remove('workspace-logo-dragover');\r\n          setDropzoneDragoverStyles(dropzone, false);\r\n      });\r\n\r\n      // Paste support\r\n      dropzone.addEventListener('paste', function(e) {\r\n          if (!e.clipboardData) return;\r\n          const files = e.clipboardData.files;\r\n          if (files && files.length > 0) {\r\n              handleWorkspaceLogoFile(files[0], e);\r\n          }\r\n      });\r\n\r\n      // Click to upload\r\n      dropzone.addEventListener('click', function() {\r\n          fileInput.click();\r\n      });\r\n\r\n      // Keyboard accessibility\r\n      dropzone.addEventListener('keydown', function(e) {\r\n          if (e.key === 'Enter' || e.key === ' ') {\r\n              e.preventDefault();\r\n              fileInput.click();\r\n          }\r\n      });\r\n\r\n      // File input change handler\r\n      fileInput.addEventListener('change', function(e) {\r\n          const files = e.target.files;\r\n          if (files && files.length > 0) {\r\n              handleWorkspaceLogoFile(files[0], e);\r\n          }\r\n          fileInput.value = '';\r\n      });\r\n\r\n      // Clear button handler\r\n      if (clearButton) {\r\n          clearButton.addEventListener('click', function (e) {\r\n              e.preventDefault();\r\n              workspaceLogoDraft.hasPendingChange = true;\r\n              workspaceLogoDraft.dataUrl = null;\r\n              if (fileInput) {\r\n                  fileInput.value = '';\r\n              }\r\n              refreshWorkspaceLogoUI();\r\n              if (window.markSettingsDirtyIfNeeded) {\r\n                  window.markSettingsDirtyIfNeeded();\r\n              }\r\n          });\r\n      }\r\n\r\n      // Listen for refresh events from external code (like openSettingsModal)\r\n      document.addEventListener('refresh-workspace-logo-ui', () => {\r\n          refreshWorkspaceLogoUI();\r\n      });\r\n\r\n      // ============================================\r\n      // Workspace Logo Crop Modal Functions\r\n      // ============================================\r\n\r\n  function openCropModal(dataUrl, image, options = null) {\r\n      const modal = document.getElementById('workspace-logo-crop-modal');\r\n      const canvas = document.getElementById('crop-canvas');\r\n      const ctx = canvas.getContext('2d');\r\n      const titleEl = document.getElementById('crop-modal-title');\r\n      const instructionsEl = modal?.querySelector('.crop-instructions');\r\n\r\n      // Store state\r\n      cropState.originalImage = image;\r\n      cropState.originalDataUrl = dataUrl;\r\n      cropState.canvas = canvas;\r\n      cropState.ctx = ctx;\r\n      cropState.onApply = options?.onApply || null;\r\n      cropState.successMessage = options?.successMessage || null;\r\n      cropState.shape = options?.shape || 'square';\r\n      cropState.outputMimeType = options?.outputMimeType || 'image/jpeg';\r\n      cropState.outputMaxSize = typeof options?.outputMaxSize === 'number' ? options.outputMaxSize : null;\r\n\r\n      if (titleEl) titleEl.textContent = options?.title || 'Crop Image to Square';\r\n      if (instructionsEl && options?.instructions) instructionsEl.textContent = options.instructions;\r\n\r\n      // Add accessibility\r\n      modal.setAttribute('role', 'dialog');\r\n      modal.setAttribute('aria-modal', 'true');\r\n      modal.setAttribute('aria-labelledby', 'crop-modal-title');\r\n\r\n      // Show modal first so layout is measurable\r\n      modal.classList.add('active');\r\n\r\n      // Next frame: draw and position selection after layout settles\r\n      requestAnimationFrame(() => {\r\n          // Calculate canvas size (fit to container, maintain aspect ratio)\r\n          const containerMaxWidth = 600;\r\n          const containerMaxHeight = window.innerHeight * 0.6;\r\n\r\n          let displayWidth = image.width;\r\n          let displayHeight = image.height;\r\n\r\n          if (displayWidth > containerMaxWidth || displayHeight > containerMaxHeight) {\r\n              const scale = Math.min(\r\n                  containerMaxWidth / displayWidth,\r\n                  containerMaxHeight / displayHeight\r\n              );\r\n              displayWidth = Math.floor(displayWidth * scale);\r\n              displayHeight = Math.floor(displayHeight * scale);\r\n          }\r\n\r\n          canvas.width = displayWidth;\r\n          canvas.height = displayHeight;\r\n\r\n          // Draw image on canvas\r\n          ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n          ctx.drawImage(image, 0, 0, displayWidth, displayHeight);\r\n\r\n          // Initialize selection (centered square, 80% of smallest dimension)\r\n          const minDimension = Math.min(displayWidth, displayHeight);\r\n          const initialSize = Math.floor(minDimension * 0.8);\r\n\r\n          cropState.selection = {\r\n              x: Math.floor((displayWidth - initialSize) / 2),\r\n              y: Math.floor((displayHeight - initialSize) / 2),\r\n              size: initialSize\r\n          };\r\n\r\n          // Setup event listeners\r\n          setupCropEventListeners();\r\n\r\n          // Double RAF to ensure canvas layout is complete before positioning overlay\r\n          requestAnimationFrame(() => {\r\n              requestAnimationFrame(() => {\r\n                  updateCropSelection();\r\n              });\r\n          });\r\n      });\r\n  }\r\n\r\n  function closeCropModal() {\r\n      const modal = document.getElementById('workspace-logo-crop-modal');\r\n      modal.classList.remove('active');\r\n\r\n      // Cleanup event listeners\r\n      removeCropEventListeners();\r\n\r\n      // Reset state\r\n      cropState = {\r\n          originalImage: null,\r\n          originalDataUrl: null,\r\n          canvas: null,\r\n          ctx: null,\r\n          selection: { x: 0, y: 0, size: 0 },\r\n          isDragging: false,\r\n          isResizing: false,\r\n          dragStartX: 0,\r\n          dragStartY: 0,\r\n          activeHandle: null,\r\n          shape: 'square',\r\n          outputMimeType: 'image/jpeg',\r\n          outputMaxSize: null,\r\n          onApply: null,\r\n          successMessage: null\r\n      };\r\n  }\r\n\r\n  function updateCropSelection() {\r\n      const selection = document.getElementById('crop-selection');\r\n      const canvas = cropState.canvas;\r\n      if (!canvas || !selection) return;\r\n\r\n      selection.dataset.shape = cropState.shape || 'square';\r\n\r\n      const canvasRect = canvas.getBoundingClientRect();\r\n      const container = canvas.closest('.crop-canvas-container') || canvas.parentElement;\r\n      const containerRect = container ? container.getBoundingClientRect() : canvasRect;\r\n      const offsetX = canvasRect.left - containerRect.left;\r\n      const offsetY = canvasRect.top - containerRect.top;\r\n\r\n      // Use a uniform scale factor so the overlay matches what the user sees.\r\n      // (CSS keeps aspect ratio, but rounding can make X/Y slightly differ.)\r\n      const uniformScale = canvas.width / canvasRect.width;\r\n\r\n      // Position selection div (in screen pixels)\r\n      const displayX = cropState.selection.x / uniformScale;\r\n      const displayY = cropState.selection.y / uniformScale;\r\n      const displaySize = cropState.selection.size / uniformScale;\r\n\r\n      selection.style.left = `${offsetX + displayX}px`;\r\n      selection.style.top = `${offsetY + displayY}px`;\r\n      selection.style.width = `${displaySize}px`;\r\n      selection.style.height = `${displaySize}px`;\r\n\r\n      // Update info display\r\n      updateCropInfo();\r\n  }\r\n\r\n  function updateCropInfo() {\r\n      const dimensionsEl = document.getElementById('crop-dimensions');\r\n      const sizeEl = document.getElementById('crop-size-estimate');\r\n      if (!dimensionsEl || !sizeEl) return;\r\n\r\n      // Calculate actual pixel dimensions (in original image)\r\n      const canvas = cropState.canvas;\r\n      const image = cropState.originalImage;\r\n      if (!canvas || !image) return;\r\n\r\n      const selectionEl = document.getElementById('crop-selection');\r\n      const canvasRect = canvas.getBoundingClientRect();\r\n      const selectionRect = selectionEl?.getBoundingClientRect?.();\r\n\r\n      // Derive the output size from what the user actually sees (DOM rects),\r\n      // so the preview and saved crop match even if CSS rounding makes scales differ.\r\n      let actualSize = 0;\r\n      if (selectionRect && canvasRect.width > 0 && canvasRect.height > 0) {\r\n          const scaleX = image.width / canvasRect.width;\r\n          const scaleY = image.height / canvasRect.height;\r\n          const cropSizeX = selectionRect.width * scaleX;\r\n          const cropSizeY = selectionRect.height * scaleY;\r\n          actualSize = Math.max(1, Math.floor(Math.min(cropSizeX, cropSizeY)));\r\n      } else {\r\n          const scale = image.width / canvas.width;\r\n          actualSize = Math.max(1, Math.floor(cropState.selection.size * scale));\r\n      }\r\n\r\n      dimensionsEl.textContent = `${actualSize} \u00D7 ${actualSize} px`;\r\n\r\n      // Estimate file size (rough approximation: 3 bytes per pixel for JPEG)\r\n      const estimatedBytes = actualSize * actualSize * 3;\r\n      const estimatedKB = Math.floor(estimatedBytes / 1024);\r\n\r\n      sizeEl.textContent = `~${estimatedKB} KB`;\r\n\r\n      // Warning colors\r\n      const maxSizeKB = 2048; // 2MB limit\r\n      sizeEl.classList.remove('size-warning', 'size-error');\r\n\r\n      if (estimatedKB > maxSizeKB) {\r\n          sizeEl.classList.add('size-error');\r\n      } else if (estimatedKB > maxSizeKB * 0.8) {\r\n          sizeEl.classList.add('size-warning');\r\n      }\r\n  }\r\n\r\n  async function applyCrop() {\r\n      try {\r\n          const canvas = cropState.canvas;\r\n          const image = cropState.originalImage;\r\n          const selection = cropState.selection;\r\n\r\n          if (!canvas || !image) {\r\n              showErrorNotification(t('error.cropInvalid'));\r\n              return;\r\n          }\r\n\r\n          // Derive crop from the rendered selection rect (not just stored state),\r\n          // ensuring the saved output matches the on-screen selection exactly.\r\n          const canvasRect = canvas.getBoundingClientRect();\r\n          const selectionEl = document.getElementById('crop-selection');\r\n          const selectionRect = selectionEl?.getBoundingClientRect?.();\r\n\r\n          let cropX = 0;\r\n          let cropY = 0;\r\n          let cropSize = 0;\r\n\r\n          if (selectionRect && canvasRect.width > 0 && canvasRect.height > 0) {\r\n              const centerXRatio =\r\n                  (selectionRect.left + selectionRect.width / 2 - canvasRect.left) / canvasRect.width;\r\n              const centerYRatio =\r\n                  (selectionRect.top + selectionRect.height / 2 - canvasRect.top) / canvasRect.height;\r\n\r\n              const centerXOrig = centerXRatio * image.width;\r\n              const centerYOrig = centerYRatio * image.height;\r\n\r\n              const cropSizeX = selectionRect.width / canvasRect.width * image.width;\r\n              const cropSizeY = selectionRect.height / canvasRect.height * image.height;\r\n              cropSize = Math.max(1, Math.floor(Math.min(cropSizeX, cropSizeY)));\r\n\r\n              cropX = Math.floor(centerXOrig - cropSize / 2);\r\n              cropY = Math.floor(centerYOrig - cropSize / 2);\r\n          } else {\r\n              // Fallback: use stored state mapping\r\n              const scaleX = image.width / canvas.width;\r\n              const scaleY = image.height / canvas.height;\r\n              cropSize = Math.max(1, Math.floor(selection.size * Math.min(scaleX, scaleY)));\r\n              cropX = Math.floor(selection.x * scaleX);\r\n              cropY = Math.floor(selection.y * scaleY);\r\n          }\r\n\r\n          cropX = Math.max(0, Math.min(cropX, image.width - cropSize));\r\n          cropY = Math.max(0, Math.min(cropY, image.height - cropSize));\r\n\r\n          const maxSizeBytes = 2048 * 1024; // 2MB limit\r\n          const maxAttempts = 6;\r\n\r\n          const renderOutputDataUrl = (targetSize, quality) => {\r\n              const outCanvas = document.createElement('canvas');\r\n              outCanvas.width = targetSize;\r\n              outCanvas.height = targetSize;\r\n              const outCtx = outCanvas.getContext('2d');\r\n\r\n              if (!outCtx) {\r\n                  throw new Error('Canvas context unavailable');\r\n              }\r\n\r\n              const shape = cropState.shape || 'square';\r\n              if (shape === 'circle') {\r\n                  outCtx.clearRect(0, 0, targetSize, targetSize);\r\n                  outCtx.save();\r\n                  outCtx.beginPath();\r\n                  outCtx.arc(targetSize / 2, targetSize / 2, targetSize / 2, 0, Math.PI * 2);\r\n                  outCtx.closePath();\r\n                  outCtx.clip();\r\n              }\r\n\r\n              outCtx.drawImage(\r\n                  image,\r\n                  cropX, cropY, cropSize, cropSize,  // Source rectangle\r\n                  0, 0, targetSize, targetSize        // Destination rectangle\r\n              );\r\n\r\n              if (shape === 'circle') {\r\n                  outCtx.restore();\r\n              }\r\n\r\n              const mimeType = cropState.outputMimeType || (shape === 'circle' ? 'image/png' : 'image/jpeg');\r\n              if (mimeType === 'image/jpeg' || mimeType === 'image/webp') {\r\n                  return outCanvas.toDataURL(mimeType, quality);\r\n              }\r\n              return outCanvas.toDataURL(mimeType);\r\n          };\r\n\r\n          let targetSize = cropState.outputMaxSize ? Math.min(cropSize, cropState.outputMaxSize) : cropSize;\r\n          targetSize = Math.max(50, Math.floor(targetSize));\r\n\r\n          let attempts = 0;\r\n          let quality = 0.92;\r\n          let croppedDataUrl = renderOutputDataUrl(targetSize, quality);\r\n\r\n          while (croppedDataUrl.length > maxSizeBytes * 1.37 && attempts < maxAttempts) {\r\n              const shape = cropState.shape || 'square';\r\n              const mimeType = cropState.outputMimeType || (shape === 'circle' ? 'image/png' : 'image/jpeg');\r\n\r\n              if (mimeType === 'image/jpeg' || mimeType === 'image/webp') {\r\n                  quality = Math.max(0.5, quality - 0.1);\r\n              } else {\r\n                  targetSize = Math.floor(targetSize * 0.85);\r\n              }\r\n\r\n              croppedDataUrl = renderOutputDataUrl(targetSize, quality);\r\n              attempts++;\r\n          }\r\n\r\n          if (croppedDataUrl.length > maxSizeBytes * 1.37) {\r\n              showErrorNotification(t('error.cropTooLarge'));\r\n              return;\r\n          }\r\n\r\n          if (typeof cropState.onApply === 'function') {\r\n              cropState.onApply(croppedDataUrl);\r\n              if (window.markSettingsDirtyIfNeeded) {\r\n                  window.markSettingsDirtyIfNeeded();\r\n              }\r\n              closeCropModal();\r\n              showSuccessNotification(cropState.successMessage || t('success.cropApplied'));\r\n          } else {\r\n              // Back-compat: Update workspace logo draft\r\n              workspaceLogoDraft.hasPendingChange = true;\r\n              workspaceLogoDraft.dataUrl = croppedDataUrl;\r\n\r\n              // Refresh UI\r\n              refreshWorkspaceLogoUI();\r\n              if (window.markSettingsDirtyIfNeeded) {\r\n                  window.markSettingsDirtyIfNeeded();\r\n              }\r\n\r\n              // Close modal\r\n              closeCropModal();\r\n\r\n              // Success notification\r\n              showSuccessNotification(t('success.logoCroppedApplied'));\r\n          }\r\n\r\n      } catch (error) {\r\n          showErrorNotification(t('error.cropFailed', { message: error.message }));\r\n          console.error('Crop error:', error);\r\n      }\r\n  }\r\n\r\n  function setupUserAvatarControls() {\r\n      const dropzone = document.getElementById('user-avatar-dropzone');\r\n      const fileInput = document.getElementById('user-avatar-input');\r\n      const clearButton = document.getElementById('user-avatar-clear-btn');\r\n\r\n      if (!dropzone || !fileInput) return;\r\n\r\n      const defaultText = t('settings.avatarUploadDefault');\r\n\r\n      dropzone.dataset.defaultText = defaultText;\r\n      dropzone.dataset.changeText = t('settings.avatarUploadChange');\r\n\r\n      function setDropzoneText(text) {\r\n          dropzone.innerHTML = '';\r\n          const textEl = document.createElement('span');\r\n          textEl.className = 'workspace-logo-dropzone-text';\r\n          textEl.textContent = text;\r\n          dropzone.appendChild(textEl);\r\n      }\r\n\r\n      function applyDropzoneBaseStyles(el) {\r\n          el.style.display = 'flex';\r\n          el.style.alignItems = 'center';\r\n          el.style.justifyContent = 'center';\r\n          el.style.gap = '10px';\r\n          el.style.padding = '12px 16px';\r\n          el.style.textAlign = 'center';\r\n          el.style.cursor = 'pointer';\r\n          el.style.userSelect = 'none';\r\n          el.style.minHeight = '48px';\r\n          el.style.border = '2px dashed var(--border)';\r\n          el.style.borderRadius = '10px';\r\n          el.style.background = 'var(--bg-tertiary)';\r\n          el.style.boxShadow = 'none';\r\n          el.style.color = 'var(--text-muted)';\r\n          el.style.fontWeight = '500';\r\n          el.style.transition = 'border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease';\r\n      }\r\n\r\n      function setDropzoneDragoverStyles(el, isActive) {\r\n          if (isActive) {\r\n              el.style.borderColor = 'var(--accent-blue)';\r\n              el.style.background = 'rgba(59, 130, 246, 0.08)';\r\n              el.style.boxShadow = '0 0 0 1px var(--accent-blue)';\r\n          } else {\r\n              el.style.border = '2px dashed var(--border)';\r\n              el.style.background = 'var(--bg-tertiary)';\r\n              el.style.boxShadow = 'none';\r\n          }\r\n      }\r\n\r\n      async function handleAvatarFile(file, event) {\r\n          if (!file) return;\r\n          if (event) {\r\n              event.preventDefault();\r\n              event.stopPropagation();\r\n          }\r\n\r\n          if (!file.type.startsWith('image/')) {\r\n              showErrorNotification(t('error.avatarSelectFile'));\r\n              return;\r\n          }\r\n\r\n          const maxSizeBytes = 2048 * 1024; // 2MB limit for avatar\r\n          if (file.size > maxSizeBytes) {\r\n              showErrorNotification(t('error.avatarTooLarge'));\r\n              return;\r\n          }\r\n\r\n          const defaultText = dropzone.dataset.defaultText || t('settings.avatarUploadDefault');\r\n\r\n          try {\r\n              dropzone.innerHTML = '';\r\n              const textEl = document.createElement('span');\r\n              textEl.className = 'workspace-logo-dropzone-text';\r\n              textEl.textContent = `Uploading ${file.name}...`;\r\n              dropzone.appendChild(textEl);\r\n              dropzone.setAttribute('aria-busy', 'true');\r\n\r\n              const reader = new FileReader();\r\n              const dataUrl = await new Promise((resolve, reject) => {\r\n                  reader.onload = () => resolve(reader.result);\r\n                  reader.onerror = reject;\r\n                  reader.readAsDataURL(file);\r\n              });\r\n\r\n              const img = new Image();\r\n              img.onload = () => {\r\n                  openCropModal(dataUrl, img, {\r\n                      title: 'Crop Avatar',\r\n                      instructions: 'Drag to adjust the crop area. Your avatar will be displayed as a circle.',\r\n                      shape: 'circle',\r\n                      outputMimeType: 'image/png',\r\n                      outputMaxSize: 512,\r\n                      successMessage: 'Avatar cropped and applied successfully!',\r\n                      onApply: (croppedDataUrl) => {\r\n                          avatarDraft.hasPendingChange = true;\r\n                          avatarDraft.dataUrl = croppedDataUrl;\r\n                          refreshUserAvatarSettingsUI();\r\n                      }\r\n                  });\r\n              };\r\n              img.onerror = () => {\r\n                  showErrorNotification(t('error.imageLoadFailed'));\r\n              };\r\n              img.src = dataUrl;\r\n          } catch (err) {\r\n              console.error('Avatar upload error:', err);\r\n              showErrorNotification(t('error.avatarUploadFailed'));\r\n          } finally {\r\n              dropzone.setAttribute('aria-busy', 'false');\r\n              setDropzoneText(defaultText);\r\n          }\r\n      }\r\n\r\n      applyDropzoneBaseStyles(dropzone);\r\n      setDropzoneText(defaultText);\r\n\r\n      dropzone.addEventListener('click', () => fileInput.click());\r\n      dropzone.addEventListener('keydown', (e) => {\r\n          if (e.key === 'Enter' || e.key === ' ') {\r\n              e.preventDefault();\r\n              fileInput.click();\r\n          }\r\n      });\r\n\r\n      fileInput.addEventListener('change', (e) => {\r\n          const file = e.target.files && e.target.files[0];\r\n          handleAvatarFile(file, e);\r\n          fileInput.value = '';\r\n      });\r\n\r\n      dropzone.addEventListener('dragenter', (e) => {\r\n          e.preventDefault();\r\n          setDropzoneDragoverStyles(dropzone, true);\r\n      });\r\n      dropzone.addEventListener('dragover', (e) => {\r\n          e.preventDefault();\r\n          setDropzoneDragoverStyles(dropzone, true);\r\n      });\r\n      dropzone.addEventListener('dragleave', (e) => {\r\n          e.preventDefault();\r\n          setDropzoneDragoverStyles(dropzone, false);\r\n      });\r\n      dropzone.addEventListener('drop', (e) => {\r\n          e.preventDefault();\r\n          setDropzoneDragoverStyles(dropzone, false);\r\n          const file = e.dataTransfer?.files?.[0];\r\n          handleAvatarFile(file, e);\r\n      });\r\n\r\n      if (clearButton && !clearButton.__avatarClearBound) {\r\n          clearButton.__avatarClearBound = true;\r\n          clearButton.addEventListener('click', () => {\r\n              avatarDraft.hasPendingChange = true;\r\n              avatarDraft.dataUrl = null;\r\n              refreshUserAvatarSettingsUI();\r\n              if (window.markSettingsDirtyIfNeeded) {\r\n                  window.markSettingsDirtyIfNeeded();\r\n              }\r\n          });\r\n      }\r\n\r\n      refreshUserAvatarSettingsUI();\r\n  }\r\n\r\n  function setupCropEventListeners() {\r\n      const selection = document.getElementById('crop-selection');\r\n      const handles = document.querySelectorAll('.crop-handle');\r\n\r\n      // Mouse down on selection (start drag)\r\n      if (selection) {\r\n          selection.addEventListener('mousedown', onSelectionMouseDown);\r\n          selection.addEventListener('touchstart', onSelectionTouchStart);\r\n      }\r\n\r\n      // Mouse down on handles (start resize)\r\n      handles.forEach(handle => {\r\n          handle.addEventListener('mousedown', onHandleMouseDown);\r\n          handle.addEventListener('touchstart', onHandleTouchStart);\r\n      });\r\n\r\n      // Global mouse move and up\r\n      document.addEventListener('mousemove', onDocumentMouseMove);\r\n      document.addEventListener('mouseup', onDocumentMouseUp);\r\n      document.addEventListener('touchmove', onDocumentTouchMove);\r\n      document.addEventListener('touchend', onDocumentTouchEnd);\r\n      document.addEventListener('keydown', onCropModalKeyDown);\r\n  }\r\n\r\n  function removeCropEventListeners() {\r\n      const selection = document.getElementById('crop-selection');\r\n      const handles = document.querySelectorAll('.crop-handle');\r\n\r\n      if (selection) {\r\n          selection.removeEventListener('mousedown', onSelectionMouseDown);\r\n          selection.removeEventListener('touchstart', onSelectionTouchStart);\r\n      }\r\n\r\n      handles.forEach(handle => {\r\n          handle.removeEventListener('mousedown', onHandleMouseDown);\r\n          handle.removeEventListener('touchstart', onHandleTouchStart);\r\n      });\r\n\r\n      document.removeEventListener('mousemove', onDocumentMouseMove);\r\n      document.removeEventListener('mouseup', onDocumentMouseUp);\r\n      document.removeEventListener('touchmove', onDocumentTouchMove);\r\n      document.removeEventListener('touchend', onDocumentTouchEnd);\r\n      document.removeEventListener('keydown', onCropModalKeyDown);\r\n  }\r\n\r\n  function onSelectionMouseDown(e) {\r\n      if (e.target.classList.contains('crop-handle')) return;\r\n\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      cropState.isDragging = true;\r\n      cropState.dragStartX = e.clientX;\r\n      cropState.dragStartY = e.clientY;\r\n  }\r\n\r\n  function onHandleMouseDown(e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      cropState.isResizing = true;\r\n      cropState.dragStartX = e.clientX;\r\n      cropState.dragStartY = e.clientY;\r\n\r\n      // Determine which handle\r\n      if (e.target.classList.contains('crop-handle-nw')) {\r\n          cropState.activeHandle = 'nw';\r\n      } else if (e.target.classList.contains('crop-handle-ne')) {\r\n          cropState.activeHandle = 'ne';\r\n      } else if (e.target.classList.contains('crop-handle-sw')) {\r\n          cropState.activeHandle = 'sw';\r\n      } else if (e.target.classList.contains('crop-handle-se')) {\r\n          cropState.activeHandle = 'se';\r\n      }\r\n  }\r\n\r\n  function onDocumentMouseMove(e) {\r\n      if (!cropState.isDragging && !cropState.isResizing) return;\r\n\r\n      e.preventDefault();\r\n\r\n      const canvas = cropState.canvas;\r\n      if (!canvas) return;\r\n\r\n      const canvasRect = canvas.getBoundingClientRect();\r\n      const uniformScale = canvas.width / canvasRect.width;\r\n\r\n      const deltaX = (e.clientX - cropState.dragStartX) * uniformScale;\r\n      const deltaY = (e.clientY - cropState.dragStartY) * uniformScale;\r\n\r\n      if (cropState.isDragging) {\r\n          // Move selection\r\n          let newX = cropState.selection.x + deltaX;\r\n          let newY = cropState.selection.y + deltaY;\r\n\r\n          // Constrain to canvas bounds\r\n          newX = Math.max(0, Math.min(newX, canvas.width - cropState.selection.size));\r\n          newY = Math.max(0, Math.min(newY, canvas.height - cropState.selection.size));\r\n\r\n          cropState.selection.x = newX;\r\n          cropState.selection.y = newY;\r\n\r\n      } else if (cropState.isResizing) {\r\n          // Resize selection (maintain square, intuitive handle directions)\r\n          const dominant = (a, b) => (Math.abs(a) > Math.abs(b) ? a : b);\r\n          const minSize = 50;\r\n\r\n          const current = cropState.selection;\r\n          let fixedX = 0;\r\n          let fixedY = 0;\r\n          let resizeDelta = 0;\r\n          let maxSize = 0;\r\n\r\n          switch (cropState.activeHandle) {\r\n              case 'se':\r\n                  resizeDelta = dominant(deltaX, deltaY);\r\n                  fixedX = current.x;\r\n                  fixedY = current.y;\r\n                  maxSize = Math.min(canvas.width - fixedX, canvas.height - fixedY);\r\n                  break;\r\n              case 'nw':\r\n                  resizeDelta = dominant(-deltaX, -deltaY);\r\n                  fixedX = current.x + current.size;\r\n                  fixedY = current.y + current.size;\r\n                  maxSize = Math.min(fixedX, fixedY);\r\n                  break;\r\n              case 'ne':\r\n                  resizeDelta = dominant(deltaX, -deltaY);\r\n                  fixedX = current.x;\r\n                  fixedY = current.y + current.size;\r\n                  maxSize = Math.min(canvas.width - fixedX, fixedY);\r\n                  break;\r\n              case 'sw':\r\n                  resizeDelta = dominant(-deltaX, deltaY);\r\n                  fixedX = current.x + current.size;\r\n                  fixedY = current.y;\r\n                  maxSize = Math.min(fixedX, canvas.height - fixedY);\r\n                  break;\r\n          }\r\n\r\n          let newSize = current.size + resizeDelta;\r\n          newSize = Math.max(minSize, Math.min(newSize, maxSize));\r\n\r\n          let newX = current.x;\r\n          let newY = current.y;\r\n\r\n          switch (cropState.activeHandle) {\r\n              case 'se':\r\n                  newX = fixedX;\r\n                  newY = fixedY;\r\n                  break;\r\n              case 'nw':\r\n                  newX = fixedX - newSize;\r\n                  newY = fixedY - newSize;\r\n                  break;\r\n              case 'ne':\r\n                  newX = fixedX;\r\n                  newY = fixedY - newSize;\r\n                  break;\r\n              case 'sw':\r\n                  newX = fixedX - newSize;\r\n                  newY = fixedY;\r\n                  break;\r\n          }\r\n\r\n          cropState.selection.size = newSize;\r\n          cropState.selection.x = newX;\r\n          cropState.selection.y = newY;\r\n      }\r\n\r\n      updateCropSelection();\r\n\r\n      cropState.dragStartX = e.clientX;\r\n      cropState.dragStartY = e.clientY;\r\n  }\r\n\r\n  function onDocumentMouseUp(e) {\r\n      if (cropState.isDragging || cropState.isResizing) {\r\n          e.preventDefault();\r\n          cropState.isDragging = false;\r\n          cropState.isResizing = false;\r\n          cropState.activeHandle = null;\r\n      }\r\n  }\r\n\r\n  function onSelectionTouchStart(e) {\r\n      if (e.target.classList.contains('crop-handle')) return;\r\n\r\n      e.preventDefault();\r\n\r\n      const touch = e.touches[0];\r\n      cropState.isDragging = true;\r\n      cropState.dragStartX = touch.clientX;\r\n      cropState.dragStartY = touch.clientY;\r\n  }\r\n\r\n  function onHandleTouchStart(e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      const touch = e.touches[0];\r\n      cropState.isResizing = true;\r\n      cropState.dragStartX = touch.clientX;\r\n      cropState.dragStartY = touch.clientY;\r\n\r\n      // Determine handle (same as mouse)\r\n      if (e.target.classList.contains('crop-handle-nw')) {\r\n          cropState.activeHandle = 'nw';\r\n      } else if (e.target.classList.contains('crop-handle-ne')) {\r\n          cropState.activeHandle = 'ne';\r\n      } else if (e.target.classList.contains('crop-handle-sw')) {\r\n          cropState.activeHandle = 'sw';\r\n      } else if (e.target.classList.contains('crop-handle-se')) {\r\n          cropState.activeHandle = 'se';\r\n      }\r\n  }\r\n\r\n  function onDocumentTouchMove(e) {\r\n      if (!cropState.isDragging && !cropState.isResizing) return;\r\n\r\n      e.preventDefault();\r\n\r\n      const touch = e.touches[0];\r\n\r\n      // Reuse mouse move logic with touch coordinates\r\n      const fakeEvent = {\r\n          clientX: touch.clientX,\r\n          clientY: touch.clientY,\r\n          preventDefault: () => {}\r\n      };\r\n\r\n      onDocumentMouseMove(fakeEvent);\r\n  }\r\n\r\n  function onDocumentTouchEnd(e) {\r\n      if (cropState.isDragging || cropState.isResizing) {\r\n          e.preventDefault();\r\n          cropState.isDragging = false;\r\n          cropState.isResizing = false;\r\n          cropState.activeHandle = null;\r\n      }\r\n  }\r\n\r\n  function onCropModalKeyDown(e) {\r\n      if (e.key === 'Escape') {\r\n          closeCropModal();\r\n      }\r\n  }\r\n\r\n      // Expose crop functions globally for onclick handlers in HTML\r\n      window.openCropModal = openCropModal;\r\n      window.closeCropModal = closeCropModal;\r\n      window.applyCrop = applyCrop;\r\n\r\n      // Initialize avatar controls (shares crop modal)\r\n      setupUserAvatarControls();\r\n  }\r\n\r\n  setupWorkspaceLogoControls();\r\n\r\n// Expose functions for auth.js to call\r\nwindow.initializeApp = init;\r\nwindow.setupUserMenus = setupUserMenus;\r\n\r\n// Auth.js will call init() when ready, no need for DOMContentLoaded listener\r\n\r\n// Prevent data loss when user closes tab/browser with pending saves\r\nwindow.addEventListener('beforeunload', (e) => {\r\n    // Flush any pending localStorage writes for feedback queue\r\n    if (feedbackLocalStorageTimer) {\r\n        clearTimeout(feedbackLocalStorageTimer);\r\n        persistFeedbackDeltaQueue(); // Immediate write on page close\r\n    }\r\n\r\n    if (pendingSaves > 0) {\r\n        // Show browser warning dialog\r\n        e.preventDefault();\r\n        // Chrome requires returnValue to be set\r\n        e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';\r\n        return e.returnValue;\r\n    }\r\n});\r\n\r\n// --- Save-on-blur behavior for title and description (tasks/projects) ---\r\n// Attach handlers after the DOM is ready. We only persist to storage when\r\n// the user blurs the field (or closes the modal) to avoid per-keystroke saves.\r\ndocument.addEventListener('DOMContentLoaded', function () {\r\n    const taskModal = document.getElementById('task-modal');\r\n    if (!taskModal) return;\r\n\r\n    // Title input inside the task modal\r\n    const titleInput = taskModal.querySelector('#task-form input[name=\"title\"]');\r\n    if (titleInput) {\r\n        titleInput.addEventListener('blur', function (e) {\r\n            const form = taskModal.querySelector('#task-form');\r\n            if (form && form.dataset.editingTaskId) {\r\n                updateTaskField('title', e.target.value);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Description editor: keep hidden field in sync on input but only persist on blur\r\n    const descEditor = taskModal.querySelector('#task-description-editor');\r\n    const descHidden = taskModal.querySelector('#task-description-hidden');\r\n    if (descEditor && descHidden) {\r\n        let originalDescriptionHTML = '';\r\n\r\n        descEditor.addEventListener('focus', function () {\r\n            // Store original value when user starts editing\r\n            originalDescriptionHTML = descEditor.innerHTML;\r\n        });\r\n\r\n        descEditor.addEventListener('input', function () {\r\n            descHidden.value = descEditor.innerHTML;\r\n        });\r\n\r\n        descEditor.addEventListener('blur', function () {\r\n            const form = taskModal.querySelector('#task-form');\r\n            if (form && form.dataset.editingTaskId) {\r\n                // Only persist if description actually changed\r\n                if (descEditor.innerHTML !== originalDescriptionHTML) {\r\n                    updateTaskField('description', descEditor.innerHTML);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    // Modal close now relies on blur events for persistence\r\n    // Title and description are already persisted via their respective event handlers\r\n});\r\n\r\n// Track first outside click after opening native color picker\r\nlet ignoreNextOutsideColorClick = false;\r\n\r\n// Close color pickers when clicking outside\r\ndocument.addEventListener(\"click\", function(e) {\r\n    if (!e.target.closest('.color-picker-container')) {\r\n        if (ignoreNextOutsideColorClick) {\r\n            ignoreNextOutsideColorClick = false;\r\n            return;\r\n        }\r\n        document.querySelectorAll('.color-picker-dropdown').forEach(picker => {\r\n            picker.style.display = 'none';\r\n        });\r\n    }\r\n});\r\n\r\nasync function submitTaskForm() {\r\n    const form = document.getElementById(\"task-form\");\r\n    const editingTaskId = form.dataset.editingTaskId;\r\n    const submitTimer = debugTimeStart(\"tasks\", \"submit\", {\r\n        editing: !!editingTaskId,\r\n        taskCount: tasks.length\r\n    });\r\nconst title = form.querySelector('input[name=\"title\"]').value;\r\n    let description = document.getElementById(\"task-description-hidden\").value;\r\n    description = autoLinkifyDescription(description);\r\n    // Read projectId from hidden input (custom dropdown), fallback to a select if present\r\n    const projectIdRaw = (form.querySelector('input[name=\"projectId\"]').value ||\r\n                         (form.querySelector('select[name=\"projectId\"]') ? form.querySelector('select[name=\"projectId\"]').value : \"\"));\r\n\r\n    const status = document.getElementById(\"hidden-status\").value || \"backlog\";\r\n    const priority = form.querySelector('#hidden-priority').value || \"medium\";\r\n\r\n    const startRaw = (form.querySelector('input[name=\"startDate\"]')?.value || '').trim();\r\n    const startISO = startRaw === '' ? '' : startRaw;\r\n\r\n    const endRaw = (form.querySelector('input[name=\"endDate\"]')?.value || '').trim();\r\n    const endISO = endRaw === '' ? '' : endRaw;\r\n\r\n    // Date range validation removed - flatpickr constraints prevent invalid selections\r\n\r\n    if (editingTaskId) {\r\n        // Capture old task state for history tracking\r\n        const oldTask = tasks.find(t => t.id === parseInt(editingTaskId, 10));\r\n        const oldTaskCopy = oldTask ? JSON.parse(JSON.stringify(oldTask)) : null;\r\n\r\nconst result = updateTaskService(parseInt(editingTaskId, 10), {title, description, projectId: projectIdRaw, startDate: startISO, endDate: endISO, priority, status}, tasks);\r\n        if (result.task) {\r\n            // Record history for task update\r\n            if (window.historyService && oldTaskCopy) {\r\n                window.historyService.recordTaskUpdated(oldTaskCopy, result.task);\r\n            }\r\n\r\nconst oldProjectId = result.oldProjectId;\r\n            tasks = result.tasks;\r\n            const t = result.task;\r\n\r\n            // If the task moved between projects, mark projects as updated and record project history\r\n            if (oldProjectId !== t.projectId) {\r\n                if (oldProjectId) {\r\n                    touchProjectUpdatedAt(oldProjectId);\r\n                    recordProjectTaskLinkChange(oldProjectId, 'removed', t);\r\n                }\r\n                if (t.projectId) {\r\n                    touchProjectUpdatedAt(t.projectId);\r\n                    recordProjectTaskLinkChange(t.projectId, 'added', t);\r\n                }\r\n                saveProjects().catch(() => {});\r\n            }\r\n\r\n// Close modal and update UI immediately (optimistic update)\r\n            closeModal(\"task-modal\");\r\n\r\n// Refresh the appropriate view immediately\r\n            if (document.getElementById(\"project-details\").classList.contains(\"active\")) {\r\nconst displayedProjectId = oldProjectId || t.projectId;\r\n                if (displayedProjectId) {\r\n                    showProjectDetails(displayedProjectId);\r\n                }\r\n            } else if (document.getElementById(\"projects\").classList.contains(\"active\")) {\r\n                // Clear sorted view cache to force refresh with updated task\r\n                appState.projectsSortedView = null;\r\n                // Refresh projects list view while preserving expanded state\r\n                renderProjects();\r\n                updateCounts();\r\n            }\r\n\r\n            // Save in background (don't block UI)\r\n            saveTasks().catch(err => {\r\n                console.error('Failed to save task:', err);\r\n                showErrorNotification(t('error.saveChangesFailed'));\r\n            });\r\n        } else {\r\n}\r\n    } else {\r\nconst result = createTaskService({title, description, projectId: projectIdRaw, startDate: startISO, endDate: endISO, priority, status, tags: window.tempTags ? [...window.tempTags] : []}, tasks, taskCounter, tempAttachments);\r\n        tasks = result.tasks;\r\n        taskCounter = result.taskCounter;\r\n        const newTask = result.task;\r\n        tempAttachments = [];\r\n        window.tempTags = [];\r\n\r\n        // Record history for task creation\r\n        if (window.historyService) {\r\n            window.historyService.recordTaskCreated(newTask);\r\n        }\r\n\r\n        // Mark project as updated and record project history when task is added to a project\r\n        if (newTask && newTask.projectId) {\r\n            touchProjectUpdatedAt(newTask.projectId);\r\n            recordProjectTaskLinkChange(newTask.projectId, 'added', newTask);\r\n            saveProjects().catch(() => {});\r\n        }\r\n\r\n        // Keep filter dropdowns in sync with new task data\r\n        populateProjectOptions();\r\n        populateTagOptions();\r\n        updateNoDateOptionVisibility();\r\n\r\n        // Close modal and update UI immediately (optimistic update)\r\n        closeModal(\"task-modal\");\r\n\r\n        // Refresh the appropriate view immediately\r\n        if (newTask.projectId && document.getElementById(\"project-details\").classList.contains(\"active\")) {\r\n            showProjectDetails(newTask.projectId);\r\n            updateCounts();\r\n        } else if (document.getElementById(\"projects\").classList.contains(\"active\")) {\r\n            // Clear sorted view cache to force refresh with new task\r\n            appState.projectsSortedView = null;\r\n            renderProjects();\r\n            updateCounts();\r\n        }\r\n\r\n        // Save in background (don't block UI)\r\n        saveTasks().catch(err => {\r\n            console.error('Failed to save task:', err);\r\n            showErrorNotification(t('error.saveChangesFailed'));\r\n        });\r\n    }\r\n\r\n    // Fallback for other views - close modal and update UI immediately\r\n    closeModal(\"task-modal\");\r\n    render();\r\n\r\n    // Always refresh calendar if it exists\r\n    const calendarView = document.getElementById(\"calendar-view\");\r\n    if (calendarView) {\r\n        renderCalendar();\r\n    }\r\n    renderActivityFeed();\r\n\r\n    // Save in background (don't block UI)\r\n    saveTasks().catch(err => {\r\n        console.error('Failed to save task:', err);\r\n        showErrorNotification(t('error.saveChangesFailed'));\r\n    });\r\n    debugTimeEnd(\"tasks\", submitTimer, {\r\n        taskCount: tasks.length,\r\n        projectCount: projects.length\r\n    });\r\n}\r\n\r\n\r\n// Keep enter-to-submit working\r\ndocument.getElementById(\"task-form\").addEventListener(\"submit\", function (e) {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    submitTaskForm();\r\n});\r\n\r\nfunction setupStatusDropdown() {\r\n    // Only set up once by checking if already initialized\r\n    if (document.body.hasAttribute(\"data-status-dropdown-initialized\")) {\r\n        return;\r\n    }\r\n    document.body.setAttribute(\"data-status-dropdown-initialized\", \"true\");\r\n    document.addEventListener(\"click\", handleStatusDropdown);\r\n}\r\n\r\nfunction handleStatusDropdown(e) {\r\n    // Handle options button clicks FIRST\r\n    if (e.target.closest(\"#task-options-btn\")) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const menu = document.getElementById(\"options-menu\");\r\n        if (menu) {\r\n            menu.style.display =\r\n                menu.style.display === \"block\" ? \"none\" : \"block\";\r\n        }\r\n        return;\r\n    }\r\n\r\n    // Close options menu when clicking outside\r\n    const menu = document.getElementById(\"options-menu\");\r\n    if (\r\n        menu &&\r\n        !e.target.closest(\"#task-options-btn\") &&\r\n        !e.target.closest(\"#options-menu\")\r\n    ) {\r\n        menu.style.display = \"none\";\r\n    }\r\n\r\n    // Handle status button clicks\r\n    if (e.target.closest(\"#status-current\")) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const dropdown = e.target.closest(\".status-dropdown\");\r\n        const isActive = dropdown.classList.contains(\"active\");\r\n\r\n        // Close all dropdowns first\r\n        document\r\n            .querySelectorAll(\".status-dropdown.active\")\r\n            .forEach((d) => d.classList.remove(\"active\"));\r\n\r\n        // Toggle this one if it wasn't active\r\n        if (!isActive) {\r\n            dropdown.classList.add(\"active\");\r\n            // Update options to show only unselected\r\n            const hiddenStatus = document.getElementById(\"hidden-status\");\r\n            if (hiddenStatus) {\r\n                updateStatusOptions(hiddenStatus.value);\r\n            }\r\n        }\r\n        return;\r\n    }\r\n\r\n    // Handle status option clicks\r\n    if (e.target.closest(\".status-option\")) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const option = e.target.closest(\".status-option\");\r\n        const status = option.dataset.status;\r\n        const statusBadge = option.querySelector(\".status-badge\");\r\n        const statusText = statusBadge.textContent.trim();\r\n\r\n        // Update display\r\n        const currentBtn = document.getElementById(\"status-current\");\r\n        const hiddenStatus = document.getElementById(\"hidden-status\");\r\n\r\n        if (currentBtn && hiddenStatus) {\r\n            const currentBadge = currentBtn.querySelector(\".status-badge\");\r\n            if (currentBadge) {\r\n                currentBadge.className = `status-badge ${status}`;\r\n                currentBadge.textContent = statusText;\r\n            }\r\n            hiddenStatus.value = status;\r\n            updateTaskField('status', status);\r\n\r\n        }\r\n\r\n        // Close dropdown\r\n        const dropdown = option.closest(\".status-dropdown\");\r\n        if (dropdown) dropdown.classList.remove(\"active\");\r\n        \r\n        // Update options for next time (after dropdown closes)\r\n        setTimeout(() => updateStatusOptions(status), 100);\r\n        return;\r\n    }\r\n\r\n    // Close dropdown when clicking outside\r\n    const activeDropdowns = document.querySelectorAll(\r\n        \".status-dropdown.active\"\r\n    );\r\n    activeDropdowns.forEach((dropdown) => {\r\n        if (!dropdown.contains(e.target)) {\r\n            dropdown.classList.remove(\"active\");\r\n        }\r\n    });\r\n}\r\n\r\n\r\nfunction setupPriorityDropdown() {\r\n    if (document.body.hasAttribute(\"data-priority-dropdown-initialized\")) {\r\n        return;\r\n    }\r\n    document.body.setAttribute(\"data-priority-dropdown-initialized\", \"true\");\r\n    document.addEventListener(\"click\", handlePriorityDropdown);\r\n}\r\n\r\nfunction handlePriorityDropdown(e) {\r\n    // Handle priority button clicks\r\n    if (e.target.closest(\"#priority-current\")) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const dropdown = e.target.closest(\".priority-dropdown\");\r\n        const isActive = dropdown.classList.contains(\"active\");\r\n\r\n        // Close all dropdowns first\r\n        document\r\n            .querySelectorAll(\".priority-dropdown.active\")\r\n            .forEach((d) => d.classList.remove(\"active\"));\r\n\r\n        // Toggle this one if it wasn't active\r\n        if (!isActive) {\r\n            dropdown.classList.add(\"active\");\r\n            // Update options to show only unselected\r\n            const hiddenPriority = document.getElementById(\"hidden-priority\");\r\n            if (hiddenPriority) {\r\n                updatePriorityOptions(hiddenPriority.value);\r\n            }\r\n        }\r\n        return;\r\n    }\r\n\r\n    // Handle priority option clicks\r\n    if (e.target.closest(\".priority-option\")) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const option = e.target.closest(\".priority-option\");\r\n        const priority = option.dataset.priority;\r\n        const priorityText = option.textContent.trim();\r\n\r\n        // Update display\r\n        const currentBtn = document.getElementById(\"priority-current\");\r\n        const hiddenPriority = document.getElementById(\"hidden-priority\");\r\n\r\n        if (currentBtn && hiddenPriority) {\r\n            const priorityLabel = priorityText.toUpperCase();\r\n            currentBtn.innerHTML = `<span class=\"priority-pill priority-${priority}\">${priorityLabel}</span> <span class=\"dropdown-arrow\">\u25BC</span>`;\r\n            hiddenPriority.value = priority;\r\n            updateTaskField('priority', priority);\r\n        }\r\n\r\n        // Close dropdown\r\n        const dropdown = option.closest(\".priority-dropdown\");\r\n        if (dropdown) dropdown.classList.remove(\"active\");\r\n        \r\n        // Update options for next time (after dropdown closes)\r\n        setTimeout(() => updatePriorityOptions(priority), 100);\r\n        return;\r\n    }\r\n\r\n    // Close dropdown when clicking outside\r\n    const activePriorityDropdowns = document.querySelectorAll(\r\n        \".priority-dropdown.active\"\r\n    );\r\n    activePriorityDropdowns.forEach((dropdown) => {\r\n        if (!dropdown.contains(e.target)) {\r\n            dropdown.classList.remove(\"active\");\r\n        }\r\n    });\r\n}\r\n\r\nfunction updatePriorityOptions(selectedPriority) {\r\n    const priorityOptions = document.getElementById(\"priority-options\");\r\n    if (!priorityOptions) return;\r\n    \r\n    // Using imported PRIORITY_OPTIONS\r\n    const allPriorities = PRIORITY_OPTIONS.map((priority) => ({\r\n        ...priority,\r\n        label: getPriorityLabel(priority.value)\r\n    }));\r\n    \r\n    // Show only unselected priorities\r\n    const availableOptions = allPriorities.filter(p => p.value !== selectedPriority);\r\n    \r\n    priorityOptions.innerHTML = availableOptions.map(priority => \r\n        `<div class=\"priority-option\" data-priority=\"${priority.value}\">\r\n            <span class=\"priority-pill priority-${priority.value}\">${priority.label.toUpperCase()}</span>\r\n        </div>`\r\n    ).join(\"\");\r\n}\r\n\r\nfunction updateStatusOptions(selectedStatus) {\r\n    const statusOptions = document.getElementById(\"status-options\");\r\n    if (!statusOptions) return;\r\n\r\n    const allStatuses = [\r\n        { value: \"backlog\", label: getStatusLabel(\"backlog\") },\r\n        { value: \"todo\", label: getStatusLabel(\"todo\") },\r\n        { value: \"progress\", label: getStatusLabel(\"progress\") },\r\n        { value: \"review\", label: getStatusLabel(\"review\") },\r\n        { value: \"done\", label: getStatusLabel(\"done\") }\r\n    ];\r\n\r\n    // Filter out disabled statuses (e.g., review status when disabled)\r\n    let enabledStatuses = allStatuses;\r\n    if (window.enableReviewStatus === false) {\r\n        enabledStatuses = allStatuses.filter(s => s.value !== \"review\");\r\n    }\r\n\r\n    // Show only unselected statuses\r\n    const availableOptions = enabledStatuses.filter(s => s.value !== selectedStatus);\r\n\r\n    statusOptions.innerHTML = availableOptions.map(status =>\r\n        `<div class=\"status-option\" data-status=\"${status.value}\">\r\n            <span class=\"status-badge ${status.value}\">${status.label}</span>\r\n        </div>`\r\n    ).join(\"\");\r\n}\r\n\r\nfunction setupProjectDropdown() {\r\n    // Only set up once by checking if already initialized\r\n    if (document.body.hasAttribute(\"data-project-dropdown-initialized\")) {\r\n        return;\r\n    }\r\n    document.body.setAttribute(\"data-project-dropdown-initialized\", \"true\");\r\n    document.addEventListener(\"click\", handleProjectDropdown);\r\n}\r\n\r\nfunction handleProjectDropdown(e) {\r\n    // Handle project button clicks\r\n    if (e.target.closest(\"#project-current\")) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n    const dropdown = e.target.closest(\".project-dropdown\");\r\n        const isActive = dropdown.classList.contains(\"active\");\r\n\r\n        // Close all dropdowns first\r\n        document\r\n            .querySelectorAll(\".project-dropdown.active\")\r\n            .forEach((d) => d.classList.remove(\"active\"));\r\n\r\n        // Toggle this one if it wasn't active\r\n        if (!isActive) {\r\n            dropdown.classList.add(\"active\");\r\n            // Populate options when opening into this dropdown's options container\r\n            showProjectDropdownPortal(dropdown);\r\n        }\r\n        return;\r\n    }\r\n\r\n    // Handle project option clicks\r\n    if (e.target.closest(\".project-option\")) {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        const option = e.target.closest(\".project-option\");\r\n        const projectId = option.dataset.projectId;\r\n        const projectText = option.textContent.trim();\r\n\r\n        // Update display\r\n    const currentBtn = document.getElementById(\"project-current\");\r\n    const hiddenProject = document.getElementById(\"hidden-project\");\r\n\r\n        if (currentBtn && hiddenProject) {\r\n            const projectTextSpan = currentBtn.querySelector(\".project-text\");\r\n            if (projectTextSpan) {\r\n                if (projectId) {\r\n                    const colorSquare = `<span style=\"display: inline-block; width: 10px; height: 10px; background-color: ${getProjectColor(parseInt(projectId))}; border-radius: 2px; margin-right: 8px; vertical-align: middle;\"></span>`;\r\n                    projectTextSpan.innerHTML = colorSquare + escapeHtml(projectText);\r\n                } else {\r\n                    projectTextSpan.textContent = projectText;\r\n                }\r\n            }\r\n            hiddenProject.value = projectId;\r\n            updateTaskField('projectId', projectId);\r\n            updateTaskProjectOpenBtn(projectId);\r\n        }\r\n\r\n        // Close dropdown\r\n        const dropdown = option.closest(\".project-dropdown\");\r\n        if (dropdown) dropdown.classList.remove(\"active\");\r\n        hideProjectDropdownPortal();\r\n        return;\r\n    }\r\n\r\n    // Close dropdown when clicking outside\r\n    const activeDropdowns = document.querySelectorAll(\".project-dropdown.active\");\r\n    if (activeDropdowns.length > 0 && !e.target.closest(\".project-dropdown\")) {\r\n        activeDropdowns.forEach((d) => d.classList.remove(\"active\"));\r\n        hideProjectDropdownPortal();\r\n    }\r\n}\r\n\r\nfunction updateTaskProjectOpenBtn(projectId) {\r\n    const btn = document.getElementById('task-project-open-btn');\r\n    if (!btn) return;\r\n    btn.style.display = projectId ? 'inline-flex' : 'none';\r\n}\r\n\r\nfunction openSelectedProjectFromTask() {\r\n    const hiddenProject = document.getElementById('hidden-project');\r\n    if (!hiddenProject || !hiddenProject.value) return;\r\n    const projectId = parseInt(hiddenProject.value, 10);\r\n    if (!projectId) return;\r\n    // Close task modal before navigating\r\n    closeModal('task-modal');\r\n    showProjectDetails(projectId, 'projects');\r\n}\r\n\r\nfunction populateProjectDropdownOptions(dropdownEl) {\r\n    const projectOptions = dropdownEl ? dropdownEl.querySelector('.project-options') : null;\r\n    const hiddenProject = document.getElementById('hidden-project');\r\n    const selectedId = hiddenProject ? (hiddenProject.value || '') : '';\r\n    // Only include the clear option when a specific project is selected\r\n    let optionsHTML = selectedId ? `<div class=\"project-option\" data-project-id=\"\">${t('tasks.project.selectPlaceholder')}</div>` : '';\r\n    if (projects && projects.length > 0) {\r\n        optionsHTML += projects\r\n            .slice()\r\n            .sort((a, b) => (a.name || \"\").localeCompare(b.name || \"\", undefined, { sensitivity: \"base\" }))\r\n            .filter(project => selectedId === '' || String(project.id) !== String(selectedId))\r\n            .map(project => {\r\n                const colorSquare = `<span style=\"display: inline-block; width: 10px; height: 10px; background-color: ${getProjectColor(project.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;\"></span>`;\r\n                return `<div class=\"project-option\" data-project-id=\"${project.id}\">${colorSquare}${escapeHtml(project.name)}</div>`;\r\n            })\r\n            .join(\"\");\r\n    }\r\n    if (projectOptions) projectOptions.innerHTML = optionsHTML;\r\n    return optionsHTML;\r\n}\r\n\r\n// ===== Portal-based floating dropdown =====\r\nlet projectPortalEl = null;\r\nlet projectPortalAnchor = null;\r\nlet projectPortalScrollParents = [];\r\n\r\nfunction showProjectDropdownPortal(dropdownEl) {\r\n    // Ensure local options have the correct items for keyboard nav fallback\r\n    const optionsHTML = populateProjectDropdownOptions(dropdownEl) || '';\r\n\r\n    // Create portal container if needed\r\n    if (!projectPortalEl) {\r\n        projectPortalEl = document.createElement('div');\r\n        projectPortalEl.className = 'project-options-portal';\r\n        document.body.appendChild(projectPortalEl);\r\n    }\r\n    // Build portal with search input and options container\r\n    projectPortalEl.innerHTML = `\r\n        <div class=\"project-portal-search\">\r\n            <input type=\"text\" class=\"form-input\" id=\"project-portal-search-input\" placeholder=\"Search projects...\" autocomplete=\"off\" />\r\n        </div>\r\n        <div class=\"project-portal-options\">${optionsHTML}</div>\r\n    `;\r\n    projectPortalEl.style.display = 'block';\r\n\r\n    // Anchor is the trigger button\r\n    const button = dropdownEl.querySelector('#project-current');\r\n    projectPortalAnchor = button;\r\n    positionProjectPortal(button, projectPortalEl);\r\n    // Re-position on next frame to account for fonts/scrollbar layout\r\n    requestAnimationFrame(() => positionProjectPortal(button, projectPortalEl));\r\n\r\n    // Delegate clicks within portal to original handler\r\n    projectPortalEl.addEventListener('click', (evt) => {\r\n        evt.stopPropagation();\r\n        const opt = evt.target.closest('.project-option');\r\n        if (!opt) return;\r\n        // Simulate selection using existing logic\r\n        const projectId = opt.dataset.projectId;\r\n        const projectText = opt.textContent.trim();\r\n        const currentBtn = document.getElementById('project-current');\r\n        const hiddenProject = document.getElementById('hidden-project');\r\n        if (currentBtn && hiddenProject) {\r\n            const projectTextSpan = currentBtn.querySelector('.project-text');\r\n            if (projectTextSpan) {\r\n                if (projectId) {\r\n                    const colorSquare = `<span style=\"display: inline-block; width: 10px; height: 10px; background-color: ${getProjectColor(parseInt(projectId))}; border-radius: 2px; margin-right: 8px; vertical-align: middle;\"></span>`;\r\n                    projectTextSpan.innerHTML = colorSquare + escapeHtml(projectText);\r\n                } else {\r\n                    projectTextSpan.textContent = projectText;\r\n                }\r\n            }\r\n            hiddenProject.value = projectId;\r\n            updateTaskField('projectId', projectId);\r\n            updateTaskProjectOpenBtn(projectId);\r\n        }\r\n        const dd = button.closest('.project-dropdown');\r\n        if (dd) dd.classList.remove('active');\r\n        hideProjectDropdownPortal();\r\n    }, { once: true });\r\n\r\n    // Live filtering\r\n    const searchInput = projectPortalEl.querySelector('#project-portal-search-input');\r\n    if (searchInput) {\r\n        searchInput.addEventListener('input', () => filterProjectPortalList(searchInput.value));\r\n        // Autofocus for quick typing\r\n        setTimeout(() => searchInput.focus(), 0);\r\n    }\r\n\r\n    // Close behaviors\r\n    window.addEventListener('scroll', handleProjectPortalClose, true);\r\n    window.addEventListener('resize', handleProjectPortalClose, true);\r\n    document.addEventListener('keydown', handleProjectPortalEsc, true);\r\n\r\n    // Hide inline options to avoid duplicate rendering underneath\r\n    const inlineOptions = dropdownEl.querySelector('.project-options');\r\n    if (inlineOptions) inlineOptions.style.display = 'none';\r\n\r\n    // Listen to scroll on any scrollable ancestor (modal columns, body, etc.)\r\n    attachScrollListeners(button);\r\n}\r\n\r\nfunction positionProjectPortal(button, portal) {\r\n    const rect = button.getBoundingClientRect();\r\n    // Match width to trigger\r\n    portal.style.width = `${rect.width}px`;\r\n    // Prefer below; if not enough space, flip above\r\n    const viewportH = window.innerHeight;\r\n    const portalHeight = Math.min(portal.scrollHeight, 200); // matches CSS max-height\r\n    const spaceBelow = viewportH - rect.bottom;\r\n    const showAbove = spaceBelow < portalHeight + 12; // small buffer\r\n    const top = showAbove ? Math.max(8, rect.top - portalHeight - 4) : rect.bottom + 4;\r\n    const viewportW = window.innerWidth;\r\n    const portalWidth = portal.getBoundingClientRect().width || rect.width;\r\n    const desiredLeft = rect.left;\r\n    const clampedLeft = Math.min(\r\n        Math.max(8, desiredLeft),\r\n        Math.max(8, viewportW - portalWidth - 8)\r\n    );\r\n    portal.style.left = `${clampedLeft}px`;\r\n    portal.style.top = `${top}px`;\r\n}\r\n\r\nfunction hideProjectDropdownPortal() {\r\n    if (projectPortalEl) {\r\n        projectPortalEl.style.display = 'none';\r\n        projectPortalEl.innerHTML = '';\r\n    }\r\n    // Restore inline options visibility\r\n    document.querySelectorAll('.project-dropdown .project-options').forEach(el => {\r\n        el.style.display = '';\r\n    });\r\n    window.removeEventListener('scroll', handleProjectPortalClose, true);\r\n    window.removeEventListener('resize', handleProjectPortalClose, true);\r\n    document.removeEventListener('keydown', handleProjectPortalEsc, true);\r\n    projectPortalAnchor = null;\r\n    detachScrollListeners();\r\n}\r\n\r\nfunction handleProjectPortalClose() {\r\n    if (!projectPortalAnchor || !projectPortalEl || projectPortalEl.style.display === 'none') return;\r\n    // Reposition on scroll/resize if still open and anchor exists\r\n    if (document.querySelector('.project-dropdown.active')) {\r\n        positionProjectPortal(projectPortalAnchor, projectPortalEl);\r\n    } else {\r\n        hideProjectDropdownPortal();\r\n    }\r\n}\r\n\r\nfunction attachScrollListeners(anchor) {\r\n    detachScrollListeners();\r\n    projectPortalScrollParents = getScrollableAncestors(anchor);\r\n    projectPortalScrollParents.forEach(el => {\r\n        el.addEventListener('scroll', handleProjectPortalClose, { capture: true, passive: true });\r\n    });\r\n}\r\n\r\nfunction detachScrollListeners() {\r\n    if (!projectPortalScrollParents || projectPortalScrollParents.length === 0) return;\r\n    projectPortalScrollParents.forEach(el => {\r\n        el.removeEventListener('scroll', handleProjectPortalClose, { capture: true });\r\n    });\r\n    projectPortalScrollParents = [];\r\n}\r\n\r\nfunction getScrollableAncestors(el) {\r\n    const result = [];\r\n    let node = el.parentElement;\r\n    while (node && node !== document.body) {\r\n        const style = getComputedStyle(node);\r\n        const isScrollableY = /(auto|scroll|overlay)/.test(style.overflowY);\r\n        if (isScrollableY && node.scrollHeight > node.clientHeight) {\r\n            result.push(node);\r\n        }\r\n        node = node.parentElement;\r\n    }\r\n    // Always include documentElement and body scroll contexts\r\n    result.push(document.documentElement);\r\n    result.push(document.body);\r\n    return result;\r\n}\r\n\r\nfunction handleProjectPortalEsc(e) {\r\n    if (e.key === 'Escape') {\r\n        hideProjectDropdownPortal();\r\n        document.querySelectorAll('.project-dropdown.active').forEach(d => d.classList.remove('active'));\r\n    }\r\n}\r\n\r\nfunction formatText(command) {\r\n    document.execCommand(command, false, null);\r\n    document.getElementById(\"description-editor\").focus();\r\n}\r\n\r\nfunction insertHeading(level) {\r\n    document.execCommand(\"formatBlock\", false, level);\r\n    document.getElementById(\"description-editor\").focus();\r\n}\r\n\r\nfunction insertDivider() {\r\n    document.execCommand(\"insertHTML\", false, \"<hr>\");\r\n    document.getElementById(\"description-editor\").focus();\r\n}\r\n\r\nfunction formatTaskText(command) {\r\n    document.execCommand(command, false, null);\r\n    document.getElementById(\"task-description-editor\").focus();\r\n}\r\n\r\nfunction insertTaskHeading(level) {\r\n    document.execCommand(\"formatBlock\", false, level);\r\n    document.getElementById(\"task-description-editor\").focus();\r\n}\r\n\r\nfunction insertTaskDivider() {\r\n    const editor = document.getElementById('task-description-editor');\r\n    if (!editor) return;\r\n    const sel = window.getSelection();\r\n    let inserted = false;\r\n    if (sel && sel.rangeCount) {\r\n        const range = sel.getRangeAt(0);\r\n        const container = range.commonAncestorContainer;\r\n        const checkText = container.nodeType === 1 ? container.closest?.('.check-text') : container.parentElement?.closest?.('.check-text');\r\n        if (checkText && editor.contains(checkText)) {\r\n            // If inside a checklist, insert the divider as a separate block after the checkbox row\r\n            const row = checkText.closest('.checkbox-row');\r\n            if (row && row.parentNode) {\r\n                const wrapper = document.createElement('div');\r\n                wrapper.innerHTML = '<div class=\"divider-row\"><hr></div><div><br></div>';\r\n                const newNode = wrapper.firstChild;\r\n                row.parentNode.insertBefore(newNode, row.nextSibling);\r\n                // place caret after the divider\r\n                const r = document.createRange();\r\n                const nxt = newNode.nextSibling;\r\n                if (nxt) {\r\n                    r.setStart(nxt, 0);\r\n                    r.collapse(true);\r\n                } else {\r\n                    r.selectNodeContents(editor);\r\n                    r.collapse(false);\r\n                }\r\n                sel.removeAllRanges();\r\n                sel.addRange(r);\r\n                editor.focus();\r\n                editor.dispatchEvent(new Event('input'));\r\n                inserted = true;\r\n            }\r\n        }\r\n    }\r\n    if (!inserted) {\r\n        // Fallback: insert a block-wrapped hr to avoid inline collisions\r\n        document.execCommand('insertHTML', false, '<div class=\"divider-row\"><hr></div><div><br></div>');\r\n        document.getElementById('task-description-editor').focus();\r\n    }\r\n}\r\n\r\n// Insert a single-row checkbox (no text) into the description editor\r\nfunction insertCheckbox() {\r\n    const editor = document.getElementById('task-description-editor');\r\n    if (!editor) return;\r\n    const id = 'chk-' + Date.now() + '-' + Math.floor(Math.random() * 1000);\r\n    // make the row itself editable so users can select/delete the row; keep the toggle button non-editable\r\n    // include variant-1 class for the award-winning blue style\r\n    // NOTE: do NOT append an extra <div><br></div> here \u2014 that produced stray blank blocks when inserting\r\n    // in between existing rows. We only insert the checkbox row itself and move the caret into it.\r\n    const html = `<div class=\\\"checkbox-row\\\" data-id=\\\"${id}\\\" contenteditable=\\\"false\\\"><button type=\\\"button\\\" class=\\\"checkbox-toggle variant-1\\\" aria-pressed=\\\"false\\\" title=\\\"${t('tasks.checklist.toggle')}\\\" contenteditable=\\\"false\\\"></button><div class=\\\"check-text\\\" contenteditable=\\\"true\\\"></div></div>`;\r\n    try {\r\n        document.execCommand('insertHTML', false, html);\r\n    } catch (e) {\r\n        // fallback\r\n        editor.insertAdjacentHTML('beforeend', html);\r\n    }\r\n    // Move caret into the editable .check-text so user can type immediately\r\n    setTimeout(() => {\r\n        const el = editor.querySelector(`[data-id=\\\"${id}\\\"] .check-text`);\r\n        if (el) {\r\n            const range = document.createRange();\r\n            range.selectNodeContents(el);\r\n            range.collapse(true);\r\n            const s = window.getSelection();\r\n            s.removeAllRanges();\r\n            s.addRange(range);\r\n            el.focus();\r\n        }\r\n        editor.dispatchEvent(new Event('input'));\r\n    }, 10);\r\n}\r\n\r\n// Auto-link plain URLs in description HTML\r\nfunction autoLinkifyDescription(html) {\r\n    if (!html) return html;\r\n\r\n    const container = document.createElement('div');\r\n    container.innerHTML = html;\r\n\r\n    const urlRegex = /(https?:\\/\\/[^\\s<]+)/g;\r\n    const walker = document.createTreeWalker(container, NodeFilter.SHOW_TEXT, null);\r\n    const textNodes = [];\r\n\r\n    while (walker.nextNode()) {\r\n        const node = walker.currentNode;\r\n        if (!node || !node.nodeValue) continue;\r\n        const parentEl = node.parentElement;\r\n        if (parentEl && parentEl.closest('a')) continue;\r\n        urlRegex.lastIndex = 0;\r\n        if (!urlRegex.test(node.nodeValue)) continue;\r\n        textNodes.push(node);\r\n    }\r\n\r\n    textNodes.forEach(node => {\r\n        const text = node.nodeValue;\r\n        let lastIndex = 0;\r\n        urlRegex.lastIndex = 0;\r\n        const frag = document.createDocumentFragment();\r\n        let match;\r\n\r\n        while ((match = urlRegex.exec(text)) !== null) {\r\n            const url = match[0];\r\n            if (match.index > lastIndex) {\r\n                frag.appendChild(document.createTextNode(text.slice(lastIndex, match.index)));\r\n            }\r\n            const a = document.createElement('a');\r\n            a.href = url;\r\n            a.textContent = url;\r\n            a.target = '_blank';\r\n            a.rel = 'noopener noreferrer';\r\n            frag.appendChild(a);\r\n            lastIndex = match.index + url.length;\r\n        }\r\n\r\n        if (lastIndex < text.length) {\r\n            frag.appendChild(document.createTextNode(text.slice(lastIndex)));\r\n        }\r\n\r\n        if (node.parentNode) {\r\n            node.parentNode.replaceChild(frag, node);\r\n        }\r\n    });\r\n\r\n    return container.innerHTML;\r\n}\r\n\r\n// Update the description hidden field when content changes\r\ndocument.addEventListener(\"DOMContentLoaded\", function () {\r\n    const taskEditor = document.getElementById(\"task-description-editor\");\r\n    const taskHiddenField = document.getElementById(\"task-description-hidden\");\r\n\r\n    if (taskEditor && taskHiddenField) {\r\n        // Legacy behavior: preserve any literal '\u2714' characters inside checkbox buttons\r\n\r\n        taskEditor.addEventListener(\"input\", function () {\r\n            taskHiddenField.value = taskEditor.innerHTML;\r\n        });\r\n\r\n        // If the user pastes an image into the description editor, treat it as an attachment\r\n        // (same UX as feedback screenshot paste) instead of inserting a giant inline <img>.\r\n        taskEditor.addEventListener(\"paste\", function (e) {\r\n            if (!e.clipboardData) return;\r\n            const file = Array.from(e.clipboardData.files || [])[0];\r\n            if (!file || !file.type || !file.type.startsWith(\"image/\")) return;\r\n\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n\r\n            const dropzone = document.getElementById(\"attachment-file-dropzone\");\r\n            if (typeof uploadTaskAttachmentFile === \"function\") {\r\n                uploadTaskAttachmentFile(file, dropzone).catch((err) => {\r\n                    console.error(\"Failed to upload pasted image as attachment:\", err);\r\n                });\r\n            }\r\n        });\r\n         \r\n        // Enhanced key handling inside the editor:\r\n        // - Enter inside a .check-text moves the caret to the next line (like ArrowDown)\r\n        // - Backspace/Delete when at edges will remove the checkbox row\r\n        taskEditor.addEventListener('keydown', function (e) {\r\n            const sel = window.getSelection();\r\n\r\n            // If the user presses Backspace/Delete, we may need to handle checkbox\r\n            // rows specially. However, if the user has a multi-element selection\r\n            // (for example Select All) we should let the browser perform the\r\n            // default deletion rather than intercepting it.\r\n            if ((e.key === 'Backspace' || e.key === 'Delete') && sel && sel.rangeCount) {\r\n                try {\r\n                    const r0 = sel.getRangeAt(0);\r\n                    // If the selection spans multiple containers, let the browser\r\n                    // handle deletion (this fixes Select All + Delete/Backspace).\r\n                    if (!r0.collapsed && r0.startContainer !== r0.endContainer) {\r\n                        return;\r\n                    }\r\n                    if (!r0.collapsed) {\r\n                        // Compute top-level child nodes that the selection spans and remove\r\n                        // any `.checkbox-row` children between them. This works even when\r\n                        // non-editable nodes aren't directly part of the selection.\r\n                        const children = Array.from(taskEditor.childNodes);\r\n                        function topLevel(node) {\r\n                            let n = node.nodeType === 3 ? node.parentElement : node;\r\n                            while (n && n.parentElement !== taskEditor) n = n.parentElement;\r\n                            return n;\r\n                        }\r\n                        const startNode = topLevel(r0.startContainer);\r\n                        const endNode = topLevel(r0.endContainer);\r\n                        let startIdx = children.indexOf(startNode);\r\n                        let endIdx = children.indexOf(endNode);\r\n                        if (startIdx === -1) startIdx = 0;\r\n                        if (endIdx === -1) endIdx = children.length - 1;\r\n                        const lo = Math.min(startIdx, endIdx);\r\n                        const hi = Math.max(startIdx, endIdx);\r\n                        let removed = false;\r\n                        for (let i = lo; i <= hi; i++) {\r\n                            const node = children[i];\r\n                            if (node && node.classList && node.classList.contains('checkbox-row')) {\r\n                                const next = node.nextSibling;\r\n                                node.parentNode.removeChild(node);\r\n                                if (next && next.nodeType === 1 && next.tagName.toLowerCase() === 'div' && next.innerHTML.trim() === '<br>') {\r\n                                    next.parentNode.removeChild(next);\r\n                                }\r\n                                removed = true;\r\n                            }\r\n                        }\r\n                        if (removed) {\r\n                            e.preventDefault();\r\n                            taskEditor.dispatchEvent(new Event('input'));\r\n                            return;\r\n                        }\r\n                    } else {\r\n                        // Collapsed selection: if caret is not inside a .check-text and the user\r\n                        // presses Backspace while the caret is at the start of a node located\r\n                        // immediately after a checkbox row, move the caret into the previous\r\n                        // .check-text at its end so the user can continue to backspace through\r\n                        // the text and then delete the checkbox normally.\r\n                        const container = r0.startContainer;\r\n                        const checkText = container.nodeType === 1 ? container.closest?.('.check-text') : container.parentElement?.closest?.('.check-text');\r\n                        if (!checkText && e.key === 'Backspace') {\r\n                            const node = container.nodeType === 3 ? container.parentElement : container;\r\n                            if (node) {\r\n                                const atStart = (container.nodeType === 3) ? r0.startOffset === 0 : r0.startOffset === 0;\r\n                                if (atStart) {\r\n                                    let prev = node.previousSibling;\r\n                                    while (prev && prev.nodeType !== 1) prev = prev.previousSibling;\r\n                                    if (prev && prev.classList && prev.classList.contains('checkbox-row')) {\r\n                                        e.preventDefault();\r\n                                        const txt = prev.querySelector('.check-text');\r\n                                        if (txt) {\r\n                                            if (!txt.firstChild) txt.appendChild(document.createTextNode(''));\r\n                                            const textNode = txt.firstChild.nodeType === 3 ? txt.firstChild : txt.firstChild;\r\n                                            const pos = textNode.nodeType === 3 ? textNode.length : (txt.textContent ? txt.textContent.length : 0);\r\n                                            const newRange = document.createRange();\r\n                                            try {\r\n                                                newRange.setStart(textNode, pos);\r\n                                            } catch (e2) {\r\n                                                newRange.selectNodeContents(txt);\r\n                                                newRange.collapse(false);\r\n                                            }\r\n                                            newRange.collapse(true);\r\n                                            sel.removeAllRanges();\r\n                                            sel.addRange(newRange);\r\n                                            txt.focus();\r\n                                            taskEditor.dispatchEvent(new Event('input'));\r\n                                            return;\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                } catch (err) {\r\n                    // ignore and fall through to default behavior\r\n                }\r\n            }\r\n            if (e.key === 'Enter') {\r\n                if (!sel || !sel.rangeCount) {\r\n                    e.stopPropagation();\r\n                    return;\r\n                }\r\n                const range = sel.getRangeAt(0);\r\n                const container = range.commonAncestorContainer;\r\n                const checkText = container.nodeType === 1 ? container.closest?.('.check-text') : container.parentElement?.closest?.('.check-text');\r\n                if (checkText && taskEditor.contains(checkText)) {\r\n                    // Confluence-like behavior for checklists:\r\n                    // - Enter at the end of a checklist row -> create a new checklist row below and move caret into it\r\n                    // - Enter on an empty checklist row -> remove the checklist and convert it to a normal paragraph (blank div)\r\n                    // - Otherwise (Enter inside text) insert a line-break inside the check-text\r\n                    e.preventDefault();\r\n                    const row = checkText.closest('.checkbox-row');\r\n                    if (!row) return;\r\n                    // Compute text before/after caret inside the checkText\r\n                    const range = sel.getRangeAt(0);\r\n                    const beforeRange = range.cloneRange();\r\n                    beforeRange.selectNodeContents(checkText);\r\n                    beforeRange.setEnd(range.startContainer, range.startOffset);\r\n                    const beforeText = beforeRange.toString();\r\n                    const afterRange = range.cloneRange();\r\n                    afterRange.selectNodeContents(checkText);\r\n                    afterRange.setStart(range.endContainer, range.endOffset);\r\n                    const afterText = afterRange.toString();\r\n\r\n                    // If the checklist is completely empty -> replace with a paragraph\r\n                    if (beforeText.length === 0 && afterText.length === 0) {\r\n                        const p = document.createElement('div');\r\n                        p.innerHTML = '<br>';\r\n                        row.parentNode.replaceChild(p, row);\r\n                        const r = document.createRange();\r\n                        r.setStart(p, 0);\r\n                        r.collapse(true);\r\n                        sel.removeAllRanges();\r\n                        sel.addRange(r);\r\n                        taskEditor.focus();\r\n                        taskEditor.dispatchEvent(new Event('input'));\r\n                        return;\r\n                    }\r\n\r\n                    // If caret is at the end of the text -> create a new checkbox row below\r\n                    if (afterText.length === 0) {\r\n                        const id2 = 'chk-' + Date.now() + '-' + Math.floor(Math.random() * 1000);\r\n                        const wrapper = document.createElement('div');\r\n                        wrapper.innerHTML = `<div class=\\\"checkbox-row\\\" data-id=\\\"${id2}\\\" contenteditable=\\\"false\\\"><button type=\\\"button\\\" class=\\\"checkbox-toggle variant-1\\\" aria-pressed=\\\"false\\\" title=\\\"${t('tasks.checklist.toggle')}\\\" contenteditable=\\\"false\\\"></button><div class=\\\"check-text\\\" contenteditable=\\\"true\\\"></div></div>`;\r\n                        const newRow = wrapper.firstChild;\r\n                        if (row && row.parentNode) {\r\n                            row.parentNode.insertBefore(newRow, row.nextSibling);\r\n                            const el = newRow.querySelector('.check-text');\r\n                            const r = document.createRange();\r\n                            r.selectNodeContents(el);\r\n                            r.collapse(true);\r\n                            sel.removeAllRanges();\r\n                            sel.addRange(r);\r\n                            el.focus();\r\n                            taskEditor.dispatchEvent(new Event('input'));\r\n                        }\r\n                        return;\r\n                    }\r\n\r\n                    // Otherwise, insert an inline line-break inside the check-text\r\n                    document.execCommand('insertHTML', false, '<br><br>');\r\n                    taskEditor.dispatchEvent(new Event('input'));\r\n                    return;\r\n                }\r\n                // Not in a check-text: prevent event from bubbling to the form\r\n                e.stopPropagation();\r\n                return;\r\n            }\r\n\r\n            if ((e.key === 'Backspace' || e.key === 'Delete') && sel && sel.rangeCount) {\r\n                const range = sel.getRangeAt(0);\r\n                const container = range.commonAncestorContainer;\r\n                const checkText = container.nodeType === 1 ? container.closest?.('.check-text') : container.parentElement?.closest?.('.check-text');\r\n                // Logging for checkbox key handling (Backspace/Delete inside checklist rows)\r\n                console.log('[checkbox-editor] keydown', {\r\n                    key: e.key,\r\n                    collapsed: range.collapsed,\r\n                    containerNodeType: container.nodeType,\r\n                    containerTag: container.nodeType === 1 ? container.tagName : null,\r\n                    isInCheckText: !!checkText\r\n                });\r\n                if (checkText && taskEditor.contains(checkText)) {\r\n                    // Backspace at start -> remove the row\r\n                    const row = checkText.closest('.checkbox-row');\r\n                    if (!row) return;\r\n                    // Create a clone range to inspect text before/after caret within checkText\r\n                    const beforeRange = range.cloneRange();\r\n                    beforeRange.selectNodeContents(checkText);\r\n                    beforeRange.setEnd(range.startContainer, range.startOffset);\r\n                    const beforeText = beforeRange.toString();\r\n                    const afterRange = range.cloneRange();\r\n                    afterRange.selectNodeContents(checkText);\r\n                    afterRange.setStart(range.endContainer, range.endOffset);\r\n                    const afterText = afterRange.toString();\r\n\r\n                    if (e.key === 'Backspace' && beforeText.length === 0) {\r\n                        e.preventDefault();\r\n                        console.log('[checkbox-editor] Backspace at start of checkbox row', {\r\n                            beforeText,\r\n                            afterText\r\n                        });\r\n                        // Capture siblings before removing the row\r\n                        let prev = row.previousSibling;\r\n                        let next = row.nextSibling;\r\n                        // Walk back to the previous element sibling (skip whitespace text nodes)\r\n                        while (prev && prev.nodeType !== 1) prev = prev.previousSibling;\r\n                        row.parentNode.removeChild(row);\r\n                        // remove an immediately following empty <div><br></div> if present\r\n                        if (next && next.nodeType === 1 && next.tagName.toLowerCase() === 'div' && next.innerHTML.trim() === '<br>') {\r\n                            next.parentNode.removeChild(next);\r\n                        }\r\n                        const newSel = window.getSelection();\r\n                        const r = document.createRange();\r\n                        let focusNode = null;\r\n                        // Prefer moving caret to the end of the previous checkbox row's text, if any\r\n                        let placed = false;\r\n                        if (prev && prev.classList && prev.classList.contains('checkbox-row')) {\r\n                            const prevText = prev.querySelector('.check-text');\r\n                            if (prevText) {\r\n                                if (!prevText.firstChild) prevText.appendChild(document.createTextNode(''));\r\n                                const textNode = prevText.firstChild.nodeType === 3 ? prevText.firstChild : prevText.firstChild;\r\n                                const pos = textNode.nodeType === 3 ? textNode.length : (prevText.textContent ? prevText.textContent.length : 0);\r\n                                try {\r\n                                    r.setStart(textNode, pos);\r\n                                } catch (e2) {\r\n                                    r.selectNodeContents(prevText);\r\n                                }\r\n                                r.collapse(false);\r\n                                placed = true;\r\n                                focusNode = prevText;\r\n                                console.log('[checkbox-editor] caret moved to previous checkbox row');\r\n                            }\r\n                        }\r\n                        if (!placed) {\r\n                            // Fallback: place caret at start of the next block (skipping non-elements) or end of editor\r\n                            while (next && next.nodeType !== 1) next = next.nextSibling;\r\n                            if (next && next.parentNode) {\r\n                                r.setStart(next, 0);\r\n                                r.collapse(true);\r\n                            } else {\r\n                                r.selectNodeContents(taskEditor);\r\n                                r.collapse(false);\r\n                            }\r\n                            console.log('[checkbox-editor] caret fallback placement', { hasNext: !!next });\r\n                        }\r\n                        newSel.removeAllRanges();\r\n                        newSel.addRange(r);\r\n                        // Focus the most relevant editable node so the browser doesn't move\r\n                        // the caret back to the top of the editor.\r\n                        if (focusNode && typeof focusNode.focus === 'function') {\r\n                            focusNode.focus();\r\n                        } else {\r\n                            taskEditor.focus();\r\n                        }\r\n                        // Log final caret location AFTER focus, to match what the user sees.\r\n                        {\r\n                            const anchor = newSel.anchorNode;\r\n                            console.log('[checkbox-editor] final caret location', {\r\n                                nodeType: anchor ? anchor.nodeType : null,\r\n                                tag: anchor && anchor.nodeType === 1 ? anchor.tagName : null,\r\n                                textSnippet: anchor && anchor.textContent ? anchor.textContent.slice(0, 30) : null,\r\n                                insideCheckboxRow: !!(anchor && anchor.parentElement && anchor.parentElement.closest('.checkbox-row'))\r\n                            });\r\n                        }\r\n                        taskEditor.dispatchEvent(new Event('input'));\r\n                        return;\r\n                    }\r\n\r\n                    if (e.key === 'Delete' && afterText.length === 0) {\r\n                        e.preventDefault();\r\n                        const next = row.nextSibling;\r\n                        row.parentNode.removeChild(row);\r\n                        if (next && next.nodeType === 1 && next.tagName.toLowerCase() === 'div' && next.innerHTML.trim() === '<br>') {\r\n                            next.parentNode.removeChild(next);\r\n                        }\r\n                        const newSel = window.getSelection();\r\n                        const r = document.createRange();\r\n                        if (next) {\r\n                            r.setStart(next, 0);\r\n                            r.collapse(true);\r\n                        } else {\r\n                            r.selectNodeContents(taskEditor);\r\n                            r.collapse(false);\r\n                        }\r\n                        newSel.removeAllRanges();\r\n                        newSel.addRange(r);\r\n                        taskEditor.focus();\r\n                        taskEditor.dispatchEvent(new Event('input'));\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        // Delegated click handler for checkbox toggles (non-destructive)\r\n        taskEditor.addEventListener('click', function (e) {\r\n            const btn = e.target.closest('.checkbox-toggle');\r\n            if (!btn) return;\r\n            // toggle state\r\n            const pressed = btn.getAttribute('aria-pressed') === 'true';\r\n            btn.setAttribute('aria-pressed', String(!pressed));\r\n            btn.classList.toggle('checked', !pressed);\r\n            // reflect accessible text (simple checkmark)\r\n            btn.innerText = !pressed ? '\u2714' : '';\r\n            taskEditor.dispatchEvent(new Event('input'));\r\n        });\r\n    }\r\n    // Enable clickable links inside the task description editor\r\n    const taskEditorForLinks = document.getElementById('task-description-editor');\r\n    if (taskEditorForLinks) {\r\n        taskEditorForLinks.addEventListener('click', function (e) {\r\n            const link = e.target.closest('a');\r\n            if (!link) return;\r\n            const href = link.getAttribute('href');\r\n            if (!href) return;\r\n            const sel = window.getSelection();\r\n            if (sel && sel.toString()) return;\r\n            e.preventDefault();\r\n            e.stopPropagation();\r\n            window.open(href, '_blank', 'noopener,noreferrer');\r\n        });\r\n    }\r\n\r\n    // Prevent Enter key in attachment fields from submitting form\r\n    const attachmentUrl = document.getElementById('attachment-url');\r\n    const attachmentName = document.getElementById('attachment-name');\r\n    \r\n    if (attachmentUrl) {\r\n        attachmentUrl.addEventListener('keydown', function(e) {\r\n            if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                addAttachment();\r\n            }\r\n        });\r\n    }\r\n    \r\n    if (attachmentName) {\r\n        attachmentName.addEventListener('keydown', function(e) {\r\n            if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                addAttachment();\r\n            }\r\n        });\r\n    }\r\n\r\n    // Attach toolbar checklist button\r\n    const checklistBtn = document.getElementById('checklist-btn');\r\n    if (checklistBtn) {\r\n        checklistBtn.addEventListener('click', function () {\r\n            const editor = document.getElementById('task-description-editor');\r\n            // If the caret is currently inside a .check-text, behave like Enter\r\n            const sel = window.getSelection();\r\n            const insideHandled = handleChecklistEnter(editor);\r\n            if (!insideHandled) {\r\n                // Not inside a checklist -> insert a new checkbox row\r\n                insertCheckbox();\r\n            }\r\n        });\r\n    }\r\n\r\n    // Tag input Enter key support\r\n    const tagInput = document.getElementById('tag-input');\r\n    if (tagInput) {\r\n        tagInput.addEventListener('keydown', function(e) {\r\n            if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                addTag();\r\n            }\r\n        });\r\n    }\r\n\r\n    // Existing feedback input code\r\n    const feedbackInput = document.getElementById('feedback-description');\r\n    if (feedbackInput) {\r\n        const desktopPlaceholder = feedbackInput.getAttribute('placeholder') || '';\r\n        const mobilePlaceholder = 'Describe the issue or idea.';\r\n        const resolveIsMobile = () => {\r\n            if (typeof window.matchMedia === 'function') {\r\n                return window.matchMedia('(max-width: 768px)').matches;\r\n            }\r\n            return getIsMobileCached();\r\n        };\r\n        const applyFeedbackPlaceholder = () => {\r\n            feedbackInput.placeholder = resolveIsMobile() ? mobilePlaceholder : desktopPlaceholder;\r\n        };\r\n\r\n        applyFeedbackPlaceholder();\r\n        if (typeof window.matchMedia === 'function') {\r\n            const mq = window.matchMedia('(max-width: 768px)');\r\n            if (typeof mq.addEventListener === 'function') mq.addEventListener('change', applyFeedbackPlaceholder);\r\n            else if (typeof mq.addListener === 'function') mq.addListener(applyFeedbackPlaceholder);\r\n        }\r\n\r\n        feedbackInput.addEventListener('keypress', function(e) {\r\n            if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                addFeedbackItem();\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\n\r\nfunction loadCalendarState() {\r\n    const today = new Date();\r\n    const currentMonth = today.getMonth();\r\n    const currentYear = today.getFullYear();\r\n\r\n    return { currentMonth, currentYear };\r\n}\r\n\r\nconst calendarState = loadCalendarState();\r\nlet currentMonth = calendarState.currentMonth;\r\nlet currentYear = calendarState.currentYear;\r\n\r\n// Save calendar state to localStorage\r\nfunction saveCalendarState() {\r\nlocalStorage.setItem('calendarMonth', currentMonth.toString());\r\n    localStorage.setItem('calendarYear', currentYear.toString());\r\n}\r\n\r\n// capitalizeFirst, getCalendarDayNames, formatCalendarMonthYear imported from src/utils/string.js and src/utils/date.js\r\n\r\nfunction renderCalendar() {\r\n    const renderTimer = debugTimeStart(\"render\", \"calendar\", {\r\n        taskCount: tasks.length,\r\n        month: currentMonth + 1,\r\n        year: currentYear\r\n    });\r\n    const locale = getLocale();\r\n    const dayNames = getCalendarDayNames(locale);\r\n    const today = new Date();\r\n\r\n    // Update month/year display\r\n    document.getElementById(\"calendar-month-year\").textContent =\r\n        formatCalendarMonthYear(locale, currentYear, currentMonth);\r\n\r\n    // Get filtered project IDs\r\n    const filteredProjectIds = filterState.projects.size > 0\r\n        ? new Set(Array.from(filterState.projects).map(id => parseInt(id, 10)))\r\n        : null;\r\n\r\n    // Use module to prepare calendar data\r\n    const calendarData = prepareCalendarData(currentYear, currentMonth, {\r\n        tasks: tasks,\r\n        projects: projects,\r\n        filteredProjectIds: filteredProjectIds,\r\n        includeBacklog: !!settings.calendarIncludeBacklog,\r\n        today: today\r\n    });\r\n\r\n    const isCurrentMonthNow = calendarData.isCurrentMonth;\r\n\r\n    // UX: only show \"Today\" button when user has left the current month (mobile + desktop)\r\n    try {\r\n        const isMobile = typeof window.matchMedia === 'function'\r\n            ? window.matchMedia('(max-width: 768px)').matches\r\n            : getIsMobileCached();\r\n\r\n        // Mobile: header button\r\n        if (isMobile) {\r\n            document.querySelectorAll('.calendar-today-btn--header').forEach((btn) => {\r\n                btn.style.display = isCurrentMonthNow ? 'none' : 'inline-flex';\r\n            });\r\n        }\r\n\r\n        // Desktop: nav button\r\n        if (!isMobile) {\r\n            document.querySelectorAll('.calendar-today-btn--nav').forEach((btn) => {\r\n                btn.style.display = isCurrentMonthNow ? 'none' : 'inline-flex';\r\n            });\r\n        }\r\n    } catch (e) {}\r\n\r\n    // Use module function for HTML generation\r\n    const calendarHTML = generateCalendarGridHTML(calendarData, dayNames);\r\n\r\n    document.getElementById(\"calendar-grid\").innerHTML = calendarHTML;\r\n    const overlay = document.getElementById('project-overlay');\r\n    if (overlay) overlay.style.opacity = '0';\r\n    // Use double-RAF to wait for layout/paint before measuring positions\r\n    requestAnimationFrame(() => {\r\nrequestAnimationFrame(() => {\r\nrenderProjectBars();\r\n            // renderProjectBars handles showing the overlay\r\n        });\r\n    });\r\n}\r\n\r\n// Track retry attempts to prevent infinite loops\r\nlet renderProjectBarsRetries = 0;\r\nconst MAX_RENDER_RETRIES = 20; // Max 1 second of retries (20 * 50ms)\r\n\r\nfunction renderProjectBars() {\r\n    const renderTimer = debugTimeStart(\"render\", \"projectBars\", {\r\n        taskCount: tasks.length,\r\n        projectCount: projects.length\r\n    });\r\n    try {\r\nconst overlay = document.getElementById(\"project-overlay\");\r\n        if (!overlay) {\r\n            console.error('[ProjectBars] No overlay element found!');\r\n            renderProjectBarsRetries = 0;\r\n            return;\r\n        }\r\n\r\n    // Completely clear overlay\r\noverlay.innerHTML = \"\";\r\n    overlay.style.opacity = '0';\r\n\r\n    const calendarGrid = document.getElementById(\"calendar-grid\");\r\n    if (!calendarGrid) {\r\n        console.error('[ProjectBars] No calendar grid found!');\r\n        renderProjectBarsRetries = 0;\r\n        return;\r\n    }\r\n\r\n    // Check if calendar view is actually visible. Treat \"preparing\" like active so the\r\n    // calendar can finish its initial render before we flip it on-screen.\r\n    const calendarView = document.getElementById(\"calendar-view\");\r\n    const calendarVisible = calendarView && (\r\n        calendarView.classList.contains('active') ||\r\n        calendarView.classList.contains('preparing')\r\n    );\r\n    if (!calendarVisible) {\r\nrenderProjectBarsRetries = 0;\r\n        return;\r\n    }\r\n\r\n    // Force multiple reflows to ensure layout is fully calculated\r\n    const h = calendarGrid.offsetHeight;\r\n    const w = calendarGrid.offsetWidth;\r\n// Force another reflow after a tick\r\n    const allDayElements = Array.from(\r\n        calendarGrid.querySelectorAll(\".calendar-day\")\r\n    );\r\nif (allDayElements.length === 0) {\r\n        if (renderProjectBarsRetries < MAX_RENDER_RETRIES) {\r\n            console.warn('[ProjectBars] No day elements found, retrying in 100ms...');\r\n            renderProjectBarsRetries++;\r\n            setTimeout(renderProjectBars, 100);\r\n            return;\r\n        } else {\r\n            console.error('[ProjectBars] Max retries reached, giving up');\r\n            renderProjectBarsRetries = 0;\r\n            return;\r\n        }\r\n    }\r\n\r\n    // Validate that elements have actual dimensions\r\n    const firstDayRect = allDayElements[0].getBoundingClientRect();\r\nif (firstDayRect.width === 0 || firstDayRect.height === 0) {\r\n        if (renderProjectBarsRetries < MAX_RENDER_RETRIES) {\r\n            console.warn('[ProjectBars] Elements not ready (zero dimensions), retrying in 50ms...', { firstDayRect });\r\n            renderProjectBarsRetries++;\r\n            setTimeout(renderProjectBars, 50);\r\n            return;\r\n        } else {\r\n            console.error('[ProjectBars] Max retries reached, giving up');\r\n            renderProjectBarsRetries = 0;\r\n            return;\r\n        }\r\n    }\r\n\r\n    // Reset retry counter on success\r\n    renderProjectBarsRetries = 0;\r\n\r\n    const currentMonthDays = allDayElements\r\n        .map((el, index) => ({\r\n            element: el,\r\n            index,\r\n            gridIndex: index, // Original index in 42-cell grid\r\n            day: parseInt(el.querySelector(\".calendar-day-number\").textContent),\r\n            isOtherMonth: el.classList.contains(\"other-month\"),\r\n        }))\r\n        .filter((item) => !item.isOtherMonth);\r\n\r\n    // Get filtered project IDs\r\n    const filteredProjectIds = filterState.projects.size > 0 \r\n        ? Array.from(filterState.projects).map(id => parseInt(id, 10))\r\n        : projects.map(p => p.id);\r\n\r\n    // Only render filtered projects\r\n    const filteredProjects = projects.filter(p => filteredProjectIds.includes(p.id));\r\n\r\n    // Stable ordering so stacking doesn't change across week rows\r\n    const projectRank = new Map();\r\n    filteredProjects\r\n        .slice()\r\n        .sort((a, b) => {\r\n            const aStart = a.startDate || '';\r\n            const bStart = b.startDate || '';\r\n            if (aStart !== bStart) return aStart.localeCompare(bStart);\r\n            const aEnd = (a.endDate || a.startDate || '');\r\n            const bEnd = (b.endDate || b.startDate || '');\r\n            if (aEnd !== bEnd) return aEnd.localeCompare(bEnd);\r\n            const aName = (a.name || '').toLowerCase();\r\n            const bName = (b.name || '').toLowerCase();\r\n            if (aName !== bName) return aName.localeCompare(bName);\r\n            return (a.id || 0) - (b.id || 0);\r\n        })\r\n        .forEach((p, idx) => projectRank.set(p.id, idx));\r\n\r\n    // Get first and last day of current month (for chevron detection)\r\n    const firstDayOfMonthIndex = currentMonthDays.length > 0 ? currentMonthDays[0].gridIndex : -1;\r\n    const lastDayOfMonthIndex = currentMonthDays.length > 0 ? currentMonthDays[currentMonthDays.length - 1].gridIndex : -1;\r\n\r\n    // Prepare per-row segments map for packing (both projects and tasks)\r\n    const projectSegmentsByRow = new Map(); // rowIndex -> [ { startIndex, endIndex, project } ]\r\n    const taskSegmentsByRow = new Map(); // rowIndex -> [ { startIndex, endIndex, task } ]\r\n\r\n    // Process projects\r\n    filteredProjects.forEach((project) => {\r\n        const [startYear, startMonth, startDay] = project.startDate\r\n            .split(\"-\")\r\n            .map((n) => parseInt(n));\r\n        const startDate = new Date(startYear, startMonth - 1, startDay); // month is 0-based\r\n\r\n        const [endYear, endMonth, endDay] = (\r\n            project.endDate || project.startDate\r\n        )\r\n            .split(\"-\")\r\n            .map((n) => parseInt(n));\r\n        const endDate = new Date(endYear, endMonth - 1, endDay);\r\n        const monthStart = new Date(currentYear, currentMonth, 1);\r\n        const monthEnd = new Date(currentYear, currentMonth + 1, 0);\r\n\r\n        if (startDate <= monthEnd && endDate >= monthStart) {\r\n            const calStartDate =\r\n                startDate < monthStart ? monthStart : startDate;\r\n            const calEndDate = endDate > monthEnd ? monthEnd : endDate;\r\n\r\n            const startDay = calStartDate.getDate();\r\n            const endDay = calEndDate.getDate();\r\n\r\n            // Find the correct day elements using our mapped array\r\n            const startDayInfo = currentMonthDays.find((d) => d.day === startDay);\r\n            const endDayInfo = currentMonthDays.find((d) => d.day === endDay);\r\n\r\n            if (!startDayInfo || !endDayInfo) return;\r\n\r\n            const startIndex = startDayInfo.gridIndex;\r\n            const endIndex = endDayInfo.gridIndex;\r\n\r\n            // Split into week row segments and store for later packing\r\n            let cursor = startIndex;\r\n            while (cursor <= endIndex) {\r\n                const rowStart = Math.floor(cursor / 7) * 7;\r\n                const rowEnd = Math.min(rowStart + 6, endIndex);\r\n                const segStart = Math.max(cursor, rowStart);\r\n                const segEnd = rowEnd;\r\n                const row = Math.floor(segStart / 7);\r\n                if (!projectSegmentsByRow.has(row)) projectSegmentsByRow.set(row, []);\r\n                projectSegmentsByRow.get(row).push({ startIndex: segStart, endIndex: segEnd, project });\r\n                cursor = rowEnd + 1;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Process tasks with endDate or startDate\r\n    // Show tasks that have endDate OR startDate (at least one date must exist)\r\n    const cutoff = getKanbanUpdatedCutoffTime(window.kanbanUpdatedFilter);\r\n    const baseTasks = typeof getFilteredTasks === 'function' ? getFilteredTasks() : tasks.slice();\r\n    const updatedFilteredTasks = cutoff === null\r\n        ? baseTasks\r\n        : baseTasks.filter((t) => getTaskUpdatedTime(t) >= cutoff);\r\n\r\n    // Filter out backlog tasks if setting is disabled\r\n    const includeBacklog = !!settings.calendarIncludeBacklog;\r\n    const tasksToShow = includeBacklog\r\n        ? updatedFilteredTasks\r\n        : updatedFilteredTasks.filter((task) => task.status !== 'backlog');\r\n\r\n    const filteredTasks = tasksToShow.filter(task => {\r\n        // Must have at least one valid date (startDate or endDate)\r\n        const hasEndDate = task.endDate && task.endDate.length === 10 && task.endDate.includes('-');\r\n        const hasStartDate = task.startDate && task.startDate.length === 10 && task.startDate.includes('-');\r\n        return hasEndDate || hasStartDate;\r\n    });\r\n\r\n    const taskRank = new Map();\r\n    const taskStartKey = (t) =>\r\n        (t.startDate && t.startDate.length === 10 && t.startDate.includes('-')) ? t.startDate : (t.endDate || '');\r\n    filteredTasks\r\n        .slice()\r\n        .sort((a, b) => {\r\n            const as = taskStartKey(a);\r\n            const bs = taskStartKey(b);\r\n            if (as !== bs) return as.localeCompare(bs);\r\n            const ae = a.endDate || '';\r\n            const be = b.endDate || '';\r\n            if (ae !== be) return ae.localeCompare(be);\r\n            const at = (a.title || '').toLowerCase();\r\n            const bt = (b.title || '').toLowerCase();\r\n            if (at !== bt) return at.localeCompare(bt);\r\n            return (a.id || 0) - (b.id || 0);\r\n        })\r\n        .forEach((t, idx) => taskRank.set(t.id, idx));\r\n\r\n    filteredTasks.forEach((task) => {\r\n        // Handle tasks with different date configurations\r\n        // Tasks can have: both dates, only startDate, or only endDate\r\n        let startDate, endDate;\r\n        const hasValidStartDate = task.startDate && task.startDate.length === 10 && task.startDate.includes('-');\r\n        const hasValidEndDate = task.endDate && task.endDate.length === 10 && task.endDate.includes('-');\r\n\r\n        // Determine startDate\r\n        if (hasValidStartDate) {\r\n            const [startYear, startMonth, startDay] = task.startDate\r\n                .split(\"-\")\r\n                .map((n) => parseInt(n));\r\n            startDate = new Date(startYear, startMonth - 1, startDay);\r\n        } else if (hasValidEndDate) {\r\n            // No valid startDate: use endDate as startDate for single-day bar\r\n            const [endYear, endMonth, endDay] = task.endDate\r\n                .split(\"-\")\r\n                .map((n) => parseInt(n));\r\n            startDate = new Date(endYear, endMonth - 1, endDay);\r\n        } else {\r\n            // No valid dates - skip this task\r\n            return;\r\n        }\r\n\r\n        // Determine endDate\r\n        if (hasValidEndDate) {\r\n            const [endYear, endMonth, endDay] = task.endDate\r\n                .split(\"-\")\r\n                .map((n) => parseInt(n));\r\n            endDate = new Date(endYear, endMonth - 1, endDay);\r\n        } else if (hasValidStartDate) {\r\n            // No valid endDate: use startDate as endDate for single-day bar\r\n            endDate = startDate;\r\n        } else {\r\n            // No valid dates - skip this task\r\n            return;\r\n        }\r\n        const monthStart = new Date(currentYear, currentMonth, 1);\r\n        const monthEnd = new Date(currentYear, currentMonth + 1, 0);\r\n\r\n        if (startDate <= monthEnd && endDate >= monthStart) {\r\n            const calStartDate =\r\n                startDate < monthStart ? monthStart : startDate;\r\n            const calEndDate = endDate > monthEnd ? monthEnd : endDate;\r\n\r\n            const startDay = calStartDate.getDate();\r\n            const endDay = calEndDate.getDate();\r\n\r\n            const startDayInfo = currentMonthDays.find((d) => d.day === startDay);\r\n            const endDayInfo = currentMonthDays.find((d) => d.day === endDay);\r\n\r\n            if (!startDayInfo || !endDayInfo) return;\r\n\r\n            const startIndex = startDayInfo.gridIndex;\r\n            const endIndex = endDayInfo.gridIndex;\r\n\r\n            // Split into week row segments\r\n            let cursor = startIndex;\r\n            while (cursor <= endIndex) {\r\n                const rowStart = Math.floor(cursor / 7) * 7;\r\n                const rowEnd = Math.min(rowStart + 6, endIndex);\r\n                const segStart = Math.max(cursor, rowStart);\r\n                const segEnd = rowEnd;\r\n                const row = Math.floor(segStart / 7);\r\n                if (!taskSegmentsByRow.has(row)) taskSegmentsByRow.set(row, []);\r\n                taskSegmentsByRow.get(row).push({ startIndex: segStart, endIndex: segEnd, task });\r\n                cursor = rowEnd + 1;\r\n            }\r\n        }\r\n    });\r\n\r\n    // Layout constants (vertical measurement anchored to the project-spacer for consistency across views)\r\n    const projectHeight = 18;\r\n    const projectSpacing = 3;\r\n    const taskHeight = 20;\r\n    const taskSpacing = 4;\r\n\r\n    // Force one more reflow before critical measurements\r\n    const h2 = calendarGrid.offsetHeight;\r\n// For each row, pack segments into tracks and render, then set spacer heights\r\n    const gridRect = calendarGrid.getBoundingClientRect();\r\nconst rowMaxTracks = new Map();\r\n\r\n    // Render project bars\r\n    projectSegmentsByRow.forEach((segments, row) => {\r\n        // Sort by stable rank so stacking order doesn't vary by week\r\n        segments.sort((a, b) =>\r\n            (projectRank.get(a.project.id) ?? 0) - (projectRank.get(b.project.id) ?? 0) ||\r\n            a.startIndex - b.startIndex ||\r\n            a.endIndex - b.endIndex\r\n        );\r\n        const trackEnds = []; // endIndex per track\r\n        // Assign track for each segment\r\n        segments.forEach(seg => {\r\n            let track = trackEnds.findIndex(end => seg.startIndex > end);\r\n            if (track === -1) {\r\n                track = trackEnds.length;\r\n                trackEnds.push(seg.endIndex);\r\n            } else {\r\n                trackEnds[track] = seg.endIndex;\r\n            }\r\n            seg.track = track; // annotate\r\n        });\r\n\r\n        // Render segments with computed track positions\r\n        segments.forEach(seg => {\r\n            const startEl = allDayElements[seg.startIndex];\r\n            const endEl = allDayElements[seg.endIndex];\r\n            if (!startEl || !endEl) return;\r\n            const startRect = startEl.getBoundingClientRect();\r\n            const endRect = endEl.getBoundingClientRect();\r\n\r\n            const bar = document.createElement(\"div\");\r\n            bar.className = \"project-bar\";\r\n            if (getProjectStatus(seg.project.id) === 'completed') {\r\n                bar.classList.add('completed');\r\n            }\r\n            bar.style.position = \"absolute\";\r\n            const inset = 6; // match visual padding from cell edges\r\n            let left = (startRect.left - gridRect.left) + inset;\r\n            let width = (endRect.right - startRect.left) - (inset * 2);\r\n            // Clamp within grid bounds to avoid overflow in embedded contexts\r\n            if (left < 0) {\r\n                width += left;\r\n                left = 0;\r\n            }\r\n            if (left + width > gridRect.width) {\r\n                width = Math.max(0, gridRect.width - left);\r\n            }\r\n            width = Math.max(0, width);\r\n            bar.style.left = left + \"px\";\r\n            bar.style.width = width + \"px\";\r\n\r\n            // Anchor to the project-spacer inside the day cell rather than hardcoded offsets\r\n            const spacerEl = startEl.querySelector('.project-spacer');\r\n            const anchorTop = (spacerEl ? spacerEl.getBoundingClientRect().top : startRect.top) - gridRect.top;\r\n            bar.style.top = (anchorTop + (seg.track * (projectHeight + projectSpacing))) + \"px\";\r\n            bar.style.height = projectHeight + \"px\";\r\n\r\n            const projectColor = getProjectColor(seg.project.id);\r\n            bar.style.background = `linear-gradient(90deg, ${projectColor}, ${projectColor}dd)`;\r\n            bar.style.textShadow = \"0 1px 2px rgba(0,0,0,0.3)\";\r\n            bar.style.fontWeight = \"600\";\r\n            bar.style.color = \"white\";\r\n            bar.style.padding = \"1px 6px\";\r\n            bar.style.fontSize = \"10px\";\r\n            bar.style.display = \"flex\";\r\n            bar.style.alignItems = \"center\";\r\n            bar.style.boxShadow = \"0 1px 3px rgba(0,0,0,0.2)\";\r\n            bar.style.pointerEvents = \"auto\";\r\n            bar.style.cursor = \"pointer\";\r\n            bar.style.zIndex = \"10\";\r\n            bar.style.whiteSpace = \"nowrap\";\r\n            bar.style.overflow = \"hidden\";\r\n            bar.style.textOverflow = \"ellipsis\";\r\n\r\n            // Check if project extends beyond visible month - use string comparison for reliability\r\n            const monthStartStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-01`;\r\n            const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0).getDate();\r\n            const monthEndStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(lastDayOfMonth).padStart(2, '0')}`;\r\n\r\n            const projectStartStr = seg.project.startDate;\r\n            const projectEndStr = seg.project.endDate || seg.project.startDate;\r\n\r\n            // ONLY show chevron at month boundaries, NOT between weeks\r\n            const continuesLeft = projectStartStr < monthStartStr && seg.startIndex === firstDayOfMonthIndex;\r\n            const continuesRight = projectEndStr > monthEndStr && seg.endIndex === lastDayOfMonthIndex;\r\n\r\n            // Add classes for arrow indicators ONLY at month boundaries\r\n            if (continuesLeft) bar.classList.add('continues-left');\r\n            if (continuesRight) bar.classList.add('continues-right');\r\n\r\n            // Adjust border-radius based on continuation\r\n            bar.style.borderTopLeftRadius = continuesLeft ? \"0\" : \"6px\";\r\n            bar.style.borderBottomLeftRadius = continuesLeft ? \"0\" : \"6px\";\r\n            bar.style.borderTopRightRadius = continuesRight ? \"0\" : \"6px\";\r\n            bar.style.borderBottomRightRadius = continuesRight ? \"0\" : \"6px\";\r\n            bar.textContent = seg.project.name;\r\n\r\n            bar.onclick = (e) => {\r\n                e.stopPropagation();\r\n                showProjectDetails(seg.project.id, 'calendar', { month: currentMonth, year: currentYear });\r\n            };\r\n\r\n            overlay.appendChild(bar);\r\n        });\r\n\r\n        // Record max tracks for row (projects only for now)\r\n        if (!rowMaxTracks.has(row)) {\r\n            rowMaxTracks.set(row, { projectTracks: 0, taskTracks: 0 });\r\n        }\r\n        rowMaxTracks.get(row).projectTracks = trackEnds.length;\r\n    });\r\n\r\n    // Render task bars (below project bars)\r\n    taskSegmentsByRow.forEach((segments, row) => {\r\n        // Sort by stable rank so stacking order doesn't vary by week\r\n        segments.sort((a, b) =>\r\n            (taskRank.get(a.task.id) ?? 0) - (taskRank.get(b.task.id) ?? 0) ||\r\n            a.startIndex - b.startIndex ||\r\n            a.endIndex - b.endIndex\r\n        );\r\n        const trackEnds = []; // endIndex per track\r\n        // Assign track for each segment\r\n        segments.forEach(seg => {\r\n            let track = trackEnds.findIndex(end => seg.startIndex > end);\r\n            if (track === -1) {\r\n                track = trackEnds.length;\r\n                trackEnds.push(seg.endIndex);\r\n            } else {\r\n                trackEnds[track] = seg.endIndex;\r\n            }\r\n            seg.track = track; // annotate\r\n        });\r\n\r\n        // Render segments with computed track positions\r\n        segments.forEach(seg => {\r\n            // Determine date configuration early\r\n            const hasValidStartDate = seg.task.startDate && seg.task.startDate.length === 10 && seg.task.startDate.includes('-');\r\n            const hasValidEndDate = seg.task.endDate && seg.task.endDate.length === 10 && seg.task.endDate.includes('-');\r\n            \r\n            const startEl = allDayElements[seg.startIndex];\r\n            const endEl = allDayElements[seg.endIndex];\r\n            if (!startEl || !endEl) return;\r\n            const startRect = startEl.getBoundingClientRect();\r\n            const endRect = endEl.getBoundingClientRect();\r\n\r\n            const bar = document.createElement(\"div\");\r\n            bar.className = \"task-bar\";\r\n            if (seg.task.status === 'done') {\r\n                bar.classList.add('done');\r\n            }\r\n            bar.style.position = \"absolute\";\r\n            const inset = 6; // match visual padding from cell edges\r\n            let left = (startRect.left - gridRect.left) + inset;\r\n            let width = (endRect.right - startRect.left) - (inset * 2);\r\n            // Clamp within grid bounds\r\n            if (left < 0) {\r\n                width += left;\r\n                left = 0;\r\n            }\r\n            if (left + width > gridRect.width) {\r\n                width = Math.max(0, gridRect.width - left);\r\n            }\r\n            width = Math.max(0, width);\r\n            bar.style.left = left + \"px\";\r\n            bar.style.width = width + \"px\";\r\n\r\n            // Anchor to the project-spacer, offset by project bars height\r\n            const spacerEl = startEl.querySelector('.project-spacer');\r\n            const anchorTop = (spacerEl ? spacerEl.getBoundingClientRect().top : startRect.top) - gridRect.top;\r\n            const projectTracksCount = rowMaxTracks.get(row)?.projectTracks || 0;\r\n            const projectsHeight = projectTracksCount * (projectHeight + projectSpacing);\r\n            const gapBetweenProjectsAndTasks = projectTracksCount > 0 ? 6 : 0; // Add 6px gap if there are projects\r\n            bar.style.top = (anchorTop + projectsHeight + gapBetweenProjectsAndTasks + (seg.track * (taskHeight + taskSpacing))) + \"px\";\r\n            bar.style.height = taskHeight + \"px\";\r\n\r\n            // Task color based on priority - for left border and text\r\n            const borderColor = PRIORITY_COLORS[seg.task.priority] || \"var(--accent-blue)\"; // Default blue\r\n\r\n            // Apply left/right borders based on date configuration\r\n            // Only startDate: strong left border\r\n            // Only endDate: strong right border\r\n            // Both dates: strong left and right borders\r\n            if (hasValidStartDate) {\r\n                bar.style.borderLeftWidth = \"5px\";\r\n                bar.style.borderLeftColor = borderColor;\r\n            } else {\r\n                bar.style.borderLeftWidth = \"1px\";\r\n            }\r\n            \r\n            if (hasValidEndDate) {\r\n                bar.style.borderRightWidth = \"5px\";\r\n                bar.style.borderRightColor = borderColor;\r\n            } else {\r\n                bar.style.borderRightWidth = \"1px\";\r\n            }\r\n            \r\n            bar.style.color = \"var(--text-primary)\";\r\n            bar.style.padding = \"2px 6px\";\r\n            bar.style.fontSize = \"11px\";\r\n            bar.style.fontWeight = \"500\";\r\n            bar.style.display = \"flex\";\r\n            bar.style.alignItems = \"center\";\r\n            bar.style.boxShadow = \"var(--shadow-sm)\";\r\n            bar.style.pointerEvents = \"auto\";\r\n            bar.style.cursor = \"pointer\";\r\n            bar.style.zIndex = \"11\"; // Above project bars\r\n            bar.style.whiteSpace = \"nowrap\";\r\n            bar.style.overflow = \"hidden\";\r\n            bar.style.textOverflow = \"ellipsis\";\r\n\r\n            // Check if task extends beyond visible month - use string comparison for reliability\r\n            const monthStartStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-01`;\r\n            const lastDayOfMonth = new Date(currentYear, currentMonth + 1, 0).getDate();\r\n            const monthEndStr = `${currentYear}-${String(currentMonth + 1).padStart(2, '0')}-${String(lastDayOfMonth).padStart(2, '0')}`;\r\n\r\n            // Determine actual task start and end date strings\r\n            const taskStartStr = hasValidStartDate ? seg.task.startDate : seg.task.endDate;\r\n            const taskEndStr = hasValidEndDate ? seg.task.endDate : seg.task.startDate;\r\n\r\n            // ONLY show chevron at month boundaries, NOT between weeks\r\n            const continuesLeft = taskStartStr < monthStartStr && seg.startIndex === firstDayOfMonthIndex;\r\n            const continuesRight = taskEndStr > monthEndStr && seg.endIndex === lastDayOfMonthIndex;\r\n\r\n            // Add classes for arrow indicators ONLY at month boundaries\r\n            if (continuesLeft) bar.classList.add('continues-left');\r\n            if (continuesRight) bar.classList.add('continues-right');\r\n            \r\n            // Add classes for date configuration styling\r\n            if (hasValidStartDate) bar.classList.add('has-start-date');\r\n            if (hasValidEndDate) bar.classList.add('has-end-date');\r\n\r\n            // Adjust border-radius based on continuation\r\n            bar.style.borderTopLeftRadius = continuesLeft ? \"0\" : \"4px\";\r\n            bar.style.borderBottomLeftRadius = continuesLeft ? \"0\" : \"4px\";\r\n            bar.style.borderTopRightRadius = continuesRight ? \"0\" : \"4px\";\r\n            bar.style.borderBottomRightRadius = continuesRight ? \"0\" : \"4px\";\r\n            bar.textContent = seg.task.title;\r\n\r\n            bar.onclick = (e) => {\r\n                e.stopPropagation();\r\n                openTaskDetails(seg.task.id);\r\n            };\r\n\r\n            overlay.appendChild(bar);\r\n        });\r\n\r\n        // Record max tracks for row (tasks)\r\n        if (!rowMaxTracks.has(row)) {\r\n            rowMaxTracks.set(row, { projectTracks: 0, taskTracks: 0 });\r\n        }\r\n        rowMaxTracks.get(row).taskTracks = trackEnds.length;\r\n    });\r\n\r\n    // Set spacer height per row so inline tasks start below project and task bars\r\n    const spacers = calendarGrid.querySelectorAll('.calendar-day .project-spacer');\r\n    const spacerByRow = new Map();\r\n    spacers.forEach(sp => {\r\n        const row = parseInt(sp.closest('.calendar-day').dataset.row, 10);\r\n        const trackInfo = rowMaxTracks.get(row) || { projectTracks: 0, taskTracks: 0 };\r\n        const projectTracksHeight = trackInfo.projectTracks > 0 ? (trackInfo.projectTracks * (projectHeight + projectSpacing)) : 0;\r\n        const taskTracksHeight = trackInfo.taskTracks > 0 ? (trackInfo.taskTracks * (taskHeight + taskSpacing)) : 0;\r\n        const gapBetweenProjectsAndTasks = (trackInfo.projectTracks > 0 && trackInfo.taskTracks > 0) ? 6 : 0;\r\n        const reserved = projectTracksHeight + taskTracksHeight + gapBetweenProjectsAndTasks + (trackInfo.projectTracks > 0 || trackInfo.taskTracks > 0 ? 4 : 0);\r\n        sp.style.height = reserved + 'px';\r\n        spacerByRow.set(row, reserved);\r\n    });\r\n\r\n        // Show overlay after rendering complete\r\noverlay.style.opacity = '1';\r\n    } catch (error) {\r\n        console.error('[ProjectBars] Error rendering project/task bars:', error);\r\n        // Don't let rendering errors break the app\r\n    }\r\n    debugTimeEnd(\"render\", renderTimer, {\r\n        taskCount: tasks.length,\r\n        projectCount: projects.length\r\n    });\r\n}\r\n\r\nfunction animateCalendarMonthChange(delta) {\r\n    changeMonth(delta);\r\n}\r\n\r\nfunction setupCalendarSwipeNavigation() {\r\n    const stage = document.querySelector('.calendar-stage');\r\n    if (!stage || stage.dataset.swipeReady === 'true') return;\r\n    stage.dataset.swipeReady = 'true';\r\n\r\n    let startX = 0;\r\n    let startY = 0;\r\n    let tracking = false;\r\n    let swiping = false;\r\n\r\n    stage.addEventListener('touchstart', (e) => {\r\n        if (e.touches.length !== 1) return;\r\n        const touch = e.touches[0];\r\n        startX = touch.clientX;\r\n        startY = touch.clientY;\r\n        tracking = true;\r\n        swiping = false;\r\n    }, { passive: true });\r\n\r\n    stage.addEventListener('touchmove', (e) => {\r\n        if (!tracking) return;\r\n        const touch = e.touches[0];\r\n        const dx = touch.clientX - startX;\r\n        const dy = touch.clientY - startY;\r\n\r\n        if (!swiping) {\r\n            if (Math.abs(dx) > 12 && Math.abs(dx) > Math.abs(dy)) {\r\n                swiping = true;\r\n            } else if (Math.abs(dy) > 12) {\r\n                tracking = false;\r\n            }\r\n        }\r\n\r\n        if (swiping) {\r\n            e.preventDefault();\r\n        }\r\n    }, { passive: false });\r\n\r\n    stage.addEventListener('touchend', (e) => {\r\n        if (!tracking) return;\r\n        tracking = false;\r\n        if (!swiping) return;\r\n\r\n        const touch = e.changedTouches[0];\r\n        const dx = touch.clientX - startX;\r\n        const dy = touch.clientY - startY;\r\n\r\n        if (Math.abs(dx) < 50 || Math.abs(dx) < Math.abs(dy)) return;\r\n\r\n        const delta = dx < 0 ? 1 : -1;\r\n        animateCalendarMonthChange(delta);\r\n    }, { passive: true });\r\n\r\n    stage.addEventListener('touchcancel', () => {\r\n        tracking = false;\r\n        swiping = false;\r\n    }, { passive: true });\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    setupCalendarSwipeNavigation();\r\n});\r\n\r\nfunction changeMonth(delta) {\r\n    // Use calendar module for month navigation calculation\r\n    const nav = calculateMonthNavigation(currentYear, currentMonth, delta);\r\n    currentYear = nav.year;\r\n    currentMonth = nav.month;\r\nsaveCalendarState();\r\n    renderCalendar();\r\n\r\n    // Same calendar fix as task deletion/creation (ensure proper refresh)\r\n    // This double-render is CRITICAL - it allows layout to settle between renders\r\n    const calendarView = document.getElementById(\"calendar-view\");\r\n    if (calendarView) {\r\nrenderCalendar();\r\n    }\r\n}\r\n\r\nfunction goToToday() {\r\n    const today = new Date();\r\n    currentMonth = today.getMonth();\r\n    currentYear = today.getFullYear();\r\n    saveCalendarState();\r\n    renderCalendar();\r\n\r\n    // Same calendar fix as task deletion/creation (ensure proper refresh)\r\n    const calendarView = document.getElementById(\"calendar-view\");\r\n    if (calendarView) {\r\n        renderCalendar();\r\n    }\r\n}\r\n\r\nfunction getProjectStatus(projectId) {\r\n    const projectTasks = tasks.filter(t => t.projectId === projectId);\r\n\r\n    if (projectTasks.length === 0) {\r\n        return \"planning\";\r\n    }\r\n\r\n    const allDone = projectTasks.every(t => t.status === \"done\");\r\n    const hasInProgress = projectTasks.some(t => t.status === \"progress\" || t.status === \"review\");\r\n    const hasTodo = projectTasks.some(t => t.status === \"todo\");\r\n    const allBacklog = projectTasks.every(t => t.status === \"backlog\");\r\n\r\n    if (allDone) {\r\n        return \"completed\";\r\n    } else if (hasInProgress) {\r\n        return \"active\";\r\n    }\r\n\r\n    if (hasTodo) {\r\n        return \"planning\";\r\n    }\r\n\r\n    if (allBacklog) {\r\n        return \"backlog\";\r\n    }\r\n\r\n    // Mixed backlog/done without in-progress/review still counts as planning\r\n    return \"planning\";\r\n}\r\n\r\nfunction showDayTasks(dateStr) {\r\n    const cutoff = getKanbanUpdatedCutoffTime(window.kanbanUpdatedFilter);\r\n    const baseTasks = typeof getFilteredTasks === 'function' ? getFilteredTasks() : tasks.slice();\r\n    const updatedFilteredTasks = cutoff === null\r\n        ? baseTasks\r\n        : baseTasks.filter((t) => getTaskUpdatedTime(t) >= cutoff);\r\n\r\n    // Show tasks that either end on this date OR span across this date\r\n    let dayTasks = updatedFilteredTasks.filter((task) => {\r\n        if (task.startDate && task.endDate) {\r\n            // Task with date range - check if it overlaps this day\r\n            return dateStr >= task.startDate && dateStr <= task.endDate;\r\n        } else if (task.endDate) {\r\n            // Task with only end date - show on end date\r\n            return task.endDate === dateStr;\r\n        } else if (task.startDate) {\r\n            // Task with only start date - show on start date\r\n            return task.startDate === dateStr;\r\n        }\r\n        return false;\r\n    });\r\n\r\n    // Filter out backlog tasks if setting is disabled\r\n    const includeBacklog = !!settings.calendarIncludeBacklog;\r\n    if (!includeBacklog) {\r\n        dayTasks = dayTasks.filter((task) => task.status !== 'backlog');\r\n    }\r\n\r\n    // Sort tasks by priority (high to low)\r\n    // Using imported PRIORITY_ORDER\r\n    dayTasks.sort((a, b) => {\r\n        const priorityA = PRIORITY_ORDER[a.priority] || 0;\r\n        const priorityB = PRIORITY_ORDER[b.priority] || 0;\r\n        return priorityB - priorityA;\r\n    });\r\n    const dayProjects = projects.filter((project) => {\r\n        const startDate = new Date(project.startDate);\r\n        const endDate = project.endDate\r\n            ? new Date(project.endDate)\r\n            : new Date(project.startDate);\r\n        const currentDate = new Date(dateStr);\r\n        return currentDate >= startDate && currentDate <= endDate;\r\n    });\r\n\r\n    if (dayTasks.length === 0 && dayProjects.length === 0) {\r\n        // Show custom styled confirmation modal\r\n        const message = `No tasks or projects for ${formatDate(dateStr)}. Would you like to create a new task?`;\r\n        document.getElementById('calendar-create-message').textContent = message;\r\n        document.getElementById('calendar-create-modal').classList.add('active');\r\n        // Store the date for use when confirmed\r\n        window.pendingCalendarDate = dateStr;\r\n        return;\r\n    }\r\n\r\n    // Show custom modal\r\n    const modal = document.getElementById('day-items-modal');\r\n    const title = document.getElementById('day-items-modal-title');\r\n    const body = document.getElementById('day-items-modal-body');\r\n\r\n    title.textContent = t('calendar.dayItemsTitle', { date: formatDate(dateStr) });\r\n\r\n    // Store the date for use by \"Add Task\" button\r\n    window.dayItemsModalDate = dateStr;\r\n\r\n    let html = '';\r\n\r\n    // Projects section\r\n    if (dayProjects.length > 0) {\r\n        html += '<div class=\"day-items-section\">';\r\n        html += `<div class=\"day-items-section-title\">\\u{1F4CA} ${t('calendar.dayItemsProjects')}</div>`;\r\n        dayProjects.forEach(project => {\r\n            const projectStatus = getProjectStatus(project.id);\r\n            html += `\r\n                <div class=\"day-item\" data-action=\"closeDayItemsAndShowProject\" data-param=\"${project.id}\">\r\n                    <div class=\"day-item-title\">${escapeHtml(project.name)}</div>\r\n                    <div class=\"day-item-meta\" style=\"display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap;\">\r\n                        <span>${formatDate(project.startDate)} - ${formatDate(project.endDate)}</span>\r\n                        <span class=\"project-status-badge ${projectStatus}\">${getProjectStatusLabel(projectStatus).toUpperCase()}</span>\r\n                    </div>\r\n                </div>\r\n            `;\r\n        });\r\n        html += '</div>';\r\n    }\r\n\r\n    // Tasks section\r\n    if (dayTasks.length > 0) {\r\n        html += '<div class=\"day-items-section\">';\r\n        html += `<div class=\"day-items-section-title\">\\u{2705} ${t('calendar.dayItemsTasks')}</div>`;\r\n        dayTasks.forEach(task => {\r\n            let projectIndicator = \"\";\r\n            if (task.projectId) {\r\n                const project = projects.find(p => p.id === task.projectId);\r\n                if (project) {\r\n                    const projectColor = getProjectColor(task.projectId);\r\n                    projectIndicator = `<span class=\"project-indicator\" style=\"background-color: ${projectColor}; color: white; padding: 1px 6px; border-radius: 8px; font-size: 10px; margin-right: 6px; text-shadow: 0 1px 2px rgba(0,0,0,0.3); font-weight: 600;\">${escapeHtml(project.name)}</span>`;\r\n                } else {\r\n                    // Project not found - show plain text like in Kanban  \r\n                    projectIndicator = t('tasks.projectIndicatorNone');\r\n                }\r\n            } else {\r\n                // No project assigned - show plain text like in Kanban\r\n                projectIndicator = t('tasks.projectIndicatorNone');\r\n            }\r\n            \r\n            // Create status badge instead of text\r\n            const statusBadge = `<span class=\"status-badge ${task.status}\" style=\"padding: 2px 8px; font-size: 10px; font-weight: 600;\">${getStatusLabel(task.status)}</span>`;\r\n            \r\n            const priorityLabel = getPriorityLabel(task.priority || '').toUpperCase();\r\n            html += `\r\n                <div class=\"day-item\" data-action=\"closeDayItemsAndOpenTask\" data-param=\"${task.id}\">\r\n                    <div style=\"display: flex; justify-content: space-between; align-items: flex-start; gap: 8px;\">\r\n                        <div class=\"day-item-title\" style=\"flex: 1; min-width: 0;\">${escapeHtml(task.title)}</div>\r\n                        <div class=\"day-item-meta\" style=\"display: flex; align-items: center; gap: 6px; flex-shrink: 0;\"><span class=\"task-priority priority-${task.priority}\">${priorityLabel}</span>${statusBadge}</div>\r\n                    </div>\r\n                    <div style=\"margin-top: 8px; font-size: 11px;\">${projectIndicator}</div>\r\n                </div>\r\n            `;\r\n        });\r\n        html += '</div>';\r\n    }\r\n\r\n    body.innerHTML = html;\r\n    modal.classList.add('active');\r\n}\r\n\r\nfunction closeDayItemsModal() {\r\n    document.getElementById('day-items-modal').classList.remove('active');\r\n}\r\n\r\nfunction closeDayItemsModalOnBackdrop(event) {\r\n    // Event delegation sets `event.currentTarget` to `document`, so we must compare against the modal backdrop node.\r\n    const modal = document.getElementById('day-items-modal');\r\n    if (!modal) return;\r\n    if (event.target === modal) closeDayItemsModal();\r\n}\r\n\r\nfunction addTaskFromDayItemsModal() {\r\n    const dateStr = window.dayItemsModalDate;\r\n    closeDayItemsModal();\r\n    if (dateStr) {\r\n        openTaskModal();\r\n        // Wait for flatpickr to initialize, then set the date using its API\r\n        setTimeout(() => {\r\n            const modal = document.getElementById('task-modal');\r\n            if (!modal) return;\r\n\r\n            const endInput = modal.querySelector('#task-form input[name=\"endDate\"]');\r\n            if (!endInput) return;\r\n\r\n            // Find the display input (flatpickr is attached to it)\r\n            const wrapper = endInput.closest('.date-input-wrapper');\r\n            if (!wrapper) return;\r\n\r\n            const displayInput = wrapper.querySelector('.date-display');\r\n            if (!displayInput || !displayInput._flatpickr) return;\r\n\r\n            // Set the hidden input value (ISO format)\r\n            endInput.value = dateStr;\r\n\r\n            // Set the display input using flatpickr API\r\n            displayInput._flatpickr.setDate(new Date(dateStr), false);\r\n        }, 100);\r\n    }\r\n    window.dayItemsModalDate = null;\r\n}\r\n\r\n// Add keyboard support for closing day items modal\r\ndocument.addEventListener('keydown', function(e) {\r\n    const dayModal = document.getElementById('day-items-modal');\r\n    if (dayModal && dayModal.classList.contains('active') && e.key === 'Escape') {\r\n        e.preventDefault();\r\n        closeDayItemsModal();\r\n    }\r\n});\r\n\r\nfunction closeProjectConfirmModal() {\r\n    document.getElementById('project-confirm-modal').classList.remove('active');\r\n    document.getElementById('delete-tasks-checkbox').checked = false;\r\n    document.getElementById(\"project-confirm-error\").classList.remove(\"show\");\r\n    projectToDelete = null;\r\n}\r\n\r\n// Account deletion functions\r\nfunction openDeleteAccountModal() {\r\n    const modal = document.getElementById('delete-account-modal');\r\n    modal.classList.add('active');\r\n    \r\n    // Find elements that need HTML rendering BEFORE applyTranslations runs\r\n    const warningEl = modal.querySelector('[data-i18n=\"settings.deleteAccount.warning\"]');\r\n    const confirmTextEl = modal.querySelector('[data-i18n=\"settings.deleteAccount.confirmText\"]');\r\n    \r\n    // Temporarily remove data-i18n so applyTranslations skips them\r\n    if (warningEl) warningEl.removeAttribute('data-i18n');\r\n    if (confirmTextEl) confirmTextEl.removeAttribute('data-i18n');\r\n    \r\n    // Apply translations for elements that don't need HTML rendering\r\n    applyTranslations(modal);\r\n    \r\n    // Now set HTML content for elements that need HTML rendering\r\n    if (warningEl) {\r\n        warningEl.innerHTML = t('settings.deleteAccount.warning');\r\n    }\r\n    \r\n    if (confirmTextEl) {\r\n        confirmTextEl.innerHTML = t('settings.deleteAccount.confirmText');\r\n    }\r\n    \r\n    const confirmInput = document.getElementById('delete-account-confirm-input');\r\n    confirmInput.value = '';\r\n    confirmInput.focus();\r\n    \r\n    // Auto-convert to lowercase as user types for better UX\r\n    const lowercaseHandler = function(e) {\r\n        const start = e.target.selectionStart;\r\n        const end = e.target.selectionEnd;\r\n        e.target.value = e.target.value.toLowerCase();\r\n        e.target.setSelectionRange(start, end);\r\n    };\r\n    confirmInput.addEventListener('input', lowercaseHandler);\r\n    \r\n    // Clear error message\r\n    document.getElementById('delete-account-confirm-error').classList.remove('show');\r\n    \r\n    // Handle Enter key\r\n    confirmInput.addEventListener('keydown', function(e) {\r\n        if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            confirmDeleteAccount();\r\n        }\r\n    }, { once: true });\r\n}\r\n\r\nfunction closeDeleteAccountModal() {\r\n    const modal = document.getElementById('delete-account-modal');\r\n    modal.classList.remove('active');\r\n    const confirmInput = document.getElementById('delete-account-confirm-input');\r\n    confirmInput.value = '';\r\n    document.getElementById('delete-account-confirm-error').classList.remove('show');\r\n    \r\n    // Remove lowercase handler to prevent duplicate listeners\r\n    // (Handler will be re-added when modal opens again)\r\n    const newInput = confirmInput.cloneNode(true);\r\n    confirmInput.parentNode.replaceChild(newInput, confirmInput);\r\n}\r\n\r\nasync function confirmDeleteAccount() {\r\n    const input = document.getElementById('delete-account-confirm-input');\r\n    const errorMsg = document.getElementById('delete-account-confirm-error');\r\n    const confirmText = input.value.trim().toLowerCase();\r\n    \r\n    if (confirmText !== 'delete') {\r\n        errorMsg.classList.add('show');\r\n        input.focus();\r\n        return;\r\n    }\r\n    \r\n    // Get auth token\r\n    const authToken = localStorage.getItem('authToken');\r\n    if (!authToken) {\r\n        showErrorNotification(t('error.unauthorized'));\r\n        closeDeleteAccountModal();\r\n        return;\r\n    }\r\n    \r\n    try {\r\n        // Call API to delete account\r\n        const response = await fetch('/api/auth/delete-account', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${authToken}`\r\n            }\r\n        });\r\n        \r\n        const data = await response.json();\r\n        \r\n        if (!response.ok) {\r\n            showErrorNotification(data.error || t('error.deleteAccountFailed'));\r\n            return;\r\n        }\r\n        \r\n        // Account deleted successfully\r\n        // Clear all local data\r\n        localStorage.clear();\r\n        sessionStorage.clear();\r\n        \r\n        // Close modal\r\n        closeDeleteAccountModal();\r\n        \r\n        // Show success message briefly, then redirect to login\r\n        showSuccessNotification(t('settings.deleteAccount.success'));\r\n        \r\n        // Redirect to login page after a short delay\r\n        setTimeout(() => {\r\n            window.location.href = '/auth.html';\r\n        }, 1500);\r\n        \r\n    } catch (error) {\r\n        console.error('Delete account error:', error);\r\n        showErrorNotification(t('error.deleteAccountFailed'));\r\n    }\r\n}\r\n\r\n// Unsaved changes modal functions\r\nfunction showUnsavedChangesModal(modalId) {\r\n    window.pendingModalToClose = modalId;\r\n    document.getElementById('unsaved-changes-modal').classList.add('active');\r\n}\r\n\r\nfunction closeUnsavedChangesModal() {\r\n    document.getElementById('unsaved-changes-modal').classList.remove('active');\r\n}\r\n\r\nfunction confirmDiscardChanges() {\r\n    const targetModal = window.pendingModalToClose || 'task-modal';\r\n    closeUnsavedChangesModal();\r\n\r\n    // Clear initial state tracking when discarding changes\r\n    if (targetModal === 'task-modal') {\r\n        initialTaskFormState = null;\r\n    } else if (targetModal === 'settings-modal') {\r\n        window.initialSettingsFormState = null;\r\n        window.settingsFormIsDirty = false;\r\n        const settingsForm = document.getElementById('settings-form');\r\n        const saveBtn = settingsForm?.querySelector('.settings-btn-save');\r\n        if (saveBtn) {\r\n            saveBtn.classList.remove('dirty');\r\n            saveBtn.disabled = true;\r\n        }\r\n    }\r\n\r\n    window.pendingModalToClose = null;\r\n    closeModal(targetModal);\r\n}\r\n\r\nfunction closeReviewStatusConfirmModal() {\r\n    document.getElementById('review-status-confirm-modal').classList.remove('active');\r\n    // Reset toggle to enabled if user cancelled\r\n    if (window.pendingReviewStatusToggle) {\r\n        window.pendingReviewStatusToggle.checked = true;\r\n        window.pendingReviewStatusToggle.dispatchEvent(new Event('change', { bubbles: true }));\r\n        if (typeof window.markSettingsDirtyIfNeeded === 'function') {\r\n            window.markSettingsDirtyIfNeeded();\r\n        }\r\n    }\r\n    window.pendingReviewTaskMigration = null;\r\n    window.pendingReviewStatusToggle = null;\r\n}\r\n\r\nasync function confirmDisableReviewStatus() {\r\n    // CRITICAL: Save tasks to local variable BEFORE closing modal (which clears pendingReviewTaskMigration)\r\n    const tasksToMigrate = window.pendingReviewTaskMigration ? [...window.pendingReviewTaskMigration] : [];\r\n\r\n    closeReviewStatusConfirmModal();\r\n\r\n    // Migrate all review tasks to progress - find by ID to ensure we update the actual global tasks\r\n    if (tasksToMigrate && tasksToMigrate.length > 0) {\r\n        const taskIds = tasksToMigrate.map(t => t.id);\r\n\r\n        // Update tasks in the global tasks array\r\n        tasks.forEach(task => {\r\n            if (taskIds.includes(task.id)) {\r\n                task.status = 'progress';\r\n            }\r\n        });\r\n\r\n        // Save tasks immediately\r\n        await saveTasks();\r\n    }\r\n\r\n    // Continue with saving settings\r\n    const enableReviewStatusToggle = document.getElementById('enable-review-status-toggle');\r\n    if (enableReviewStatusToggle) {\r\n        // Ensure checkbox is unchecked to match the new state\r\n        enableReviewStatusToggle.checked = false;\r\n\r\n        // Update global variable and localStorage\r\n        window.enableReviewStatus = false;\r\n        localStorage.setItem('enableReviewStatus', 'false');\r\n\r\n        // Update settings object\r\n        settings.enableReviewStatus = false;\r\n        await saveSettings();\r\n\r\n        // Apply review status visibility (hides review column)\r\n        applyReviewStatusVisibility();\r\n\r\n        // Force immediate kanban refresh to show migrated tasks\r\n        renderTasks();\r\n    }\r\n\r\n    // Mark form as clean and close settings modal\r\n    const saveBtn = document.getElementById('save-settings-btn');\r\n    window.initialSettingsFormState = null;\r\n    window.settingsFormIsDirty = false;\r\n    if (saveBtn) {\r\n        saveBtn.classList.remove('dirty');\r\n        saveBtn.disabled = true;\r\n    }\r\n\r\n    closeModal('settings-modal');\r\n    showSuccessNotification(t('success.settingsSaved'));\r\n}\r\n\r\n// Calendar create task modal functions\r\nfunction closeCalendarCreateModal() {\r\n    document.getElementById('calendar-create-modal').classList.remove('active');\r\n    window.pendingCalendarDate = null;\r\n}\r\n\r\nfunction confirmCreateTask() {\r\n    const dateStr = window.pendingCalendarDate;\r\n    closeCalendarCreateModal();\r\n    if (dateStr) {\r\n        openTaskModal();\r\n        // Wait for flatpickr to initialize, then set the date using its API\r\n        setTimeout(() => {\r\n            const modal = document.getElementById('task-modal');\r\n            if (!modal) return;\r\n\r\n            const endInput = modal.querySelector('#task-form input[name=\"endDate\"]');\r\n            if (!endInput) return;\r\n\r\n            // Find the display input (flatpickr is attached to it)\r\n            const wrapper = endInput.closest('.date-input-wrapper');\r\n            if (!wrapper) return;\r\n\r\n            const displayInput = wrapper.querySelector('.date-display');\r\n            if (!displayInput || !displayInput._flatpickr) return;\r\n\r\n            // Set the hidden input value (ISO format)\r\n            endInput.value = dateStr;\r\n\r\n            // Set the display input using flatpickr API\r\n            displayInput._flatpickr.setDate(new Date(dateStr), false);\r\n        }, 100);\r\n    }\r\n}\r\n\r\n// Calendar modal backdrop click handler\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n    const calendarModal = document.getElementById('calendar-create-modal');\r\n    if (calendarModal) {\r\n        calendarModal.addEventListener('click', function(event) {\r\n            // Close modal if clicking on the backdrop (not the content)\r\n            if (event.target === calendarModal) {\r\n                closeCalendarCreateModal();\r\n            }\r\n        });\r\n    }\r\n});\r\n\r\nasync function confirmProjectDelete() {\r\n  const input = document.getElementById('project-confirm-input');\r\n  const errorMsg = document.getElementById(\"project-confirm-error\");\r\n  const confirmText = input.value;\r\n  const deleteTasksCheckbox = document.getElementById('delete-tasks-checkbox');\r\n\r\n  if (confirmText !== 'delete') {\r\n    errorMsg.classList.add('show');\r\n    input.focus();\r\n    return;\r\n  }\r\n\r\n  const projectIdNum = parseInt(projectToDelete, 10);\r\n\r\n  // Capture project for history tracking before deletion\r\n  const projectToRecord = projects.find(p => p.id === projectIdNum);\r\n\r\n  // Use project service to delete project\r\n  const deleteTasks = deleteTasksCheckbox.checked;\r\n\r\n  if (deleteTasks) {\r\n    // Delete all tasks associated with project\r\n    tasks = tasks.filter(t => t.projectId !== projectIdNum);\r\n  }\r\n\r\n  // Delete project (and clear task associations if not deleting tasks)\r\n  const result = deleteProjectService(projectIdNum, projects, tasks, !deleteTasks);\r\n  projects = result.projects;\r\n\r\n  // Record history for project deletion\r\n  if (window.historyService && projectToRecord) {\r\n    window.historyService.recordProjectDeleted(projectToRecord);\r\n  }\r\n\r\n  // Update tasks if associations were cleared (not deleted)\r\n  if (!deleteTasks && result.tasks) {\r\n    tasks = result.tasks;\r\n  }\r\n\r\n  // Close modal and update UI immediately (optimistic update)\r\n  closeProjectConfirmModal();\r\n\r\n  // Clear sorted view cache to force refresh without deleted project\r\n  appState.projectsSortedView = null;\r\n\r\n  // Navigate to projects page and refresh display immediately\r\n  window.location.hash = \"#projects\";\r\n  showPage(\"projects\");\r\n  render();\r\n\r\n  // Save in background (don't block UI)\r\n  Promise.all([\r\n    saveProjects().catch(err => {\r\n      console.error('Failed to save projects:', err);\r\n      showErrorNotification(t('error.saveChangesFailed'));\r\n    }),\r\n    deleteTasks ? saveTasks().catch(err => {\r\n      console.error('Failed to save tasks:', err);\r\n      showErrorNotification(t('error.saveChangesFailed'));\r\n    }) : Promise.resolve()\r\n  ]);\r\n\r\n}\r\n\r\n\r\nfunction showProjectDetails(projectId, referrer, context) {\r\n    const detailsTimer = debugTimeStart(\"projects\", \"details\", {\r\n        projectId\r\n    });\r\n    // Only update navigation context if explicitly provided (prevents routing handler from overwriting)\r\n    if (referrer !== undefined) {\r\n        projectNavigationReferrer = referrer;\r\n        if (referrer === 'calendar') {\r\n            const month = context && Number.isInteger(context.month) ? context.month : currentMonth;\r\n            const year = context && Number.isInteger(context.year) ? context.year : currentYear;\r\n            calendarNavigationState = { month, year };\r\n        }\r\n    } else if (!projectNavigationReferrer) {\r\n        // If no referrer stored yet, default to 'projects'\r\n        projectNavigationReferrer = 'projects';\r\n    }\r\n    // Otherwise keep the existing referrer value\r\n\r\n    // Update URL hash\r\n    window.location.hash = `project-${projectId}`;\r\n\r\n    const project = projects.find((p) => p.id === projectId);\r\n    if (!project) {\r\n        debugTimeEnd(\"projects\", detailsTimer, { projectId, found: false });\r\n        return;\r\n    }\r\n\r\n    // Scroll to top on mobile when showing project details\r\n    if (getIsMobileCached()) {\r\n        window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    }\r\n\r\n    // Hide ALL pages first, then show project details\r\n    document\r\n        .querySelectorAll(\".page\")\r\n        .forEach((page) => page.classList.remove(\"active\"));\r\n    document.getElementById(\"project-details\").classList.add(\"active\");\r\n    \r\n    // Hide user menu in project details view\r\n    const userMenu = document.querySelector(\".user-menu\");\r\n    if (userMenu) userMenu.style.display = \"none\";\r\n\r\n    // Calculate project stats\r\n    const projectTasks = tasks.filter((t) => t.projectId === projectId);\r\n    const completedTasks = projectTasks.filter((t) => t.status === \"done\");\r\n    const inProgressTasks = projectTasks.filter((t) => t.status === \"progress\");\r\n    const reviewTasks = projectTasks.filter((t) => t.status === \"review\");\r\n    const todoTasks = projectTasks.filter((t) => t.status === \"todo\");\r\n    const backlogTasks = projectTasks.filter((t) => t.status === \"backlog\");\r\n\r\n    const completionPercentage =\r\n        projectTasks.length > 0\r\n            ? Math.round((completedTasks.length / projectTasks.length) * 100)\r\n            : 0;\r\n\r\n    // Calculate project status based on task statuses\r\n    const projectStatus = getProjectStatus(projectId);\r\n\r\n\t    // Calculate duration\r\n\t    const startDate = project.startDate ? new Date(project.startDate) : null;\r\n\t    const endDate = project.endDate ? new Date(project.endDate) : new Date();\r\n\t    const durationDays =\r\n\t        startDate && Number.isFinite(startDate.getTime()) && Number.isFinite(endDate.getTime())\r\n\t            ? Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24))\r\n\t            : null;\r\n    const durationText = Number.isFinite(durationDays)\r\n        ? t('projects.details.durationDays', { count: durationDays })\r\n        : \"-\";\r\n\r\n    // Render project details\r\n    const detailsHTML = `\r\n        <div class=\"project-details-header\">\r\n                    <div class=\"project-details-title\">\r\n                        <span id=\"project-title-display\" data-action=\"editProjectTitle\" data-param=\"${projectId}\" data-param2=\"${escapeHtml(project.name).replace(/'/g, '&#39;')}\" style=\"font-size: 32px; font-weight: 700; color: var(--text-primary); cursor: pointer;\">${escapeHtml(project.name)}</span>\r\n                        <div id=\"project-title-edit\" style=\"display: none;\">\r\n                            <input type=\"text\" id=\"project-title-input\" class=\"editable-project-title\" value=\"${escapeHtml(project.name)}\" style=\"font-size: 32px; font-weight: 700;\">\r\n                            <button class=\"title-edit-btn confirm\" data-action=\"saveProjectTitle\" data-param=\"${projectId}\">\u2713</button>\r\n                            <button class=\"title-edit-btn cancel\" data-action=\"cancelProjectTitle\">\u2715</button>\r\n                        </div>\r\n                        <span class=\"project-status-badge ${projectStatus}\" data-action=\"showStatusInfoModal\">${getProjectStatusLabel(projectStatus).toUpperCase()}</span>\r\n                        <button class=\"back-btn\" data-action=\"${projectNavigationReferrer === 'dashboard' ? 'backToDashboard' : (projectNavigationReferrer === 'calendar' ? 'backToCalendar' : 'backToProjects')}\" style=\"padding: 8px 12px; font-size: 14px; display: flex; align-items: center; gap: 6px; margin-left: 12px;\">${projectNavigationReferrer === 'dashboard' ? t('projects.backTo.dashboard') : (projectNavigationReferrer === 'calendar' ? t('projects.backTo.calendar') : t('projects.backTo.projects'))}</button>\r\n                        <div style=\"margin-left: auto; position: relative;\">\r\n                            <button type=\"button\" class=\"options-btn\" id=\"project-options-btn\" data-action=\"toggleProjectMenu\" style=\"background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:20px;padding:4px;line-height:1;\">\u22EF</button>\r\n                            <div class=\"options-menu\" id=\"project-options-menu\" style=\"position:absolute;top:calc(100% + 8px);right:0;display:none;\">\r\n                                <button type=\"button\" class=\"duplicate-btn\" data-action=\"handleDuplicateProject\" data-param=\"${projectId}\" style=\"display:flex;align-items:center;gap:8px;padding:8px 12px;background:none;border:none;color:var(--text-primary);cursor:pointer;font-size:14px;width:100%;text-align:left;border-radius:4px;\">\uD83D\uDCCB ${t('projects.duplicate.title')}</button>\r\n                                <button type=\"button\" class=\"delete-btn\" data-action=\"handleDeleteProject\" data-param=\"${projectId}\">\uD83D\uDDD1\uFE0F ${t('projects.delete.title')}</button>\r\n                            </div>\r\n                        </div>\r\n\t                    </div>\r\n\r\n\t                    <div class=\"modal-tabs project-details-tabs\">\r\n\t                        <button type=\"button\" class=\"modal-tab active\" data-tab=\"details\">${t('projects.details.tab.details')}</button>\r\n\t                        <button type=\"button\" class=\"modal-tab\" data-tab=\"history\">${t('projects.details.tab.history')}</button>\r\n\t                    </div>\r\n\r\n\t                    <div class=\"modal-tab-content active\" id=\"project-details-tab\">\r\n\t\t                    <div class=\"project-details-description\">\r\n\t\t                        <textarea class=\"editable-description\" id=\"project-description-editor\">${project.description || \"\"}</textarea>\r\n\t\t                    </div>\r\n                    <div class=\"project-timeline\">\r\n                        <div class=\"timeline-item\">\r\n                            <div class=\"timeline-label\">${t('projects.details.startDate')}</div>\r\n                            <input type=\"text\" class=\"form-input date-display editable-date datepicker\"\r\n                                placeholder=\"dd/mm/yyyy\" maxLength=\"10\"\r\n                                value=\"${project.startDate ? formatDate(project.startDate) : ''}\"\r\n                                data-project-id=\"${projectId}\" data-field=\"startDate\">\r\n                        </div>\r\n                        <div class=\"timeline-item\">\r\n                            <div class=\"timeline-label\">${t('projects.details.endDate')}</div>\r\n                                <input type=\"text\" class=\"form-input date-display editable-date datepicker\"\r\n                                    placeholder=\"dd/mm/yyyy\" maxLength=\"10\"\r\n                                    value=\"${project.endDate ? formatDate(project.endDate) : ''}\"\r\n                                    data-project-id=\"${projectId}\" data-field=\"endDate\">\r\n                        </div>\r\n\t                        <div class=\"timeline-item\">\r\n\t                            <div class=\"timeline-label\">${t('projects.details.duration')}</div>\r\n\t                            <div class=\"timeline-value\">${durationText}</div>\r\n\t                        </div>\r\n                        <div class=\"timeline-item\">\r\n                            <div class=\"timeline-label\">${t('projects.details.created')}</div>\r\n                            <div class=\"timeline-value\">${formatDate(\r\n                                project.createdAt?.split(\"T\")[0]\r\n                            )}</div>\r\n                        </div>\r\n                        <div class=\"timeline-item\" style=\"position: relative;\">\r\n                            <div class=\"timeline-label\">${t('projects.details.calendarColor')}</div>\r\n                            <div class=\"color-picker-container\" style=\"position: relative;\">\r\n                                <div class=\"current-color\" \r\n                                     style=\"background-color: ${getProjectColor(projectId)}; width: 20px; height: 20px; border-radius: 4px; border: 2px solid var(--border-color); cursor: pointer; display: inline-block;\"\r\n                                     data-action=\"toggleProjectColorPicker\" data-param=\"${projectId}\">\r\n                                </div>\r\n                                <div class=\"color-picker-dropdown\" id=\"color-picker-${projectId}\" style=\"display: none; position: absolute; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 8px; margin-top: 4px; z-index: 1000; left: 0; top: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.15);\">\r\n                                    <div class=\"color-grid\" style=\"display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px;\">\r\n                                        ${PROJECT_COLORS.map(color => `\r\n                                            <div class=\"color-option\" \r\n                                                 style=\"width: 24px; height: 24px; background-color: ${color}; border-radius: 4px; cursor: pointer; border: 2px solid ${color === getProjectColor(projectId) ? 'white' : 'transparent'};\"\r\n                                                 data-action=\"updateProjectColor\" data-param=\"${projectId}\" data-param2=\"${color}\">\r\n                                            </div>\r\n                                        `).join('')}\r\n                                    </div>\r\n                                    <div class=\"color-picker-custom\" style=\"margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-light); display: flex; align-items: center; justify-content: space-between; gap: 8px; position: relative;\">\r\n                                        <span style=\"font-size: 12px; color: var(--text-muted);\">${t('projects.details.customColor')}</span>\r\n                                        <div \r\n                                            class=\"custom-color-swatch\" \r\n                                            data-action=\"openCustomProjectColorPicker\" \r\n                                            data-param=\"${projectId}\"\r\n                                            style=\"width: 24px; height: 24px; background-color: ${getProjectColor(projectId)}; border-radius: 4px; cursor: pointer; border: 2px solid transparent; box-sizing: border-box;\">\r\n                                        </div>\r\n\t                                        <input \r\n\t                                            type=\"color\" \r\n\t                                            id=\"project-color-input-${projectId}\"\r\n\t                                            class=\"project-color-input\" \r\n\t                                            data-project-id=\"${projectId}\"\r\n\t                                            value=\"${getProjectColor(projectId)}\"\r\n\t                                            style=\"position: absolute; opacity: 0; pointer-events: none; width: 0; height: 0;\">\r\n\t                                    </div>\r\n\t                                </div>\r\n\t                            </div>\r\n\t                        </div>\r\n\t                        <div class=\"timeline-item\" style=\"grid-column: 1 / -1;\">\r\n\t                            <div class=\"timeline-label\">${t('projects.modal.tagsLabel')}</div>\r\n\t                            <div style=\"margin-top: 8px;\">\r\n\t                                <div id=\"project-details-tags-display\" style=\"display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; min-height: 28px;\"></div>\r\n\t                                <div style=\"display: flex; gap: 8px;\">\r\n\t                                    <input type=\"text\" id=\"project-details-tag-input\" class=\"form-input\" placeholder=\"${t('projects.modal.addTagPlaceholder')}\" style=\"flex: 1;\">\r\n\t                                    <button type=\"button\" class=\"btn-secondary\" data-action=\"addProjectDetailsTag\" data-param=\"${projectId}\">+</button>\r\n\t                                </div>\r\n\t                            </div>\r\n\t                        </div>\r\n\t                    </div>\r\n\r\n\t                    <div class=\"project-progress-section\">\r\n                    <div class=\"progress-header\">\r\n                        <div class=\"progress-title\">${t('projects.details.progressOverview')}</div>\r\n                        <div class=\"progress-percentage\">${completionPercentage}%</div>\r\n                    </div>\r\n                    <div class=\"progress-bar-container\">\r\n                        <div class=\"progress-bar-fill\" style=\"width: ${completionPercentage}%\"></div>\r\n                    </div>\r\n                    <div class=\"progress-stats\">\r\n                        <div class=\"progress-stat clickable\" data-action=\"navigateToProjectStatus\" data-param=\"${project.id}\" data-param2=\"backlog\" title=\"${t('projects.details.viewBacklog')}\">\r\n                            <div class=\"progress-stat-number\" style=\"color: var(--text-muted);\">${\r\n                                backlogTasks.length\r\n                            }</div>\r\n                            <div class=\"progress-stat-label\">${t('tasks.status.backlog')}</div>\r\n                        </div>\r\n                        <div class=\"progress-stat clickable\" data-action=\"navigateToProjectStatus\" data-param=\"${project.id}\" data-param2=\"todo\" title=\"${t('projects.details.viewTodo')}\">\r\n                            <div class=\"progress-stat-number\" style=\"color: var(--text-muted);\">${\r\n                                todoTasks.length\r\n                            }</div>\r\n                            <div class=\"progress-stat-label\">${t('tasks.status.todo')}</div>\r\n                        </div>\r\n                        <div class=\"progress-stat clickable\" data-action=\"navigateToProjectStatus\" data-param=\"${project.id}\" data-param2=\"progress\" title=\"${t('projects.details.viewProgress')}\">\r\n                            <div class=\"progress-stat-number\" style=\"color: var(--accent-blue);\">${\r\n                                inProgressTasks.length\r\n                            }</div>\r\n                            <div class=\"progress-stat-label\">${t('tasks.status.progress')}</div>\r\n                        </div>\r\n                        <div class=\"progress-stat clickable\" data-action=\"navigateToProjectStatus\" data-param=\"${project.id}\" data-param2=\"review\" title=\"${t('projects.details.viewReview')}\">\r\n                            <div class=\"progress-stat-number\" style=\"color: var(--accent-amber);\">${\r\n                                reviewTasks.length\r\n                            }</div>\r\n                            <div class=\"progress-stat-label\">${t('tasks.status.review')}</div>\r\n                        </div>\r\n                        <div class=\"progress-stat clickable\" data-action=\"navigateToProjectStatus\" data-param=\"${project.id}\" data-param2=\"done\" title=\"${t('projects.details.viewCompleted')}\">\r\n                            <div class=\"progress-stat-number\" style=\"color: var(--accent-green);\">${\r\n                                completedTasks.length\r\n                            }</div>\r\n                            <div class=\"progress-stat-label\">${t('tasks.status.done')}</div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                \r\n                <div class=\"project-tasks-section\">\r\n                    <div class=\"section-header\">\r\n                        <div class=\"section-title\">${t('projects.details.tasksTitle', { count: projectTasks.length })}</div>\r\n                        <button class=\"add-btn\" data-action=\"openTaskModalForProject\" data-param=\"${projectId}\">${t('tasks.addButton')}</button>\r\n                    </div>\r\n                    <div id=\"project-tasks-list\">\r\n                        ${\r\n                            projectTasks.length === 0\r\n                                ? `<div class=\"empty-state\">${t('tasks.empty.epic')}</div>`\r\n                                : projectTasks\r\n                                      .sort((a, b) => {\r\n                                          // Using imported PRIORITY_ORDER\r\n                                          const priorityA = PRIORITY_ORDER[a.priority] || 1;\r\n                                          const priorityB = PRIORITY_ORDER[b.priority] || 1;\r\n                                          return priorityB - priorityA; // Sort high to low\r\n                                      })\r\n                                      .map(\r\n                                          (task) => `\r\n                                        <div class=\"project-task-item\" data-action=\"openTaskDetails\" data-param=\"${task.id}\">\r\n                                            <div class=\"project-task-info\">\r\n                                                <div class=\"project-task-title\">${task.title}</div>\r\n                                                <div class=\"project-task-meta\">${\r\n                                                    task.endDate\r\n                                                        ? `${t('tasks.endDatePrefix')}${formatDate(task.endDate)}`\r\n                                                        : t('tasks.noDatesSet')\r\n                                                }</div>\r\n                                                ${task.tags && task.tags.length > 0 ? `\r\n                                                    <div class=\"task-tags\" style=\"margin-top: 4px;\">\r\n                                                        ${task.tags.map(tag => `<span style=\"background-color: ${getTagColor(tag)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;\">${escapeHtml(tag.toUpperCase())}</span>`).join(' ')}\r\n                                                    </div>\r\n                                                ` : ''}\r\n                                            </div>\r\n                                            <div class=\"project-task-priority\">\r\n                                                <div class=\"task-priority priority-${task.priority}\">${getPriorityLabel(task.priority).toUpperCase()}</div>\r\n                                            </div>\r\n                                            <div class=\"project-task-status-col\">\r\n                                                <div class=\"status-badge ${task.status}\">\r\n                                                    ${getStatusLabel(task.status)}\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                            `\r\n                                      )\r\n                                      .join(\"\")\r\n                        }\r\n                    </div>\r\n                </div>\r\n\r\n                </div>\r\n\r\n\t                <div class=\"modal-tab-content\" id=\"project-history-tab\">\r\n\t                    <div class=\"project-history-section\">\r\n                    <div class=\"section-header\">\r\n                        <div class=\"section-title\">\uD83D\uDCDC ${t('projects.details.changeHistory')}</div>\r\n                    </div>\r\n                    <div class=\"history-timeline-inline\" id=\"project-history-timeline-${projectId}\">\r\n                        <!-- Timeline will be populated by JavaScript -->\r\n                    </div>\r\n                    <div class=\"history-empty-inline\" id=\"project-history-empty-${projectId}\" style=\"display: none;\">\r\n                        <div style=\"font-size: 36px; margin-bottom: 12px; opacity: 0.3;\">\uD83D\uDCDC</div>\r\n                        <p style=\"color: var(--text-muted); text-align: center;\">${t('projects.details.noChanges')}</p>\r\n                    </div>\r\n\t                    </div>\r\n\t                </div>\r\n\t        </div>\r\n\t            `;\r\n\r\n\t    document.getElementById(\"project-details-content\").innerHTML = detailsHTML;\r\n\r\n        // Ensure project description persists reliably (avoid inline handlers getting skipped)\r\n        const descEl = document.getElementById(\"project-description-editor\");\r\n        if (descEl) {\r\n            const saveNow = () => updateProjectField(projectId, 'description', descEl.value, { render: false });\r\n            const saveDebounced = typeof debounce === 'function' ? debounce(saveNow, 500) : saveNow;\r\n            descEl.addEventListener('input', saveDebounced);\r\n            descEl.addEventListener('blur', saveNow);\r\n        }\r\n\t    setupProjectDetailsTabs(projectId);\r\n\r\n    const customColorInput = document.getElementById(`project-color-input-${projectId}`);\r\n    if (customColorInput) {\r\n        customColorInput.addEventListener('change', (e) => {\r\n            handleProjectCustomColorChange(projectId, e.target.value);\r\n        });\r\n    }\r\n\r\n    // Re-initialize date pickers for project details\r\n\t    setTimeout(() => {\r\n\t        // Clear any existing flatpickr instances first\r\n\t        document.querySelectorAll('input.datepicker').forEach(input => {\r\n\t            if (input._flatpickrInstance) {\r\n\t                input._flatpickrInstance.destroy();\r\n\t                delete input._flatpickrInstance;\r\n\t            }\r\n\t        });\r\n\t\t        // Then initialize new ones - specifically target project detail datepickers\r\n\t\t        initializeDatePickers();\r\n\t\t    }, 50);\r\n\r\n    // Render project tags in details view\r\n    renderProjectDetailsTags(project.tags || [], projectId);\r\n\r\n    // Project tag input Enter key support\r\n    const projectTagInput = document.getElementById('project-details-tag-input');\r\n    if (projectTagInput) {\r\n        // Remove any existing listener to prevent duplicates\r\n        projectTagInput.replaceWith(projectTagInput.cloneNode(true));\r\n        const newInput = document.getElementById('project-details-tag-input');\r\n        newInput.addEventListener('keydown', function(e) {\r\n            if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                addProjectDetailsTag(projectId);\r\n            }\r\n        });\r\n    }\r\n    debugTimeEnd(\"projects\", detailsTimer, {\r\n        projectId,\r\n        taskCount: projectTasks.length,\r\n        completionPercentage\r\n    });\r\n\t\t}\r\n\r\n\tfunction setupProjectDetailsTabs(projectId) {\r\n\t    const container = document.getElementById(\"project-details-content\");\r\n\t    if (!container) return;\r\n\r\n\t    const tabsContainer = container.querySelector(\".project-details-tabs\");\r\n\t    if (!tabsContainer) return;\r\n\r\n\t    const detailsTab = container.querySelector(\"#project-details-tab\");\r\n\t    const historyTab = container.querySelector(\"#project-history-tab\");\r\n\t    if (!detailsTab || !historyTab) return;\r\n\r\n\t    const setActive = (tabName) => {\r\n\t        tabsContainer.querySelectorAll(\".modal-tab\").forEach((tab) => tab.classList.remove(\"active\"));\r\n\t        container.querySelectorAll(\".modal-tab-content\").forEach((content) => content.classList.remove(\"active\"));\r\n\r\n\t        const nextTab = tabsContainer.querySelector(`.modal-tab[data-tab=\"${tabName}\"]`);\r\n\t        if (nextTab) nextTab.classList.add(\"active\");\r\n\r\n\t        if (tabName === \"history\") {\r\n\t            historyTab.classList.add(\"active\");\r\n\t            renderProjectHistory(projectId);\r\n\r\n\t            const historyContainer = historyTab.querySelector(\".project-history-section\");\r\n\t            if (historyContainer) historyContainer.scrollTop = 0;\r\n\t        } else {\r\n\t            detailsTab.classList.add(\"active\");\r\n\t        }\r\n\t    };\r\n\r\n\t    tabsContainer.querySelectorAll(\".modal-tab\").forEach((tab) => {\r\n\t        tab.addEventListener(\"click\", () => {\r\n\t            setActive(tab.dataset.tab);\r\n\t        });\r\n\t    });\r\n\r\n\t    setActive(\"details\");\r\n\t}\r\n\r\nfunction handleDeleteProject(projectId) {\r\n    projectToDelete = projectId;\r\n    deleteProject();\r\n}\r\n\r\nfunction deleteProject() {\r\n    const projectId = projectToDelete;\r\n    if (!projectId) return;\r\n    \r\n    // Check if project has tasks\r\n    const projectTasks = tasks.filter(t => t.projectId === projectId);\r\n    const checkbox = document.getElementById('delete-tasks-checkbox');\r\n    \r\n    // Find the parent div that contains the checkbox label and description\r\n    const checkboxContainer = checkbox ? checkbox.closest('div[style*=\"margin: 16px\"]') : null;\r\n    \r\n    if (checkboxContainer) {\r\n        if (projectTasks.length === 0) {\r\n            // Hide entire checkbox section if no tasks\r\n            checkboxContainer.style.display = 'none';\r\n        } else {\r\n            // Show checkbox section if tasks exist\r\n            checkboxContainer.style.display = 'block';\r\n        }\r\n    }\r\n    \r\n    document.getElementById('project-confirm-modal').classList.add('active');\r\n    const projectConfirmInput = document.getElementById('project-confirm-input');\r\n    projectConfirmInput.value = '';\r\n    projectConfirmInput.focus();\r\n\r\n    // Auto-convert to lowercase as user types for better UX\r\n    const projectLowercaseHandler = function(e) {\r\n        const start = e.target.selectionStart;\r\n        const end = e.target.selectionEnd;\r\n        e.target.value = e.target.value.toLowerCase();\r\n        e.target.setSelectionRange(start, end);\r\n    };\r\n    projectConfirmInput.addEventListener('input', projectLowercaseHandler);\r\n\r\n    // Add keyboard support for project delete modal\r\n    document.addEventListener('keydown', function(e) {\r\n        const projectConfirmModal = document.getElementById('project-confirm-modal');\r\n        if (!projectConfirmModal || !projectConfirmModal.classList.contains('active')) return;\r\n        \r\n        if (e.key === 'Escape') {\r\n            e.preventDefault();\r\n            closeProjectConfirmModal();\r\n        } else if (e.key === 'Enter') {\r\n            e.preventDefault();\r\n            confirmProjectDelete();\r\n        }\r\n    });\r\n\r\n}\r\n\r\n// Project duplication\r\nlet projectToDuplicate = null;\r\n\r\nfunction handleDuplicateProject(projectId) {\r\n    projectToDuplicate = projectId;\r\n    const modal = document.getElementById('project-duplicate-modal');\r\n    const project = projects.find(p => p.id === projectId);\r\n\r\n    if (!project) return;\r\n\r\n    // Check if project has tasks\r\n    const projectTasks = tasks.filter(t => t.projectId === projectId);\r\n    const includeTasksCheckbox = document.getElementById('duplicate-tasks-checkbox');\r\n    const taskNamingOptions = document.getElementById('task-naming-options');\r\n\r\n    // Show/hide task naming options based on whether tasks exist\r\n    if (projectTasks.length === 0) {\r\n        if (includeTasksCheckbox) {\r\n            includeTasksCheckbox.checked = false;\r\n            includeTasksCheckbox.disabled = true;\r\n        }\r\n        if (taskNamingOptions) taskNamingOptions.style.display = 'none';\r\n    } else {\r\n        if (includeTasksCheckbox) {\r\n            includeTasksCheckbox.checked = true;\r\n            includeTasksCheckbox.disabled = false;\r\n        }\r\n        if (taskNamingOptions) taskNamingOptions.style.display = 'block';\r\n    }\r\n\r\n    // Reset task naming options\r\n    const noneRadio = document.querySelector('input[name=\"task-naming\"][value=\"none\"]');\r\n    if (noneRadio) noneRadio.checked = true;\r\n\r\n    const prefixInput = document.getElementById('task-prefix-input');\r\n    const suffixInput = document.getElementById('task-suffix-input');\r\n    if (prefixInput) {\r\n        prefixInput.value = '';\r\n        prefixInput.disabled = true;\r\n    }\r\n    if (suffixInput) {\r\n        suffixInput.value = '';\r\n        suffixInput.disabled = true;\r\n    }\r\n\r\n    // Show modal\r\n    modal.classList.add('active');\r\n\r\n    // Set up event listeners for checkbox and radio buttons\r\n    if (includeTasksCheckbox) {\r\n        includeTasksCheckbox.addEventListener('change', function() {\r\n            if (taskNamingOptions) {\r\n                taskNamingOptions.style.display = this.checked ? 'block' : 'none';\r\n            }\r\n        });\r\n    }\r\n\r\n    // Radio button event listeners\r\n    const radios = document.querySelectorAll('input[name=\"task-naming\"]');\r\n    radios.forEach(radio => {\r\n        radio.addEventListener('change', function() {\r\n            if (prefixInput) prefixInput.disabled = this.value !== 'prefix';\r\n            if (suffixInput) suffixInput.disabled = this.value !== 'suffix';\r\n\r\n            // Focus the enabled input\r\n            if (this.value === 'prefix' && prefixInput) {\r\n                setTimeout(() => prefixInput.focus(), 100);\r\n            } else if (this.value === 'suffix' && suffixInput) {\r\n                setTimeout(() => suffixInput.focus(), 100);\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction closeDuplicateProjectModal() {\r\n    const modal = document.getElementById('project-duplicate-modal');\r\n    modal.classList.remove('active');\r\n    projectToDuplicate = null;\r\n}\r\n\r\nasync function confirmDuplicateProject() {\r\n    const projectId = projectToDuplicate;\r\n    if (!projectId) return;\r\n\r\n    const project = projects.find(p => p.id === projectId);\r\n    if (!project) return;\r\n\r\n    const includeTasksCheckbox = document.getElementById('duplicate-tasks-checkbox');\r\n    const includeTasks = includeTasksCheckbox && includeTasksCheckbox.checked;\r\n\r\n    // Get task naming options\r\n    let taskNameTransform = (name) => name; // Default: keep original\r\n\r\n    if (includeTasks) {\r\n        const namingMode = document.querySelector('input[name=\"task-naming\"]:checked')?.value || 'none';\r\n\r\n        if (namingMode === 'prefix') {\r\n            const prefix = document.getElementById('task-prefix-input')?.value || '';\r\n            if (prefix) {\r\n                taskNameTransform = (name) => `${prefix}${name}`;\r\n            }\r\n        } else if (namingMode === 'suffix') {\r\n            const suffix = document.getElementById('task-suffix-input')?.value || '';\r\n            if (suffix) {\r\n                taskNameTransform = (name) => `${name}${suffix}`;\r\n            }\r\n        }\r\n    }\r\n\r\n    // Create new project (add \"Copy - \" prefix to project name)\r\n    const newProject = {\r\n        id: projectCounter,\r\n        name: `Copy - ${project.name}`,\r\n        description: project.description || '',\r\n        startDate: project.startDate || '',\r\n        endDate: project.endDate || '',\r\n        tags: project.tags ? [...project.tags] : [],\r\n        createdAt: new Date().toISOString()\r\n    };\r\n\r\n    projectCounter++;\r\n    projects.push(newProject);\r\n\r\n    // Duplicate tasks if requested\r\n    if (includeTasks) {\r\n        const projectTasks = tasks.filter(t => t.projectId === projectId);\r\n\r\n        projectTasks.forEach(task => {\r\n            const newTask = {\r\n                ...task,\r\n                id: taskCounter,\r\n                title: taskNameTransform(task.title),\r\n                projectId: newProject.id,\r\n                createdAt: new Date().toISOString(),\r\n                // Deep copy arrays\r\n                tags: task.tags ? [...task.tags] : [],\r\n                attachments: task.attachments ? JSON.parse(JSON.stringify(task.attachments)) : []\r\n            };\r\n\r\n            taskCounter++;\r\n            tasks.push(newTask);\r\n        });\r\n    }\r\n\r\n    // Record history\r\n    if (window.historyService) {\r\n        window.historyService.recordProjectCreated(newProject);\r\n    }\r\n\r\n    // Close modal\r\n    closeDuplicateProjectModal();\r\n\r\n    // Clear cache and update UI\r\n    appState.projectsSortedView = null;\r\n\r\n    // Show success notification\r\n    showSuccessNotification(\r\n        includeTasks\r\n            ? t('projects.duplicate.successWithTasks', { name: newProject.name })\r\n            : t('projects.duplicate.success', { name: newProject.name })\r\n    );\r\n\r\n    // Save in background\r\n    Promise.all([\r\n        saveProjects().catch(err => {\r\n            console.error('Failed to save projects:', err);\r\n            showErrorNotification(t('error.saveChangesFailed'));\r\n        }),\r\n        includeTasks ? saveTasks().catch(err => {\r\n            console.error('Failed to save tasks:', err);\r\n            showErrorNotification(t('error.saveChangesFailed'));\r\n        }) : Promise.resolve()\r\n    ]);\r\n\r\n    // Navigate to the new project\r\n    showProjectDetails(newProject.id, 'projects');\r\n}\r\n\r\nfunction backToProjects() {\r\n    // Hide project details\r\n    document.getElementById(\"project-details\").classList.remove(\"active\");\r\n\r\n    // Show user menu again when leaving project details\r\n    const userMenu = document.querySelector(\".user-menu\");\r\n    if (userMenu) userMenu.style.display = \"block\";\r\n\r\n    // Use the standard page switching mechanism\r\n    // Ensure the URL reflects the projects route so users can bookmark/share\r\n    try { window.location.hash = \"#projects\"; } catch (e) { /* ignore */ }\r\n    showPage(\"projects\");\r\n\r\n    // Update sidebar navigation\r\n    document\r\n        .querySelectorAll(\".nav-item\")\r\n        .forEach((nav) => nav.classList.remove(\"active\"));\r\n    document\r\n        .querySelector('.nav-item[data-page=\"projects\"]')\r\n        .classList.add(\"active\");\r\n\r\n    // Refresh projects list to show any changes made in project details\r\n    renderProjects();\r\n}\r\n\r\nfunction backToCalendar() {\r\n    // Hide project details\r\n    document.getElementById(\"project-details\").classList.remove(\"active\");\r\n\r\n    // Show user menu again when leaving project details\r\n    const userMenu = document.querySelector(\".user-menu\");\r\n    if (userMenu) userMenu.style.display = \"block\";\r\n\r\n    // Restore the calendar month/year the user came from (if known)\r\n    if (calendarNavigationState && Number.isInteger(calendarNavigationState.month) && Number.isInteger(calendarNavigationState.year)) {\r\n        currentMonth = calendarNavigationState.month;\r\n        currentYear = calendarNavigationState.year;\r\n        try { saveCalendarState(); } catch (e) {}\r\n    }\r\n\r\n    // Return to calendar and force a full render (month/year may have changed while in details)\r\n    showCalendarView();\r\n    renderCalendar();\r\n}\r\n\r\nfunction openTaskModalForProject(projectId) {\r\n    openTaskModal();\r\n    // Pre-select the project in the custom dropdown (only for this open)\r\n    const modal = document.getElementById('task-modal');\r\n    const hiddenProject = modal.querySelector('#hidden-project');\r\n    const projectTextSpan = modal.querySelector('#project-current .project-text');\r\n    const proj = projects.find(p => String(p.id) === String(projectId));\r\n    if (hiddenProject) hiddenProject.value = String(projectId || '');\r\n    if (projectTextSpan && proj) {\r\n        const colorSquare = `<span style=\"display: inline-block; width: 10px; height: 10px; background-color: ${getProjectColor(proj.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;\"></span>`;\r\n        projectTextSpan.innerHTML = colorSquare + escapeHtml(proj.name);\r\n    }\r\n    // Close any portal that might be lingering\r\n    if (typeof hideProjectDropdownPortal === 'function') hideProjectDropdownPortal();\r\n\r\n    // Recapture initial state after setting project\r\n    setTimeout(() => captureInitialTaskFormState(), 150);\r\n}\r\n\r\nfunction openSettingsModal() {\r\n      const modal = document.getElementById('settings-modal');\r\n      if (!modal) return;\r\n  \r\n      const form = modal.querySelector('#settings-form');\r\n      const userNameInput = form.querySelector('#user-name');\r\n      const autoStartToggle = form.querySelector('#auto-start-date-toggle');\r\n      const autoEndToggle = form.querySelector('#auto-end-date-toggle');\r\n      const enableReviewStatusToggle = form.querySelector('#enable-review-status-toggle');\r\n      const calendarIncludeBacklogToggle = form.querySelector('#calendar-include-backlog-toggle');\r\n      const debugLogsToggle = form.querySelector('#debug-logs-toggle');\r\n      const historySortOrderSelect = form.querySelector('#history-sort-order');\r\n      const languageSelect = form.querySelector('#language-select');\r\n\r\n    // Populate user name from authenticated user (KV-backed)\r\n    const currentUser = window.authSystem?.getCurrentUser();\r\n    userNameInput.value = currentUser?.name || '';\r\n  \r\n      const emailInput = form.querySelector('#user-email');\r\n      emailInput.value = currentUser?.email || settings.notificationEmail || '';\r\n\r\n      const emailEnabledToggle = form.querySelector('#email-notifications-enabled');\r\n      const emailWeekdaysOnlyToggle = form.querySelector('#email-notifications-weekdays-only');\r\n      const emailIncludeStartDatesToggle = form.querySelector('#email-notifications-include-start-dates');\r\n      const emailIncludeBacklogToggle = form.querySelector('#email-notifications-include-backlog');\r\n      const emailTimeInput = form.querySelector('#email-notification-time');\r\n      const emailTimeTrigger = form.querySelector('#email-notification-time-trigger');\r\n      const emailTimeValueEl = form.querySelector('#email-notification-time-value');\r\n      const emailTimeZoneSelect = form.querySelector('#email-notification-timezone');\r\n      const emailTimeZoneTrigger = form.querySelector('#email-notification-timezone-trigger');\r\n      const emailTimeZoneValueEl = form.querySelector('#email-notification-timezone-value');\r\n      const emailDetails = form.querySelector('#email-notification-details');\r\n\r\n      if (emailEnabledToggle) {\r\n          emailEnabledToggle.checked = settings.emailNotificationsEnabled !== false;\r\n      }\r\n      if (emailWeekdaysOnlyToggle) {\r\n          emailWeekdaysOnlyToggle.checked = !!settings.emailNotificationsWeekdaysOnly;\r\n      }\r\n      if (emailIncludeStartDatesToggle) {\r\n          emailIncludeStartDatesToggle.checked = !!settings.emailNotificationsIncludeStartDates;\r\n      }\r\n      if (emailIncludeBacklogToggle) {\r\n          emailIncludeBacklogToggle.checked = !!settings.emailNotificationsIncludeBacklog;\r\n      }\r\n      if (emailTimeInput) {\r\n          const snapped = snapHHMMToStep(\r\n              normalizeHHMM(settings.emailNotificationTime) || \"09:00\",\r\n              30\r\n          );\r\n          emailTimeInput.value = clampHHMMToRange(snapped || \"09:00\", \"08:00\", \"18:00\") || \"09:00\";\r\n          if (emailTimeValueEl) emailTimeValueEl.textContent = emailTimeInput.value;\r\n      }\r\n      if (emailTimeZoneSelect) {\r\n          // If no timezone is set, detect from browser\r\n          let timezoneToUse = settings.emailNotificationTimeZone;\r\n          if (!timezoneToUse) {\r\n              try {\r\n                  const browserTz = Intl.DateTimeFormat().resolvedOptions().timeZone;\r\n                  const availableTimezones = [\r\n                      \"America/Argentina/Buenos_Aires\",\r\n                      \"Atlantic/Canary\",\r\n                      \"Europe/Madrid\",\r\n                      \"UTC\"\r\n                  ];\r\n                  if (availableTimezones.includes(browserTz)) {\r\n                      timezoneToUse = browserTz;\r\n                  } else {\r\n                      timezoneToUse = \"Atlantic/Canary\";\r\n                  }\r\n              } catch (e) {\r\n                  timezoneToUse = \"Atlantic/Canary\";\r\n              }\r\n          }\r\n          \r\n          emailTimeZoneSelect.value = String(timezoneToUse);\r\n          if (emailTimeZoneValueEl) {\r\n              emailTimeZoneValueEl.textContent =\r\n                  emailTimeZoneSelect.options?.[emailTimeZoneSelect.selectedIndex]?.textContent ||\r\n                  emailTimeZoneSelect.value ||\r\n                  '';\r\n          }\r\n      }\r\n\r\n      const applyEmailNotificationInputState = () => {\r\n          const enabled = !!emailEnabledToggle?.checked;\r\n          if (emailDetails) {\r\n              emailDetails.classList.toggle('is-collapsed', !enabled);\r\n              emailDetails.setAttribute('aria-hidden', enabled ? 'false' : 'true');\r\n          }\r\n          if (emailWeekdaysOnlyToggle) emailWeekdaysOnlyToggle.disabled = !enabled;\r\n          if (emailIncludeStartDatesToggle) emailIncludeStartDatesToggle.disabled = !enabled;\r\n          if (emailTimeInput) emailTimeInput.disabled = !enabled;\r\n          if (emailTimeTrigger) emailTimeTrigger.disabled = !enabled;\r\n          if (emailTimeZoneSelect) emailTimeZoneSelect.disabled = !enabled;\r\n          if (emailTimeZoneTrigger) emailTimeZoneTrigger.disabled = !enabled;\r\n      };\r\n      applyEmailNotificationInputState();\r\n  \r\n      // Populate application settings\r\n      if (autoStartToggle) autoStartToggle.checked = !!settings.autoSetStartDateOnStatusChange;\r\n      if (autoEndToggle) autoEndToggle.checked = !!settings.autoSetEndDateOnStatusChange;\r\n      if (enableReviewStatusToggle) enableReviewStatusToggle.checked = !!settings.enableReviewStatus;\r\n      if (calendarIncludeBacklogToggle) calendarIncludeBacklogToggle.checked = !!settings.calendarIncludeBacklog;\r\n      if (debugLogsToggle) debugLogsToggle.checked = !!settings.debugLogsEnabled;\r\n      historySortOrderSelect.value = settings.historySortOrder;\r\n      if (languageSelect) languageSelect.value = getCurrentLanguage();\r\n\r\n      const logoFileInput = form.querySelector('#workspace-logo-input');\r\n      if (logoFileInput) {\r\n          logoFileInput.value = '';\r\n      }\r\n\r\n      // Reset any unsaved draft and refresh logo preview/clear button based on persisted settings\r\n      workspaceLogoDraft.hasPendingChange = false;\r\n      workspaceLogoDraft.dataUrl = null;\r\n      avatarDraft.hasPendingChange = false;\r\n      avatarDraft.dataUrl = null;\r\n      const logoPreview = form.querySelector('#workspace-logo-preview');\r\n      const clearButton = form.querySelector('#workspace-logo-clear-btn');\r\n      if (logoPreview && clearButton) {\r\n          if (settings.customWorkspaceLogo) {\r\n              logoPreview.style.display = 'block';\r\n              logoPreview.style.backgroundImage = `url(${settings.customWorkspaceLogo})`;\r\n              clearButton.style.display = 'inline-flex';\r\n          } else {\r\n              logoPreview.style.display = 'none';\r\n              logoPreview.style.backgroundImage = '';\r\n              clearButton.style.display = 'none';\r\n          }\r\n      }\r\n\r\n      // Also refresh workspace logo UI to update dropzone text (\"Change logo\" vs default)\r\n      // Note: setupWorkspaceLogoControls has its own refreshWorkspaceLogoUI function in its scope\r\n      // So we trigger it indirectly by dispatching an event or calling it directly if available\r\n      const refreshLogoEvent = new CustomEvent('refresh-workspace-logo-ui');\r\n      document.dispatchEvent(refreshLogoEvent);\r\n\r\n      const avatarFileInput = form.querySelector('#user-avatar-input');\r\n      if (avatarFileInput) {\r\n          avatarFileInput.value = '';\r\n      }\r\n      refreshUserAvatarSettingsUI();\r\n\r\n      // Capture initial settings form state for dirty-checking\r\n      window.initialSettingsFormState = {\r\n          userName: userNameInput.value || '',\r\n          notificationEmail: emailInput.value || '',\r\n          emailNotificationsEnabled: !!(emailEnabledToggle?.checked),\r\n          emailNotificationsWeekdaysOnly: !!(emailWeekdaysOnlyToggle?.checked),\r\n          emailNotificationsIncludeStartDates: !!(emailIncludeStartDatesToggle?.checked),\r\n          emailNotificationsIncludeBacklog: !!(emailIncludeBacklogToggle?.checked),\r\n          emailNotificationTime: emailTimeInput?.value || '',\r\n          emailNotificationTimeZone: emailTimeZoneSelect?.value || '',\r\n          autoSetStartDateOnStatusChange: !!settings.autoSetStartDateOnStatusChange,\r\n          autoSetEndDateOnStatusChange: !!settings.autoSetEndDateOnStatusChange,\r\n          enableReviewStatus: !!settings.enableReviewStatus,\r\n          calendarIncludeBacklog: !!(calendarIncludeBacklogToggle?.checked),\r\n          debugLogsEnabled: !!(debugLogsToggle?.checked),\r\n          historySortOrder: settings.historySortOrder || 'newest',\r\n          language: getCurrentLanguage(),\r\n          logoState: settings.customWorkspaceLogo ? 'logo-set' : 'logo-none',\r\n          avatarState: (window.authSystem?.getCurrentUser?.()?.avatarDataUrl ? 'avatar-set' : 'avatar-none')\r\n      };\r\n\r\n      // Reset save button dirty state\r\n      const saveBtn = form.querySelector('.settings-btn-save');\r\n      if (saveBtn) {\r\n          saveBtn.classList.remove('dirty');\r\n          saveBtn.disabled = true;\r\n      }\r\n\r\n      // Bind change listeners once to track dirtiness\r\n      if (!form.__settingsDirtyBound) {\r\n          form.__settingsDirtyBound = true;\r\n\r\n          const markDirtyIfNeeded = () => {\r\n              if (!window.initialSettingsFormState) return;\r\n\r\n              const currentLogoState = workspaceLogoDraft.hasPendingChange\r\n                  ? 'draft-changed'\r\n                  : (settings.customWorkspaceLogo ? 'logo-set' : 'logo-none');\r\n\r\n              const currentAvatarState = avatarDraft.hasPendingChange\r\n                  ? 'draft-changed'\r\n                  : (window.authSystem?.getCurrentUser?.()?.avatarDataUrl ? 'avatar-set' : 'avatar-none');\r\n\r\n              const current = {\r\n                  userName: userNameInput.value || '',\r\n                  notificationEmail: emailInput.value || '',\r\n                  emailNotificationsEnabled: !!(emailEnabledToggle?.checked),\r\n                  emailNotificationsWeekdaysOnly: !!(emailWeekdaysOnlyToggle?.checked),\r\n                  emailNotificationsIncludeStartDates: !!(emailIncludeStartDatesToggle?.checked),\r\n                  emailNotificationsIncludeBacklog: !!(emailIncludeBacklogToggle?.checked),\r\n                  emailNotificationTime: emailTimeInput?.value || '',\r\n                  emailNotificationTimeZone: emailTimeZoneSelect?.value || '',\r\n                  autoSetStartDateOnStatusChange: !!autoStartToggle?.checked,\r\n                  autoSetEndDateOnStatusChange: !!autoEndToggle?.checked,\r\n                  enableReviewStatus: !!enableReviewStatusToggle?.checked,\r\n                  calendarIncludeBacklog: !!(calendarIncludeBacklogToggle?.checked),\r\n                  debugLogsEnabled: !!(debugLogsToggle?.checked),\r\n                  historySortOrder: historySortOrderSelect.value,\r\n                  language: languageSelect?.value || getCurrentLanguage(),\r\n                  logoState: currentLogoState,\r\n                  avatarState: currentAvatarState\r\n              };\r\n\r\n              const isDirty =\r\n                  current.userName !== window.initialSettingsFormState.userName ||\r\n                  current.notificationEmail !== window.initialSettingsFormState.notificationEmail ||\r\n                  current.emailNotificationsEnabled !== window.initialSettingsFormState.emailNotificationsEnabled ||\r\n                  current.emailNotificationsWeekdaysOnly !== window.initialSettingsFormState.emailNotificationsWeekdaysOnly ||\r\n                  current.emailNotificationsIncludeBacklog !== window.initialSettingsFormState.emailNotificationsIncludeBacklog ||\r\n                  current.emailNotificationsIncludeStartDates !== window.initialSettingsFormState.emailNotificationsIncludeStartDates ||\r\n                  current.emailNotificationTime !== window.initialSettingsFormState.emailNotificationTime ||\r\n                  current.emailNotificationTimeZone !== window.initialSettingsFormState.emailNotificationTimeZone ||\r\n                  current.autoSetStartDateOnStatusChange !== window.initialSettingsFormState.autoSetStartDateOnStatusChange ||\r\n                  current.autoSetEndDateOnStatusChange !== window.initialSettingsFormState.autoSetEndDateOnStatusChange ||\r\n                  current.enableReviewStatus !== window.initialSettingsFormState.enableReviewStatus ||\r\n                  current.calendarIncludeBacklog !== window.initialSettingsFormState.calendarIncludeBacklog ||\r\n                  current.debugLogsEnabled !== window.initialSettingsFormState.debugLogsEnabled ||\r\n                  current.historySortOrder !== window.initialSettingsFormState.historySortOrder ||\r\n                  current.language !== window.initialSettingsFormState.language ||\r\n                  current.logoState !== window.initialSettingsFormState.logoState ||\r\n                  current.avatarState !== window.initialSettingsFormState.avatarState;\r\n\r\n              if (saveBtn) {\r\n                  if (isDirty) {\r\n                      saveBtn.classList.add('dirty');\r\n                      saveBtn.disabled = false;\r\n                  } else {\r\n                      saveBtn.classList.remove('dirty');\r\n                      saveBtn.disabled = true;\r\n                  }\r\n              }\r\n\r\n              window.settingsFormIsDirty = isDirty;\r\n          };\r\n\r\n          // Expose for logo controls to call after async updates\r\n          window.markSettingsDirtyIfNeeded = markDirtyIfNeeded;\r\n\r\n          // Listen to relevant inputs\r\n          [userNameInput, emailInput, emailEnabledToggle, emailWeekdaysOnlyToggle, emailIncludeBacklogToggle, emailIncludeStartDatesToggle, emailTimeInput, emailTimeZoneSelect, autoStartToggle, autoEndToggle, enableReviewStatusToggle, calendarIncludeBacklogToggle, debugLogsToggle, historySortOrderSelect, languageSelect, logoFileInput, avatarFileInput]\r\n              .filter(Boolean)\r\n              .forEach(el => {\r\n                  el.addEventListener('change', markDirtyIfNeeded);\r\n                  if (el.tagName === 'INPUT' && el.type === 'text' || el.type === 'email') {\r\n                      el.addEventListener('input', markDirtyIfNeeded);\r\n                  }\r\n              });\r\n\r\n          if (emailEnabledToggle && !emailEnabledToggle.__emailInputsBound) {\r\n              emailEnabledToggle.__emailInputsBound = true;\r\n              emailEnabledToggle.addEventListener('change', () => {\r\n                  applyEmailNotificationInputState();\r\n              });\r\n          }\r\n\r\n          if (emailTimeTrigger && !emailTimeTrigger.__notificationTimeBound) {\r\n              emailTimeTrigger.__notificationTimeBound = true;\r\n              emailTimeTrigger.addEventListener('click', (evt) => {\r\n                  evt.preventDefault();\r\n                  evt.stopPropagation();\r\n                  const enabled = !!emailEnabledToggle?.checked;\r\n                  if (!enabled) return;\r\n                  const isOpen = notificationTimePortalEl && notificationTimePortalEl.style.display !== 'none';\r\n                  if (isOpen) {\r\n                      hideNotificationTimePortal();\r\n                      return;\r\n                  }\r\n                  showNotificationTimePortal(emailTimeTrigger, emailTimeInput, emailTimeValueEl);\r\n              });\r\n          }\r\n\r\n          if (emailTimeZoneTrigger && emailTimeZoneSelect && !emailTimeZoneTrigger.__notificationTimeZoneBound) {\r\n              emailTimeZoneTrigger.__notificationTimeZoneBound = true;\r\n              emailTimeZoneTrigger.addEventListener('click', (evt) => {\r\n                  evt.preventDefault();\r\n                  evt.stopPropagation();\r\n                  const enabled = !!emailEnabledToggle?.checked;\r\n                  if (!enabled) return;\r\n                  const isOpen = notificationTimeZonePortalEl && notificationTimeZonePortalEl.style.display !== 'none';\r\n                  if (isOpen) {\r\n                      hideNotificationTimeZonePortal();\r\n                      return;\r\n                  }\r\n                  showNotificationTimeZonePortal(emailTimeZoneTrigger, emailTimeZoneSelect, emailTimeZoneValueEl);\r\n              });\r\n          }\r\n\r\n          if (emailTimeZoneSelect && emailTimeZoneValueEl && !emailTimeZoneSelect.__timezoneValueBound) {\r\n              emailTimeZoneSelect.__timezoneValueBound = true;\r\n              emailTimeZoneSelect.addEventListener('change', () => {\r\n                  emailTimeZoneValueEl.textContent =\r\n                      emailTimeZoneSelect.options?.[emailTimeZoneSelect.selectedIndex]?.textContent ||\r\n                      emailTimeZoneSelect.value ||\r\n                      '';\r\n              });\r\n          }\r\n  }\r\n  \r\n      modal.classList.add('active');\r\n\r\n      // Always reset scroll position to top when opening settings\r\n      const body = modal.querySelector('.settings-modal-body');\r\n      if (body) body.scrollTop = 0;\r\n    \r\n    // Add reset PIN button event listener (only once using delegation)\r\n    const resetPinBtn = modal.querySelector('#reset-pin-btn');\r\n    if (resetPinBtn && !resetPinBtn.dataset.listenerAttached) {\r\n        resetPinBtn.dataset.listenerAttached = 'true';\r\n        resetPinBtn.addEventListener('click', function(e) {\r\n            e.preventDefault();\r\n            resetPINFlow();\r\n        });\r\n    }\r\n}\r\n\r\n// Simplified user menu setup\r\nfunction closeUserDropdown() {\r\n    const dropdown = document.getElementById(\"shared-user-dropdown\");\r\n    if (dropdown) {\r\n        dropdown.classList.remove(\"active\");\r\n    }\r\n}\r\n\r\nfunction setupUserMenus() {\r\n    const avatar = document.getElementById(\"shared-user-avatar\");\r\n    const dropdown = document.getElementById(\"shared-user-dropdown\");\r\n\r\n    if (avatar && dropdown) {\r\n        // Remove any existing listener by cloning and replacing\r\n        const newAvatar = avatar.cloneNode(true);\r\n        avatar.parentNode.replaceChild(newAvatar, avatar);\r\n\r\n        // Add fresh listener\r\n        newAvatar.addEventListener(\"click\", function (e) {\r\n            e.stopPropagation();\r\n            closeNotificationDropdown();\r\n            dropdown.classList.toggle(\"active\");\r\n        });\r\n\r\n        // Close dropdown when clicking on any dropdown item (except disabled ones)\r\n        dropdown.addEventListener(\"click\", function (e) {\r\n            const item = e.target.closest(\".dropdown-item:not(.disabled)\");\r\n            if (item) {\r\n                closeUserDropdown();\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction updateUserDisplay(name, avatarDataUrl) {\r\n    const nameEl = document.querySelector(\".user-name\");\r\n    const avatarEl = document.getElementById(\"shared-user-avatar\");\r\n\r\n    if (nameEl) nameEl.textContent = name;\r\n    \r\n    // Update avatar initials\r\n    if (avatarEl) {\r\n        const parts = name.split(\" \").filter(Boolean);\r\n        let initials = \"NL\";\r\n        if (parts.length > 0) {\r\n            if (parts.length === 1) {\r\n                initials = parts[0].slice(0, 2).toUpperCase();\r\n            } else {\r\n                initials = (parts[0][0] + parts[parts.length - 1][0]).toUpperCase();\r\n            }\r\n        }\r\n\r\n        if (avatarDataUrl) {\r\n            avatarEl.classList.add('has-image');\r\n            avatarEl.style.backgroundImage = `url(${avatarDataUrl})`;\r\n            avatarEl.textContent = '';\r\n        } else {\r\n            avatarEl.classList.remove('has-image');\r\n            avatarEl.style.backgroundImage = '';\r\n            avatarEl.textContent = initials;\r\n        }\r\n    }\r\n}\r\n\r\nfunction hydrateUserProfile() {\r\n    // Get current user from auth system\r\n    const currentUser = window.authSystem?.getCurrentUser();\r\n    if (!currentUser) return; // Not logged in yet\r\n\r\n    updateUserDisplay(currentUser.name, currentUser.avatarDataUrl);\r\n\r\n    const emailEl = document.querySelector(\".user-email\");\r\n    if (emailEl) emailEl.textContent = currentUser.email || currentUser.username;\r\n}\r\n\r\nfunction normalizeTaskModalAttachmentUI() {\r\n    const addLinkBtn = document.querySelector('#task-modal [data-action=\"addAttachment\"]');\r\n    if (addLinkBtn) addLinkBtn.textContent = t('tasks.modal.addLink');\r\n}\r\n\r\n// Close dropdown when clicking outside\r\ndocument.addEventListener(\"click\", function (event) {\r\n    const clickedInUserMenu = event.target.closest(\".user-menu\");\r\n    if (!clickedInUserMenu) {\r\n        closeUserDropdown();\r\n    }\r\n    const clickedInNotifyMenu = event.target.closest(\".notify-menu\");\r\n    if (!clickedInNotifyMenu) {\r\n        closeNotificationDropdown();\r\n    }\r\n});\r\n\r\nfunction updateLogos() {\r\n    const isDark = document.documentElement.getAttribute(\"data-theme\") === \"dark\";\r\n    const logoSrc = isDark ? \"Nautilus_logo.png\" : \"Nautilus_logo_light.png\";\r\n\r\n    // Update all logo images (regular logos and boot splash logos)\r\n    // EXCLUDE lock/auth screen logos - they always have dark backgrounds and need white-text logo\r\n    document.querySelectorAll('img.logo, img[class*=\"boot-logo\"]').forEach(logo => {\r\n        // Skip logos inside lock screens or auth overlays (they always use white-text logo)\r\n        if (logo.closest('.overlay') || logo.closest('.auth-overlay')) {\r\n            return;\r\n        }\r\n        logo.src = logoSrc;\r\n    });\r\n}\r\n\r\nfunction updateThemeMenuText() {\r\n    const themeText = document.getElementById(\"theme-text\");\r\n    if (!themeText) return;\r\n    const isDark = document.documentElement.getAttribute(\"data-theme\") === \"dark\";\r\n    themeText.textContent = isDark ? t('menu.lightMode') : t('menu.darkMode');\r\n}\r\n\r\nfunction toggleTheme() {\r\n    const root = document.documentElement;\r\n\r\n    if (root.getAttribute(\"data-theme\") === \"dark\") {\r\n        root.removeAttribute(\"data-theme\");\r\n        localStorage.setItem(\"theme\", \"light\");\r\n    } else {\r\n        root.setAttribute(\"data-theme\", \"dark\");\r\n        localStorage.setItem(\"theme\", \"dark\");\r\n    }\r\n\r\n    updateThemeMenuText();\r\n\r\n    // Update logos for the new theme\r\n    updateLogos();\r\n\r\n    // Refresh calendar bars to update colors for new theme\r\n    if (typeof reflowCalendarBars === 'function') {\r\n        reflowCalendarBars();\r\n    }\r\n}\r\n\r\n// Load saved theme\r\nconst savedTheme = localStorage.getItem(\"theme\");\r\nif (savedTheme === \"dark\") {\r\n    document.documentElement.setAttribute(\"data-theme\", \"dark\");\r\n}\r\nupdateThemeMenuText();\r\n\r\n// Set correct logos on initial page load\r\nupdateLogos();\r\n\r\n\r\n// Resizable sidebar functionality\r\nlet isResizing = false;\r\n\r\ndocument.querySelector(\".resizer\").addEventListener(\"mousedown\", function (e) {\r\n    isResizing = true;\r\n    this.classList.add(\"dragging\");\r\n    document.body.style.cursor = \"col-resize\";\r\n    document.body.style.userSelect = \"none\";\r\n\r\n    e.preventDefault();\r\n});\r\n\r\ndocument.addEventListener(\"mousemove\", function (e) {\r\n    if (!isResizing) return;\r\n\r\n    const sidebar = document.querySelector(\".sidebar\");\r\n    const newWidth = e.clientX;\r\n\r\n    if (newWidth >= 200 && newWidth <= 500) {\r\n        sidebar.style.width = newWidth + \"px\";\r\n    }\r\n});\r\n\r\ndocument.addEventListener(\"mouseup\", function () {\r\n    if (isResizing) {\r\n        isResizing = false;\r\n        document.querySelector(\".resizer\").classList.remove(\"dragging\");\r\n        document.body.style.cursor = \"\";\r\n        document.body.style.userSelect = \"\";\r\n    }\r\n});\r\n\r\nfunction updateProjectField(projectId, field, value, options) {\r\n    const opts = options || {};\r\n    const shouldRender = opts.render !== false;\r\n\r\n    // 1. CORRECCI\u00D3N DE FORMATO: Convertir fecha de dd/mm/yyyy a yyyy-mm-dd\r\n    let updatedValue = value;\r\n    if (field === 'startDate' || field === 'endDate') {\r\n        // Si el valor parece una fecha dd/mm/yyyy, la convertimos a ISO para guardarla\r\n        if (looksLikeDMY(value)) {\r\n            updatedValue = toISOFromDMY(value);\r\n        }\r\n    }\r\n\r\n    // Capture old project state for history tracking\r\n    const oldProject = projects.find(p => p.id === projectId);\r\n    const oldProjectCopy = oldProject ? JSON.parse(JSON.stringify(oldProject)) : null;\r\n\r\n    // Avoid unnecessary rerenders/saves when the value didn't actually change\r\n    if (oldProject) {\r\n        const prev = oldProject[field];\r\n        const prevStr = typeof prev === 'string' ? prev : (prev || '');\r\n        const nextStr = typeof updatedValue === 'string' ? updatedValue : (updatedValue || '');\r\n        if (prevStr === nextStr) return;\r\n    }\r\n\r\n    // Use project service to update field\r\n    const result = updateProjectFieldService(projectId, field, updatedValue, projects);\r\n\r\n    if (result.project) {\r\n        projects = result.projects;\r\n        const project = result.project;\r\n\r\n        // Set updatedAt timestamp\r\n        project.updatedAt = new Date().toISOString();\r\n\r\n        // Clear sorted view cache to force refresh with updated project\r\n        appState.projectsSortedView = null;\r\n\r\n        // Record history for project update\r\n        if (window.historyService && oldProjectCopy) {\r\n            window.historyService.recordProjectUpdated(oldProjectCopy, project);\r\n        }\r\n\r\n        // Update UI immediately (optimistic update)\r\n        if (shouldRender) showProjectDetails(projectId);\r\n\r\n        // Always refresh calendar bars if the calendar is visible (date changes affect layout)\r\n        if (document.getElementById('calendar-view')?.classList.contains('active')) {\r\n            reflowCalendarBars();\r\n        }\r\n\r\n        // Save in background (don't block UI)\r\n        saveProjects().catch(err => {\r\n            console.error('Failed to save project field:', err);\r\n            showErrorNotification(t('error.saveChangesFailed'));\r\n        });\r\n    }\r\n}\r\n\r\n// Expose for any inline handlers (HTML attribute callbacks run in global scope even when app.js is a module)\r\nwindow.updateProjectField = updateProjectField;\r\nwindow.debouncedUpdateProjectField = typeof debouncedUpdateProjectField === 'function' ? debouncedUpdateProjectField : undefined;\r\nwindow.flushDebouncedProjectField = typeof flushDebouncedProjectField === 'function' ? flushDebouncedProjectField : undefined;\r\n\r\n// Re-render calendar if the view is active, used after date changes\r\nfunction maybeRefreshCalendar() {\r\n    const calendarActive = document.getElementById('calendar-view')?.classList.contains('active');\r\n    if (calendarActive) {\r\n        // Re-render to recompute rows/tracks and spacer heights\r\n        renderCalendar();\r\n    }\r\n}\r\n\r\nfunction showCalendarView() {\r\n    // Track whether we're already on the calendar sub-view\r\n    const alreadyOnCalendar =\r\n        document.getElementById('tasks')?.classList.contains('active') &&\r\n        document.getElementById('calendar-view')?.classList.contains('active');\r\n\r\n    // Update URL hash to calendar for bookmarking (avoid redundant hashchange)\r\n    if (window.location.hash !== '#calendar') {\r\n        window.location.hash = 'calendar';\r\n    }\r\n\r\n    // Only switch page if not already on tasks page\r\n    if (!document.getElementById('tasks')?.classList.contains('active')) {\r\n        showPage(\"tasks\");\r\n    }\r\n\r\n    // Keep Calendar highlighted in sidebar (not All Tasks)\r\n    document\r\n        .querySelectorAll(\".nav-item\")\r\n        .forEach((nav) => nav.classList.remove(\"active\"));\r\n    document.querySelector(\".nav-item.calendar-nav\").classList.add(\"active\");\r\n\r\n    // Hide the view toggle when accessing from Calendar nav\r\n    const viewToggle = document.querySelector(\".view-toggle\");\r\n    if (viewToggle) viewToggle.classList.add(\"hidden\");\r\n\r\n    // Hide kanban settings in calendar view\r\n    const kanbanSettingsContainer = document.getElementById('kanban-settings-btn')?.parentElement;\r\n    if (kanbanSettingsContainer) kanbanSettingsContainer.style.display = 'none';\r\n\r\n    // Hide backlog button in calendar view (only show in Kanban)\r\n    const backlogBtn = document.getElementById('backlog-quick-btn');\r\n    if (backlogBtn) backlogBtn.style.display = 'none';\r\n\r\n    // Hide other views and show calendar (idempotent)\r\n    const kanban = document.querySelector(\".kanban-board\");\r\n    const list = document.getElementById(\"list-view\");\r\n    const calendar = document.getElementById(\"calendar-view\");\r\n    if (kanban && !kanban.classList.contains('hidden')) kanban.classList.add('hidden');\r\n    if (list && list.classList.contains('active')) list.classList.remove('active');\r\n    if (calendar && !calendar.classList.contains('active')) calendar.classList.add('active');\r\n\r\n    // mark header so the Add Task button aligns left like in Projects\r\n    try{ document.querySelector('.kanban-header')?.classList.add('calendar-mode'); }catch(e){}\r\n\r\n    // Update page title to \"Calendar\" on desktop\r\n    const pageTitle = document.querySelector('#tasks .page-title');\r\n    if (pageTitle) pageTitle.textContent = 'Calendar';\r\n\r\n    // If we were already on calendar, just reflow bars to avoid flicker\r\n    if (alreadyOnCalendar) {\r\n        reflowCalendarBars();\r\n    } else {\r\n        renderCalendar();\r\n    }\r\n    // Make sure UI chrome (sort toggle) reflects the calendar state\r\n    try { updateSortUI(); } catch (e) {}\r\n}\r\n\r\n// Lightweight refresh that only recomputes and draws project bars/spacers\r\nfunction reflowCalendarBars() {\r\n    if (!document.getElementById('calendar-view')?.classList.contains('active')) return;\r\n    requestAnimationFrame(() => requestAnimationFrame(renderProjectBars));\r\n}\r\n\r\n\r\nfunction migrateDatesToISO() {\r\n    let touched = false;\r\n\r\n    tasks.forEach((t) => {\r\n        if (t.startDate && looksLikeDMY(t.startDate)) {\r\n            t.startDate = toISOFromDMY(t.startDate);\r\n            touched = true;\r\n        }\r\n        if (t.endDate && looksLikeDMY(t.endDate)) {\r\n            t.endDate = toISOFromDMY(t.endDate);\r\n            touched = true;\r\n        }\r\n    });\r\n\r\n    projects.forEach((p) => {\r\n        if (p.startDate && looksLikeDMY(p.startDate)) {\r\n            p.startDate = toISOFromDMY(p.startDate);\r\n            touched = true;\r\n        }\r\n        if (p.endDate && looksLikeDMY(p.endDate)) {\r\n            p.endDate = toISOFromDMY(p.endDate);\r\n            touched = true;\r\n        }\r\n    });\r\n\r\n    if (touched) persistAll();\r\n}\r\n\r\nasync function addFeedbackItem() {\r\n    const typeRadio = document.querySelector('input[name=\"feedback-type\"]:checked');\r\n    const type = typeRadio ? typeRadio.value : 'bug';\r\n    const description = document.getElementById('feedback-description').value.trim();\r\n    const screenshotUrl = currentFeedbackScreenshotData || '';\r\n\r\n    if (!description) return;\r\n\r\n    const item = {\r\n        id: feedbackCounter++,\r\n        type: type,\r\n        description: description,\r\n        screenshotUrl: screenshotUrl,\r\n        createdAt: new Date().toISOString().split('T')[0],\r\n        status: 'open'\r\n    };\r\n\r\n    // Add to array immediately (optimistic update)\r\n    feedbackItems.unshift(item);\r\n    \r\n    // Clear input immediately for instant feedback\r\n    document.getElementById('feedback-description').value = '';\r\n    clearFeedbackScreenshot();\r\n\r\n    // Reset to page 1 for pending items so new item is visible immediately\r\n    feedbackPendingPage = 1;\r\n\r\n    // Update UI INSTANTLY - no delays, no debouncing\r\n    updateCounts();\r\n    renderFeedback();\r\n\r\n    // Cache immediately for instant persistence\r\n    persistFeedbackCache();\r\n\r\n    // Save in background (non-blocking, async with retry)\r\n    saveFeedbackWithRetry();\r\n\r\n    // Scroll to top of pending section on mobile for instant visibility\r\n    if (getIsMobileCached()) {\r\n        requestAnimationFrame(() => {\r\n            const pendingContainer = document.getElementById('feedback-list-pending');\r\n            if (pendingContainer) {\r\n                pendingContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n\r\n// Add enter key support for feedback and initialize screenshot attachments\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n    // Initialize feedback type dropdown\r\n    const feedbackTypeBtn = document.getElementById('feedback-type-btn');\r\n    const feedbackTypeGroup = document.getElementById('feedback-type-group');\r\n    const feedbackTypeLabel = document.getElementById('feedback-type-label');\r\n\r\n    updateFeedbackSaveStatus();\r\n    window.addEventListener('online', () => {\r\n        updateFeedbackSaveStatus();\r\n        // Retry save if there are unsaved changes\r\n        if (feedbackItems.length > 0 && !feedbackSaveInProgress) {\r\n            saveFeedbackWithRetry();\r\n        }\r\n    });\r\n    window.addEventListener('offline', updateFeedbackSaveStatus);\r\n\r\n    if (feedbackTypeBtn && feedbackTypeGroup) {\r\n        feedbackTypeBtn.addEventListener('click', function(e) {\r\n            e.stopPropagation();\r\n            feedbackTypeGroup.classList.toggle('open');\r\n        });\r\n\r\n        const typeRadios = document.querySelectorAll('input[name=\"feedback-type\"]');\r\n        typeRadios.forEach(radio => {\r\n            radio.addEventListener('change', function() {\r\n                const labelMap = {\r\n                    bug: t('feedback.type.bugLabel'),\r\n                    idea: t('feedback.type.improvementOption')\r\n                };\r\n                const selectedLabel = labelMap[this.value] || this.closest('label').textContent.trim();\r\n                feedbackTypeLabel.textContent = selectedLabel;\r\n                feedbackTypeGroup.classList.remove('open');\r\n            });\r\n        });\r\n\r\n        document.addEventListener('click', function(e) {\r\n            if (!feedbackTypeGroup.contains(e.target)) {\r\n                feedbackTypeGroup.classList.remove('open');\r\n            }\r\n        });\r\n    }\r\n\r\n    const feedbackInput = document.getElementById('feedback-description');\r\n    if (feedbackInput) {\r\n        feedbackInput.addEventListener('keypress', function(e) {\r\n            if (e.key === 'Enter') {\r\n                e.preventDefault();\r\n                addFeedbackItem();\r\n            }\r\n        });\r\n\r\n        // Allow pasting images directly into the feedback description\r\n        feedbackInput.addEventListener('paste', function(e) {\r\n            if (!e.clipboardData) return;\r\n            const file = Array.from(e.clipboardData.files || [])[0];\r\n            if (file && file.type && file.type.startsWith('image/')) {\r\n                e.preventDefault();\r\n                handleFeedbackImageFile(file);\r\n            }\r\n        });\r\n    }\r\n\r\n    const screenshotInput = document.getElementById('feedback-screenshot-url');\r\n    const screenshotFileInput = document.getElementById('feedback-screenshot-file');\r\n    const screenshotButton = document.getElementById('feedback-screenshot-upload');\r\n\r\n    const isMobileScreen = (typeof window.matchMedia === 'function')\r\n        ? window.matchMedia('(max-width: 768px)').matches\r\n        : getIsMobileCached();\r\n    const screenshotDefaultText = isMobileScreen\r\n        ? t('feedback.screenshotDropzoneTap')\r\n        : t('feedback.screenshotDropzoneDefault');\r\n\r\n    if (screenshotInput) {\r\n        screenshotInput.textContent = screenshotDefaultText;\r\n        screenshotInput.classList.add('feedback-screenshot-dropzone');\r\n        screenshotInput.dataset.defaultText = screenshotDefaultText;\r\n    }\r\n\r\n    let screenshotPreview = document.getElementById('feedback-screenshot-preview');\r\n    if (!screenshotPreview) {\r\n        const feedbackBar = document.querySelector('#feedback .feedback-input-bar');\r\n        if (feedbackBar && feedbackBar.parentNode) {\r\n            screenshotPreview = document.createElement('div');\r\n            screenshotPreview.id = 'feedback-screenshot-preview';\r\n            feedbackBar.parentNode.insertBefore(screenshotPreview, feedbackBar.nextSibling);\r\n        }\r\n    }\r\n\r\n    function handleDropOrPasteFileList(fileList, event) {\r\n        if (!fileList || fileList.length === 0) return;\r\n        const file = fileList[0];\r\n        if (!file.type || !file.type.startsWith('image/')) {\r\n            if (typeof showErrorNotification === 'function') {\r\n                showErrorNotification(t('error.feedbackAttachImage'));\r\n            }\r\n            return;\r\n        }\r\n        if (event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n        }\r\n        handleFeedbackImageFile(file);\r\n    }\r\n\r\n    if (screenshotInput) {\r\n        // Drag-and-drop support on the screenshot field\r\n        screenshotInput.addEventListener('dragover', function(e) {\r\n            e.preventDefault();\r\n            screenshotInput.classList.add('feedback-screenshot-dragover');\r\n        });\r\n\r\n        screenshotInput.addEventListener('dragleave', function(e) {\r\n            e.preventDefault();\r\n            screenshotInput.classList.remove('feedback-screenshot-dragover');\r\n        });\r\n\r\n        screenshotInput.addEventListener('drop', function(e) {\r\n            screenshotInput.classList.remove('feedback-screenshot-dragover');\r\n            const files = e.dataTransfer && e.dataTransfer.files;\r\n            handleDropOrPasteFileList(files, e);\r\n        });\r\n\r\n        // Paste images into the screenshot field\r\n        screenshotInput.addEventListener('paste', function(e) {\r\n            if (!e.clipboardData) return;\r\n            const files = e.clipboardData.files;\r\n            if (files && files.length > 0) {\r\n                handleDropOrPasteFileList(files, e);\r\n            }\r\n        });\r\n\r\n        // Click / keyboard to open file picker\r\n        screenshotInput.addEventListener('click', function() {\r\n            if (screenshotFileInput) {\r\n                screenshotFileInput.click();\r\n            }\r\n        });\r\n        screenshotInput.addEventListener('keydown', function(e) {\r\n            if (e.key === 'Enter' || e.key === ' ') {\r\n                e.preventDefault();\r\n                if (screenshotFileInput) {\r\n                    screenshotFileInput.click();\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    if (screenshotButton) {\r\n        // Hide legacy separate button, the dropzone now handles click\r\n        screenshotButton.style.display = 'none';\r\n    }\r\n\r\n    if (screenshotFileInput) {\r\n        screenshotFileInput.addEventListener('change', function(e) {\r\n            const files = e.target.files;\r\n            if (files && files.length > 0) {\r\n                handleDropOrPasteFileList(files, e);\r\n            }\r\n            // Reset so selecting the same file again will still fire change\r\n            screenshotFileInput.value = '';\r\n        });\r\n    }\r\n});\r\n\r\nfunction handleFeedbackImageFile(file) {\r\n    if (!file || !file.type || !file.type.startsWith('image/')) return;\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = function(ev) {\r\n        const dataUrl = ev.target && ev.target.result;\r\n        if (!dataUrl) return;\r\n        currentFeedbackScreenshotData = dataUrl;\r\n\r\n        const screenshotInput = document.getElementById('feedback-screenshot-url');\r\n        if (screenshotInput && screenshotInput.dataset) {\r\n            screenshotInput.dataset.hasInlineImage = 'true';\r\n        }\r\n\r\n        const preview = document.getElementById('feedback-screenshot-preview');\r\n        if (preview) {\r\n            preview.innerHTML = `\r\n                <div class=\"feedback-screenshot-preview-card\">\r\n                    <div class=\"feedback-screenshot-thumb\">\r\n                        <img src=\"${dataUrl}\" alt=\"${t('feedback.screenshotPreviewAlt')}\">\r\n                    </div>\r\n                    <div class=\"feedback-screenshot-meta\">\r\n                        <div class=\"feedback-screenshot-title\">${t('feedback.screenshotPreviewTitle')}</div>\r\n                        <div class=\"feedback-screenshot-subtitle\">${t('feedback.screenshotPreviewSubtitle')}</div>\r\n                    </div>\r\n                    <button type=\"button\" class=\"feedback-screenshot-remove\">${t('feedback.screenshotRemove')}</button>\r\n                </div>\r\n            `;\r\n\r\n            preview.style.display = 'flex';\r\n\r\n            const thumb = preview.querySelector('.feedback-screenshot-thumb');\r\n            if (thumb && typeof viewImageLegacy === 'function') {\r\n                thumb.onclick = function() {\r\n                    viewImageLegacy(dataUrl, 'Feedback Screenshot');\r\n                };\r\n            }\r\n\r\n            const removeBtn = preview.querySelector('.feedback-screenshot-remove');\r\n            if (removeBtn) {\r\n                removeBtn.onclick = function(e) {\r\n                    e.preventDefault();\r\n                    clearFeedbackScreenshot();\r\n                };\r\n            }\r\n        }\r\n    };\r\n    reader.onerror = function() {\r\n        if (typeof showErrorNotification === 'function') {\r\n            showErrorNotification(t('error.feedbackReadImage'));\r\n        }\r\n    };\r\n    reader.readAsDataURL(file);\r\n}\r\n\r\nfunction clearFeedbackScreenshot() {\r\n    currentFeedbackScreenshotData = \"\";\r\n    const screenshotInput = document.getElementById('feedback-screenshot-url');\r\n    if (screenshotInput) {\r\n        const defaultText = screenshotInput.dataset.defaultText || t('feedback.screenshotDropzoneDefault');\r\n        screenshotInput.textContent = defaultText;\r\n        if (screenshotInput.dataset) {\r\n            delete screenshotInput.dataset.hasInlineImage;\r\n        }\r\n    }\r\n    const preview = document.getElementById('feedback-screenshot-preview');\r\n    if (preview) {\r\n        preview.innerHTML = '';\r\n        preview.style.display = 'none';\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction toggleFeedbackItem(id) {\r\n    const item = feedbackItems.find(f => f.id === id);\r\n    if (!item) return;\r\n\r\n    // Store old state for rollback\r\n    const oldStatus = item.status;\r\n    const oldResolvedAt = item.resolvedAt;\r\n\r\n    // Optimistic update: change state immediately\r\n    if (item.status === 'open') {\r\n        item.status = 'done';\r\n        item.resolvedAt = new Date().toISOString();\r\n    } else {\r\n        item.status = 'open';\r\n        delete item.resolvedAt;\r\n    }\r\n    \r\n    // Update UI INSTANTLY - no delays\r\n    updateCounts();\r\n    renderFeedback();\r\n    \r\n    // Cache immediately for instant persistence\r\n    persistFeedbackCache();\r\n\r\n    // Save in background (non-blocking, async with retry)\r\n    saveFeedbackWithRetry().catch(() => {\r\n        // Rollback on persistent failure\r\n        item.status = oldStatus;\r\n        if (oldResolvedAt) {\r\n            item.resolvedAt = oldResolvedAt;\r\n        } else {\r\n            delete item.resolvedAt;\r\n        }\r\n        updateCounts();\r\n        renderFeedback();\r\n        showErrorNotification(t('error.feedbackStatusFailed'));\r\n    });\r\n}\r\n\r\nfunction renderFeedback() {\r\n    // Only render if feedback page is active (guarantee UI updates)\r\n    const feedbackPage = document.getElementById('feedback');\r\n    if (!feedbackPage || !feedbackPage.classList.contains('active')) {\r\n        // Page not active - UI will update when page becomes active\r\n        return;\r\n    }\r\n\r\n    const pendingContainer = document.getElementById('feedback-list-pending');\r\n    const doneContainer = document.getElementById('feedback-list-done');\r\n    if (!pendingContainer || !doneContainer) {\r\n        // Containers don't exist yet - will render when page loads\r\n        return;\r\n    }\r\n\r\n    const typeIcons = {\r\n        bug: '\\u{1F41E}',\r\n        improvement: '\\u{1F4A1}',\r\n        // Legacy values for backward compatibility\r\n        feature: '\\u{1F4A1}',\r\n        idea: '\\u{1F4A1}'\r\n    };\r\n\r\n    // Filter and sort: pending by createdAt (newest first), done by resolvedAt (newest first)\r\n    // Optimized: Use single pass filter for better performance on mobile\r\n    const pendingItems = [];\r\n    const doneItems = [];\r\n    for (const f of feedbackItems) {\r\n        if (f.status === 'open') {\r\n            pendingItems.push(f);\r\n        } else {\r\n            doneItems.push(f);\r\n        }\r\n    }\r\n    pendingItems.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));\r\n    doneItems.sort((a, b) => new Date(b.resolvedAt || b.createdAt) - new Date(a.resolvedAt || a.createdAt));\r\n\r\n    // Pagination calculations for pending items\r\n    const pendingTotalPages = Math.ceil(pendingItems.length / FEEDBACK_ITEMS_PER_PAGE);\r\n    if (feedbackPendingPage > pendingTotalPages && pendingTotalPages > 0) {\r\n        feedbackPendingPage = pendingTotalPages;\r\n    }\r\n    const pendingStartIndex = (feedbackPendingPage - 1) * FEEDBACK_ITEMS_PER_PAGE;\r\n    const pendingEndIndex = pendingStartIndex + FEEDBACK_ITEMS_PER_PAGE;\r\n    const pendingPageItems = pendingItems.slice(pendingStartIndex, pendingEndIndex);\r\n\r\n    // Pagination calculations for done items\r\n    const doneTotalPages = Math.ceil(doneItems.length / FEEDBACK_ITEMS_PER_PAGE);\r\n    if (feedbackDonePage > doneTotalPages && doneTotalPages > 0) {\r\n        feedbackDonePage = doneTotalPages;\r\n    }\r\n    const doneStartIndex = (feedbackDonePage - 1) * FEEDBACK_ITEMS_PER_PAGE;\r\n    const doneEndIndex = doneStartIndex + FEEDBACK_ITEMS_PER_PAGE;\r\n    const donePageItems = doneItems.slice(doneStartIndex, doneEndIndex);\r\n\r\n    // Render pending items - use DocumentFragment for better performance on mobile\r\n    if (pendingItems.length === 0) {\r\n        pendingContainer.innerHTML = `<div class=\"empty-state\" style=\"padding: 20px;\"><p>${t('feedback.empty.pending')}</p></div>`;\r\n    } else {\r\n        // Direct innerHTML assignment is fastest for instant rendering\r\n        pendingContainer.innerHTML = pendingPageItems.map(item => `\r\n            <div class=\"feedback-item ${item.status === 'done' ? 'done' : ''}\">\r\n                <input type=\"checkbox\" class=\"feedback-checkbox\"\r\n                       data-feedback-id=\"${item.id}\"\r\n                       ${item.status === 'done' ? 'checked' : ''}>\r\n                <span class=\"feedback-type-icon\">${typeIcons[item.type] || '\\u{1F4A1}'}</span>\r\n                ${item.screenshotUrl ? `<button type=\"button\" class=\"feedback-screenshot-link\" data-action=\"viewFeedbackScreenshot\" data-param=\"${encodeURIComponent(item.screenshotUrl)}\" title=\"${t('feedback.viewScreenshotTitle')}\">\\u{1F5BC}\\u{FE0F}</button>` : ''}\r\n                <div class=\"feedback-description\">${escapeHtml(item.description)}</div>\r\n                <div class=\"feedback-date\">${formatDate(item.createdAt)}</div>\r\n                <button class=\"feedback-delete-btn\" data-action=\"deleteFeedbackItemWithStop\" data-param=\"${item.id}\">\u274C</button>\r\n            </div>\r\n        `).join('');\r\n    }\r\n\r\n    // Render pagination controls for pending items\r\n    renderFeedbackPagination('pending', pendingItems.length, pendingTotalPages, feedbackPendingPage);\r\n\r\n    // Render done items\r\n    if (doneItems.length === 0) {\r\n        doneContainer.innerHTML = `<div class=\"empty-state\" style=\"padding: 20px;\"><p>${t('feedback.empty.done')}</p></div>`;\r\n    } else {\r\n        doneContainer.innerHTML = donePageItems.map(item => `\r\n            <div class=\"feedback-item done\">\r\n                <input type=\"checkbox\" class=\"feedback-checkbox\"\r\n                       data-feedback-id=\"${item.id}\"\r\n                       checked>\r\n                <span class=\"feedback-type-icon\">${typeIcons[item.type] || '\\u{1F4A1}'}</span>\r\n                ${item.screenshotUrl ? `<button type=\"button\" class=\"feedback-screenshot-link\" data-action=\"viewFeedbackScreenshot\" data-param=\"${encodeURIComponent(item.screenshotUrl)}\" title=\"${t('feedback.viewScreenshotTitle')}\">\\u{1F5BC}\\u{FE0F}</button>` : ''}\r\n                <div class=\"feedback-description\">${escapeHtml(item.description)}</div>\r\n                <div class=\"feedback-date\">${formatDate(item.createdAt)}</div>\r\n                <button class=\"feedback-delete-btn\" data-action=\"deleteFeedbackItemWithStop\" data-param=\"${item.id}\">\u274C</button>\r\n            </div>\r\n        `).join('');\r\n    }\r\n\r\n    // Render pagination controls for done items\r\n    renderFeedbackPagination('done', doneItems.length, doneTotalPages, feedbackDonePage);\r\n}\r\n\r\nfunction renderFeedbackPagination(section, totalItems, totalPages, currentPage) {\r\n    const containerId = section === 'pending' ? 'feedback-pagination-pending' : 'feedback-pagination-done';\r\n    const container = document.getElementById(containerId);\r\n    if (!container) return;\r\n\r\n    // Hide pagination if there's only one page or no items\r\n    if (totalPages <= 1) {\r\n        container.innerHTML = '';\r\n        container.style.display = 'none';\r\n        return;\r\n    }\r\n\r\n    container.style.display = 'flex';\r\n\r\n    const startItem = (currentPage - 1) * FEEDBACK_ITEMS_PER_PAGE + 1;\r\n    const endItem = Math.min(currentPage * FEEDBACK_ITEMS_PER_PAGE, totalItems);\r\n\r\n    let paginationHTML = `\r\n        <div class=\"feedback-pagination-info\">\r\n            ${t('feedback.pagination.showing', { start: startItem, end: endItem, total: totalItems })}\r\n        </div>\r\n        <div class=\"feedback-pagination-controls\">\r\n            <button\r\n                class=\"feedback-pagination-btn\"\r\n                onclick=\"changeFeedbackPage('${section}', 1)\"\r\n                ${currentPage === 1 ? 'disabled' : ''}\r\n                title=\"${t('feedback.pagination.first')}\">\r\n                &laquo;\r\n            </button>\r\n            <button\r\n                class=\"feedback-pagination-btn\"\r\n                onclick=\"changeFeedbackPage('${section}', ${currentPage - 1})\"\r\n                ${currentPage === 1 ? 'disabled' : ''}\r\n                title=\"${t('feedback.pagination.prev')}\">\r\n                &lsaquo;\r\n            </button>\r\n            <span class=\"feedback-pagination-page\">\r\n                ${t('feedback.pagination.pageOf', { current: currentPage, total: totalPages })}\r\n            </span>\r\n            <button\r\n                class=\"feedback-pagination-btn\"\r\n                onclick=\"changeFeedbackPage('${section}', ${currentPage + 1})\"\r\n                ${currentPage === totalPages ? 'disabled' : ''}\r\n                title=\"${t('feedback.pagination.next')}\">\r\n                &rsaquo;\r\n            </button>\r\n            <button\r\n                class=\"feedback-pagination-btn\"\r\n                onclick=\"changeFeedbackPage('${section}', ${totalPages})\"\r\n                ${currentPage === totalPages ? 'disabled' : ''}\r\n                title=\"${t('feedback.pagination.last')}\">\r\n                &raquo;\r\n            </button>\r\n        </div>\r\n    `;\r\n\r\n    container.innerHTML = paginationHTML;\r\n}\r\n\r\nfunction changeFeedbackPage(section, newPage) {\r\n    const scrollContainer = document.querySelector('#feedback .page-content');\r\n    const activeEl = document.activeElement;\r\n    const wasPaginationClick = !!(activeEl && activeEl.classList && activeEl.classList.contains('feedback-pagination-btn'));\r\n    const wasNearBottom = !!(scrollContainer && (scrollContainer.scrollHeight - (scrollContainer.scrollTop + scrollContainer.clientHeight) < 80));\r\n\r\n    if (section === 'pending') {\r\n        feedbackPendingPage = newPage;\r\n    } else {\r\n        feedbackDonePage = newPage;\r\n    }\r\n    renderFeedback();\r\n\r\n    // Keep pagination usable when switching between short/long pages.\r\n    // If the user was at (or near) the bottom, anchor them back to the pagination controls.\r\n    const paginationId = section === 'pending' ? 'feedback-pagination-pending' : 'feedback-pagination-done';\r\n    const sectionId = section === 'pending' ? 'feedback-list-pending' : 'feedback-list-done';\r\n    const targetId = (wasPaginationClick || wasNearBottom) ? paginationId : sectionId;\r\n    const target = document.getElementById(targetId);\r\n    if (target) {\r\n        requestAnimationFrame(() => {\r\n            requestAnimationFrame(() => {\r\n                target.scrollIntoView({\r\n                    behavior: 'smooth',\r\n                    block: targetId === paginationId ? 'end' : 'start'\r\n                });\r\n            });\r\n        });\r\n    }\r\n}\r\n\r\n// Expose to window for onclick handlers\r\nwindow.changeFeedbackPage = changeFeedbackPage;\r\n\r\n// === History Rendering - Inline for Tasks and Projects ===\r\n\r\n// Modal tab switching\r\nfunction setupModalTabs() {\r\n    document.querySelectorAll('.modal-content .modal-tab').forEach(tab => {\r\n        tab.addEventListener('click', (e) => {\r\n            const tabName = e.target.dataset.tab;\r\n            const modalContent = e.target.closest('.modal-content');\r\n            if (!modalContent) return;\r\n\r\n            // Preserve the current task modal size when switching to History (desktop),\r\n            // so the modal doesn't shrink just because History has less content.\r\n            try {\r\n                const isTaskModal = !!modalContent.closest('#task-modal');\r\n                if (isTaskModal) {\r\n                    const footer = modalContent.querySelector('#task-footer');\r\n                    const inEditMode = footer && window.getComputedStyle(footer).display === 'none';\r\n                    if (inEditMode) {\r\n                        if (tabName === 'history') {\r\n                            const h = Math.round(modalContent.getBoundingClientRect().height);\r\n                            if (h > 0) {\r\n                                modalContent.style.minHeight = `${h}px`;\r\n                                modalContent.style.maxHeight = `${h}px`;\r\n                            }\r\n                        } else if (tabName === 'general' || tabName === 'details') {\r\n                            modalContent.style.minHeight = '';\r\n                            modalContent.style.maxHeight = '';\r\n                        }\r\n                    }\r\n                }\r\n            } catch (err) {}\r\n\r\n            // Update tab buttons\r\n            modalContent.querySelectorAll('.modal-tab').forEach(t => t.classList.remove('active'));\r\n            e.target.classList.add('active');\r\n\r\n            // Mobile: Handle General/Details tab switching (on same content)\r\n            if (tabName === 'general' || tabName === 'details') {\r\n                // Both tabs show the same content (task-details-tab with different fields visible)\r\n                const taskDetailsTab = modalContent.querySelector('#task-details-tab');\r\n                const taskHistoryTab = modalContent.querySelector('#task-history-tab');\r\n\r\n                // Only handle mobile tab switching if we have history tab (means modal is open)\r\n                if (taskDetailsTab && taskHistoryTab) {\r\n                    // Make sure details tab is active\r\n                    modalContent.querySelectorAll('.modal-tab-content').forEach(content => {\r\n                        content.classList.remove('active');\r\n                    });\r\n                    taskDetailsTab.classList.add('active');\r\n\r\n                    // Toggle body class to show/hide appropriate fields\r\n                    if (tabName === 'details') {\r\n                        document.body.classList.add('mobile-tab-details-active');\r\n                    } else {\r\n                        document.body.classList.remove('mobile-tab-details-active');\r\n                    }\r\n                    return; // Don't run the rest of the tab switching logic\r\n                }\r\n            }\r\n\r\n            // Remove mobile tab class when switching to History\r\n            document.body.classList.remove('mobile-tab-details-active');\r\n\r\n            // Update tab content\r\n            modalContent.querySelectorAll('.modal-tab-content').forEach(content => {\r\n                content.classList.remove('active');\r\n            });\r\n\r\n            const targetTab = modalContent.querySelector(`#task-${tabName}-tab`);\r\n            if (targetTab) {\r\n                targetTab.classList.add('active');\r\n\r\n                // If switching to history tab, render the history and reset scroll\r\n                if (tabName === 'history') {\r\n                    const form = document.getElementById('task-form');\r\n                    const editingTaskId = form?.dataset.editingTaskId;\r\n                    if (editingTaskId) {\r\n                        renderTaskHistory(parseInt(editingTaskId));\r\n                    }\r\n\r\n                    // Reset scroll to top when switching to history tab\r\n                    const historyContainer = document.querySelector('.task-history-container');\r\n                    if (historyContainer) {\r\n                        historyContainer.scrollTop = 0;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\n// Render history for a specific task\r\nfunction renderTaskHistory(taskId) {\r\n    if (!window.historyService) return;\r\n\r\n    const task = tasks.find(t => t.id === taskId);\r\n    if (!task) return;\r\n\r\n    let history = window.historyService.getEntityHistory('task', taskId);\r\n    const timeline = document.getElementById('task-history-timeline');\r\n    const emptyState = document.getElementById('task-history-empty');\r\n\r\n    if (!timeline) return;\r\n\r\n    if (history.length === 0) {\r\n        timeline.innerHTML = '';\r\n        if (emptyState) {\r\n            emptyState.style.display = 'flex';\r\n            emptyState.style.flexDirection = 'column';\r\n            emptyState.style.alignItems = 'center';\r\n            emptyState.style.padding = '48px 20px';\r\n        }\r\n        return;\r\n    }\r\n\r\n    if (emptyState) emptyState.style.display = 'none';\r\n\r\n    // Apply sort order based on settings\r\n    if (settings.historySortOrder === 'oldest') {\r\n        history = [...history].reverse();\r\n    }\r\n\r\n    // Add sort toggle button if not already present\r\n    let sortButton = document.getElementById('history-sort-toggle');\r\n    if (!sortButton) {\r\n        const historyContainer = timeline.parentElement;\r\n        sortButton = document.createElement('button');\r\n        sortButton.id = 'history-sort-toggle';\r\n        sortButton.className = 'history-sort-toggle';\r\n        sortButton.innerHTML = settings.historySortOrder === 'newest' ? t('history.sort.newest') : t('history.sort.oldest');\r\n        sortButton.onclick = () => toggleHistorySortOrder('task', taskId);\r\n        historyContainer.insertBefore(sortButton, timeline);\r\n    } else {\r\n        sortButton.innerHTML = settings.historySortOrder === 'newest' ? t('history.sort.newest') : t('history.sort.oldest');\r\n    }\r\n\r\n    // Render history entries\r\n    timeline.innerHTML = history.map(entry => renderHistoryEntryInline(entry)).join('');\r\n}\r\n\r\n// Toggle history sort order\r\nfunction toggleHistorySortOrder(entityType, entityId) {\r\n    settings.historySortOrder = settings.historySortOrder === 'newest' ? 'oldest' : 'newest';\r\n    saveSettings();\r\n\r\n    // Re-render based on entity type\r\n    if (entityType === 'task' && entityId) {\r\n        renderTaskHistory(entityId);\r\n    } else if (entityType === 'project' && entityId) {\r\n        renderProjectHistory(entityId);\r\n    } else {\r\n        // Fallback: try to detect context\r\n        const form = document.getElementById('task-form');\r\n        const editingTaskId = form?.dataset.editingTaskId;\r\n        if (editingTaskId) {\r\n            renderTaskHistory(parseInt(editingTaskId));\r\n        }\r\n\r\n        const projectDetailsEl = document.getElementById('project-details');\r\n        if (projectDetailsEl && projectDetailsEl.classList.contains('active')) {\r\n            const projectIdMatch = projectDetailsEl.innerHTML.match(/renderProjectHistory\\((\\d+)\\)/);\r\n            if (projectIdMatch) {\r\n                renderProjectHistory(parseInt(projectIdMatch[1]));\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// Render history for a specific project\r\nfunction renderProjectHistory(projectId) {\r\n    if (!window.historyService) return;\r\n\r\n    const project = projects.find(p => p.id === projectId);\r\n    if (!project) return;\r\n\r\n    let history = window.historyService.getEntityHistory('project', projectId);\r\n    const timeline = document.getElementById(`project-history-timeline-${projectId}`);\r\n    const emptyState = document.getElementById(`project-history-empty-${projectId}`);\r\n\r\n    if (!timeline) return;\r\n\r\n    if (history.length === 0) {\r\n        timeline.innerHTML = '';\r\n        if (emptyState) {\r\n            emptyState.style.display = 'flex';\r\n            emptyState.style.flexDirection = 'column';\r\n            emptyState.style.alignItems = 'center';\r\n            emptyState.style.padding = '48px 20px';\r\n        }\r\n        return;\r\n    }\r\n\r\n    if (emptyState) emptyState.style.display = 'none';\r\n\r\n    // Apply sort order based on settings\r\n    if (settings.historySortOrder === 'oldest') {\r\n        history = [...history].reverse();\r\n    }\r\n\r\n    // Add sort toggle button if not already present\r\n    let sortButton = document.getElementById(`project-history-sort-toggle-${projectId}`);\r\n    if (!sortButton) {\r\n        const historyContainer = timeline.parentElement;\r\n        sortButton = document.createElement('button');\r\n        sortButton.id = `project-history-sort-toggle-${projectId}`;\r\n        sortButton.className = 'history-sort-toggle';\r\n        sortButton.innerHTML = settings.historySortOrder === 'newest' ? t('history.sort.newest') : t('history.sort.oldest');\r\n        sortButton.onclick = () => toggleHistorySortOrder('project', projectId);\r\n        historyContainer.insertBefore(sortButton, timeline);\r\n    } else {\r\n        sortButton.innerHTML = settings.historySortOrder === 'newest' ? t('history.sort.newest') : t('history.sort.oldest');\r\n    }\r\n\r\n    // Render history entries\r\n    timeline.innerHTML = history.map(entry => renderHistoryEntryInline(entry)).join('');\r\n}\r\n\r\n// Render a single history entry (inline version - simplified)\r\nfunction renderHistoryEntryInline(entry) {\r\n    const actionIcons = {\r\n        created: '\u2728',\r\n        updated: '',\r\n        deleted: '\uD83D\uDDD1\uFE0F'\r\n    };\r\n\r\n    const actionColors = {\r\n        created: 'var(--accent-green)',\r\n        updated: 'var(--text-secondary)',\r\n        deleted: 'var(--accent-red)'\r\n    };\r\n\r\n    const time = new Date(entry.timestamp).toLocaleString(getLocale(), {\r\n        month: 'short',\r\n        day: 'numeric',\r\n        year: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n        hour12: false\r\n    });\r\n\r\n    const changes = Object.entries(entry.changes);\r\n    const changeCount = changes.length;\r\n\r\n    // Get summary of changes for display\r\n    const fieldLabels = {\r\n        title: t('history.field.title'),\r\n        name: t('history.field.name'),\r\n        description: t('history.field.description'),\r\n        status: t('history.field.status'),\r\n        priority: t('history.field.priority'),\r\n        category: t('history.field.category'),\r\n        startDate: t('history.field.startDate'),\r\n        endDate: t('history.field.endDate'),\r\n        link: t('history.field.link'),\r\n        task: t('history.field.task'),\r\n        projectId: t('history.field.projectId'),\r\n        tags: t('history.field.tags'),\r\n        attachments: t('history.field.attachments')\r\n    };\r\n\r\n    return `\r\n        <div class=\"history-entry-inline\">\r\n            <div class=\"history-entry-header-inline\">\r\n                ${actionIcons[entry.action] ? `<span class=\"history-action-icon\" style=\"color: ${actionColors[entry.action]};\">${actionIcons[entry.action]}</span>` : ''}\r\n                ${entry.action === 'created' || entry.action === 'deleted' ? `<span class=\"history-action-label-inline\" style=\"color: ${actionColors[entry.action]};\">${entry.action.charAt(0).toUpperCase() + entry.action.slice(1)}</span>` : ''}\r\n                <span class=\"history-time-inline\">${time}</span>\r\n            </div>\r\n\r\n            ${changeCount > 0 ? `\r\n                <div class=\"history-changes-compact\">\r\n                    ${changes.map(([field, { before, after }]) => {\r\n                        const label = fieldLabels[field] || field;\r\n\r\n                        if (field === 'link' || field === 'task') {\r\n                            const action = after && typeof after === 'object' ? after.action : '';\r\n                            const entity = (after && typeof after === 'object' ? after.entity : null) || 'task';\r\n                            const title = after && typeof after === 'object' ? (after.title || after.id || t('tasks.table.task')) : String(after);\r\n                            const icon = action === 'removed' ? '\u274C' : '\u2795';\r\n                            const verb = action === 'removed' ? t('history.link.removed') : t('history.link.added');\r\n                            const entityLabel = entity === 'task' ? t('history.entity.task') : entity;\r\n                            const message = `${icon} ${verb} ${entityLabel} \\\"${title}\\\"`;\r\n                            return `\r\n                                <div class=\"history-change-compact history-change-compact--single\">\r\n                                    <span class=\"change-field-label\">${label}:</span>\r\n                                    <span class=\"change-after-compact\">${escapeHtml(message)}</span>\r\n                                </div>\r\n                            `;\r\n                        }\r\n\r\n                        // Special handling for description - show full diff\r\n                        if (field === 'description') {\r\n                            const oldText = before ? before.replace(/<[^>]*>/g, '').trim() : '';\r\n                            const newText = after ? after.replace(/<[^>]*>/g, '').trim() : '';\r\n\r\n                            return `\r\n                                <div class=\"history-change-description\">\r\n                                    <div class=\"change-field-label\">${label}:</div>\r\n                                    <div class=\"description-diff\">\r\n                                        ${oldText ? `<div class=\"description-before\"><s>${escapeHtml(oldText)}</s></div>` : `<div class=\"description-before\"><em style=\"opacity: 0.6;\">${t('history.value.empty')}</em></div>`}\r\n                                        ${newText ? `<div class=\"description-after\">${escapeHtml(newText)}</div>` : `<div class=\"description-after\"><em style=\"opacity: 0.6;\">${t('history.value.empty')}</em></div>`}\r\n                                    </div>\r\n                                </div>\r\n                            `;\r\n                        }\r\n\r\n                        // Standard handling for other fields\r\n                        const beforeValue = formatChangeValueCompact(field, before, true);\r\n                        const afterValue = formatChangeValueCompact(field, after, false);\r\n\r\n                        return `\r\n                            <div class=\"history-change-compact\">\r\n                                <span class=\"change-field-label\">${label}:</span>\r\n                                ${beforeValue !== null ? `<span class=\"change-before-compact\">${beforeValue}</span>` : '<span class=\"change-null\">\u2014</span>'}\r\n                                <span class=\"change-arrow-compact\">${t('history.change.arrow')}</span>\r\n                                ${afterValue !== null ? `<span class=\"change-after-compact\">${afterValue}</span>` : '<span class=\"change-null\">\u2014</span>'}\r\n                            </div>\r\n                        `;\r\n                    }).join('')}\r\n                </div>\r\n            ` : ''}\r\n        </div>\r\n    `;\r\n}\r\n\r\n// Compact format for inline display\r\nfunction formatChangeValueCompact(field, value, isBeforeValue = false) {\r\n    if (value === null || value === undefined) return null;\r\n    if (value === '') return `<em style=\"opacity: 0.7;\">${t('history.value.empty')}</em>`;\r\n\r\n    // Special formatting for different field types\r\n    if (field === 'startDate' || field === 'endDate') {\r\n        const dateStr = formatDate(value);\r\n        return isBeforeValue ? `<span style=\"opacity: 0.7;\">${dateStr}</span>` : dateStr;\r\n    }\r\n\r\n    if (field === 'link' || field === 'task') {\r\n        const action = value && typeof value === 'object' ? value.action : '';\r\n        const entity = (value && typeof value === 'object' ? value.entity : null) || 'task';\r\n        const title = value && typeof value === 'object' ? (value.title || value.id || t('tasks.table.task')) : String(value);\r\n        const icon = action === 'removed' ? '\u274C' : '\u2795';\r\n        const verb = action === 'removed' ? t('history.link.removed') : t('history.link.added');\r\n        const entityLabel = entity === 'task' ? t('history.entity.task') : entity;\r\n        const text = `${icon} ${verb} ${entityLabel} \\\"${title}\\\"`;\r\n        return isBeforeValue ? `<span style=\"opacity: 0.7;\">${escapeHtml(text)}</span>` : escapeHtml(text);\r\n    }\r\n\r\n    if (field === 'status') {\r\n        // Use status badge with proper color - NO opacity\r\n        const statusLabel = (getStatusLabel(value)).toUpperCase();\r\n        const statusColors = {\r\n            backlog: '#4B5563',\r\n            todo: '#186f95',\r\n            progress: 'var(--accent-blue)',\r\n            review: 'var(--accent-amber)',\r\n            done: 'var(--accent-green)'\r\n        };\r\n        const bgColor = statusColors[value] || '#4B5563';\r\n        return `<span style=\"background: ${bgColor}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11.5px; font-weight: 600; text-transform: uppercase;\">${escapeHtml(statusLabel)}</span>`;\r\n    }\r\n\r\n    if (field === 'priority') {\r\n        // Use priority label with proper color - NO opacity\r\n        const priorityLabel = getPriorityLabel(value);\r\n        const priorityColor = PRIORITY_COLORS[value] || 'var(--text-secondary)';\r\n        return `<span style=\"color: ${priorityColor}; font-weight: 600; font-size: 12px;\">\u25CF</span> <span style=\"font-weight: 500;\">${escapeHtml(priorityLabel)}</span>`;\r\n    }\r\n\r\n    if (field === 'projectId') {\r\n        if (!value) return `<em style=\"opacity: 0.7;\">${t('tasks.noProject')}</em>`;\r\n        const project = projects.find(p => p.id === value);\r\n        const projectName = project ? escapeHtml(project.name) : `#${value}`;\r\n        return isBeforeValue ? `<span style=\"opacity: 0.7;\">${projectName}</span>` : projectName;\r\n    }\r\n\r\n    if (field === 'tags') {\r\n        // NO opacity for tags\r\n        if (!Array.isArray(value) || value.length === 0) return `<em style=\"opacity: 0.7;\">${t('history.value.none')}</em>`;\r\n        return value.slice(0, 2).map(tag => {\r\n            const tagColor = getTagColor(tag);\r\n            return `<span style=\"background-color: ${tagColor}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;\">${escapeHtml(tag.toUpperCase())}</span>`;\r\n        }).join(' ') + (value.length > 2 ? ' ...' : '');\r\n    }\r\n\r\n    if (field === 'attachments') {\r\n        if (!Array.isArray(value) || value.length === 0) return `<em style=\"opacity: 0.7;\">${t('history.value.none')}</em>`;\r\n        const attachStr = value.length === 1\r\n            ? t('history.attachments.countSingle', { count: value.length })\r\n            : t('history.attachments.countPlural', { count: value.length });\r\n        return isBeforeValue ? `<span style=\"opacity: 0.7;\">${attachStr}</span>` : attachStr;\r\n    }\r\n\r\n    if (field === 'description') {\r\n        const text = value.replace(/<[^>]*>/g, '').trim();\r\n        const shortText = text.length > 50 ? escapeHtml(text.substring(0, 50)) + '...' : escapeHtml(text) || `<em>${t('history.value.empty')}</em>`;\r\n        return isBeforeValue ? `<span style=\"opacity: 0.7;\">${shortText}</span>` : shortText;\r\n    }\r\n\r\n    // Default text fields - apply opacity for before values\r\n    const escapedValue = escapeHtml(String(value));\r\n    return isBeforeValue ? `<span style=\"opacity: 0.7;\">${escapedValue}</span>` : escapedValue;\r\n}\r\n\r\nfunction toggleHistoryEntryInline(entryId) {\r\n    const details = document.getElementById(`history-details-inline-${entryId}`);\r\n    const btn = document.querySelector(`[data-action=\"toggleHistoryEntryInline\"][data-param=\"${entryId}\"]`);\r\n    const icon = btn?.querySelector('.expand-icon-inline');\r\n\r\n    if (details) {\r\n        const isVisible = details.style.display !== 'none';\r\n        details.style.display = isVisible ? 'none' : 'block';\r\n        if (icon) {\r\n            icon.textContent = isVisible ? '\u25BC' : '\u25B2';\r\n        }\r\n    }\r\n}\r\n\r\n// === Helper Functions for History Rendering ===\r\n\r\nfunction renderChanges(changes) {\r\n    const fieldLabels = {\r\n        title: t('history.field.title'),\r\n        name: t('history.field.name'),\r\n        description: t('history.field.description'),\r\n        status: t('history.field.status'),\r\n        priority: t('history.field.priority'),\r\n        category: t('history.field.category'),\r\n        startDate: t('history.field.startDate'),\r\n        endDate: t('history.field.endDate'),\r\n        projectId: t('history.field.projectId'),\r\n        tags: t('history.field.tags'),\r\n        attachments: t('history.field.attachments')\r\n    };\r\n\r\n    return Object.entries(changes).map(([field, { before, after }]) => {\r\n        const label = fieldLabels[field] || field;\r\n        const beforeValue = formatChangeValue(field, before);\r\n        const afterValue = formatChangeValue(field, after);\r\n\r\n        return `\r\n            <div class=\"history-change\">\r\n                <div class=\"history-change-field\">${label}</div>\r\n                <div class=\"history-change-values\">\r\n                    <div class=\"history-change-before\">\r\n                        ${beforeValue !== null ? `<span class=\"change-label\">${t('history.change.beforeLabel')}</span> ${beforeValue}` : `<span class=\"change-label-null\">${t('history.change.notSet')}</span>`}\r\n                    </div>\r\n                    <div class=\"history-change-arrow\">${t('history.change.arrow')}</div>\r\n                    <div class=\"history-change-after\">\r\n                        ${afterValue !== null ? `<span class=\"change-label\">${t('history.change.afterLabel')}</span> ${afterValue}` : `<span class=\"change-label-null\">${t('history.change.removed')}</span>`}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\nfunction formatChangeValue(field, value) {\r\n    if (value === null || value === undefined) return null;\r\n    if (value === '') return `<em style=\"color: var(--text-muted);\">${t('history.value.empty')}</em>`;\r\n\r\n    if (field === 'link' || field === 'task') {\r\n        const action = value && typeof value === 'object' ? value.action : '';\r\n        const entity = (value && typeof value === 'object' ? value.entity : null) || 'task';\r\n        const title = value && typeof value === 'object' ? (value.title || value.id || t('tasks.table.task')) : String(value);\r\n        const icon = action === 'removed' ? '\u274C' : '\u2795';\r\n        const verb = action === 'removed' ? t('history.link.removed') : t('history.link.added');\r\n        const entityLabel = entity === 'task' ? t('history.entity.task') : entity;\r\n        return escapeHtml(`${icon} ${verb} ${entityLabel} \\\"${title}\\\"`);\r\n    }\r\n\r\n    // Special formatting for different field types\r\n    if (field === 'startDate' || field === 'endDate') {\r\n        return formatDate(value);\r\n    }\r\n\r\n    if (field === 'projectId') {\r\n        if (!value) return `<em style=\"color: var(--text-muted);\">${t('tasks.noProject')}</em>`;\r\n        const project = projects.find(p => p.id === value);\r\n        return project ? escapeHtml(project.name) : t('history.project.fallback', { id: value });\r\n    }\r\n\r\n    if (field === 'tags') {\r\n        if (!Array.isArray(value) || value.length === 0) {\r\n            return `<em style=\"color: var(--text-muted);\">${t('history.tags.none')}</em>`;\r\n        }\r\n        return value.map(tag => `<span class=\"history-tag\">${escapeHtml(tag)}</span>`).join(' ');\r\n    }\r\n\r\n    if (field === 'attachments') {\r\n        if (!Array.isArray(value) || value.length === 0) {\r\n            return `<em style=\"color: var(--text-muted);\">${t('history.attachments.none')}</em>`;\r\n        }\r\n        return value.length === 1\r\n            ? t('history.attachments.countSingle', { count: value.length })\r\n            : t('history.attachments.countPlural', { count: value.length });\r\n    }\r\n\r\n    if (field === 'description') {\r\n        // Strip HTML tags and truncate\r\n        const text = value.replace(/<[^>]*>/g, '').trim();\r\n        if (text.length > 100) {\r\n            return escapeHtml(text.substring(0, 100)) + '...';\r\n        }\r\n        return escapeHtml(text) || `<em style=\"color: var(--text-muted);\">${t('history.value.empty')}</em>`;\r\n    }\r\n\r\n    return escapeHtml(String(value));\r\n}\r\n\r\n// Old History page functions removed - now using inline history in modals\r\n\r\nlet feedbackItemToDelete = null;\r\n\r\nfunction deleteFeedbackItem(id) {\r\n    feedbackItemToDelete = id;\r\n    document.getElementById('feedback-delete-modal').classList.add('active');\r\n}\r\n\r\nfunction closeFeedbackDeleteModal() {\r\n    document.getElementById('feedback-delete-modal').classList.remove('active');\r\n    feedbackItemToDelete = null;\r\n}\r\n\r\nasync function confirmFeedbackDelete() {\r\n    if (feedbackItemToDelete !== null) {\r\n        const deleteId = feedbackItemToDelete;\r\n        feedbackItems = feedbackItems.filter(f => f.id !== feedbackItemToDelete);\r\n\r\n        // Close modal and update UI INSTANTLY\r\n        closeFeedbackDeleteModal();\r\n        updateCounts();\r\n        renderFeedback();\r\n        \r\n        // Cache immediately for instant persistence\r\n        persistFeedbackCache();\r\n\r\n        // Save in background (non-blocking, async with retry)\r\n        saveFeedbackWithRetry();\r\n    }\r\n}\r\n\r\n// Delegated click handler for feedback checkbox only\r\ndocument.addEventListener('click', function(e) {\r\n    const checkbox = e.target.closest('.feedback-checkbox');\r\n    if (checkbox) {\r\n        const feedbackId = parseInt(checkbox.dataset.feedbackId, 10);\r\n        if (feedbackId) {\r\n            toggleFeedbackItem(feedbackId);\r\n        }\r\n    }\r\n});\r\n\r\nfunction editProjectTitle(projectId, currentName) {\r\n    document.getElementById('project-title-display').style.display = 'none';\r\n    document.getElementById('project-title-edit').style.display = 'flex';\r\n    document.getElementById('project-title-input').focus();\r\n    document.getElementById('project-title-input').select();\r\n}\r\n\r\nfunction saveProjectTitle(projectId) {\r\n    const newTitle = document.getElementById('project-title-input').value.trim();\r\n    if (newTitle) {\r\n        updateProjectField(projectId, 'name', newTitle);\r\n    } else {\r\n        cancelProjectTitle();\r\n    }\r\n}\r\n\r\nfunction cancelProjectTitle() {\r\n    document.getElementById('project-title-display').style.display = 'inline';\r\n    document.getElementById('project-title-edit').style.display = 'none';\r\n}\r\n\r\nfunction dismissKanbanTip() {\r\n    document.getElementById('kanban-tip').style.display = 'none';\r\n    localStorage.setItem('kanban-tip-dismissed', 'true');\r\n}\r\n\r\nfunction toggleProjectMenu(event) {\r\n    event.stopPropagation();\r\n    const menu = document.getElementById('project-options-menu');\r\n    if (menu) {\r\n        menu.style.display = menu.style.display === 'block' ? 'none' : 'block';\r\n    }\r\n}\r\n\r\n// Close project menu when clicking outside\r\ndocument.addEventListener('click', function(e) {\r\n    const menu = document.getElementById('project-options-menu');\r\n    if (menu && !e.target.closest('#project-options-btn') && !e.target.closest('#project-options-menu')) {\r\n        menu.style.display = 'none';\r\n    }\r\n});\r\n\r\n// Check on page load if tip was dismissed\r\ndocument.addEventListener('DOMContentLoaded', function() {\r\n    if (localStorage.getItem('kanban-tip-dismissed') === 'true') {\r\n        const tip = document.getElementById('kanban-tip');\r\n        if (tip) tip.style.display = 'none';\r\n    }\r\n});\r\n\r\nasync function addAttachment() {\r\n    const urlInput = document.getElementById('attachment-url');\r\n    const nameInput = document.getElementById('attachment-name');\r\n    const url = urlInput.value.trim();\r\n    \r\n    if (!url) {\r\n        urlInput.style.border = '2px solid var(--accent-red, #ef4444)';\r\n        urlInput.placeholder = 'URL is required';\r\n        urlInput.focus();\r\n        \r\n        // Reset border after 2 seconds\r\n        setTimeout(() => {\r\n            urlInput.style.border = '';\r\n            urlInput.placeholder = 'Paste link (Drive, Dropbox, etc.)';\r\n        }, 2000);\r\n        return;\r\n    }\r\n    \r\n    // Reset any error styling\r\n    urlInput.style.border = '';\r\n    \r\n    const taskId = document.getElementById('task-form').dataset.editingTaskId;\r\n    \r\n    // Use custom name if provided, otherwise auto-detect\r\n    let name = nameInput.value.trim() || 'Attachment';\r\n    let icon = '\uD83D\uDCC1';\r\n    \r\n    if (!nameInput.value.trim()) {\r\n        // Only auto-detect if no custom name provided\r\n        try {\r\n            const urlObj = new URL(url);\r\n            let path = urlObj.pathname.toLowerCase();\r\n\r\n            if (urlObj.hostname.includes(\"docs.google.com\")) {\r\n                if (path.includes(\"/document/\")) {\r\n                    name = t('tasks.attachments.googleDoc');\r\n                    icon = \"\uD83D\uDCC4\";\r\n                } else if (path.includes(\"/spreadsheets/\")) {\r\n                    name = t('tasks.attachments.googleSheet');\r\n                    icon = \"\uD83D\uDCCA\";\r\n                } else if (path.includes(\"/presentation/\")) {\r\n                    name = t('tasks.attachments.googleSlides');\r\n                    icon = \"\uD83D\uDCD1\";\r\n                } else {\r\n                    name = t('tasks.attachments.googleDriveFile');\r\n                    icon = \"\uD83D\uDDC2\uFE0F\";\r\n                }\r\n            } else if (urlObj.hostname.includes(\"drive.google.com\")) {\r\n                name = t('tasks.attachments.googleDriveFile');\r\n                icon = \"\uD83D\uDDC2\uFE0F\";\r\n            } else if (path.endsWith(\".pdf\")) {\r\n                name = path.split(\"/\").pop() || t('tasks.attachments.pdf');\r\n                icon = \"\uD83D\uDCD5\";\r\n            } else if (path.endsWith(\".doc\") || path.endsWith(\".docx\")) {\r\n                name = path.split(\"/\").pop() || t('tasks.attachments.word');\r\n                icon = \"\uD83D\uDCDD\";\r\n            } else if (path.endsWith(\".xls\") || path.endsWith(\".xlsx\")) {\r\n                name = path.split(\"/\").pop() || t('tasks.attachments.excel');\r\n                icon = \"\uD83D\uDCCA\";\r\n            } else if (path.endsWith(\".ppt\") || path.endsWith(\".pptx\")) {\r\n                name = path.split(\"/\").pop() || t('tasks.attachments.powerpoint');\r\n                icon = \"\uD83D\uDCD1\";\r\n            } else {\r\n                let lastPart = path.split(\"/\").pop();\r\n                name = lastPart && lastPart.length > 0 ? lastPart : urlObj.hostname;\r\n                icon = \"\uD83D\uDCC1\";\r\n            }\r\n        } catch (e) {\r\n            name = url.substring(0, 30);\r\n            icon = \"\uD83D\uDCC1\";\r\n        }\r\n    }\r\n\r\n    // Use a consistent icon for URL attachments\r\n    icon = '\uD83C\uDF10';\r\n    const attachment = { name, icon, type: 'link', url, addedAt: new Date().toISOString() };\r\n\r\n    if (taskId) {\r\n        const task = tasks.find(t => t.id === parseInt(taskId));\r\n        if (!task) return;\r\n        if (!task.attachments) task.attachments = [];\r\n        task.attachments.push(attachment);\r\n        renderAttachments(task.attachments);\r\n\r\n        // Reorganize mobile fields after attachment addition\r\n        reorganizeMobileTaskFields();\r\n\r\n        // Save in background\r\n        saveTasks().catch(error => {\r\n            console.error('Failed to save attachment:', error);\r\n            showErrorNotification(t('error.attachmentSaveFailed'));\r\n        });\r\n    } else {\r\n        tempAttachments.push(attachment);\r\n        renderAttachments(tempAttachments);\r\n    }\r\n    \r\n    urlInput.value = '';\r\n    nameInput.value = '';\r\n}\r\n\r\nasync function renderAttachments(attachments) {\r\n    const filesContainer = document.getElementById('attachments-files-list');\r\n    const linksContainer = document.getElementById('attachments-links-list');\r\n\r\n    if (filesContainer && linksContainer) {\r\n        await renderAttachmentsSeparated(attachments, filesContainer, linksContainer);\r\n        return;\r\n    }\r\n\r\n    const container = document.getElementById('attachments-list');\r\n    if (!container) return;\r\n\r\n    if (!attachments || attachments.length === 0) {\r\n        container.innerHTML = `<div style=\"color: var(--text-muted); font-size: 13px; padding: 8px 0;\">${t('tasks.attachments.none')}</div>`;\r\n        return;\r\n    }\r\n\r\n    const getUrlHost = (rawUrl) => {\r\n        if (!rawUrl) return '';\r\n        try {\r\n            const hasScheme = /^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(rawUrl);\r\n            const url = new URL(hasScheme ? rawUrl : `https://${rawUrl}`);\r\n            return (url.host || rawUrl).replace(/^www\\./, '');\r\n        } catch {\r\n            return rawUrl;\r\n        }\r\n    };\r\n\r\n    // First render with placeholders\r\n    container.innerHTML = attachments.map((att, index) => {\r\n        const sizeInKB = att.size ? Math.round(att.size / 1024) : 0;\r\n        const sizeText = sizeInKB > 1024 ? `${(sizeInKB/1024).toFixed(1)} MB` : `${sizeInKB} KB`;\r\n\r\n        // New file system (with fileKey)\r\n        if (att.type === 'file' && att.fileKey) {\r\n            const isImage = att.fileType === 'image';\r\n            // Show placeholder, will load image if it's an image\r\n            const thumbnailHtml = `<div id=\"thumbnail-${att.fileKey}\" class=\"attachment-thumb\" aria-hidden=\"true\">${att.icon}</div>`;\r\n            const primaryAction = isImage ? 'viewFile' : 'downloadFileAttachment';\r\n            const primaryParams = isImage\r\n                ? `data-param=\"${att.fileKey}\" data-param2=\"${escapeHtml(att.name)}\" data-param3=\"${att.fileType}\"`\r\n                : `data-param=\"${att.fileKey}\" data-param2=\"${escapeHtml(att.name)}\" data-param3=\"${att.mimeType}\"`;\r\n\r\n            return `\r\n                <div class=\"attachment-item\">\r\n                    <button type=\"button\" class=\"attachment-link\" data-action=\"${primaryAction}\" ${primaryParams}>\r\n                        ${thumbnailHtml}\r\n                        <span class=\"attachment-name\">${escapeHtml(att.name)} <span class=\"attachment-meta\">&middot; ${sizeText}</span></span>\r\n                    </button>\r\n                    <button type=\"button\" class=\"attachment-remove\" data-action=\"removeAttachment\" data-param=\"${index}\" aria-label=\"${t('tasks.attachments.remove')}\" title=\"${t('tasks.attachments.removeTitle')}\">&times;</button>\r\n                </div>\r\n            `;\r\n        }\r\n\r\n        // Legacy: Old inline Base64 images (backward compatibility) - still show thumbnail since data is already in memory\r\n        else if (att.type === 'image' && att.data) {\r\n            return `\r\n                <div class=\"attachment-item\">\r\n                    <button type=\"button\" class=\"attachment-link\" data-action=\"viewImageLegacy\" data-param=\"${att.data}\" data-param2=\"${escapeHtml(att.name)}\">\r\n                        <span class=\"attachment-thumb\" aria-hidden=\"true\"><img src=\"${att.data}\" alt=\"\"></span>\r\n                        <span class=\"attachment-name\">${escapeHtml(att.name)} <span class=\"attachment-meta\">&middot; ${sizeText}</span></span>\r\n                    </button>\r\n                    <button type=\"button\" class=\"attachment-remove\" data-action=\"removeAttachment\" data-param=\"${index}\" aria-label=\"${t('tasks.attachments.remove')}\" title=\"${t('tasks.attachments.removeTitle')}\">&times;</button>\r\n                </div>\r\n            `;\r\n        }\r\n\r\n        // URL attachment\r\n        else {\r\n            return `\r\n                <div class=\"attachment-item\" style=\"display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px; border: 1px solid var(--border);\">\r\n                    <div style=\"width: 40px; height: 40px; background: transparent; border-radius: 0; display: flex; align-items: center; justify-content: center; font-size: 25px; line-height: 1;\">\uD83C\uDF10</div>\r\n                    <div style=\"flex: 1; min-width: 0;\">\r\n                        <div style=\"font-size: 14px; font-weight: 500; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${escapeHtml(att.name)}</div>\r\n                        <div style=\"font-size: 12px; color: var(--text-muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: none;\">${escapeHtml(att.url)}</div>\r\n                    </div>\r\n                    <div style=\"display: flex; gap: 6px; align-items: center;\">\r\n                        <button type=\"button\" data-action=\"openUrlAttachment\" data-param=\"${encodeURIComponent(att.url)}\" style=\"padding: 0 12px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; height: 32px; line-height: 1; box-sizing: border-box; display: inline-flex; align-items: center; justify-content: center; appearance: none; -webkit-appearance: none;\">${t('tasks.attachments.open')}</button>\r\n                        <button type=\"button\" class=\"attachment-remove\" data-action=\"removeAttachment\" data-param=\"${index}\" aria-label=\"${t('tasks.attachments.removeLink')}\" title=\"${t('tasks.attachments.removeTitle')}\">&times;</button>\r\n                    </div>\r\n                </div>\r\n            `;\r\n        }\r\n    }).join('');\r\n\r\n    // Load image thumbnails asynchronously\r\n    for (const att of attachments) {\r\n        if (att.type === 'file' && att.fileKey && att.fileType === 'image') {\r\n            try {\r\n                const base64Data = await downloadFile(att.fileKey);\r\n                const thumbnailEl = document.getElementById(`thumbnail-${att.fileKey}`);\r\n                if (thumbnailEl && base64Data) {\r\n                    thumbnailEl.innerHTML = `<img src=\"${base64Data}\" alt=\"${escapeHtml(att.name)}\">`;\r\n                }\r\n            } catch (error) {\r\n                console.error('Failed to load thumbnail:', error);\r\n                // Keep showing icon on error\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nasync function renderAttachmentsSeparated(attachments, filesContainer, linksContainer) {\r\n    if (!filesContainer || !linksContainer) return;\r\n\r\n    const indexed = (attachments || []).map((att, index) => ({ att, index }));\r\n\r\n    const fileItems = indexed.filter(({ att }) => {\r\n        if (!att) return false;\r\n        if (att.type === 'file') return true;\r\n        if (att.fileKey) return true;\r\n        if (att.type === 'image' && att.data) return true;\r\n        return false;\r\n    });\r\n\r\n    const linkItems = indexed.filter(({ att }) => {\r\n        if (!att) return false;\r\n        if (att.type === 'link') return true;\r\n        if (att.url && att.type !== 'file') return true; // backward compat for old link objects\r\n        return false;\r\n    });\r\n\r\n    const getUrlHost = (rawUrl) => {\r\n        if (!rawUrl) return '';\r\n        try {\r\n            const hasScheme = /^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(rawUrl);\r\n            const url = new URL(hasScheme ? rawUrl : `https://${rawUrl}`);\r\n            return (url.host || rawUrl).replace(/^www\\./, '');\r\n        } catch {\r\n            return rawUrl;\r\n        }\r\n    };\r\n\r\n    const fileRows = fileItems.map(({ att, index }) => {\r\n        const sizeInKB = att.size ? Math.round(att.size / 1024) : 0;\r\n        const sizeText = sizeInKB > 1024 ? `${(sizeInKB / 1024).toFixed(1)} MB` : `${sizeInKB} KB`;\r\n\r\n        if (att.type === 'file' && att.fileKey) {\r\n            const isImage = att.fileType === 'image';\r\n            const thumbnailHtml = `<div id=\"thumbnail-${att.fileKey}\" class=\"attachment-thumb\" aria-hidden=\"true\">${att.icon}</div>`;\r\n            const primaryAction = isImage ? 'viewFile' : 'downloadFileAttachment';\r\n            const primaryParams = isImage\r\n                ? `data-param=\"${att.fileKey}\" data-param2=\"${escapeHtml(att.name)}\" data-param3=\"${att.fileType}\"`\r\n                : `data-param=\"${att.fileKey}\" data-param2=\"${escapeHtml(att.name)}\" data-param3=\"${att.mimeType}\"`;\r\n\r\n            return `\r\n                <div class=\"attachment-item\">\r\n                    <button type=\"button\" class=\"attachment-link\" data-action=\"${primaryAction}\" ${primaryParams}>\r\n                        ${thumbnailHtml}\r\n                        <span class=\"attachment-name\">${escapeHtml(att.name)} <span class=\"attachment-meta\">&middot; ${sizeText}</span></span>\r\n                    </button>\r\n                    <button type=\"button\" class=\"attachment-remove\" data-action=\"removeAttachment\" data-param=\"${index}\" aria-label=\"${t('tasks.attachments.remove')}\" title=\"${t('tasks.attachments.removeTitle')}\">&times;</button>\r\n                </div>\r\n            `;\r\n        }\r\n\r\n        if (att.type === 'image' && att.data) {\r\n            return `\r\n                <div class=\"attachment-item\">\r\n                    <button type=\"button\" class=\"attachment-link\" data-action=\"viewImageLegacy\" data-param=\"${att.data}\" data-param2=\"${escapeHtml(att.name)}\">\r\n                        <span class=\"attachment-thumb\" aria-hidden=\"true\"><img src=\"${att.data}\" alt=\"\"></span>\r\n                        <span class=\"attachment-name\">${escapeHtml(att.name)} <span class=\"attachment-meta\">&middot; ${sizeText}</span></span>\r\n                    </button>\r\n                    <button type=\"button\" class=\"attachment-remove\" data-action=\"removeAttachment\" data-param=\"${index}\" aria-label=\"${t('tasks.attachments.remove')}\" title=\"${t('tasks.attachments.removeTitle')}\">&times;</button>\r\n                </div>\r\n            `;\r\n        }\r\n\r\n        return '';\r\n    }).filter(Boolean).join('');\r\n\r\n    const linkRows = linkItems.map(({ att, index }) => `\r\n        <div class=\"attachment-item\" style=\"display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px; border: 1px solid var(--border);\">\r\n            <div style=\"width: 40px; height: 40px; background: transparent; border-radius: 0; display: flex; align-items: center; justify-content: center; font-size: 25px; line-height: 1;\">\uD83C\uDF10</div>\r\n            <div style=\"flex: 1; min-width: 0;\">\r\n                <div style=\"font-size: 14px; font-weight: 500; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;\">${escapeHtml(att.name)}</div>\r\n                <div style=\"font-size: 12px; color: var(--text-muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: none;\">${escapeHtml(att.url)}</div>\r\n            </div>\r\n            <div style=\"display: flex; gap: 6px; align-items: center;\">\r\n                <button type=\"button\" data-action=\"openUrlAttachment\" data-param=\"${encodeURIComponent(att.url)}\" style=\"padding: 0 12px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; height: 32px; line-height: 1; box-sizing: border-box; display: inline-flex; align-items: center; justify-content: center; appearance: none; -webkit-appearance: none;\">${t('tasks.attachments.open')}</button>\r\n                <button type=\"button\" class=\"attachment-remove\" data-action=\"removeAttachment\" data-param=\"${index}\" aria-label=\"${t('tasks.attachments.removeLink')}\" title=\"${t('tasks.attachments.removeTitle')}\">&times;</button>\r\n            </div>\r\n        </div>\r\n    `).join('');\r\n\r\n    const hasAny = Boolean(fileRows) || Boolean(linkRows);\r\n    if (!hasAny) {\r\n        filesContainer.innerHTML = `<div style=\"color: var(--text-muted); font-size: 13px; padding: 8px 0;\">${t('tasks.attachments.none')}</div>`;\r\n        linksContainer.innerHTML = '';\r\n    } else {\r\n        filesContainer.innerHTML = fileRows || '';\r\n        linksContainer.innerHTML = linkRows || '';\r\n    }\r\n\r\n    // Load image thumbnails asynchronously (fileKey images)\r\n    for (const att of attachments || []) {\r\n        if (att && att.type === 'file' && att.fileKey && att.fileType === 'image') {\r\n            try {\r\n                const base64Data = await downloadFile(att.fileKey);\r\n                const thumbnailEl = document.getElementById(`thumbnail-${att.fileKey}`);\r\n                if (thumbnailEl && base64Data) {\r\n                    thumbnailEl.innerHTML = `<img src=\"${base64Data}\" alt=\"${escapeHtml(att.name)}\">`;\r\n                }\r\n            } catch (error) {\r\n                console.error('Failed to load thumbnail:', error);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nasync function viewFile(fileKey, fileName, fileType) {\r\n    if (fileType !== 'image') return; // Only images can be viewed inline\r\n\r\n    try {\r\n        const base64Data = await downloadFile(fileKey);\r\n        viewImageLegacy(base64Data, fileName);\r\n    } catch (error) {\r\n        showErrorNotification(t('error.attachmentLoadFailed', { message: error.message }));\r\n    }\r\n}\r\n\r\nfunction viewImageLegacy(base64Data, imageName) {\r\n    const modal = document.createElement('div');\r\n    modal.style.cssText = `\r\n        position: fixed;\r\n        top: 0;\r\n        left: 0;\r\n        width: 100%;\r\n        height: 100%;\r\n        background: rgba(0, 0, 0, 0.9);\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        z-index: 10000;\r\n        cursor: pointer;\r\n    `;\r\n\r\n    modal.innerHTML = `\r\n        <div style=\"max-width: 90%; max-height: 90%; display: flex; flex-direction: column; align-items: center;\">\r\n            <div style=\"color: white; padding: 16px; font-size: 18px; background: rgba(0,0,0,0.5); border-radius: 8px 8px 0 0; width: 100%; text-align: center;\">\r\n                ${escapeHtml(imageName)}\r\n            </div>\r\n            <img src=\"${base64Data}\" alt=\"${escapeHtml(imageName)}\" style=\"max-width: 100%; max-height: calc(90vh - 60px); object-fit: contain; border-radius: 0 0 8px 8px;\">\r\n        </div>\r\n    `;\r\n\r\n    modal.onclick = () => modal.remove();\r\n    document.body.appendChild(modal);\r\n}\r\n\r\n  async function downloadFileAttachment(fileKey, fileName, mimeType) {\r\n    try {\r\n        const base64Data = await downloadFile(fileKey);\r\n\r\n        // Convert Base64 to blob and trigger download\r\n        const base64Response = await fetch(base64Data);\r\n        const blob = await base64Response.blob();\r\n\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = fileName;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        document.body.removeChild(a);\r\n        URL.revokeObjectURL(url);\r\n\r\n        showSuccessNotification(t('success.fileDownloaded'));\r\n    } catch (error) {\r\n        showErrorNotification(t('error.fileDownloadFailed', { message: error.message }));\r\n    }\r\n}\r\n\r\nasync function removeAttachment(index) {\r\n    const taskId = document.getElementById('task-form').dataset.editingTaskId;\r\n\r\n    if (taskId) {\r\n        // Removing from existing task\r\n        const task = tasks.find(t => t.id === parseInt(taskId));\r\n        if (!task || !task.attachments) return;\r\n\r\n        const attachment = task.attachments[index];\r\n\r\n        // Delete file from NAUTILUS_FILES KV if it's a file attachment\r\n        if (attachment.type === 'file' && attachment.fileKey) {\r\n            try {\r\n                await deleteFile(attachment.fileKey);\r\n                showSuccessNotification(t('success.attachmentDeletedFromStorage', { name: attachment.name }));\r\n            } catch (error) {\r\n                console.error('Failed to delete file from storage:', error);\r\n                showErrorNotification(t('error.fileDeleteFailed'));\r\n                return; // Don't remove from task if storage deletion failed\r\n            }\r\n        } else {\r\n            showSuccessNotification(t('success.attachmentRemoved'));\r\n        }\r\n\r\n        task.attachments.splice(index, 1);\r\n\r\n        // Update UI immediately (optimistic update)\r\n        renderAttachments(task.attachments);\r\n\r\n        // Reorganize mobile fields after attachment removal\r\n        reorganizeMobileTaskFields();\r\n\r\n        // Save in background (don't block UI)\r\n        saveTasks().catch(err => {\r\n            console.error('Failed to save attachment removal:', err);\r\n            showErrorNotification(t('error.saveChangesFailed'));\r\n        });\r\n    } else {\r\n        // Removing from staged attachments\r\n        const attachment = tempAttachments[index];\r\n\r\n        // Delete file from NAUTILUS_FILES KV if it's a file attachment\r\n        if (attachment.type === 'file' && attachment.fileKey) {\r\n            try {\r\n                await deleteFile(attachment.fileKey);\r\n                showSuccessNotification(t('success.attachmentDeletedFromStorage', { name: attachment.name }));\r\n            } catch (error) {\r\n                console.error('Failed to delete file from storage:', error);\r\n                showErrorNotification(t('error.fileDeleteFailed'));\r\n                return; // Don't remove from staging if storage deletion failed\r\n            }\r\n        } else {\r\n            showSuccessNotification(t('success.attachmentRemoved'));\r\n        }\r\n\r\n        tempAttachments.splice(index, 1);\r\n        renderAttachments(tempAttachments);\r\n    }\r\n}\r\n\r\nfunction initTaskAttachmentDropzone() {\r\n    const dropzone = document.getElementById('attachment-file-dropzone');\r\n    const fileInput = document.getElementById('attachment-file');\r\n    if (!dropzone || !fileInput) return;\r\n\r\n    const isMobileScreen = getIsMobileCached();\r\n    const defaultText = isMobileScreen\r\n        ? t('tasks.modal.attachmentsDropzoneTap')\r\n        : t('tasks.modal.attachmentsDropzoneDefault');\r\n\r\n    dropzone.dataset.defaultText = defaultText;\r\n\r\n    function setDropzoneText(text) {\r\n        dropzone.innerHTML = '';\r\n        const textEl = document.createElement('span');\r\n        textEl.className = 'task-attachment-dropzone-text';\r\n        textEl.textContent = text;\r\n        dropzone.appendChild(textEl);\r\n    }\r\n\r\n    function applyDropzoneBaseStyles(el) {\r\n        el.style.display = 'flex';\r\n        el.style.alignItems = 'center';\r\n        el.style.justifyContent = 'center';\r\n        el.style.gap = '10px';\r\n        el.style.padding = '12px 16px';\r\n        el.style.textAlign = 'center';\r\n        el.style.cursor = 'pointer';\r\n        el.style.userSelect = 'none';\r\n        el.style.minHeight = '48px';\r\n        el.style.border = '2px dashed var(--border)';\r\n        el.style.borderRadius = '10px';\r\n        el.style.background = 'var(--bg-tertiary)';\r\n        el.style.boxShadow = 'none';\r\n        el.style.color = 'var(--text-muted)';\r\n        el.style.fontWeight = '500';\r\n        el.style.transition = 'border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease';\r\n    }\r\n\r\n    function setDropzoneDragoverStyles(el, isActive) {\r\n        if (isActive) {\r\n            // Use same vibrant blue as feedback dropzone\r\n            el.style.borderColor = 'var(--accent-blue)';\r\n            el.style.background = 'rgba(59, 130, 246, 0.08)';\r\n            el.style.boxShadow = '0 0 0 1px var(--accent-blue)';\r\n        } else {\r\n            el.style.border = '2px dashed var(--border)';\r\n            el.style.background = 'var(--bg-tertiary)';\r\n            el.style.boxShadow = 'none';\r\n        }\r\n    }\r\n\r\n    applyDropzoneBaseStyles(dropzone);\r\n    setDropzoneText(defaultText);\r\n\r\n    async function handleDropOrPasteFileList(fileList, event) {\r\n        if (!fileList || fileList.length === 0) return;\r\n        const file = fileList[0];\r\n        if (event) {\r\n            event.preventDefault();\r\n            event.stopPropagation();\r\n        }\r\n        await uploadTaskAttachmentFile(file, dropzone);\r\n    }\r\n\r\n    let dragDepth = 0;\r\n\r\n    dropzone.addEventListener('dragenter', function(e) {\r\n        e.preventDefault();\r\n        dragDepth += 1;\r\n        dropzone.classList.add('task-attachment-dragover');\r\n        setDropzoneDragoverStyles(dropzone, true);\r\n    });\r\n\r\n    dropzone.addEventListener('dragover', function(e) {\r\n        e.preventDefault();\r\n        dropzone.classList.add('task-attachment-dragover');\r\n        setDropzoneDragoverStyles(dropzone, true);\r\n    });\r\n\r\n    dropzone.addEventListener('dragleave', function(e) {\r\n        e.preventDefault();\r\n        dragDepth = Math.max(0, dragDepth - 1);\r\n        if (dragDepth === 0) {\r\n            dropzone.classList.remove('task-attachment-dragover');\r\n            setDropzoneDragoverStyles(dropzone, false);\r\n        }\r\n    });\r\n\r\n    dropzone.addEventListener('drop', function(e) {\r\n        dragDepth = 0;\r\n        dropzone.classList.remove('task-attachment-dragover');\r\n        setDropzoneDragoverStyles(dropzone, false);\r\n        handleDropOrPasteFileList(e.dataTransfer && e.dataTransfer.files, e);\r\n    });\r\n\r\n    dropzone.addEventListener('dragend', function() {\r\n        dragDepth = 0;\r\n        dropzone.classList.remove('task-attachment-dragover');\r\n        setDropzoneDragoverStyles(dropzone, false);\r\n    });\r\n\r\n    dropzone.addEventListener('paste', function(e) {\r\n        if (!e.clipboardData) return;\r\n        const files = e.clipboardData.files;\r\n        if (files && files.length > 0) {\r\n            handleDropOrPasteFileList(files, e);\r\n        }\r\n    });\r\n\r\n    dropzone.addEventListener('click', function() {\r\n        fileInput.click();\r\n    });\r\n\r\n    dropzone.addEventListener('keydown', function(e) {\r\n        if (e.key === 'Enter' || e.key === ' ') {\r\n            e.preventDefault();\r\n            fileInput.click();\r\n        }\r\n    });\r\n\r\n    fileInput.addEventListener('change', function(e) {\r\n        const files = e.target.files;\r\n        if (files && files.length > 0) {\r\n            handleDropOrPasteFileList(files, e);\r\n        }\r\n        fileInput.value = '';\r\n    });\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', initTaskAttachmentDropzone);\r\n\r\nasync function uploadTaskAttachmentFile(file, uiEl) {\r\n    if (!file) return;\r\n\r\n    const fileType = getFileType(file.type || '', file.name || '');\r\n    const maxSize = getMaxFileSize(fileType);\r\n\r\n    if (file.size > maxSize) {\r\n        const maxMB = Math.round(maxSize / (1024 * 1024));\r\n        showErrorNotification(t('error.fileSizeTooLarge', { maxMB }));\r\n        return;\r\n    }\r\n\r\n    const isButton = uiEl && uiEl.tagName === 'BUTTON';\r\n    const originalText = isButton ? (uiEl.textContent || '\uD83D\uDCC1 Upload File') : null;\r\n    const defaultText = !isButton\r\n        ? (uiEl?.dataset?.defaultText || t('tasks.modal.attachmentsDropzoneDefault'))\r\n        : null;\r\n\r\n    try {\r\n        if (uiEl) {\r\n            if (isButton) {\r\n                uiEl.textContent = '\u23F3 Uploading...';\r\n                uiEl.disabled = true;\r\n            } else {\r\n                uiEl.innerHTML = '';\r\n                const textEl = document.createElement('span');\r\n                textEl.className = 'task-attachment-dropzone-text';\r\n                textEl.textContent = `Uploading ${file.name}...`;\r\n                uiEl.appendChild(textEl);\r\n                uiEl.classList.add('task-attachment-uploading');\r\n                uiEl.setAttribute('aria-busy', 'true');\r\n            }\r\n        }\r\n\r\n        const base64 = await convertFileToBase64(file);\r\n        const fileKey = `file_${Date.now()}_${Math.random().toString(36).substring(7)}`;\r\n        await uploadFile(fileKey, base64);\r\n\r\n        const attachment = {\r\n            name: file.name,\r\n            icon: getFileIcon(fileType),\r\n            type: 'file',\r\n            fileType: fileType,\r\n            fileKey: fileKey,\r\n            mimeType: file.type,\r\n            size: file.size,\r\n            addedAt: new Date().toISOString()\r\n        };\r\n\r\n        const taskId = document.getElementById('task-form').dataset.editingTaskId;\r\n\r\n        if (taskId) {\r\n            const task = tasks.find(t => t.id === parseInt(taskId));\r\n            if (!task) return;\r\n            if (!task.attachments) task.attachments = [];\r\n            task.attachments.push(attachment);\r\n\r\n            // Update UI immediately (optimistic update)\r\n            renderAttachments(task.attachments);\r\n\r\n            // Save in background (don't block UI)\r\n            saveTasks().catch(err => {\r\n                console.error('Failed to save attachment:', err);\r\n                showErrorNotification(t('error.attachmentSaveFailed'));\r\n            });\r\n        } else {\r\n            tempAttachments.push(attachment);\r\n            renderAttachments(tempAttachments);\r\n        }\r\n\r\n        showSuccessNotification(t('success.fileUploaded'));\r\n\r\n    } catch (error) {\r\n        showErrorNotification(t('error.fileUploadFailed', { message: error.message }));\r\n    } finally {\r\n        if (uiEl) {\r\n            if (isButton) {\r\n                uiEl.textContent = originalText;\r\n                uiEl.disabled = false;\r\n            } else {\r\n                uiEl.innerHTML = '';\r\n                const textEl = document.createElement('span');\r\n                textEl.className = 'task-attachment-dropzone-text';\r\n                textEl.textContent = defaultText;\r\n                uiEl.appendChild(textEl);\r\n                uiEl.classList.remove('task-attachment-uploading');\r\n                uiEl.removeAttribute('aria-busy');\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nasync function addFileAttachment(event) {\r\n    const fileInput = document.getElementById('attachment-file');\r\n    const file = fileInput && fileInput.files ? fileInput.files[0] : null;\r\n\r\n    if (!file) {\r\n        showErrorNotification(t('error.selectFile'));\r\n        return;\r\n    }\r\n\r\n    const uiEl =\r\n        document.getElementById('attachment-file-dropzone') ||\r\n        event?.target ||\r\n        null;\r\n\r\n    await uploadTaskAttachmentFile(file, uiEl);\r\n\r\n    if (fileInput) fileInput.value = '';\r\n}\r\n\r\nfunction getFileType(mimeType, filename) {\r\n    if (mimeType.startsWith('image/')) return 'image';\r\n    if (mimeType === 'application/pdf' || filename.toLowerCase().endsWith('.pdf')) return 'pdf';\r\n    if (mimeType.includes('spreadsheet') || filename.match(/\\.(xlsx?|csv)$/i)) return 'spreadsheet';\r\n    if (mimeType.includes('document') || mimeType.includes('word') || filename.match(/\\.docx?$/i)) return 'document';\r\n    if (mimeType.includes('presentation') || mimeType.includes('powerpoint') || filename.match(/\\.pptx?$/i)) return 'presentation';\r\n    return 'file';\r\n}\r\n\r\nfunction getMaxFileSize(fileType) {\r\n    switch (fileType) {\r\n        case 'pdf':\r\n            return 20 * 1024 * 1024; // 20MB for PDFs\r\n        case 'image':\r\n        case 'spreadsheet':\r\n        case 'document':\r\n        case 'presentation':\r\n            return 10 * 1024 * 1024; // 10MB for others\r\n        default:\r\n            return 10 * 1024 * 1024; // 10MB default\r\n    }\r\n}\r\n\r\nfunction getFileIcon(fileType) {\r\n    switch (fileType) {\r\n        case 'image': return '\\u{1F5BC}\\u{FE0F}';\r\n        case 'pdf': return '\uD83D\uDCC4';\r\n        case 'spreadsheet': return '\uD83D\uDCCA';\r\n        case 'document': return '\uD83D\uDCDD';\r\n        case 'presentation': return '\uD83D\uDCCA';\r\n        default: return '\uD83D\uDDC2\uFE0F';\r\n    }\r\n}\r\n\r\n// File utility functions imported from src/utils/file.js\r\n\r\n// Expose file attachment functions to window for onclick handlers\r\nwindow.addFileAttachment = addFileAttachment;\r\nwindow.viewFile = viewFile;\r\n      window.viewImageLegacy = viewImageLegacy;\r\nwindow.downloadFileAttachment = downloadFileAttachment;\r\nwindow.removeAttachment = removeAttachment;\r\n\r\n// Kanban Settings\r\nwindow.kanbanShowBacklog = localStorage.getItem('kanbanShowBacklog') === 'true'; // disabled by default\r\nwindow.kanbanShowProjects = localStorage.getItem('kanbanShowProjects') !== 'false';\r\nwindow.kanbanShowNoDate = localStorage.getItem('kanbanShowNoDate') !== 'false';\r\nwindow.kanbanUpdatedFilter = localStorage.getItem('kanbanUpdatedFilter') || 'all'; // all | 5m | 30m | 24h | week | month\r\n\r\n// Status Settings\r\nwindow.enableReviewStatus = localStorage.getItem('enableReviewStatus') === 'true'; // disabled by default\r\n\r\nfunction getKanbanUpdatedFilterLabel(value) {\r\n    switch (value) {\r\n        case '5m': return '5m';\r\n        case '30m': return '30m';\r\n        case '24h': return '24h';\r\n        case 'week': return t('filters.updated.week');\r\n        case 'month': return t('filters.updated.month');\r\n        case 'all':\r\n        default:\r\n            return '';\r\n    }\r\n}\r\n\r\nfunction updateKanbanGridColumns() {\r\n    const kanbanBoard = document.querySelector('.kanban-board');\r\n    if (!kanbanBoard) return;\r\n\r\n    // Count visible columns\r\n    let visibleColumns = 3; // todo, progress, done (always visible)\r\n\r\n    if (window.kanbanShowBacklog === true) visibleColumns++;\r\n    if (window.enableReviewStatus !== false) visibleColumns++;\r\n\r\n    kanbanBoard.style.gridTemplateColumns = `repeat(${visibleColumns}, 1fr)`;\r\n}\r\n\r\nfunction applyReviewStatusVisibility() {\r\n    const enabled = window.enableReviewStatus !== false;\r\n\r\n    // Show/hide IN REVIEW kanban column\r\n    const reviewColumn = document.getElementById('kanban-column-review');\r\n    if (reviewColumn) {\r\n        reviewColumn.style.display = enabled ? '' : 'none';\r\n    }\r\n\r\n    // Show/hide IN REVIEW filter option\r\n    const reviewFilter = document.getElementById('filter-status-review');\r\n    if (reviewFilter) {\r\n        reviewFilter.style.display = enabled ? '' : 'none';\r\n    }\r\n\r\n    // Update grid columns\r\n    updateKanbanGridColumns();\r\n\r\n    // If disabled, clear any active review status filter\r\n    if (!enabled && filterState.statuses.has('review')) {\r\n        filterState.statuses.delete('review');\r\n        updateFilterBadges();\r\n        renderAfterFilterChange();\r\n    }\r\n}\r\n\r\nfunction applyBacklogColumnVisibility() {\r\n    const enabled = window.kanbanShowBacklog === true;\r\n\r\n    // Show/hide BACKLOG kanban column\r\n    const backlogColumn = document.getElementById('kanban-column-backlog');\r\n    if (backlogColumn) {\r\n        backlogColumn.style.display = enabled ? '' : 'none';\r\n    }\r\n\r\n    // Update grid columns\r\n    updateKanbanGridColumns();\r\n\r\n    applyBacklogFilterVisibility();\r\n}\r\n\r\n/**\r\n * When Tasks + Kanban + Backlog column hidden: hide Backlog in Status filter,\r\n * clear it from filter state, and refresh. Otherwise show Backlog option.\r\n * (Plan: docs/plans/backlog-ux-golden-standard.md)\r\n */\r\nfunction applyBacklogFilterVisibility() {\r\n    const activeId = typeof getActivePageId === 'function' ? getActivePageId() : null;\r\n    const kanbanBoard = document.querySelector('.kanban-board');\r\n    const isKanban = kanbanBoard && !kanbanBoard.classList.contains('hidden');\r\n    const hideBacklog = activeId === 'tasks' && isKanban && window.kanbanShowBacklog !== true;\r\n\r\n    const backlogLi = document.getElementById('filter-status-backlog');\r\n    if (backlogLi) {\r\n        backlogLi.style.display = hideBacklog ? 'none' : '';\r\n    }\r\n\r\n    if (hideBacklog && filterState.statuses.has('backlog')) {\r\n        filterState.statuses.delete('backlog');\r\n        const cb = document.querySelector('input[data-filter=\"status\"][value=\"backlog\"]');\r\n        if (cb) cb.checked = false;\r\n        updateFilterBadges();\r\n        renderAfterFilterChange();\r\n    }\r\n}\r\n\r\nfunction touchProjectUpdatedAt(projectId) {\r\n    const pid = projectId ? parseInt(projectId, 10) : null;\r\n    if (!pid) return null;\r\n    const project = projects.find(p => p.id === pid);\r\n    if (!project) return null;\r\n    project.updatedAt = new Date().toISOString();\r\n    return project;\r\n}\r\n\r\nfunction recordProjectTaskLinkChange(projectId, action, task) {\r\n    if (!window.historyService) return;\r\n    const pid = projectId ? parseInt(projectId, 10) : null;\r\n    if (!pid) return;\r\n    const project = projects.find(p => p.id === pid);\r\n    if (!project) return;\r\n    if (action === 'added' && window.historyService.recordProjectTaskAdded) {\r\n        window.historyService.recordProjectTaskAdded(project, task);\r\n    } else if (action === 'removed' && window.historyService.recordProjectTaskRemoved) {\r\n        window.historyService.recordProjectTaskRemoved(project, task);\r\n    }\r\n}\r\n\r\nfunction sanitizeKanbanUpdatedFilterButtonLabel() {\r\n    const btn = document.getElementById('btn-filter-kanban-updated');\r\n    if (!btn) return;\r\n    const badge = btn.querySelector('#badge-kanban-updated');\r\n    if (!badge) return;\r\n\r\n    // Rebuild the button label to avoid any stray/unrecognized glyphs in the HTML.\r\n    while (btn.firstChild) btn.removeChild(btn.firstChild);\r\n    btn.appendChild(document.createTextNode(`${t('tasks.filters.updated')} `));\r\n    btn.appendChild(badge);\r\n    btn.appendChild(document.createTextNode(' '));\r\n    const arrow = document.createElement('span');\r\n    arrow.className = 'filter-arrow';\r\n    arrow.textContent = '\u25BC';\r\n    btn.appendChild(arrow);\r\n}\r\n\r\nfunction updateKanbanUpdatedFilterUI() {\r\n    try { sanitizeKanbanUpdatedFilterButtonLabel(); } catch (e) {}\r\n    const badge = document.getElementById('badge-kanban-updated');\r\n    if (badge) {\r\n        badge.textContent = getKanbanUpdatedFilterLabel(window.kanbanUpdatedFilter);\r\n\r\n        // Update active state\r\n        const button = badge.closest('.filter-button');\r\n        if (button) {\r\n            if (window.kanbanUpdatedFilter !== 'all') {\r\n                button.classList.add('active');\r\n            } else {\r\n                button.classList.remove('active');\r\n            }\r\n        }\r\n    }\r\n\r\n    try {\r\n        document\r\n            .querySelectorAll('input[type=\"radio\"][data-filter=\"kanban-updated\"][name=\"kanban-updated-filter\"]')\r\n            .forEach((rb) => {\r\n                rb.checked = rb.value === window.kanbanUpdatedFilter;\r\n            });\r\n    } catch (e) {}\r\n}\r\n\r\nfunction setKanbanUpdatedFilter(value, options = { render: true }) {\r\n    const allowed = new Set(['all', '5m', '30m', '24h', 'week', 'month']);\r\n    const normalized = allowed.has(value) ? value : (value === 'today' ? '24h' : 'all');\r\n\r\n    window.kanbanUpdatedFilter = normalized;\r\n    try { localStorage.setItem('kanbanUpdatedFilter', normalized); } catch (e) {}\r\n\r\n    updateKanbanUpdatedFilterUI();\r\n    try { renderActiveFilterChips(); } catch (e) {}\r\n\r\n    // Sync updated filter to URL for shareable links\r\n    try { syncURLWithFilters(); } catch (e) {}\r\n\r\n    if (options && options.render === false) return;\r\n\r\n    // Re-render whichever tasks view is currently active (never forces sorting).\r\n    const isKanban = !document.querySelector('.kanban-board')?.classList.contains('hidden');\r\n    const isList = document.getElementById('list-view')?.classList.contains('active');\r\n    const isCalendar = document.getElementById('calendar-view')?.classList.contains('active');\r\n    if (isKanban) renderTasks();\r\n    if (isList || getIsMobileCached()) renderListView();\r\n    if (isCalendar) renderCalendar();\r\n}\r\n\r\nfunction toggleKanbanSettings(event) {\r\n    event.stopPropagation();\r\n    const panel = document.getElementById('kanban-settings-panel');\r\n    const isActive = panel.classList.contains('active');\r\n\r\n    if (isActive) {\r\n        panel.classList.remove('active');\r\n    } else {\r\n        panel.classList.add('active');\r\n        // Load current state\r\n        document.getElementById('kanban-show-backlog').checked = window.kanbanShowBacklog === true;\r\n        document.getElementById('kanban-show-projects').checked = window.kanbanShowProjects !== false;\r\n        document.getElementById('kanban-show-no-date').checked = window.kanbanShowNoDate !== false;\r\n    }\r\n}\r\n\r\nfunction toggleKanbanBacklog() {\r\n    const checkbox = document.getElementById('kanban-show-backlog');\r\n    window.kanbanShowBacklog = checkbox.checked;\r\n    localStorage.setItem('kanbanShowBacklog', checkbox.checked);\r\n\r\n    // Show/hide backlog column\r\n    const backlogColumn = document.getElementById('kanban-column-backlog');\r\n    if (backlogColumn) {\r\n        backlogColumn.style.display = checkbox.checked ? '' : 'none';\r\n    }\r\n\r\n    // Update kanban grid columns\r\n    updateKanbanGridColumns();\r\n\r\n    // Hide Backlog in filter when column OFF, clear from filter and refresh (plan: backlog-ux-golden-standard)\r\n    applyBacklogFilterVisibility();\r\n\r\n    renderTasks();\r\n}\r\n\r\nfunction toggleKanbanProjects() {\r\n    const checkbox = document.getElementById('kanban-show-projects');\r\n    window.kanbanShowProjects = checkbox.checked;\r\n    localStorage.setItem('kanbanShowProjects', checkbox.checked);\r\n    renderTasks();\r\n}\r\n\r\nfunction toggleKanbanNoDate() {\r\n    const checkbox = document.getElementById('kanban-show-no-date');\r\n    window.kanbanShowNoDate = checkbox.checked;\r\n    localStorage.setItem('kanbanShowNoDate', checkbox.checked);\r\n    renderTasks();\r\n}\r\n\r\nwindow.toggleKanbanSettings = toggleKanbanSettings;\r\nwindow.toggleKanbanBacklog = toggleKanbanBacklog;\r\nwindow.toggleKanbanProjects = toggleKanbanProjects;\r\nwindow.toggleKanbanNoDate = toggleKanbanNoDate;\r\n\r\n// Close settings panel when clicking outside\r\ndocument.addEventListener('click', (e) => {\r\n    const panel = document.getElementById('kanban-settings-panel');\r\n    const btn = document.getElementById('kanban-settings-btn');\r\n    if (panel && !panel.contains(e.target) && e.target !== btn && !btn.contains(e.target)) {\r\n        panel.classList.remove('active');\r\n    }\r\n});\r\n\r\nasync function updateTaskField(field, value) {\r\n  const form = document.getElementById('task-form');\r\n  const taskId = form?.dataset.editingTaskId;\r\n  if (!taskId) return;\r\n\r\n  // Capture old task state for history tracking\r\n  const oldTask = tasks.find(t => t.id === parseInt(taskId, 10));\r\n  const oldTaskCopy = oldTask ? JSON.parse(JSON.stringify(oldTask)) : null;\r\n\r\n  // Use task service to update field\r\n  const normalizedValue = field === 'description' ? autoLinkifyDescription(value) : value;\r\n\r\n  // Avoid unnecessary background rerenders when the value didn't actually change\r\n  if (oldTask) {\r\n    const prev = oldTask[field];\r\n    let isSame = false;\r\n\r\n    if (field === 'projectId') {\r\n      const nextProjectId =\r\n        normalizedValue === '' || normalizedValue === null || typeof normalizedValue === 'undefined'\r\n          ? null\r\n          : parseInt(normalizedValue, 10);\r\n      const prevProjectId = typeof oldTask.projectId === 'number' ? oldTask.projectId : null;\r\n      isSame = (Number.isNaN(nextProjectId) ? null : nextProjectId) === prevProjectId;\r\n    } else {\r\n      const prevStr = typeof prev === 'string' ? prev : (prev || '');\r\n      const nextStr = typeof normalizedValue === 'string' ? normalizedValue : (normalizedValue || '');\r\n      isSame = prevStr === nextStr;\r\n    }\r\n\r\n    if (isSame) return;\r\n  }\r\n\r\n  const result = updateTaskFieldService(parseInt(taskId, 10), field, normalizedValue, tasks, settings);\r\n  if (!result.task) return;\r\n\r\n  // Record history for field update\r\n  if (window.historyService && oldTaskCopy) {\r\n    window.historyService.recordTaskUpdated(oldTaskCopy, result.task);\r\n  }\r\n\r\n  // Capture the project the detail view is currently showing this task under\r\n  const prevProjectId = result.oldProjectId;\r\n\r\n  // Update global tasks array\r\n  tasks = result.tasks;\r\n  const task = result.task;\r\n\r\n  // Project-related changes can affect presence of \"No Project\" option\r\n  if (field === 'projectId') {\r\n    populateProjectOptions();\r\n    const newProjectId = task.projectId;\r\n    if (prevProjectId !== newProjectId) {\r\n        if (prevProjectId) {\r\n            touchProjectUpdatedAt(prevProjectId);\r\n            recordProjectTaskLinkChange(prevProjectId, 'removed', task);\r\n        }\r\n        if (newProjectId) {\r\n            touchProjectUpdatedAt(newProjectId);\r\n            recordProjectTaskLinkChange(newProjectId, 'added', task);\r\n        }\r\n        saveProjects().catch(() => {});\r\n    }\r\n  }\r\n\r\n    if (field === 'endDate') {\r\n        // Toggle \"No Date\" option visibility on end date changes\r\n        updateNoDateOptionVisibility();\r\n    }\r\n\r\n  // Save in background (non-blocking for instant UX)\r\n  // This is safe because updateTaskField is triggered by blur events\r\n  saveTasks().catch(error => {\r\n    console.error('Failed to save task field update:', error);\r\n    showErrorNotification(t('error.saveChangesFailed'));\r\n  });\r\n\r\n  // Check if we're in project details view\r\n  const isInProjectDetails = document.getElementById(\"project-details\").classList.contains(\"active\");\r\n    // Calendar refresh for fields that affect date/project placement\r\n    const affectsPlacement =\r\n      field === 'startDate' ||\r\n      field === 'endDate' ||\r\n      field === 'projectId' ||\r\n      field === 'status' ||\r\n      field === 'priority' ||\r\n      field === 'title' ||\r\n      field === 'tags';\r\n\r\n    if (affectsPlacement) {\r\n        reflowCalendarBars();\r\n    }\r\n\r\n    // For fields like description, updating data is enough; avoid repainting background views.\r\n    if (!affectsPlacement) return;\r\n\r\n    if (isInProjectDetails) {\r\n        // Special handling when changing the project from within a project's view\r\n        if (field === 'projectId') {\r\n            const newProjectId = task.projectId; // after update\r\n            if (!newProjectId) {\r\n                // Cleared to \"No Project\" -> stay on current project and refresh it so the task disappears\r\n                if (prevProjectId) {\r\n                    showProjectDetails(prevProjectId);\r\n                    return;\r\n                }\r\n            } else if (prevProjectId !== newProjectId) {\r\n                // Moved to a different project -> navigate to the new project's details\r\n                showProjectDetails(newProjectId);\r\n                return;\r\n            } else {\r\n                // Still in the same project -> refresh current project view\r\n                showProjectDetails(newProjectId);\r\n                return;\r\n            }\r\n        } else {\r\n            // For other field updates while viewing project details, refresh the current project\r\n            const currentProjectId = prevProjectId\r\n                || (window.location.hash && window.location.hash.startsWith('#project-')\r\n                        ? parseInt(window.location.hash.replace('#project-',''), 10)\r\n                        : null);\r\n            if (currentProjectId) {\r\n                showProjectDetails(currentProjectId);\r\n                return;\r\n            }\r\n        }\r\n    } else {\r\n    // Otherwise refresh the main views\r\n    renderTasks();\r\n    // Always render list view on mobile (for mobile cards) or when active on desktop\r\n    const isMobile = getIsMobileCached();\r\n    if (isMobile || document.getElementById('list-view').classList.contains('active')) renderListView();\r\n    if (document.getElementById('projects').classList.contains('active')) {\r\n        // Clear sorted view cache to force refresh with updated task data\r\n        appState.projectsSortedView = null;\r\n        renderProjects();\r\n        updateCounts();\r\n    }\r\n  }\r\n\r\n  // Refresh date fields in UI if status change auto-filled them\r\n  // Use setTimeout to ensure this happens after any rendering completes\r\n  if (field === 'status' && (settings.autoSetStartDateOnStatusChange || settings.autoSetEndDateOnStatusChange)) {\r\n    setTimeout(() => {\r\n      const formNow = document.getElementById('task-form');\r\n      if (!formNow) return; // Form might have closed\r\n\r\n      const startDateInput = formNow.querySelector('input[name=\"startDate\"]');\r\n      const endDateInput = formNow.querySelector('input[name=\"endDate\"]');\r\n\r\n      // Update Start Date using Flatpickr API\r\n      if (startDateInput && task.startDate) {\r\n        const fpStart = startDateInput._flatpickrInstance;\r\n        if (fpStart) {\r\n          fpStart.setDate(new Date(task.startDate), false);\r\n        }\r\n        startDateInput.value = task.startDate;\r\n\r\n        // Also update display input if it exists\r\n        const displayStart = startDateInput.parentElement?.querySelector(\"input.date-display\");\r\n        if (displayStart) {\r\n          displayStart.value = toDMYFromISO(task.startDate);\r\n        }\r\n      }\r\n\r\n      // Update End Date using Flatpickr API\r\n      if (endDateInput && task.endDate) {\r\n        const fpEnd = endDateInput._flatpickrInstance;\r\n        if (fpEnd) {\r\n          fpEnd.setDate(new Date(task.endDate), false);\r\n        }\r\n        endDateInput.value = task.endDate;\r\n\r\n        // Also update display input if it exists\r\n        const displayEnd = endDateInput.parentElement?.querySelector(\"input.date-display\");\r\n        if (displayEnd) {\r\n          displayEnd.value = toDMYFromISO(task.endDate);\r\n        }\r\n      }\r\n    }, 50);\r\n  }\r\n}\r\n\r\n// === Click outside to close task/project modals (keep ESC intact) ===\r\n\r\n// Store initial form state to detect actual changes (not just default values)\r\nlet initialTaskFormState = null;\r\n\r\n// Capture initial form state after defaults are set\r\nfunction captureInitialTaskFormState() {\r\n  const form = document.getElementById('task-form');\r\n  if (!form) return;\r\n\r\n  initialTaskFormState = {\r\n    title: form.querySelector('input[name=\"title\"]')?.value.trim() || \"\",\r\n    description: document.getElementById('task-description-hidden')?.value.trim() || \"\",\r\n    projectId: form.querySelector('input[name=\"projectId\"]')?.value || form.querySelector('select[name=\"projectId\"]')?.value || \"\",\r\n    startDate: form.querySelector('input[name=\"startDate\"]')?.value || \"\",\r\n    endDate: form.querySelector('input[name=\"endDate\"]')?.value || \"\",\r\n    priority: form.querySelector('#hidden-priority')?.value || \"medium\",\r\n    status: form.querySelector('#hidden-status')?.value || \"backlog\",\r\n    tags: window.tempTags ? [...window.tempTags] : [],\r\n    attachments: tempAttachments ? tempAttachments.length : 0\r\n  };\r\n}\r\n\r\n// Detect unsaved data in NEW (not editing) task\r\nfunction hasUnsavedNewTask() {\r\n  const form = document.getElementById('task-form');\r\n  if (!form) return false;\r\n  if (form.dataset.editingTaskId) return false;\r\n  if (!initialTaskFormState) return false; // No initial state captured\r\n\r\n  const currentState = {\r\n    title: form.querySelector('input[name=\"title\"]')?.value.trim() || \"\",\r\n    description: document.getElementById('task-description-hidden')?.value.trim() || \"\",\r\n    projectId: form.querySelector('input[name=\"projectId\"]')?.value || form.querySelector('select[name=\"projectId\"]')?.value || \"\",\r\n    startDate: form.querySelector('input[name=\"startDate\"]')?.value || \"\",\r\n    endDate: form.querySelector('input[name=\"endDate\"]')?.value || \"\",\r\n    priority: form.querySelector('#hidden-priority')?.value || \"medium\",\r\n    status: form.querySelector('#hidden-status')?.value || \"backlog\",\r\n    tags: window.tempTags ? [...window.tempTags] : [],\r\n    attachments: tempAttachments ? tempAttachments.length : 0\r\n  };\r\n\r\n  // Compare current state with initial state\r\n  return (\r\n    currentState.title !== initialTaskFormState.title ||\r\n    currentState.description !== initialTaskFormState.description ||\r\n    currentState.projectId !== initialTaskFormState.projectId ||\r\n    currentState.startDate !== initialTaskFormState.startDate ||\r\n    currentState.endDate !== initialTaskFormState.endDate ||\r\n    currentState.priority !== initialTaskFormState.priority ||\r\n    currentState.status !== initialTaskFormState.status ||\r\n    currentState.tags.length !== initialTaskFormState.tags.length ||\r\n    currentState.attachments !== initialTaskFormState.attachments\r\n  );\r\n}\r\n\r\n// Attach click-outside behavior to specific modals\r\nfunction bindOverlayClose(modalId) {\r\n  const modal = document.getElementById(modalId);\r\n  if (!modal || modal.__overlayBound) return;\r\n  modal.__overlayBound = true;\r\n\r\n  modal.addEventListener('pointerdown', e => {\r\n    modal.__downOnOverlay = (e.target === modal);\r\n  });\r\n\r\n  modal.addEventListener('click', e => {\r\n    const releasedOnOverlay = (e.target === modal);\r\n    const startedOnOverlay = !!modal.__downOnOverlay;\r\n    modal.__downOnOverlay = false;\r\n    if (!releasedOnOverlay || !startedOnOverlay) return;\r\n\r\n    // If closing an existing task via overlay, persist description first\r\n    if (modalId === 'task-modal') {\r\n      const form = document.getElementById('task-form');\r\n      if (form && form.dataset.editingTaskId) {\r\n        const descEditor = form.querySelector('#task-description-editor');\r\n        if (descEditor) {\r\n          updateTaskField('description', descEditor.innerHTML);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (modalId === 'task-modal' && hasUnsavedNewTask()) {\r\n      // Show custom unsaved changes modal\r\n      showUnsavedChangesModal(modalId);\r\n      return;\r\n    }\r\n    closeModal(modalId);\r\n  });\r\n}\r\n\r\n// Bind to your existing modals\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n  bindOverlayClose('task-modal');\r\n  bindOverlayClose('project-modal');\r\n  bindOverlayClose('settings-modal');\r\n});\r\n\r\n// === ESC key close (existing behavior retained) ===\r\ndocument.addEventListener('keydown', async e => {\r\n  if (e.key === 'Escape') {\r\n        const modals = document.querySelectorAll('.modal.active');\r\n        modals.forEach(m => {\r\n            if (m.id === 'task-modal') {\r\n                if (hasUnsavedNewTask()) {\r\n                    showUnsavedChangesModal('task-modal');\r\n                } else {\r\n                    // Persist description for editing tasks before closing via ESC\r\n                    const form = document.getElementById('task-form');\r\n                    if (form && form.dataset.editingTaskId) {\r\n                        const descEditor = form.querySelector('#task-description-editor');\r\n                        if (descEditor) {\r\n                            updateTaskField('description', descEditor.innerHTML);\r\n                        }\r\n                    }\r\n                    closeModal(m.id);\r\n                }\r\n            } else {\r\n                if (m.id === 'settings-modal' && window.settingsFormIsDirty) {\r\n                    showUnsavedChangesModal('settings-modal');\r\n                } else {\r\n                    closeModal(m.id);\r\n                }\r\n            }\r\n        });\r\n  }\r\n\r\n  // N key to toggle notifications\r\n  if (e.key === 'n' || e.key === 'N') {\r\n    // Don't trigger if user is typing in an input/textarea\r\n    if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.isContentEditable) {\r\n      return;\r\n    }\r\n\r\n    e.preventDefault();\r\n    const dropdown = document.getElementById('notification-dropdown');\r\n    const toggle = document.getElementById('notification-toggle');\r\n    if (!dropdown || !toggle) return;\r\n\r\n    const isOpen = dropdown.classList.contains('active');\r\n    if (isOpen) {\r\n      closeNotificationDropdown();\r\n    } else {\r\n      closeUserDropdown();\r\n      const state = await fetchNotificationState({ force: true });\r\n      renderNotificationDropdown(state);\r\n      dropdown.classList.add('active');\r\n      toggle.classList.add('active');\r\n      await markNotificationsSeen(state);\r\n    }\r\n  }\r\n});\r\n\r\n\r\nasync function addTag() {\r\n    const input = document.getElementById('tag-input');\r\n    const tagName = input.value.trim().toLowerCase();\r\n    \r\n    if (!tagName) {\r\n        input.style.border = '2px solid var(--accent-red, #ef4444)';\r\n        setTimeout(() => { input.style.border = ''; }, 2000);\r\n        return;\r\n    }\r\n    \r\n    const taskId = document.getElementById('task-form').dataset.editingTaskId;\r\n    \r\n    if (taskId) {\r\n        const task = tasks.find(t => t.id === parseInt(taskId));\r\n        if (!task) return;\r\n        if (!task.tags) task.tags = [];\r\n        if (task.tags.includes(tagName)) {\r\n            input.value = '';\r\n            return; // Already exists\r\n        }\r\n\r\n        // Store old state for history\r\n        const oldTaskCopy = JSON.parse(JSON.stringify(task));\r\n\r\n        task.tags = [...task.tags, tagName];\r\n        renderTags(task.tags);\r\n\r\n        // Reorganize mobile fields after tag addition\r\n        reorganizeMobileTaskFields();\r\n\r\n        // Record history\r\n        if (window.historyService) {\r\n            window.historyService.recordTaskUpdated(oldTaskCopy, task);\r\n        }\r\n\r\n        // Refresh views if in project details\r\n        const isInProjectDetails = document.getElementById(\"project-details\").classList.contains(\"active\");\r\n        if (isInProjectDetails && task.projectId) {\r\n            showProjectDetails(task.projectId);\r\n        } else {\r\n            // Refresh Kanban view immediately\r\n            renderTasks();\r\n\r\n            const isMobile = getIsMobileCached();\r\n            if (isMobile || document.getElementById('list-view').classList.contains('active')) {\r\n                renderListView();\r\n            }\r\n            if (document.getElementById('projects').classList.contains('active')) {\r\n                // Clear sorted view cache to force refresh with updated tags\r\n                appState.projectsSortedView = null;\r\n                renderProjects();\r\n            }\r\n        }\r\n\r\n        populateTagOptions(); // Refresh tag dropdown only\r\n        updateNoDateOptionVisibility();\r\n\r\n        // Save in background\r\n        saveTasks().catch(error => {\r\n            console.error('Failed to save tag addition:', error);\r\n            showErrorNotification(t('error.saveTagFailed'));\r\n        });\r\n    } else {\r\n        // Creating new task - use temp array\r\n        if (!window.tempTags) window.tempTags = [];\r\n        if (window.tempTags.includes(tagName)) {\r\n            input.value = '';\r\n            return;\r\n        }\r\n        window.tempTags = [...window.tempTags, tagName];\r\n        renderTags(window.tempTags);\r\n    }\r\n    \r\n    input.value = '';\r\n}\r\n\r\nasync function removeTag(tagName) {\r\n    const taskId = document.getElementById('task-form').dataset.editingTaskId;\r\n\r\n    if (taskId) {\r\n        const task = tasks.find(t => t.id === parseInt(taskId));\r\n        if (!task || !task.tags) return;\r\n\r\n        // Store old state for history\r\n        const oldTaskCopy = JSON.parse(JSON.stringify(task));\r\n\r\n        task.tags = task.tags.filter(t => t !== tagName);\r\n        renderTags(task.tags);\r\n\r\n        // Reorganize mobile fields after tag removal\r\n        reorganizeMobileTaskFields();\r\n\r\n        // Record history\r\n        if (window.historyService) {\r\n            window.historyService.recordTaskUpdated(oldTaskCopy, task);\r\n        }\r\n\r\n        // Save in background\r\n        saveTasks().catch(error => {\r\n            console.error('Failed to save tag removal:', error);\r\n            showErrorNotification(t('error.removeTagFailed'));\r\n        });\r\n\r\n        // Refresh views if in project details\r\n        const isInProjectDetails = document.getElementById(\"project-details\").classList.contains(\"active\");\r\n        if (isInProjectDetails && task.projectId) {\r\n            showProjectDetails(task.projectId);\r\n        } else {\r\n            renderTasks();\r\n            const isMobile = getIsMobileCached();\r\n            if (isMobile || document.getElementById('list-view').classList.contains('active')) {\r\n                renderListView();\r\n            }\r\n            if (document.getElementById('projects').classList.contains('active')) {\r\n                // Clear sorted view cache to force refresh with updated tags\r\n                appState.projectsSortedView = null;\r\n                renderProjects();\r\n            }\r\n        }\r\n\r\n        populateTagOptions(); // Refresh tag dropdown only\r\n    updateNoDateOptionVisibility();\r\n    } else {\r\n        if (!window.tempTags) window.tempTags = [];\r\n        window.tempTags = window.tempTags.filter(t => t !== tagName);\r\n        renderTags(window.tempTags);\r\n    }\r\n}\r\n\r\nfunction renderTags(tags) {\r\n    const container = document.getElementById('tags-display');\r\n    const isMobile = getIsMobileCached();\r\n\r\n    container.innerHTML = generateTagsDisplayHTML(tags, {\r\n        isMobile,\r\n        getTagColor,\r\n        escapeHtml,\r\n        noTagsText: t('tasks.tags.none')\r\n    });\r\n}\r\n\r\n// === Project Tag Management ===\r\nasync function addProjectTag() {\r\n    const input = document.getElementById('project-tag-input');\r\n    const tagName = input.value.trim().toLowerCase();\r\n\r\n    if (!tagName) {\r\n        input.style.border = '2px solid var(--accent-red, #ef4444)';\r\n        setTimeout(() => { input.style.border = ''; }, 2000);\r\n        return;\r\n    }\r\n\r\n    const projectId = document.getElementById('project-form').dataset.editingProjectId;\r\n\r\n    if (projectId) {\r\n        const project = projects.find(p => p.id === parseInt(projectId));\r\n        if (!project) return;\r\n        if (!project.tags) project.tags = [];\r\n        if (project.tags.includes(tagName)) {\r\n            input.value = '';\r\n            return; // Already exists\r\n        }\r\n\r\n        project.tags = [...project.tags, tagName];\r\n        renderProjectTags(project.tags);\r\n\r\n        // Clear sorted view cache to force refresh\r\n        appState.projectsSortedView = null;\r\n        renderProjects();\r\n\r\n        // Refresh tag dropdown\r\n        populateProjectTagOptions();\r\n\r\n        // Save in background\r\n        saveProjects().catch(error => {\r\n            console.error('Failed to save project tag addition:', error);\r\n            showErrorNotification(t('error.saveTagFailed'));\r\n        });\r\n    } else {\r\n        // Creating new project - use temp array\r\n        if (!window.tempProjectTags) window.tempProjectTags = [];\r\n        if (window.tempProjectTags.includes(tagName)) {\r\n            input.value = '';\r\n            return;\r\n        }\r\n        window.tempProjectTags = [...window.tempProjectTags, tagName];\r\n        renderProjectTags(window.tempProjectTags);\r\n    }\r\n\r\n    input.value = '';\r\n}\r\n\r\nasync function removeProjectTag(tagName) {\r\n    const projectId = document.getElementById('project-form').dataset.editingProjectId;\r\n\r\n    if (projectId) {\r\n        const project = projects.find(p => p.id === parseInt(projectId));\r\n        if (!project || !project.tags) return;\r\n\r\n        project.tags = project.tags.filter(t => t !== tagName);\r\n        renderProjectTags(project.tags);\r\n\r\n        // Clear sorted view cache to force refresh\r\n        appState.projectsSortedView = null;\r\n        renderProjects();\r\n\r\n        // Refresh tag dropdown\r\n        populateProjectTagOptions();\r\n\r\n        // Save in background\r\n        saveProjects().catch(error => {\r\n            console.error('Failed to save project tag removal:', error);\r\n            showErrorNotification(t('error.saveTagFailed'));\r\n        });\r\n    } else {\r\n        // Creating new project - remove from temp array\r\n        if (!window.tempProjectTags) return;\r\n        window.tempProjectTags = window.tempProjectTags.filter(t => t !== tagName);\r\n        renderProjectTags(window.tempProjectTags);\r\n    }\r\n}\r\n\r\nfunction renderProjectTags(tags) {\r\n    const container = document.getElementById('project-tags-display');\r\n    if (!tags || tags.length === 0) {\r\n        container.innerHTML = `<span style=\"color: var(--text-muted); font-size: 13px;\">${t('tasks.tags.none')}</span>`;\r\n        return;\r\n    }\r\n\r\n    // Get project color from editingProjectId or use default gray for new projects\r\n    const projectId = document.getElementById('project-form')?.dataset.editingProjectId;\r\n    const color = projectId ? getProjectColor(parseInt(projectId)) : '#6b7280';\r\n\r\n    // Detect mobile for smaller tag sizes\r\n    const isMobile = getIsMobileCached();\r\n    const padding = isMobile ? '3px 6px' : '4px 8px';\r\n    const fontSize = isMobile ? '11px' : '12px';\r\n    const gap = isMobile ? '4px' : '4px';\r\n    const buttonSize = isMobile ? '12px' : '14px';\r\n    const lineHeight = isMobile ? '1.2' : '1.4';\r\n\r\n    container.innerHTML = tags.map(tag => {\r\n        return `\r\n            <span class=\"task-tag\" style=\"background-color: ${color}; color: white; padding: ${padding}; border-radius: 4px; font-size: ${fontSize}; display: inline-flex; align-items: center; gap: ${gap}; line-height: ${lineHeight};\">\r\n                ${escapeHtml(tag.toUpperCase())}\r\n                <button type=\"button\" data-action=\"removeProjectTag\" data-param=\"${escapeHtml(tag)}\" style=\"background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${buttonSize}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;\">\u00D7</button>\r\n            </span>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\n// === Project Details Tags Management ===\r\nfunction renderProjectDetailsTags(tags, projectId) {\r\n    const container = document.getElementById('project-details-tags-display');\r\n    if (!container) return;\r\n\r\n    if (!tags || tags.length === 0) {\r\n        container.innerHTML = `<span style=\"color: var(--text-muted); font-size: 13px;\">${t('tasks.tags.none')}</span>`;\r\n        return;\r\n    }\r\n\r\n    // Use project color for all tags (or default gray if no projectId)\r\n    const color = projectId ? getProjectColor(projectId) : '#6b7280';\r\n\r\n    // Detect mobile for smaller tag sizes\r\n    const isMobile = getIsMobileCached();\r\n    const padding = isMobile ? '3px 6px' : '4px 8px';\r\n    const fontSize = isMobile ? '11px' : '12px';\r\n    const gap = isMobile ? '4px' : '4px';\r\n    const buttonSize = isMobile ? '12px' : '14px';\r\n    const lineHeight = isMobile ? '1.2' : '1.4';\r\n\r\n    container.innerHTML = tags.map(tag => {\r\n        return `\r\n            <span class=\"task-tag\" style=\"background-color: ${color}; color: white; padding: ${padding}; border-radius: 4px; font-size: ${fontSize}; display: inline-flex; align-items: center; gap: ${gap}; line-height: ${lineHeight};\">\r\n                ${escapeHtml(tag.toUpperCase())}\r\n                <button type=\"button\" data-action=\"removeProjectDetailsTag\" data-param=\"${escapeHtml(tag)}\" style=\"background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${buttonSize}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;\">\u00D7</button>\r\n            </span>\r\n        `;\r\n    }).join('');\r\n}\r\n\r\nasync function addProjectDetailsTag(projectId) {\r\n    const input = document.getElementById('project-details-tag-input');\r\n    if (!input) return;\r\n\r\n    const tagName = input.value.trim().toLowerCase();\r\n\r\n    if (!tagName) {\r\n        input.style.border = '2px solid var(--accent-red, #ef4444)';\r\n        setTimeout(() => { input.style.border = ''; }, 2000);\r\n        return;\r\n    }\r\n\r\n    const project = projects.find(p => p.id === parseInt(projectId));\r\n    if (!project) return;\r\n\r\n    if (!project.tags) project.tags = [];\r\n    if (project.tags.includes(tagName)) {\r\n        input.value = '';\r\n        return; // Already exists\r\n    }\r\n\r\n    project.tags = [...project.tags, tagName];\r\n    renderProjectDetailsTags(project.tags, projectId);\r\n\r\n    // Clear sorted view cache to force refresh\r\n    appState.projectsSortedView = null;\r\n    renderProjects();\r\n\r\n    // Refresh tag dropdown\r\n    populateProjectTagOptions();\r\n\r\n    // Save in background\r\n    saveProjects().catch(error => {\r\n        console.error('Failed to save project tag addition:', error);\r\n        showErrorNotification(t('error.saveTagFailed'));\r\n    });\r\n\r\n    input.value = '';\r\n}\r\n\r\nasync function removeProjectDetailsTag(tagName) {\r\n    // Get project ID from the current project details view\r\n    const titleDisplay = document.getElementById('project-title-display');\r\n    if (!titleDisplay) return;\r\n\r\n    const projectId = parseInt(titleDisplay.dataset.param);\r\n    const project = projects.find(p => p.id === projectId);\r\n    if (!project || !project.tags) return;\r\n\r\n    project.tags = project.tags.filter(t => t !== tagName);\r\n    renderProjectDetailsTags(project.tags, projectId);\r\n\r\n    // Clear sorted view cache to force refresh\r\n    appState.projectsSortedView = null;\r\n    renderProjects();\r\n\r\n    // Refresh tag dropdown\r\n    populateProjectTagOptions();\r\n\r\n    // Save in background\r\n    saveProjects().catch(error => {\r\n        console.error('Failed to save project tag removal:', error);\r\n        showErrorNotification(t('error.saveTagFailed'));\r\n    });\r\n}\r\n\r\n\r\n// === Event Delegation System ===\r\nexport function initializeEventDelegation() {\r\n    setupEventDelegation({\r\n        toggleTheme,\r\n        showCalendarView,\r\n        toggleKanbanSettings,\r\n        openProjectModal,\r\n        openTaskModal,\r\n        closeUserDropdown,\r\n        openSettingsModal,\r\n        openTaskModalForProject,\r\n        openSelectedProjectFromTask,\r\n        closeModal,\r\n        closeTaskModal,\r\n        closeConfirmModal,\r\n        closeFeedbackDeleteModal,\r\n        closeProjectConfirmModal,\r\n        closeUnsavedChangesModal,\r\n        openDeleteAccountModal,\r\n        closeDeleteAccountModal,\r\n        confirmDeleteAccount,\r\n        closeDayItemsModal,\r\n        closeDayItemsModalOnBackdrop,\r\n        openTaskDetails,\r\n        deleteTask,\r\n        duplicateTask,\r\n        confirmDelete,\r\n        showProjectDetails,\r\n        toggleProjectExpand,\r\n        toggleProjectMenu,\r\n        editProjectTitle,\r\n        saveProjectTitle,\r\n        cancelProjectTitle,\r\n        handleDeleteProject,\r\n        handleDuplicateProject,\r\n        toggleProjectColorPicker,\r\n        updateProjectColor,\r\n        openCustomProjectColorPicker,\r\n        navigateToProjectStatus,\r\n        deleteProject,\r\n        confirmProjectDelete,\r\n        closeDuplicateProjectModal,\r\n        confirmDuplicateProject,\r\n        addFeedbackItem,\r\n        deleteFeedbackItem,\r\n        confirmFeedbackDelete,\r\n        toggleHistoryEntryInline,\r\n        formatTaskText,\r\n        insertTaskHeading,\r\n        insertTaskDivider,\r\n        sortTable,\r\n        toggleSortMode,\r\n        animateCalendarMonthChange,\r\n        goToToday,\r\n        showDayTasks,\r\n        addAttachment,\r\n        addFileAttachment,\r\n        addTag,\r\n        removeTag,\r\n        addProjectTag,\r\n        removeProjectTag,\r\n        addProjectDetailsTag,\r\n        removeProjectDetailsTag,\r\n        removeAttachment,\r\n        downloadFileAttachment,\r\n        viewFile,\r\n        viewImageLegacy,\r\n        showErrorNotification,\r\n        t,\r\n        backToProjects,\r\n        showAllActivity,\r\n        backToDashboard,\r\n        backToCalendar,\r\n        openUpdatesFromNotification,\r\n        openDueTodayFromNotification,\r\n        dismissKanbanTip,\r\n        confirmDiscardChanges,\r\n        closeReviewStatusConfirmModal,\r\n        confirmDisableReviewStatus,\r\n        closeCalendarCreateModal,\r\n        confirmCreateTask,\r\n        addTaskFromDayItemsModal,\r\n        signOut,\r\n        exportDashboardData,\r\n        closeExportDataModal,\r\n        confirmExportData,\r\n        openImportDataModal,\r\n        closeImportDataModal,\r\n        confirmImportData,\r\n        generateReport,\r\n        getCurrentMonth: () => currentMonth,\r\n        getCurrentYear: () => currentYear,\r\n        showStatusInfoModal\r\n    });\r\n}\r\nfunction clearAllFilters() {\r\n    // Clear all filter states\r\n    filterState.statuses.clear();\r\n    filterState.statusExcludeMode = false;\r\n    filterState.priorities.clear();\r\n    filterState.priorityExcludeMode = false;\r\n    filterState.projects.clear();\r\n    filterState.projectExcludeMode = false;\r\n    filterState.tags.clear();\r\n    filterState.tagExcludeMode = false;\r\n    filterState.search = '';\r\n    filterState.datePresets.clear();\r\n    filterState.dateFrom = '';\r\n    filterState.dateTo = '';\r\n\r\n    // Clear search input\r\n    const searchInput = document.getElementById('filter-search');\r\n    if (searchInput) searchInput.value = '';\r\n\r\n    // Clear date inputs\r\n    const dueDateInput = document.getElementById('filter-due-date');\r\n    const createdDateInput = document.getElementById('filter-created-date');\r\n    if (dueDateInput) dueDateInput.value = '';\r\n    if (createdDateInput) createdDateInput.value = '';\r\n\r\n    // Clear date filter dropdown\r\n    const dateFilterGlobal = document.getElementById('filter-date-global');\r\n    if (dateFilterGlobal) dateFilterGlobal.value = '';\r\n\r\n    // Uncheck all filter checkboxes\r\n    const allCheckboxes = document.querySelectorAll('#global-filters input[type=\"checkbox\"]');\r\n    allCheckboxes.forEach(checkbox => {\r\n        checkbox.checked = false;\r\n    });\r\n\r\n    // Update UI and sync URL (this calls updateFilterBadges, renderActiveFilterChips, syncURLWithFilters, and re-renders)\r\n    renderAfterFilterChange();\r\n}\r\n\r\n// Super simple approach - just apply filters directly\r\nfunction filterProjectTasks(projectId, status) {\r\n    // Go to tasks page\r\n    showPage('tasks');\r\n    window.location.hash = 'tasks';\r\n    \r\n    // Set nav active\r\n    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));\r\n    const tasksNav = document.querySelector('.nav-item[data-page=\"tasks\"]');\r\n    if (tasksNav) tasksNav.classList.add('active');\r\n    \r\n    // Clear all filters\r\n    filterState.statuses.clear();\r\n    filterState.priorities.clear();\r\n    filterState.projects.clear();\r\n    filterState.tags.clear();\r\n    filterState.dateFrom = '';\r\n    filterState.dateTo = '';\r\n    filterState.search = '';\r\n    const searchEl = document.getElementById('filter-search');\r\n    if (searchEl) searchEl.value = '';\r\n    \r\n    // Set the filters we want\r\n    filterState.statuses.add(status);\r\n    filterState.projects.add(projectId.toString());\r\n    \r\n    // Update UI\r\n    document.querySelectorAll('input[type=\"checkbox\"]').forEach(cb => cb.checked = false);\r\n    document.querySelectorAll(`input[data-filter=\"status\"][value=\"${status}\"]`).forEach(cb => cb.checked = true);\r\n    document.querySelectorAll(`input[data-filter=\"project\"][value=\"${projectId}\"]`).forEach(cb => cb.checked = true);\r\n    \r\n    // Show list view\r\n    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));\r\n    const listBtn = document.querySelector('.view-btn:nth-child(2)');\r\n    if (listBtn) listBtn.classList.add('active');\r\n    \r\n    const kanban = document.querySelector('.kanban-board');\r\n    const list = document.getElementById('list-view');\r\n    if (kanban) kanban.classList.add('hidden');\r\n    if (list) list.classList.add('active');\r\n    \r\n    // Update display\r\n    updateFilterBadges();\r\n    renderListView();\r\n}\r\n\r\nwindow.filterProjectTasks = filterProjectTasks;\r\n\r\nfunction navigateToProjectStatus(projectId, status) {\r\n    // Use existing dashboard function and add project filter\r\n    navigateToFilteredTasks('status', status);\r\n    \r\n    // Add project filter after the status filter is applied\r\n    setTimeout(() => {\r\n        // Ensure view toggle is visible\r\n        const viewToggle = document.querySelector('.view-toggle');\r\n        if (viewToggle) viewToggle.classList.remove('hidden');\r\n        \r\n        filterState.projects.add(projectId.toString());\r\n        const projectCheckbox = document.querySelector(`input[data-filter=\"project\"][value=\"${projectId}\"]`);\r\n        if (projectCheckbox) projectCheckbox.checked = true;\r\n        updateFilterBadges();\r\n        renderTasks(); // Re-render with both filters\r\n    }, 200);\r\n}\r\n\r\nwindow.navigateToProjectStatus = navigateToProjectStatus;\r\n\r\nfunction navigateToAllTasks() {\r\n    // Navigate to tasks page\r\n    window.location.hash = 'tasks';\r\n    \r\n    // Clear all nav highlights and set tasks as active\r\n    document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));\r\n    const tasksNavItem = document.querySelector('.nav-item[data-page=\"tasks\"]');\r\n    if (tasksNavItem) tasksNavItem.classList.add('active');\r\n    \r\n    // Show tasks page\r\n    showPage('tasks');\r\n    \r\n    // Switch to list view\r\n    document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));\r\n    const listViewBtn = document.querySelector('.view-btn[onclick*=\"list\"], .view-btn:nth-child(2)');\r\n    if (listViewBtn) listViewBtn.classList.add('active');\r\n    \r\n    // Hide kanban and calendar, show list view\r\n    const kanbanBoard = document.querySelector('.kanban-board');\r\n    const listView = document.getElementById('list-view');\r\n    const calendarView = document.getElementById('calendar-view');\r\n    \r\n    if (kanbanBoard) kanbanBoard.classList.add('hidden');\r\n    if (calendarView) calendarView.classList.remove('active');\r\n    if (listView) listView.classList.add('active');\r\n    \r\n    // Clear any existing filters to show all tasks\r\n    clearAllFilters();\r\n    \r\n    // Render the list view\r\n    setTimeout(() => {\r\n        renderListView();\r\n    }, 100);\r\n}\r\n\r\nfunction filterProjectPortalList(query) {\r\n    const container = projectPortalEl && projectPortalEl.querySelector('.project-portal-options');\r\n    if (!container) return;\r\n    const hiddenProject = document.getElementById('hidden-project');\r\n    const selectedId = hiddenProject ? (hiddenProject.value || '') : '';\r\n    const q = (query || '').toLowerCase();\r\n    let items = '';\r\n    if (selectedId) {\r\n        items += `<div class=\"project-option\" data-project-id=\"\">${t('tasks.project.selectPlaceholder')}</div>`;\r\n    }\r\n    items += projects\r\n        .slice()\r\n        .sort((a, b) => (a.name || '').localeCompare(b.name || '', undefined, { sensitivity: 'base' }))\r\n        .filter(p => selectedId === '' || String(p.id) !== String(selectedId))\r\n        .filter(p => !q || (p.name || '').toLowerCase().includes(q))\r\n        .map(p => `<div class=\"project-option\" data-project-id=\"${p.id}\">${p.name}</div>`)\r\n        .join('');\r\n    container.innerHTML = items;\r\n}\r\n\r\n// Toggle visibility of the \"No Date\" option depending on tasks data\r\nfunction updateNoDateOptionVisibility() {\r\n    const sel = document.getElementById('filter-date-global');\r\n    if (!sel) return;\r\n    const noDateOpt = Array.from(sel.options).find(o => o.value === 'no-date');\r\n    if (!noDateOpt) return;\r\n    const hasNoDateTasks = tasks.some(t => !t.endDate);\r\n    noDateOpt.style.display = hasNoDateTasks ? '' : 'none';\r\n    // If user had selected 'no-date' but it's not applicable anymore, clear it\r\n    // updateNoDateOptionVisibility function no longer needed with new date range filter\r\n}\r\n\r\n// Lightweight non-destructive sort for Projects view\r\n\r\n// Update project status filter badge\r\nfunction updateProjectStatusBadge() {\r\n    const badge = document.getElementById('badge-project-status');\r\n    if (!badge) return;\r\n    const count = projectFilterState.statuses.size;\r\n    badge.textContent = count === 0 ? '' : count;\r\n\r\n    // Update button active state\r\n    const button = badge.closest('.filter-button');\r\n    if (button) {\r\n        if (count > 0) {\r\n            button.classList.add('active');\r\n        } else {\r\n            button.classList.remove('active');\r\n        }\r\n    }\r\n}\r\n\r\nfunction updateProjectTagsBadge() {\r\n    const badge = document.getElementById('badge-project-tags');\r\n    if (!badge) return;\r\n    const count = projectFilterState.tags.size;\r\n    badge.textContent = count === 0 ? '' : count;\r\n\r\n    // Update button active state\r\n    const button = badge.closest('.filter-button');\r\n    if (button) {\r\n        if (count > 0) {\r\n            button.classList.add('active');\r\n        } else {\r\n            button.classList.remove('active');\r\n        }\r\n    }\r\n}\r\n\r\nfunction populateProjectTagOptions() {\r\n    const tagUl = document.getElementById(\"project-tags-options\");\r\n    if (!tagUl) return;\r\n\r\n    // Preserve previously selected tags from state\r\n    const currentlySelected = new Set(projectFilterState.tags);\r\n\r\n    // Collect all unique tags from all projects\r\n    const allTags = new Set();\r\n    projects.forEach(p => {\r\n        if (p.tags && p.tags.length > 0) {\r\n            p.tags.forEach(tag => allTags.add(tag));\r\n        }\r\n    });\r\n\r\n    tagUl.innerHTML = \"\";\r\n\r\n    if (allTags.size === 0) {\r\n        const li = document.createElement(\"li\");\r\n        li.textContent = t('filters.noOtherTags');\r\n        li.style.color = \"var(--text-muted)\";\r\n        li.style.padding = \"8px 12px\";\r\n        tagUl.appendChild(li);\r\n    } else {\r\n        Array.from(allTags).sort().forEach((tag) => {\r\n            const li = document.createElement(\"li\");\r\n            const id = `project-tag-${tag}`;\r\n            const checked = currentlySelected.has(tag) ? 'checked' : '';\r\n            li.innerHTML = `<label><input type=\"checkbox\" id=\"${id}\" value=\"${tag}\" data-filter=\"project-tags\" ${checked}> ${tag.toUpperCase()}</label>`;\r\n            tagUl.appendChild(li);\r\n        });\r\n    }\r\n\r\n    // Re-attach event listeners for new checkboxes\r\n    tagUl.querySelectorAll('input[type=\"checkbox\"]').forEach(cb => {\r\n        cb.addEventListener(\"change\", () => {\r\n            if (cb.checked) {\r\n                projectFilterState.tags.add(cb.value);\r\n            } else {\r\n                projectFilterState.tags.delete(cb.value);\r\n            }\r\n            updateProjectTagsBadge();\r\n            applyProjectFilters();\r\n        });\r\n    });\r\n}\r\n\r\nfunction getProjectUpdatedFilterLabel(value) {\r\n    switch (value) {\r\n        case '5m': return '5m';\r\n        case '30m': return '30m';\r\n        case '24h': return '24h';\r\n        case 'week': return t('filters.updated.week');\r\n        case 'month': return t('filters.updated.month');\r\n        case 'all':\r\n        default:\r\n            return '';\r\n    }\r\n}\r\n\r\nfunction getProjectsUpdatedCutoffTime(value) {\r\n    const now = Date.now();\r\n    switch (value) {\r\n        case '5m': return now - 5 * 60 * 1000;\r\n        case '30m': return now - 30 * 60 * 1000;\r\n        case '24h': return now - 24 * 60 * 60 * 1000;\r\n        case 'week': return now - 7 * 24 * 60 * 60 * 1000;\r\n        case 'month': return now - 30 * 24 * 60 * 60 * 1000;\r\n        case 'all':\r\n        default:\r\n            return null;\r\n    }\r\n}\r\n\r\nfunction getProjectUpdatedTime(project) {\r\n    const raw = (project && (project.updatedAt || project.createdAt)) || \"\";\r\n    const time = new Date(raw).getTime();\r\n    return Number.isFinite(time) ? time : 0;\r\n}\r\n\r\nfunction updateProjectsUpdatedFilterUI() {\r\n    const badge = document.getElementById('badge-project-updated');\r\n    if (badge) {\r\n        badge.textContent = getProjectUpdatedFilterLabel(projectFilterState.updatedFilter);\r\n\r\n        // Update button active state\r\n        const button = badge.closest('.filter-button');\r\n        if (button) {\r\n            if (projectFilterState.updatedFilter !== 'all') {\r\n                button.classList.add('active');\r\n            } else {\r\n                button.classList.remove('active');\r\n            }\r\n        }\r\n    }\r\n    try {\r\n        document\r\n            .querySelectorAll('input[type=\"radio\"][data-filter=\"project-updated\"][name=\"project-updated-filter\"]')\r\n            .forEach((rb) => {\r\n                rb.checked = rb.value === projectFilterState.updatedFilter;\r\n            });\r\n    } catch (e) {}\r\n}\r\n\r\nfunction renderProjectsActiveFilterChips() {\r\n    const wrap = document.getElementById('projects-active-filters');\r\n    if (!wrap) return;\r\n    wrap.innerHTML = '';\r\n\r\n    const addChip = (label, value, onRemove) => {\r\n        const chip = document.createElement('span');\r\n        chip.className = 'filter-chip';\r\n        const text = document.createElement('span');\r\n        text.className = 'chip-text';\r\n        text.textContent = value != null && value !== '' ? `${label}: ${value}` : label;\r\n\r\n        const btn = document.createElement('button');\r\n        btn.type = 'button';\r\n        btn.className = 'chip-remove';\r\n        btn.setAttribute('aria-label', t('filters.chip.removeAria', { label }));\r\n        btn.textContent = 'x';\r\n        btn.addEventListener('click', onRemove);\r\n\r\n        chip.appendChild(text);\r\n        chip.appendChild(btn);\r\n        wrap.appendChild(chip);\r\n    };\r\n\r\n    // Search chip\r\n    if (projectFilterState.search) {\r\n        addChip(t('filters.chip.search'), projectFilterState.search, () => {\r\n            projectFilterState.search = '';\r\n            const el = document.getElementById('projects-search');\r\n            if (el) el.value = '';\r\n            const cur = loadProjectsViewState() || {};\r\n            saveProjectsViewState({ ...cur, search: '' });\r\n            applyProjectFilters();\r\n        });\r\n    }\r\n\r\n    // Status chips\r\n    projectFilterState.statuses.forEach((v) => {\r\n        addChip(t('projects.filters.status'), getProjectStatusLabel(v), () => {\r\n            projectFilterState.statuses.delete(v);\r\n            const cb = document.querySelector(`input[type=\"checkbox\"][data-filter=\"project-status\"][value=\"${v}\"]`);\r\n            if (cb) cb.checked = false;\r\n            updateProjectStatusBadge();\r\n            applyProjectFilters();\r\n        });\r\n    });\r\n\r\n    // Updated chip\r\n    if (projectFilterState.updatedFilter && projectFilterState.updatedFilter !== 'all') {\r\n        addChip(t('filters.chip.updated'), getProjectUpdatedFilterLabel(projectFilterState.updatedFilter), () => {\r\n            projectFilterState.updatedFilter = 'all';\r\n            updateProjectsUpdatedFilterUI();\r\n            const cur = loadProjectsViewState() || {};\r\n            saveProjectsViewState({ ...cur, updatedFilter: 'all' });\r\n            applyProjectFilters();\r\n        });\r\n    }\r\n\r\n    // Task filter chip\r\n    if (projectFilterState.taskFilter === 'has-tasks' || projectFilterState.taskFilter === 'no-tasks') {\r\n        const label = projectFilterState.taskFilter === 'has-tasks'\r\n            ? t('projects.filters.hasTasks')\r\n            : t('projects.filters.noTasks');\r\n        addChip(label, '', () => {\r\n            projectFilterState.taskFilter = '';\r\n            document\r\n                .querySelectorAll('#projects .projects-filters .pf-chip')\r\n                .forEach((c) => c.classList.remove('active'));\r\n            const cur = loadProjectsViewState() || {};\r\n            saveProjectsViewState({ ...cur, filter: '' });\r\n            applyProjectFilters();\r\n        });\r\n    }\r\n\r\n    // Tags chips\r\n    projectFilterState.tags.forEach((tag) => {\r\n        addChip(t('projects.filters.tags'), tag.toUpperCase(), () => {\r\n            projectFilterState.tags.delete(tag);\r\n            const cb = document.querySelector(`input[type=\"checkbox\"][data-filter=\"project-tags\"][value=\"${tag}\"]`);\r\n            if (cb) cb.checked = false;\r\n            updateProjectTagsBadge();\r\n            applyProjectFilters();\r\n        });\r\n    });\r\n}\r\n\r\n// Apply all project filters\r\nfunction applyProjectFilters() {\r\n    const filterTimer = debugTimeStart(\"filters\", \"projects\", {\r\n        totalProjects: projects.length,\r\n        statusCount: projectFilterState.statuses.size,\r\n        tagCount: projectFilterState.tags.size,\r\n        taskFilter: projectFilterState.taskFilter || \"\",\r\n        updatedFilter: projectFilterState.updatedFilter || \"all\",\r\n        hasSearch: !!projectFilterState.search\r\n    });\r\n    let filtered = projects.slice();\r\n\r\n    // Apply status filter\r\n    if (projectFilterState.statuses.size > 0) {\r\n        filtered = filtered.filter(p => {\r\n            const status = getProjectStatus(p.id);\r\n            return projectFilterState.statuses.has(status);\r\n        });\r\n    }\r\n\r\n    // Apply task filter\r\n    if (projectFilterState.taskFilter === 'has-tasks') {\r\n        filtered = filtered.filter(p => tasks.some(t => t.projectId === p.id));\r\n    } else if (projectFilterState.taskFilter === 'no-tasks') {\r\n        filtered = filtered.filter(p => !tasks.some(t => t.projectId === p.id));\r\n    }\r\n\r\n    // Apply tags filter\r\n    if (projectFilterState.tags.size > 0) {\r\n        filtered = filtered.filter(p => {\r\n            if (!p.tags || p.tags.length === 0) return false;\r\n            return Array.from(projectFilterState.tags).some(tag => p.tags.includes(tag));\r\n        });\r\n    }\r\n\r\n    // Apply updated recency filter\r\n    if (projectFilterState.updatedFilter && projectFilterState.updatedFilter !== 'all') {\r\n        const cutoff = getProjectsUpdatedCutoffTime(projectFilterState.updatedFilter);\r\n        if (cutoff != null) {\r\n            filtered = filtered.filter(p => getProjectUpdatedTime(p) >= cutoff);\r\n        }\r\n    }\r\n\r\n    // Apply search filter\r\n    if (projectFilterState.search) {\r\n        const q = projectFilterState.search.toLowerCase();\r\n        filtered = filtered.filter(p => ((p.name || '') + ' ' + (p.description || '')).toLowerCase().includes(q));\r\n    }\r\n\r\n    // Apply current sort if any\r\n    const saved = loadProjectsViewState() || { search: '', filter: '', sort: 'default', sortDirection: 'asc', updatedFilter: 'all' };\r\n    if (saved.sort && saved.sort !== 'default') {\r\n        applyProjectsSort(saved.sort, filtered);\r\n    } else {\r\n        // Default sort by status\r\n        applyProjectsSort('default', filtered);\r\n    }\r\n\r\n    updateProjectsClearButtonVisibility();\r\n    try { renderProjectsActiveFilterChips(); } catch (e) {}\r\n    debugTimeEnd(\"filters\", filterTimer, {\r\n        totalProjects: projects.length,\r\n        filteredCount: filtered.length\r\n    });\r\n}\r\n\r\n/**\r\n * applyProjectsSort(value, base)\r\n * value: sort key (same as before)\r\n * base: optional array of projects to sort (e.g., filtered view). If omitted, use full projects array.\r\n */\r\nfunction applyProjectsSort(value, base) {\r\n    // Use provided base or full projects, but do not mutate original arrays\r\n    const view = (base && Array.isArray(base) ? base.slice() : projects.slice());\r\n    const direction = projectSortState.direction;\r\n    const isDesc = direction === 'desc';\r\n    const normalizedValue = (value === 'name-asc' || value === 'name-desc') ? 'name' : value;\r\n\r\n    if (!normalizedValue || normalizedValue === 'default') {\r\n        // Sort by status: active, planning, completed (or reversed)\r\n        const statusOrder = { 'active': 0, 'planning': 1, 'backlog': 2, 'completed': 3 };\r\n        view.sort((a, b) => {\r\n            const statusA = getProjectStatus(a.id);\r\n            const statusB = getProjectStatus(b.id);\r\n            const result = (statusOrder[statusA] || 999) - (statusOrder[statusB] || 999);\r\n            return isDesc ? -result : result;\r\n        });\r\n        appState.projectsSortedView = view;\r\n        renderView(view);\r\n        return;\r\n    }\r\n\r\n    if (normalizedValue === 'name') {\r\n        view.sort((a,b) => {\r\n            const result = (a.name||'').localeCompare(b.name||'');\r\n            return isDesc ? -result : result;\r\n        });\r\n    } else if (normalizedValue === 'created-desc') {\r\n        view.sort((a,b) => {\r\n            const result = new Date(b.createdAt) - new Date(a.createdAt);\r\n            return isDesc ? -result : result;\r\n        });\r\n    } else if (normalizedValue === 'updated-desc') {\r\n        view.sort((a,b) => {\r\n            const aDate = new Date(a.updatedAt || a.createdAt);\r\n            const bDate = new Date(b.updatedAt || b.createdAt);\r\n            const result = bDate - aDate;\r\n            return isDesc ? -result : result;\r\n        });\r\n    } else if (normalizedValue === 'tasks-desc') {\r\n        view.sort((a,b) => {\r\n            const result = (tasks.filter(t=>t.projectId===b.id).length) - (tasks.filter(t=>t.projectId===a.id).length);\r\n            return isDesc ? -result : result;\r\n        });\r\n    } else if (normalizedValue === 'completion-desc') {\r\n        // Sort by completion percentage\r\n        view.sort((a,b) => {\r\n            const aTotal = tasks.filter(t => t.projectId === a.id).length;\r\n            const aDone = tasks.filter(t => t.projectId === a.id && t.status === 'done').length;\r\n            const aPercent = aTotal > 0 ? (aDone / aTotal) * 100 : 0;\r\n\r\n            const bTotal = tasks.filter(t => t.projectId === b.id).length;\r\n            const bDone = tasks.filter(t => t.projectId === b.id && t.status === 'done').length;\r\n            const bPercent = bTotal > 0 ? (bDone / bTotal) * 100 : 0;\r\n\r\n            const result = bPercent - aPercent;\r\n            return isDesc ? -result : result;\r\n        });\r\n    }\r\n\r\n    appState.projectsSortedView = view;\r\n    // Render the view without changing the source\r\n    const container = document.getElementById('projects-list');\r\n    if (!container) return;\r\n\r\n    // Save expanded state before re-rendering\r\n    const expandedProjects = new Set();\r\n    container.querySelectorAll('.project-list-item.expanded').forEach(item => {\r\n        const projectId = item.id.replace('project-item-', '');\r\n        expandedProjects.add(projectId);\r\n    });\r\n\r\n    // Re-render\r\n    container.innerHTML = appState.projectsSortedView.map(generateProjectItemHTML).join('');\r\n\r\n    // Restore expanded state\r\n    expandedProjects.forEach(projectId => {\r\n        const item = document.getElementById(`project-item-${projectId}`);\r\n        if (item) {\r\n            item.classList.add('expanded');\r\n        }\r\n    });\r\n\r\n    renderMobileProjects(appState.projectsSortedView);\r\n    scheduleExpandedTaskRowLayoutUpdate(container);\r\n}\r\n\r\nfunction getProjectSortLabel(sortKey) {\r\n    const map = {\r\n        'default': t('projects.sort.statusLabel'),\r\n        'name': t('projects.sort.nameLabel'),\r\n        'name-asc': t('projects.sort.nameLabel'),\r\n        'name-desc': t('projects.sort.nameLabel'),\r\n        'created-desc': t('projects.sort.newestLabel'),\r\n        'updated-desc': t('projects.sort.lastUpdatedLabel'),\r\n        'tasks-desc': t('projects.sort.mostTasksLabel'),\r\n        'completion-desc': t('projects.sort.percentCompletedLabel')\r\n    };\r\n    return map[sortKey] || sortKey;\r\n}\r\n\r\nfunction refreshProjectsSortLabel() {\r\n    const sortLabel = document.getElementById('projects-sort-label');\r\n    if (!sortLabel) return;\r\n    const sortKey = projectSortState?.lastSort || 'default';\r\n    const baseLabel = getProjectSortLabel(sortKey);\r\n    const directionIndicator = projectSortState?.direction === 'asc' ? 'asc' : 'desc';\r\n    sortLabel.textContent = t('projects.sort.prefix', { label: baseLabel, direction: directionIndicator });\r\n    const arrow = document.querySelector('#projects-sort-btn .sort-label-arrow');\r\n    if (arrow) setProjectsSortArrow(arrow, directionIndicator);\r\n    try { updateProjectsSortOptionsUI(); } catch (e) {}\r\n}\r\n\r\nfunction setProjectsSortArrow(el, direction) {\r\n    if (!el) return;\r\n    el.classList.toggle('is-up', direction === 'asc');\r\n    el.classList.toggle('is-down', direction !== 'asc');\r\n    el.innerHTML = '<svg viewBox=\"0 0 24 24\" aria-hidden=\"true\"><path d=\"M12 20 L6 14 H10 V4 H14 V14 H18 Z\" fill=\"currentColor\"/></svg>';\r\n}\r\n\r\nfunction applyProjectsSortSelection(sortKey, { toggleDirection = false } = {}) {\r\n    const nextSortKey = sortKey || 'default';\r\n    const sameSort = projectSortState.lastSort === nextSortKey;\r\n    if (toggleDirection || sameSort) {\r\n        projectSortState.direction = projectSortState.direction === 'asc' ? 'desc' : 'asc';\r\n    } else {\r\n        projectSortState.direction = 'asc';\r\n    }\r\n    projectSortState.lastSort = nextSortKey;\r\n    refreshProjectsSortLabel();\r\n    try { updateProjectsSortOptionsUI(); } catch (e) {}\r\n\r\n    const saved = loadProjectsViewState() || { search: '', filter: '', sort: 'default' };\r\n    saveProjectsViewState({ ...saved, sort: nextSortKey, sortDirection: projectSortState.direction });\r\n    applyProjectFilters();\r\n}\r\n\r\nfunction updateProjectsSortOptionsUI() {\r\n    const panel = document.getElementById('projects-sort-panel');\r\n    if (!panel) return;\r\n    const current = projectSortState?.lastSort || 'default';\r\n    const directionIndicator = projectSortState?.direction === 'asc' ? 'asc' : 'desc';\r\n    panel.querySelectorAll('.projects-sort-option').forEach(opt => {\r\n        const isActive = opt.dataset.sort === current;\r\n        opt.classList.toggle('is-active', isActive);\r\n        let indicator = opt.querySelector('.sort-option-indicator');\r\n        if (!indicator) {\r\n            indicator = document.createElement('button');\r\n            indicator.type = 'button';\r\n            indicator.className = 'sort-option-indicator';\r\n            indicator.setAttribute('aria-label', t('projects.sort.help'));\r\n            opt.appendChild(indicator);\r\n        }\r\n        if (isActive) {\r\n            setProjectsSortArrow(indicator, directionIndicator);\r\n        }\r\n        indicator.style.visibility = isActive ? 'visible' : 'hidden';\r\n    });\r\n}\r\n// Hook up the select after DOM ready\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    // Sort button + panel handlers\r\n    const sortBtn = document.getElementById('projects-sort-btn');\r\n    const sortPanel = document.getElementById('projects-sort-panel');\r\n    const sortLabel = document.getElementById('projects-sort-label');\r\n    if (sortBtn && sortPanel) {\r\n        sortBtn.addEventListener('click', (e) => {\r\n            if (e.target.closest('.sort-label-arrow')) {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                applyProjectsSortSelection(projectSortState?.lastSort || 'default', { toggleDirection: true });\r\n                return;\r\n            }\r\n            const open = sortBtn.getAttribute('aria-expanded') === 'true';\r\n            const willOpen = !open;\r\n            sortBtn.setAttribute('aria-expanded', String(willOpen));\r\n            if (willOpen) {\r\n                sortPanel.setAttribute('aria-hidden', 'false');\r\n                sortPanel.removeAttribute('inert');\r\n            } else {\r\n                if (sortPanel.contains(document.activeElement)) {\r\n                    sortBtn.focus();\r\n                }\r\n                sortPanel.setAttribute('aria-hidden', 'true');\r\n                sortPanel.setAttribute('inert', '');\r\n            }\r\n            try { updateProjectsSortOptionsUI(); } catch (e) {}\r\n            e.stopPropagation();\r\n        });\r\n        // Clicking an option\r\n        // If there are duplicate panels (from previous DOM states), select carefully\r\n        const panel = document.getElementById('projects-sort-panel');\r\n        if (!panel) return;\r\n        panel.querySelectorAll('.projects-sort-option').forEach(opt => {\r\n            opt.addEventListener('click', (ev) => {\r\n                const sortKey = opt.dataset.sort || 'default';\r\n                const clickedIndicator = ev.target && ev.target.classList && ev.target.classList.contains('sort-option-indicator');\r\n                applyProjectsSortSelection(sortKey, { toggleDirection: clickedIndicator || projectSortState.lastSort === sortKey });\r\n\r\n                if (!clickedIndicator) {\r\n                    sortBtn.setAttribute('aria-expanded', 'false');\r\n                    if (sortPanel.contains(document.activeElement)) {\r\n                        sortBtn.focus();\r\n                    }\r\n                    sortPanel.setAttribute('aria-hidden', 'true');\r\n                    sortPanel.setAttribute('inert', '');\r\n                } else {\r\n                    sortPanel.removeAttribute('inert');\r\n                    ev.stopPropagation();\r\n                }\r\n            });\r\n        });\r\n\r\n        // Close panel on outside click\r\n        document.addEventListener('click', () => {\r\n            sortBtn.setAttribute('aria-expanded', 'false');\r\n            if (sortPanel.contains(document.activeElement)) {\r\n                sortBtn.focus();\r\n            }\r\n            sortPanel.setAttribute('aria-hidden', 'true');\r\n            sortPanel.setAttribute('inert', '');\r\n        });\r\n    }\r\n\r\n    // Project status filter (open/close handled by setupFilterEventListeners)\r\n    const statusFilterGroup = document.getElementById('group-project-status');\r\n    if (statusFilterGroup) {\r\n        const checkboxes = statusFilterGroup.querySelectorAll('input[type=\"checkbox\"][data-filter=\"project-status\"]');\r\n        checkboxes.forEach(cb => {\r\n            cb.addEventListener('change', () => {\r\n                if (cb.checked) projectFilterState.statuses.add(cb.value);\r\n                else projectFilterState.statuses.delete(cb.value);\r\n                updateProjectStatusBadge();\r\n                applyProjectFilters();\r\n                // Sync URL with new status filter\r\n                syncURLWithProjectFilters();\r\n            });\r\n        });\r\n    }\r\n\r\n    // Projects search\r\n    const search = document.getElementById('projects-search');\r\n    if (search) {\r\n        search.addEventListener('input', debounce((e) => {\r\n            projectFilterState.search = (e.target.value || '').trim();\r\n            applyProjectFilters();\r\n            const cur = loadProjectsViewState() || {};\r\n            saveProjectsViewState({ ...cur, search: e.target.value });\r\n        }, 220));\r\n    }\r\n\r\n    // Task filter chips (has-tasks, no-tasks)\r\n    const chips = Array.from(document.querySelectorAll('.pf-chip'));\r\n    chips.forEach(chip => {\r\n        chip.addEventListener('click', () => {\r\n            const v = chip.dataset.filter;\r\n\r\n            // Toggle chip\r\n            if (chip.classList.contains('active')) {\r\n                chip.classList.remove('active');\r\n                projectFilterState.taskFilter = '';\r\n            } else {\r\n                chips.forEach(c => c.classList.remove('active'));\r\n                chip.classList.add('active');\r\n                projectFilterState.taskFilter = v;\r\n            }\r\n\r\n            applyProjectFilters();\r\n            const cur = loadProjectsViewState() || {};\r\n            saveProjectsViewState({ ...cur, filter: projectFilterState.taskFilter || '' });\r\n        });\r\n    });\r\n\r\n    // Clear filters button\r\n    const clearBtn = document.getElementById('btn-clear-projects');\r\n    if (clearBtn) {\r\n        clearBtn.addEventListener('click', clearProjectFilters);\r\n    }\r\n\r\n    // Ensure visibility is synced at start\r\n    updateProjectsClearButtonVisibility();\r\n});\r\n\r\n// Expose clearProjectFilters to window for potential external use\r\nwindow.clearProjectFilters = clearProjectFilters;\r\n\r\n// Sync current project filter state to URL for shareable links and browser history\r\nfunction syncURLWithProjectFilters() {\r\n    const params = new URLSearchParams();\r\n    const state = loadProjectsViewState() || {};\r\n\r\n    // Add search query (from projectFilterState for real-time updates)\r\n    const searchValue = projectFilterState.search || state.search;\r\n    if (searchValue && searchValue.trim() !== \"\") {\r\n        params.set(\"search\", searchValue.trim());\r\n    }\r\n\r\n    // Add status filter (from projectFilterState - comma-separated)\r\n    if (projectFilterState.statuses.size > 0) {\r\n        params.set(\"status\", Array.from(projectFilterState.statuses).join(\",\"));\r\n    }\r\n\r\n    // Add chip filter (has-tasks or no-tasks)\r\n    const chipFilter = projectFilterState.taskFilter || state.filter;\r\n    if (chipFilter && ['has-tasks', 'no-tasks'].includes(chipFilter)) {\r\n        params.set(\"filter\", chipFilter);\r\n    }\r\n\r\n    // Add sort\r\n    if (state.sort && state.sort !== 'default') {\r\n        params.set(\"sort\", state.sort);\r\n    }\r\n\r\n    // Add sort direction (only if not default)\r\n    if (state.sortDirection && state.sortDirection !== 'asc') {\r\n        params.set(\"sortDirection\", state.sortDirection);\r\n    }\r\n\r\n    // Add updated filter (from projectFilterState for real-time updates)\r\n    const updatedFilter = projectFilterState.updatedFilter || state.updatedFilter;\r\n    if (updatedFilter && updatedFilter !== 'all') {\r\n        params.set(\"updatedFilter\", updatedFilter);\r\n    }\r\n\r\n    // Build new URL\r\n    const queryString = params.toString();\r\n    const newHash = queryString ? `#projects?${queryString}` : \"#projects\";\r\n\r\n    // Update URL without triggering hashchange event (prevents infinite loop)\r\n    if (window.location.hash !== newHash) {\r\n        window.history.replaceState(null, \"\", newHash);\r\n    }\r\n}\r\n\r\nfunction saveProjectsViewState(state) {\r\n    try {\r\n        localStorage.setItem('projectsViewState', JSON.stringify(state));\r\n        // Sync URL with the new state\r\n        syncURLWithProjectFilters();\r\n    } catch (e) {}\r\n}\r\n\r\nfunction loadProjectsViewState() {\r\n    try {\r\n        const raw = localStorage.getItem('projectsViewState');\r\n        if (!raw) return null;\r\n        const parsed = JSON.parse(raw);\r\n        if (!parsed || typeof parsed !== 'object') return null;\r\n\r\n        // Normalize legacy/invalid values so UI doesn't show \"Clear Filters\" when nothing is applied.\r\n        // `filter: \"clear\"` used to be treated as a sentinel; treat it as \"no filter\".\r\n        if (parsed.filter === 'clear') parsed.filter = '';\r\n        if (parsed.filter && parsed.filter !== 'has-tasks' && parsed.filter !== 'no-tasks') parsed.filter = '';\r\n        if (parsed.updatedFilter == null) parsed.updatedFilter = 'all';\r\n        if (parsed.updatedFilter && typeof parsed.updatedFilter === 'string') {\r\n            const allowed = new Set(['all', '5m', '30m', '24h', 'week', 'month']);\r\n            if (!allowed.has(parsed.updatedFilter)) parsed.updatedFilter = 'all';\r\n        }\r\n\r\n        return parsed;\r\n    } catch (e) { return null; }\r\n}\r\n\r\n\r\n// Helper: render a view array of projects (used by search/chips)\r\nfunction renderView(view) {\r\n    const container = document.getElementById('projects-list');\r\n    if (!container) return;\r\n    if (!view || view.length === 0) {\r\n        container.innerHTML = `<div class=\"empty-state\"><h3>${t('projects.empty.filteredTitle')}</h3></div>`;\r\n        renderMobileProjects([]);\r\n        return;\r\n    }\r\n\r\n    // Save expanded state before re-rendering\r\n    const expandedProjects = new Set();\r\n    container.querySelectorAll('.project-list-item.expanded').forEach(item => {\r\n        const projectId = item.id.replace('project-item-', '');\r\n        expandedProjects.add(projectId);\r\n    });\r\n\r\n    // Re-render with new list layout\r\n    container.innerHTML = view.map(generateProjectItemHTML).join('');\r\n\r\n    // Restore expanded state\r\n    expandedProjects.forEach(projectId => {\r\n        const item = document.getElementById(`project-item-${projectId}`);\r\n        if (item) {\r\n            item.classList.add('expanded');\r\n        }\r\n    });\r\n\r\n    renderMobileProjects(view);\r\n}\r\n\r\n// Initialize and persist project header controls\r\nfunction setupProjectsControls() {\r\n    const sel = document.getElementById('projects-sort');\r\n    const sortBtn = document.getElementById('projects-sort-btn');\r\n    const sortLabel = document.getElementById('projects-sort-label');\r\n    const search = document.getElementById('projects-search');\r\n    const chips = Array.from(document.querySelectorAll('.pf-chip'));\r\n\r\n    // Load saved state from localStorage\r\n    const saved = loadProjectsViewState() || { search: '', filter: '', sort: 'default', sortDirection: 'asc', updatedFilter: 'all' };\r\n\r\n    // Merge with URL parameters (URL params take priority for deep linking)\r\n    const urlFilters = window.urlProjectFilters || {};\r\n    const mergedState = {\r\n        search: urlFilters.search !== undefined ? urlFilters.search : saved.search,\r\n        filter: urlFilters.filter !== undefined ? urlFilters.filter : saved.filter,\r\n        sort: urlFilters.sort !== undefined ? urlFilters.sort : saved.sort,\r\n        sortDirection: urlFilters.sortDirection !== undefined ? urlFilters.sortDirection : saved.sortDirection,\r\n        updatedFilter: urlFilters.updatedFilter !== undefined ? urlFilters.updatedFilter : saved.updatedFilter\r\n    };\r\n\r\n    // Sanitize merged task filter value (prevents phantom \"Clear Filters\" on refresh)\r\n    if (mergedState.filter === 'clear') mergedState.filter = '';\r\n    if (mergedState.filter && mergedState.filter !== 'has-tasks' && mergedState.filter !== 'no-tasks') {\r\n        mergedState.filter = '';\r\n    }\r\n\r\n    // Apply status filters from URL (if present)\r\n    if (urlFilters.statuses && Array.isArray(urlFilters.statuses) && urlFilters.statuses.length > 0) {\r\n        projectFilterState.statuses.clear();\r\n        urlFilters.statuses.forEach(status => projectFilterState.statuses.add(status));\r\n\r\n        // Update checkbox UI\r\n        const statusCheckboxes = document.querySelectorAll('input[type=\"checkbox\"][data-filter=\"project-status\"]');\r\n        statusCheckboxes.forEach(cb => {\r\n            cb.checked = projectFilterState.statuses.has(cb.value);\r\n        });\r\n        updateProjectStatusBadge();\r\n    }\r\n\r\n    // Apply search to projectFilterState\r\n    if (mergedState.search) {\r\n        projectFilterState.search = mergedState.search;\r\n    }\r\n\r\n    // Apply chip filter to projectFilterState\r\n    if (mergedState.filter) {\r\n        projectFilterState.taskFilter = mergedState.filter;\r\n    }\r\n\r\n    // Clear URL filters after reading them (one-time use for deep linking)\r\n    window.urlProjectFilters = null;\r\n\r\n    // Restore sort state (normalize legacy name sort keys)\r\n    let restoredSort = mergedState.sort || 'default';\r\n    let restoredDirection = mergedState.sortDirection || 'asc';\r\n    if (restoredSort === 'name-asc') {\r\n        restoredSort = 'name';\r\n        restoredDirection = 'asc';\r\n    } else if (restoredSort === 'name-desc') {\r\n        restoredSort = 'name';\r\n        restoredDirection = 'desc';\r\n    }\r\n    projectSortState.lastSort = restoredSort;\r\n    projectSortState.direction = restoredDirection;\r\n\r\n    // Apply merged search value to the input (don't render yet)\r\n    if (search) search.value = mergedState.search || '';\r\n\r\n    // Apply merged chip selection only if it maps to an existing chip (has-tasks or no-tasks only)\r\n    if (chips && chips.length) {\r\n        chips.forEach(c => c.classList.remove('active'));\r\n        if (mergedState.filter && ['has-tasks','no-tasks'].includes(mergedState.filter)) {\r\n            const activeChip = chips.find(c => c.dataset.filter === mergedState.filter);\r\n            if (activeChip) activeChip.classList.add('active');\r\n        }\r\n    }\r\n\r\n    // Prepare initial base according to filters, then apply merged sort and render\r\n    let initialBase = appState.projectsSortedView && appState.projectsSortedView.length ? appState.projectsSortedView.slice() : projects.slice();\r\n\r\n    // Filter by search\r\n    if (search && search.value && search.value.trim() !== '') {\r\n        const q = search.value.trim().toLowerCase();\r\n        initialBase = initialBase.filter(p => ((p.name || '') + ' ' + (p.description || '')).toLowerCase().includes(q));\r\n    }\r\n\r\n    // Filter by status (from projectFilterState.statuses)\r\n    if (projectFilterState.statuses.size > 0) {\r\n        initialBase = initialBase.filter(p => {\r\n            const status = getProjectStatus(p.id);\r\n            return projectFilterState.statuses.has(status);\r\n        });\r\n    }\r\n\r\n    // Filter by chip selection (has-tasks or no-tasks)\r\n    const chipFilter = mergedState.filter || projectFilterState.taskFilter;\r\n    if (chipFilter === 'has-tasks') {\r\n        initialBase = initialBase.filter(p => tasks.some(t => t.projectId === p.id));\r\n    } else if (chipFilter === 'no-tasks') {\r\n        initialBase = initialBase.filter(p => !tasks.some(t => t.projectId === p.id));\r\n    }\r\n\r\n    // Filter by updated recency (restored from localStorage/URL)\r\n    if (mergedState.updatedFilter && mergedState.updatedFilter !== 'all') {\r\n        const cutoff = getProjectsUpdatedCutoffTime(mergedState.updatedFilter);\r\n        if (cutoff != null) {\r\n            initialBase = initialBase.filter(p => getProjectUpdatedTime(p) >= cutoff);\r\n        }\r\n    }\r\n\r\n    // Apply merged sort label with direction indicator\r\n    if (sortBtn) {\r\n        const sortKey = mergedState.sort || 'default';\r\n        const baseLabel = getProjectSortLabel(sortKey);\r\n        const directionIndicator = projectSortState.direction === 'asc' ? 'asc' : 'desc';\r\n        const labelText = t('projects.sort.prefix', { label: baseLabel, direction: directionIndicator });\r\n        if (sortLabel) sortLabel.textContent = labelText;\r\n        const arrow = document.querySelector('#projects-sort-btn .sort-label-arrow');\r\n        if (arrow) setProjectsSortArrow(arrow, directionIndicator);\r\n    }\r\n\r\n    // Restore updated filter state + UI\r\n    {\r\n        const allowed = new Set(['all', '5m', '30m', '24h', 'week', 'month']);\r\n        const normalized = allowed.has(mergedState.updatedFilter) ? mergedState.updatedFilter : 'all';\r\n        projectFilterState.updatedFilter = normalized;\r\n        updateProjectsUpdatedFilterUI();\r\n        try { renderProjectsActiveFilterChips(); } catch (e) {}\r\n\r\n        document\r\n            .querySelectorAll('input[type=\"radio\"][data-filter=\"project-updated\"][name=\"project-updated-filter\"]')\r\n            .forEach((rb) => {\r\n                if (rb.__projectUpdatedBound) return;\r\n                rb.__projectUpdatedBound = true;\r\n                rb.addEventListener('change', () => {\r\n                    if (!rb.checked) return;\r\n                    projectFilterState.updatedFilter = allowed.has(rb.value) ? rb.value : 'all';\r\n                    updateProjectsUpdatedFilterUI();\r\n                    applyProjectFilters();\r\n                    const cur = loadProjectsViewState() || mergedState;\r\n                    saveProjectsViewState({ ...cur, updatedFilter: projectFilterState.updatedFilter });\r\n                    updateProjectsClearButtonVisibility();\r\n                });\r\n            });\r\n    }\r\n\r\n    // Finally apply saved sort to the initial base and render\r\n    const selSort = projectSortState.lastSort || 'default';\r\n    applyProjectsSort(selSort, initialBase);\r\n\r\n    // Event listeners are set up once in DOMContentLoaded - no need to add duplicates here\r\n\r\n    // Ensure visibility is synced after setup\r\n    updateProjectsClearButtonVisibility();\r\n}\r\n\r\n// Show/hide the Projects-specific Clear button when a projects filter/search is active\r\nfunction updateProjectsClearButtonVisibility() {\r\n    const btn = document.getElementById('btn-clear-projects');\r\n    if (!btn) return;\r\n    const hasSearch = projectFilterState.search && projectFilterState.search.trim() !== '';\r\n    const hasStatusFilter = projectFilterState.statuses.size > 0;\r\n    const hasTaskFilter = projectFilterState.taskFilter !== '';\r\n    const hasUpdatedFilter = projectFilterState.updatedFilter && projectFilterState.updatedFilter !== 'all';\r\n    const hasTagsFilter = projectFilterState.tags.size > 0;\r\n    const shouldShow = hasSearch || hasStatusFilter || hasTaskFilter || hasUpdatedFilter || hasTagsFilter;\r\n    btn.style.display = shouldShow ? 'inline-flex' : 'none';\r\n}\r\n\r\n// Clear all project filters\r\nfunction clearProjectFilters() {\r\n    projectFilterState.search = '';\r\n    projectFilterState.statuses.clear();\r\n    projectFilterState.taskFilter = '';\r\n    projectFilterState.updatedFilter = 'all';\r\n    projectFilterState.tags.clear();\r\n\r\n    // Clear UI\r\n    const searchEl = document.getElementById('projects-search');\r\n    if (searchEl) searchEl.value = '';\r\n\r\n    const chips = Array.from(document.querySelectorAll('.pf-chip'));\r\n    chips.forEach(c => c.classList.remove('active'));\r\n\r\n    const checkboxes = document.querySelectorAll('input[type=\"checkbox\"][data-filter=\"project-status\"]');\r\n    checkboxes.forEach(cb => cb.checked = false);\r\n\r\n    const tagCheckboxes = document.querySelectorAll('input[type=\"checkbox\"][data-filter=\"project-tags\"]');\r\n    tagCheckboxes.forEach(cb => cb.checked = false);\r\n\r\n    document\r\n        .querySelectorAll('input[type=\"radio\"][data-filter=\"project-updated\"][name=\"project-updated-filter\"]')\r\n        .forEach(rb => rb.checked = rb.value === 'all');\r\n    updateProjectsUpdatedFilterUI();\r\n\r\n    updateProjectStatusBadge();\r\n    updateProjectTagsBadge();\r\n    applyProjectFilters();\r\n}\r\n\r\n// Handle Enter-like behavior for checklist rows. This centralizes the logic so\r\n// both the Enter key and the toolbar button can perform the same action.\r\nfunction handleChecklistEnter(editor) {\r\n    if (!editor) return false;\r\n    const sel = window.getSelection();\r\n    if (!sel || !sel.rangeCount) return false;\r\n    const range = sel.getRangeAt(0);\r\n    const container = range.commonAncestorContainer;\r\n    const checkText = container.nodeType === 1 ? container.closest?.('.check-text') : container.parentElement?.closest?.('.check-text');\r\n    if (!checkText || !editor.contains(checkText)) return false;\r\n\r\n    // Prevent default action is the caller's responsibility; here we perform changes\r\n    const row = checkText.closest('.checkbox-row');\r\n    if (!row) return false;\r\n\r\n    // Compute text before/after caret inside the checkText\r\n    const beforeRange = range.cloneRange();\r\n    beforeRange.selectNodeContents(checkText);\r\n    beforeRange.setEnd(range.startContainer, range.startOffset);\r\n    const beforeText = beforeRange.toString();\r\n    const afterRange = range.cloneRange();\r\n    afterRange.selectNodeContents(checkText);\r\n    afterRange.setStart(range.endContainer, range.endOffset);\r\n    const afterText = afterRange.toString();\r\n\r\n    // If the checklist is completely empty -> replace with a paragraph\r\n    if (beforeText.length === 0 && afterText.length === 0) {\r\n        const p = document.createElement('div');\r\n        p.innerHTML = '<br>';\r\n        row.parentNode.replaceChild(p, row);\r\n        const r = document.createRange();\r\n        r.setStart(p, 0);\r\n        r.collapse(true);\r\n        sel.removeAllRanges();\r\n        sel.addRange(r);\r\n        editor.focus();\r\n        editor.dispatchEvent(new Event('input'));\r\n        return true;\r\n    }\r\n\r\n    // If caret is at the end of the text -> create a new checkbox row below\r\n    if (afterText.length === 0) {\r\n        const id2 = 'chk-' + Date.now() + '-' + Math.floor(Math.random() * 1000);\r\n        const wrapper = document.createElement('div');\r\n        wrapper.innerHTML = `<div class=\\\"checkbox-row\\\" data-id=\\\"${id2}\\\" contenteditable=\\\"false\\\"><button type=\\\"button\\\" class=\\\"checkbox-toggle variant-1\\\" aria-pressed=\\\"false\\\" title=\\\"${t('tasks.checklist.toggle')}\\\" contenteditable=\\\"false\\\"></button><div class=\\\"check-text\\\" contenteditable=\\\"true\\\"></div></div>`;\r\n        const newRow = wrapper.firstChild;\r\n        if (row && row.parentNode) {\r\n            row.parentNode.insertBefore(newRow, row.nextSibling);\r\n            const el = newRow.querySelector('.check-text');\r\n            const r = document.createRange();\r\n            r.selectNodeContents(el);\r\n            r.collapse(true);\r\n            sel.removeAllRanges();\r\n            sel.addRange(r);\r\n            el.focus();\r\n            editor.dispatchEvent(new Event('input'));\r\n        }\r\n        return true;\r\n    }\r\n\r\n    // Otherwise, insert an inline line-break inside the check-text\r\n    document.execCommand('insertHTML', false, '<br><br>');\r\n    editor.dispatchEvent(new Event('input'));\r\n    return true;\r\n}\r\n\r\n// ================================\r\n// MOBILE NAVIGATION\r\n// ================================\r\n\r\n// Initialize mobile navigation\r\nfunction initMobileNav() {\r\n    const hamburgerBtn = document.getElementById('hamburger-btn');\r\n    const sidebar = document.querySelector('.sidebar');\r\n    const overlay = document.getElementById('sidebar-overlay');\r\n\r\n    if (!hamburgerBtn || !sidebar || !overlay) return;\r\n\r\n    // Toggle sidebar\r\n    function toggleSidebar() {\r\n        sidebar.classList.toggle('active');\r\n        overlay.classList.toggle('active');\r\n        document.body.style.overflow = sidebar.classList.contains('active') ? 'hidden' : '';\r\n    }\r\n\r\n    // Close sidebar\r\n    function closeSidebar() {\r\n        sidebar.classList.remove('active');\r\n        overlay.classList.remove('active');\r\n        document.body.style.overflow = '';\r\n    }\r\n\r\n    // Hamburger button click\r\n    hamburgerBtn.addEventListener('click', toggleSidebar);\r\n\r\n    // Overlay click\r\n    overlay.addEventListener('click', closeSidebar);\r\n\r\n    // Close sidebar when clicking nav items\r\n    const navItems = sidebar.querySelectorAll('.nav-item');\r\n    navItems.forEach(item => {\r\n        item.addEventListener('click', () => {\r\n            if (getIsMobileCached()) {\r\n                closeSidebar();\r\n            }\r\n        });\r\n    });\r\n\r\n    // Close sidebar on window resize to desktop\r\n    window.addEventListener('resize', () => {\r\n        if (window.innerWidth > 768) {\r\n            closeSidebar();\r\n        }\r\n    });\r\n}\r\n\r\n// Initialize when DOM is ready\r\nif (document.readyState === 'loading') {\r\n    document.addEventListener('DOMContentLoaded', initMobileNav);\r\n} else {\r\n    initMobileNav();\r\n}\r\n\r\nwindow.addEventListener('resize', () => {\r\n    scheduleExpandedTaskRowLayoutUpdate();\r\n});\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n", "// Main entry point for Nautilus after modularization\r\n// Performance: Track module load time using earliest known page start\r\nconst NAV_START = (typeof window !== 'undefined' && typeof window.__pageLoadStart === 'number')\r\n    ? window.__pageLoadStart\r\n    : performance.now();\r\n\r\nimport { initializeEventDelegation } from '../app.js';\r\nimport { logPerformanceMilestone, isDebugLogsEnabled } from './utils/debug.js';\r\n\r\n// Log module loading complete (time until main.js executes)\r\nconst MAIN_JS_MODULES_LOADED = performance.now();\r\nif (isDebugLogsEnabled()) {\r\n    console.log(`[perf] main.js: executed after ${Math.round(MAIN_JS_MODULES_LOADED - NAV_START)}ms since nav start`);\r\n}\r\n\r\ninitializeEventDelegation();\r\nif (isDebugLogsEnabled()) {\r\n    logPerformanceMilestone('event-delegation-setup');\r\n}\r\n\r\ndocument.addEventListener('DOMContentLoaded', () => {\r\n    if (isDebugLogsEnabled()) {\r\n        logPerformanceMilestone('dom-content-loaded');\r\n    }\r\n    // Do NOT call init() here. Auth.js calls initializeApp (= init) when user is verified\r\n    // (completeLogin). Calling init on DOMContentLoaded caused a race: init started loading\r\n    // data, completeLogin awaited init but got early return (isInitialized), showed app\r\n    // before data loaded \u2192 user saw zeros then 1\u20133s later real data. Single init path only.\r\n});\r\n"],
  "mappings": "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",
  "names": ["projects", "tasks", "t", "a", "tasks", "projects", "feedbackItems", "projectColorMap", "sortMode", "manualTaskOrder", "items", "sortMode", "manualTaskOrder", "settings", "tasks", "taskCounter", "tempAttachments", "t", "settings", "projects", "projectCounter", "projects", "tasks", "t", "t", "t", "projects", "tasks", "filterState", "tasks", "projects", "t", "formatDate", "escapeHtml", "formatDate", "getProjectColor", "getTagColor", "getPriorityLabel", "projects", "selectedCards", "tasks", "sortMode", "manualTaskOrder", "getTaskUpdatedTime", "tasks", "projects", "getTaskUpdatedTime", "escapeHtml", "formatDate", "getTagColor", "getProjectColor", "getPriorityLabel", "getStatusLabel", "formatTaskUpdatedDateTime", "currentSort", "t", "isCurrentMonth", "projects", "tasks", "projects", "tasks", "t", "tasks", "escapeHtml", "formatDatePretty", "getProjectColor", "getProjectStatus", "getProjectStatusLabel", "getTagColor", "getPriorityLabel", "getStatusLabel", "getLocale", "t", "getTagColor", "escapeHtml", "FEEDBACK_CACHE_KEY", "updateProjectField", "sortTasks", "updatedState", "t", "saveProjects", "saveTasks", "persistFeedbackCache", "FEEDBACK_CACHE_KEY", "saveProjectColors", "saveSettings", "t", "persistFeedbackCache", "saveProjectColors", "t", "dateFromEl", "dateToEl", "e", "wrapper", "updateTaskField", "updateProjectField", "FEEDBACK_CACHE_KEY", "hash", "t", "e", "t", "today", "saveTasks", "saveProjects", "saveSettings", "saveProjectColors", "generateWordReport", "tasks", "generateProjectItemHTML", "projects", "t", "deleteTask", "duplicateTask", "saveProjects", "saveTasks", "modalContent", "updateTaskField", "saveSettings", "defaultText", "event", "targetSize", "quality", "dropzone", "fileInput", "clearButton", "setDropzoneText", "applyDropzoneBaseStyles", "setDropzoneDragoverStyles", "menu", "range", "currentMonth", "currentYear", "startDay", "endDay", "t", "saveTasks", "saveSettings", "saveProjects", "updateProjectField", "deleteProject", "updateProjectField", "saveProjects", "persistFeedbackCache", "t", "saveSettings", "deleteFeedbackItem", "persistFeedbackCache", "updateProjectField", "t", "saveTasks", "updateTaskField", "prevProjectId", "saveProjects", "deleteTask", "duplicateTask", "deleteProject", "t", "generateProjectItemHTML", "e"]
}
