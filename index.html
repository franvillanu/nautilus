<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="theme-color" content="#0f1419">
    <title>Nautilus ‚Äì Research Manager</title>

    <!-- Critical inline styles to prevent white flash (MUST be first) -->
    <style>
        /* Apply dark background immediately before CSS loads */
        html, body {
            background: #0f1419;
            color: #f9fafb;
            margin: 0;
            padding: 0;
        }
    </style>

    <!-- Apply theme from localStorage before page renders (blocking script) -->
    <script>
        (function() {
            // Check for saved theme preference, default to dark
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);

            // Set background color based on theme (only html, body doesn't exist yet)
            if (savedTheme === 'dark') {
                document.documentElement.style.background = '#0f1419';
            } else {
                document.documentElement.style.background = '#f8fafc';
            }

            // Set logo source based on theme
            window.__logoSrc = savedTheme === 'dark' ? 'Nautilus_logo.png' : 'Nautilus_logo_light.png';
        })();
    </script>


    <!-- Consolidated CSS -->
    <link rel="stylesheet" href="style.css?v=20251217-merged">
    <!-- Lock screen styles -->
    <link rel="stylesheet" href="lock/style.css?v=20251108-14">

    <!-- Flatpickr (CDN for production) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script defer src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <style>
        /* Boot splash: prevents blank screen while JS/CSS load */
        .boot-splash {
            position: fixed;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #0f1419;
            color: #f9fafb;
            z-index: 20000;
        }
        [data-theme="light"] .boot-splash {
            background: #f8fafc;
            color: #111827;
        }
        .boot-splash-inner {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 24px;
            text-align: center;
        }

        /* Minimalistic loader:
           - wordmark is always original
           - nautilus icon fills upward (reveals original colors)
        */
        .boot-logo {
            position: relative;
            display: block;
            --progress: 0;
            --p: 0;
            /* % from top where the wordmark begins (tweak to taste) */
            --icon-cutoff: 56%;
            /* Reveal starts slightly above the wordmark (tuned in earlier PRs) */
            --reveal-top: 52%;
            filter: drop-shadow(0 12px 22px rgba(0,0,0,0.38));

            /* Fallbacks (in case clamp() isn't supported) */
            width: 220px;
            height: 220px;
            width: clamp(180px, 14vw, 240px);
            height: clamp(180px, 14vw, 240px);
            min-width: 180px;
            min-height: 180px;
            flex: 0 0 auto;
        }
        [data-theme="light"] .boot-logo {
            filter: drop-shadow(0 12px 22px rgba(0,0,0,0.18));
        }

        .boot-logo img {
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
            pointer-events: none;
            user-select: none;
        }

        .boot-logo-wordmark {
            z-index: 1;
            clip-path: inset(var(--icon-cutoff) 0 0 0);
        }

        .boot-logo-dim {
            z-index: 2;
            clip-path: inset(0 0 calc(100% - var(--icon-cutoff)) 0);
            opacity: 0.55;
            filter: saturate(0.05) brightness(0.85) contrast(1.08);
        }

        [data-theme="light"] .boot-logo-dim {
            opacity: 0.45;
            filter: saturate(0.05) brightness(0.38) contrast(1.12);
        }

        .boot-logo-reveal {
            z-index: 3;
            clip-path: inset(var(--reveal-top) 0 calc(100% - var(--icon-cutoff)) 0);
            transition: clip-path 0.3s ease-out, -webkit-clip-path 0.3s ease-out;
            will-change: clip-path;
        }
    </style>
</head>
<body>
<!-- Visible immediately to avoid a blank screen while the app boots -->
<div id="boot-splash" class="boot-splash" role="status" aria-live="polite" aria-label="Loading Nautilus">
    <div class="boot-splash-inner">
        <div class="boot-logo" aria-hidden="true">
            <img class="boot-logo-wordmark" src="Nautilus_logo.png" alt="" />
            <img class="boot-logo-dim" src="Nautilus_logo.png" alt="" />
            <img class="boot-logo-reveal" src="Nautilus_logo.png" alt="" />
        </div>
    </div>
</div>
<script>
    // Update splash logos IMMEDIATELY (runs inline as HTML parses - zero delay)
    (function() {
        var logos = document.querySelectorAll('.boot-logo-wordmark, .boot-logo-dim, .boot-logo-reveal');
        for (var i = 0; i < logos.length; i++) {
            logos[i].src = window.__logoSrc;
        }
    })();
</script>
<!-- LOCAL DEV BANNER -->
<div id="dev-banner" style="display:none; position:fixed; bottom:0; left:0; right:0; background:#8b0000; color:#fff; padding:5px; text-align:center; z-index:99999; font-weight:bold; font-size:13px;">
  ‚ö†Ô∏è LOCAL DEV - NOT PRODUCTION ‚ö†Ô∏è
</div>
<script>
  if (window.location.hostname === '127.0.0.1' || window.location.hostname === 'localhost') {
    document.getElementById('dev-banner').style.display = 'block';
  }
</script>
    <!-- Lock overlay (gates the app) - DISABLED - Using new auth system -->
    <div class="overlay" id="overlay" style="display:none;">
        <div class="panel" role="dialog" aria-labelledby="heading" aria-describedby="desc">
            <div class="left">
                <img src="Nautilus_logo.png" alt="Nautilus logo" class="logo" />
            </div>

            <div class="right">
                <h1 id="heading">Welcome back</h1>
                <p id="desc" class="muted">Enter the access password to continue.</p>
                <div class="info-tag">‚åõ Session stays signed-in for 24 hours.</div>

                <form id="unlockForm" autocomplete="off" novalidate>
                    <label for="pw" class="sr-only">Password</label>
                    <div class="inputRow">
                        <input id="pw" name="pw" type="password" inputmode="text" placeholder="Enter password" aria-label="Password" required />
                        <div class="actions">
                            <button type="submit" class="btn primary" id="unlock">Unlock</button>
                        </div>
                    </div>
                    <div id="status" role="alert" aria-live="polite" class="status"></div>
                </form>
            </div>
        </div>
    </div>
    <!-- <script src="lock/lock.js"></script> DISABLED - Using new auth system -->

    <!-- Auth Pages (Full-screen overlays) -->

    <!-- User Login Page -->
    <div class="auth-overlay" id="login-page" style="display:none;">
        <div class="auth-panel">
            <div class="auth-left">
                <img src="Nautilus_logo.png" alt="Nautilus logo" class="logo" id="login-logo" style="cursor: pointer;" />
            </div>
            <div class="auth-right">
                <h1>Welcome to Nautilus</h1>
                <p class="muted">Login to access your research workspace</p>

                <form id="login-form" autocomplete="off" novalidate>
                    <div class="form-group">
                        <label for="login-identifier">Username or Email</label>
                        <input
                            id="login-identifier"
                            type="text"
                            placeholder="Enter username or email"
                            autocomplete="username"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label>PIN (4 digits)</label>
                        <div class="pin-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <input type="hidden" id="login-pin" />
                    </div>

                    <div class="pin-pad">
                        <button type="button" class="pin-btn" data-value="1">1</button>
                        <button type="button" class="pin-btn" data-value="2">2</button>
                        <button type="button" class="pin-btn" data-value="3">3</button>
                        <button type="button" class="pin-btn" data-value="4">4</button>
                        <button type="button" class="pin-btn" data-value="5">5</button>
                        <button type="button" class="pin-btn" data-value="6">6</button>
                        <button type="button" class="pin-btn" data-value="7">7</button>
                        <button type="button" class="pin-btn" data-value="8">8</button>
                        <button type="button" class="pin-btn" data-value="9">9</button>
                        <button type="button" class="pin-btn pin-btn-clear" data-value="clear">‚Üê</button>
                        <button type="button" class="pin-btn" data-value="0">0</button>
                        <button type="button" class="pin-btn" style="visibility:hidden;"></button>
                    </div>

                    <div id="login-status" class="status" role="alert"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Login Page -->
    <div class="auth-overlay" id="admin-login-page" style="display:none;">
        <div class="auth-panel">
            <div class="auth-left">
                <img src="Nautilus_logo.png" alt="Nautilus logo" class="logo" />
            </div>
            <div class="auth-right">
                <a href="#login" class="auth-back-link" style="display: inline-flex; align-items: center; gap: 6px; font-size: 13px; color: #9fb0b6; text-decoration: none; margin-bottom: 12px; cursor: pointer;">
                    <span style="font-size: 16px;">‚Üê</span> Back to User Login
                </a>
                <h1>Admin Access</h1>
                <p class="muted">Enter master PIN to access admin dashboard</p>

                <form id="admin-login-form" autocomplete="off" novalidate>
                    <div class="form-group">
                        <label>Master PIN (4 digits)</label>
                        <div class="pin-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <input type="hidden" id="admin-login-pin" />
                    </div>

                    <div class="pin-pad">
                        <button type="button" class="pin-btn" data-value="1">1</button>
                        <button type="button" class="pin-btn" data-value="2">2</button>
                        <button type="button" class="pin-btn" data-value="3">3</button>
                        <button type="button" class="pin-btn" data-value="4">4</button>
                        <button type="button" class="pin-btn" data-value="5">5</button>
                        <button type="button" class="pin-btn" data-value="6">6</button>
                        <button type="button" class="pin-btn" data-value="7">7</button>
                        <button type="button" class="pin-btn" data-value="8">8</button>
                        <button type="button" class="pin-btn" data-value="9">9</button>
                        <button type="button" class="pin-btn pin-btn-clear" data-value="clear">‚Üê</button>
                        <button type="button" class="pin-btn" data-value="0">0</button>
                        <button type="button" class="pin-btn" style="visibility:hidden;"></button>
                    </div>

                    <div id="admin-login-status" class="status" role="alert"></div>
                </form>

                <div class="auth-footer">
                    <a href="#login" class="auth-link">‚Üê Back to User Login</a>
                </div>
            </div>
        </div>
    </div>

    <!-- User Setup Page (First-time login) -->
    <div class="auth-overlay" id="setup-page" style="display:none;">
        <div class="auth-panel">
            <div class="auth-left">
                <img src="Nautilus_logo.png" alt="Nautilus logo" class="logo" />
            </div>
            <div class="auth-right">
                <h1 id="setup-welcome">Complete Your Setup</h1>
                <p class="muted">Personalize your account</p>

                <form id="setup-form" autocomplete="off" novalidate>
                    <div class="form-group">
                        <label for="setup-username">Username <span class="required">*</span></label>
                        <input
                            id="setup-username"
                            type="text"
                            placeholder="e.g., alex"
                            autocomplete="username"
                            required
                        />
                        <small class="form-hint">3-20 characters, lowercase letters and numbers only</small>
                    </div>

                    <div class="form-group">
                        <label for="setup-name">Display Name <span class="required">*</span></label>
                        <input
                            id="setup-name"
                            type="text"
                            placeholder="e.g., Alex Morgan"
                            autocomplete="name"
                            required
                        />
                    </div>

                    <div class="form-group">
                        <label for="setup-email">Email <span class="required">*</span></label>
                        <input
                            id="setup-email"
                            type="email"
                            placeholder="your.email@example.com"
                            autocomplete="email"
                            required
                        />
                        <small class="form-hint">Required for notifications</small>
                    </div>

                    <div class="form-group">
                        <label>New PIN (4 digits) <span class="required">*</span></label>
                        <div class="pin-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <input type="hidden" id="setup-new-pin" />
                    </div>

                    <div class="form-group">
                        <label>Confirm PIN <span class="required">*</span></label>
                        <div class="pin-dots">
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                            <span class="dot"></span>
                        </div>
                        <input type="hidden" id="setup-confirm-pin" />
                    </div>

                    <div class="pin-pad">
                        <button type="button" class="pin-btn" data-value="1">1</button>
                        <button type="button" class="pin-btn" data-value="2">2</button>
                        <button type="button" class="pin-btn" data-value="3">3</button>
                        <button type="button" class="pin-btn" data-value="4">4</button>
                        <button type="button" class="pin-btn" data-value="5">5</button>
                        <button type="button" class="pin-btn" data-value="6">6</button>
                        <button type="button" class="pin-btn" data-value="7">7</button>
                        <button type="button" class="pin-btn" data-value="8">8</button>
                        <button type="button" class="pin-btn" data-value="9">9</button>
                        <button type="button" class="pin-btn pin-btn-clear" data-value="clear">‚Üê</button>
                        <button type="button" class="pin-btn" data-value="0">0</button>
                        <button type="button" class="pin-btn pin-btn-next">Next</button>
                    </div>

                    <div id="setup-status" class="status" role="alert"></div>

                    <button type="submit" class="btn primary full-width" id="setup-submit">Complete Setup</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard Page -->
    <div class="auth-overlay" id="admin-page" style="display:none;">
        <div class="auth-panel admin-panel">
            <div class="admin-header">
                <h1>User Management</h1>
                <button class="btn secondary" id="admin-logout">Sign Out</button>
            </div>

            <div class="admin-content">
                <!-- User List -->
                <div class="admin-section">
                    <div class="section-header">
                        <h2>Users</h2>
                    </div>

                    <div id="users-list" class="users-list">
                        <!-- Users will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Create User Form -->
                <div class="admin-section">
                    <h2>Create New User</h2>

                    <form id="create-user-form" autocomplete="off" novalidate>
                        <div class="form-group">
                            <label for="new-username">Username <span class="required">*</span></label>
                            <input
                                id="new-username"
                                type="text"
                                placeholder="e.g., jdoe"
                                autocomplete="off"
                                required
                            />
                            <small class="form-hint">3-20 characters, lowercase letters and numbers only</small>
                        </div>

                        <div class="form-group">
                            <label for="new-name">Display Name <span class="required">*</span></label>
                            <input
                                id="new-name"
                                type="text"
                                placeholder="e.g., John Doe"
                                autocomplete="off"
                                required
                            />
                        </div>

                        <div class="form-group">
                            <label>Temporary PIN (4 digits) <span class="required">*</span></label>
                            <div class="pin-dots">
                                <span class="dot"></span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                                <span class="dot"></span>
                            </div>
                            <input type="hidden" id="new-temp-pin" />
                        </div>

                        <div class="pin-pad">
                            <button type="button" class="pin-btn" data-value="1">1</button>
                            <button type="button" class="pin-btn" data-value="2">2</button>
                            <button type="button" class="pin-btn" data-value="3">3</button>
                            <button type="button" class="pin-btn" data-value="4">4</button>
                            <button type="button" class="pin-btn" data-value="5">5</button>
                            <button type="button" class="pin-btn" data-value="6">6</button>
                            <button type="button" class="pin-btn" data-value="7">7</button>
                            <button type="button" class="pin-btn" data-value="8">8</button>
                            <button type="button" class="pin-btn" data-value="9">9</button>
                            <button type="button" class="pin-btn pin-btn-clear" data-value="clear">‚Üê</button>
                            <button type="button" class="pin-btn" data-value="0">0</button>
                            <button type="button" class="pin-btn" style="visibility:hidden;"></button>
                        </div>

                        <div id="create-user-status" class="status" role="alert"></div>

                        <button type="submit" class="btn primary">Create User</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div class="app" style="display:none;">
        <!-- Mobile Header (shown only on mobile) -->
        <div class="mobile-header">
            <div class="mobile-header-left">
                <button class="hamburger-btn" id="hamburger-btn" aria-label="Open menu">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
                <h1>Nautilus</h1>
            </div>
        </div>

        <!-- Sidebar Overlay (for mobile drawer) -->
        <div class="sidebar-overlay" id="sidebar-overlay"></div>

        <!-- User Menu - Always Visible -->
        <div class="user-menu">
            <div class="user-avatar" id="shared-user-avatar">ML</div>
            <div class="user-dropdown" id="shared-user-dropdown">
                <div class="dropdown-header">
                    <div class="user-name">Moony Lambre</div>
                    <div class="user-email">malambre@ull.edu.es</div>
                </div>
                <div class="dropdown-item" data-action="toggleTheme">
                    <span>üåô</span>
                    <span id="theme-text">Dark mode</span>
                </div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-item" data-action="openSettingsModal">
                    <span>‚öôÔ∏è</span>
                    <span>Settings</span>
                </div>
                <div class="dropdown-item disabled">
                    <span>‚ùì</span>
                    <span>Help</span>
                </div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-item" data-action="signOut">
                    <span>üö™</span>
                    <span>Sign out</span>
                </div>
            </div>
        </div>        
        
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="workspace-title">
                    <div class="workspace-icon">üåä</div>
                    Nautilus
                </div>
            </div>
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <div class="nav-item active" data-page="dashboard">
                        <span class="nav-icon">üè†</span>
                        Dashboard
                    </div>
                    <div class="nav-item calendar-nav" data-action="showCalendarView">
                        <span class="nav-icon">üìÖ</span>
                        Calendar
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Work</div>
                    <div class="nav-item" data-page="projects">
                        <span class="nav-icon">üìä</span>
                        Projects
                        <span class="nav-count" id="projects-count">0</span>
                    </div>
                    <div class="nav-item" data-page="tasks">
                        <span class="nav-icon">‚úÖ</span>
                        All Tasks
                        <span class="nav-count" id="tasks-count">0</span>
                    </div>
                </div>
                <div style="margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border);">
                    <div class="nav-item" data-page="feedback">
                        <span class="nav-icon">üí¨</span>
                        Feedback
                        <span class="nav-count" id="feedback-count">0</span>
                    </div>
                </div>
            </nav>
        </div>

        <div class="resizer"></div>

        <div class="main-content">
            <div class="page active" id="dashboard">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Research Dashboard</h1>
                    </div>
                </div>
                <div class="page-content dashboard-content">
                    <!-- Hero Stats Section -->
                    <div class="hero-stats">
                        <div class="hero-stat-card primary">
                            <div class="hero-stat-content">
                                <div class="hero-stat-number" id="hero-active-projects">0</div>
                                <div class="hero-stat-label">Active Research Projects</div>
                                <div class="hero-stat-trend" id="projects-trend">üìà +2 this month</div>
                            </div>
                            <div class="hero-stat-visual">
                                <div class="hero-chart" id="projects-sparkline"></div>
                            </div>
                        </div>
                        
                        <div class="hero-stat-card success">
                            <div class="hero-stat-content">
                                <div class="hero-stat-number" id="hero-completion-rate">0%</div>
                                <div class="hero-stat-label">Research Completion Rate</div>
                                <div class="hero-stat-trend" id="completion-trend">üéØ Target: 80% (Research Standard)</div>
                            </div>
                            <div class="hero-stat-visual">
                                <div class="completion-ring" id="completion-ring">
                                    <svg viewBox="0 0 100 100">
                                        <circle cx="50" cy="50" r="45" fill="none" stroke="var(--bg-tertiary)" stroke-width="8"/>
                                        <circle cx="50" cy="50" r="45" fill="none" stroke="var(--accent-green)" stroke-width="8" 
                                                stroke-dasharray="283" stroke-dashoffset="283" class="progress-circle"/>
                                    </svg>
                                    <div class="ring-percentage" id="ring-percentage">0%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Dashboard Grid -->
                    <div class="dashboard-grid">
                        <!-- Enhanced Stats Cards -->
                        <div class="stats-section">
                            <div class="stats-header">
                                <h3>üìä Project Analytics</h3>
                                <div class="time-filter">
                                    <button class="filter-chip active" data-period="week">Week</button>
                                    <button class="filter-chip" data-period="month">Month</button>
                                    <button class="filter-chip" data-period="quarter">Quarter</button>
                                </div>
                            </div>
                            <div class="enhanced-stats-grid">
                                <div class="enhanced-stat-card" data-filter="status" data-value="todo">
                                    <div class="stat-icon-new amber">‚è∞</div>
                                    <div class="stat-number" id="pending-tasks-new">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title">Pending Tasks</div>
                                        <div class="stat-change neutral" id="pending-change">On track</div>
                                    </div>
                                </div>

                                <div class="enhanced-stat-card" data-filter="status" data-value="progress">
                                    <div class="stat-icon-new blue">üèÉ‚Äç‚ôÇÔ∏è</div>
                                    <div class="stat-number" id="in-progress-tasks">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title">In Progress</div>
                                        <div class="stat-change positive" id="progress-change">+2 this week</div>
                                    </div>
                                </div>

                                <div class="enhanced-stat-card" data-filter="priority" data-value="high">
                                    <div class="stat-icon-new purple">‚ö°</div>
                                    <div class="stat-number" id="high-priority-tasks">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title">High Priority</div>
                                        <div class="stat-change neutral" id="priority-change" title="High priority tasks due within 7 days (or overdue)">2 critical</div>
                                    </div>
                                </div>

                                <div class="enhanced-stat-card" data-filter="overdue" data-value="true">
                                    <div class="stat-icon-new red">üö®</div>
                                    <div class="stat-number" id="overdue-tasks">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title">Overdue</div>
                                        <div class="stat-change negative" id="overdue-change">Needs attention</div>
                                    </div>
                                </div>

                                <div class="enhanced-stat-card" data-filter="status" data-value="done">
                                    <div class="stat-icon-new green">‚úÖ</div>
                                    <div class="stat-number" id="completed-tasks-new">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title">Completed</div>
                                        <div class="stat-change positive" id="completed-change">+13 this week</div>
                                    </div>
                                </div>

                                <div class="enhanced-stat-card clickable" id="projects-stat-card">
                                    <div class="stat-icon-new teal">üéØ</div>
                                    <div class="stat-number" id="research-milestones">0</div>
                                    <div class="stat-content">
                                        <div class="stat-title">Projects</div>
                                        <div class="stat-change positive" id="milestones-change">In progress</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Project Progress Overview -->
                        <div class="progress-overview-card">
                            <div class="card-header">
                                <h3>üåä Project Progress</h3>
                                <div class="progress-legend">
                                    <div class="legend-item"><span class="dot todo"></span>To Do</div>
                                    <div class="legend-item"><span class="dot progress"></span>In Progress</div>
                                    <div class="legend-item"><span class="dot review"></span>In Review</div>
                                    <div class="legend-item"><span class="dot done"></span>Complete</div>
                                    <button class="view-all-btn" type="button" onclick="window.location.hash = '#projects'; showPage('projects');">View All</button>
                                </div>
                            </div>
                            <div class="progress-visualization">
                                <div class="progress-bars" id="project-progress-bars"></div>
                            </div>
                        </div>

                        <!-- Quick Actions -->
                        <div class="quick-actions-card">
                            <div class="card-header">
                                <h3>‚ö° Quick Actions</h3>
                            </div>
                            <div class="quick-actions-grid">
                                <button class="quick-action" data-action="generateReport">
                                    <div class="qa-icon">üìä</div>
                                    <div class="qa-text">Generate Report</div>
                                </button>
                                <button class="quick-action" data-action="openTaskModal">
                                    <div class="qa-icon">‚úÖ</div>
                                    <div class="qa-text">Add Task</div>
                                </button>
                                <button class="quick-action" data-action="showCalendarView">
                                    <div class="qa-icon">üìÖ</div>
                                    <div class="qa-text">View Calendar</div>
                                </button>
                                <button class="quick-action" data-action="openProjectModal">
                                    <div class="qa-icon">üöÄ</div>
                                    <div class="qa-text">New Project</div>
                                </button>
                            </div>
                        </div>

                        <!-- Activity Feed -->
                        <div class="activity-feed-card">
                            <div class="card-header">
                                <h3>üîÑ Recent Activity</h3>
                                <button class="view-all-btn" data-action="showAllActivity">View All</button>
                            </div>
                            <div class="activity-feed" id="activity-feed">
                                <div class="activity-item">
                                    <div class="activity-icon completed">‚úÖ</div>
                                    <div class="activity-content">
                                        <div class="activity-text">Welcome to your Research Dashboard!</div>
                                        <div class="activity-time">Start creating projects to see activity</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Priority Insights -->
                        <div class="insights-card">
                            <div class="card-header">
                                <h3>üß† Research Insights</h3>
                            </div>
                            <div class="insights-list" id="insights-list">
                                <div class="insight-item priority">
                                    <div class="insight-icon">üéØ</div>
                                    <div class="insight-content">
                                        <div class="insight-title">Focus Area Detected</div>
                                        <div class="insight-desc">Most tasks are related to data collection - consider specialized workflows</div>
                                    </div>
                                </div>
                                <div class="insight-item success">
                                    <div class="insight-icon">üìà</div>
                                    <div class="insight-content">
                                        <div class="insight-title">Productivity Trend</div>
                                        <div class="insight-desc">Task completion rate increased 23% compared to last month</div>
                                    </div>
                                </div>
                                <div class="insight-item warning">
                                    <div class="insight-icon">‚ö†Ô∏è</div>
                                    <div class="insight-content">
                                        <div class="insight-title">Deadline Alert</div>
                                        <div class="insight-desc">3 research milestones due within the next 7 days</div>
                                    </div>
                                </div>
                            </div>
                        </div>


                    </div>
                </div>
            </div>

            <div class="page" id="projects">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Projects</h1>
                        <p class="page-subtitle">Manage your research projects</p>
                    </div>
                </div>
                <div class="page-content">
                    <div class="projects-header">
                        <div class="projects-filters-toolbar">
                            <input id="projects-search" class="projects-search" type="text" placeholder="üîç Search projects (title or description)" aria-label="Search projects by title or description">

                            <div class="projects-filters">
                                <div class="filter-group" id="group-project-status">
                                    <button type="button" class="filter-button" id="btn-filter-project-status">
                                        Status <span class="filter-count-badge" id="badge-project-status"></span> <span class="filter-arrow">‚ñº</span>
                                    </button>
                                    <div class="dropdown-panel">
                                        <div class="dropdown-section-title">Project Status</div>
                                        <ul class="dropdown-list">
                                            <li><label><input type="checkbox" value="planning" data-filter="project-status"> <span class="project-status-badge planning">PLANNING</span></label></li>
                                            <li><label><input type="checkbox" value="active" data-filter="project-status"> <span class="project-status-badge active">ACTIVE</span></label></li>
                                            <li><label><input type="checkbox" value="completed" data-filter="project-status"> <span class="project-status-badge completed">COMPLETED</span></label></li>
                                        </ul>
                                    </div>
                                </div>

                                <div class="filter-group" id="group-project-updated">
                                    <button type="button" class="filter-button" id="btn-filter-project-updated">
                                        Updated <span class="filter-count-badge" id="badge-project-updated"></span> <span class="filter-arrow">‚ñº</span>
                                    </button>
                                    <div class="dropdown-panel">
                                        <div class="dropdown-section-title">Recently Updated</div>
                                        <ul class="dropdown-list">
                                            <li><label><input type="radio" name="project-updated-filter" value="all" data-filter="project-updated"> All</label></li>
                                            <li><label><input type="radio" name="project-updated-filter" value="5m" data-filter="project-updated"> Last 5 minutes</label></li>
                                            <li><label><input type="radio" name="project-updated-filter" value="30m" data-filter="project-updated"> Last 30 minutes</label></li>
                                            <li><label><input type="radio" name="project-updated-filter" value="24h" data-filter="project-updated"> Last 24 hours</label></li>
                                            <li><label><input type="radio" name="project-updated-filter" value="week" data-filter="project-updated"> Last week</label></li>
                                            <li><label><input type="radio" name="project-updated-filter" value="month" data-filter="project-updated"> Last month</label></li>
                                        </ul>
                                    </div>
                                </div>

                                <button class="pf-chip" data-filter="has-tasks">Has tasks</button>
                                <button class="pf-chip" data-filter="no-tasks">No tasks</button>
                                <button type="button" class="btn-clear-filters" id="btn-clear-projects" style="display:none;">
                                    <span class="filter-icon">‚ùå</span>
                                    Clear Filters
                                </button>
                            </div>
                        </div>

                        <div class="active-filters" id="projects-active-filters"></div>

                        <div class="projects-sort-standalone">
                            <button type="button" id="projects-sort-btn" class="sort-btn" aria-haspopup="true" aria-expanded="false">
                                <span class="sort-icon">‚áÖ</span>
                                <span id="projects-sort-label">Sort: Status</span>
                            </button>
                            <div class="projects-sort-panel dropdown-panel" id="projects-sort-panel" role="menu" aria-hidden="true">
                                <ul class="dropdown-list">
                                    <li><button type="button" class="projects-sort-option" data-sort="default">Status</button></li>
                                    <li><button type="button" class="projects-sort-option" data-sort="name">Name</button></li>
                                    <li><button type="button" class="projects-sort-option" data-sort="created-desc">Newest</button></li>
                                    <li><button type="button" class="projects-sort-option" data-sort="updated-desc">Last Updated</button></li>
                                    <li><button type="button" class="projects-sort-option" data-sort="tasks-desc">Most tasks</button></li>
                                    <li><button type="button" class="projects-sort-option" data-sort="completion-desc">% Completed</button></li>
                                </ul>
                            </div>
                        </div>

                        <div class="projects-right">
                            <button class="add-btn" data-action="openProjectModal">+ New Project</button>
                        </div>
                    </div>
                    <div class="project-list-container">
                        <div class="project-list" id="projects-list"></div>
                        <!-- Mobile Projects (shown on mobile ‚â§ 768px) -->
                        <div class="projects-list-mobile" id="projects-list-mobile"></div>
                    </div>
                </div>
            </div>

            <div class="project-details-view" id="project-details">
                <div class="page-content" style="padding-top: 24px;">
                    <div class="project-details-container" id="project-details-content"></div>
                </div>
            </div>

            <div class="page" id="tasks">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">All Tasks</h1>
                        <p class="page-subtitle">Manage tasks across all projects</p>
                    </div>
                </div>
                
                <div class="page-content">
                    <div id="global-filters">
                        <div class="filters-toolbar">
                            <input id="filter-search" class="filter-input" type="text" placeholder="üîç Search tasks (title or description)">

                            <div class="filter-group" id="group-status">
                                <button type="button" class="filter-button" id="btn-filter-status">
                                    Status <span class="filter-count-badge" id="badge-status"></span> <span class="filter-arrow">‚ñº</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title">Status</div>
                                    <ul class="dropdown-list">
                                        <li><label><input type="checkbox" value="todo" data-filter="status"> <span class="dot todo"></span> To Do</label></li>
                                        <li><label><input type="checkbox" value="progress" data-filter="status"> <span class="dot progress"></span> In Progress</label></li>
                                        <li><label><input type="checkbox" value="review" data-filter="status"> <span class="dot review"></span> In Review</label></li>
                                        <li><label><input type="checkbox" value="done" data-filter="status"> <span class="dot done"></span> Done</label></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-tags">
                                <button type="button" class="filter-button" id="btn-filter-tags">
                                    Tags <span class="filter-count-badge" id="badge-tags"></span> <span class="filter-arrow">‚ñº</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title">Tags</div>
                                    <ul class="dropdown-list" id="tag-options"></ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-priority">
                                <button type="button" class="filter-button" id="btn-filter-priority">
                                    Priority <span class="filter-count-badge" id="badge-priority"></span> <span class="filter-arrow">‚ñº</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title">Priority</div>
                                    <ul class="dropdown-list">
                                        <li><label><input type="checkbox" value="high" data-filter="priority"> <span class="priority-dot high"></span> High</label></li>
                                        <li><label><input type="checkbox" value="medium" data-filter="priority"> <span class="priority-dot medium"></span> Medium</label></li>
                                        <li><label><input type="checkbox" value="low" data-filter="priority"> <span class="priority-dot low"></span> Low</label></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-project">
                                <button type="button" class="filter-button" id="btn-filter-project">
                                    Project <span class="filter-count-badge" id="badge-project"></span> <span class="filter-arrow">‚ñº</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title">Project</div>
                                    <ul class="dropdown-list">
                                        <li class="select-all-row">
                                            <label>
                                                <input type="checkbox" id="project-select-all">
                                                <strong>Select / Unselect All</strong>
                                            </label>
                                        </li>
                                    </ul>
                                    <ul class="dropdown-list" id="project-options"></ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-date-preset">
                                <button type="button" class="filter-button" id="btn-filter-date-preset">
                                    Date <span class="filter-count-badge" id="badge-date-preset"></span> <span class="filter-arrow">‚ñº</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title">Quick Date Filters</div>
                                    <ul class="dropdown-list">
                                        <li><label><input type="checkbox" value="no-date" data-filter="date-preset" data-preset-value="no-date"> No Due Date</label></li>
                                        <li><label><input type="checkbox" value="overdue" data-filter="date-preset" data-preset-value="overdue"> Overdue</label></li>
                                        <li><label><input type="checkbox" value="today" data-filter="date-preset" data-preset-value="today"> Due Today</label></li>
                                        <li><label><input type="checkbox" value="tomorrow" data-filter="date-preset" data-preset-value="tomorrow"> Due Tomorrow</label></li>
                                        <li><label><input type="checkbox" value="7days" data-filter="date-preset" data-preset-value="7days"> Due in 7 Days</label></li>
                                        <li><label><input type="checkbox" value="week" data-filter="date-preset" data-preset-value="week"> Due This Week</label></li>
                                        <li><label><input type="checkbox" value="month" data-filter="date-preset" data-preset-value="month"> Due This Month</label></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-kanban-updated" style="display:none">
                                <button type="button" class="filter-button" id="btn-filter-kanban-updated">
                                    Updated <span class="filter-count-badge" id="badge-kanban-updated"></span> <span class="filter-arrow">‚ñº</span>
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title">Recently Updated</div>
                                    <ul class="dropdown-list">
                                        <li><label><input type="radio" name="kanban-updated-filter" value="all" data-filter="kanban-updated"> All</label></li>
                                        <li><label><input type="radio" name="kanban-updated-filter" value="5m" data-filter="kanban-updated"> Last 5 minutes</label></li>
                                        <li><label><input type="radio" name="kanban-updated-filter" value="30m" data-filter="kanban-updated"> Last 30 minutes</label></li>
                                        <li><label><input type="radio" name="kanban-updated-filter" value="24h" data-filter="kanban-updated"> Last 24 hours</label></li>
                                        <li><label><input type="radio" name="kanban-updated-filter" value="week" data-filter="kanban-updated"> Last week</label></li>
                                        <li><label><input type="radio" name="kanban-updated-filter" value="month" data-filter="kanban-updated"> Last month</label></li>
                                    </ul>
                                </div>
                            </div>

                            <div style="display: flex; gap: 8px; align-items: center;">
                                <input type="date" id="filter-date-from" class="filter-input" placeholder="Start date" data-placeholder="Start date" style="min-width: 140px;">
                                <input type="date" id="filter-date-to" class="filter-input" placeholder="End date" data-placeholder="End date" style="min-width: 140px;">
                            </div>
                            
                            <button type="button" class="btn-clear-filters" id="btn-clear-filters" style="display:none">
                                <span class="filter-icon">‚ùå</span>
                                Clear Filters
                            </button>
                        </div>

                        <div class="active-filters" id="active-filters"></div>
                    </div>

                <div id="kanban-tip" class="info-banner" style="display: flex; align-items: center; gap: 10px; padding: 12px 16px; background: rgba(59, 130, 246, 0.1); border: 1px solid var(--accent-blue); border-radius: 8px; margin-bottom: 16px; font-size: 14px;">
                    <span style="color: var(--accent-blue);">üí°</span>
                    <span style="flex: 1; color: var(--text-secondary);">
                        <strong>Tip:</strong> In the Kanban Board hold <kbd style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px; font-size: 12px;">Shift</kbd> and click to select multiple tasks, then drag to move them together
                    </span>
                    <button data-action="dismissKanbanTip" style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 16px;">‚úï</button>
                </div>

                    <div class="kanban-header">
                        <div style="display: flex; gap: 16px; align-items: center;">
                            <div class="view-toggle">
                                <button class="view-btn active">Kanban</button>
                                <button class="view-btn">List</button>
                                <button class="view-btn">Calendar</button>
                            </div>
                            <div class="sort-toggle" id="sort-toggle" style="display: none;">
                                <button class="sort-btn" id="sort-btn" data-action="toggleSortMode">
                                    <span id="sort-icon">‚¨ÜÔ∏è</span>
                                    <span id="sort-label">Sort: Priority</span>
                                </button>
                            </div>
                            <div style="position: relative;">
                                <button id="kanban-settings-btn" data-action="toggleKanbanSettings" style="background: none; border: none; padding: 6px; cursor: pointer; display: flex; align-items: center; justify-content: center; color: var(--text-secondary); border-radius: 4px; transition: all 0.2s;">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="4" y1="21" x2="4" y2="14"></line>
                                        <line x1="4" y1="10" x2="4" y2="3"></line>
                                        <line x1="12" y1="21" x2="12" y2="12"></line>
                                        <line x1="12" y1="8" x2="12" y2="3"></line>
                                        <line x1="20" y1="21" x2="20" y2="16"></line>
                                        <line x1="20" y1="12" x2="20" y2="3"></line>
                                        <line x1="1" y1="14" x2="7" y2="14"></line>
                                        <line x1="9" y1="8" x2="15" y2="8"></line>
                                        <line x1="17" y1="16" x2="23" y2="16"></line>
                                    </svg>
                                </button>
                                <!-- Kanban Settings Dropdown -->
                                <div id="kanban-settings-panel" class="user-dropdown">
                                    <label class="dropdown-item" style="cursor: pointer; user-select: none;">
                                        <input type="checkbox" id="kanban-show-projects" onchange="toggleKanbanProjects()" checked style="cursor: pointer; width: 16px; height: 16px; margin: 0;">
                                        <span>Show Projects</span>
                                    </label>
                                    <label class="dropdown-item" style="cursor: pointer; user-select: none;">
                                        <input type="checkbox" id="kanban-show-no-date" onchange="toggleKanbanNoDate()" checked style="cursor: pointer; width: 16px; height: 16px; margin: 0;">
                                        <span>Show "No Date"</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <button class="add-btn" data-action="openTaskModal">+ Add Task</button>
                    </div>
                    
                    <div class="kanban-board">
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">üìã To Do</div>
                                <span class="column-count" id="todo-count">0</span>
                            </div>
                            <div id="todo-tasks"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">üîÑ In Progress</div>
                                <span class="column-count" id="progress-count">0</span>
                            </div>
                            <div id="progress-tasks"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">‚òëÔ∏è In Review</div>
                                <span class="column-count" id="review-count">0</span>
                            </div>
                            <div id="review-tasks"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">‚úÖ Done</div>
                                <span class="column-count" id="done-count">0</span>
                            </div>
                            <div id="done-tasks"></div>
                        </div>
                    </div>
                    
                    <div class="list-view" id="list-view">
                        <table class="tasks-table">
                            <thead>
                                <tr>
                                    <th data-action="sortTable" data-param="title" style="cursor: pointer;">Task <span id="sort-title">‚Üï</span></th>
                                    <th data-action="sortTable" data-param="priority" style="cursor: pointer;">Priority <span id="sort-priority">‚Üï</span></th>
                                    <th data-action="sortTable" data-param="status" style="cursor: pointer;">Status <span id="sort-status">‚Üï</span></th>
                                    <th>Tags</th>
                                    <th data-action="sortTable" data-param="project" style="cursor: pointer;">Project <span id="sort-project">‚Üï</span></th>
                                    <th data-action="sortTable" data-param="startDate" style="cursor: pointer;">Start Date <span id="sort-startDate">‚Üï</span></th>
                                    <th data-action="sortTable" data-param="endDate" style="cursor: pointer;">End Date <span id="sort-endDate">‚Üï</span></th>
                                    <th data-action="sortTable" data-param="updatedAt" style="cursor: pointer;">Updated <span id="sort-updatedAt">‚Üï</span></th>
                                </tr>
                            </thead>
                            <tbody id="tasks-table-body"></tbody>
                        </table>

                        <!-- Premium Mobile Cards (shown on mobile ‚â§ 768px) -->
                        <div class="tasks-list-mobile" id="tasks-list-mobile"></div>
                    </div>

                    <div class="calendar-view" id="calendar-view">
                        <div class="page-header">
                            <div>
                                <h1 class="page-title">Calendar</h1>
                            </div>
                            <button class="calendar-today-btn calendar-today-btn--header" data-action="goToToday">Today</button>
                        </div>
                        <div class="calendar-container">
                            <div class="calendar-header">
                                <div class="calendar-nav">
                                    <button data-action="changeMonth" data-param="-1">‚Üê</button>
                                    <span class="calendar-month-year" id="calendar-month-year">January 2024</span>
                                    <button data-action="changeMonth" data-param="1">‚Üí</button>
                                </div>
                                <button class="calendar-today-btn calendar-today-btn--nav" data-action="goToToday">Today</button>
                            </div>
                            <div style="position: relative;">
                                <div class="calendar-grid" id="calendar-grid"></div>
                                <div class="project-overlay" id="project-overlay"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Floating Action Button (Mobile Calendar Only) -->
                    <button class="fab-calendar"
                            data-action="openModal"
                            data-param="task-modal"
                            aria-label="Add Task">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="page" id="feedback">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Feedback & Issues</h1>
                        <p class="page-subtitle">Report bugs and suggest features</p>
                    </div>
                </div>
                <div class="page-content">
                   <div class="feedback-input-bar">
                        <div class="filter-group" id="feedback-type-group">
                            <button type="button" class="filter-button" id="feedback-type-btn">
                                <span id="feedback-type-label">üêû Bug</span> <span class="filter-arrow">‚ñº</span>
                            </button>
                            <div class="dropdown-panel">
                                <div class="dropdown-section-title">Feedback Type</div>
                                <ul class="dropdown-list">
                                    <li><label><input type="radio" name="feedback-type" value="bug" checked> üêû Bug</label></li>
                                    <li><label><input type="radio" name="feedback-type" value="idea"> üí° Improvement</label></li>
                                </ul>
                            </div>
                        </div>
                        <input type="text" id="feedback-description" class="feedback-input" placeholder="Describe the issue or idea. You can paste an image directly into this field.">
                        <span class="camera-divider">üì∏</span>
                        <div
                            id="feedback-screenshot-url"
                            class="feedback-input feedback-screenshot-dropzone"
                            style="flex: 0 0 340px;"
                            role="button"
                            tabindex="0"
                        ></div>
                        <input
                            type="file"
                            id="feedback-screenshot-file"
                            accept="image/*"
                            style="display: none;"
                        >
                        <button
                            type="button"
                            id="feedback-screenshot-upload"
                            class="screenshot-upload-link"
                            title="Attach screenshot from device"
                        >
                            üì∑
                        </button>
                        <button class="add-btn" data-action="addFeedbackItem">Add</button>
                    </div>
                    
                    <div style="margin-top: 32px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <h3 style="font-size: 16px; font-weight: 600; color: var(--text-secondary);">‚è≥ Pending</h3>
                        </div>
                        <div style="height: 1px; background: var(--border); margin-bottom: 16px;"></div>
                        <div id="feedback-list-pending"></div>
                        <div id="feedback-pagination-pending" class="feedback-pagination"></div>
                    </div>

                    <div style="margin-top: 32px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <h3 style="font-size: 16px; font-weight: 600; color: var(--text-muted);">‚úÖ Done</h3>
                        </div>
                        <div style="height: 1px; background: var(--border); margin-bottom: 16px;"></div>
                        <div id="feedback-list-done"></div>
                        <div id="feedback-pagination-done" class="feedback-pagination"></div>
                    </div>
                </div>
            </div>
    </div>

    <!-- Modals - Outside of all pages -->
    <div id="project-modal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">Create New Project</h2>
            <form id="project-form">
                <div class="form-group">
                    <label class="form-label">Project Name</label>
                    <input type="text" class="form-input" name="name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" name="description"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input type="date" class="form-input" name="startDate">
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input type="date" class="form-input" name="endDate">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" data-action="closeModal" data-param="project-modal">Cancel</button>
                    <button type="submit" class="btn-primary">Create Project</button>
                </div>
            </form>
        </div>
    </div>

 <div id="task-modal" class="modal">
  <div class="modal-content">

    <!-- header -->
    <div class="modal-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;flex-shrink:0;">
      <h2 style="font-size:20px;font-weight:600;margin:0;">Edit Task</h2>
      <div class="header-actions" style="display:flex;gap:8px;align-items:center;position:relative;">
        <button type="button" class="options-btn" id="task-options-btn"
                style="background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:20px;padding:4px;line-height:1;">‚ãØ</button>
        <button type="button" class="modal-close" data-action="closeTaskModal"
                style="background:none;border:none;font-size:20px;cursor:pointer;">‚ùå</button>

        <!-- options menu appears under the 3 dots -->
    <div class="options-menu" id="options-menu" style="position:absolute;top:calc(100% + 8px);right:28px;display:none;">
      <button type="button" data-action="duplicateTask"
          style="width: 100%; padding: 8px 16px; background: none; border: none; color: var(--text-secondary); cursor: pointer; text-align: left; font-size: 14px;">üìÑ Duplicate Task</button>
      <div style="height: 1px; background: var(--border); margin: 4px 0;"></div>
      <button type="button" class="delete-btn" data-action="deleteTask">üóëÔ∏è Delete Task</button>
    </div>
      </div>
    </div>

    <!-- Modal Tabs -->
    <div class="modal-tabs">
      <!-- Desktop: Shows "Details" and "History" -->
      <!-- Mobile: Shows "General", "More Details", and "History" -->
      <button class="modal-tab modal-tab-desktop active" data-tab="details">Details</button>
      <button class="modal-tab modal-tab-mobile active" data-tab="general">General</button>
      <button class="modal-tab modal-tab-mobile" data-tab="more-details">More Details</button>
      <button class="modal-tab" data-tab="history">History</button>
    </div>

    <!-- Details Tab Content (Desktop) / General + More Details Tabs (Mobile) -->
    <!-- On desktop: shows all fields in two-column layout -->
    <!-- On mobile: same content but fields shown/hidden based on active tab -->
    <div class="modal-tab-content active" id="task-details-tab" data-mobile-tabs="general,more-details">
    <form id="task-form">
      <div class="modal-body">
        <!-- LEFT COLUMN -->
        <div class="modal-left">
          <!-- Title: General tab on mobile -->
          <div class="form-group mobile-general-field">
            <label class="form-label">Task Title</label>
         <input type="text" class="form-input" name="title" required>
          </div>

        <!-- Attachments: More Details tab on mobile -->
        <div class="form-group mobile-more-details-field">
            <label>Attachments</label>
            <div id="attachments-files-list"></div>

            <!-- File Upload -->
            <div id="attachment-file-dropzone" class="form-input task-attachment-dropzone" style="margin-top: 8px;" role="button" tabindex="0"></div>
            <input type="file" id="attachment-file" style="display: none;">

            <div style="font-size: 12px; color: var(--text-muted); margin-top: 8px;">
                Supported: Images (10MB), PDFs (20MB), Documents (10MB)
            </div>

            <div style="margin: 14px 0 8px; font-size: 12px; font-weight: 700; letter-spacing: 0.4px; color: var(--text-muted); text-transform: uppercase;">Links</div>
            <div id="attachments-links-list"></div>

            <!-- URL Link -->
            <div style="display: flex; gap: 8px; margin-top: 8px;">
                <input type="text" id="attachment-name" class="form-input" placeholder="Name (optional)" style="flex: 1.6;">
                <input type="text" id="attachment-url" class="form-input" placeholder="URL" style="flex: 1.4;">
                <button type="button" class="btn-secondary" data-action="addAttachment">Add Link</button>
            </div>

        </div>

          <!-- Description: General tab on mobile -->
          <div class="form-group mobile-general-field">
            <label class="form-label">Description</label>
            <div class="rich-editor">
              <div class="editor-toolbar">
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="bold"><strong>B</strong></button>
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="italic"><em>I</em></button>
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="underline"><u>U</u></button>
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="strikeThrough"><span style="text-decoration: line-through;">S</span></button>
                <span style="width:1px;height:20px;background:var(--border);margin:0 4px;"></span>
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="insertUnorderedList">‚Ä¢ List</button>
                <button type="button" class="editor-btn" data-action="formatTaskText" data-param="insertOrderedList">1. List</button>
                <span style="width:1px;height:20px;background:var(--border);margin:0 4px;"></span>
                <button type="button" class="editor-btn" data-action="insertTaskHeading" data-param="h1">H1</button>
                <button type="button" class="editor-btn" data-action="insertTaskHeading" data-param="h2">H2</button>
                <button type="button" class="editor-btn" data-action="insertTaskHeading" data-param="h3">H3</button>
<button type="button" class="editor-btn" data-action="insertTaskDivider" title="Insert horizontal divider">‚îÄ</button>
                                <!-- Checklist button: inserts an empty checkbox row -->
                                <button type="button" class="editor-btn" id="checklist-btn" title="Insert checkbox">‚òë</button>
              </div>
            <div class="editor-content" contenteditable="true" id="task-description-editor"></div>
            </div>
            <textarea name="description" id="task-description-hidden" style="display:none;"></textarea>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="modal-right">

          <!-- Status: General tab on mobile -->
          <div class="form-group mobile-general-field" style="position:relative;">
            <label class="form-label">Status</label>
            <div class="status-dropdown">
              <button type="button" class="status-current" id="status-current">
                <span class="status-badge todo">To Do</span>
                <span class="dropdown-arrow">‚ñº</span>
              </button>
              <div class="status-options" id="status-options">
                <!-- no inline onclick; handled by delegated JS -->
                <div class="status-option" data-status="todo">
                  <span class="status-badge todo">To Do</span>
                </div>
                <div class="status-option" data-status="progress">
                  <span class="status-badge progress">In Progress</span>
                </div>
                <div class="status-option" data-status="review">
                  <span class="status-badge review">In Review</span>
                </div>
                <div class="status-option" data-status="done">
                  <span class="status-badge done">Done</span>
                </div>
              </div>
            </div>
            <input type="hidden" name="status" id="hidden-status" value="todo">
          </div>

          <!-- Priority: General tab on mobile -->
          <div class="form-group mobile-general-field">
            <label class="form-label">Priority</label>
            <div class="priority-dropdown">
              <button type="button" class="priority-current" id="priority-current">
                <span class="priority-dot medium"></span> Medium
                <span class="dropdown-arrow">‚ñº</span>
              </button>
              <div class="priority-options" id="priority-options">
                <div class="priority-option" data-priority="low">
                  <span class="priority-dot low"></span> Low
                </div>
                <div class="priority-option" data-priority="medium">
                  <span class="priority-dot medium"></span> Medium
                </div>
                <div class="priority-option" data-priority="high">
                  <span class="priority-dot high"></span> High
                </div>
              </div>
            </div>
            <input type="hidden" name="priority" id="hidden-priority" value="medium">
          </div>

        <!-- Tags: More Details tab on mobile -->
        <div class="form-group mobile-more-details-field">
            <label class="form-label">Tags</label>
            <div id="tags-display" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; min-height: 28px;"></div>
            <div style="display: flex; gap: 8px;">
                <input type="text" id="tag-input" class="form-input" placeholder="Add tag" style="flex: 1;">
                <button type="button" class="btn-secondary" data-action="addTag">+</button>
            </div>
        </div>


          <!-- Start Date: More Details tab on mobile -->
          <div class="form-group mobile-more-details-field">
            <label class="form-label">Start Date</label>
            <input type="date" class="form-input" name="startDate">
          </div>

          <!-- End Date: More Details tab on mobile -->
          <div class="form-group mobile-more-details-field">
            <label class="form-label">End Date</label>
            <input type="date" class="form-input" name="endDate">
          </div>

          <!-- Project: More Details tab on mobile -->
          <div class="form-group mobile-more-details-field" style="position:relative;">
            <div style="flex:1 1 auto; min-width:0;">
              <div class="task-project-label-row">
                <label class="form-label">Project</label>
                <button
                  type="button"
                  class="task-project-open-btn"
                  id="task-project-open-btn"
                  data-action="openSelectedProjectFromTask"
                  title="Open project details"
                  style="display:none;"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                  </svg>
                </button>
              </div>
            <div class="project-dropdown">
              <button type="button" class="project-current" id="project-current">
                <span class="project-text">Select a project</span>
                <span class="dropdown-arrow">‚ñº</span>
              </button>
            </div>
            <input type="hidden" name="projectId" id="hidden-project" value="">
            </div>
          </div>

        </div><!-- /modal-right -->
      </div><!-- /modal-body -->

      <!-- Modal Footer (outside modal-body so it stays visible) -->
      <div class="modal-footer" id="task-footer">
        <button type="button" class="btn-secondary" id="task-cancel-btn" data-action="closeTaskModal">Cancel</button>
        <button type="submit" class="btn-primary" id="task-submit-btn">Create Task</button>
      </div>
    </form>
    </div><!-- /task-details-tab -->

    <!-- History Tab Content -->
    <div class="modal-tab-content" id="task-history-tab">
      <div class="task-history-container">
        <div class="history-timeline-inline" id="task-history-timeline">
          <!-- Timeline will be populated by JavaScript -->
        </div>
        <div class="history-empty-inline" id="task-history-empty" style="display: none;">
          <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.3;">üìú</div>
          <h3 style="color: var(--text-secondary); margin-bottom: 8px;">No Changes Yet</h3>
          <p style="color: var(--text-muted);">Changes to this task will appear here</p>
        </div>
      </div>
    </div><!-- /task-history-tab -->

  </div>
</div>


    <div id="confirm-modal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-title">Delete Task</div>
            <p>This action cannot be undone. To confirm deletion, type <strong>delete</strong> below:</p>
            <input type="text" id="confirm-input" class="confirm-input" placeholder="Type delete here">
            <div class="confirm-error" id="confirm-error">Type "delete" exactly to confirm</div>
            <div class="confirm-actions">
                <button class="btn-secondary" data-action="closeConfirmModal">Cancel</button>
                <button class="btn-secondary" data-action="confirmDelete" style="background: var(--accent-red);">Delete</button>
            </div>
        </div>
    </div>

    <div id="unsaved-changes-modal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-title">Unsaved Changes</div>
            <p>You have unsaved changes. Are you sure you want to close and lose them?</p>
            <div class="confirm-actions">
                <button class="btn-secondary" data-action="closeUnsavedChangesModal">Cancel</button>
                <button class="btn-secondary" data-action="confirmDiscardChanges" style="background: var(--accent-red);">Discard Changes</button>
            </div>
        </div>
    </div>

    <div id="feedback-delete-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <h2 class="modal-title">Delete Feedback</h2>
            <p style="color: var(--text-secondary); margin-bottom: 24px;">Are you sure you want to delete this feedback?</p>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" data-action="closeFeedbackDeleteModal">Cancel</button>
                <button type="button" class="btn-primary" style="background: var(--accent-red);" data-action="confirmFeedbackDelete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Export Data Confirmation Modal -->
    <div id="export-data-modal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <h2 class="modal-title">Export Data</h2>
            <p style="color: var(--text-secondary);">This will download a complete backup of all your tasks, projects, and settings as a JSON file. Are you sure you want to export your data?</p>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" data-action="closeExportDataModal">Cancel</button>
                <button type="button" class="btn-primary" data-action="confirmExportData">Export</button>
            </div>
        </div>
    </div>

    <div id="project-confirm-modal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-title">Delete Project</div>
            <p>This action cannot be undone. To confirm deletion, type <strong>delete</strong> below:</p>
            <div style="margin: 16px 0; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="delete-tasks-checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="font-size: 14px; color: var(--text-secondary);">Delete all tasks in this project</span>
                </label>
                <p style="margin: 8px 0 0 26px; font-size: 12px; color: var(--text-muted);">If unchecked, tasks will be unassigned from the project</p>
            </div>
            <input type="text" id="project-confirm-input" class="confirm-input" placeholder="Type delete here">
            <div class="confirm-error" id="project-confirm-error">Type "delete" exactly to confirm</div>
            <div class="confirm-actions">
                <button class="btn-secondary" data-action="closeProjectConfirmModal">Cancel</button>
                <button class="btn-secondary" data-action="confirmProjectDelete" style="background: var(--accent-red);">Delete</button>
            </div>
        </div>
    </div>

    <div id="status-info-modal" class="modal" data-action="closeModalOnBackdrop" data-param="status-info-modal">
    <div class="modal-content" data-action="stopPropagation" style="max-width: 500px;">
        <h2 class="modal-title">Project Status Logic</h2>
        <div style="margin: 24px 0; line-height: 1.8; color: var(--text-secondary);">
            <p style="margin-bottom: 16px;">Project status updates automatically based on task progress</p>
            
            <div style="margin-bottom: 12px;">
	                    <strong style="color: var(--text-muted);">‚¨ú Planning</strong><br>
                All tasks are in "To Do" status
            </div>
            
            <div style="margin-bottom: 12px;">
	                <strong style="color: var(--accent-blue);">üü¶ Active</strong><br>
                At least one task is "In Progress" or "In Review"
            </div>
            
            <div style="margin-bottom: 12px;">
                <strong style="color: var(--accent-green);">‚úÖ Completed</strong><br>
                All tasks are marked as "Done"
            </div>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn-primary" data-action="closeModal" data-param="status-info-modal">Got it</button>
        </div>
    </div>
</div>

    <div id="settings-modal" class="modal">
        <div class="modal-content settings-modal-content">
            <div class="settings-modal-header">
                <div class="settings-header-left">
                    <div class="settings-icon-wrapper">‚öôÔ∏è</div>
                    <div class="settings-header-text">
                        <h2 class="settings-title">Settings</h2>
                        <p class="settings-subtitle">Manage your preferences and application settings</p>
                    </div>
                </div>
                <button class="modal-close settings-close" data-action="closeModal" data-param="settings-modal" aria-label="Close modal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>

              <form id="settings-form">
                  <div class="settings-modal-body">
                      <div class="settings-section">
                          <div class="settings-section-header">
                            <svg class="settings-section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                              <h3 class="settings-section-title">Profile</h3>
                          </div>
                          <div class="settings-section-content">
                              <div class="settings-field">
                                  <div class="settings-field-label">
                                      <label class="field-label" for="user-name">Display Name</label>
                                      <p class="field-hint">This name is displayed throughout the application</p>
                                  </div>
                                  <div class="settings-field-input">
                                      <input
                                          type="text"
                                          id="user-name"
                                          name="userName"
                                          class="settings-input"
                                          placeholder="Enter your display name"
                                      />
                                  </div>
                              </div>
                              <div class="settings-field">
                                  <div class="settings-field-label">
                                      <label class="field-label" for="user-email">Email</label>
                                      <p class="field-hint">Used for your account and deadline notifications</p>
                                  </div>
                                  <div class="settings-field-input">
                                      <input
                                          type="email"
                                          id="user-email"
                                          name="notificationEmail"
                                          class="settings-input"
                                          placeholder="Enter your email"
                                      />
                                  </div>
                              </div>
                              <div class="settings-field settings-field-avatar">
                                    <div class="settings-field-label">
                                       <label class="field-label">Avatar</label>
                                       <p class="field-hint">Upload an image for your avatar (max 2MB). It will be displayed as a circle.</p>
                                    </div>
                                  <div class="settings-field-input user-avatar-input-row">
                                      <!-- Drag & Drop Zone -->
                                      <div id="user-avatar-dropzone" class="form-input user-avatar-dropzone" role="button" tabindex="0"></div>
                                      <input type="file" id="user-avatar-input" accept="image/*" style="display: none;">

                                      <!-- Preview -->
                                      <div
                                          class="user-avatar-preview"
                                          id="user-avatar-preview"
                                          aria-hidden="true"
                                      ></div>

                                      <!-- Clear Button -->
                                      <button
                                          type="button"
                                          class="user-avatar-clear-btn"
                                          id="user-avatar-clear-btn"
                                          title="Remove avatar"
                                      >
                                          x
                                      </button>
                                  </div>
                              </div>
                              <div class="settings-field settings-field-logo">
                                    <div class="settings-field-label">
                                       <label class="field-label">Workspace Logo</label>
                                       <p class="field-hint">Upload a square image to replace the Nautilus logo (max 2MB).</p>
                                    </div>
                                  <div class="settings-field-input workspace-logo-input-row">
                                      <!-- Drag & Drop Zone -->
                                      <div id="workspace-logo-dropzone" class="form-input workspace-logo-dropzone" role="button" tabindex="0"></div>
                                      <input type="file" id="workspace-logo-input" accept="image/*" style="display: none;">

                                      <!-- Preview -->
                                      <div
                                          class="workspace-logo-preview"
                                          id="workspace-logo-preview"
                                          aria-hidden="true"
                                      ></div>

                                      <!-- Clear Button -->
                                      <button
                                          type="button"
                                          class="workspace-logo-clear-btn"
                                          id="workspace-logo-clear-btn"
                                          title="Remove custom logo"
                                      >
                                          x
                                      </button>
                                  </div>
                              </div>
                          </div>
                      </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg class="settings-section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect><line x1="8" y1="21" x2="16" y2="21"></line><line x1="12" y1="17" x2="12" y2="21"></line></svg>
                            <h3 class="settings-section-title">Application</h3>
                        </div>
                        <div class="settings-section-content">
                            <div class="settings-field settings-field-toggle">
                                <div class="settings-field-label">
                                    <label class="field-label" for="auto-start-date-toggle">Auto-set start date</label>
                                    <p class="field-hint">Automatically set Start Date when task status changes to "In Progress" (if empty)</p>
                                </div>
                                <div class="settings-field-input history-sort-input">
                                    <div class="premium-toggle">
                                        <input type="checkbox" id="auto-start-date-toggle" name="autoSetStartDateOnStatusChange">
                                        <label for="auto-start-date-toggle"></label>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-field settings-field-toggle">
                                <div class="settings-field-label">
                                    <label class="field-label" for="auto-end-date-toggle">Auto-set end date</label>
                                    <p class="field-hint">Automatically set End Date when task status changes to "Done" (if empty)</p>
                                </div>
                                <div class="settings-field-input">
                                    <div class="premium-toggle">
                                        <input type="checkbox" id="auto-end-date-toggle" name="autoSetEndDateOnStatusChange">
                                        <label for="auto-end-date-toggle"></label>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-field settings-field-toggle history-sort-field">
                                <div class="settings-field-label">
                                    <label class="field-label" for="history-sort-order">History Sort Order</label>
                                    <p class="field-hint">Default sort order for task and project history timelines</p>
                                </div>
                                <div class="settings-field-input history-sort-input">
                                    <select id="history-sort-order" name="historySortOrder" class="settings-select">
                                        <option value="newest">Newest First</option>
                                        <option value="oldest">Oldest First</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg class="settings-section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8a6 6 0 0 0-12 0c0 7-3 9-3 9h18s-3-2-3-9"></path><path d="M13.73 21a2 2 0 0 1-3.46 0"></path></svg>
                            <h3 class="settings-section-title">Notifications</h3>
                        </div>
                        <div class="settings-section-content">
                            <div class="settings-field settings-field-toggle">
                                <div class="settings-field-label">
                                    <label class="field-label" for="email-notifications-enabled">Email notifications</label>
                                    <p class="field-hint">Enable or disable deadline reminder emails</p>
                                </div>
                                <div class="settings-field-input">
                                    <div class="premium-toggle">
                                        <input type="checkbox" id="email-notifications-enabled" name="emailNotificationsEnabled">
                                        <label for="email-notifications-enabled"></label>
                                    </div>
                                </div>
                            </div>

                            <div id="email-notification-details" class="settings-collapsible" aria-hidden="false">
                                <div class="settings-field settings-field-toggle">
                                    <div class="settings-field-label">
                                        <label class="field-label" for="email-notifications-weekdays-only">Weekdays only</label>
                                        <p class="field-hint">Skip emails on Saturday and Sunday</p>
                                    </div>
                                    <div class="settings-field-input">
                                        <div class="premium-toggle">
                                            <input type="checkbox" id="email-notifications-weekdays-only" name="emailNotificationsWeekdaysOnly">
                                            <label for="email-notifications-weekdays-only"></label>
                                        </div>
                                    </div>
                                </div>

                                <div class="settings-field" id="email-notification-time-field">
                                    <div class="settings-field-label">
                                        <label class="field-label" for="email-notification-time-trigger">Send time</label>
                                        <p class="field-hint">Daily time to send reminders (08:00-18:00, 30-minute increments)</p>
                                    </div>
                                    <div class="settings-field-input">
                                        <button
                                            type="button"
                                            id="email-notification-time-trigger"
                                            class="settings-select settings-select-clock settings-time-trigger"
                                            aria-haspopup="listbox"
                                            aria-expanded="false"
                                        >
                                            <span id="email-notification-time-value">09:00</span>
                                        </button>
                                        <input type="hidden" id="email-notification-time" name="emailNotificationTime" value="09:00" />
                                    </div>
                                </div>

                                <div class="settings-field" id="email-notification-timezone-field">
                                    <div class="settings-field-label">
                                        <label class="field-label" for="email-notification-timezone">Time zone</label>
                                        <p class="field-hint">Keeps the same local time year-round (DST-aware)</p>
                                    </div>
                                    <div class="settings-field-input">
                                        <button
                                            type="button"
                                            id="email-notification-timezone-trigger"
                                            class="settings-select settings-timezone-trigger"
                                            aria-haspopup="listbox"
                                            aria-expanded="false"
                                        >
                                            <span id="email-notification-timezone-value">Canary Islands (Atlantic/Canary)</span>
                                        </button>
                                        <select id="email-notification-timezone" name="emailNotificationTimeZone" class="settings-select">
                                            <option value="America/Argentina/Buenos_Aires">Argentina (Buenos Aires)</option>
                                            <option value="Atlantic/Canary">Canary Islands (Atlantic/Canary)</option>
                                            <option value="Europe/Madrid">Spain mainland (Europe/Madrid)</option>
                                            <option value="UTC">UTC</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg class="settings-section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>
                            <h3 class="settings-section-title">Security</h3>
                        </div>
                            <div class="settings-section-content">
                                <div class="settings-field">
                                    <div class="settings-field-label">
                                        <label class="field-label">PIN Management</label>
                                    <p class="field-hint">Reset your PIN to a new 4-digit code</p>
                                </div>
                                <div class="settings-field-input">
                                    <button type="button" class="settings-btn settings-btn-danger" id="reset-pin-btn">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 4v6h-6"></path><path d="M1 20v-6h6"></path><path d="M3.51 9a9 9 0 0 1 14.85-3.36M20.49 15a9 9 0 0 1-14.85 3.36"></path></svg>
                                        Reset PIN
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section">
                        <div class="settings-section-header">
                            <svg class="settings-section-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                            <h3 class="settings-section-title">Data Management</h3>
                        </div>
                        <div class="settings-section-content">
                            <div class="settings-field">
                                <div class="settings-field-label">
                                    <label class="field-label">Export Data</label>
                                    <p class="field-hint">Download a complete backup of all your tasks, projects, and settings as a JSON file</p>
                                </div>
                                <div class="settings-field-input">
                                    <button type="button" class="settings-btn settings-btn-cancel" data-action="exportDashboardData">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>
                                        Export Data
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                  </div>

                  <div class="settings-modal-footer">
                      <button type="button" class="settings-btn settings-btn-cancel" data-action="closeModal" data-param="settings-modal">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                          Cancel
                      </button>
                      <button type="submit" class="settings-btn settings-btn-save">
                          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                          Save Settings
                      </button>
                  </div>
              </form>
        </div>
    </div>

    <!-- Workspace Logo Crop Modal -->
    <div id="workspace-logo-crop-modal" class="modal">
        <div class="modal-content crop-modal-content">
            <div class="crop-modal-header">
                <h2 class="modal-title" id="crop-modal-title">Crop Image to Square</h2>
                <button type="button" class="modal-close settings-close" onclick="closeCropModal()" aria-label="Close crop modal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>

            <div class="crop-modal-body">
                <p class="crop-instructions">
                    Drag to adjust the crop area. The image will be cropped to a square.
                </p>

                <!-- Canvas container -->
                <div class="crop-canvas-container">
                    <canvas id="crop-canvas"></canvas>
                    <div id="crop-overlay" class="crop-overlay">
                        <div id="crop-selection" class="crop-selection">
                            <!-- Resize handles -->
                            <div class="crop-handle crop-handle-nw"></div>
                            <div class="crop-handle crop-handle-ne"></div>
                            <div class="crop-handle crop-handle-sw"></div>
                            <div class="crop-handle crop-handle-se"></div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="crop-modal-footer">
                <div class="crop-info" aria-live="polite">
                    <span id="crop-dimensions">0 √ó 0 px</span>
                    <span id="crop-size-estimate">~0 KB</span>
                </div>
                <div class="crop-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCropModal()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="applyCrop()">Crop & Apply</button>
                </div>
            </div>
        </div>
    </div>

    <script src="src/services/historyService.js"></script>
    <script src="auth.js"></script>
    <script type="module" src="app.js?v=20251210-fix"></script>

<div id="day-items-modal" class="day-items-modal" data-action="closeDayItemsModalOnBackdrop">
    <div class="day-items-content" data-action="stopPropagation">
        <div class="day-items-header">
            <div class="day-items-title" id="day-items-modal-title"></div>
            <button class="day-items-close" data-action="closeDayItemsModal">√ó</button>
        </div>
        <div id="day-items-modal-body"></div>
    </div>
</div>

</body>
</html>
