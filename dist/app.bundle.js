var Bc=Object.defineProperty;var $c=(e,t)=>()=>(e&&(t=e(e=0)),t);var Nc=(e,t)=>{for(var a in t)Bc(e,a,{get:t[a],enumerable:!0})};var Zr={};Nc(Zr,{generateWordReport:()=>ll});import{Document as Xc,Packer as Qc,Paragraph as Z,Table as Aa,TableCell as fe,TableRow as At,TextRun as ee,AlignmentType as le,WidthType as ge,BorderStyle as ie,HeadingLevel as da,ShadingType as St}from"https://esm.sh/docx@9.5.1";function wn(e){return e>=75?Re.success:e>=50?Re.primary:e>=25?Re.priority.medium:Re.priority.high}function tl(e,t){let a=new Set(t.filter(r=>r.status!=="done").map(r=>r.projectId).filter(r=>r!==null)),n=t.length,o=t.filter(r=>r.status==="done").length,s=n>0?Math.round(o/n*100):0;return{activeProjectsCount:a.size,totalTasks:n,completedTasks:o,completionPercent:s}}function Yr(e,t){let a=t.filter(l=>l.projectId===e.id),n=a.length,o=a.filter(l=>l.status==="done").length,s=n>0?Math.round(o/n*100):0,r=new Date().toISOString().split("T")[0],i=a.filter(l=>l.status!=="done"&&l.endDate&&l.endDate<r).length,c=a.filter(l=>!l.startDate||!l.endDate).length;return{totalTasks:n,completedTasks:o,completionPercent:s,overdueTasks:i,tasksWithoutDates:c,tasks:a}}function Jr(e){return(e.tags||[]).map(t=>t.toUpperCase())}function al(e){return(e.tags||[]).map(t=>t.toUpperCase())}function nl(e,t){let a=Jr(e),n=al(t),o=[...a,...n];for(let s of el)if(o.includes(s))return s;return null}function ol(e,t){if(!t)return null;let a=Jr(e),n=Kr[t];for(let o of n)if(a.includes(o))return o;return null}function sl(e,t){let a=t.filter(o=>o.projectId===e.id),n={};for(let o of a){let s=nl(o,e);if(!s)continue;n[s]||(n[s]={localities:{},otherTasks:[]});let r=ol(o,s);r?(n[s].localities[r]||(n[s].localities[r]=[]),n[s].localities[r].push(o)):n[s].otherTasks.push(o)}return n}function Do(e){return[...e].sort((t,a)=>!t.startDate&&!a.startDate?0:t.startDate?a.startDate?t.startDate!==a.startDate?t.startDate.localeCompare(a.startDate):!t.endDate&&!a.endDate?0:t.endDate?a.endDate?t.endDate.localeCompare(a.endDate):-1:1:-1:1)}function rl(){let t=new Date().toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"});return[new Z({children:[new ee({text:"REPORTE NAUTILUS",size:36,bold:!0})],heading:da.TITLE,alignment:le.CENTER,spacing:{after:150}}),new Z({children:[new ee({text:"Sistema de Gesti\xF3n de Investigaci\xF3n Marina",size:20,color:"6B7280"})],alignment:le.CENTER,spacing:{after:100}}),new Z({children:[new ee({text:t,size:18,color:"9CA3AF"})],alignment:le.CENTER,spacing:{after:300}}),new Z({text:"",border:{bottom:{color:"D1D5DB",space:1,style:ie.SINGLE,size:3}},spacing:{after:400}})]}function il(e,t){let a={done:t.filter(s=>s.status==="done").length,progress:t.filter(s=>s.status==="progress").length,review:t.filter(s=>s.status==="review").length,todo:t.filter(s=>s.status==="todo").length},n=new Aa({width:{size:100,type:ge.PERCENTAGE},borders:{top:{style:ie.NONE},bottom:{style:ie.NONE},left:{style:ie.NONE},right:{style:ie.NONE},insideHorizontal:{style:ie.NONE},insideVertical:{style:ie.SINGLE,size:1,color:"E5E7EB"}},rows:[new At({children:[new fe({children:[new Z({children:[new ee({text:"Proyectos Activos",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:200,after:100}}),new Z({children:[new ee({text:e.activeProjectsCount.toString(),size:48,bold:!0,color:Re.primary})],alignment:le.CENTER,spacing:{after:200}})],width:{size:33.33,type:ge.PERCENTAGE},shading:{fill:"FAFAFA",type:St.CLEAR}}),new fe({children:[new Z({children:[new ee({text:"Tareas Completadas",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:200,after:100}}),new Z({children:[new ee({text:`${e.completedTasks}/${e.totalTasks}`,size:48,bold:!0})],alignment:le.CENTER,spacing:{after:200}})],width:{size:33.33,type:ge.PERCENTAGE},shading:{fill:"FAFAFA",type:St.CLEAR}}),new fe({children:[new Z({children:[new ee({text:"Progreso Global",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:200,after:100}}),new Z({children:[new ee({text:`${e.completionPercent}%`,size:48,bold:!0,color:wn(e.completionPercent)})],alignment:le.CENTER,spacing:{after:200}})],width:{size:33.33,type:ge.PERCENTAGE},shading:{fill:"FAFAFA",type:St.CLEAR}})]})]}),o=new Aa({width:{size:100,type:ge.PERCENTAGE},alignment:le.CENTER,borders:{top:{style:ie.SINGLE,size:1,color:"E5E7EB"},bottom:{style:ie.SINGLE,size:1,color:"E5E7EB"},left:{style:ie.NONE},right:{style:ie.NONE},insideHorizontal:{style:ie.NONE},insideVertical:{style:ie.NONE}},rows:[new At({children:[new fe({children:[new Z({children:[new ee({text:"Por Hacer",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:150,after:50}}),new Z({children:[new ee({text:a.todo.toString(),size:32,bold:!0,color:"9CA3AF"})],alignment:le.CENTER,spacing:{after:150}})],width:{size:25,type:ge.PERCENTAGE}}),new fe({children:[new Z({children:[new ee({text:"En Progreso",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:150,after:50}}),new Z({children:[new ee({text:a.progress.toString(),size:32,bold:!0,color:Re.primary})],alignment:le.CENTER,spacing:{after:150}})],width:{size:25,type:ge.PERCENTAGE}}),new fe({children:[new Z({children:[new ee({text:"En Revisi\xF3n",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:150,after:50}}),new Z({children:[new ee({text:a.review.toString(),size:32,bold:!0,color:Re.priority.medium})],alignment:le.CENTER,spacing:{after:150}})],width:{size:25,type:ge.PERCENTAGE}}),new fe({children:[new Z({children:[new ee({text:"Completadas",size:18,color:"6B7280"})],alignment:le.CENTER,spacing:{before:150,after:50}}),new Z({children:[new ee({text:a.done.toString(),size:32,bold:!0,color:Re.success})],alignment:le.CENTER,spacing:{after:150}})],width:{size:25,type:ge.PERCENTAGE}})]})]});return[new Z({children:[new ee({text:"Resumen Global",size:32,bold:!0})],heading:da.HEADING_1,spacing:{before:200,after:300}}),n,new Z({text:"",spacing:{before:300,after:200}}),new Z({children:[new ee({text:"Distribuci\xF3n de Tareas",size:22,bold:!0})],spacing:{after:150}}),o,new Z({text:"",spacing:{after:400}})]}function To(e){let t=new At({tableHeader:!0,children:[new fe({children:[new Z({children:[new ee({text:"Tarea",bold:!0,size:20})],alignment:le.LEFT})],width:{size:35,type:ge.PERCENTAGE},shading:{type:St.CLEAR,fill:Re.headerBg}}),new fe({children:[new Z({children:[new ee({text:"Prioridad",bold:!0,size:20})],alignment:le.CENTER})],width:{size:13,type:ge.PERCENTAGE},shading:{type:St.CLEAR,fill:Re.headerBg}}),new fe({children:[new Z({children:[new ee({text:"Estado",bold:!0,size:20})],alignment:le.CENTER})],width:{size:17,type:ge.PERCENTAGE},shading:{type:St.CLEAR,fill:Re.headerBg}}),new fe({children:[new Z({children:[new ee({text:"Inicio",bold:!0,size:20})],alignment:le.CENTER})],width:{size:17,type:ge.PERCENTAGE},shading:{type:St.CLEAR,fill:Re.headerBg}}),new fe({children:[new Z({children:[new ee({text:"Fin",bold:!0,size:20})],alignment:le.CENTER})],width:{size:18,type:ge.PERCENTAGE},shading:{type:St.CLEAR,fill:Re.headerBg}})]}),a={low:"Baja",medium:"Media",high:"Alta"},n={todo:"Por Hacer",progress:"En Progreso",review:"En Revisi\xF3n",done:"Completada"},o=e.map(s=>{let r=Re.status[s.status]||"FFFFFF",i=Re.priority[s.priority]||"9CA3AF",c=Gr.priority[s.priority]||"",l=Gr.status[s.status]||"";return new At({children:[new fe({children:[new Z({text:s.title||"Sin t\xEDtulo",spacing:{before:100,after:100}})]}),new fe({children:[new Z({children:[new ee({text:`${c} `,color:i}),new ee({text:a[s.priority]||s.priority||"-"})],alignment:le.CENTER,spacing:{before:100,after:100}})]}),new fe({children:[new Z({children:[new ee({text:`${l} `}),new ee({text:n[s.status]||s.status||"-",strike:s.status==="done"})],alignment:le.CENTER,spacing:{before:100,after:100}})],shading:{type:St.CLEAR,fill:r}}),new fe({children:[new Z({text:s.startDate||"-",alignment:le.CENTER,spacing:{before:100,after:100}})]}),new fe({children:[new Z({text:s.endDate||"-",alignment:le.CENTER,spacing:{before:100,after:100}})]})]})});return new Aa({rows:[t,...o],width:{size:100,type:ge.PERCENTAGE},borders:{top:{style:ie.SINGLE,size:1},bottom:{style:ie.SINGLE,size:1},left:{style:ie.SINGLE,size:1},right:{style:ie.SINGLE,size:1},insideHorizontal:{style:ie.SINGLE,size:1},insideVertical:{style:ie.SINGLE,size:1}}})}function cl(e,t,a){let n=[];n.push(new Z({children:[new ee({text:e.name,size:28,bold:!0})],heading:da.HEADING_1,spacing:{before:600,after:200}}));let o=[`${t.completedTasks}/${t.totalTasks} tareas`,new ee({text:`${t.completionPercent}%`,bold:!0,color:wn(t.completionPercent)})],s=[];s.push(new At({children:[new fe({children:[new Z({children:[new ee({text:"\u{1F4CA} Progreso",size:16,color:"4B5563"})]})],width:{size:30,type:ge.PERCENTAGE},shading:{fill:"F9FAFB"}}),new fe({children:[new Z({children:[new ee({text:`${t.completionPercent}%`,size:18,bold:!0,color:wn(t.completionPercent)}),new ee({text:`  (${t.completedTasks}/${t.totalTasks} tareas)`,size:14,color:"6B7280"})]})],width:{size:70,type:ge.PERCENTAGE}})]})),t.overdueTasks>0&&s.push(new At({children:[new fe({children:[new Z({children:[new ee({text:"\u26A0\uFE0F Vencidas",size:16,color:"4B5563"})]})],width:{size:30,type:ge.PERCENTAGE},shading:{fill:"FEF2F2"}}),new fe({children:[new Z({children:[new ee({text:`${t.overdueTasks} tareas`,size:16,color:Re.priority.high})]})],width:{size:70,type:ge.PERCENTAGE}})]})),t.tasksWithoutDates>0&&s.push(new At({children:[new fe({children:[new Z({children:[new ee({text:"\u{1F4C5} Sin fechas",size:16,color:"4B5563"})]})],width:{size:30,type:ge.PERCENTAGE},shading:{fill:"FFFBEB"}}),new fe({children:[new Z({children:[new ee({text:`${t.tasksWithoutDates} tareas`,size:16,color:"6B7280"})]})],width:{size:70,type:ge.PERCENTAGE}})]}));let r=new Aa({width:{size:100,type:ge.PERCENTAGE},borders:{top:{style:ie.SINGLE,size:1,color:"E5E7EB"},bottom:{style:ie.SINGLE,size:1,color:"E5E7EB"},left:{style:ie.SINGLE,size:1,color:"E5E7EB"},right:{style:ie.SINGLE,size:1,color:"E5E7EB"},insideHorizontal:{style:ie.SINGLE,size:1,color:"E5E7EB"},insideVertical:{style:ie.SINGLE,size:1,color:"E5E7EB"}},rows:s});n.push(r),n.push(new Z({text:"",spacing:{after:200}}));let i=Do(t.tasks);i.length>0&&n.push(To(i));let c=sl(e,a);if(Object.keys(c).length>0){n.push(new Z({children:[new ee({text:"Desglose Geogr\xE1fico",size:26,bold:!0})],heading:da.HEADING_2,spacing:{before:400,after:300}}));for(let l of Object.keys(c).sort()){let p=c[l];n.push(new Z({children:[new ee({text:"\u{1F3DD}\uFE0F ",size:24}),new ee({text:l,size:24,bold:!0,color:Re.primary})],heading:da.HEADING_3,spacing:{before:350,after:200}}));let u=Object.keys(p.localities).sort();for(let f of u){let m=Do(p.localities[f]);n.push(new Z({children:[new ee({text:"\u{1F4CD} ",size:22}),new ee({text:f,size:22,bold:!0,italics:!1})],spacing:{before:250,after:150}})),n.push(To(m)),n.push(new Z({text:"",spacing:{after:250}}))}if(p.otherTasks.length>0){let f=Do(p.otherTasks);n.push(new Z({children:[new ee({text:"\u{1F4CD} ",size:22}),new ee({text:"Otras Ubicaciones",size:22,bold:!0,italics:!1})],spacing:{before:250,after:150}})),n.push(To(f)),n.push(new Z({text:"",spacing:{after:250}}))}}}return n}async function ll(e,t){try{let a=tl(e,t),n=[];n.push(...rl()),n.push(...il(a,t));let o=[...e].sort((f,m)=>f.name.localeCompare(m.name,"es",{sensitivity:"base"}));n.push(new Z({children:[new ee({text:"Proyectos",size:32,bold:!0})],heading:da.HEADING_1,spacing:{before:600,after:300}}));let s=o.map(f=>{let m=Yr(f,t);return new fe({children:[new Z({children:[new ee({text:f.name,size:16,bold:!0})],alignment:le.CENTER,spacing:{before:150,after:50}}),new Z({children:[new ee({text:`${m.completionPercent}%`,size:28,bold:!0,color:wn(m.completionPercent)})],alignment:le.CENTER,spacing:{after:50}}),new Z({children:[new ee({text:`${m.completedTasks}/${m.totalTasks} tareas`,size:14,color:"6B7280"})],alignment:le.CENTER,spacing:{after:150}})],width:{size:100/o.length,type:ge.PERCENTAGE}})}),r=new Aa({width:{size:100,type:ge.PERCENTAGE},borders:{top:{style:ie.SINGLE,size:1,color:"E5E7EB"},bottom:{style:ie.SINGLE,size:1,color:"E5E7EB"},left:{style:ie.NONE},right:{style:ie.NONE},insideHorizontal:{style:ie.NONE},insideVertical:{style:ie.SINGLE,size:1,color:"E5E7EB"}},rows:[new At({children:s})]});n.push(r),n.push(new Z({text:"",spacing:{after:400}}));for(let f of o){let m=Yr(f,t);n.push(...cl(f,m,t))}let i=new Xc({sections:[{properties:{},children:n}]}),c=await Qc.toBlob(i),l=URL.createObjectURL(c),p=`Reporte-Nautilus-${new Date().toISOString().split("T")[0]}.docx`,u=document.createElement("a");return u.href=l,u.download=p,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(l),{success:!0,filename:p,insights:a}}catch(a){return console.error("Error generating report:",a),{success:!1,error:a.message}}}var Kr,el,Re,Gr,Xr=$c(()=>{Kr={TENERIFE:["TAJAO","LOS CRISTIANOS","LAS TERESITAS","EL M\xC9DANO","SAN JUAN","BOCA CANGREJO"],"LA PALMA":["LOS CANCAJOS","LA BOMBILLA","R\xCDO MUERTO"],LANZAROTE:["\xD3RZOLA"],FUERTEVENTURA:["TONELES","JACOMAR","LOBOS","MORRO JABLE"]},el=Object.keys(Kr),Re={status:{todo:"E5E7EB",progress:"DBEAFE",review:"FEF3C7",done:"D1FAE5"},priorityBg:{low:"F3F4F6",medium:"FEF3C7",high:"FEE2E2"},priority:{low:"9CA3AF",medium:"F59E0B",high:"EF4444"},primary:"0284C7",secondary:"6366F1",success:"10B981",headerBg:"F3F4F6"},Gr={priority:{low:"\u25A0",medium:"\u25A0",high:"\u25A0"},status:{todo:"\u2B1C",progress:"\u{1F7E6}",review:"\u{1F7E8}",done:"\u2705"},sections:{project:"\u{1F4C1}",island:"\u{1F3DD}\uFE0F",locality:"\u{1F4CD}",summary:"\u{1F4CA}",tasks:"\u{1F4CB}",metrics:"\u{1F4C8}"},progress:{full:"\u{1F7E9}",high:"\u{1F7E8}",medium:"\u{1F7E7}",low:"\u{1F7E5}"}}});var co={en:"en-US",es:"es-ES"},on={en:{"boot.loading":"Loading Nautilus","lock.welcome":"Welcome back","lock.subtitle":"Enter the access password to continue.","lock.sessionHint":"? Session stays signed-in for 24 hours.","lock.passwordLabel":"Password","lock.passwordPlaceholder":"Enter password","lock.unlock":"Unlock","auth.backToUserLogin":"Back to User Login","auth.login.title":"Welcome to Nautilus","auth.login.subtitle":"Login to access your workspace","auth.login.identifierLabel":"Username or Email","auth.login.identifierPlaceholder":"Enter username or email","auth.login.pinLabel":"PIN (4 digits)","auth.admin.title":"Admin Access","auth.admin.subtitle":"Enter master PIN to access admin dashboard","auth.admin.pinLabel":"Master PIN (4 digits)","auth.setup.title":"Complete Your Setup","auth.setup.subtitle":"Personalize your account","auth.setup.usernameLabel":"Username","auth.setup.usernamePlaceholder":"e.g., alex","auth.setup.usernameHint":"3-20 characters, lowercase letters and numbers only","auth.setup.displayNameLabel":"Display Name","auth.setup.displayNamePlaceholder":"e.g., Alex Morgan","auth.setup.emailLabel":"Email","auth.setup.emailPlaceholder":"your.email@example.com","auth.setup.emailHint":"Required for notifications","auth.setup.newPinLabel":"New PIN (4 digits)","auth.setup.confirmPinLabel":"Confirm PIN","auth.setup.next":"Next","auth.setup.submit":"Complete Setup","admin.title":"User Management","admin.signOut":"Sign Out","admin.usersTitle":"Users","admin.createUserTitle":"Create New User","admin.usernameLabel":"Username","admin.usernamePlaceholder":"e.g., jdoe","admin.usernameHint":"3-20 characters, lowercase letters and numbers only","admin.displayNameLabel":"Display Name","admin.displayNamePlaceholder":"e.g., John Doe","admin.tempPinLabel":"Temporary PIN (4 digits)","admin.createUserButton":"Create User","auth.admin.resetPinPrompt":"Enter new temporary PIN for {userName}:","auth.admin.pinMustBe4Digits":"PIN must be exactly 4 digits","auth.admin.resetPinFailed":"Failed to reset PIN","auth.admin.resetPinSuccess":"PIN reset for {userName}. New temp PIN: {pin}","auth.admin.deleteUserConfirm":'Are you sure you want to delete user "{userName}"? This will also delete all their tasks and projects.',"auth.admin.deleteUserFailed":"Failed to delete user","auth.admin.deleteUserSuccess":'User "{userName}" deleted successfully',"common.cancel":"Cancel","common.delete":"Delete","common.continue":"Continue","common.gotIt":"Got it","common.close":"Close modal","common.done":"Done","common.nautilusLogoAlt":"Nautilus logo","common.devBanner":"\u26A0\uFE0F LOCAL DEV - NOT PRODUCTION \u26A0\uFE0F","common.datePlaceholder":"dd/mm/yyyy","crop.title":"Crop Image to Square","crop.instructions":"Drag to adjust the crop area. The image will be cropped to a square.","crop.apply":"Crop & Apply","crop.close":"Close crop modal","dashboard.insights.productivityTitle":"Productivity Trend","dashboard.insights.productivityDesc":"Task completion rate increased 23% compared to last month","dashboard.insights.deadlineTitle":"Deadline Alert","dashboard.insights.deadlineDesc":"3 milestones due within the next 7 days","projects.title":"Projects","projects.subtitle":"Manage your projects","projects.searchPlaceholder":"\u{1F50D} Search projects (title or description)","projects.filters.status":"Status","projects.filters.statusTitle":"Project Status","projects.status.planning":"PLANNING","projects.status.active":"ACTIVE","projects.status.completed":"COMPLETED","projects.filters.updated":"Updated","projects.filters.updatedTitle":"Recently Updated","projects.filters.all":"All","projects.filters.last5m":"Last 5 minutes","projects.filters.last30m":"Last 30 minutes","projects.filters.last24h":"Last 24 hours","projects.filters.lastWeek":"Last week","projects.filters.lastMonth":"Last month","projects.filters.hasTasks":"Has tasks","projects.filters.noTasks":"No tasks","projects.filters.tags":"Tags","projects.filters.tagsTitle":"Project Tags","projects.filters.clear":"Clear Filters","projects.noDescription":"No description","projects.tasksBreakdown":"{total} tasks \xB7 {done} done","tasks.card.description":"Description","projects.card.tasksCount":"{count} tasks","projects.card.percentDone":"{count}% done","projects.sort.label":"Sort: Status","projects.sort.status":"Status","projects.sort.name":"Name","projects.sort.newest":"Newest","projects.sort.lastUpdated":"Last Updated","projects.sort.mostTasks":"Most tasks","projects.sort.percentCompleted":"% Completed","projects.sort.prefix":"Sort: {label}","projects.sort.help":"Click the same option again to switch Asc/Desc.","projects.sort.statusLabel":"Status","projects.sort.nameLabel":"Name","projects.sort.newestLabel":"Newest","projects.sort.lastUpdatedLabel":"Last Updated","projects.sort.mostTasksLabel":"Most tasks","projects.sort.percentCompletedLabel":"% Completed","projects.newProjectButton":"+ New Project","projects.openDetailsTitle":"View project details","projects.empty.title":"No projects yet","projects.empty.subtitle":"Create your first project","projects.empty.searchTitle":"No projects found","projects.empty.searchSubtitle":"Create a new project to get started","projects.empty.filteredTitle":"No projects matched","projects.modal.createTitle":"Create New Project","projects.modal.nameLabel":"Project Name","projects.modal.descriptionLabel":"Description","projects.modal.startDateLabel":"Start Date","projects.modal.endDateLabel":"End Date","projects.modal.tagsLabel":"Tags","projects.modal.addTagPlaceholder":"Add tag","projects.modal.createButton":"Create Project","projects.delete.title":"Delete Project","projects.delete.body":"This action cannot be undone. To confirm deletion, type delete below:","projects.delete.deleteTasksLabel":"Delete all tasks in this project","projects.delete.deleteTasksHint":"If unchecked, tasks will be unassigned from the project","projects.delete.inputPlaceholder":"Type delete here","projects.delete.error":'Type "delete" exactly to confirm',"projects.duplicate.title":"Duplicate Project","projects.duplicate.description":"Create a copy of this project with all its settings.","projects.duplicate.includeTasksLabel":"Include all tasks from this project","projects.duplicate.taskNamingTitle":"Task naming:","projects.duplicate.namingNone":"Keep original names","projects.duplicate.namingPrefix":"Add prefix:","projects.duplicate.namingSuffix":"Add suffix:","projects.duplicate.prefixPlaceholder":"e.g., Copy - ","projects.duplicate.suffixPlaceholder":"e.g., (Copy)","projects.duplicate.confirm":"Duplicate Project","projects.duplicate.success":'Project "{name}" duplicated successfully',"projects.duplicate.successWithTasks":'Project "{name}" and its tasks duplicated successfully',"projects.statusInfo.title":"Project Status Logic","projects.statusInfo.subtitle":"Project status updates automatically based on task progress","projects.statusInfo.planningTitle":"? Planning","projects.statusInfo.planningDesc":'All tasks are in "Backlog" or "To Do" status',"projects.statusInfo.activeTitle":"\u2705 Active","projects.statusInfo.activeDesc":'At least one task is "In Progress" or "In Review"',"projects.statusInfo.completedTitle":"? Completed","projects.statusInfo.completedDesc":'All tasks are marked as "Done"',"projects.backTo.dashboard":"\u2190 Back to Dashboard","projects.backTo.calendar":"\u2190 Back to Calendar","projects.backTo.projects":"\u2190 Back to Projects","projects.details.tab.details":"Details","projects.details.tab.history":"History","projects.details.startDate":"Start Date","projects.details.endDate":"End Date","projects.details.duration":"Duration","projects.details.durationDays":"{count} days","projects.details.created":"Created","projects.details.calendarColor":"Calendar Color","projects.details.customColor":"Custom color","projects.details.progressOverview":"Progress Overview","projects.details.taskProgress":"Task Progress","projects.details.tasksTitle":"Tasks ({count})","projects.details.changeHistory":"Change History","projects.details.noChanges":"No changes yet for this project","projects.details.noTasksFound":"No tasks found","projects.details.viewTodo":"View To Do tasks for this project","projects.details.viewProgress":"View In Progress tasks for this project","projects.details.viewReview":"View In Review tasks for this project","projects.details.viewCompleted":"View Completed tasks for this project","projects.details.viewBacklog":"View backlog tasks in List view","projects.untitled":"Untitled Project","tasks.title":"All Tasks","tasks.subtitle":"Manage tasks across all projects","tasks.searchPlaceholder":"\u{1F50D} Search tasks (title or description)","tasks.filters.status":"Status","tasks.filters.statusTitle":"Status","tasks.status.backlog":"Backlog","tasks.status.todo":"To Do","tasks.status.progress":"In Progress","tasks.status.review":"In Review","tasks.status.done":"Done","tasks.filters.tags":"Tags","tasks.filters.tagsTitle":"Tags","tasks.filters.priority":"Priority","tasks.filters.priorityTitle":"Priority","tasks.priority.high":"High","tasks.priority.medium":"Medium","tasks.priority.low":"Low","tasks.filters.project":"Project","tasks.filters.projectTitle":"Project","tasks.filters.selectAll":"Select / Unselect All","tasks.filters.date":"Date","tasks.filters.endDate":"End Date","tasks.filters.startDate":"Start Date","tasks.filters.dateTitle":"Quick Date Filters","tasks.filters.endDateTitle":"End Date Filters","tasks.filters.noDate":"No End Date","tasks.filters.overdue":"Overdue","tasks.filters.endToday":"End Date Today","tasks.filters.endTomorrow":"End Date Tomorrow","tasks.filters.end7Days":"End Date in 7 Days","tasks.filters.endThisWeek":"End Date This Week","tasks.filters.endThisMonth":"End Date This Month","tasks.filters.startDateTitle":"Start Date Filters","tasks.filters.noStartDate":"No Start Date","tasks.filters.alreadyStarted":"Already Started","tasks.filters.startToday":"Start Date Today","tasks.filters.startTomorrow":"Start Date Tomorrow","tasks.filters.start7Days":"Start Date in 7 Days","tasks.filters.startThisWeek":"Start Date This Week","tasks.filters.startThisMonth":"Start Date This Month","tasks.filters.updated":"Updated","tasks.filters.updatedTitle":"Recently Updated","tasks.filters.dateFrom":"Start date","tasks.filters.dateTo":"End date","tasks.filters.clear":"Clear Filters","filters.noOtherProjects":"No other projects","filters.noTags":"No Tags","filters.noOtherTags":"No other tags","filters.sheet.title":"Options","filters.chip.search":"Search","filters.chip.project":"Project","filters.chip.tag":"Tag","filters.chip.date":"Date","filters.chip.updated":"Updated","filters.chip.removeAria":"Remove {label} filter","filters.dateRange.from":"From","filters.dateRange.until":"Until","filters.updated.week":"Week","filters.updated.month":"Month","tasks.kanban.tipLabel":"Tip:","tasks.kanban.tipTextBefore":"In the Kanban Board hold ","tasks.kanban.tipTextAfter":" (Cmd on Mac) and click to select multiple tasks. Shift-click selects a range, then drag to move them together","tasks.view.kanban":"Kanban","tasks.view.list":"List","tasks.view.calendar":"Calendar","tasks.sort.label":"Sort: Priority","tasks.sort.orderByPriority":"Order by Priority","tasks.kanban.showBacklog":"Show Backlog","tasks.kanban.showProjects":"Show Projects","tasks.kanban.showNoDate":'Show "No Date"',"tasks.addButton":"+ Add Task","tasks.noProject":"No Project","tasks.projectIndicatorNone":"No Project - ","tasks.project.selectPlaceholder":"Select a project","tasks.tags.none":"No tags","tasks.checklist.toggle":"Toggle checkbox","tasks.untitled":"Untitled task","tasks.startDatePrefix":"Start Date: ","tasks.endDatePrefix":"End Date: ","tasks.noDate":"No date","tasks.noDatesSet":"No dates set","tasks.noEndDate":"No End Date","tasks.due.yesterday":"Yesterday","tasks.due.daysOverdue":"{count} days overdue","tasks.due.tomorrow":"Tomorrow","tasks.openTaskDetails":"Open task details","tasks.noTasksInProject":"No tasks in this project","tasks.attachments.open":"Open","tasks.attachments.none":"No attachments","tasks.attachments.remove":"Remove attachment","tasks.attachments.removeTitle":"Remove","tasks.attachments.removeLink":"Remove link","tasks.attachments.googleDoc":"Google Doc","tasks.attachments.googleSheet":"Google Sheet","tasks.attachments.googleSlides":"Google Slides","tasks.attachments.googleDriveFile":"Google Drive File","tasks.attachments.pdf":"PDF Document","tasks.attachments.word":"Word Document","tasks.attachments.excel":"Excel File","tasks.attachments.powerpoint":"PowerPoint","tasks.empty.epic":"No tasks yet. Create your first task for this epic.","tasks.backlogQuickTitle":"Open Backlog tasks in List view","tasks.backlogQuickLabel":"Backlog","tasks.kanban.columnBacklog":"\u{1F9CA} Backlog","tasks.kanban.columnTodo":"\u{1F4CB} To Do","tasks.kanban.columnProgress":"\u{1F504} In Progress","tasks.kanban.columnReview":"\u2611\uFE0F In Review","tasks.kanban.columnDone":"\u2705 Done","tasks.table.task":"Task","tasks.table.priority":"Priority","tasks.table.status":"Status","tasks.table.tags":"Tags","tasks.table.project":"Project","tasks.table.startDate":"Start Date","tasks.table.endDate":"End Date","tasks.table.updated":"Updated","tasks.list.count":"{count} results","tasks.modal.editTitle":"Edit Task","tasks.modal.duplicate":"\u{1F4C4} Duplicate Task","tasks.modal.delete":"\u{1F5D1}\uFE0F Delete Task","tasks.modal.tab.general":"General","tasks.modal.tab.details":"Details","tasks.modal.tab.history":"History","tasks.modal.titleLabel":"Task Title","tasks.modal.attachmentsLabel":"Attachments","tasks.modal.attachmentsSupported":"Supported: Images (10MB), PDFs (20MB), Documents (10MB)","tasks.modal.attachmentsDropzoneDefault":"Drag & drop or click to attach file","tasks.modal.attachmentsDropzoneTap":"Click to attach file","tasks.modal.linksLabel":"Links","tasks.modal.attachmentNamePlaceholder":"Name (optional)","tasks.modal.attachmentUrlPlaceholder":"URL","tasks.modal.addLink":"Add Link","tasks.modal.statusLabel":"Status","tasks.modal.priorityLabel":"Priority","tasks.modal.tagsLabel":"Tags","tasks.modal.addTagPlaceholder":"Add tag","tasks.modal.projectLabel":"Project","tasks.modal.projectOpenTitle":"Open project details","tasks.modal.projectSelect":"Select a project","tasks.modal.submitCreate":"Create Task","tasks.modal.listBulleted":"\u2022 List","tasks.modal.listNumbered":"1. List","tasks.modal.insertDivider":"Insert horizontal divider","tasks.modal.insertCheckbox":"Insert checkbox","tasks.history.emptyTitle":"No Changes Yet","tasks.history.emptySubtitle":"Changes to this task will appear here","calendar.title":"Calendar","calendar.today":"Today","calendar.prevMonth":"Previous month","calendar.nextMonth":"Next month","calendar.dayItemsTitle":"Items for {date}","calendar.dayItemsProjects":"Projects","calendar.dayItemsTasks":"Tasks","calendar.dayItems.close":"Close day items","calendar.dayItems.addTask":"+ Add Task","feedback.title":"Feedback & Issues","feedback.subtitle":"Report bugs and suggest features","feedback.saveStatus.saved":"Saved","feedback.saveStatus.saving":"Saving...","feedback.saveStatus.error":"Save failed","feedback.saveStatus.offline":"Offline","feedback.type.bugLabel":"\u{1F41E} Bug","feedback.type.title":"Feedback Type","feedback.type.bugOption":"\u{1F41E} Bug","feedback.type.improvementOption":"\u{1F4A1} Improvement","feedback.descriptionPlaceholder":"Describe the issue or idea. You can paste an image directly into this field.","feedback.descriptionPlaceholderShort":"Describe the issue or idea.","feedback.screenshotAttachTitle":"Attach screenshot from device","feedback.screenshotDropzoneTap":"\u{1F4F7} Tap to attach screenshot","feedback.screenshotDropzoneDefault":"\u{1F4F7} Drag & drop or click to attach screenshot","feedback.screenshotPreviewTitle":"Screenshot attached","feedback.screenshotPreviewSubtitle":"Will be saved with this feedback","feedback.screenshotRemove":"Remove","feedback.screenshotPreviewAlt":"Feedback screenshot preview","feedback.viewScreenshotTitle":"View screenshot","feedback.pagination.first":"First page","feedback.pagination.prev":"Previous page","feedback.pagination.next":"Next page","feedback.pagination.last":"Last page","feedback.pagination.showing":"Showing {start}-{end} of {total}","feedback.pagination.pageOf":"Page {current} of {total}","feedback.addButton":"Add","feedback.pendingTitle":"? Pending","feedback.doneTitle":"? Done","feedback.delete.title":"Delete Feedback","feedback.delete.body":"Are you sure you want to delete this feedback?","feedback.empty.pending":"No pending feedback","feedback.empty.done":"No completed feedback","export.title":"Export Data","export.body":"This will download a complete backup of all your tasks, projects, and settings as a JSON file. Are you sure you want to export your data?","export.confirm":"Export","confirm.deleteTask.title":"Delete Task","confirm.deleteTask.body":"This action cannot be undone. To confirm deletion, type delete below:","confirm.deleteTask.inputPlaceholder":"Type delete here","confirm.deleteTask.error":'Type "delete" exactly to confirm',"confirm.unsaved.title":"Unsaved Changes","confirm.unsaved.body":"You have unsaved changes. Are you sure you want to close and lose them?","confirm.unsaved.discard":"Discard Changes","confirm.review.title":'Disable "In Review" Status',"error.saveDataFailed":"Failed to save data. Please try again.","error.saveProjectsFailed":"Failed to save projects. Please try again.","error.saveTasksFailed":"Failed to save tasks. Please try again.","error.saveFeedbackFailed":"Failed to save feedback. Please try again.","error.saveProjectColorsFailed":"Failed to save project colors.","error.saveTaskFailed":"Failed to save task. Please try again.","error.saveChangesFailed":"Failed to save changes. Please try again.","error.saveTaskPositionFailed":"Failed to save task position. Please try again.","error.saveProjectFailed":"Failed to save project. Please try again.","error.notLoggedInResetPin":"You must be logged in to reset your PIN","error.resetPinFailed":"Failed to reset PIN","success.resetPin":"PIN reset successfully! You will need to re-login with your new PIN.","error.resetPinError":"An error occurred while resetting your PIN","error.userNameEmpty":"User name cannot be empty.","error.saveDisplayNameFailed":"Could not save display name. Please try again.","error.invalidEmail":"Please enter a valid email address.","error.saveEmailFailed":"Could not save email. Please try again.","error.saveAvatarFailed":"Could not save avatar. Please try again.","success.settingsSaved":"Settings saved successfully!","error.logoSelectFile":"Please select an image file for the workspace logo.","error.logoTooLarge":"Please use an image smaller than 2MB for the workspace logo.","error.imageReadFailed":"Could not read the selected image.","error.imageLoadFailed":"Could not load the selected image.","error.logoUploadFailed":"Error uploading logo: {message}","error.cropInvalid":"Error: Crop state is invalid.","error.cropTooLarge":"Cropped image is too large. Please select a smaller area or use a smaller source image.","success.cropApplied":"Image cropped and applied successfully!","success.logoCroppedApplied":"Workspace logo cropped and applied successfully!","error.cropFailed":"Error cropping image: {message}","error.avatarSelectFile":"Please select an image file for your avatar.","error.avatarTooLarge":"Please use an image smaller than 2MB for your avatar.","error.avatarUploadFailed":"Failed to upload avatar. Please try again.","error.endDateBeforeStart":"End date cannot be before start date","error.startDateAfterEnd":"Start date cannot be after end date","error.feedbackAttachImage":"Please attach an image file.","error.feedbackReadImage":"Could not read the image file. Please try again.","error.feedbackStatusFailed":"Failed to update feedback status. Please try again.","error.attachmentSaveFailed":"Failed to save attachment. Please try again.","error.attachmentLoadFailed":"Failed to load image: {message}","success.fileDownloaded":"File downloaded!","error.fileDownloadFailed":"Failed to download file: {message}","success.attachmentDeletedFromStorage":"{name} deleted from storage","error.fileDeleteFailed":"Failed to delete file from storage","success.attachmentRemoved":"Attachment removed","error.fileSizeTooLarge":"File size must be less than {maxMB}MB. Please choose a smaller file.","success.fileUploaded":"File uploaded successfully!","error.fileUploadFailed":"Error uploading file: {message}","error.selectFile":"Please select a file","error.saveTagFailed":"Failed to save tag. Please try again.","error.removeTagFailed":"Failed to remove tag. Please try again.","error.openScreenshotFailed":"Could not open screenshot","history.sort.newest":"\u2191 Newest First","history.sort.oldest":"\u2193 Oldest First","history.field.title":"Title","history.field.name":"Name","history.field.description":"Description","history.field.status":"Status","history.field.priority":"Priority","history.field.category":"Category","history.field.startDate":"Start Date","history.field.endDate":"End Date","history.field.link":"Link","history.field.task":"Link","history.field.projectId":"Project","history.field.tags":"Tags","history.field.attachments":"Attachments","history.action.created":"Created","history.action.deleted":"Deleted","history.link.added":"Added","history.link.removed":"Removed","history.entity.task":"task","history.value.empty":"empty","history.value.none":"none","history.change.beforeLabel":"Before:","history.change.afterLabel":"After:","history.change.notSet":"Not set","history.change.removed":"Removed","history.tags.none":"No tags","history.attachments.none":"No attachments","history.attachments.countSingle":"{count} file","history.attachments.countPlural":"{count} files","history.project.fallback":"Project #{id}","history.change.arrow":"\u2192","menu.openMenu":"Open menu","menu.language":"Language","menu.darkMode":"Dark mode","menu.lightMode":"Light mode","menu.settings":"Settings","menu.help":"Help","menu.signOut":"Sign out","nav.overview":"Overview","nav.dashboard":"Dashboard","nav.updates":"Release notes","nav.calendar":"Calendar","nav.work":"Work","nav.projects":"Projects","nav.allTasks":"All Tasks","nav.feedback":"Feedback","updates.title":"Release notes","updates.subtitle":"Latest change log for Nautilus","updates.latestLabel":"Latest release","updates.historyLabel":"Release log","updates.sections.new":"New","updates.sections.improvements":"Improvements","updates.sections.fixes":"Fixes","updates.empty":"No release notes yet.","updates.sectionEmpty":"Nothing listed yet.","updates.historyEmpty":"No previous releases yet.","notifications.title":"Notifications","notifications.toggle":"Notifications","notifications.today":"Today","notifications.yesterday":"Yesterday","notifications.clearAll":"Clear all","notifications.releaseTitle":"New release","notifications.releaseCta":"View updates","notifications.releaseMeta":"Released {date}","notifications.dueTodayTitle":"Due today","notifications.dueTodayCta":"View tasks","notifications.dueTodayMetaOne":"{count} task due today","notifications.dueTodayMetaMany":"{count} tasks due today","notifications.dueTodayMore":"and {count} more tasks","notifications.empty":"You are all caught up.","settings.title":"Settings","settings.subtitle":"Manage your preferences and application settings","settings.section.profile":"Profile","settings.displayName":"Display Name","settings.displayNameHint":"This name is displayed throughout the application","settings.placeholder.displayName":"Enter your display name","settings.email":"Email","settings.emailHint":"Used for your account and deadline notifications","settings.placeholder.email":"Enter your email","settings.avatar":"Avatar","settings.avatarHint":"Upload an image for your avatar (max 2MB). It will be displayed as a circle.","settings.avatarRemoveTitle":"Remove avatar","settings.workspaceLogo":"Workspace Logo","settings.workspaceLogoHint":"Upload a square image to replace the Nautilus logo (max 2MB).","settings.workspaceLogoRemoveTitle":"Remove custom logo","settings.section.application":"Application","settings.enableReviewStatus":"Enable In Review status","settings.enableReviewStatusHint":"Show or hide the IN REVIEW status column and filter option","settings.enableReviewStatusHintPrefix":"Show or hide the","settings.enableReviewStatusHintSuffix":"status column and filter option","settings.calendarIncludeBacklog":"Show backlog in calendar","settings.calendarIncludeBacklogHint":"Display backlog tasks in all calendar views","settings.autoStartDate":"Auto-set start date","settings.autoStartDateHint":'Automatically set Start Date when task status changes to "In Progress" (if empty)',"settings.autoEndDate":"Auto-set end date","settings.autoEndDateHint":'Automatically set End Date when task status changes to "Done" (if empty)',"settings.debugLogs":"Enable debug logs","settings.debugLogsHint":"Capture diagnostic logs in the browser console when enabled","settings.historySortOrder":"History Sort Order","settings.historySortOrderHint":"Default sort order for task and project history timelines","settings.historySortNewest":"Newest First","settings.historySortOldest":"Oldest First","settings.language":"Language","settings.languageHint":"Choose the application language","settings.section.notifications":"Notifications","settings.emailNotifications":"Email notifications","settings.emailNotificationsHint":"Enable or disable deadline reminder emails","settings.weekdaysOnly":"Weekdays only","settings.weekdaysOnlyHint":"Skip emails on Saturday and Sunday","settings.includeStartDates":"Notify when tasks start","settings.includeStartDatesHint":"Send reminders when a task starts (e.g., today)","settings.includeBacklog":"Include backlog tasks","settings.includeBacklogHint":"Include backlog tasks in email and in-app notifications","settings.sendTime":"Send time","settings.sendTimeHint":"Daily time to send reminders (08:00-18:00, 30-minute increments)","settings.timeZone":"Time zone","settings.timeZoneHint":"Keeps the same local time year-round (DST-aware)","settings.timeZone.option.argentina":"Argentina (Buenos Aires)","settings.timeZone.option.canary":"Canary Islands (Atlantic/Canary)","settings.timeZone.option.spain":"Spain mainland (Europe/Madrid)","settings.timeZone.option.utc":"UTC","settings.section.security":"Security","settings.pinManagement":"PIN Management","settings.pinManagementHint":"Reset your PIN to a new 4-digit code","settings.resetPinButton":"Reset PIN","settings.section.dataManagement":"Data Management","settings.exportData":"Export Data","settings.exportDataHint":"Download a complete backup of all your tasks, projects, and settings as a JSON file","settings.exportButton":"Export","settings.cancelButton":"Cancel","settings.saveButton":"Save Settings","settings.avatarUploadDefault":"Drag & drop or click to upload avatar","settings.avatarUploadChange":"Change avatar","settings.avatarUploadAriaUpload":"Upload avatar","settings.avatarUploadAriaChange":"Change avatar","settings.logoUploadDefault":"Drag & drop or click to upload logo","settings.logoUploadChange":"Change logo","settings.logoUploadAriaUpload":"Upload logo","settings.logoUploadAriaChange":"Change logo","dashboard.title":"Dashboard","dashboard.hero.activeProjectsLabel":"Active Projects","dashboard.hero.completionRateLabel":"Completion Rate","dashboard.hero.projectsTrend":"\u{1F4C8} +2 this month","dashboard.hero.completionTrend":"\u{1F3AF} Target: 80%","dashboard.projectAnalytics":"\u{1F4CA} Project Analytics","dashboard.period.week":"Week","dashboard.period.month":"Month","dashboard.period.quarter":"Quarter","dashboard.stat.pendingTasks":"Pending Tasks","dashboard.stat.inProgress":"In Progress","dashboard.stat.highPriority":"High Priority","dashboard.stat.overdue":"Overdue","dashboard.stat.completed":"Completed","dashboard.stat.projects":"Projects","dashboard.highPriorityHint":"High priority tasks due within 7 days (or overdue)","dashboard.projectProgress":"\u{1F30A} Project Progress","dashboard.legend.todo":"To Do","dashboard.legend.progress":"In Progress","dashboard.legend.review":"In Review","dashboard.legend.complete":"Complete","dashboard.viewAll":"View All","dashboard.quickActions":"\u26A1 Quick Actions","dashboard.action.generateReport":"Generate Report","dashboard.action.addTask":"Add Task","dashboard.action.viewCalendar":"View Calendar","dashboard.action.newProject":"New Project","dashboard.recentActivity":"\u{1F504} Recent Activity","dashboard.researchInsights":"\u{1F9E0} Insights","dashboard.activity.emptyTitle":"Welcome to your Dashboard!","dashboard.activity.emptySubtitle":"Start creating projects and tasks to see activity","dashboard.activity.completed":'Completed "{title}" {projectPart}',"dashboard.activity.createdProject":'Created new project "{project}"',"dashboard.activity.addedTask":'Added new task "{title}" {projectPart}',"dashboard.activity.inProject":"in {project}","dashboard.activity.toProject":"to {project}","dashboard.activity.recently":"Recently","dashboard.activity.justNow":"Just now","dashboard.activity.today":"Today","dashboard.activity.yesterday":"Yesterday","dashboard.activity.daysAgoShort":"{count}d ago","dashboard.activity.minuteAgo":"{count} minute ago","dashboard.activity.minutesAgo":"{count} minutes ago","dashboard.activity.hourAgo":"{count} hour ago","dashboard.activity.hoursAgo":"{count} hours ago","dashboard.activity.dayAgo":"{count} day ago","dashboard.activity.daysAgo":"{count} days ago","dashboard.trend.thisWeek":"this week","dashboard.trend.thisMonth":"this month","dashboard.trend.thisQuarter":"this quarter","dashboard.trend.dueTodayOne":"{count} due today","dashboard.trend.dueTodayMany":"{count} due today","dashboard.trend.onTrack":"On track","dashboard.trend.needsAttention":"Needs attention","dashboard.trend.allOnTrack":"All on track","dashboard.trend.criticalOne":"{count} critical","dashboard.trend.criticalMany":"{count} critical","dashboard.trend.completedOne":"{count} completed","dashboard.trend.completedMany":"{count} completed","dashboard.trend.inProgress":"In progress","dashboard.emptyProjects.title":"No projects yet","dashboard.emptyProjects.subtitle":"Create your first project to see progress visualization","dashboard.tasks":"tasks","dashboard.activity.allTitle":"All Recent Activity","dashboard.activity.allSubtitle":"Full history of your recent work","dashboard.activity.backToDashboard":"\u2190 Back to Dashboard","dashboard.insights.excellentTitle":"Excellent Progress","dashboard.insights.excellentDesc":"{percent}% completion rate exceeds target. Great momentum!","dashboard.insights.goodTitle":"Good Progress","dashboard.insights.goodDesc":"{percent}% completion rate is solid. Consider pushing to reach 80% target.","dashboard.insights.opportunityTitle":"Progress Opportunity","dashboard.insights.opportunityDesc":"{percent}% completion rate. Focus on completing current tasks to build momentum.","dashboard.insights.actionTitle":"Action Needed","dashboard.insights.actionDesc":"{percent}% completion rate is low. Break down large tasks and tackle smaller ones first.","dashboard.insights.todayTitle":"Today's Focus","dashboard.insights.todayDescOne":"{count} task is due today. Prioritize it for maximum impact.","dashboard.insights.todayDescMany":"{count} tasks are due today. Prioritize them for maximum impact.","dashboard.insights.overdueTitle":"Overdue Items","dashboard.insights.overdueDescOne":"{count} overdue task needs attention. Address it to prevent delays.","dashboard.insights.overdueDescMany":"{count} overdue tasks need attention. Address these to prevent delays.","dashboard.insights.highPriorityTitle":"High Priority Focus","dashboard.insights.highPriorityDescOne":"{count} high-priority task needs immediate attention.","dashboard.insights.highPriorityDescMany":"{count} high-priority tasks need immediate attention.","dashboard.insights.emptyProjectsTitle":"Empty Projects","dashboard.insights.emptyProjectsDescOne":"{count} project has no tasks yet. Add tasks to track progress.","dashboard.insights.emptyProjectsDescMany":"{count} projects have no tasks yet. Add tasks to track progress.","dashboard.insights.momentumTitle":"Strong Momentum","dashboard.insights.momentumDescOne":"{count} task completed this week. You're in a productive flow!","dashboard.insights.momentumDescMany":"{count} tasks completed this week. You're in a productive flow!","dashboard.insights.readyTitle":"Ready to Start","dashboard.insights.readyDesc":"Create your first project and add some tasks to begin tracking your progress.","dashboard.insights.caughtUpTitle":"All Caught Up","dashboard.insights.caughtUpDesc":"Great work! No urgent items detected. Consider planning your next milestones."},es:{"boot.loading":"Cargando Nautilus","lock.welcome":"Bienvenido de nuevo","lock.subtitle":"Ingresa la contrase\xF1a de acceso para continuar.","lock.sessionHint":"? La sesi\xF3n permanece iniciada por 24 horas.","lock.passwordLabel":"Contrase\xF1a","lock.passwordPlaceholder":"Ingresa la contrase\xF1a","lock.unlock":"Desbloquear","auth.backToUserLogin":"Volver al inicio de sesi\xF3n","auth.login.title":"Bienvenido a Nautilus","auth.login.subtitle":"Inicia sesi\xF3n para acceder a tu espacio","auth.login.identifierLabel":"Usuario o correo","auth.login.identifierPlaceholder":"Ingresa usuario o correo","auth.login.pinLabel":"PIN (4 d\xEDgitos)","auth.admin.title":"Acceso de administraci\xF3n","auth.admin.subtitle":"Ingresa el PIN maestro para acceder al panel de administraci\xF3n","auth.admin.pinLabel":"PIN maestro (4 d\xEDgitos)","auth.setup.title":"Completa tu configuraci\xF3n","auth.setup.subtitle":"Personaliza tu cuenta","auth.setup.usernameLabel":"Usuario","auth.setup.usernamePlaceholder":"p. ej., alex","auth.setup.usernameHint":"3-20 caracteres, solo letras min\xFAsculas y n\xFAmeros","auth.setup.displayNameLabel":"Nombre visible","auth.setup.displayNamePlaceholder":"p. ej., Alex Morgan","auth.setup.emailLabel":"Correo electr\xF3nico","auth.setup.emailPlaceholder":"tu.correo@ejemplo.com","auth.setup.emailHint":"Necesario para notificaciones","auth.setup.newPinLabel":"Nuevo PIN (4 d\xEDgitos)","auth.setup.confirmPinLabel":"Confirmar PIN","auth.setup.next":"Siguiente","auth.setup.submit":"Completar configuraci\xF3n","admin.title":"Gesti\xF3n de usuarios","admin.signOut":"Cerrar sesi\xF3n","admin.usersTitle":"Usuarios","admin.createUserTitle":"Crear nuevo usuario","admin.usernameLabel":"Usuario","admin.usernamePlaceholder":"p. ej., jdoe","admin.usernameHint":"3-20 caracteres, solo letras min\xFAsculas y n\xFAmeros","admin.displayNameLabel":"Nombre visible","admin.displayNamePlaceholder":"p. ej., John Doe","admin.tempPinLabel":"PIN temporal (4 d\xEDgitos)","admin.createUserButton":"Crear usuario","auth.admin.resetPinPrompt":"Ingresa un nuevo PIN temporal para {userName}:","auth.admin.pinMustBe4Digits":"El PIN debe tener exactamente 4 d\xEDgitos","auth.admin.resetPinFailed":"No se pudo restablecer el PIN","auth.admin.resetPinSuccess":"PIN restablecido para {userName}. Nuevo PIN temporal: {pin}","auth.admin.deleteUserConfirm":'\xBFSeguro que deseas eliminar al usuario "{userName}"? Esto tambi\xE9n eliminar\xE1 todas sus tareas y proyectos.',"auth.admin.deleteUserFailed":"No se pudo eliminar el usuario","auth.admin.deleteUserSuccess":'Usuario "{userName}" eliminado correctamente',"common.cancel":"Cancelar","common.delete":"Eliminar","common.continue":"Continuar","common.gotIt":"Entendido","common.close":"Cerrar modal","common.done":"Listo","common.nautilusLogoAlt":"Logo de Nautilus","common.devBanner":"\u26A0\uFE0F DESARROLLO LOCAL - NO PRODUCCI\xD3N \u26A0\uFE0F","common.datePlaceholder":"dd/mm/yyyy","crop.title":"Recortar imagen a cuadrado","crop.instructions":"Arrastra para ajustar el \xE1rea de recorte. La imagen se recortar\xE1 a un cuadrado.","crop.apply":"Recortar y aplicar","crop.close":"Cerrar recorte","dashboard.insights.productivityTitle":"Tendencia de productividad","dashboard.insights.productivityDesc":"La tasa de finalizaci\xF3n de tareas aument\xF3 un 23% respecto al mes pasado","dashboard.insights.deadlineTitle":"Alerta de plazos","dashboard.insights.deadlineDesc":"3 hitos vencen en los pr\xF3ximos 7 d\xEDas","projects.title":"Proyectos","projects.subtitle":"Gestiona tus proyectos","projects.searchPlaceholder":"\u{1F50D} Buscar proyectos (t\xEDtulo o descripci\xF3n)","projects.filters.status":"Estado","projects.filters.statusTitle":"Estado del proyecto","projects.status.planning":"PLANIFICACI\xD3N","projects.status.active":"ACTIVO","projects.status.completed":"COMPLETADO","projects.filters.updated":"Actualizado","projects.filters.updatedTitle":"Actualizados recientemente","projects.filters.all":"Todos","projects.filters.last5m":"\xDAltimos 5 minutos","projects.filters.last30m":"\xDAltimos 30 minutos","projects.filters.last24h":"\xDAltimas 24 horas","projects.filters.lastWeek":"\xDAltima semana","projects.filters.lastMonth":"\xDAltimo mes","projects.filters.hasTasks":"Con tareas","projects.filters.noTasks":"Sin tareas","projects.filters.tags":"Etiquetas","projects.filters.tagsTitle":"Etiquetas de proyectos","projects.filters.clear":"Limpiar filtros","projects.noDescription":"Sin descripcion","projects.tasksBreakdown":"{total} tareas \xB7 {done} hechas","tasks.card.description":"Descripcion","projects.card.tasksCount":"{count} tareas","projects.card.percentDone":"{count}% hecho","projects.sort.label":"Ordenar: Estado","projects.sort.status":"Estado","projects.sort.name":"Nombre","projects.sort.newest":"M\xE1s reciente","projects.sort.lastUpdated":"\xDAltima actualizaci\xF3n","projects.sort.mostTasks":"M\xE1s tareas","projects.sort.percentCompleted":"% completado","projects.sort.prefix":"Ordenar: {label}","projects.sort.help":"Repite la misma opci\xF3n para alternar Asc/Desc.","projects.sort.statusLabel":"Estado","projects.sort.nameLabel":"Nombre","projects.sort.newestLabel":"M\xE1s reciente","projects.sort.lastUpdatedLabel":"\xDAltima actualizaci\xF3n","projects.sort.mostTasksLabel":"M\xE1s tareas","projects.sort.percentCompletedLabel":"% completado","projects.newProjectButton":"+ Nuevo proyecto","projects.openDetailsTitle":"Ver detalles del proyecto","projects.empty.title":"A\xFAn no hay proyectos","projects.empty.subtitle":"Crea tu primer proyecto","projects.empty.searchTitle":"No se encontraron proyectos","projects.empty.searchSubtitle":"Crea un nuevo proyecto para empezar","projects.empty.filteredTitle":"No hubo coincidencias de proyectos","projects.modal.createTitle":"Crear nuevo proyecto","projects.modal.nameLabel":"Nombre del proyecto","projects.modal.descriptionLabel":"Descripci\xF3n","projects.modal.startDateLabel":"Fecha de inicio","projects.modal.endDateLabel":"Fecha de fin","projects.modal.tagsLabel":"Etiquetas","projects.modal.addTagPlaceholder":"A\xF1adir etiqueta","projects.modal.createButton":"Crear proyecto","projects.delete.title":"Eliminar proyecto","projects.delete.body":"Esta acci\xF3n no se puede deshacer. Para confirmar, escribe delete abajo:","projects.delete.deleteTasksLabel":"Eliminar todas las tareas de este proyecto","projects.delete.deleteTasksHint":"Si no se marca, las tareas se desasignar\xE1n del proyecto","projects.delete.inputPlaceholder":"Escribe delete aqu\xED","projects.delete.error":'Escribe "delete" exactamente para confirmar',"projects.duplicate.title":"Duplicar proyecto","projects.duplicate.description":"Crear una copia de este proyecto con toda su configuraci\xF3n.","projects.duplicate.includeTasksLabel":"Incluir todas las tareas de este proyecto","projects.duplicate.taskNamingTitle":"Nomenclatura de tareas:","projects.duplicate.namingNone":"Mantener nombres originales","projects.duplicate.namingPrefix":"Agregar prefijo:","projects.duplicate.namingSuffix":"Agregar sufijo:","projects.duplicate.prefixPlaceholder":"ej., Copia - ","projects.duplicate.suffixPlaceholder":"ej., (Copia)","projects.duplicate.confirm":"Duplicar proyecto","projects.duplicate.success":'Proyecto "{name}" duplicado exitosamente',"projects.duplicate.successWithTasks":'Proyecto "{name}" y sus tareas duplicados exitosamente',"projects.statusInfo.title":"L\xF3gica del estado del proyecto","projects.statusInfo.subtitle":"El estado del proyecto se actualiza autom\xE1ticamente seg\xFAn el progreso de las tareas","projects.statusInfo.planningTitle":"? Planificaci\xF3n","projects.statusInfo.planningDesc":'Todas las tareas est\xE1n en "Backlog" o "Por hacer"',"projects.statusInfo.activeTitle":"\u2705 Activo","projects.statusInfo.activeDesc":'Al menos una tarea est\xE1 en "En progreso" o "En revisi\xF3n"',"projects.statusInfo.completedTitle":"? Completado","projects.statusInfo.completedDesc":'Todas las tareas est\xE1n marcadas como "Hecho"',"projects.backTo.dashboard":"\u2190 Volver al panel","projects.backTo.calendar":"\u2190 Volver al calendario","projects.backTo.projects":"\u2190 Volver a proyectos","projects.details.tab.details":"Detalles","projects.details.tab.history":"Historial","projects.details.startDate":"Fecha de inicio","projects.details.endDate":"Fecha de fin","projects.details.duration":"Duraci\xF3n","projects.details.durationDays":"{count} d\xEDas","projects.details.created":"Creado","projects.details.calendarColor":"Color del calendario","projects.details.customColor":"Color personalizado","projects.details.progressOverview":"Resumen de progreso","projects.details.taskProgress":"Progreso de tareas","projects.details.tasksTitle":"Tareas ({count})","projects.details.changeHistory":"Historial de cambios","projects.details.noChanges":"A\xFAn no hay cambios para este proyecto","projects.details.noTasksFound":"No se encontraron tareas","projects.details.viewTodo":"Ver tareas Por hacer de este proyecto","projects.details.viewProgress":"Ver tareas En progreso de este proyecto","projects.details.viewReview":"Ver tareas En revisi\xF3n de este proyecto","projects.details.viewCompleted":"Ver tareas Completadas de este proyecto","projects.details.viewBacklog":"Ver tareas de backlog en vista de lista","projects.untitled":"Proyecto sin t\xEDtulo","tasks.title":"Todas las tareas","tasks.subtitle":"Gestiona tareas de todos los proyectos","tasks.searchPlaceholder":"\u{1F50D} Buscar tareas (t\xEDtulo o descripci\xF3n)","tasks.filters.status":"Estado","tasks.filters.statusTitle":"Estado","tasks.status.backlog":"Backlog","tasks.status.todo":"Por hacer","tasks.status.progress":"En progreso","tasks.status.review":"En revisi\xF3n","tasks.status.done":"Hecho","tasks.filters.tags":"Etiquetas","tasks.filters.tagsTitle":"Etiquetas","tasks.filters.priority":"Prioridad","tasks.filters.priorityTitle":"Prioridad","tasks.priority.high":"Alta","tasks.priority.medium":"Media","tasks.priority.low":"Baja","tasks.filters.project":"Proyecto","tasks.filters.projectTitle":"Proyecto","tasks.filters.selectAll":"Seleccionar / deseleccionar todo","tasks.filters.date":"Fecha","tasks.filters.endDate":"Fecha de Fin","tasks.filters.startDate":"Fecha de Inicio","tasks.filters.dateTitle":"Filtros r\xE1pidos por fecha","tasks.filters.endDateTitle":"Filtros de Fecha de Fin","tasks.filters.noDate":"Sin fecha de fin","tasks.filters.overdue":"Vencidas","tasks.filters.endToday":"Fecha de fin hoy","tasks.filters.endTomorrow":"Fecha de fin ma\xF1ana","tasks.filters.end7Days":"Fecha de fin en 7 d\xEDas","tasks.filters.endThisWeek":"Fecha de fin esta semana","tasks.filters.endThisMonth":"Fecha de fin este mes","tasks.filters.startDateTitle":"Filtros de Fecha de Inicio","tasks.filters.noStartDate":"Sin fecha de inicio","tasks.filters.alreadyStarted":"Ya comenz\xF3","tasks.filters.startToday":"Fecha de inicio hoy","tasks.filters.startTomorrow":"Fecha de inicio ma\xF1ana","tasks.filters.start7Days":"Fecha de inicio en 7 d\xEDas","tasks.filters.startThisWeek":"Fecha de inicio esta semana","tasks.filters.startThisMonth":"Fecha de inicio este mes","tasks.filters.updated":"Actualizado","tasks.filters.updatedTitle":"Actualizados recientemente","tasks.filters.dateFrom":"Fecha de inicio","tasks.filters.dateTo":"Fecha de fin","tasks.filters.clear":"Limpiar filtros","filters.noOtherProjects":"No hay otros proyectos","filters.noTags":"Sin etiquetas","filters.noOtherTags":"No hay otras etiquetas","filters.sheet.title":"Opciones","filters.chip.search":"B\xFAsqueda","filters.chip.project":"Proyecto","filters.chip.tag":"Etiqueta","filters.chip.date":"Fecha","filters.chip.updated":"Actualizado","filters.chip.removeAria":"Quitar filtro {label}","filters.dateRange.from":"Desde","filters.dateRange.until":"Hasta","filters.updated.week":"Semana","filters.updated.month":"Mes","tasks.kanban.tipLabel":"Consejo:","tasks.kanban.tipTextBefore":"En el tablero Kanban manten ","tasks.kanban.tipTextAfter":" (Cmd en Mac) y haz clic para seleccionar varias tareas. Shift + clic selecciona un rango, luego arrastra para moverlas juntas","tasks.view.kanban":"Kanban","tasks.view.list":"Lista","tasks.view.calendar":"Calendario","tasks.sort.label":"Ordenar: Prioridad","tasks.sort.orderByPriority":"Ordenar por prioridad","tasks.kanban.showBacklog":"Mostrar backlog","tasks.kanban.showProjects":"Mostrar proyectos","tasks.kanban.showNoDate":'Mostrar "Sin fecha"',"tasks.addButton":"+ A\xF1adir tarea","tasks.noProject":"Sin proyecto","tasks.projectIndicatorNone":"Sin proyecto - ","tasks.project.selectPlaceholder":"Selecciona un proyecto","tasks.tags.none":"Sin etiquetas","tasks.checklist.toggle":"Alternar casilla","tasks.untitled":"Tarea sin t\xEDtulo","tasks.startDatePrefix":"Fecha de inicio: ","tasks.endDatePrefix":"Fecha de fin: ","tasks.noDate":"Sin fecha","tasks.noDatesSet":"Sin fechas","tasks.noEndDate":"Sin fecha de fin","tasks.due.yesterday":"Ayer","tasks.due.daysOverdue":"{count} d\xEDas de atraso","tasks.due.tomorrow":"Ma\xF1ana","tasks.openTaskDetails":"Abrir detalles de la tarea","tasks.noTasksInProject":"No hay tareas en este proyecto","tasks.attachments.open":"Abrir","tasks.attachments.none":"Sin archivos adjuntos","tasks.attachments.remove":"Quitar archivo adjunto","tasks.attachments.removeTitle":"Quitar","tasks.attachments.removeLink":"Quitar enlace","tasks.attachments.googleDoc":"Documento de Google","tasks.attachments.googleSheet":"Hoja de c\xE1lculo de Google","tasks.attachments.googleSlides":"Presentaci\xF3n de Google","tasks.attachments.googleDriveFile":"Archivo de Google Drive","tasks.attachments.pdf":"Documento PDF","tasks.attachments.word":"Documento de Word","tasks.attachments.excel":"Archivo de Excel","tasks.attachments.powerpoint":"PowerPoint","tasks.empty.epic":"A\xFAn no hay tareas. Crea tu primera tarea para este \xE9pico.","tasks.backlogQuickTitle":"Abrir tareas de backlog en vista de lista","tasks.backlogQuickLabel":"Backlog","tasks.kanban.columnBacklog":"\u{1F9CA} Backlog","tasks.kanban.columnTodo":"\u{1F4CB} Por hacer","tasks.kanban.columnProgress":"\u{1F504} En progreso","tasks.kanban.columnReview":"\u2611\uFE0F En revisi\xF3n","tasks.kanban.columnDone":"\u2705 Hecho","tasks.table.task":"Tarea","tasks.table.priority":"Prioridad","tasks.table.status":"Estado","tasks.table.tags":"Etiquetas","tasks.table.project":"Proyecto","tasks.table.startDate":"Fecha de inicio","tasks.table.endDate":"Fecha de fin","tasks.table.updated":"Actualizado","tasks.list.count":"{count} resultados","tasks.modal.editTitle":"Editar tarea","tasks.modal.duplicate":"\u{1F4C4} Duplicar tarea","tasks.modal.delete":"\u{1F5D1}\uFE0F Eliminar tarea","tasks.modal.tab.general":"General","tasks.modal.tab.details":"Detalles","tasks.modal.tab.history":"Historial","tasks.modal.titleLabel":"T\xEDtulo de la tarea","tasks.modal.attachmentsLabel":"Adjuntos","tasks.modal.attachmentsSupported":"Compatible: Im\xE1genes (10MB), PDF (20MB), Documentos (10MB)","tasks.modal.attachmentsDropzoneDefault":"Arrastra y suelta o haz clic para adjuntar","tasks.modal.attachmentsDropzoneTap":"Haz clic para adjuntar","tasks.modal.linksLabel":"Enlaces","tasks.modal.attachmentNamePlaceholder":"Nombre (opcional)","tasks.modal.attachmentUrlPlaceholder":"URL","tasks.modal.addLink":"Agregar enlace","tasks.modal.statusLabel":"Estado","tasks.modal.priorityLabel":"Prioridad","tasks.modal.tagsLabel":"Etiquetas","tasks.modal.addTagPlaceholder":"A\xF1adir etiqueta","tasks.modal.projectLabel":"Proyecto","tasks.modal.projectOpenTitle":"Abrir detalles del proyecto","tasks.modal.projectSelect":"Selecciona un proyecto","tasks.modal.submitCreate":"Crear tarea","tasks.modal.listBulleted":"\u2022 Lista","tasks.modal.listNumbered":"1. Lista","tasks.modal.insertDivider":"Insertar separador horizontal","tasks.modal.insertCheckbox":"Insertar casilla","tasks.history.emptyTitle":"A\xFAn no hay cambios","tasks.history.emptySubtitle":"Los cambios en esta tarea aparecer\xE1n aqu\xED","calendar.title":"Calendario","calendar.today":"Hoy","calendar.prevMonth":"Mes anterior","calendar.nextMonth":"Mes siguiente","calendar.dayItemsTitle":"Elementos para {date}","calendar.dayItemsProjects":"Proyectos","calendar.dayItemsTasks":"Tareas","calendar.dayItems.close":"Cerrar tareas del d\xEDa","calendar.dayItems.addTask":"+ Agregar Tarea","feedback.title":"Comentarios e incidencias","feedback.subtitle":"Reporta errores y sugiere funciones","feedback.saveStatus.saved":"Guardado","feedback.saveStatus.saving":"Guardando...","feedback.saveStatus.error":"No se pudo guardar","feedback.saveStatus.offline":"Sin conexion","feedback.type.bugLabel":"\u{1F41E} Error","feedback.type.title":"Tipo de comentario","feedback.type.bugOption":"\u{1F41E} Error","feedback.type.improvementOption":"\u{1F4A1} Mejora","feedback.descriptionPlaceholder":"Describe el problema o la idea. Puedes pegar una imagen directamente en este campo.","feedback.descriptionPlaceholderShort":"Describe el problema o la idea.","feedback.screenshotAttachTitle":"Adjuntar captura desde el dispositivo","feedback.screenshotDropzoneTap":"\u{1F4F7} Adjuntar captura","feedback.screenshotDropzoneDefault":"\u{1F4F7} Arrastra o haz clic para adjuntar","feedback.screenshotPreviewTitle":"Captura adjunta","feedback.screenshotPreviewSubtitle":"Se guardar\xE1 con este comentario","feedback.screenshotRemove":"Eliminar","feedback.screenshotPreviewAlt":"Vista previa de la captura","feedback.viewScreenshotTitle":"Ver captura","feedback.pagination.first":"Primera p\xE1gina","feedback.pagination.prev":"P\xE1gina anterior","feedback.pagination.next":"P\xE1gina siguiente","feedback.pagination.last":"\xDAltima p\xE1gina","feedback.pagination.showing":"Mostrando {start}-{end} de {total}","feedback.pagination.pageOf":"P\xE1gina {current} de {total}","feedback.addButton":"Agregar","feedback.pendingTitle":"? Pendiente","feedback.doneTitle":"? Hecho","feedback.delete.title":"Eliminar comentario","feedback.delete.body":"\xBFSeguro que deseas eliminar este comentario?","feedback.empty.pending":"No hay feedback pendiente","feedback.empty.done":"No hay feedback completado","export.title":"Exportar datos","export.body":"Esto descargar\xE1 una copia completa de todas tus tareas, proyectos y ajustes como un archivo JSON. \xBFSeguro que deseas exportar tus datos?","export.confirm":"Exportar","confirm.deleteTask.title":"Eliminar tarea","confirm.deleteTask.body":"Esta acci\xF3n no se puede deshacer. Para confirmar, escribe delete abajo:","confirm.deleteTask.inputPlaceholder":"Escribe delete aqu\xED","confirm.deleteTask.error":'Escribe "delete" exactamente para confirmar',"confirm.unsaved.title":"Cambios sin guardar","confirm.unsaved.body":"Tienes cambios sin guardar. \xBFSeguro que quieres cerrar y perderlos?","confirm.unsaved.discard":"Descartar cambios","confirm.review.title":'Desactivar estado "En revisi\xF3n"',"error.saveDataFailed":"No se pudieron guardar los datos. Int\xE9ntalo de nuevo.","error.saveProjectsFailed":"No se pudieron guardar los proyectos. Int\xE9ntalo de nuevo.","error.saveTasksFailed":"No se pudieron guardar las tareas. Int\xE9ntalo de nuevo.","error.saveFeedbackFailed":"No se pudo guardar el feedback. Int\xE9ntalo de nuevo.","error.saveProjectColorsFailed":"No se pudieron guardar los colores del proyecto.","error.saveTaskFailed":"No se pudo guardar la tarea. Int\xE9ntalo de nuevo.","error.saveChangesFailed":"No se pudieron guardar los cambios. Int\xE9ntalo de nuevo.","error.saveTaskPositionFailed":"No se pudo guardar la posici\xF3n de la tarea. Int\xE9ntalo de nuevo.","error.saveProjectFailed":"No se pudo guardar el proyecto. Int\xE9ntalo de nuevo.","error.notLoggedInResetPin":"Debes iniciar sesi\xF3n para restablecer tu PIN","error.resetPinFailed":"No se pudo restablecer el PIN","success.resetPin":"\xA1PIN restablecido con \xE9xito! Tendr\xE1s que iniciar sesi\xF3n de nuevo con tu nuevo PIN.","error.resetPinError":"Ocurri\xF3 un error al restablecer el PIN","error.userNameEmpty":"El nombre de usuario no puede estar vac\xEDo.","error.saveDisplayNameFailed":"No se pudo guardar el nombre visible. Int\xE9ntalo de nuevo.","error.invalidEmail":"Por favor, introduce un correo v\xE1lido.","error.saveEmailFailed":"No se pudo guardar el correo. Int\xE9ntalo de nuevo.","error.saveAvatarFailed":"No se pudo guardar el avatar. Int\xE9ntalo de nuevo.","success.settingsSaved":"\xA1Ajustes guardados correctamente!","error.logoSelectFile":"Selecciona un archivo de imagen para el logo del espacio de trabajo.","error.logoTooLarge":"Usa una imagen menor de 2 MB para el logo del espacio de trabajo.","error.imageReadFailed":"No se pudo leer la imagen seleccionada.","error.imageLoadFailed":"No se pudo cargar la imagen seleccionada.","error.logoUploadFailed":"Error al subir el logo: {message}","error.cropInvalid":"Error: el estado del recorte no es v\xE1lido.","error.cropTooLarge":"La imagen recortada es demasiado grande. Selecciona un \xE1rea m\xE1s peque\xF1a o usa una imagen m\xE1s peque\xF1a.","success.cropApplied":"\xA1Imagen recortada y aplicada correctamente!","success.logoCroppedApplied":"\xA1Logo del espacio de trabajo recortado y aplicado correctamente!","error.cropFailed":"Error al recortar la imagen: {message}","error.avatarSelectFile":"Selecciona un archivo de imagen para tu avatar.","error.avatarTooLarge":"Usa una imagen menor de 2 MB para tu avatar.","error.avatarUploadFailed":"No se pudo subir el avatar. Int\xE9ntalo de nuevo.","error.endDateBeforeStart":"La fecha de fin no puede ser anterior a la fecha de inicio","error.startDateAfterEnd":"La fecha de inicio no puede ser posterior a la fecha de fin","error.feedbackAttachImage":"Adjunta un archivo de imagen.","error.feedbackReadImage":"No se pudo leer la imagen. Int\xE9ntalo de nuevo.","error.feedbackStatusFailed":"No se pudo actualizar el estado del feedback. Int\xE9ntalo de nuevo.","error.attachmentSaveFailed":"No se pudo guardar el adjunto. Int\xE9ntalo de nuevo.","error.attachmentLoadFailed":"No se pudo cargar la imagen: {message}","success.fileDownloaded":"\xA1Archivo descargado!","error.fileDownloadFailed":"No se pudo descargar el archivo: {message}","success.attachmentDeletedFromStorage":"{name} eliminado del almacenamiento","error.fileDeleteFailed":"No se pudo eliminar el archivo del almacenamiento","success.attachmentRemoved":"Adjunto eliminado","error.fileSizeTooLarge":"El tama\xF1o del archivo debe ser menor de {maxMB} MB. Elige uno m\xE1s peque\xF1o.","success.fileUploaded":"\xA1Archivo subido correctamente!","error.fileUploadFailed":"Error al subir el archivo: {message}","error.selectFile":"Selecciona un archivo","error.saveTagFailed":"No se pudo guardar la etiqueta. Int\xE9ntalo de nuevo.","error.removeTagFailed":"No se pudo eliminar la etiqueta. Int\xE9ntalo de nuevo.","error.openScreenshotFailed":"No se pudo abrir la captura","history.sort.newest":"\u2191 M\xE1s recientes primero","history.sort.oldest":"\u2193 M\xE1s antiguos primero","history.field.title":"T\xEDtulo","history.field.name":"Nombre","history.field.description":"Descripci\xF3n","history.field.status":"Estado","history.field.priority":"Prioridad","history.field.category":"Categor\xEDa","history.field.startDate":"Fecha de inicio","history.field.endDate":"Fecha de fin","history.field.link":"Enlace","history.field.task":"Enlace","history.field.projectId":"Proyecto","history.field.tags":"Etiquetas","history.field.attachments":"Adjuntos","history.action.created":"Creado","history.action.deleted":"Eliminado","history.link.added":"Agregado","history.link.removed":"Eliminado","history.entity.task":"tarea","history.value.empty":"vac\xEDo","history.value.none":"ninguno","history.change.beforeLabel":"Antes:","history.change.afterLabel":"Despu\xE9s:","history.change.notSet":"Sin establecer","history.change.removed":"Eliminado","history.tags.none":"Sin etiquetas","history.attachments.none":"Sin archivos adjuntos","history.attachments.countSingle":"{count} archivo","history.attachments.countPlural":"{count} archivos","history.project.fallback":"Proyecto #{id}","history.change.arrow":"\u2192","menu.openMenu":"Abrir men\xFA","menu.language":"Idioma","menu.darkMode":"Modo oscuro","menu.lightMode":"Modo claro","menu.settings":"Configuraci\xF3n","menu.help":"Ayuda","menu.signOut":"Cerrar sesi\xF3n","nav.overview":"Resumen","nav.dashboard":"Panel","nav.updates":"Notas de versi\xF3n","nav.calendar":"Calendario","nav.work":"Trabajo","nav.projects":"Proyectos","nav.allTasks":"Todas las tareas","nav.feedback":"Comentarios","updates.title":"Notas de versi\xF3n","updates.subtitle":"\xDAltimo registro de cambios en Nautilus","updates.latestLabel":"Ultima version","updates.historyLabel":"Registro de versiones","updates.sections.new":"Novedades","updates.sections.improvements":"Mejoras","updates.sections.fixes":"Correcciones","updates.empty":"Todavia no hay notas de version.","updates.sectionEmpty":"Todav\xEDa no hay entradas.","updates.historyEmpty":"Sin versiones anteriores.","notifications.title":"Notificaciones","notifications.toggle":"Notificaciones","notifications.today":"Hoy","notifications.yesterday":"Ayer","notifications.clearAll":"Limpiar todo","notifications.releaseTitle":"Nueva versi\xF3n","notifications.releaseCta":"Ver actualizaciones","notifications.releaseMeta":"Publicado {date}","notifications.dueTodayTitle":"Vence hoy","notifications.dueTodayCta":"Ver tareas","notifications.dueTodayMetaOne":"{count} tarea vence hoy","notifications.dueTodayMetaMany":"{count} tareas vencen hoy","notifications.dueTodayMore":"y {count} tareas m\xE1s","notifications.empty":"Todo al d\xEDa.","settings.title":"Configuraci\xF3n","settings.subtitle":"Administra tus preferencias y la configuraci\xF3n de la aplicaci\xF3n","settings.section.profile":"Perfil","settings.displayName":"Nombre para mostrar","settings.displayNameHint":"Este nombre se muestra en toda la aplicaci\xF3n","settings.placeholder.displayName":"Escribe tu nombre para mostrar","settings.email":"Correo electr\xF3nico","settings.emailHint":"Se usa para tu cuenta y notificaciones de vencimiento","settings.placeholder.email":"Escribe tu correo","settings.avatar":"Avatar","settings.avatarHint":"Sube una imagen para tu avatar (m\xE1x. 2 MB). Se mostrar\xE1 en forma circular.","settings.avatarRemoveTitle":"Eliminar avatar","settings.workspaceLogo":"Logo del espacio de trabajo","settings.workspaceLogoHint":"Sube una imagen cuadrada para reemplazar el logo de Nautilus (m\xE1x. 2 MB).","settings.workspaceLogoRemoveTitle":"Eliminar logo personalizado","settings.section.application":"Aplicaci\xF3n","settings.enableReviewStatus":"Habilitar estado En revisi\xF3n","settings.enableReviewStatusHint":"Muestra u oculta la columna y el filtro de estado EN REVISI\xD3N","settings.enableReviewStatusHintPrefix":"Muestra u oculta la columna y el filtro del estado","settings.enableReviewStatusHintSuffix":"en la vista de tareas","settings.calendarIncludeBacklog":"Mostrar backlog en calendario","settings.calendarIncludeBacklogHint":"Muestra tareas en backlog en todas las vistas de calendario","settings.autoStartDate":"Autocompletar fecha de inicio","settings.autoStartDateHint":'Establece autom\xE1ticamente la fecha de inicio cuando la tarea pasa a "En progreso" (si est\xE1 vac\xEDa)',"settings.autoEndDate":"Autocompletar fecha de fin","settings.autoEndDateHint":'Establece autom\xE1ticamente la fecha de fin cuando la tarea pasa a "Hecho" (si est\xE1 vac\xEDa)',"settings.debugLogs":"Habilitar logs de depuracion","settings.debugLogsHint":"Guarda logs de diagnostico en la consola del navegador al activarlo","settings.historySortOrder":"Orden de historial","settings.historySortOrderHint":"Orden predeterminado para los historiales de tareas y proyectos","settings.historySortNewest":"M\xE1s reciente primero","settings.historySortOldest":"M\xE1s antiguo primero","settings.language":"Idioma","settings.languageHint":"Elige el idioma de la aplicaci\xF3n","settings.section.notifications":"Notificaciones","settings.emailNotifications":"Notificaciones por correo","settings.emailNotificationsHint":"Activa o desactiva los correos de recordatorio de vencimientos","settings.weekdaysOnly":"Solo d\xEDas laborables","settings.weekdaysOnlyHint":"Omitir correos s\xE1bado y domingo","settings.includeStartDates":"Notificar cuando las tareas comienzan","settings.includeStartDatesHint":"Enviar recordatorios cuando una tarea comienza (ej., hoy)","settings.includeBacklog":"Incluir tareas en backlog","settings.includeBacklogHint":"Incluir tareas en backlog en notificaciones por correo y en la app","settings.sendTime":"Hora de env\xEDo","settings.sendTimeHint":"Hora diaria de env\xEDo (08:00-18:00, intervalos de 30 minutos)","settings.timeZone":"Zona horaria","settings.timeZoneHint":"Mantiene la misma hora local todo el a\xF1o (con horario de verano)","settings.timeZone.option.argentina":"Argentina (Buenos Aires)","settings.timeZone.option.canary":"Islas Canarias (Atlantic/Canary)","settings.timeZone.option.spain":"Espa\xF1a peninsular (Europe/Madrid)","settings.timeZone.option.utc":"UTC","settings.section.security":"Seguridad","settings.pinManagement":"Gesti\xF3n de PIN","settings.pinManagementHint":"Restablece tu PIN a un nuevo c\xF3digo de 4 d\xEDgitos","settings.resetPinButton":"Restablecer PIN","settings.section.dataManagement":"Gesti\xF3n de datos","settings.exportData":"Exportar datos","settings.exportDataHint":"Descarga una copia de seguridad completa de tus tareas, proyectos y configuraci\xF3n en un archivo JSON","settings.exportButton":"Exportar","settings.cancelButton":"Cancelar","settings.saveButton":"Guardar configuraci\xF3n","settings.avatarUploadDefault":"Arrastra y suelta o haz clic para subir un avatar","settings.avatarUploadChange":"Cambiar avatar","settings.avatarUploadAriaUpload":"Subir avatar","settings.avatarUploadAriaChange":"Cambiar avatar","settings.logoUploadDefault":"Arrastra y suelta o haz clic para subir un logo","settings.logoUploadChange":"Cambiar logo","settings.logoUploadAriaUpload":"Subir logo","settings.logoUploadAriaChange":"Cambiar logo","dashboard.title":"Panel","dashboard.hero.activeProjectsLabel":"Proyectos activos","dashboard.hero.completionRateLabel":"Tasa de finalizaci\xF3n","dashboard.hero.projectsTrend":"\u{1F4C8} +2 este mes","dashboard.hero.completionTrend":"\u{1F3AF} Objetivo: 80%","dashboard.projectAnalytics":"\u{1F4CA} Anal\xEDtica de proyectos","dashboard.period.week":"Semana","dashboard.period.month":"Mes","dashboard.period.quarter":"Trimestre","dashboard.stat.pendingTasks":"Tareas pendientes","dashboard.stat.inProgress":"En progreso","dashboard.stat.highPriority":"Alta prioridad","dashboard.stat.overdue":"Vencidas","dashboard.stat.completed":"Completadas","dashboard.stat.projects":"Proyectos","dashboard.highPriorityHint":"Tareas de alta prioridad con vencimiento en 7 d\xEDas (o vencidas)","dashboard.projectProgress":"\u{1F30A} Progreso del proyecto","dashboard.legend.todo":"Por hacer","dashboard.legend.progress":"En progreso","dashboard.legend.review":"En revisi\xF3n","dashboard.legend.complete":"Completo","dashboard.viewAll":"Ver todo","dashboard.quickActions":"\u26A1 Acciones r\xE1pidas","dashboard.action.generateReport":"Generar informe","dashboard.action.addTask":"Agregar tarea","dashboard.action.viewCalendar":"Ver calendario","dashboard.action.newProject":"Nuevo proyecto","dashboard.recentActivity":"\u{1F504} Actividad reciente","dashboard.researchInsights":"\u{1F9E0} Perspectivas","dashboard.activity.emptyTitle":"Bienvenido a tu panel","dashboard.activity.emptySubtitle":"Empieza a crear proyectos y tareas para ver actividad","dashboard.activity.completed":'Completaste "{title}" {projectPart}',"dashboard.activity.createdProject":'Creaste el nuevo proyecto "{project}"',"dashboard.activity.addedTask":'Agregaste la nueva tarea "{title}" {projectPart}',"dashboard.activity.inProject":"en {project}","dashboard.activity.toProject":"a {project}","dashboard.activity.recently":"Recientemente","dashboard.activity.justNow":"Justo ahora","dashboard.activity.today":"Hoy","dashboard.activity.yesterday":"Ayer","dashboard.activity.daysAgoShort":"hace {count}d","dashboard.activity.minuteAgo":"hace {count} minuto","dashboard.activity.minutesAgo":"hace {count} minutos","dashboard.activity.hourAgo":"hace {count} hora","dashboard.activity.hoursAgo":"hace {count} horas","dashboard.activity.dayAgo":"hace {count} d\xEDa","dashboard.activity.daysAgo":"hace {count} d\xEDas","dashboard.trend.thisWeek":"esta semana","dashboard.trend.thisMonth":"este mes","dashboard.trend.thisQuarter":"este trimestre","dashboard.trend.dueTodayOne":"{count} vence hoy","dashboard.trend.dueTodayMany":"{count} vencen hoy","dashboard.trend.onTrack":"En buen camino","dashboard.trend.needsAttention":"Necesita atenci\xF3n","dashboard.trend.allOnTrack":"Todo en buen camino","dashboard.trend.criticalOne":"{count} cr\xEDtica","dashboard.trend.criticalMany":"{count} cr\xEDticas","dashboard.trend.completedOne":"{count} completada","dashboard.trend.completedMany":"{count} completadas","dashboard.trend.inProgress":"En progreso","dashboard.emptyProjects.title":"A\xFAn no hay proyectos","dashboard.emptyProjects.subtitle":"Crea tu primer proyecto para ver la visualizaci\xF3n de progreso","dashboard.tasks":"tareas","dashboard.activity.allTitle":"Toda la actividad reciente","dashboard.activity.allSubtitle":"Historial completo de tu trabajo reciente","dashboard.activity.backToDashboard":"\u2190 Volver al panel","dashboard.insights.excellentTitle":"Progreso excelente","dashboard.insights.excellentDesc":"{percent}% de finalizaci\xF3n supera el objetivo. Gran impulso.","dashboard.insights.goodTitle":"Buen progreso","dashboard.insights.goodDesc":"{percent}% de finalizaci\xF3n es s\xF3lido. Intenta llegar al objetivo de 80%.","dashboard.insights.opportunityTitle":"Oportunidad de progreso","dashboard.insights.opportunityDesc":"{percent}% de finalizaci\xF3n. Enf\xF3cate en completar tareas actuales para ganar impulso.","dashboard.insights.actionTitle":"Acci\xF3n necesaria","dashboard.insights.actionDesc":"{percent}% de finalizaci\xF3n es bajo. Divide tareas grandes y empieza con las peque\xF1as.","dashboard.insights.todayTitle":"Enfoque de hoy","dashboard.insights.todayDescOne":"{count} tarea vence hoy. Prior\xEDzala para mayor impacto.","dashboard.insights.todayDescMany":"{count} tareas vencen hoy. Prior\xEDzalas para mayor impacto.","dashboard.insights.overdueTitle":"Elementos vencidos","dashboard.insights.overdueDescOne":"{count} tarea vencida necesita atenci\xF3n. Ati\xE9ndela para evitar retrasos.","dashboard.insights.overdueDescMany":"{count} tareas vencidas necesitan atenci\xF3n. Ati\xE9ndelas para evitar retrasos.","dashboard.insights.highPriorityTitle":"Enfoque de alta prioridad","dashboard.insights.highPriorityDescOne":"{count} tarea de alta prioridad necesita atenci\xF3n inmediata.","dashboard.insights.highPriorityDescMany":"{count} tareas de alta prioridad necesitan atenci\xF3n inmediata.","dashboard.insights.emptyProjectsTitle":"Proyectos sin tareas","dashboard.insights.emptyProjectsDescOne":"{count} proyecto no tiene tareas a\xFAn. Agrega tareas para seguir el progreso.","dashboard.insights.emptyProjectsDescMany":"{count} proyectos no tienen tareas a\xFAn. Agrega tareas para seguir el progreso.","dashboard.insights.momentumTitle":"Buen impulso","dashboard.insights.momentumDescOne":"{count} tarea completada esta semana. Vas en buen ritmo.","dashboard.insights.momentumDescMany":"{count} tareas completadas esta semana. Vas en buen ritmo.","dashboard.insights.readyTitle":"Listo para empezar","dashboard.insights.readyDesc":"Crea tu primer proyecto y agrega tareas para comenzar a seguir tu progreso.","dashboard.insights.caughtUpTitle":"Todo al d\xEDa","dashboard.insights.caughtUpDesc":"Buen trabajo. No hay urgencias. Considera planificar tus pr\xF3ximos hitos."}};function Fc(){return localStorage.getItem("authToken")}function sn(){let e=Fc(),t={"Content-Type":"application/json"};return e&&(t.Authorization=`Bearer ${e}`),t}var xs=2e4,Mc="debugLogsEnabled";function Is(){try{return localStorage.getItem(Mc)==="true"}catch{return!1}}function Ts(e,t){Is()&&(t?console.log(`[feedback-debug] ${e}`,t):console.log(`[feedback-debug] ${e}`))}async function rn(e,t={},a=xs){let n=new AbortController,o=setTimeout(()=>n.abort(),a);try{return await fetch(e,{...t,signal:n.signal})}finally{clearTimeout(o)}}async function Ze(e,t){try{let a=await rn(`/api/storage?key=${encodeURIComponent(e)}`,{method:"POST",headers:sn(),body:JSON.stringify(t)});if(!a.ok)throw a.status===401?(window.location.hash="#login",new Error("Unauthorized - please login")):new Error(`Failed to save data: ${a.status} ${a.statusText}`);return!0}catch(a){throw console.error(`Error saving data for key "${e}":`,a),a}}async function st(e){try{let t=await rn(`/api/storage?key=${encodeURIComponent(e)}`,{headers:sn()});if(!t.ok){if(t.status===401)return window.location.hash="#login",null;if(t.status===404)return null;throw new Error(`Failed to load data: ${t.status} ${t.statusText}`)}let a=await t.text();return a&&a!=="null"?JSON.parse(a):null}catch(t){return console.error(`Error loading data for key "${e}":`,t),null}}async function js(e){try{let t=Array.isArray(e)?e:[],a=encodeURIComponent(t.join(",")),n=await rn(`/api/storage/batch?keys=${a}`,{headers:sn()});if(!n.ok)return n.status===401&&(window.location.hash="#login"),null;let o=await n.json();return o&&typeof o=="object"?o:null}catch(t){return console.error("Error batch loading data:",t),null}}async function lo(){return st("feedback:index")}async function cn(e){return Ze("feedback:index",e)}async function ln(e){return st(`feedback:item:${e}`)}async function dn(e){return Ze(`feedback:item:${e.id}`,e)}async function Cs(e,t=xs){try{let a=Is(),n=`fb-${Date.now()}-${Math.random().toString(36).slice(2)}`,o=typeof performance<"u"&&performance.now?performance.now():Date.now(),s=null;if(a)try{s=JSON.stringify({operations:e}).length}catch{}let r=sn();a&&(r["X-Debug-Logs"]="1",r["X-Request-Id"]=n,Ts("batch-feedback:request",{requestId:n,operationCount:Array.isArray(e)?e.length:0,payloadBytes:s,timeoutMs:t}));let i=await rn("/api/batch-feedback",{method:"POST",headers:r,body:JSON.stringify({operations:e})},t);if(!i.ok)throw i.status===401?(window.location.hash="#login",new Error("Unauthorized - please login")):new Error(`Failed to batch process feedback: ${i.status} ${i.statusText}`);let c=await i.json();if(a){let l=typeof performance<"u"&&performance.now?performance.now():Date.now();Ts("batch-feedback:response",{requestId:n,durationMs:Math.round(l-o),success:c&&c.success,processed:c&&c.processed,total:c&&c.total})}return c}catch(a){throw console.error("Error batch processing feedback:",a),a}}async function As(e,t,a){try{await Promise.all([Ze("tasks",e),Ze("projects",t),uo(a)]),Array.isArray(e)&&ra(pn,e),Array.isArray(t)&&ra(mn,t)}catch(n){throw console.error("Error saving all data:",n),n}}async function Bs(e){try{await Ze("tasks",e),Array.isArray(e)&&ra(pn,e)}catch(t){throw console.error("Error saving tasks:",t),t}}async function $s(e){try{await Ze("projects",e),Array.isArray(e)&&ra(mn,e)}catch(t){throw console.error("Error saving projects:",t),t}}async function uo(e){try{let t=Array.isArray(e)?e:[],a=t.map(n=>n&&n.id).filter(n=>n!=null);await Promise.all(t.map(n=>dn(n))),await cn(a),un(ja,t)}catch(t){throw console.error("Error saving feedback items:",t),t}}async function Ns(e){try{await Ze("projectColors",e)}catch(t){throw console.error("Error saving project colors:",t),t}}async function Fs(e,t){try{await Promise.all([Ze("sortMode",e),Ze("manualTaskOrder",t)])}catch(a){throw console.error("Error saving sort state:",a),a}}async function po(e={}){let t=!!e.preferCache,a=e.feedback||{};try{let n=t?Ls(pn):[],o=t?Ls(mn):[],s=a.preferCache??t,r=await qs({...a,preferCache:s}),i=n&&n.length>0||o&&o.length>0;if(t&&i){let c=typeof e.onRefresh=="function"?e.onRefresh:null,l={...e,preferCache:!1,feedback:{...a,preferCache:!1}};return Ps(l).then(p=>{c&&c(p)}),{tasks:n||[],projects:o||[],feedbackItems:r||[]}}return await Ps({...e,feedback:{...a,preferCache:s}})}catch(n){return console.error("Error loading all data:",n),{tasks:[],projects:[],feedbackItems:[]}}}var ja="feedbackItemsCache:v1",pn="tasksCache:v1",mn="projectsCache:v1";function Ms(e){try{let t=localStorage.getItem("authToken");return t?`${e}:${t}`:e}catch{return e}}function Ls(e){try{let t=localStorage.getItem(Ms(e)),a=t?JSON.parse(t):[];return Array.isArray(a)?a:[]}catch{return[]}}function ra(e,t){try{localStorage.setItem(Ms(e),JSON.stringify(t||[]))}catch{}}function Rc(e){let t=e||ja;try{let a=localStorage.getItem(t),n=a?JSON.parse(a):[];return Array.isArray(n)?n:[]}catch{return[]}}function un(e,t){let a=e||ja;try{localStorage.setItem(a,JSON.stringify(t||[]))}catch{}}async function Ps(e={}){let t=e.feedback||{},a=await js(["tasks","projects","feedbackItems"]),[n,o,s]=await Promise.all([a?Promise.resolve(a.tasks):st("tasks"),a?Promise.resolve(a.projects):st("projects"),qs(t)]);return Array.isArray(n)&&ra(pn,n),Array.isArray(o)&&ra(mn,o),{tasks:n||[],projects:o||[],feedbackItems:s||[]}}function Rs(e,t){let a=Array.isArray(e)?e:[],n=Array.isArray(t)?t:[];if(a.length===0)return n.filter(Boolean);let o=new Set,s=[],r=new Map;for(let c of n)c&&c.id!=null&&r.set(c.id,c);for(let c of a)!c||c.id==null||(o.add(c.id),s.push(r.get(c.id)||c));let i=[];for(let c of n)c&&c.id!=null&&!o.has(c.id)&&i.push(c);return[...i,...s]}async function Os(e,t,a){let n=Number.isInteger(t)?t:null,o=Number.isInteger(a)?a:null,s=await Promise.all(e.map(p=>ln(p))),r=[],i=[];for(let p of s){if(!p)continue;(p.status==="done"?"done":"open")==="done"?i.push(p):r.push(p)}let c=n!==null?r.slice(0,n):r,l=o!==null?i.slice(0,o):i;return[...c,...l]}async function Oc(e){let t=e.limitPending,a=e.limitDone,n=e.cacheKey||ja,o=Array.isArray(e.cached)?e.cached:[],s=typeof e.onRefresh=="function"?e.onRefresh:null;try{let r=await lo();if(Array.isArray(r)&&r.length>0){let i=[];Number.isInteger(t)||Number.isInteger(a)?i=await Os(r,t,a):i=await Promise.all(r.map(l=>ln(l)));let c=Rs(o,i.filter(Boolean));un(n,c),s&&s(c)}}catch(r){console.error("Error refreshing feedback items:",r)}}async function qs(e={}){let t=[];try{let a=e.limitPending,n=e.limitDone,o=e.cacheKey||ja;if(t=e.useCache===!1?[]:Rc(o),!!(e.preferCache&&t.length>0))return Oc({limitPending:a,limitDone:n,cacheKey:o,cached:t,onRefresh:e.onRefresh}),t;let r=await lo();if(Array.isArray(r)&&r.length>0){let c=[];Number.isInteger(a)||Number.isInteger(n)?c=await Os(r,a,n):c=await Promise.all(r.map(p=>ln(p)));let l=Rs(t,c.filter(Boolean));return un(o,l),l}let i=await st("feedbackItems");if(Array.isArray(i)&&i.length>0){try{let c=i.map(l=>l&&l.id).filter(l=>l!=null);await Promise.all(i.map(l=>dn(l))),await cn(c)}catch(c){console.error("Error migrating legacy feedback items:",c)}return un(o,i),i}}catch(a){console.error("Error loading feedback items:",a)}return t||[]}async function mo(){try{let[e,t]=await Promise.all([st("sortMode"),st("manualTaskOrder")]);return{sortMode:e==="auto"||!e?"priority":e,manualTaskOrder:t||{todo:[],progress:[],review:[],done:[]}}}catch(e){return console.error("Error loading sort state:",e),{sortMode:"priority",manualTaskOrder:{todo:[],progress:[],review:[],done:[]}}}}async function fo(){try{return await st("projectColors")||{}}catch(e){return console.error("Error loading project colors:",e),{}}}async function zs(e){try{await Ze("settings",e)}catch(t){throw console.error("Error saving settings:",t),t}}async function go(){try{return await st("settings")||{}}catch(e){return console.error("Error loading settings:",e),{}}}function fn(e){return e&&e.charAt(0).toUpperCase()+e.slice(1)}function Me(e){return typeof e=="string"&&/^\d{1,2}[\/\-]\d{1,2}[\/\-]\d{4}$/.test(e.trim())}function rt(e){return typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e.trim())}function Ye(e){if(!Me(e))return e||"";let t=e.trim().split(/[\/\-]/),a=parseInt(t[0],10),n=parseInt(t[1],10),o=parseInt(t[2],10);if(!a||!n||!o||a>31||n>12)return"";let s=String(a).padStart(2,"0"),r=String(n).padStart(2,"0");return`${o}-${r}-${s}`}function gn(e){if(!rt(e))return e||"";let[t,a,n]=e.split("-");return`${n}/${a}/${t}`}function pe(e){if(!e)return"No date";if(Me(e))return e.replace(/-/g,"/");if(rt(e)){let[t,a,n]=e.split("-");return`${n}/${a}/${t}`}return"No date"}function hn(e,t=void 0){if(!e)return"No date";try{if(rt(e)){let[a,n,o]=e.split("-");return new Date(parseInt(a,10),parseInt(n,10)-1,parseInt(o,10)).toLocaleDateString(t,{year:"numeric",month:"short",day:"numeric"})}if(Me(e)){let a=e.split(/[\/\-]/),n=parseInt(a[0],10),o=parseInt(a[1],10),s=parseInt(a[2],10);return new Date(s,o-1,n).toLocaleDateString(t,{year:"numeric",month:"short",day:"numeric"})}}catch{}return"No date"}function Hs(e){let t=new Intl.DateTimeFormat(e,{weekday:"short"}),a=new Date(2024,0,1);return Array.from({length:7},(n,o)=>{let s=t.format(new Date(a.getFullYear(),a.getMonth(),a.getDate()+o));return fn(s)})}function Us(e,t,a){let n=new Intl.DateTimeFormat(e,{month:"long",year:"numeric"});return fn(n.format(new Date(t,a,1)))}function _s(e,t,a,n=[]){let o=new Date().toISOString(),s=e.startDate||"",r=e.endDate||"",i={id:a,title:e.title||"",description:e.description||"",projectId:e.projectId?parseInt(e.projectId,10):null,startDate:s,endDate:r,startDateWasEverSet:typeof s=="string"&&s.trim()!=="",endDateWasEverSet:typeof r=="string"&&r.trim()!=="",priority:e.priority||"medium",status:e.status||"todo",tags:e.tags||[],attachments:n.length>0?[...n]:[],createdAt:o,updatedAt:o},c=[...t,i],l=a+1;return{task:i,tasks:c,taskCounter:l}}function Vs(e,t,a){let n=a.findIndex(p=>p.id===parseInt(e,10));if(n===-1)return{task:null,tasks:a,oldProjectId:null};let o=a[n],s=o.projectId,r=t.projectId!==void 0?t.projectId?parseInt(t.projectId,10):null:o.projectId,i={...o,title:t.title!==void 0?t.title:o.title,description:t.description!==void 0?t.description:o.description,projectId:r,startDate:t.startDate!==void 0?t.startDate:o.startDate,endDate:t.endDate!==void 0?t.endDate:o.endDate,priority:t.priority!==void 0?t.priority:o.priority,status:t.status!==void 0?t.status:o.status};if(t.startDate!==void 0&&typeof i.startDate=="string"&&i.startDate.trim()!==""&&(i.startDateWasEverSet=!0),t.endDate!==void 0&&typeof i.endDate=="string"&&i.endDate.trim()!==""&&(i.endDateWasEverSet=!0),!(i.title!==o.title||i.description!==o.description||i.projectId!==o.projectId||i.startDate!==o.startDate||i.endDate!==o.endDate||i.priority!==o.priority||i.status!==o.status))return{task:o,tasks:a,oldProjectId:s};i.updatedAt=new Date().toISOString();let l=[...a];return l[n]=i,{task:i,tasks:l,oldProjectId:s}}function Ws(e,t,a,n,o={autoSetStartDateOnStatusChange:!1,autoSetEndDateOnStatusChange:!1}){let s=n.findIndex(g=>g.id===parseInt(e,10));if(s===-1)return{task:null,tasks:n,oldProjectId:null};let r=n[s],i=r.projectId,c={...r},l=r.startDate,p=r.endDate,u=r.completedDate;if(t==="startDate"||t==="endDate"){let g=Me(a)?Ye(a):rt(a)?a:"";c[t]=g,g&&(t==="startDate"&&(c.startDateWasEverSet=!0),t==="endDate"&&(c.endDateWasEverSet=!0))}else t==="projectId"?c.projectId=a?parseInt(a,10):null:c[t]=a;if(t==="status"&&(o.autoSetStartDateOnStatusChange||o.autoSetEndDateOnStatusChange)){let g=new Date().toISOString().split("T")[0];o.autoSetStartDateOnStatusChange&&a==="progress"&&!c.startDate&&(c.startDate=g,c.startDateWasEverSet=!0),o.autoSetEndDateOnStatusChange&&a==="done"&&!c.endDate&&(c.endDate=g,c.endDateWasEverSet=!0)}t==="status"&&a==="done"&&!c.completedDate&&(c.completedDate=new Date().toISOString());let f;if(t==="projectId"?f=c.projectId!==r.projectId:f=c[t]!==r[t],t==="status"&&(c.startDate!==l&&(f=!0),c.endDate!==p&&(f=!0),c.completedDate!==u&&(f=!0)),!f)return{task:r,tasks:n,oldProjectId:i};c.updatedAt=new Date().toISOString();let m=[...n];return m[s]=c,{task:c,tasks:m,oldProjectId:i}}function Gs(e,t){let a=t.find(s=>s.id===parseInt(e,10));if(!a)return{task:null,tasks:t,projectId:null};let n=a.projectId,o=t.filter(s=>s.id!==parseInt(e,10));return{task:a,tasks:o,projectId:n}}function Ys(e,t,a){let n=t.find(p=>p.id===parseInt(e,10));if(!n)return{task:null,tasks:t,taskCounter:a};let o=n.title||"Untitled",s=o.startsWith("Copy ")?o:`Copy ${o}`,r=new Date().toISOString(),i={id:a,title:s,description:n.description||"",projectId:n.projectId??null,startDate:n.startDate||"",endDate:n.endDate||"",startDateWasEverSet:!!n.startDateWasEverSet||!!n.startDate&&String(n.startDate).trim()!=="",endDateWasEverSet:!!n.endDateWasEverSet||!!n.endDate&&String(n.endDate).trim()!=="",priority:n.priority||"medium",status:n.status||"todo",tags:Array.isArray(n.tags)?[...n.tags]:[],attachments:Array.isArray(n.attachments)?n.attachments.map(p=>({...p})):[],createdAt:r,updatedAt:r},c=[...t,i],l=a+1;return{task:i,tasks:c,taskCounter:l}}function Ks(e,t,a){let n={id:a,name:e.name||"",description:e.description||"",startDate:e.startDate||"",endDate:e.endDate||"",tags:e.tags||[],createdAt:new Date().toISOString()},o=[...t,n],s=a+1;return{project:n,projects:o,projectCounter:s}}function Js(e,t,a,n){let o=n.findIndex(c=>c.id===parseInt(e,10));if(o===-1)return{project:null,projects:n};let r={...n[o]};if(t==="startDate"||t==="endDate"){let c=Me(a)?Ye(a):rt(a)?a:"";r[t]=c}else r[t]=a;let i=[...n];return i[o]=r,{project:r,projects:i}}function Zs(e,t,a=null,n=!1){let o=t.find(i=>i.id===parseInt(e,10));if(!o)return{project:null,projects:t,tasks:a};let s=t.filter(i=>i.id!==parseInt(e,10)),r=a;return a&&n&&(r=a.map(i=>i.projectId===parseInt(e,10)?{...i,projectId:null}:i)),{project:o,projects:s,tasks:r}}function q(e){return(e||"").replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}var ho=["#dc2626","#ea580c","#b45309","#ca8a04","#16a34a","#059669","#0ea5a4","#0284c7","#0369a1","#4338ca","#7c3aed","#6b21a8","#be185d","#e11d48","#065f46","#334155"],Ca=["#6C5CE7","#3742FA","#E84393","#00B894","#74B9FF","#0984E3","#0891b2","#E17055","#9B59B6","#2F3542","#FF3838","#6C5B7B","#C44569","#F8B500","#5758BB"];var Xs={backlog:"Backlog",todo:"To Do",progress:"In Progress",review:"In Review",done:"Done"};var se={high:3,medium:2,low:1},ia={done:1,progress:2,review:3,todo:4,backlog:5},Qs=[{value:"high",label:"High"},{value:"medium",label:"Medium"},{value:"low",label:"Low"}],yo={high:"var(--accent-red)",medium:"var(--accent-amber)",low:"var(--accent-green)"};var vo=[{id:"2026.01.06",version:"2.7.0",title:{en:"Signal and Flow",es:"Se\xF1al y flujo"},date:"2026-01-06",summary:{en:"A focused release that makes changes visible and deadlines clearer.",es:"Una versi\xF3n enfocada que hace visibles los cambios y aclara los plazos."},sections:{new:[{en:"Release Notes page with a clean breakdown of changes.",es:"P\xE1gina de notas de versi\xF3n con un desglose claro de cambios."},{en:"Top bar notification bell for new releases.",es:"Campana de notificaciones en la barra superior para nuevas versiones."},{en:"Due today reminders with quick navigation.",es:"Recordatorios de vencimiento hoy con navegaci\xF3n r\xE1pida."}],improvements:[{en:"Updates page tuned for fast scanning.",es:"P\xE1gina de novedades ajustada para lectura r\xE1pida."},{en:"Notification badge aggregates releases and due today tasks.",es:"La insignia de notificaciones agrupa versiones y tareas que vencen hoy."},{en:"Release dates formatted per locale.",es:"Fechas de versi\xF3n formateadas seg\xFAn la configuraci\xF3n regional."}],fixes:[{en:"Notifications now stay focused on tasks due today.",es:"Las notificaciones ahora se enfocan en tareas que vencen hoy."},{en:"Release history stays consistent across sessions.",es:"El historial de versiones se mantiene consistente entre sesiones."}]}},{id:"2025.12.20",version:"2.6.1",title:{en:"Stability Pass",es:"Pase de estabilidad"},date:"2025-12-20",summary:{en:"Polish across projects, tasks, and reporting.",es:"Pulido en proyectos, tareas y reportes."},sections:{new:[{en:"Task sorting refinements in list view.",es:"Mejoras en el ordenamiento de tareas en vista de lista."},{en:"Improved history timeline labels.",es:"Etiquetas mejoradas en la l\xEDnea de tiempo del historial."}],improvements:[{en:"Cleaner spacing for project detail views.",es:"Espaciado m\xE1s limpio en vistas de detalle de proyecto."},{en:"Faster dashboard rendering on large datasets.",es:"Renderizado del panel m\xE1s r\xE1pido con datos grandes."}],fixes:[{en:"Resolved occasional drag reorder glitches.",es:"Corregidos fallos ocasionales al reordenar arrastrando."},{en:"Fixed missing labels in calendar tooltips.",es:"Corregidas etiquetas faltantes en los tooltips del calendario."}]}},{id:"2025.12.04",version:"2.6.0",title:{en:"Project Clarity",es:"Claridad de proyecto"},date:"2025-12-04",summary:{en:"Better project visibility and smarter filters.",es:"Mejor visibilidad de proyectos y filtros m\xE1s inteligentes."},sections:{new:[{en:"Enhanced project filters for recency.",es:"Filtros de proyectos mejorados por recencia."},{en:"Quick access backlog button in Kanban.",es:"Bot\xF3n de acceso r\xE1pido al backlog en Kanban."}],improvements:[{en:"Refined status badges for contrast.",es:"Insignias de estado refinadas para mejor contraste."},{en:"Clearer labels across filters and chips.",es:"Etiquetas m\xE1s claras en filtros y chips."}],fixes:[{en:"Fixed filter chips not clearing on reset.",es:"Corregido que los chips de filtros no se limpiaban al restablecer."},{en:"Resolved layout shifts in mobile task list.",es:"Corregidos saltos de dise\xF1o en la lista de tareas m\xF3vil."}]}}];var er="debugLogsEnabled",bo=new Map,qc=typeof window<"u"&&typeof window.__pageLoadStart=="number"?window.__pageLoadStart:typeof performance<"u"?performance.now():Date.now();function zc(){let e=typeof performance<"u"?performance.now():Date.now();return Math.round(e-qc)}function Te(e,t){if(!gt())return;let a=zc();console.log(`[perf] ${e} @ ${a}ms`,t||"")}function yn(e){let t=!!e;window.debugLogsEnabled=t;try{localStorage.setItem(er,String(t))}catch{}}function gt(){if(typeof window.debugLogsEnabled=="boolean")return window.debugLogsEnabled;try{return localStorage.getItem(er)==="true"}catch{return!1}}function vn(e,t,a){gt()&&(a?console.log(`[debug:${e}] ${t}`,a):console.log(`[debug:${e}] ${t}`))}function ke(e,t,a){if(!gt())return;let n=`${e}:${t}:${Date.now()}-${Math.random().toString(36).slice(2)}`;return bo.set(n,typeof performance<"u"&&performance.now?performance.now():Date.now()),vn(e,`${t}:start`,a),n}function ye(e,t,a){if(!gt())return;let n=bo.get(t);if(n==null)return;bo.delete(t);let o=typeof performance<"u"&&performance.now?performance.now():Date.now();vn(e,"duration",{durationMs:Math.round(o-n),...a})}function Gt(e,t="info"){let a=document.createElement("div");a.className=`notification notification-${t}`,a.style.cssText=`
        position: fixed;
        bottom: 24px;
        right: 24px;
        padding: 16px 24px;
        background: ${t==="error"?"var(--accent-red)":t==="success"?"var(--accent-green)":"var(--accent-blue)"};
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 10001;
        font-size: 14px;
        font-weight: 500;
        max-width: 400px;
        animation: slideIn 0.3s ease-out;
    `,a.textContent=e,document.body.appendChild(a),setTimeout(()=>{a.style.animation="slideOut 0.3s ease-out",setTimeout(()=>a.remove(),300)},4e3)}function W(e){Gt(e,"error")}function Xe(e){Gt(e,"success")}function tr(e){return new Promise((t,a)=>{let n=new FileReader;n.onload=o=>t(o.target.result),n.onerror=o=>a(o),n.readAsDataURL(e)})}async function ar(e,t){let a=await fetch(`/api/files?key=${encodeURIComponent(e)}`,{method:"POST",headers:{"Content-Type":"text/plain"},body:t});if(!a.ok){let n=`Failed to upload file: ${a.status} ${a.statusText}`;try{let o=await a.json();o.message&&(n=o.message),o.troubleshooting&&(n+=`

Troubleshooting: `+o.troubleshooting)}catch{}throw new Error(n)}}async function La(e){let t=await fetch(`/api/files?key=${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`Failed to download file: ${t.status} ${t.statusText}`);return await t.text()}async function ko(e){let t=await fetch(`/api/files?key=${encodeURIComponent(e)}`,{method:"DELETE"});if(!t.ok)throw new Error(`Failed to delete file: ${t.status} ${t.statusText}`)}function nr(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(String(e||"").trim())}function Pa(e){if(!e||typeof e!="string")return"";let t=e.trim().match(/^(\d{1,2}):(\d{2})$/);if(!t)return"";let a=Number(t[1]),n=Number(t[2]);return!Number.isInteger(a)||!Number.isInteger(n)||a<0||a>23||n<0||n>59?"":`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`}function wo(e,t){let a=Pa(e);if(!a)return"";let[n,o]=a.split(":"),s=Number(n)*60+Number(o),r=Number(t)||1,c=(Math.round(s/r)*r%1440+1440)%1440,l=Math.floor(c/60),p=c%60;return`${String(l).padStart(2,"0")}:${String(p).padStart(2,"0")}`}function bn(e){let t=Pa(e);if(!t)return null;let[a,n]=t.split(":");return Number(a)*60+Number(n)}function or(e){let t=Math.max(0,Math.min(1439,Number(e))),a=Math.floor(t/60),n=t%60;return`${String(a).padStart(2,"0")}:${String(n).padStart(2,"0")}`}function So(e,t,a){let n=bn(e),o=bn(t),s=bn(a);return n==null||o==null||s==null?"":n<o?t:n>s?a:e}function ca(e){let t=Date.now();switch(e){case"5m":return t-300*1e3;case"30m":return t-1800*1e3;case"24h":return t-1440*60*1e3;case"week":return t-10080*60*1e3;case"month":return t-720*60*60*1e3;default:return null}}function Pt(e){let t=e&&(e.updatedAt||e.createdAt||e.createdDate)||"",a=new Date(t).getTime();return Number.isFinite(a)?a:0}function sr(e){let t=e&&(e.updatedAt||e.createdAt||e.createdDate)||"",a=new Date(t),n=a.getTime();if(!Number.isFinite(n)||n===0)return"";try{return a.toLocaleString(void 0,{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}catch{return a.toISOString().slice(0,16).replace("T"," ")}}function kn(e,t){let a=null;return function(...n){a&&clearTimeout(a),a=setTimeout(()=>e.apply(this,n),t)}}function la(e,t,a){a?e.add(t):e.delete(t)}function rr(){return new Date().toISOString().split("T")[0]}function ir(e,t){return t?e.title&&e.title.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t):!0}function cr(e,t){return t.size===0||t.has(e.status)}function lr(e,t){return t.size===0||t.has(e.priority)}function dr(e,t){return!!(t.size===0||e.projectId&&t.has(e.projectId.toString())||!e.projectId&&t.has("none"))}function ur(e,t){return!!(t.size===0||e.tags&&e.tags.some(a=>t.has(a))||(!e.tags||e.tags.length===0)&&t.has("none"))}function Hc(e,t,a){let n=new Date(a+"T00:00:00");switch(t){case"no-date":return!e.endDate||e.endDate==="";case"overdue":return e.endDate&&e.endDate<a;case"end-today":return e.endDate===a;case"end-tomorrow":{let o=new Date(n);return o.setDate(o.getDate()+1),e.endDate===o.toISOString().split("T")[0]}case"end-7days":{let o=new Date(n);return o.setDate(o.getDate()+7),e.endDate===o.toISOString().split("T")[0]}case"end-week":{let o=new Date(n);o.setDate(o.getDate()+7);let s=o.toISOString().split("T")[0];return e.endDate&&e.endDate>=a&&e.endDate<=s}case"end-month":{let o=new Date(n);o.setDate(o.getDate()+30);let s=o.toISOString().split("T")[0];return e.endDate&&e.endDate>=a&&e.endDate<=s}case"no-start-date":return!e.startDate||e.startDate==="";case"already-started":return e.startDate&&e.startDate<a&&e.status!=="done";case"start-today":return e.startDate===a;case"start-tomorrow":{let o=new Date(n);return o.setDate(o.getDate()+1),e.startDate===o.toISOString().split("T")[0]}case"start-7days":{let o=new Date(n);return o.setDate(o.getDate()+7),e.startDate===o.toISOString().split("T")[0]}case"start-week":{let o=new Date(n);o.setDate(o.getDate()+7);let s=o.toISOString().split("T")[0];return e.startDate&&e.startDate>=a&&e.startDate<=s}case"start-month":{let o=new Date(n);o.setDate(o.getDate()+30);let s=o.toISOString().split("T")[0];return e.startDate&&e.startDate>=a&&e.startDate<=s}default:return!0}}function pr(e,t,a){return t.size===0?!0:Array.from(t).some(n=>Hc(e,n,a))}function mr(e,t,a,n="endDate"){if(!t&&!a)return!0;let o=n==="startDate"?e.startDate:e.endDate;return o?t&&a?t===a?o===a:o>=t&&o<=a:t?o>=t:a?o<=a:!0:!1}function fr(e,t){let{search:a="",statuses:n=new Set,priorities:o=new Set,projects:s=new Set,tags:r=new Set,datePresets:i=new Set,dateFrom:c="",dateTo:l="",dateField:p="endDate"}=t,u=rr(),f=a.toLowerCase();return e.filter(m=>{if(!ir(m,f)||!cr(m,n)||!lr(m,o)||!dr(m,s)||!ur(m,r))return!1;if(i.size>0){if(!pr(m,i,u))return!1}else if((c||l)&&!mr(m,c,l,p))return!1;return!0})}function gr(e,t){let a=new Date().toISOString().split("T")[0],n=e.filter(m=>m.status!=="backlog"),o=n.length,s=n.filter(m=>m.status==="done").length,r=o>0?Math.round(s/o*100):0,i=n.filter(m=>m.status==="progress").length,c=n.filter(m=>m.status==="todo").length,l=n.filter(m=>m.status==="review").length,p=n.filter(m=>m.endDate&&m.endDate<a&&m.status!=="done").length,u=n.filter(m=>m.priority==="high"&&m.status!=="done").length,f=t.filter(m=>m.endDate).length;return{activeProjects:t.length,totalTasks:o,completedTasks:s,completionRate:r,inProgressTasks:i,pendingTasks:c,reviewTasks:l,overdueTasks:p,highPriorityTasks:u,milestones:f}}function hr(e,t){let a=new Date().toISOString().split("T")[0],n=new Date,o=e.filter(u=>u.status!=="backlog"),s=new Date;s.setDate(s.getDate()-7);let r=o.filter(u=>u.status!=="done"||!u.completedDate?!1:new Date(u.completedDate)>s).length,i=o.filter(u=>!u.endDate||u.status==="done"?!1:new Date(u.endDate).toDateString()===n.toDateString()).length,c=o.filter(u=>u.status!=="done"&&u.endDate&&u.endDate<a).length,l=o.filter(u=>{if(u.status==="done"||u.priority!=="high"||!u.endDate)return!1;let f=new Date(n.getFullYear(),n.getMonth(),n.getDate()),m=new Date(u.endDate),g=new Date(m.getFullYear(),m.getMonth(),m.getDate());return Math.round((g-f)/(1e3*60*60*24))<=7}).length,p=t.filter(u=>{let f=e.filter(g=>g.projectId===u.id),m=f.filter(g=>g.status==="done");return f.length>0&&m.length===f.length}).length;return{thisWeekCompleted:r,dueTodayCount:i,overdueCount:c,criticalHighPriority:l,completedProjects:p,progressChange:Math.max(1,Math.floor(o.length*.1))}}function yr(e,t,a=5){return e.slice(0,a).map(n=>{let o=Number(n?.id),s=t.filter(u=>Number(u?.projectId)===o&&u.status!=="backlog"),r=s.filter(u=>u.status==="done").length,i=s.filter(u=>u.status==="progress").length,c=s.filter(u=>u.status==="review").length,l=s.filter(u=>u.status==="todo").length,p=s.length;return{id:n.id,name:n.name,completed:r,inProgress:i,review:c,todo:l,total:p,completedPercent:p>0?r/p*100:0,inProgressPercent:p>0?i/p*100:0,reviewPercent:p>0?c/p*100:0,todoPercent:p>0?l/p*100:0}})}function vr(e,t){let{tasksLabel:a}=t;return e.map(n=>`
        <div class="progress-bar-item clickable-project" data-action="showProjectDetails" data-param="${n.id}" style="cursor: pointer; transition: all 0.2s ease;">
            <div class="project-progress-header">
                <span class="project-name">${n.name}</span>
                <span class="task-count">${n.completed}/${n.total} ${a}</span>
            </div>
            <div style="height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; display: flex;">
                <div style="background: var(--accent-green); width: ${n.completedPercent}%; transition: width 0.5s ease;"></div>
                <div style="background: var(--accent-blue); width: ${n.inProgressPercent}%; transition: width 0.5s ease;"></div>
                <div style="background: var(--accent-amber); width: ${n.reviewPercent}%; transition: width 0.5s ease;"></div>
                <div style="background: var(--text-muted); width: ${n.todoPercent}%; transition: width 0.5s ease;"></div>
            </div>
        </div>
    `).join("")}function br(e,t){return e.map(a=>`
        <div class="activity-item">
            <div class="activity-icon ${a.type}">${a.icon}</div>
            <div class="activity-content">
                <div class="activity-text">${a.text}</div>
            </div>
            <div class="activity-date">${t(a.date)}</div>
        </div>
    `).join("")}function Uc(e,t){if(!e)return{hasDate:!1,urgency:"none",bgColor:null,textColor:"var(--text-muted)",borderColor:null,icon:"",iconColor:""};let a=new Date;a.setHours(0,0,0,0);let n=new Date(e);n.setHours(0,0,0,0);let o=n-a,s=Math.ceil(o/(1e3*60*60*24));return t==="done"?{hasDate:!0,urgency:"completed",diffDays:s,bgColor:"rgba(148, 163, 184, 0.12)",textColor:"#94a3b8",borderColor:"rgba(148, 163, 184, 0.25)",icon:"",iconColor:""}:s<0?{hasDate:!0,urgency:"overdue",diffDays:s,bgColor:"rgba(249, 115, 22, 0.2)",textColor:"#fb923c",borderColor:"rgba(249, 115, 22, 0.4)",icon:"\u26A0 ",iconColor:"#f97316"}:s<=7?{hasDate:!0,urgency:"soon",diffDays:s,bgColor:"rgba(192, 132, 252, 0.25)",textColor:"#c084fc",borderColor:"rgba(192, 132, 252, 0.5)",icon:"",iconColor:""}:{hasDate:!0,urgency:"normal",diffDays:s,bgColor:"rgba(59, 130, 246, 0.15)",textColor:"#93c5fd",borderColor:"rgba(59, 130, 246, 0.3)",icon:"",iconColor:""}}function kr(e,t){let{escapeHtml:a,formatDate:n,getProjectColor:o,getTagColor:s,getPriorityLabel:r,projects:i,selectedCards:c,showProjects:l=!0,showNoDate:p=!0,noProjectText:u,noDateText:f}=t,m=i.find(D=>D.id===e.projectId),g=m?m.name:u,h=e.endDate?n(e.endDate):f,k=Uc(e.endDate,e.status),v;if(k.hasDate){let{bgColor:D,textColor:E,borderColor:T,icon:A,iconColor:z}=k;v=`<span style="
            background: ${D};
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            color: ${E};
            border: 1px solid ${T};
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            text-decoration: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        ">${A?`<span style="color: ${z};">${A}</span>`:""}${a(h)}</span>`}else v=p?`<span style="color: var(--text-muted); font-size: 12px;">${h}</span>`:"";let S=c&&c.has(e.id)?" selected":"",j=m?`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${o(m.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`:"",w=`<div style="display: flex; flex-wrap: wrap; align-items: center; gap: 4px; margin-top: 12px;">
        ${e.tags&&e.tags.length>0?e.tags.map(D=>`<span style="background-color: ${s(D)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${a(D.toUpperCase())}</span>`).join(""):""}
        <span style="margin-left: auto;">${v}</span>
    </div>`;return`
        <div class="task-card${S}" draggable="true" data-task-id="${e.id}">
            <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 8px;">
                <div class="task-title" style="flex: 1;">${j}${a(e.title||"")}</div>
                <div class="task-priority priority-${e.priority}" style="flex-shrink: 0;">${r(e.priority||"").toUpperCase()}</div>
            </div>
            ${l?`
            <div style="margin-top:8px; font-size:12px;">
                ${m?`<span style="background-color: ${o(m.id)}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11px; font-weight: 500; display: inline-block; max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${a(m.name)}">${a(m.name)}</span>`:`<span style="color: var(--text-muted);">${u}</span>`}
            </div>
            `:""}
            ${w}
        </div>
    `}function wr(e,t=!1){let a={backlog:[],todo:[],progress:[],review:[],done:[]};return e.forEach(n=>{n.status==="backlog"&&!t||a[n.status]&&a[n.status].push(n)}),a}function Sr(e){return[...e].sort((t,a)=>{let n=se[t.priority]||0;return(se[a.priority]||0)-n})}function _c(e,t){if(!t||t.length===0)return Sr(e);let a=new Map(t.map((n,o)=>[n,o]));return[...e].sort((n,o)=>{let s=a.has(n.id)?a.get(n.id):9999,r=a.has(o.id)?a.get(o.id):9999;if(s!==r)return s-r;let i=se[n.priority]||0;return(se[o.priority]||0)-i})}function Er(e,t,a=null){let n={};return Object.keys(e).forEach(o=>{t==="manual"&&a&&a[o]?n[o]=_c(e[o],a[o]):n[o]=Sr(e[o])}),n}function Dr(e){return{backlog:e.backlog?e.backlog.length:0,todo:e.todo?e.todo.length:0,progress:e.progress?e.progress.length:0,review:e.review?e.review.length:0,done:e.done?e.done.length:0}}function Vc(e,t,a){return t===null?e:e.filter(n=>a(n)>=t)}function Tr(e,t={}){let{showBacklog:a=!1,sortMode:n="priority",manualTaskOrder:o=null,updatedCutoff:s=null,getTaskUpdatedTime:r=null}=t,i=e;s!==null&&r&&(i=Vc(e,s,r));let c=wr(i,a),l=Er(c,n,o),p=Dr(l);return{byStatus:l,counts:p,totalFiltered:i.length,totalOriginal:e.length}}function xr(e,t){return e.map(a=>kr(a,t)).join("")}function jr(e){return[...e].sort((t,a)=>{let n=se[t.priority]||0,o=se[a.priority]||0;if(n!==o)return o-n;let s=t.endDate?new Date(t.endDate):null,r=a.endDate?new Date(a.endDate):null;return s&&r?s-r:s&&!r?-1:!s&&r?1:0})}function Ir(e,t,a=[],n=null){switch(t){case"title":return(e.title||"").toLowerCase();case"status":return(ia||{backlog:0,todo:1,progress:2,review:3,done:4})[e.status]??0;case"priority":return{low:0,medium:1,high:2}[e.priority]??0;case"project":{let o=a.find(s=>s.id===e.projectId);return o?o.name.toLowerCase():""}case"startDate":return e.startDate||"";case"endDate":return e.endDate||"";case"updatedAt":return n?n(e):0;default:return""}}function Cr(e,t,a,n=[],o=null){return t?[...e].sort((s,r)=>{let i=Ir(s,t,n,o),c=Ir(r,t,n,o);return i<c?a==="asc"?-1:1:i>c?a==="asc"?1:-1:0}):e}function Lr(e,t=null){if(!e)return{text:null,class:"",showPrefix:!1,hasDate:!1};let a=new Date;a.setHours(0,0,0,0);let n=new Date(e);n.setHours(0,0,0,0);let o=n-a,s=Math.ceil(o/(1e3*60*60*24));return s<0?t==="done"?{text:null,class:"",showPrefix:!0,hasDate:!0,diffDays:s,urgency:"completed"}:{text:null,class:"overdue",showPrefix:!0,hasDate:!0,diffDays:s,daysOverdue:Math.abs(s),urgency:"overdue"}:s===0?{text:null,class:"today",showPrefix:!0,hasDate:!0,diffDays:s,urgency:"today"}:s===1?{text:null,class:"soon",showPrefix:!0,hasDate:!0,diffDays:s,urgency:"tomorrow"}:s<=7?{text:null,class:"soon",showPrefix:!0,hasDate:!0,diffDays:s,urgency:"soon"}:{text:null,class:"",showPrefix:!0,hasDate:!0,diffDays:s,urgency:"normal"}}function Wc(e,t){let{escapeHtml:a,formatDate:n,getTagColor:o,getProjectColor:s,getPriorityLabel:r,getStatusLabel:i,formatTaskUpdatedDateTime:c,projects:l,noProjectText:p,noDateText:u}=t,f=`status-badge ${e.status}`,m=l.find(w=>w.id===e.projectId),g=m?m.name:p,h=e.startDate?n(e.startDate):u,k=e.endDate?n(e.endDate):u,v=c(e)||"",L=e.priority?r(e.priority):"",S=e.tags&&e.tags.length>0?e.tags.map(w=>`<span style="background-color: ${o(w)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; margin-right: 4px; font-weight: 500;">${a(w.toUpperCase())}</span>`).join(""):"",j=m?`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${s(m.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`:"";return`
        <tr data-action="openTaskDetails" data-param="${e.id}">
            <td>${j}${a(e.title||"")}</td>
            <td><span class="priority-badge priority-${e.priority}">${L}</span></td>
            <td><span class="${f}">${i(e.status).toUpperCase()}</span></td>
            <td>${S||'<span style="color: var(--text-muted); font-size: 12px;">-</span>'}</td>
            <td>${a(g)}</td>
            <td>${h}</td>
            <td>${k}</td>
            <td>${a(v)}</td>
        </tr>
    `}function Pr(e,t){return e.map(a=>Wc(a,t)).join("")}function Ar(e,t={}){let{currentSort:a=null,projects:n=[],updatedCutoff:o=null,getTaskUpdatedTime:s=null}=t,r=e;o!==null&&s&&(r=e.filter(c=>s(c)>=o));let i=jr(r);return a&&a.column&&(i=Cr(i,a.column,a.direction,n,s)),{tasks:i,count:i.length,totalOriginal:e.length}}function Eo(e,t){let a=new Date(e,t,1).getDay();a=(a+6)%7;let n=new Date(e,t+1,0).getDate(),o=new Date(e,t,0).getDate(),s=a+n,r=Math.ceil(s/7)*7,i=r-s;return{firstDayOfWeek:a,daysInMonth:n,daysInPrevMonth:o,totalCells:s,cellsNeeded:r,nextMonthDays:i,totalRows:Math.ceil(r/7)}}function Br(e,t,a={}){let{today:n=new Date}=a,o=Eo(e,t),s=[],r=n.getMonth()===t&&n.getFullYear()===e,i=n.getDate(),c=0;for(let l=o.firstDayOfWeek-1;l>=0;l--){let p=o.daysInPrevMonth-l;s.push({day:p,type:"prev-month",row:Math.floor(c/7),column:c%7,isWeekend:c%7>=5,dateStr:null}),c++}for(let l=1;l<=o.daysInMonth;l++){let p=$r(e,t,l),u=r&&l===i,f=c%7;s.push({day:l,type:"current-month",row:Math.floor(c/7),column:f,isWeekend:f>=5,isToday:u,dateStr:p}),c++}for(let l=1;l<=o.nextMonthDays;l++)s.push({day:l,type:"next-month",row:Math.floor(c/7),column:c%7,isWeekend:c%7>=5,dateStr:null}),c++;return s}function $r(e,t,a){return`${e}-${String(t+1).padStart(2,"0")}-${String(a).padStart(2,"0")}`}function Gc(e,t){if(!t.startDate)return!1;let a=new Date(e),n=new Date(t.startDate),o=t.endDate?new Date(t.endDate):new Date(t.startDate);return a>=n&&a<=o}function Nr(e,t,a=null){return t.filter(n=>a&&!a.has(n.id)?!1:Gc(e,n)).length}function Fr(e,t,a={}){let{includeBacklog:n=!1,useStartDate:o=!1}=a;return t.filter(s=>!n&&s.status==="backlog"?!1:!!(s.endDate===e||o&&s.startDate===e))}function Mr(e,t,a){let n=t+a,o=e;return n<0?(n=11,o--):n>11&&(n=0,o++),{year:o,month:n}}function Rr(e,t,a=new Date){return a.getMonth()===t&&a.getFullYear()===e}function Or(e,t,a={}){let{tasks:n=[],projects:o=[],filteredProjectIds:s=null,includeBacklog:r=!1,today:i=new Date}=a,c=Eo(e,t),p=Br(e,t,{today:i}).map(u=>{if(u.type!=="current-month")return{...u,taskCount:0,projectCount:0};let f=Fr(u.dateStr,n,{includeBacklog:r}),m=Nr(u.dateStr,o,s);return{...u,taskCount:f.length,projectCount:m,hasProjects:m>0}});return{year:e,month:t,grid:c,days:p,isCurrentMonth:Rr(e,t,i),totalRows:c.totalRows}}function Yc(e){return e.map((t,a)=>`<div class="calendar-day-header${a>=5?" weekend":""}">${t}</div>`).join("")}function Kc(e){let{day:t,dateStr:a,type:n,row:o,isToday:s,isWeekend:r,hasProjects:i}=e;return n!=="current-month"?`<div class="calendar-day other-month" data-row="${o}">
            <div class="calendar-day-number">${t}</div>
            <div class="project-spacer" style="height:0px;"></div>
        </div>`:`<div class="calendar-day${s?" today":""}${r?" weekend":""}" data-row="${o}" data-action="showDayTasks" data-param="${a}" data-has-project="${i}">
        <div class="calendar-day-number">${t}</div>
        <div class="project-spacer" style="height:0px;"></div>
        <div class="tasks-container"></div>
    </div>`}function qr(e,t){let{days:a}=e,n=Yc(t);return a.forEach((o,s)=>{let r=Math.floor(s/7),i=s%7>=5;n+=Kc({...o,row:r,isWeekend:i})}),n}function zr(e,t){let a=e.filter(o=>o.projectId===t),n={total:a.length,backlog:0,todo:0,progress:0,review:0,done:0};return a.forEach(o=>{n.hasOwnProperty(o.status)&&n[o.status]++}),n}function Jc(e){return[...e].sort((t,a)=>{let n=se[t.priority||"low"]||1,o=se[a.priority||"low"]||1;if(n!==o)return o-n;let s=ia[t.status||"todo"]||4,r=ia[a.status||"todo"]||4;return s-r})}function Hr(e,t,a){let{escapeHtml:n,formatDatePretty:o,getProjectColor:s,getProjectStatus:r,getProjectStatusLabel:i,getTagColor:c,getPriorityLabel:l,getStatusLabel:p,getLocale:u,t:f}=a,m=t.filter(H=>H.projectId===e.id),g=zr(t,e.id),{done:h,progress:k,review:v,todo:L,backlog:S,total:j}=g,w=j>0?h/j*100:0,D=j>0?Math.round(h/j*100):0,E=s(e.id),T=r(e.id),A=Jc(m),z=A.length>0?A.map(H=>{let b=H.priority||"low",B=H.startDate&&H.startDate!=="",_=H.endDate&&H.endDate!=="",G="";return B&&_?G=`<span class="date-badge">${o(H.startDate,u())}</span><span class="date-arrow">\u2192</span><span class="date-badge">${o(H.endDate,u())}</span>`:_?G=`<span class="date-badge">${o(H.endDate,u())}</span>`:B&&(G=`<span class="date-badge">${o(H.startDate,u())}</span>`),`
                <div class="expanded-task-item" data-action="openTaskDetails" data-param="${H.id}" data-stop-propagation="true">
                    <div class="expanded-task-info">
                        <div class="expanded-task-name">${n(H.title)}</div>
                        ${G||H.tags&&H.tags.length>0?`
                            <div class="expanded-task-meta">
                                ${H.tags&&H.tags.length>0?`
                                    <div class="task-tags">
                                        ${H.tags.map(Y=>`<span style="background-color: ${c(Y)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${n(Y.toUpperCase())}</span>`).join(" ")}
                                    </div>
                                `:""}
                                ${G?`<div class="expanded-task-dates">${G}</div>`:""}
                            </div>
                        `:""}
                    </div>
                    <div class="expanded-task-priority">
                        <div class="priority-chip priority-${b}">${l(b)}</div>
                    </div>
                    <div class="expanded-task-status-col">
                        <div class="expanded-task-status ${H.status}">${p(H.status)}</div>
                    </div>
                </div>
            `}).join(""):`<div class="no-tasks-message">${f("tasks.noTasksInProject")}</div>`;return`
        <div class="project-list-item" id="project-item-${e.id}">
            <div class="project-row" data-action="toggleProjectExpand" data-param="${e.id}">
                <div class="project-chevron">\u25B8</div>
                <div class="project-info">
                    <div class="project-swatch" style="background: ${E};"></div>
                    <div class="project-name-desc">
                        <div class="project-title project-title-link" data-action="showProjectDetails" data-param="${e.id}" data-stop-propagation="true">${n(e.name||f("projects.untitled"))}</div>
                        ${e.tags&&e.tags.length>0?`
                            <div class="project-tags-row">
                                ${e.tags.map(H=>`<span class="project-tag" style="background-color: ${s(e.id)};">${n(H.toUpperCase())}</span>`).join("")}
                            </div>
                        `:""}
                        <div class="project-description">${n(e.description||f("projects.noDescription"))}</div>
                    </div>
                </div>
                <div class="project-status-col">
                    <span class="project-status-badge ${T}">${i(T).toUpperCase()}</span>
                </div>
                <div class="project-progress-col">
                    <div class="progress-bar-wrapper">
                        <div class="progress-segment done" style="width: ${w}%;"></div>
                    </div>
                    <div class="progress-percent">${D}%</div>
                </div>
                <div class="project-tasks-col">
                    <span class="project-tasks-breakdown">${f("projects.tasksBreakdown",{total:j,done:h})}</span>
                </div>
                <div class="project-dates-col">
                    <span class="date-badge">${o(e.startDate,u())}</span>
                    <span class="date-arrow">\u2192</span>
                    <span class="date-badge">${o(e.endDate,u())}</span>
                </div>
            </div>
            <div class="project-tasks-expanded">
                <div class="expanded-tasks-container">
                    <div class="expanded-tasks-header">
                        <span>\u{1F4CB} ${f("projects.details.tasksTitle",{count:j})}</span>
                        <button class="add-btn expanded-add-task-btn" type="button" data-action="openTaskModalForProject" data-param="${e.id}" data-stop-propagation="true">${f("tasks.addButton")}</button>
                    </div>
                    ${z}
                </div>
            </div>
        </div>
    `}function Ur(e,t={}){let{startDateWasEverSet:a=!1,endDateWasEverSet:n=!1}=t,o=Array.isArray(e?.tags)&&e.tags.length>0,s=typeof e?.startDate=="string"&&e.startDate.trim()!=="",r=typeof e?.endDate=="string"&&e.endDate.trim()!=="",i=Array.isArray(e?.attachments)&&e.attachments.some(f=>f.type==="link"||f.url&&f.type!=="file");return{hasTags:o,hasStartDate:s,hasEndDate:r,hasLinks:i,startDateInGeneral:a||s,endDateInGeneral:n||r,tagsInGeneral:o,linksInGeneral:i}}function _r(e){return e.hasTags&&e.hasLinks}function Zc(e,t){let{isMobile:a=!1,getTagColor:n,escapeHtml:o}=t,s=a?"3px 6px":"4px 8px",r=a?"11px":"12px",i="4px",c=a?"12px":"14px",l=a?"1.2":"1.4";return`
        <span class="task-tag" style="background-color: ${n(e)}; color: white; padding: ${s}; border-radius: 4px; font-size: ${r}; display: inline-flex; align-items: center; gap: ${i}; line-height: ${l};">
            ${o(e.toUpperCase())}
            <button type="button" data-action="removeTag" data-param="${o(e)}" style="background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${c}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;">\xD7</button>
        </span>
    `}function Vr(e,t){let{noTagsText:a="No tags"}=t;return!e||e.length===0?`<span style="color: var(--text-muted); font-size: 13px;">${a}</span>`:e.map(n=>Zc(n,t)).join("")}function Wr(e){document.addEventListener("click",t=>{let a=t.target.closest("[data-action]");if(!a)return;let n=a.dataset.action,o=a.dataset.param,s=a.dataset.param2,r={toggleTheme:()=>e.toggleTheme(),showCalendarView:()=>e.showCalendarView(),toggleKanbanSettings:()=>e.toggleKanbanSettings(t),openProjectModal:()=>e.openProjectModal(),openTaskModal:()=>e.openTaskModal(),openSettingsModal:()=>{e.closeUserDropdown(),e.openSettingsModal()},openTaskModalForProject:()=>e.openTaskModalForProject(parseInt(o)),openSelectedProjectFromTask:()=>e.openSelectedProjectFromTask(),closeModal:()=>e.closeModal(o),closeTaskModal:()=>e.closeTaskModal(),closeConfirmModal:()=>e.closeConfirmModal(),closeFeedbackDeleteModal:()=>e.closeFeedbackDeleteModal(),closeProjectConfirmModal:()=>e.closeProjectConfirmModal(),closeUnsavedChangesModal:()=>e.closeUnsavedChangesModal(),closeDayItemsModal:()=>e.closeDayItemsModal(),closeDayItemsModalOnBackdrop:()=>e.closeDayItemsModalOnBackdrop(t),openTaskDetails:()=>{a.dataset.stopPropagation&&t.stopPropagation();let i=parseInt(o),c=a.closest("#project-tasks-list");if(c){let p=document.getElementById("project-details");if(p&&p.classList.contains("active")){let f=Array.from(c.querySelectorAll(".project-task-item[data-param]")).map(g=>parseInt(g.dataset.param)),m=f.indexOf(i);if(m!==-1&&f.length>1){let h=window.location.hash.match(/project-(\d+)/),v={projectId:h?parseInt(h[1]):null,taskIds:f,currentIndex:m};e.openTaskDetails(i,v);return}}}let l=a.closest(".expanded-task-item");if(l){let p=l.closest(".project-card-mobile"),u=null;if(p)u=parseInt(p.dataset.projectId);else{let f=l.closest(".project-list-item");if(f&&f.id){let m=f.id.match(/project-item-(\d+)/);m&&(u=parseInt(m[1]))}}if(u){let f=l.closest(".expanded-tasks-container");if(f){let g=Array.from(f.querySelectorAll(".expanded-task-item[data-param]")).map(k=>parseInt(k.dataset.param)),h=g.indexOf(i);if(h!==-1&&g.length>1){let k={projectId:u,taskIds:g,currentIndex:h};e.openTaskDetails(i,k);return}}}}e.openTaskDetails(i)},deleteTask:()=>e.deleteTask(),duplicateTask:()=>e.duplicateTask(),confirmDelete:()=>e.confirmDelete(),showProjectDetails:()=>{a.dataset.stopPropagation&&t.stopPropagation();let c=document.getElementById("dashboard").classList.contains("active")?"dashboard":"projects";e.showProjectDetails(parseInt(o),c)},toggleProjectExpand:()=>e.toggleProjectExpand(parseInt(o)),toggleProjectMenu:()=>e.toggleProjectMenu(t),editProjectTitle:()=>e.editProjectTitle(parseInt(o),s),saveProjectTitle:()=>e.saveProjectTitle(parseInt(o)),cancelProjectTitle:()=>e.cancelProjectTitle(),handleDeleteProject:()=>e.handleDeleteProject(parseInt(o)),handleDuplicateProject:()=>e.handleDuplicateProject(parseInt(o)),toggleProjectColorPicker:()=>e.toggleProjectColorPicker(parseInt(o)),updateProjectColor:()=>e.updateProjectColor(parseInt(o),s),openCustomProjectColorPicker:()=>e.openCustomProjectColorPicker(parseInt(o)),navigateToProjectStatus:()=>e.navigateToProjectStatus(parseInt(o),s),deleteProject:()=>e.deleteProject(),confirmProjectDelete:()=>e.confirmProjectDelete(),closeDuplicateProjectModal:()=>e.closeDuplicateProjectModal(),confirmDuplicateProject:()=>e.confirmDuplicateProject(),addFeedbackItem:()=>e.addFeedbackItem(),deleteFeedbackItem:()=>e.deleteFeedbackItem(parseInt(o)),confirmFeedbackDelete:()=>e.confirmFeedbackDelete(),toggleHistoryEntryInline:()=>e.toggleHistoryEntryInline(parseInt(o)),formatTaskText:()=>e.formatTaskText(o),insertTaskHeading:()=>e.insertTaskHeading(o),insertTaskDivider:()=>e.insertTaskDivider(),sortTable:()=>e.sortTable(o),toggleSortMode:()=>e.toggleSortMode(),changeMonth:()=>e.animateCalendarMonthChange(parseInt(o)),goToToday:()=>e.goToToday(),showDayTasks:()=>e.showDayTasks(o),addAttachment:()=>e.addAttachment(),addFileAttachment:()=>e.addFileAttachment(t),addTag:()=>e.addTag(),removeTag:()=>e.removeTag(o),addProjectTag:()=>e.addProjectTag(),removeProjectTag:()=>e.removeProjectTag(o),addProjectDetailsTag:()=>e.addProjectDetailsTag(o),removeProjectDetailsTag:()=>e.removeProjectDetailsTag(o),removeAttachment:()=>{e.removeAttachment(parseInt(o)),t.preventDefault()},openUrlAttachment:()=>{if(o)try{let i=decodeURIComponent(o);window.open(i,"_blank","noopener,noreferrer")}catch(i){console.error("Failed to open URL attachment:",i)}},downloadFileAttachment:()=>e.downloadFileAttachment(o,s,a.dataset.param3),viewFile:()=>e.viewFile(o,s,a.dataset.param3),viewImageLegacy:()=>e.viewImageLegacy(o,s),viewFeedbackScreenshot:()=>{if(o)try{let c=decodeURIComponent(o);e.viewImageLegacy(c,"Feedback Screenshot")}catch(i){console.error("Failed to open feedback screenshot",i),e.showErrorNotification&&e.showErrorNotification(e.t("error.openScreenshotFailed"))}},backToProjects:()=>e.backToProjects(),showAllActivity:()=>e.showAllActivity(),backToDashboard:()=>e.backToDashboard(),backToCalendar:()=>e.backToCalendar(),openUpdatesFromNotification:()=>e.openUpdatesFromNotification(),openDueTodayFromNotification:()=>e.openDueTodayFromNotification(),dismissKanbanTip:()=>e.dismissKanbanTip(),confirmDiscardChanges:()=>e.confirmDiscardChanges(),closeReviewStatusConfirmModal:()=>e.closeReviewStatusConfirmModal(),confirmDisableReviewStatus:()=>e.confirmDisableReviewStatus(),closeCalendarCreateModal:()=>e.closeCalendarCreateModal(),confirmCreateTask:()=>e.confirmCreateTask(),addTaskFromDayItemsModal:()=>e.addTaskFromDayItemsModal(),signOut:()=>e.signOut(),exportDashboardData:()=>e.exportDashboardData(),closeExportDataModal:()=>e.closeExportDataModal(),confirmExportData:()=>e.confirmExportData(),generateReport:()=>e.generateReport(),showStatusInfoModal:()=>{t.stopPropagation(),e.showStatusInfoModal()},stopPropagation:()=>t.stopPropagation(),closeModalOnBackdrop:()=>{t.target===a&&e.closeModal(o)},closeDayItemsAndOpenTask:()=>{e.closeDayItemsModal(),e.openTaskDetails(parseInt(o))},closeDayItemsAndShowProject:()=>{e.closeDayItemsModal(),e.showProjectDetails(parseInt(o),"calendar",{month:e.getCurrentMonth(),year:e.getCurrentYear()})},deleteFeedbackItemWithStop:()=>{e.deleteFeedbackItem(parseInt(o)),t.stopPropagation()}};r[n]?r[n]():console.warn(`No handler found for action: ${n}`)})}var te={projects:null,tasks:null,feedbackItems:null,feedbackIndex:null,projectCounter:null,taskCounter:null,feedbackCounter:null,projectsSortedView:null,selectedCards:null,lastSelectedCardId:null,projectToDelete:null,tempAttachments:null,projectNavigationReferrer:null,calendarNavigationState:null,previousPage:null,currentFeedbackScreenshotData:null,feedbackPendingPage:null,feedbackDonePage:null,settings:null};var dl=typeof performance<"u"?performance.now():Date.now(),ul="2.7.1",pl=`v${ul}`;function ml(){Object.entries({projects:()=>N,tasks:()=>C,feedbackItems:()=>oe,feedbackIndex:()=>Ke,projectCounter:()=>pt,taskCounter:()=>at,feedbackCounter:()=>Ht,projectsSortedView:()=>Mo,selectedCards:()=>Ro,lastSelectedCardId:()=>Oo,projectToDelete:()=>ea,tempAttachments:()=>$e,projectNavigationReferrer:()=>qe,calendarNavigationState:()=>Et,previousPage:()=>dt,currentFeedbackScreenshotData:()=>ya,feedbackPendingPage:()=>$t,feedbackDonePage:()=>Nt,settings:()=>F}).forEach(([t,a])=>{Object.defineProperty(te,t,{get:a,set:n=>{switch(t){case"projects":N=n;break;case"tasks":C=n;break;case"feedbackItems":oe=n;break;case"feedbackIndex":Ke=n;break;case"projectCounter":pt=n;break;case"taskCounter":at=n;break;case"feedbackCounter":Ht=n;break;case"projectsSortedView":Mo=n;break;case"selectedCards":Ro=n;break;case"lastSelectedCardId":Oo=n;break;case"projectToDelete":ea=n;break;case"tempAttachments":$e=n;break;case"projectNavigationReferrer":qe=n;break;case"calendarNavigationState":Et=n;break;case"previousPage":dt=n;break;case"currentFeedbackScreenshotData":ya=n;break;case"feedbackPendingPage":$t=n;break;case"feedbackDonePage":Nt=n;break;case"settings":F=n;break}},configurable:!0,enumerable:!0})})}ml();function xo(){te.selectedCards.clear(),te.lastSelectedCardId=null,document.querySelectorAll(".task-card.selected").forEach(e=>{e.classList.remove("selected")})}var fl=["en","es"];function Wn(e){return fl.includes(e)?e:"en"}function Mt(){return Wn(F.language||"en")}function It(){let e=Mt();return co[e]||co.en}function d(e,t){let a=Mt(),o=(on[a]||on.en)[e]||on.en[e]||e;return t?o.replace(/\{(\w+)\}/g,(s,r)=>Object.prototype.hasOwnProperty.call(t,r)?String(t[r]):s):o}function fi(e=document){e.querySelectorAll("[data-i18n]").forEach(a=>{let n=a.getAttribute("data-i18n");if(!n)return;let o=a.getAttribute("data-i18n-attr");o?o.split(",").map(s=>s.trim()).filter(Boolean).forEach(s=>{a.setAttribute(s,d(n))}):a.textContent=d(n)})}window.i18n={t:d,applyTranslations:fi,getCurrentLanguage:Mt};function We(e){return{backlog:d("tasks.status.backlog"),todo:d("tasks.status.todo"),progress:d("tasks.status.progress"),review:d("tasks.status.review"),done:d("tasks.status.done")}[e]||Xs[e]||e||""}function Gn(e){return{planning:d("projects.status.planning"),active:d("projects.status.active"),completed:d("projects.status.completed")}[e]||e||""}function ot(e){return{high:d("tasks.priority.high"),medium:d("tasks.priority.medium"),low:d("tasks.priority.low")}[e]||ot(e)||e||""}function gi(){F.language=Mt(),document.documentElement.lang=F.language,fi(),Vl();let e=document.getElementById("email-notification-timezone"),t=document.getElementById("email-notification-timezone-value");e&&t&&(t.textContent=e.options?.[e.selectedIndex]?.textContent||e.value||"");let a=document.getElementById("user-avatar-dropzone");a&&(a.dataset.defaultText=d("settings.avatarUploadDefault"),a.dataset.changeText=d("settings.avatarUploadChange"));let n=document.getElementById("workspace-logo-dropzone");n&&(n.dataset.defaultText=d("settings.logoUploadDefault"),n.dataset.changeText=d("settings.logoUploadChange"));let o=document.getElementById("attachment-file-dropzone");if(o){let c=window.innerWidth<=768,l=d(c?"tasks.modal.attachmentsDropzoneTap":"tasks.modal.attachmentsDropzoneDefault");o.dataset.defaultText=l;let p=o.querySelector(".task-attachment-dropzone-text");p&&(p.textContent=l)}let s=document.getElementById("feedback-screenshot-url");if(s){let c=typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:window.innerWidth<=768,l=d(c?"feedback.screenshotDropzoneTap":"feedback.screenshotDropzoneDefault");s.dataset.defaultText=l,s.dataset.hasInlineImage||(s.textContent=l)}vs(),ha(),document.dispatchEvent(new CustomEvent("refresh-workspace-logo-ui")),zi();try{yt()}catch{}try{Ja()}catch{}try{no()}catch{}try{Cc()}catch{}Hi(),ls(),en(),Rt(),Ui();try{sd()}catch{}let r=document.querySelector(".filter-chip.active")?.dataset?.period||"week";qi(r);let i=document.getElementById("activity-page");i&&i.classList.contains("active")&&ds();try{document.getElementById("projects")?.classList.contains("active")&&Ve(),document.getElementById("tasks")?.classList.contains("active")&&(Fe(),document.getElementById("list-view")?.classList.contains("active")&&Je()),document.getElementById("calendar")?.classList.contains("active")&&re(),document.getElementById("feedback")?.classList.contains("active")&&(mt(),vt())}catch{}}var et={hasPendingChange:!1,dataUrl:null},tt={hasPendingChange:!1,dataUrl:null},M={originalImage:null,originalDataUrl:null,canvas:null,ctx:null,selection:{x:0,y:0,size:0},isDragging:!1,isResizing:!1,dragStartX:0,dragStartY:0,activeHandle:null,shape:"square",outputMimeType:"image/jpeg",outputMaxSize:null,onApply:null,successMessage:null},Io=null,gl=typeof performance<"u"?performance.now():Date.now(),hl=typeof window<"u"&&typeof window.__pageLoadStart=="number"?window.__pageLoadStart:dl;Te("app-js-executed",{sinceNavStartMs:Math.round(gl-hl)});var N=[],C=[],oe=[],Ke=[],pt=1,at=1,Ht=1,Mo=null,Ro=new Set,Oo=null,ea=null,$e=[],qe="projects",Et=null,dt="",ya="",$t=1,Nt=1,it=10,Xo="feedbackItemsCache:v1",F={autoSetStartDateOnStatusChange:!1,autoSetEndDateOnStatusChange:!1,enableReviewStatus:!0,calendarIncludeBacklog:!1,debugLogsEnabled:!1,historySortOrder:"newest",language:"en",customWorkspaceLogo:null,notificationEmail:"",emailNotificationsEnabled:!0,emailNotificationsWeekdaysOnly:!1,emailNotificationsIncludeStartDates:!1,emailNotificationsIncludeBacklog:!1,emailNotificationTime:"09:00",emailNotificationTimeZone:"Atlantic/Canary"};["projects","tasks","feedbackItems","feedbackIndex","projectCounter","taskCounter","feedbackCounter","projectsSortedView","selectedCards","lastSelectedCardId","projectToDelete","tempAttachments","projectNavigationReferrer","calendarNavigationState","previousPage","currentFeedbackScreenshotData","feedbackPendingPage","feedbackDonePage","settings"].forEach(key=>{Object.defineProperty(te,key,{get:()=>eval(key),set:e=>{switch(key){case"projects":N=e;break;case"tasks":C=e;break;case"feedbackItems":oe=e;break;case"feedbackIndex":Ke=e;break;case"projectCounter":pt=e;break;case"taskCounter":at=e;break;case"feedbackCounter":Ht=e;break;case"projectsSortedView":Mo=e;break;case"selectedCards":Ro=e;break;case"lastSelectedCardId":Oo=e;break;case"projectToDelete":ea=e;break;case"tempAttachments":$e=e;break;case"projectNavigationReferrer":qe=e;break;case"calendarNavigationState":Et=e;break;case"previousPage":dt=e;break;case"currentFeedbackScreenshotData":ya=e;break;case"feedbackPendingPage":$t=e;break;case"feedbackDonePage":Nt=e;break;case"settings":F=e;break}},configurable:!0,enumerable:!0})});window.saveData=Ze;window.loadData=st;var Tt=!1,Ne=0,Fa=new Map;function Qr(e,t,a,n){let o=n||{},s=Number.isFinite(o.delayMs)?o.delayMs:500,r=`${e}:${t}`,i=Fa.get(r);i&&clearTimeout(i);let c=setTimeout(()=>{Fa.delete(r),aa(e,t,a,o)},s);Fa.set(r,c)}function ei(e,t,a,n){let o=`${e}:${t}`,s=Fa.get(o);s&&(clearTimeout(s),Fa.delete(o)),aa(e,t,a,n||{})}function Nm(){return!0}var hi="nautilusLastSeenReleaseId",yi="nautilusDueTodaySeen",vi="nautilusNotificationHistory",yl=30,vl=3e4,Qo="nautilusNotificationPendingSeen",Da=!0,Ce={timestamp:0,data:null},jo=!1;function ti(e){if(!e)return 0;let t=Me(e)?Ye(e):e,a=Date.parse(t);return Number.isNaN(a)?0:a}function Ba(e){if(!e)return"";if(typeof e=="string")return e;if(typeof e=="object"){let t=It(),a=t&&t.startsWith("es")?"es":"en";return e[a]||e.en||e.es||""}return String(e)}function bi(){return(Array.isArray(vo)?[...vo]:[]).sort((t,a)=>ti(a.date)-ti(t.date))}function es(){return bi()[0]||null}function bl(){try{return localStorage.getItem(hi)||""}catch{return""}}function ki(e){if(e)try{localStorage.setItem(hi,e)}catch{}}function ai(e){return e?hn(e,It()):""}function Ft(e){return e?rt(e)?e:Me(e)?Ye(e):"":""}function kl(){try{let e=localStorage.getItem(yi);if(!e)return null;let t=JSON.parse(e),a=new Date().toISOString().split("T")[0];return!t||t.date!==a||!Array.isArray(t.ids)?null:t}catch{return null}}function Fm(e){try{let t=new Date().toISOString().split("T")[0];localStorage.setItem(yi,JSON.stringify({date:t,ids:e||[]}))}catch{}}function Mm(e){if(!e||e.length===0)return 0;let t=kl();if(!t)return e.length;let a=new Set(t.ids||[]);return e.filter(n=>!n||!n.id||!a.has(n.id)).length}function Rm(){let e=new Date().toISOString().split("T")[0];return C.filter(t=>{if(!t||t.status==="done")return!1;let a=Ft(t.endDate||""),n=Ft(t.startDate||"");return a!==""&&a===e||n!==""&&n===e})}function jt(){try{let e=localStorage.getItem(vi);if(!e)return{notifications:[],lastChecked:null};let t=JSON.parse(e);return{notifications:Array.isArray(t.notifications)?t.notifications:[],lastChecked:t.lastChecked||null}}catch{return{notifications:[],lastChecked:null}}}function Wt(e){try{localStorage.setItem(vi,JSON.stringify(e))}catch{}}function $a(e,t,a){return`notif_${a}_${e}_${t}`}function Om(e,t){let a=jt(),n=$a("task_due",e,t);if(a.notifications.some(r=>r.id===n))return;let s={id:n,type:"task_due",taskId:e,date:t,read:!1,dismissed:!1,createdAt:new Date().toISOString()};a.notifications.push(s),Wt(a)}function wl(){if(!Array.isArray(C)||C.length===0)return;let e=ke("notifications","create-due-today",{taskCount:C.length}),t=new Date().toISOString().split("T")[0],a=jt(),n=new Set(a.notifications.map(c=>c.id)),o=[],s=F.emailNotificationsIncludeStartDates!==!1,r=!!F.emailNotificationsIncludeBacklog;C.forEach(c=>{if(!c||c.status==="done"||!c.id||c.status==="backlog"&&!r)return;let l=Ft(c.startDate||""),p=Ft(c.endDate||"");if(s&&l===t){let u=$a("task_starting",c.id,t);n.has(u)||o.push({id:u,type:"task_starting",taskId:c.id,date:t,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}if(p===t){let u=$a("task_due",c.id,t);n.has(u)||o.push({id:u,type:"task_due",taskId:c.id,date:t,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}});let i=7;for(let c=1;c<=i;c++){let l=new Date;l.setDate(l.getDate()-c);let p=l.toISOString().split("T")[0];C.forEach(u=>{if(!u||u.status==="done"||!u.id)return;let f=Ft(u.startDate||""),m=Ft(u.endDate||"");if(s&&f===p){let g=$a("task_starting",u.id,p);n.has(g)||o.push({id:g,type:"task_starting",taskId:u.id,date:p,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}if(m===p){let g=$a("task_due",u.id,p);n.has(g)||o.push({id:g,type:"task_due",taskId:u.id,date:p,read:!1,dismissed:!1,createdAt:new Date().toISOString()})}})}o.length>0&&a.notifications.push(...o),a.lastChecked=new Date().toISOString(),Wt(a),ye("notifications",e,{newCount:o.length,totalCount:a.notifications.length})}function qm(e){let t=jt(),a=t.notifications.find(n=>n.id===e);a&&(a.read=!0,Wt(t))}function Sl(){let e=jt();e.notifications.forEach(t=>{t.dismissed||(t.read=!0)}),Wt(e)}function zm(e){let t=jt(),a=t.notifications.find(n=>n.id===e);a&&(a.dismissed=!0,Wt(t))}function El(e){let t=jt();t.notifications.forEach(a=>{a.date===e&&(a.dismissed=!0)}),Wt(t)}function Dl(){let e=jt();e.notifications.forEach(t=>{t.dismissed=!0}),Wt(e)}function Tl(){let e=ke("notifications","cleanup"),t=jt(),a=t.notifications.length,n=new Date;n.setDate(n.getDate()-yl);let o=n.toISOString().split("T")[0];t.notifications=t.notifications.filter(s=>s.date>=o),Wt(t),ye("notifications",e,{beforeCount:a,afterCount:t.notifications.length})}function wi(){return jt().notifications.filter(t=>!t.dismissed)}function xl(){return wi().filter(t=>!t.read).length}function Il(){let t=wi().filter(o=>o.type==="task_due"||o.type==="task_starting"),a=new Map;return t.forEach(o=>{a.has(o.date)||a.set(o.date,[]),a.get(o.date).push(o)}),Array.from(a.entries()).sort((o,s)=>s[0].localeCompare(o[0]))}function ma(){let e=ke("notifications","build-state"),t=es(),a=bl(),n=!1,o=Il(),s=xl(),r={latest:t,releaseUnseen:n,taskNotificationsByDate:o,unreadCount:s};return ye("notifications",e,{unreadCount:s,taskGroups:o.length}),r}function Yn(){return window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken")}function Si(){let e=localStorage.getItem(Qo);if(!e)return null;try{let t=JSON.parse(e);return!t||!t.seenAt?null:t}catch{return null}}function Ma(e){!e||!e.seenAt||localStorage.setItem(Qo,JSON.stringify(e))}function Co(e,t=!1){let a=Si();if(!a){Ma({seenAt:e,clearAll:!!t});return}let n=new Date(a.seenAt).getTime(),o=new Date(e).getTime(),s={seenAt:Number.isFinite(n)&&Number.isFinite(o)&&n>o?a.seenAt:e,clearAll:!!(a.clearAll||t)};Ma(s)}async function jl(){if(!Da||jo)return;let e=Si();if(!e)return;let t=Yn();if(t){jo=!0;try{let a={seenAt:e.seenAt,clearAll:!!e.clearAll};e.dismissDate&&(a.dismissDate=e.dismissDate),(await fetch("/api/notifications/state",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`},body:JSON.stringify(a)})).ok&&localStorage.removeItem(Qo)}catch(a){console.warn("[notifications] failed to flush pending seen",a)}finally{jo=!1}}}async function Ha({force:e=!1}={}){if(Da){await jl();let t=Date.now();if(!e&&Ce.data&&t-Ce.timestamp<vl)return Ce.data;let a=Yn();if(a)try{let n=await fetch("/api/notifications/state",{headers:{Authorization:`Bearer ${a}`}});if(n.ok){let o=await n.json(),i={latest:es(),releaseUnseen:!1,taskNotificationsByDate:Array.isArray(o.taskNotificationsByDate)?o.taskNotificationsByDate:[],unreadCount:Number(o.unreadCount)||0};return Ce={timestamp:t,data:i},i}}catch(n){console.warn("[notifications] failed to fetch server state",n)}}return ma()}function Jt(e=ma()){let t=document.getElementById("notification-count");if(!t)return;let n=(e.releaseUnseen&&e.latest?1:0)+e.unreadCount;n>0?(t.textContent=n>99?"99+":String(n),t.classList.add("is-visible")):(t.textContent="",t.classList.remove("is-visible"))}function Cl(e){let t=new Date().toISOString().split("T")[0],a=new Date;a.setDate(a.getDate()-1);let n=a.toISOString().split("T")[0];return e===t?d("notifications.today")||"Today":e===n?d("notifications.yesterday")||"Yesterday":hn(e,It())}function va(e=ma()){let t=document.getElementById("notification-list");if(!t)return;let a=ke("notifications","render-dropdown",{taskGroups:e.taskNotificationsByDate.length,unreadCount:e.unreadCount}),n=[],o=new Map(N.map(i=>[i.id,i])),s=new Map(C.map(i=>[i.id,i])),r=!!F.emailNotificationsIncludeBacklog;e.taskNotificationsByDate.forEach(([i,c])=>{let l=Cl(i),p=c.filter(w=>w.type==="task_starting").map(w=>s.get(w.taskId)).filter(w=>w&&w.status!=="done"&&(r||w.status!=="backlog")).filter(w=>Ft(w.startDate||"")===i),u=c.filter(w=>w.type==="task_due").map(w=>s.get(w.taskId)).filter(w=>w&&w.status!=="done"&&(r||w.status!=="backlog")).filter(w=>Ft(w.endDate||"")===i);if(p.length===0&&u.length===0)return;let f=w=>[...w].sort((D,E)=>{let T=se[D.priority||"low"]||0,A=se[E.priority||"low"]||0;return T!==A?A-T:String(D.title||"").localeCompare(String(E.title||""))}),m=f(p),g=f(u),h=w=>w.slice(0,3).map(D=>{let E=D.projectId?o.get(D.projectId):null,T=E?E.name:"",A=E?Ie(E.id):"",z=(D.priority||"low").toLowerCase(),H=["high","medium","low"].includes(z)?ot(z):z||"";return`
                    <div class="notify-task" data-task-id="${D.id}">
                        <div class="notify-task-header">
                            <div class="notify-task-title">${q(D.title||d("tasks.untitled"))}</div>
                            <span class="notify-priority notify-priority--${z}">${q(H)}</span>
                        </div>
                    </div>
                `}).join(""),k="",v=0,L=0;if(m.length>0){let w=m.slice(0,3),D=Math.max(m.length-w.length,0);v+=m.length,L+=D,k+=`<div class="notify-section-subheader notify-section-subheader--starting">\u{1F680} STARTING <span class="notify-section-count notify-section-count--starting" aria-label="${m.length} starting tasks">${m.length}</span></div>`,k+=h(w),D>0&&(k+=`<div class="notify-task-overflow">+${D} more starting</div>`,k+=`<button type="button" class="notify-link notify-link--starting notify-link--full" data-action="openDueTodayFromNotification" data-date="${i}" data-date-field="startDate">View ${m.length} starting</button>`)}if(g.length>0){let w=g.slice(0,3),D=Math.max(g.length-w.length,0);v+=g.length,L+=D,m.length>0&&(k+='<div style="height: 1px; background: var(--border); margin: 10px 0;"></div>'),k+=`<div class="notify-section-subheader notify-section-subheader--due">\u{1F3AF} DUE <span class="notify-section-count notify-section-count--due" aria-label="${g.length} due tasks">${g.length}</span></div>`,k+=h(w),D>0&&(k+=`<div class="notify-task-overflow">+${D} more due</div>`,k+=`<button type="button" class="notify-link notify-link--due notify-link--full" data-action="openDueTodayFromNotification" data-date="${i}" data-date-field="endDate">View ${g.length} due</button>`)}let S=new Date().toISOString().split("T")[0],j=i===S;n.push(`
            <div class="notify-section notify-section--due" data-date="${i}">
                <div class="notify-section-heading">
                    <div class="notify-section-title">
                        <span class="notify-section-title-text">${l}</span>
                        ${j?"":`<div class="notify-section-title-actions"><button type="button" class="notify-dismiss-btn" data-action="dismissDate" data-date="${i}" aria-label="Dismiss" title="Dismiss">x</button></div>`}
                    </div>
                </div>
                <div class="notify-task-list">
                    ${k}
                </div>
            </div>
        `)}),n.length===0&&n.push(`<div class="notify-empty">${d("notifications.empty")}</div>`),t.innerHTML=n.join(""),ye("notifications",a,{sections:n.length,taskGroups:e.taskNotificationsByDate.length})}var Kt=null;function Rt({force:e=!1}={}){Kt&&clearTimeout(Kt),Kt=setTimeout(async()=>{let t=await Ha({force:e});Jt(t);let a=document.getElementById("notification-dropdown");a&&a.classList.contains("active")&&va(t),Kt=null},100)}async function Hm({force:e=!1}={}){Kt&&(clearTimeout(Kt),Kt=null);let t=await Ha({force:e});Jt(t);let a=document.getElementById("notification-dropdown");a&&a.classList.contains("active")&&va(t)}async function qo(e=null,{clearAll:t=!1}={}){if(e&&e.latest&&e.latest.id&&ki(e.latest.id),Da){let n=new Date().toISOString(),o=Yn();if(!o){Co(n,t);let r={...e||Ce.data||ma(),unreadCount:0};Ce={timestamp:Date.now(),data:r},Jt(r);return}if(o)try{if((await fetch("/api/notifications/state",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},body:JSON.stringify({seenAt:n,clearAll:!!t})})).ok){let i={...e||Ce.data||ma(),unreadCount:0};Ce={timestamp:Date.now(),data:i},Jt(i);return}Co(n,t)}catch(s){console.warn("[notifications] failed to mark seen",s),Co(new Date().toISOString(),t)}}Sl();let a=ma();Jt(a)}async function Ll(e){if(Da){let t=new Date().toISOString(),a=Yn();if(!a){if(Ma({seenAt:t,dismissDate:e}),Ce.data&&Ce.data.taskNotificationsByDate){let n={...Ce.data,taskNotificationsByDate:Ce.data.taskNotificationsByDate.filter(([o])=>o!==e)};Ce={timestamp:Date.now(),data:n},Jt(n),va(n)}return}try{if((await fetch("/api/notifications/state",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({seenAt:t,dismissDate:e})})).ok){if(Ce.data&&Ce.data.taskNotificationsByDate){let o={...Ce.data,taskNotificationsByDate:Ce.data.taskNotificationsByDate.filter(([s])=>s!==e)};Ce={timestamp:Date.now(),data:o},Jt(o),va(o)}return}Ma({seenAt:t,dismissDate:e})}catch(n){console.warn("[notifications] failed to dismiss date",n),Ma({seenAt:t,dismissDate:e})}}else El(e),Rt()}function Pl(){let e=es();!e||!e.id||(ki(e.id),Rt())}function Ot(){let e=document.getElementById("notification-dropdown"),t=document.getElementById("notification-toggle");e&&e.classList.remove("active"),t&&t.classList.remove("active"),Ei(!1)}function Ei(e){typeof window.matchMedia=="function"&&window.matchMedia("(max-width: 768px)").matches&&document.body.classList.toggle("notify-scroll-lock",!!e)}function Al(){let e=document.getElementById("notification-toggle"),t=document.getElementById("notification-dropdown");!e||!t||e.dataset.bound||(e.dataset.bound="true",e.addEventListener("click",async a=>{if(a.stopPropagation(),t.classList.contains("active")){Ot();return}tn();let o=await Ha({force:!0});va(o),t.classList.add("active"),e.classList.add("active"),Ei(!0),await qo(o)}),t.dataset.outsideListener||(t.dataset.outsideListener="true",document.addEventListener("click",a=>{if(!t.classList.contains("active"))return;let n=a.target;n&&(t.contains(n)||e.contains(n)||Ot())})),t.dataset.actionListener||(t.dataset.actionListener="true",t.addEventListener("click",async a=>{let n=a.target;if(!n)return;let o=n.closest(".notify-task");if(o&&o.dataset.taskId){a.preventDefault(),a.stopPropagation();let c=parseInt(o.dataset.taskId,10);isNaN(c)||(Ot(),xa(c));return}let s=n.closest("[data-action]");if(!s)return;a.preventDefault(),a.stopPropagation();let r=s.dataset.action,i=s.dataset.date;if(r==="dismissDate"&&i)await Ll(i);else if(r==="dismissAll")if(Da){let c=Ce.data||await Ha({force:!0});await qo(c,{clearAll:!0}),Rt({force:!0})}else Dl(),Rt();else if(r==="openUpdatesFromNotification")Di();else if(r==="openDueTodayFromNotification"&&i){let c=s.getAttribute("data-date-field")||"endDate";Ti(i,c)}})),Rt())}function Di(){if(Ot(),window.location.hash.replace("#","")==="updates"){ze("updates");return}window.location.hash="updates"}function Ti(e,t="endDate"){Ot();let a=new Date().toISOString().split("T")[0],n=e===a,s=!!F.emailNotificationsIncludeBacklog?"backlog,todo,progress,review":"todo,progress,review",r;if(n?r=`#tasks?view=list&datePreset=${t==="startDate"?"start-today":"end-today"}&status=${s}`:r=`#tasks?view=list&dateFrom=${e}&dateTo=${e}&dateField=${t}&status=${s}`,window.location.hash===r){ze("tasks");return}window.location.hash=r.replace("#","")}var De="priority",de={};function Bl(){De="priority",de={};let e=document.getElementById("sort-btn"),t=document.getElementById("sort-label"),a=document.getElementById("sort-icon");e&&e.classList.remove("manual"),t&&(t.textContent=d("tasks.sort.orderByPriority")),a&&(a.textContent="\u2B06\uFE0F"),Fe(),Na()}async function Na(){try{await Fs(De,de)}catch{try{localStorage.setItem("sortMode",De),localStorage.setItem("manualTaskOrder",JSON.stringify(de))}catch{}}}async function Um(){try{let{sortMode:e,manualTaskOrder:t}=await mo();e&&(De=e),t&&(de=t)}catch{try{let t=localStorage.getItem("sortMode"),a=localStorage.getItem("manualTaskOrder");t&&(De=t),a&&(de=JSON.parse(a))}catch{}}(De==="auto"||De!=="priority"&&De!=="manual")&&(De="priority"),yt()}function yt(){let e=document.getElementById("sort-toggle"),t=document.getElementById("sort-btn"),a=document.getElementById("sort-label"),n=document.getElementById("sort-icon"),o=document.getElementById("group-kanban-updated");if(!e||!t)return;let s=document.querySelector(".kanban-board"),r=s&&!s.classList.contains("hidden");e.style.display=r?"flex":"none";let i=document.getElementById("list-view")?.classList.contains("active"),c=document.getElementById("calendar-view")?.classList.contains("active"),l=r||i||c;o&&(o.style.display=l?"":"none");try{no()}catch{}try{t.classList.remove("manual")}catch{}a&&(a.textContent=d("tasks.sort.orderByPriority")),n&&(n.textContent="\u21C5");try{let p=window.kanbanShowBacklog===!0?["backlog","todo","progress","review","done"]:["todo","progress","review","done"],u=typeof kt=="function"?kt():C.slice(),f=ca(window.kanbanUpdatedFilter);f!==null&&(u=u.filter(h=>Pt(h)>=f));let m=(h,k)=>{if(h.length!==k.length)return!1;for(let v=0;v<h.length;v++)if(h[v]!==k[v])return!1;return!0},g=!0;for(let h of p){let v=Array.from(document.querySelectorAll(`#${h}-tasks .task-card`)).map(S=>parseInt(S.dataset.taskId,10)).filter(S=>!Number.isNaN(S)),L=u.filter(S=>S.status===h).slice().sort((S,j)=>(se[j.priority]||0)-(se[S.priority]||0)).map(S=>S.id);if(!m(v,L)){g=!1;break}}g?(t.disabled=!0,t.classList.add("disabled"),t.setAttribute("aria-disabled","true")):(t.disabled=!1,t.classList.remove("disabled"),t.removeAttribute("aria-disabled"))}catch{t.disabled=!1,t.classList.remove("disabled")}}async function $l(){if(!Tt){Ne++;try{await As(C,N,oe)}catch(e){throw console.error("Error persisting data:",e),W(d("error.saveDataFailed")),e}finally{Ne--}}}async function nt(){if(Tt)return;Ne++;let e=ke("storage","save-projects",{projectCount:N.length}),t=!1;try{await $s(N),t=!0}catch(a){throw console.error("Error saving projects:",a),W(d("error.saveProjectsFailed")),a}finally{ye("storage",e,{success:t,projectCount:N.length}),Ne--}}async function _e(){if(Tt)return;Ne++;let e=ke("storage","save-tasks",{taskCount:C.length}),t=!1;try{await Bs(C),t=!0}catch(a){throw console.error("Error saving tasks:",a),W(d("error.saveTasksFailed")),a}finally{ye("storage",e,{success:t,taskCount:C.length}),Ne--}}async function xi(){await uo(oe)}var In=null,fa=!1,jn=!1,Bn=0,Kn=!1,Jn=!1,ts=!1,Cn=null,Ln=[],Pn=[],Nl=500,Ii="feedbackDeltaQueue",Fl=1e3,Ml=1200,Rl=1e4,Sn=3,Ol=2e3,Le=[],An=!1,Lo=null,ua=null,En=null,Bt=0,zo=new Map;function Dn(e,t){gt()&&(t?console.log(`[feedback-debug] ${e}`,t):console.log(`[feedback-debug] ${e}`))}function ql(e){let t={total:e.length,add:0,update:0,delete:0,maxScreenshotChars:0,totalScreenshotChars:0};for(let a of e)if(!(!a||!a.action)&&(a.action==="add"&&t.add++,a.action==="update"&&t.update++,a.action==="delete"&&t.delete++,a.item&&typeof a.item.screenshotUrl=="string")){let n=a.item.screenshotUrl.length;t.totalScreenshotChars+=n,n>t.maxScreenshotChars&&(t.maxScreenshotChars=n)}return t}function zl(){try{let e=localStorage.getItem(Ii),t=e?JSON.parse(e):[];Le=Array.isArray(t)?t:[]}catch{Le=[]}}function $n(){try{localStorage.setItem(Ii,JSON.stringify(Le))}catch{}}function Hl(){ua&&clearTimeout(ua),ua=setTimeout(()=>{$n(),ua=null},Fl)}function Ul(){try{localStorage.setItem(Xo,JSON.stringify(oe))}catch{}}function Za(){En&&clearTimeout(En),En=setTimeout(()=>{Ul(),En=null},Ml)}function ji(e){if(!(!e||!e.action)){if(e.action==="add"&&e.item){oe.some(a=>a&&a.id===e.item.id)||(oe.unshift(e.item),Ke.includes(e.item.id)||Ke.unshift(e.item.id));return}if(e.action==="update"&&e.item&&e.item.id!=null){let t=oe.findIndex(a=>a&&a.id===e.item.id);t>=0&&(oe[t]={...oe[t],...e.item});return}e.action==="delete"&&e.targetId!=null&&(oe=oe.filter(t=>!t||t.id!==e.targetId),Ke=Ke.filter(t=>t!==e.targetId)),Za()}}function as(e=300){Lo||(Lo=setTimeout(()=>{Lo=null,Ci()},e))}function ns(e,t={}){if(!e||!e.action)return;let a={id:`${Date.now()}-${Math.random().toString(36).slice(2)}`,...e};Le.push(a),Hl(),ss(),vt(),typeof t.onError=="function"&&zo.set(a.id,t.onError),as()}async function Ci(){if(!(An||Le.length===0)){if(!navigator.onLine){vt();return}An=!0,Ne++;try{let e=[],t=[...Le];for(let a of t)a.action==="add"&&a.item?e.push({action:"add",item:a.item}):a.action==="update"&&a.item&&a.item.id!=null?e.push({action:"update",item:a.item}):a.action==="delete"&&a.targetId!=null&&e.push({action:"delete",id:a.targetId});if(e.length>0){let a=typeof performance<"u"&&performance.now?performance.now():Date.now(),n={operations:e},o=null;try{o=JSON.stringify(n).length}catch{}Dn("flush:start",{queueLength:Le.length,operationCount:e.length,payloadBytes:o,summary:ql(e)});let s=await Cs(e,Rl);s&&s.index&&(Ke=s.index);let r=!!(s&&Array.isArray(s.errors)&&s.errors.length>0);if(s&&s.success&&!r)Le.splice(0,t.length),$n(),Bt=0,rs();else{if(r){let c=new Set(s.errors.map(p=>p&&p.index).filter(p=>Number.isInteger(p))),l=t.filter((p,u)=>c.has(u));Le=l.length>0?l:t}else Le=t;$n(),Ra()}let i=typeof performance<"u"&&performance.now?performance.now():Date.now();Dn("flush:success",{durationMs:Math.round(i-a),processed:s&&s.processed,total:s&&s.total,success:s&&s.success,indexSize:Array.isArray(s&&s.index)?s.index.length:null,errors:s&&Array.isArray(s.errors)?s.errors.length:0})}}catch(e){if(console.error("Feedback flush error:",e),Dn("flush:error",{message:e&&e.message?e.message:String(e),name:e&&e.name?e.name:null,retryCount:Bt+1,queueLength:Le.length}),Bt++,Bt>=Sn)console.error(`Feedback save failed after ${Sn} attempts. Queue will be kept for later.`),Ra(),Bt=0;else{let a=Ol*Math.pow(2,Bt-1);console.log(`Feedback save failed. Retrying in ${a}ms (attempt ${Bt}/${Sn})`),Ra(),Dn("flush:retry-scheduled",{retryDelayMs:a,attempt:Bt,maxAttempts:Sn}),setTimeout(()=>{Ci()},a)}let t=Le[0];if(t){let a=zo.get(t.id);if(a){try{a(e)}catch{}zo.delete(t.id)}}}finally{An=!1,Ne=Math.max(0,Ne-1),vt()}}}function os(){Cn!==null&&(clearTimeout(Cn),Cn=null)}function _l(){os(),Cn=setTimeout(()=>{let e=document.getElementById("feedback-save-status");if(!e)return;e.classList.add("is-hidden"),ts=!1;let t=e.querySelector(".feedback-save-text");t&&(t.textContent="")},1600)}function vt(){let e=document.getElementById("feedback-save-status");if(!e)return;let t=e.querySelector(".feedback-save-text")||e,a="saved";(Kn||Le.length>0)&&(navigator.onLine?An||Le.length>0||fa||In!==null?a="saving":Jn?a="error":a="saving":a="offline");let n={saved:"feedback.saveStatus.saved",saving:"feedback.saveStatus.saving",error:"feedback.saveStatus.error",offline:"feedback.saveStatus.offline"}[a];t.textContent=d(n);let o=a!=="saved"||ts;e.classList.toggle("is-hidden",!o),e.classList.toggle("is-saving",a==="saving"),e.classList.toggle("is-error",a==="error"),e.classList.toggle("is-offline",a==="offline"),e.classList.toggle("is-saved",a==="saved")}function Vl(){let e=document.getElementById("feedback-description");if(!e)return;let a=window.matchMedia("(max-width: 768px)").matches?"feedback.descriptionPlaceholderShort":"feedback.descriptionPlaceholder";e.setAttribute("placeholder",d(a))}function ss(){Kn=!0,Jn=!1,os(),vt()}function rs(){Kn=!1,Jn=!1,ts=!0,vt(),_l()}function Ra(){Kn=!0,Jn=!0,os(),vt()}function Wl(e={}){let t=typeof e=="number"?e:e.delayMs?e.delayMs:Nl,a=typeof e=="object"&&typeof e.onError=="function"?e.onError:null;if(!Tt&&(ss(),a&&(fa?Pn.push(a):Ln.push(a)),In===null)){if(fa){jn=!0;return}Ne++,In=setTimeout(()=>{In=null,Gl()},t)}}async function Gl(){if(fa){jn=!0;return}let e=Ln;Ln=[],fa=!0;try{await xi(),rs()}catch(t){console.error("Error saving feedback:",t),Ra(),W(d("error.saveFeedbackFailed"));for(let a of e)try{a(t)}catch(n){console.error("Feedback save error handler failed:",n)}}finally{fa=!1,Ne=Math.max(0,Ne-1),jn&&(jn=!1,Pn.length>0&&(Ln.push(...Pn),Pn=[]),Wl({delayMs:200}))}}async function _m(){if(!Tt){ss(),Ne++;try{await xi(),rs()}catch(e){throw console.error("Error saving feedback:",e),Ra(),W(d("error.saveFeedbackFailed")),e}finally{Ne--}}}async function Yl(){if(!Tt)try{await Ns(ut)}catch(e){console.error("Error saving project colors:",e),W(d("error.saveProjectColorsFailed"))}}async function Vm(){try{ut=await fo()}catch(e){console.error("Error loading project colors:",e),ut={}}}async function is(){let e=ke("settings","save"),t=!1;try{await zs(F),t=!0}catch(a){console.error("Error saving settings:",a)}finally{ye("settings",e,{success:t})}window.initialSettingsFormState=null,window.settingsFormIsDirty=!1}async function Wm(){try{let e=await go();e&&typeof e=="object"&&(F={...F,...e},F.language=Wn(F.language))}catch(e){console.error("Error loading settings:",e)}yn(F.debugLogsEnabled)}var Ee=null,qt=null,ve=null,zt=null;function Kl(e){let o=String(e||""),s=[];for(let r=480;r<=1080;r+=30){let i=or(r),c=i===o?" selected":"";s.push(`<div class="time-option${c}" role="option" data-value="${i}">${i}</div>`)}return s.join("")}function Jl(e){if(!e||!e.options)return"";let t=String(e.value||""),a=[];return Array.from(e.options).forEach(n=>{let o=String(n.value||""),s=String(n.textContent||o),r=o===t?" selected":"";a.push(`<div class="tz-option${r}" role="option" data-value="${q(o)}">${q(s)}</div>`)}),a.join("")}function Zl(e,t,a){if(!e||!t)return;ve||(ve=document.createElement("div"),ve.className="tz-options-portal",document.body.appendChild(ve)),ve.innerHTML=Jl(t),ve.style.display="block",zt=e,Ho(e,ve),requestAnimationFrame(()=>Ho(e,ve)),e.setAttribute("aria-expanded","true");let n=o=>{o.stopPropagation();let s=o.target.closest(".tz-option");if(!s)return;let r=s.dataset.value;if(r){if(t.value=r,a){let i=t.options?.[t.selectedIndex]?.textContent||r;a.textContent=i}t.dispatchEvent(new Event("change",{bubbles:!0})),ba()}};ve.onclick=n,setTimeout(()=>document.addEventListener("click",Li,!0),0),window.addEventListener("scroll",Nn,!0),window.addEventListener("resize",Nn,!0),document.addEventListener("keydown",Pi,!0)}function ba(){ve&&(ve.style.display="none",ve.innerHTML="",ve.onclick=null,zt&&zt.setAttribute("aria-expanded","false"),zt=null,document.removeEventListener("click",Li,!0),window.removeEventListener("scroll",Nn,!0),window.removeEventListener("resize",Nn,!0),document.removeEventListener("keydown",Pi,!0))}function Li(e){let t=e.target;!ve||ve.style.display==="none"||ve.contains(t)||zt&&zt.contains(t)||ba()}function Nn(){!zt||!ve||ve.style.display==="none"||Ho(zt,ve)}function Pi(e){e.key==="Escape"&&(!ve||ve.style.display==="none"||(e.preventDefault(),ba()))}function Ho(e,t){let a=e.getBoundingClientRect();t.style.width=`${a.width}px`;let n=window.innerHeight,o=Math.min(t.scrollHeight,240),i=n-a.bottom<o+12?Math.max(8,a.top-o-4):a.bottom+4,c=window.innerWidth,l=t.getBoundingClientRect().width||a.width,p=a.left,u=Math.min(Math.max(8,p),Math.max(8,c-l-8));t.style.left=`${u}px`,t.style.top=`${i}px`}function Xl(e,t,a){if(!e||!t)return;Ee||(Ee=document.createElement("div"),Ee.className="time-options-portal",document.body.appendChild(Ee));let n=String(t.value||"").trim();Ee.innerHTML=Kl(n),Ee.style.display="block",qt=e,Uo(e,Ee),requestAnimationFrame(()=>Uo(e,Ee)),e.setAttribute("aria-expanded","true");let o=s=>{s.stopPropagation();let r=s.target.closest(".time-option");if(!r)return;let i=r.dataset.value;i&&(t.value=i,a&&(a.textContent=i),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded(),ka())};Ee.addEventListener("click",o),setTimeout(()=>document.addEventListener("click",Ai,!0),0),window.addEventListener("scroll",Fn,!0),window.addEventListener("resize",Fn,!0),document.addEventListener("keydown",Bi,!0)}function ka(){Ee&&(Ee.style.display="none",Ee.innerHTML="",qt&&qt.setAttribute("aria-expanded","false"),qt=null,document.removeEventListener("click",Ai,!0),window.removeEventListener("scroll",Fn,!0),window.removeEventListener("resize",Fn,!0),document.removeEventListener("keydown",Bi,!0))}function Ai(e){let t=e.target;!Ee||Ee.style.display==="none"||Ee.contains(t)||qt&&qt.contains(t)||ka()}function Fn(){!qt||!Ee||Ee.style.display==="none"||Uo(qt,Ee)}function Bi(e){e.key==="Escape"&&(!Ee||Ee.style.display==="none"||(e.preventDefault(),ka()))}function Uo(e,t){let a=e.getBoundingClientRect();t.style.width=`${a.width}px`;let n=window.innerHeight,o=Math.min(t.scrollHeight,260),i=n-a.bottom<o+12?Math.max(8,a.top-o-4):a.bottom+4,c=window.innerWidth,l=t.getBoundingClientRect().width||a.width,p=a.left,u=Math.min(Math.max(8,p),Math.max(8,c-l-8));t.style.left=`${u}px`,t.style.top=`${i}px`}function $i(){let e=document.querySelector(".workspace-icon");e&&(Io===null&&(Io=e.textContent||""),F.customWorkspaceLogo?(e.style.backgroundImage=`url(${F.customWorkspaceLogo})`,e.textContent=""):(e.style.backgroundImage="",e.textContent=Io))}function Mn({tasks:e,projects:t,feedbackItems:a}={}){N=t||[],C=e||[],oe=a||[],Ke=oe.map(n=>n&&n.id).filter(n=>n!=null),N.forEach(n=>{n&&n.id!=null&&(n.id=parseInt(n.id,10)),Array.isArray(n.tags)||(n.tags=[])}),C.forEach(n=>{n&&(n.id!=null&&(n.id=parseInt(n.id,10)),n.projectId!=null&&n.projectId!=="null"?n.projectId=parseInt(n.projectId,10):n.projectId=null,(n.startDate===void 0||n.startDate===null)&&(n.startDate=""),(n.endDate===void 0||n.endDate===null)&&(n.endDate=""),typeof n.startDate!="string"&&(n.startDate=String(n.startDate||"")),typeof n.endDate!="string"&&(n.endDate=String(n.endDate||"")),Array.isArray(n.tags)||(typeof n.tags=="string"&&n.tags.trim()!==""?n.tags=n.tags.split(",").map(o=>o.trim()).filter(Boolean):n.tags=[]),Array.isArray(n.attachments)||(n.attachments=[]),n.startDateWasEverSet===void 0&&(n.startDateWasEverSet=n.startDate.trim()!==""),n.endDateWasEverSet===void 0&&(n.endDateWasEverSet=n.endDate.trim()!==""),n.dueDate&&!n.endDate&&(n.endDate=n.dueDate,n.endDateWasEverSet=!0),delete n.dueDate)}),oe.forEach(n=>{n&&n.id!=null&&(n.id=parseInt(n.id,10))}),zl(),Le.length>0&&Le.forEach(ji),Za(),N.length>0?pt=Math.max(...N.map(n=>n.id||0))+1:pt=1,C.length>0?at=Math.max(...C.map(n=>n.id||0))+1:at=1,oe.length>0?Ht=Math.max(...oe.map(n=>n.id||0))+1:Ht=1}function Ni(e){!Array.isArray(e)||e.length===0||(oe=e,Ke=oe.map(t=>t&&t.id).filter(t=>t!=null),oe.length>0?Ht=Math.max(...oe.map(t=>t.id||0))+1:Ht=1,Le.length>0&&Le.forEach(ji),Tt||(Ae(),document.getElementById("feedback")?.classList.contains("active")&&mt()))}async function Gm(){let e=await po({preferCache:!0,onRefresh:t=>{if(Ne>0)return;Te("swr-refresh-start");let a=qa({tasks:C,projects:N,feedbackItems:oe}),n=qa(t);if(n===a){Te("swr-refresh-skip",{reason:"data-unchanged"});return}let o=ga(C,N),s=ga(t?.tasks||[],t?.projects||[]);Mn(t),_o=n,Rn=s,Ri({calendarChanged:s!==o}),Te("swr-refresh-applied",{calendarChanged:s!==o})},feedback:{limitPending:it,limitDone:it,cacheKey:Xo,preferCache:!0,onRefresh:Ni}});Mn(e)}var Po={},ut={},ni=0;function na(e){return Po[e]||(Po[e]=ho[ni%ho.length],ni++),Po[e]}function Ie(e){if(!ut[e]){let t=new Set(Object.values(ut)),a=Ca.filter(n=>!t.has(n));ut[e]=a.length>0?a[0]:Ca[Object.keys(ut).length%Ca.length]}return ut[e]}function Fi(e,t){ut[e]=t,Yl(),document.getElementById("calendar-view").classList.contains("active")&&re()}function Ql(e){let t=document.getElementById(`color-picker-${e}`);if(t){let a=t.style.display!=="none";document.querySelectorAll(".color-picker-dropdown").forEach(n=>n.style.display="none"),t.style.display=a?"none":"block"}}function ed(e,t){Fi(e,t);let a=document.querySelector(`#color-picker-${e}`).previousElementSibling;a&&(a.style.backgroundColor=t);let n=document.getElementById(`color-picker-${e}`);if(n){n.querySelectorAll(".color-option").forEach(r=>{let l="#"+r.style.backgroundColor.replace(/rgb\(|\)|\s/g,"").split(",").map(p=>parseInt(p,10).toString(16).padStart(2,"0")).join("");r.style.border=l.toUpperCase()===t.toUpperCase()?"2px solid white":"2px solid transparent"});let s=n.querySelector(".custom-color-swatch");s&&(s.style.border="2px solid transparent")}let o=N.find(s=>s.id===e);o&&o.tags&&an(o.tags,e),document.getElementById("projects")?.classList.contains("active")&&(te.projectsSortedView=null,Ve())}function td(e,t){if(!t)return;Fi(e,t);let a=document.getElementById(`color-picker-${e}`);if(a){let s=a.previousElementSibling;s&&(s.style.backgroundColor=t);let r=a.querySelector(".custom-color-swatch");r&&(r.style.backgroundColor=t)}let n=document.getElementById(`color-picker-${e}`);if(n){n.querySelectorAll(".color-option").forEach(r=>{r.style.border="2px solid transparent"});let s=n.querySelector(".custom-color-swatch");s&&(s.style.border="2px solid white")}let o=N.find(s=>s.id===e);o&&o.tags&&an(o.tags,e),document.getElementById("projects")?.classList.contains("active")&&(te.projectsSortedView=null,Ve())}function ad(e){let t=document.getElementById(`project-color-input-${e}`);t&&(Vo=!0,t.click())}var y={search:"",statuses:new Set,priorities:new Set,projects:new Set,tags:new Set,datePresets:new Set,dateFrom:"",dateTo:""},O={search:"",statuses:new Set,taskFilter:"",updatedFilter:"all",tags:new Set},He={lastSort:"",direction:"asc"},oi=!1;function nd(){oi||(oi=!0,Xa(),Ta(),oa(),od())}function Xa(){let e=document.getElementById("project-options");if(e){let t=new Set(y.projects);if(e.innerHTML="",C.some(n=>!n.projectId)){let n=document.createElement("li"),o=t.has("none")?"checked":"";n.innerHTML=`<label><input type="checkbox" id="proj-none" value="none" data-filter="project" ${o}> ${d("tasks.noProject")}</label>`,e.appendChild(n)}else t.has("none")&&(y.projects.delete("none"),he());if(N.length===0){let n=document.createElement("li");n.textContent=d("filters.noOtherProjects"),n.style.color="var(--text-muted)",n.style.padding="8px 12px",e.appendChild(n)}else N.slice().sort((n,o)=>(n.name||"").localeCompare(o.name||"",void 0,{sensitivity:"base"})).forEach(n=>{let o=document.createElement("li"),s=`proj-${n.id}`,r=t.has(String(n.id))?"checked":"";o.innerHTML=`<label><input type="checkbox" id="${s}" value="${n.id}" data-filter="project" ${r}> ${n.name}</label>`,e.appendChild(o)});e.querySelectorAll('input[type="checkbox"][data-filter="project"]').forEach(n=>{n.addEventListener("change",()=>{la(y.projects,n.value,n.checked),he(),xe(),document.getElementById("calendar-view")&&re(),Oe()})})}}function Ta(){let e=document.getElementById("tag-options");if(e){let t=new Set(y.tags),a=new Set;if(C.forEach(o=>{o.tags&&o.tags.length>0&&o.tags.forEach(s=>a.add(s))}),e.innerHTML="",C.some(o=>!o.tags||o.tags.length===0)){let o=document.createElement("li"),s=t.has("none")?"checked":"";o.innerHTML=`<label><input type="checkbox" id="tag-none" value="none" data-filter="tag" ${s}> ${d("filters.noTags")}</label>`,e.appendChild(o)}else t.has("none")&&(y.tags.delete("none"),he());if(a.size===0){let o=document.createElement("li");o.textContent=d("filters.noOtherTags"),o.style.color="var(--text-muted)",o.style.padding="8px 12px",e.appendChild(o)}else Array.from(a).sort().forEach(o=>{let s=document.createElement("li"),r=`tag-${o}`,i=t.has(o)?"checked":"";s.innerHTML=`<label><input type="checkbox" id="${r}" value="${o}" data-filter="tag" ${i}> ${o.toUpperCase()}</label>`,e.appendChild(s)});e.querySelectorAll('input[type="checkbox"]').forEach(o=>{o.addEventListener("change",()=>{o.dataset.filter==="tag"&&la(y.tags,o.value,o.checked),he(),xe(),document.getElementById("calendar-view")&&re(),Oe()})})}}function od(){let e=!!(window.matchMedia&&(window.matchMedia("(max-width: 768px)").matches||window.matchMedia("(pointer: coarse)").matches)),t=document.getElementById("project-select-all");t&&t.parentElement.parentElement&&(N.length>1?t.parentElement.parentElement.style.display="block":t.parentElement.parentElement.style.display="none");let a=[document.getElementById("group-status"),document.getElementById("group-priority"),document.getElementById("group-project"),document.getElementById("group-tags"),document.getElementById("group-end-date"),document.getElementById("group-start-date"),document.getElementById("group-kanban-updated"),document.getElementById("group-project-status"),document.getElementById("group-project-updated"),document.getElementById("group-project-tags")].filter(Boolean),n=()=>{let u=document.getElementById("dropdown-backdrop");return u||(u=document.createElement("div"),u.id="dropdown-backdrop",u.setAttribute("aria-hidden","true"),u.addEventListener("click",()=>o()),document.body.appendChild(u)),u},o=()=>{a.forEach(f=>f.classList.remove("open")),document.body.classList.remove("dropdown-sheet-open");let u=document.getElementById("dropdown-backdrop");u&&u.classList.remove("open")},s=u=>{let f=u.querySelector(".dropdown-panel");if(f){if(f.classList.add("has-sheet-header"),e){try{let m=u.getBoundingClientRect(),g=12,h=8,k=window.innerHeight||document.documentElement.clientHeight||0,v=Math.max(0,k-m.bottom-g),L=Math.max(0,m.top-g),S=Math.min(460,Math.floor(k*.6)),j=v>=260||v>=L,w=Math.min(S,j?v:L),D=w<220;if(f.classList.toggle("sheet-bottom",D),f.classList.toggle("sheet-anchored",!D),D)f.style.removeProperty("--sheet-top"),f.style.removeProperty("--sheet-maxh");else{w<240&&(w=Math.min(240,Math.max(0,j?v:L)));let E=j?m.bottom+h:m.top-h-w;E=Math.max(g,Math.min(E,k-g-140)),f.style.setProperty("--sheet-top",`${Math.round(E)}px`),f.style.setProperty("--sheet-maxh",`${Math.round(w)}px`)}}catch{f.classList.add("sheet-bottom"),f.classList.remove("sheet-anchored")}n().classList.add("open"),document.body.classList.add("dropdown-sheet-open")}if(!f.querySelector(".dropdown-sheet-header")){let m=f.querySelector(".dropdown-section-title")?.textContent?.trim()||u.querySelector(".filter-button")?.textContent?.trim()||d("filters.sheet.title"),g=document.createElement("div");g.className="dropdown-sheet-header";let h=document.createElement("div");h.className="dropdown-sheet-handle";let k=document.createElement("div");k.className="dropdown-sheet-title",k.textContent=m.toUpperCase();let v=document.createElement("button");v.type="button",v.className="dropdown-sheet-done",v.textContent=d("common.done"),v.addEventListener("click",()=>o()),g.appendChild(h),g.appendChild(k),g.appendChild(v),f.insertBefore(g,f.firstChild)}}};a.forEach(u=>{u.querySelector(".filter-button").addEventListener("click",g=>{g.stopPropagation();let h=u.classList.contains("open");o(),h||(u.classList.add("open"),s(u))});let m=u.querySelector(".dropdown-panel");m&&m.addEventListener("click",g=>g.stopPropagation())}),document.addEventListener("click",()=>o()),document.addEventListener("keydown",u=>{u.key==="Escape"&&o()}),document.querySelectorAll('.dropdown-panel input[type="checkbox"][data-filter="status"],.dropdown-panel input[type="checkbox"][data-filter="priority"],.dropdown-panel input[type="checkbox"][data-filter="project"]').forEach(u=>{u.addEventListener("change",()=>{let f=u.dataset.filter;f==="status"&&la(y.statuses,u.value,u.checked),f==="priority"&&la(y.priorities,u.value,u.checked),f==="project"&&la(y.projects,u.value,u.checked),he(),xe(),document.getElementById("calendar-view")&&re(),Oe()})}),document.querySelectorAll('input[type="checkbox"][data-filter="date-preset"]').forEach(u=>{u.addEventListener("change",()=>{let f=u.value;if(u.checked){if(y.datePresets.add(f),y.datePresets.size>0){y.dateFrom="",y.dateTo="";let g=document.getElementById("filter-date-from"),h=document.getElementById("filter-date-to");g&&(g.value=""),h&&(h.value="")}}else y.datePresets.delete(f);he(),xe(),document.getElementById("calendar-view")&&re(),Oe()})});let r=document.getElementById("project-select-all");r&&r.addEventListener("change",()=>{let u=document.querySelectorAll('.dropdown-panel input[type="checkbox"][data-filter="project"]'),f=r.checked;u.forEach(g=>{g.checked=f,f?y.projects.add(g.value):y.projects.delete(g.value)}),he(),xe(),document.getElementById("calendar-view")&&re(),Oe()});let i=document.getElementById("filter-search");i&&i.addEventListener("input",()=>{y.search=(i.value||"").trim().toLowerCase(),he(),xe(),document.getElementById("calendar-view")&&re(),Oe()}),document.querySelectorAll('input[type="radio"][data-filter="kanban-updated"][name="kanban-updated-filter"]').forEach(u=>{u.addEventListener("change",()=>{u.checked&&(Ya(u.value),Oe())})});let c=document.getElementById("filter-date-from"),l=document.getElementById("filter-date-to");c?c.addEventListener("change",()=>{y.dateFrom=c.value,he(),xe(),document.getElementById("calendar-view")&&re(),Oe()}):console.error("[Filter] Date From element not found!"),l?l.addEventListener("change",()=>{y.dateTo=l.value,he(),xe(),document.getElementById("calendar-view")&&re(),Oe()}):console.error("[Filter] Date To element not found!");let p=document.getElementById("btn-clear-filters");p&&p.addEventListener("click",()=>{y.search="",y.statuses.clear(),y.priorities.clear(),y.projects.clear(),y.tags.clear(),y.datePresets.clear(),y.dateFrom="",y.dateTo="";try{Ya("all",{render:!1})}catch{}if(document.querySelectorAll('.dropdown-panel input[type="checkbox"]').forEach(f=>f.checked=!1),i&&(i.value=""),c){c.value="";let f=c.closest(".date-input-wrapper");if(f){let m=f.querySelector(".date-display");m&&m._flatpickr&&m._flatpickr.clear()}}if(l){l.value="";let f=l.closest(".date-input-wrapper");if(f){let m=f.querySelector(".date-display");m&&m._flatpickr&&m._flatpickr.clear()}}he(),xe(),document.getElementById("calendar-view")&&re(),Oe()}),he(),Qa(),no(),Oe()}function Oe(){let e=document.getElementById("btn-clear-filters");if(!e)return;let t=document.querySelector(".kanban-board"),a=t&&!t.classList.contains("hidden"),n=document.getElementById("list-view")?.classList.contains("active"),o=document.getElementById("calendar-view")?.classList.contains("active"),r=(a||n||o)&&window.kanbanUpdatedFilter&&window.kanbanUpdatedFilter!=="all",i=y.search&&y.search.trim()!==""||y.statuses.size>0||y.priorities.size>0||y.projects.size>0||y.tags.size>0||y.datePresets.size>0||y.dateFrom&&y.dateFrom!==""||y.dateTo&&y.dateTo!==""||r;e.style.display=i?"inline-flex":"none"}function he(){let e=document.getElementById("badge-status"),t=document.getElementById("badge-priority"),a=document.getElementById("badge-project"),n=document.getElementById("badge-tags"),o=document.getElementById("badge-end-date"),s=document.getElementById("badge-start-date");e&&(e.textContent=y.statuses.size===0?"":y.statuses.size),t&&(t.textContent=y.priorities.size===0?"":y.priorities.size),a&&(a.textContent=y.projects.size===0?"":y.projects.size),n&&(n.textContent=y.tags.size===0?"":y.tags.size);let r=["no-date","overdue","end-today","end-tomorrow","end-7days","end-week","end-month"],i=["no-start-date","already-started","start-today","start-tomorrow","start-7days","start-week","start-month"],c=0,l=0;y.datePresets.forEach(u=>{r.includes(u)?c++:i.includes(u)&&l++}),o&&(o.textContent=c===0?"":c),s&&(s.textContent=l===0?"":l);let p=(u,f)=>{let m=document.getElementById(u);if(m){let g=m.closest(".filter-button");g&&(f?g.classList.add("active"):g.classList.remove("active"))}};p("badge-status",y.statuses.size>0),p("badge-priority",y.priorities.size>0),p("badge-project",y.projects.size>0),p("badge-tags",y.tags.size>0),p("badge-end-date",c>0),p("badge-start-date",l>0),Qa(),Oe(),vn("filters","badges",{statusCount:y.statuses.size,priorityCount:y.priorities.size,projectCount:y.projects.size,tagCount:y.tags.size,endDateCount:c,startDateCount:l})}function Qa(){let e=document.getElementById("active-filters");if(!e)return;let t=ke("filters","chips");e.innerHTML="";let a=(n,o,s,r,i)=>{let c=document.createElement("span");c.className="filter-chip",r==="status"?c.classList.add("chip-status"):r==="priority"&&c.classList.add("chip-priority");let l=document.createElement("span");if(l.className="chip-text",r==="status"&&i){let u=document.createElement("span");u.className=`dot ${i}`,l.appendChild(u),l.appendChild(document.createTextNode(` ${n}: ${o}`))}else l.textContent=`${n}: ${o}`;let p=document.createElement("button");p.type="button",p.className="chip-remove",p.setAttribute("aria-label",d("filters.chip.removeAria",{label:n})),p.textContent="\xD7",p.addEventListener("click",s),c.appendChild(l),c.appendChild(p),e.appendChild(c)};y.search&&a(d("filters.chip.search"),y.search,()=>{y.search="";let n=document.getElementById("filter-search");n&&(n.value=""),he(),Oe(),xe()}),y.statuses.forEach(n=>a(d("tasks.filters.status"),We(n),()=>{y.statuses.delete(n);let o=document.querySelector(`input[type="checkbox"][data-filter="status"][value="${n}"]`);o&&(o.checked=!1),he(),xe()},"status",n)),y.priorities.forEach(n=>a(d("tasks.filters.priority"),ot(n),()=>{y.priorities.delete(n);let o=document.querySelector(`input[type="checkbox"][data-filter="priority"][value="${n}"]`);o&&(o.checked=!1),he(),xe()},"priority",n)),y.projects.forEach(n=>{let o=N.find(s=>s.id.toString()===n.toString());a(d("filters.chip.project"),o?o.name:n,()=>{y.projects.delete(n);let s=document.querySelector(`input[type="checkbox"][data-filter="project"][value="${n}"]`);s&&(s.checked=!1),he(),xe()})}),y.tags.forEach(n=>a(d("filters.chip.tag"),n,()=>{y.tags.delete(n);let o=document.querySelector(`input[type="checkbox"][data-filter="tag"][value="${n}"]`);o&&(o.checked=!1),he(),xe()})),y.datePresets.forEach(n=>{let s={"no-date":d("tasks.filters.noDate"),overdue:d("tasks.filters.overdue"),"end-today":d("tasks.filters.endToday"),"end-tomorrow":d("tasks.filters.endTomorrow"),"end-7days":d("tasks.filters.end7Days"),"end-week":d("tasks.filters.endThisWeek"),"end-month":d("tasks.filters.endThisMonth"),"no-start-date":d("tasks.filters.noStartDate"),"already-started":d("tasks.filters.alreadyStarted"),"start-today":d("tasks.filters.startToday"),"start-tomorrow":d("tasks.filters.startTomorrow"),"start-7days":d("tasks.filters.start7Days"),"start-week":d("tasks.filters.startThisWeek"),"start-month":d("tasks.filters.startThisMonth")}[n]||n;a(d("filters.chip.date"),s,()=>{y.datePresets.delete(n);let r=document.querySelector(`input[type="checkbox"][data-filter="date-preset"][value="${n}"]`);r&&(r.checked=!1),he(),xe()})});try{let n=document.querySelector(".kanban-board"),o=n&&!n.classList.contains("hidden"),s=document.getElementById("list-view")?.classList.contains("active"),r=document.getElementById("calendar-view")?.classList.contains("active");(o||s||r)&&window.kanbanUpdatedFilter&&window.kanbanUpdatedFilter!=="all"&&a(d("filters.chip.updated"),hc(window.kanbanUpdatedFilter),()=>{Ya("all"),Oe()})}catch{}if(y.dateFrom||y.dateTo){let n="";y.dateFrom&&y.dateTo?n=`${pe(y.dateFrom)} - ${pe(y.dateTo)}`:y.dateFrom?n=`${d("filters.dateRange.from")} ${pe(y.dateFrom)}`:y.dateTo&&(n=`${d("filters.dateRange.until")} ${pe(y.dateTo)}`),a(d("filters.chip.date"),n,()=>{y.dateFrom="",y.dateTo="";let o=document.getElementById("filter-date-from"),s=document.getElementById("filter-date-to");if(o){o.value="";let r=o.closest(".date-input-wrapper");if(r){let i=r.querySelector(".date-display");i&&i._flatpickr&&i._flatpickr.clear()}}if(s){s.value="";let r=s.closest(".date-input-wrapper");if(r){let i=r.querySelector(".date-display");i&&i._flatpickr&&i._flatpickr.clear()}}xe()})}ye("filters",t,{chipCount:e.children.length})}function Oa(){let e=new URLSearchParams,t=document.getElementById("list-view")?.classList.contains("active"),a=document.getElementById("calendar-view")?.classList.contains("active");t?e.set("view","list"):a&&e.set("view","calendar"),y.search&&y.search.trim()!==""&&e.set("search",y.search.trim()),y.statuses.size>0&&e.set("status",Array.from(y.statuses).join(",")),y.priorities.size>0&&e.set("priority",Array.from(y.priorities).join(",")),y.projects.size>0&&e.set("project",Array.from(y.projects).join(",")),y.tags.size>0&&e.set("tags",Array.from(y.tags).join(",")),y.datePresets.size>0&&e.set("datePreset",Array.from(y.datePresets).join(",")),y.dateFrom&&y.dateFrom!==""&&(e.set("dateFrom",y.dateFrom),y.dateField&&y.dateField!=="endDate"&&e.set("dateField",y.dateField)),y.dateTo&&y.dateTo!==""&&e.set("dateTo",y.dateTo),window.kanbanUpdatedFilter&&window.kanbanUpdatedFilter!=="all"&&e.set("updated",window.kanbanUpdatedFilter);let n=e.toString(),o=n?`#tasks?${n}`:"#tasks";window.location.hash!==o&&window.history.replaceState(null,"",o)}function xe(){Oa(),Qa(),Fe(),(window.innerWidth<=768||document.getElementById("list-view").classList.contains("active"))&&Je(),document.getElementById("calendar-view").classList.contains("active")&&re()}function kt(){let e=ke("filters","tasks",{totalTasks:C.length,hasSearch:!!y.search,statusCount:y.statuses.size,priorityCount:y.priorities.size,projectCount:y.projects.size,tagCount:y.tags.size,datePresetCount:y.datePresets.size,hasDateRange:!!(y.dateFrom||y.dateTo)}),t=fr(C,{search:y.search,statuses:y.statuses,priorities:y.priorities,projects:y.projects,tags:y.tags,datePresets:y.datePresets,dateFrom:y.dateFrom,dateTo:y.dateTo,dateField:y.dateField||"endDate"});return ye("filters",e,{totalTasks:C.length,filteredCount:t.length}),t}function Dt(){let e=window.flatpickr;if(typeof e!="function"){let r=(Dt.__retryCount||0)+1;Dt.__retryCount=r,r<=50?setTimeout(Dt,100):console.warn("flatpickr is not available; date pickers disabled");return}let a={dateFormat:"d/m/Y",altInput:!1,allowInput:!0,locale:Mi(),disableMobile:!0};function n(r,i){let c=!1;r.addEventListener("keydown",function(l){!c&&r.value.match(/^\d{2}\/\d{2}\/\d{4}$/)&&l.key.length===1&&/\d/.test(l.key)&&(r.value="",c=!0),l.key==="Backspace"&&r.selectionStart===0&&r.selectionEnd===0&&(r.value="",c=!0,l.preventDefault())}),r.addEventListener("input",function(l){let p=l.target.value,u=p.replace(/\D/g,""),f="";if(u.length>=1){let m=u.substring(0,2);parseInt(m,10)>31&&(m="31"),f=m}if(u.length>=3){let m=u.substring(2,4);parseInt(m,10)>12&&(m="12"),f+="/"+m}if(u.length>=5&&(f+="/"+u.substring(4,8)),p!==f&&(l.target.value=f),f.match(/^\d{2}\/\d{2}\/\d{4}$/)){let[m,g,h]=f.split("/"),k=new Date(+h,+g-1,+m);if(i&&i.config)try{i.__suppressChange=!0,i.setDate(k,!1),setTimeout(()=>i.__suppressChange=!1,0)}catch{}}}),r.addEventListener("keypress",function(l){let p=String.fromCharCode(l.which);!/[\d\/]/.test(p)&&l.which!==8&&l.which!==46&&l.preventDefault()}),r.addEventListener("blur",function(){c=!1}),i&&i.config.onChange.push(()=>c=!1)}function o(r){if(r.__patchedProgrammaticGuards)return;r.__patchedProgrammaticGuards=!0;let i=r.clear.bind(r);r.clear=function(){r.__suppressChange=!0;let l=i();return setTimeout(()=>r.__suppressChange=!1,0),l};let c=r.setDate.bind(r);r.__origSetDate=c,r.setDate=function(l,p,...u){r.__suppressChange=!0;let f=c(l,p,...u);return setTimeout(()=>r.__suppressChange=!1,0),f}}function s(r){if(!r||!r.calendarContainer||r.calendarContainer.querySelector(".flatpickr-today-btn"))return;let i=document.createElement("div");i.className="flatpickr-today-footer";let c=document.createElement("button");c.type="button",c.className="flatpickr-today-btn",c.textContent=d("calendar.today")||"Today",c.addEventListener("click",l=>{l.preventDefault(),l.stopPropagation();let p=new Date;r.jumpToDate(p),r.__suppressChange=!1,typeof r.__origSetDate=="function"?r.__origSetDate(p,!0):r.setDate(p,!0)}),i.appendChild(c),r.calendarContainer.appendChild(i)}document.querySelectorAll('input[type="date"], input.datepicker').forEach(r=>{if(!r._flatpickrInstance)if(r.type==="date"){if(r._wrapped)return;r._wrapped=!0;let i=document.createElement("div");i.className="date-input-wrapper";let c=document.createElement("input");c.type="text",c.className="form-input date-display",c.placeholder=d("common.datePlaceholder"),c.maxLength="10",r.style.display="none",r.type="hidden",r.parentNode.insertBefore(i,r),i.appendChild(r),i.appendChild(c);let l=r.value&&rt(r.value)?r.value:"";l?c.value=gn(l):c.value="";let p=e(c,{...a,defaultDate:l?new Date(l):null,onReady(m,g,h){s(h)},onOpen(m,g,h){!r.value&&!h.selectedDates.length&&h.jumpToDate(new Date)},onChange:function(m){let g=r.value||"",h="";if(m.length>0){let j=m[0];h=`${j.getFullYear()}-${String(j.getMonth()+1).padStart(2,"0")}-${String(j.getDate()).padStart(2,"0")}`}r.value=h;let k=document.getElementById("task-form");if(k&&(r.name==="startDate"||r.name==="endDate")){let j=document.querySelector(".modal.active");if(j){let w=j.querySelector('input[name="startDate"]'),D=j.querySelector('input[name="endDate"]');if(w&&D){let E=(w.value||"").trim(),T=(D.value||"").trim();if(E&&T&&T<E){r.value=g,g?c._flatpickr.setDate(new Date(g),!1):c._flatpickr.clear();let A=c.closest(".date-input-wrapper"),z=A?A.closest(".form-group"):null;if(z){let H=z.querySelector(".date-validation-error");H&&H.remove();let b=document.createElement("div");b.className="date-validation-error",b.style.cssText="color: var(--error); font-size: 12px; margin-top: 6px; padding: 8px 12px; background: var(--bg-error, rgba(239, 68, 68, 0.08)); border-left: 3px solid var(--error); border-radius: 4px;",b.innerHTML="\u26A0\uFE0F "+(r.name==="endDate"?"End Date cannot be before Start Date":"Start Date cannot be after End Date"),A.parentNode.insertBefore(b,A.nextSibling),setTimeout(()=>{b.parentElement&&b.remove()},5e3)}return}else{let A=c.closest(".date-input-wrapper"),z=A?A.closest(".form-group"):null;if(z){let H=z.querySelector(".date-validation-error");H&&H.remove()}}}}}if(r.id==="filter-date-from"){y.dateFrom=h,he(),xe(),document.getElementById("calendar-view")&&re(),Oe();return}else if(r.id==="filter-date-to"){y.dateTo=h,he(),xe(),document.getElementById("calendar-view")&&re(),Oe();return}let v=!!(k&&k.dataset.editingTaskId),L=r.name;if(v&&(L==="startDate"||L==="endDate")&&!p.__suppressChange){ft(L,h);return}if(c.classList.contains("editable-date")&&!p.__suppressChange){let j=c.getAttribute("onchange");if(j&&j.includes("updateProjectField")){let w=j.match(/updateProjectField\((\d+),\s*['"](\w+)['"]/);if(w){let D=parseInt(w[1],10),E=w[2];aa(D,E,c.value)}}}}});o(p),n(c,p),r._flatpickrInstance=p;let u=!!c.closest("#task-form"),f=r.name==="startDate"||r.name==="endDate";if(u&&f){let m=document.createElement("button");m.type="button",m.textContent="Clear",m.style.padding="6px 10px",m.style.border="1px solid var(--border)",m.style.background="var(--bg-tertiary)",m.style.color="var(--text-secondary)",m.style.borderRadius="6px",m.style.cursor="pointer",m.style.flex="0 0 auto";let g=c.parentElement;g&&(g.style.display="flex",g.style.gap="8px"),g.appendChild(m),m.addEventListener("click",()=>{c.value="",r.value="",p&&(p.__suppressChange=!0,p.clear(),setTimeout(()=>p.__suppressChange=!1,0));let h=document.getElementById("task-form");h&&h.dataset.editingTaskId&&ft(r.name,"")})}}else{r.maxLength="10";let i=e(r,{...a,defaultDate:null,onReady(c,l,p){s(p)},onChange:function(c,l){if(i.__suppressChange)return;let p=r.dataset.projectId,u=r.dataset.field;p&&u&&aa(parseInt(p,10),u,l)}});o(i),n(r,i),r._flatpickrInstance=i}})}function Mi(){let e=Mt(),t=window.flatpickr?.l10ns,a=null;return e==="es"&&t?.es?a=t.es:a=t?.default||t?.en||t?.es||null,a?{...a,firstDayOfWeek:1}:{firstDayOfWeek:1}}function sd(){let e=Mi();document.querySelectorAll("input").forEach(t=>{let a=t._flatpickrInstance;a&&typeof a.set=="function"&&(a.set("locale",e),typeof a.redraw=="function"&&a.redraw())})}var _o=null,Rn=null,Tn=null;function Ao(e,t){let a=0,n=Array.isArray(e)?e:[];for(let o of n){let s=t?t(o):Date.parse(o?.updatedAt||o?.createdAt||o?.createdDate||"")||0;Number.isFinite(s)&&s>a&&(a=s)}return a}function Bo(e){let t=0,a=Array.isArray(e)?e:[];for(let n of a){let o=Number(n?.id);Number.isNaN(o)||(t+=o)}return t}function qa(e){let t=Array.isArray(e?.tasks)?e.tasks:[],a=Array.isArray(e?.projects)?e.projects:[],n=Array.isArray(e?.feedbackItems)?e.feedbackItems:[],o=Ao(t,typeof Pt=="function"?Pt:null),s=Ao(a,i=>Date.parse(i?.updatedAt||i?.createdAt||"")||0),r=Ao(n,i=>Date.parse(i?.updatedAt||i?.createdAt||i?.createdDate||"")||0);return`t:${t.length}:${o}:${Bo(t)}|p:${a.length}:${s}:${Bo(a)}|f:${n.length}:${r}:${Bo(n)}`}function ga(e=C,t=N){let a=!!F.calendarIncludeBacklog,n=y?.projects,o=n&&n.size>0?new Set(Array.from(n).map(u=>parseInt(u,10))):null,s=0,r=0,i=Array.isArray(e)?e:[];for(let u of i){if(!u||!a&&u.status==="backlog"||o&&!o.has(Number(u.projectId)))continue;let f=u.startDate||"",m=u.endDate||"",g=typeof f=="string"&&f.length===10&&f.includes("-"),h=typeof m=="string"&&m.length===10&&m.includes("-");if(!g&&!h)continue;r++;let k=Number(u.id)||0,v=u.status?String(u.status):"",L=Number(u.projectId)||0,S=u.title?String(u.title):"",j=Date.parse(u.updatedAt||u.createdAt||u.createdDate||"")||0;s=s*31+k+L+j|0;for(let w=0;w<f.length;w++)s=s*31+f.charCodeAt(w)|0;for(let w=0;w<m.length;w++)s=s*31+m.charCodeAt(w)|0;for(let w=0;w<v.length;w++)s=s*31+v.charCodeAt(w)|0;for(let w=0;w<S.length;w++)s=s*31+S.charCodeAt(w)|0}let c=Array.isArray(t)?t:[],l=0,p=0;for(let u of c){if(!u||o&&!o.has(Number(u.id)))continue;p++;let f=Number(u.id)||0,m=u.name?String(u.name):"",g=u.startDate?String(u.startDate):"",h=u.endDate?String(u.endDate):"",k=Date.parse(u.updatedAt||u.createdAt||"")||0;l=l*31+f+k|0;for(let v=0;v<m.length;v++)l=l*31+m.charCodeAt(v)|0;for(let v=0;v<g.length;v++)l=l*31+g.charCodeAt(v)|0;for(let v=0;v<h.length;v++)l=l*31+h.charCodeAt(v)|0}return`m:${Se}-${we+1}|b:${a?1:0}|pf:${o?o.size:0}|c:${r}|h:${s}|pc:${p}|ph:${l}`}function rd(e=500){Tn!==null&&clearTimeout(Tn),Tn=setTimeout(()=>{Tn=null,re(),Rn=ga()},e)}function Ym(){Ae(),Xn(),Ve(),Fe(),mt(),en(),Je(),cs()}function id(){let e=document.querySelector(".page.active");return e?e.id:null}function Ri(e={}){let t=!!e.calendarChanged;Ae(),cs();let a=id();if(a==="dashboard"){Xn();return}if(a==="projects"){Ve();return}if(a==="tasks"){let n=document.querySelector(".kanban-board");n&&!n.classList.contains("hidden")&&Fe(),document.getElementById("list-view")?.classList.contains("active")&&Je(),document.getElementById("calendar-view")?.classList.contains("active")&&(t?(Te("calendar-refresh-debounced",{reason:"data-changed"}),rd(500)):Te("calendar-refresh-skipped",{reason:"fingerprint-match"}));return}if(a==="updates"){en();return}a==="feedback"&&mt()}var $o=!1;async function Zn(){if($o)return;$o=!0,Te("init-start",{hasAuth:!!localStorage.getItem("authToken"),hasAdmin:!!localStorage.getItem("adminToken")});let e=ke("init","init",{hasAuth:!!localStorage.getItem("authToken"),hasAdmin:!!localStorage.getItem("adminToken")});if(!localStorage.getItem("authToken")&&!localStorage.getItem("adminToken")){console.log("Waiting for authentication before initializing app..."),$o=!1;return}typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(10),N=[],C=[],oe=[],Ke=[],pt=1,at=1,Tt=!0,typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(20);let t=po({preferCache:!0,onRefresh:g=>{if(Ne>0)return;Te("swr-refresh-start");let h=qa({tasks:C,projects:N,feedbackItems:oe}),k=qa(g);if(k===h){Te("swr-refresh-skip",{reason:"data-unchanged"});return}let v=ga(C,N),L=ga(g?.tasks||[],g?.projects||[]);Mn(g),_o=k,Rn=L,Ri({calendarChanged:L!==v}),Te("swr-refresh-applied",{calendarChanged:L!==v})},feedback:{limitPending:it,limitDone:it,cacheKey:Xo,preferCache:!0,onRefresh:Ni}}),a=mo().catch(()=>null),n=fo().catch(()=>({})),o=go().catch(()=>({})),s=window.historyService?.loadHistory?window.historyService.loadHistory().catch(()=>null):Promise.resolve(null),r=ke("init","load-data"),[i,c,l,p]=await Promise.all([t,a,n,o,s]);if(ye("init",r,{taskCount:i?.tasks?.length||0,projectCount:i?.projects?.length||0,feedbackCount:i?.feedbackItems?.length||0}),Te("init-data-loaded",{taskCount:i?.tasks?.length||0,projectCount:i?.projects?.length||0,feedbackCount:i?.feedbackItems?.length||0}),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(60),Mn(i),Le.length>0&&as(0),c&&typeof c=="object"){let g=c.sortMode,h=c.manualTaskOrder;g&&(De=g),h&&(de=h)}else try{let g=localStorage.getItem("sortMode"),h=localStorage.getItem("manualTaskOrder");g&&(De=g),h&&(de=JSON.parse(h))}catch{}(De==="auto"||De!=="priority"&&De!=="manual")&&(De="priority"),yt(),ut=l&&typeof l=="object"?l:{},p&&typeof p=="object"&&(F={...F,...p}),F.language=Wn(F.language),yn(F.debugLogsEnabled),$i(),typeof F.enableReviewStatus<"u"&&(window.enableReviewStatus=F.enableReviewStatus,localStorage.setItem("enableReviewStatus",String(F.enableReviewStatus))),ws(),Ru(),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(75),dd(),Hd(),_d(),Wd(),sc(),Al(),ku(),Dt(),nd(),Tu(),gi(),Te("init-ui-ready"),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(90),Tt=!1,y.search="",y.statuses.clear(),y.priorities.clear(),y.projects.clear(),y.tags.clear(),y.datePresets.clear(),y.dateFrom="",y.dateTo="",O.search="",O.statuses.clear(),O.taskFilter="",O.updatedFilter="all";try{localStorage.removeItem("projectsViewState")}catch{}try{localStorage.removeItem("kanbanUpdatedFilter")}catch{}window.kanbanUpdatedFilter="all";let u=window.location.hash.slice(1),f=["dashboard","projects","tasks","updates","feedback","calendar"];if(document.querySelectorAll(".nav-item").forEach(g=>g.classList.remove("active")),u==="calendar")Va();else if(u==="dashboard/recent_activity")document.querySelector('.nav-item[data-page="dashboard"]')?.classList.add("active"),ze("dashboard/recent_activity");else if(u.startsWith("project-")){let g=parseInt(u.replace("project-",""));document.querySelector('.nav-item[data-page="projects"]')?.classList.add("active"),Be(g)}else{let g=f.includes(u)?u==="calendar"?"tasks":u:"dashboard",h=document.querySelector(`.nav-item[data-page="${g}"]`);if(u==="calendar"?document.querySelector(".nav-item.calendar-nav")?.classList.add("active"):h&&h.classList.add("active"),document.querySelectorAll(".page").forEach(k=>k.classList.remove("active")),document.getElementById(g).classList.add("active"),u==="calendar"){document.querySelector(".kanban-board")?.classList.add("hidden"),document.getElementById("list-view")?.classList.remove("active"),document.getElementById("calendar-view")?.classList.add("active");let k=document.querySelector(".view-toggle");k&&k.classList.add("hidden");let v=document.getElementById("global-filters");v&&(v.style.display="none"),re()}}Ut(),_o=qa({tasks:C,projects:N,feedbackItems:oe}),Rn=ga(C,N),Te("init-render-complete"),await new Promise(requestAnimationFrame),await new Promise(requestAnimationFrame),Te("init-first-paint"),typeof updateBootSplashProgress=="function"&&updateBootSplashProgress(100),Da||(wl(),Tl()),Te("init-notifications-ready"),ye("init",e,{taskCount:C.length,projectCount:N.length,feedbackCount:oe.length,pendingSaves:Ne}),Te("init-complete",{taskCount:C.length,projectCount:N.length,feedbackCount:oe.length});function m(){let g=window.location.hash.slice(1),[h,k]=g.split("?"),v=new URLSearchParams(k||"");if(!(h==="login"||h==="admin-login"||h==="setup"))if(document.querySelectorAll(".nav-item").forEach(L=>L.classList.remove("active")),h==="dashboard/recent_activity")qe="projects",document.querySelector('.nav-item[data-page="dashboard"]')?.classList.add("active"),ze("dashboard/recent_activity"),dt=h;else if(h.startsWith("project-")){let L=parseInt(h.replace("project-",""));document.querySelector('.nav-item[data-page="projects"]')?.classList.add("active"),Be(L),dt=h}else if(h==="calendar")qe="projects",document.querySelector(".nav-item.calendar-nav")?.classList.add("active"),Va(),dt=h;else if(h==="tasks"){if(qe="projects",document.querySelector('.nav-item[data-page="tasks"]')?.classList.add("active"),v.has("search")?y.search=(v.get("search")||"").trim().toLowerCase():y.search="",v.has("status")){let L=v.get("status").split(",").filter(Boolean);y.statuses.clear(),L.forEach(S=>y.statuses.add(S.trim()))}else y.statuses.clear();if(v.has("priority")){let L=v.get("priority").split(",").filter(Boolean);y.priorities.clear(),L.forEach(S=>y.priorities.add(S.trim()))}else y.priorities.clear();if(v.has("project")){let L=v.get("project").split(",").filter(Boolean);y.projects.clear(),L.forEach(S=>y.projects.add(S.trim()))}else y.projects.clear();if(v.has("tags")){let L=v.get("tags").split(",").filter(Boolean);y.tags.clear(),L.forEach(S=>y.tags.add(S.trim()))}else y.tags.clear();if(v.has("datePreset")){let S=(v.get("datePreset")||"").split(",").filter(Boolean);y.datePresets.clear(),S.forEach(j=>y.datePresets.add(j.trim())),y.dateFrom="",y.dateTo="",y.dateField="endDate"}else if(v.has("dateFrom")||v.has("dateTo")){let L=v.get("dateFrom")||"",S=v.get("dateTo")||"";y.dateFrom=L,y.dateTo=S,y.dateField=v.get("dateField")||"endDate",y.datePresets.clear()}else y.datePresets.clear(),y.dateFrom="",y.dateTo="",y.dateField="endDate";if(v.has("updated")){let L=v.get("updated");if(new Set(["all","5m","30m","24h","week","month"]).has(L))try{Ya(L,{render:!1})}catch(j){console.error("Failed to set kanbanUpdatedFilter from URL:",j)}}if(v.has("view")){let L=v.get("view");(L==="list"||L==="kanban"||L==="calendar")&&setTimeout(()=>{let S=document.querySelectorAll(".view-btn"),j=Array.from(S).find(w=>w.dataset.view===L);j&&!j.classList.contains("active")&&j.click()},100)}ze("tasks"),setTimeout(()=>{let L=document.getElementById("filter-search");L&&(L.value=y.search),document.querySelectorAll('input[data-filter="status"]').forEach(w=>{w.checked=y.statuses.has(w.value)}),document.querySelectorAll('input[data-filter="priority"]').forEach(w=>{w.checked=y.priorities.has(w.value)}),document.querySelectorAll('input[data-filter="project"]').forEach(w=>{w.checked=y.projects.has(w.value)}),document.querySelectorAll('input[data-filter="tag"]').forEach(w=>{w.checked=y.tags.has(w.value)}),document.querySelectorAll('input[data-filter="date-preset"]').forEach(w=>{w.checked=y.datePresets.has(w.value)});let S=document.getElementById("filter-date-from"),j=document.getElementById("filter-date-to");if(S&&y.dateFrom){S.value=y.dateFrom;let w=S.closest(".date-input-wrapper")?.querySelector(".date-display");w&&(w.value=pe(y.dateFrom))}if(j&&y.dateTo){j.value=y.dateTo;let w=j.closest(".date-input-wrapper")?.querySelector(".date-display");w&&(w.value=pe(y.dateTo))}he(),Qa(),Oe()},100),dt=h}else if(h==="projects"){qe="projects",document.querySelector('.nav-item[data-page="projects"]')?.classList.add("active");let L={};if(v.has("search")&&(L.search=v.get("search")),v.has("status")){let S=v.get("status").split(",").filter(Boolean),j=["planning","active","completed"];L.statuses=S.filter(w=>j.includes(w.trim()))}if(v.has("filter")){let S=v.get("filter");["has-tasks","no-tasks"].includes(S)&&(L.filter=S)}if(v.has("sort")){let S=v.get("sort");["default","name","created-desc","updated-desc","tasks-desc","completion-desc"].includes(S)&&(L.sort=S)}if(v.has("sortDirection")){let S=v.get("sortDirection");(S==="asc"||S==="desc")&&(L.sortDirection=S)}if(v.has("updatedFilter")){let S=v.get("updatedFilter");["all","5m","30m","24h","week","month"].includes(S)&&(L.updatedFilter=S)}window.urlProjectFilters=L,ze("projects"),dt=h}else h==="updates"?(qe="projects",document.querySelector('.nav-item[data-page="updates"]')?.classList.add("active"),ze("updates"),dt=h):h==="feedback"?(qe="projects",document.querySelector('.nav-item[data-page="feedback"]')?.classList.add("active"),ze("feedback"),dt=h):(h===""||h==="dashboard")&&(qe="projects",document.querySelector('.nav-item[data-page="dashboard"]')?.classList.add("active"),ze("dashboard"),dt=h||"dashboard")}m(),window.addEventListener("hashchange",m),document.querySelectorAll(".view-btn").forEach(g=>{g.addEventListener("click",h=>{document.querySelectorAll(".view-btn").forEach(S=>S.classList.remove("active"));let k=h.currentTarget;k.classList.add("active");let v=(k.dataset.view||"").toLowerCase();try{let S=document.getElementById("backlog-quick-btn");S&&(S.style.display=v==="kanban"?"inline-flex":"none")}catch{}document.querySelector(".kanban-board").classList.add("hidden"),document.getElementById("list-view").classList.remove("active"),document.getElementById("calendar-view").classList.remove("active");let L=document.querySelector("#tasks .page-title");if(L&&(L.textContent=d("tasks.title")),v==="list"){let S=document.getElementById("global-filters");S&&(S.style.display=""),document.getElementById("list-view").classList.add("active"),Je(),yt();try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}let j=document.getElementById("kanban-settings-btn")?.parentElement;j&&(j.style.display="none"),Oa()}else if(v==="kanban"){let S=document.getElementById("backlog-quick-btn");S&&(S.style.display="inline-flex");let j=document.getElementById("global-filters");j&&(j.style.display=""),document.querySelector(".kanban-board").classList.remove("hidden"),Fe(),yt();try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}let w=document.getElementById("kanban-settings-btn")?.parentElement;w&&(w.style.display=""),Oa()}else if(v==="calendar"){let S=document.getElementById("calendar-view");if(!S)return;let j=document.getElementById("backlog-quick-btn");j&&(j.style.display="none");let w=document.getElementById("kanban-settings-btn")?.parentElement;w&&(w.style.display="none"),S.classList.add("preparing"),re(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ua(),S.classList.remove("preparing"),S.classList.add("active"),yt(),Oa()})})}})});try{let g=document.getElementById("backlog-quick-btn"),h=document.querySelector(".kanban-header .view-toggle");if(!g&&h&&h.parentElement){let k=document.createElement("button");k.type="button",k.id="backlog-quick-btn",k.className="backlog-quick-btn",k.title=d("tasks.backlogQuickTitle"),k.textContent=d("tasks.backlogQuickLabel"),k.addEventListener("click",L=>{L.preventDefault(),window.location.hash="#tasks?view=list&status=backlog"}),h.insertAdjacentElement("afterend",k);let v=(document.querySelector(".view-btn.active")?.dataset.view||"").trim().toLowerCase();k.style.display=v==="kanban"?"inline-flex":"none"}}catch{}cd()}function cd(){let e=document.querySelectorAll(".filter-chip");e.forEach(n=>{n.addEventListener("click",function(){e.forEach(s=>s.classList.remove("active")),this.classList.add("active");let o=this.dataset.period;qi(o)})}),document.querySelectorAll(".enhanced-stat-card").forEach(n=>{n.addEventListener("mouseenter",function(){this.style.transform="translateY(-4px) scale(1.02)"}),n.addEventListener("mouseleave",function(){this.style.transform="translateY(0) scale(1)"}),n.addEventListener("click",function(){let o=this.dataset.filter,s=this.dataset.value;o&&s&&Oi(o,s)})}),document.querySelectorAll(".quick-action").forEach(n=>{n.addEventListener("click",function(){this.style.transform="scale(0.95)",setTimeout(()=>{this.style.transform="scale(1)"},150)})})}function Oi(e,t){window.location.hash="tasks",document.querySelectorAll(".nav-item").forEach(c=>c.classList.remove("active"));let a=document.querySelector('.nav-item[data-page="tasks"]');a&&a.classList.add("active"),ze("tasks");let n=document.querySelector(".view-toggle");n&&n.classList.remove("hidden"),document.querySelectorAll(".view-btn").forEach(c=>c.classList.remove("active"));let o=document.querySelector(".view-btn:first-child");o&&o.classList.add("active");let s=document.querySelector(".kanban-board"),r=document.getElementById("list-view"),i=document.getElementById("calendar-view");s&&s.classList.remove("hidden"),i&&i.classList.remove("active"),r&&r.classList.remove("active");try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}Sc(),setTimeout(()=>{ld(e,t),Fe()},100)}function ld(e,t){if(e==="status")y.statuses.clear(),y.statuses.add(t),document.querySelectorAll('input[data-filter="status"]').forEach(n=>{n.checked=n.value===t});else if(e==="priority")y.priorities.clear(),y.priorities.add(t),y.statuses.clear(),y.statuses.add("todo"),y.statuses.add("progress"),y.statuses.add("review"),document.querySelectorAll('input[data-filter="priority"]').forEach(o=>{o.checked=o.value===t}),document.querySelectorAll('input[data-filter="status"]').forEach(o=>{o.checked=["todo","progress","review"].includes(o.value)});else if(e==="overdue"){let a=new Date().toISOString().split("T")[0];y.dateTo=a;let n=document.getElementById("filter-date-to");n&&(n.value=a),y.statuses.clear(),y.statuses.add("todo"),y.statuses.add("progress"),y.statuses.add("review"),document.querySelectorAll('input[data-filter="status"]').forEach(s=>{s.checked=["todo","progress","review"].includes(s.value)})}he(),xe()}function qi(e){let a={week:d("dashboard.trend.thisWeek"),month:d("dashboard.trend.thisMonth"),quarter:d("dashboard.trend.thisQuarter")}[e]||d("dashboard.trend.thisWeek"),n=document.getElementById("progress-change"),o=document.getElementById("completed-change");n&&(n.textContent=`+${Math.max(1,Math.floor(C.length*.1))} ${a}`),o&&(o.textContent=`+${C.filter(s=>s.status==="done").length} ${a}`)}function dd(){document.querySelectorAll(".nav-item").forEach(e=>{e.addEventListener("click",()=>{let t=e.dataset.page;if(t){if(t==="calendar"){Va(),document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active")),e.classList.add("active");return}if(t==="tasks"&&(document.getElementById("calendar-view")?.classList.remove("active"),document.getElementById("list-view")?.classList.remove("active")),window.location.hash=t,t==="tasks"){let n=window.location.hash.slice(1),[o,s]=n.split("?"),r=new URLSearchParams(s||"");if(o==="tasks"&&r.toString()===""){y.search="",y.statuses.clear(),y.priorities.clear(),y.projects.clear(),y.tags.clear(),y.datePresets.clear(),y.dateFrom="",y.dateTo="";try{Ya("all",{render:!1})}catch{}let i=document.getElementById("filter-search");i&&(i.value=""),document.querySelectorAll('#global-filters input[type="checkbox"]').forEach(c=>c.checked=!1)}}document.querySelectorAll(".nav-item").forEach(n=>n.classList.remove("active")),e.classList.add("active"),ze(t);let a=document.querySelector(".view-toggle");a&&(t==="tasks"?a.classList.remove("hidden"):a.classList.add("hidden"))}})})}function ze(e){if(e.includes("/")){let[s,r]=e.split("/");if(s==="dashboard"&&r==="recent_activity"){gd();return}}window.innerWidth<=768&&window.scrollTo({top:0,behavior:"smooth"}),document.querySelectorAll(".page").forEach(s=>s.classList.remove("active")),document.getElementById("project-details").classList.remove("active");let t=document.getElementById("activity-page");t&&(t.style.display="none");let a=document.querySelector(".dashboard-grid");a&&(a.style.display="grid");let n=document.querySelector(".insights-card");n&&(n.style.display="");let o=document.querySelector(".user-menu");if(o&&(o.style.display=""),document.getElementById(e).classList.add("active"),e==="dashboard")Ae(),Xn();else if(e==="projects"){Ae();try{nn(),Ju()}catch{}}else if(e==="tasks"){Ae();let s=window.location.hash.slice(1),[,r]=s.split("?");if(!new URLSearchParams(r||"").has("view")){document.querySelectorAll(".view-btn").forEach(f=>f.classList.remove("active")),document.querySelector(".view-btn:nth-child(1)").classList.add("active"),document.querySelector(".kanban-board").classList.remove("hidden"),document.getElementById("list-view").classList.remove("active"),document.getElementById("calendar-view").classList.remove("active");let l=document.querySelector("#tasks .page-title");l&&(l.textContent=d("tasks.title"));try{document.querySelector(".kanban-header")?.classList.remove("calendar-mode")}catch{}let p=document.getElementById("kanban-settings-btn")?.parentElement;p&&(p.style.display="");let u=document.getElementById("backlog-quick-btn");u&&(u.style.display="inline-flex")}Fe(),Je()}else e==="updates"?(Ae(),en(),Pl()):e==="feedback"&&mt()}function Ut(){Ae(),Xn(),Ve(),Fe(),mt(),en(),Je(),document.getElementById("calendar-view").classList.contains("active")&&re(),cs()}function cs(){let e=pl;document.querySelectorAll(".app-version").forEach(t=>t.textContent=e),document.querySelectorAll(".mobile-version").forEach(t=>t.textContent=e)}function ud(e){let t=(e||[]).map(a=>Ba(a)).filter(Boolean);return t.length?`
        <ul class="release-list">
            ${t.map(a=>`<li><span class="release-point-icon" aria-hidden="true"></span><span>${q(a)}</span></li>`).join("")}
        </ul>
    `:`<div class="release-section-empty">${d("updates.sectionEmpty")}</div>`}function en(){let e=document.getElementById("updates-content");if(!e)return;let t=bi();if(t.length===0){e.innerHTML=`<div class="updates-empty">${d("updates.empty")}</div>`;return}let a=t[0],n=t.slice(1),o=[a.version,Ba(a.title)].filter(Boolean).join(" - "),s=d("notifications.releaseMeta",{date:ai(a.date)}),r=a.summary?q(Ba(a.summary)):"",i=a.sections||{},l=[{key:"new",label:d("updates.sections.new")},{key:"improvements",label:d("updates.sections.improvements")},{key:"fixes",label:d("updates.sections.fixes")}].map(u=>{let f=i[u.key]||[];return`
            <div class="release-section-card release-section-card--${u.key}">
                <div class="release-section-card-header">
                    <span class="release-section-icon" data-kind="${u.key}" aria-hidden="true"></span>
                    <div>
                        <div class="release-section-title">${u.label}</div>
                    </div>
                </div>
                ${ud(f)}
            </div>
        `}).join(""),p=n.length?n.map(u=>{let f=[u.version,Ba(u.title)].filter(Boolean).join(" - "),m=ai(u.date),g=u.summary?q(Ba(u.summary)):"";return`
                <div class="release-history-item">
                    <div class="release-history-title">${q(f)}</div>
                    <div class="release-history-meta">${m}</div>
                    ${g?`<div class="release-history-summary">${g}</div>`:""}
                </div>
            `}).join(""):`<div class="release-history-empty">${d("updates.historyEmpty")}</div>`;e.innerHTML=`
        <div class="release-notes-stack">
            <article class="release-hero" data-release-id="${a.id}" aria-label="${d("updates.latestLabel")}">
                <div class="release-hero-top">
                    <span class="release-badge">${d("updates.latestLabel")}</span>
                    <span class="release-hero-meta">${s}</span>
                </div>
                <div class="release-hero-title">${q(o)}</div>
                ${r?`<p class="release-hero-summary">${r}</p>`:""}
            </article>
            <div class="release-section-stack">
                ${l}
            </div>
            <section class="release-history-block" aria-label="${d("updates.historyLabel")}">
                <div class="release-history-header">
                    <div>
                        <div class="release-history-label">${d("updates.historyLabel")}</div>
                        <div class="release-history-subtitle">${d("updates.subtitle")}</div>
                    </div>
                </div>
                <div class="release-history-list">
                    ${p}
                </div>
            </section>
        </div>
    `}function Xn(){let e=ke("render","dashboard",{taskCount:C.length,projectCount:N.length});pd(),Hi(),ls(),Ui(),yd();let t=document.getElementById("projects-stat-card");t&&(t.onclick=()=>{window.location.hash="projects"}),ye("render",e,{taskCount:C.length,projectCount:N.length})}function pd(){let e=ke("render","dashboard-stats",{taskCount:C.length,projectCount:N.length}),t=gr(C,N);document.getElementById("hero-active-projects").textContent=t.activeProjects,document.getElementById("hero-completion-rate").textContent=`${t.completionRate}%`;let a=document.querySelector(".progress-circle"),n=2*Math.PI*45,o=n-t.completionRate/100*n;a.style.strokeDashoffset=o,document.getElementById("ring-percentage").textContent=`${t.completionRate}%`,document.getElementById("in-progress-tasks").textContent=t.inProgressTasks,document.getElementById("pending-tasks-new").textContent=t.pendingTasks,document.getElementById("completed-tasks-new").textContent=t.completedTasks,document.getElementById("overdue-tasks").textContent=t.overdueTasks,document.getElementById("high-priority-tasks").textContent=t.highPriorityTasks,document.getElementById("research-milestones").textContent=t.milestones,zi(),ye("render",e,{activeProjects:t.activeProjects,totalTasks:t.totalTasks,completionRate:t.completionRate})}function zi(){let e=hr(C,N);document.getElementById("progress-change").textContent=`+${e.progressChange} ${d("dashboard.trend.thisWeek")}`,document.getElementById("pending-change").textContent=e.dueTodayCount>0?d(e.dueTodayCount===1?"dashboard.trend.dueTodayOne":"dashboard.trend.dueTodayMany",{count:e.dueTodayCount}):d("dashboard.trend.onTrack"),document.getElementById("completed-change").textContent=`+${e.thisWeekCompleted} ${d("dashboard.trend.thisWeek")}`;let t=document.getElementById("overdue-change");t&&(t.textContent=e.overdueCount>0?d("dashboard.trend.needsAttention"):d("dashboard.trend.allOnTrack"),t.classList.toggle("negative",e.overdueCount>0),t.classList.toggle("positive",e.overdueCount===0),t.classList.remove("neutral")),document.getElementById("priority-change").textContent=e.criticalHighPriority>0?d(e.criticalHighPriority===1?"dashboard.trend.criticalOne":"dashboard.trend.criticalMany",{count:e.criticalHighPriority}):d("dashboard.trend.onTrack"),document.getElementById("milestones-change").textContent=e.completedProjects>0?d(e.completedProjects===1?"dashboard.trend.completedOne":"dashboard.trend.completedMany",{count:e.completedProjects}):d("dashboard.trend.inProgress")}function Hi(){let e=document.getElementById("project-progress-bars");if(!e)return;if(N.length===0){e.innerHTML=`
            <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                <div style="font-size: 48px; margin-bottom: 16px;">\u{1F30A}</div>
                <div style="font-size: 16px; margin-bottom: 8px;">${d("dashboard.emptyProjects.title")}</div>
                <div style="font-size: 14px;">${d("dashboard.emptyProjects.subtitle")}</div>
            </div>
        `;return}let t=yr(N,C,5);e.innerHTML=vr(t,{tasksLabel:d("dashboard.tasks")})}function ls(){let e=document.getElementById("activity-feed");if(!e)return;let t=[];if(C.filter(s=>s.status==="done").sort((s,r)=>new Date(r.completedDate||r.createdAt||r.createdDate)-new Date(s.completedDate||s.createdAt||s.createdDate)).slice(0,3).forEach(s=>{let r=N.find(l=>l.id===s.projectId),i=s.completedDate||s.createdAt||s.createdDate,c=r?d("dashboard.activity.inProject",{project:r.name}):"";t.push({type:"completed",text:d("dashboard.activity.completed",{title:s.title,projectPart:c}).trim(),timeText:No(i),date:i,icon:"\u2705"})}),N.sort((s,r)=>new Date(r.createdAt||r.createdDate)-new Date(s.createdAt||s.createdDate)).slice(0,2).forEach(s=>{let r=s.createdAt||s.createdDate;t.push({type:"created",text:d("dashboard.activity.createdProject",{project:s.name}),timeText:No(r),date:r,icon:"\u{1F680}"})}),C.filter(s=>s.status!=="done").sort((s,r)=>new Date(r.createdAt||r.createdDate)-new Date(s.createdAt||s.createdDate)).slice(0,2).forEach(s=>{let r=s.createdAt||s.createdDate,i=N.find(l=>l.id===s.projectId),c=i?d("dashboard.activity.toProject",{project:i.name}):"";t.push({type:"created",text:d("dashboard.activity.addedTask",{title:s.title,projectPart:c}).trim(),timeText:No(r),date:r,icon:"\u{1F4DD}"})}),t.sort((s,r)=>new Date(r.date)-new Date(s.date)),t.length===0){e.innerHTML=`
            <div class="activity-item">
                <div class="activity-icon completed">\u{1F30A}</div>
                <div class="activity-content">
                    <div class="activity-text">${d("dashboard.activity.emptyTitle")}</div>
                    <div class="activity-time">${d("dashboard.activity.emptySubtitle")}</div>
                </div>
            </div>
        `;return}e.innerHTML=br(t.slice(0,4),vd)}function md(){window.location.hash="dashboard/recent_activity"}function fd(){window.location.hash="dashboard"}function Km(){document.querySelectorAll(".page").forEach(a=>{a.classList.remove("active")}),document.getElementById("dashboard").classList.add("active"),document.querySelector(".dashboard-grid").style.display="none";let e=document.querySelector(".insights-card");e&&(e.style.display="none");let t=document.getElementById("activity-page");t||(t=document.createElement("div"),t.id="activity-page",t.className="activity-page",t.innerHTML=`
            <div class="activity-page-header">
                <button class="back-btn" data-action="backToDashboard" data-i18n="dashboard.activity.backToDashboard">${d("dashboard.activity.backToDashboard")}</button>
                <h2 data-i18n="dashboard.activity.allTitle">${d("dashboard.activity.allTitle")}</h2>
            </div>
            <div id="all-activity-list" class="all-activity-list"></div>
        `,document.querySelector(".dashboard-content").appendChild(t)),t.style.display="block",ds();try{t.scrollIntoView({behavior:"auto",block:"start"})}catch{window.scrollTo(0,0)}document.querySelectorAll(".nav-item").forEach(a=>a.classList.remove("active")),document.querySelector('.nav-item[data-page="dashboard"]').classList.add("active")}function gd(){document.querySelectorAll(".page").forEach(t=>{t.classList.remove("active")});let e=document.getElementById("activity-page");if(!e){e=document.createElement("div"),e.id="activity-page",e.className="page",e.innerHTML=`
            <div class="page-header">
                <div>
                    <h1 class="page-title" data-i18n="dashboard.activity.allTitle">${d("dashboard.activity.allTitle")}</h1>
                    <p class="page-subtitle" data-i18n="dashboard.activity.allSubtitle">${d("dashboard.activity.allSubtitle")}</p>
                </div>
                <button class="view-all-btn back-btn" data-action="backToDashboard" data-i18n="dashboard.activity.backToDashboard">${d("dashboard.activity.backToDashboard")}</button>
            </div>
            <div class="page-content">
                <div id="all-activity-list" class="all-activity-list"></div>
            </div>
        `;let t=document.querySelector(".main-content");t&&t.appendChild(e)}e.classList.add("active"),e.style.display="flex",ds();try{e.scrollIntoView({behavior:"auto",block:"start"})}catch{window.scrollTo(0,0)}document.querySelectorAll(".nav-item").forEach(t=>t.classList.remove("active")),document.querySelector('.nav-item[data-page="dashboard"]').classList.add("active")}function ds(){let e=[];C.filter(o=>o.status==="done").sort((o,s)=>new Date(s.completedDate||s.createdAt||s.createdDate)-new Date(o.completedDate||o.createdAt||o.createdDate)).forEach(o=>{let s=N.find(c=>c.id===o.projectId),r=o.completedDate||o.createdAt||o.createdDate,i=s?d("dashboard.activity.inProject",{project:s.name}):"";e.push({type:"completed",text:d("dashboard.activity.completed",{title:o.title,projectPart:i}).trim(),date:r,icon:"\u2705"})}),N.sort((o,s)=>new Date(s.createdAt||s.createdDate)-new Date(o.createdAt||o.createdDate)).forEach(o=>{e.push({type:"created",text:d("dashboard.activity.createdProject",{project:o.name}),date:o.createdAt||o.createdDate,icon:"\u{1F680}"})}),C.sort((o,s)=>new Date(s.createdAt||s.createdDate)-new Date(o.createdAt||o.createdDate)).forEach(o=>{let s=N.find(i=>i.id===o.projectId),r=s?d("dashboard.activity.toProject",{project:s.name}):"";e.push({type:"created",text:d("dashboard.activity.addedTask",{title:o.title,projectPart:r}).trim(),date:o.createdAt||o.createdDate,icon:"\u{1F4DD}"})}),e.sort((o,s)=>new Date(s.date)-new Date(o.date));let a=document.getElementById("all-activity-list");if(!a)return;let n=e.map(o=>`
        <div class="activity-item-full">
            <div class="activity-icon ${o.type}">${o.icon}</div>
            <div class="activity-content">
                <div class="activity-text">${o.text}</div>
            </div>
            <div class="activity-full-date">${new Date(o.date).toLocaleDateString(It(),{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}</div>
        </div>
    `).join("");a.innerHTML=n}function Ui(){let e=document.getElementById("insights-list");if(!e)return;let a=hd().map(n=>`
        <div class="insight-item ${n.type}">
            <div class="insight-icon">${n.icon}</div>
            <div class="insight-content">
                <div class="insight-title">${n.title}</div>
                <div class="insight-desc">${n.description}</div>
            </div>
        </div>
    `).join("");e.innerHTML=a}function hd(){let e=[],t=C.length,a=C.filter(i=>i.status==="done").length,n=new Date().toISOString().split("T")[0],o=C.filter(i=>i.endDate&&i.endDate<n&&i.status!=="done").length,s=C.filter(i=>i.priority==="high").length,r=C.filter(i=>{if(!i.endDate)return!1;let c=new Date().toDateString();return new Date(i.endDate).toDateString()===c&&i.status!=="done"}).length;if(t>0){let i=a/t*100;i>=80?e.push({type:"success",icon:"\u{1F3AF}",title:d("dashboard.insights.excellentTitle"),description:d("dashboard.insights.excellentDesc",{percent:i.toFixed(0)})}):i>=60?e.push({type:"success",icon:"\u{1F4C8}",title:d("dashboard.insights.goodTitle"),description:d("dashboard.insights.goodDesc",{percent:i.toFixed(0)})}):i>=30?e.push({type:"warning",icon:"\u26A1",title:d("dashboard.insights.opportunityTitle"),description:d("dashboard.insights.opportunityDesc",{percent:i.toFixed(0)})}):e.push({type:"priority",icon:"\u{1F6A8}",title:d("dashboard.insights.actionTitle"),description:d("dashboard.insights.actionDesc",{percent:i.toFixed(0)})})}if(r>0&&e.push({type:"priority",icon:"\u{1F4C5}",title:d("dashboard.insights.todayTitle"),description:d(r===1?"dashboard.insights.todayDescOne":"dashboard.insights.todayDescMany",{count:r})}),o>0&&r===0&&e.push({type:"warning",icon:"\u23F0",title:d("dashboard.insights.overdueTitle"),description:d(o===1?"dashboard.insights.overdueDescOne":"dashboard.insights.overdueDescMany",{count:o})}),s>0){let i=C.filter(c=>c.priority==="high"&&c.status!=="done").length;i>0&&e.push({type:"priority",icon:"\u{1F525}",title:d("dashboard.insights.highPriorityTitle"),description:d(i===1?"dashboard.insights.highPriorityDescOne":"dashboard.insights.highPriorityDescMany",{count:i})})}if(N.length>1){let i=N.filter(l=>C.some(p=>p.projectId===l.id)).length,c=N.length-i;c>0&&e.push({type:"warning",icon:"\uFFFD",title:d("dashboard.insights.emptyProjectsTitle"),description:d(c===1?"dashboard.insights.emptyProjectsDescOne":"dashboard.insights.emptyProjectsDescMany",{count:c})})}if(t>=5){let i=C.filter(c=>{if(c.status!=="done"||!c.completedDate)return!1;let l=new Date;return l.setDate(l.getDate()-7),new Date(c.completedDate)>l}).length;i>=3&&e.push({type:"success",icon:"\u{1F680}",title:d("dashboard.insights.momentumTitle"),description:d(i===1?"dashboard.insights.momentumDescOne":"dashboard.insights.momentumDescMany",{count:i})})}return e.length===0&&(t===0?e.push({type:"priority",icon:"\u{1F30A}",title:d("dashboard.insights.readyTitle"),description:d("dashboard.insights.readyDesc")}):e.push({type:"success",icon:"\u2705",title:d("dashboard.insights.caughtUpTitle"),description:d("dashboard.insights.caughtUpDesc")})),e.slice(0,3)}function yd(){document.querySelectorAll(".enhanced-stat-card").forEach((a,n)=>{a.style.opacity="0",a.style.transform="translateY(20px)",setTimeout(()=>{a.style.transition="all 0.4s ease",a.style.opacity="1",a.style.transform="translateY(0)"},n*100)}),document.querySelectorAll(".hero-stat-card").forEach((a,n)=>{a.style.opacity="0",a.style.transform="translateX(-30px)",setTimeout(()=>{a.style.transition="all 0.6s ease",a.style.opacity="1",a.style.transform="translateX(0)"},n*200)})}function No(e){if(!e)return d("dashboard.activity.recently");let t=new Date(e),n=Math.floor((new Date-t)/1e3);if(n<60)return d("dashboard.activity.justNow");if(n<3600){let o=Math.floor(n/60);return d(o===1?"dashboard.activity.minuteAgo":"dashboard.activity.minutesAgo",{count:o})}if(n<86400){let o=Math.floor(n/3600);return d(o===1?"dashboard.activity.hourAgo":"dashboard.activity.hoursAgo",{count:o})}if(n<604800){let o=Math.floor(n/86400);return d(o===1?"dashboard.activity.dayAgo":"dashboard.activity.daysAgo",{count:o})}return t.toLocaleDateString(It())}function vd(e){if(!e)return"";let t=new Date(e),n=Math.floor((new Date-t)/(1e3*60*60*24));return n===0?d("dashboard.activity.today"):n===1?d("dashboard.activity.yesterday"):n<7?d("dashboard.activity.daysAgoShort",{count:n}):t.toLocaleDateString(It(),{month:"short",day:"numeric"})}function bd(){window.authSystem&&window.authSystem.logout&&window.authSystem.logout()}function kd(){document.getElementById("export-data-modal").classList.add("active")}function _i(){document.getElementById("export-data-modal").classList.remove("active")}function wd(){_i();let e=window.authSystem?window.authSystem.getCurrentUser():null,t={user:e?{id:e.id,username:e.username,name:e.name,email:e.email}:null,projects:N,tasks:C,feedbackItems:oe,projectColors:ut,sortMode:De,manualTaskOrder:de,settings:F,history:window.historyService?window.historyService.getHistory():[],projectCounter:pt,taskCounter:at,statistics:{totalProjects:N.length,totalTasks:C.length,completedTasks:C.filter(i=>i.status==="done").length,completionRate:C.length>0?(C.filter(i=>i.status==="done").length/C.length*100).toFixed(1):0,feedbackCount:oe.length},exportDate:new Date().toISOString(),exportVersion:"2.0",sourceSystem:"Nautilus Multi-User"},a=JSON.stringify(t,null,2),n="data:application/json;charset=utf-8,"+encodeURIComponent(a),s=`nautilus-complete-backup-${e?.username||"user"}-${new Date().toISOString().split("T")[0]}.json`,r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",s),r.click(),Gt("Complete backup exported successfully! All data, settings, and history included.","success")}async function Sd(){Gt("Generando reporte...","info");try{let{generateWordReport:e}=await Promise.resolve().then(()=>(Xr(),Zr)),t=await e(N,C);if(t.success)Gt(`\u2705 Reporte generado: ${t.filename}`,"success"),console.log("Report Summary:",{activeProjects:t.insights.activeProjectsCount,completedTasks:`${t.insights.completedTasks}/${t.insights.totalTasks}`,progress:`${t.insights.completionPercent}%`});else throw new Error(t.error)}catch(e){console.error("Error generating report:",e),Gt("\u274C Error al generar el reporte: "+e.message,"error")}}function Ae(){document.getElementById("projects-count").textContent=N.length,document.getElementById("tasks-count").textContent=C.length;let e=document.getElementById("active-projects"),t=document.getElementById("pending-tasks"),a=document.getElementById("completed-tasks");e&&(e.textContent=N.length),t&&(t.textContent=C.filter(l=>l.status!=="done").length),a&&(a.textContent=C.filter(l=>l.status==="done").length);let n=document.getElementById("todo-count"),o=document.getElementById("progress-count"),s=document.getElementById("review-count"),r=document.getElementById("done-count");n&&(n.textContent=C.filter(l=>l.status==="todo").length),o&&(o.textContent=C.filter(l=>l.status==="progress").length),s&&(s.textContent=C.filter(l=>l.status==="review").length),r&&(r.textContent=C.filter(l=>l.status==="done").length);let i=oe.filter(l=>l.status==="open").length,c=document.getElementById("feedback-count");c&&(c.textContent=i),Rt()}var Yt={column:null,direction:"asc"};function Ed(e){Yt.column===e?Yt.direction=Yt.direction==="asc"?"desc":"asc":(Yt.column=e,Yt.direction="asc"),document.querySelectorAll(".tasks-table th .sort-indicator").forEach(a=>{a.textContent="\u2195",a.style.opacity="0.5"});let t=document.getElementById(`sort-${e}`);t&&(t.textContent=Yt.direction==="asc"?"\u2191":"\u2193",t.style.opacity="1"),Je()}function Je(){let e=document.getElementById("tasks-table-body"),t=typeof kt=="function"?kt():C.slice(),a=ca(window.kanbanUpdatedFilter),o=Ar(t,{currentSort:Yt,projects:N,updatedCutoff:a,getTaskUpdatedTime:Pt}).tasks,s=d("tasks.list.count",{count:o.length})||`${o.length} results`,r=document.getElementById("tasks-list-count");r&&(r.textContent=s);let i=document.getElementById("tasks-list-count-bottom");if(i&&(i.textContent=s),e){let c={escapeHtml:q,formatDate:pe,getTagColor:na,getProjectColor:Ie,getPriorityLabel:ot,getStatusLabel:We,formatTaskUpdatedDateTime:sr,projects:N,noProjectText:d("tasks.noProject"),noDateText:d("tasks.noDate")};e.innerHTML=Pr(o,c)}Td(o)}function Dd(e,t=null){let a=Lr(e,t);if(!a.hasDate)return{text:d("tasks.noEndDate"),class:"",showPrefix:!1};let n;switch(a.urgency){case"overdue":n=a.daysOverdue===1?d("tasks.due.yesterday"):d("tasks.due.daysOverdue",{count:a.daysOverdue});break;case"tomorrow":n=d("tasks.due.tomorrow");break;default:n=pe(e)}return{text:n,class:a.class,showPrefix:a.showPrefix}}function Td(e){let t=document.getElementById("tasks-list-mobile");if(!t)return;let a=new Set(Array.from(t.querySelectorAll(".task-card-mobile.expanded")).map(o=>parseInt(o.dataset.taskId,10)).filter(Number.isFinite)),n=o=>{let s=document.createElement("div");s.innerHTML=o||"";let r=Array.from(s.querySelectorAll(".checkbox-row")),i=r.map(p=>{let u=p.querySelector(".checkbox-toggle"),f=u?.getAttribute("aria-pressed")==="true"||u?.classList?.contains("checked"),m=(p.querySelector(".check-text")?.textContent||"").trim();return m?`${f?"\u2713":"\u2610"} ${m}`:null}).filter(Boolean);r.forEach(p=>p.remove());let c=(s.textContent||s.innerText||"").replace(/\s+/g," ").trim(),l=i.join(`
`).trim();return c&&l?`${c}
${l}`:c||l};if(e.length===0){t.innerHTML=`
            <div class="tasks-list-mobile-empty">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
                <h3>${d("projects.details.noTasksFound")}</h3>
                <p>Try adjusting your filters or create a new task</p>
            </div>
        `;return}t.innerHTML=e.map(o=>{let s=N.find(u=>u.id===o.projectId),r=s?Ie(s.id):"#999",i=Dd(o.endDate,o.status),c=n(o.description),l=o.tags&&o.tags.length>0?o.tags.map(u=>{let f=na(u);return`<span class="card-tag-premium" style="background:${f}; border-color:${f}; color:#ffffff;">${q(u.toUpperCase())}</span>`}).join(""):"",p=o.attachments&&o.attachments.length>0?o.attachments.length:0;return`
            <div class="task-card-mobile" data-priority="${o.priority}" data-task-id="${o.id}">
                <!-- Header (always visible) -->
                <div class="card-header-premium">
                    <div class="card-header-content" data-card-action="toggle">
                        <h3 class="card-title-premium">${q(o.title||d("tasks.untitled"))}</h3>
                        <div class="card-meta-premium">
                            <span class="status-badge-mobile ${o.status}">${We(o.status)}</span>
                            ${i.text?`<span class="card-date-smart ${i.class}">${i.showPrefix?d("tasks.endDatePrefix"):""}${i.text}</span>`:""}
                        </div>
                    </div>
                    <div class="card-actions-premium">
                        <button class="card-open-btn-premium" data-card-action="open" title="${d("tasks.openTaskDetails")}">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </button>
                        <svg class="card-chevron-premium" data-card-action="toggle" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </div>

                <!-- Expandable body -->
                <div class="card-body-premium">
                    ${c?`
                    <div class="card-description-premium">
                        <div class="card-description-premium-label">${d("tasks.card.description")}</div>
                        <div class="card-description-premium-text">${q(c)}</div>
                    </div>
                    `:""}

                    ${l?`
                    <div class="card-tags-premium">${l}</div>
                    `:""}

                    ${s?`
                    <div class="card-project-premium">
                        <span class="card-project-dot-premium" style="background-color: ${r};"></span>
                        <span class="card-project-name-premium">${q(s.name)}</span>
                    </div>
                    `:""}

                    <div class="card-footer-premium">
                        ${o.startDate?`
                        <div class="card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${d("tasks.startDatePrefix")}${pe(o.startDate)}</span>
                        </div>
                        `:""}
                        ${o.endDate?`
                        <div class="card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${d("tasks.endDatePrefix")}${pe(o.endDate)}</span>
                        </div>
                        `:""}
                        ${p>0?`
                        <div class="card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13" />
                            </svg>
                            <span>${p}</span>
                        </div>
                        `:""}
                    </div>
                </div>
            </div>
        `}).join(""),xd(),a.size>0&&a.forEach(o=>{let s=t.querySelector(`.task-card-mobile[data-task-id="${o}"]`);s&&s.classList.add("expanded")})}function xd(){document.querySelectorAll(".task-card-mobile").forEach(t=>{let a=parseInt(t.dataset.taskId),n=t.querySelectorAll('[data-card-action="toggle"]'),o=t.querySelector('[data-card-action="open"]');n.forEach(s=>{s.addEventListener("click",r=>{r.stopPropagation(),document.querySelectorAll(".task-card-mobile.expanded").forEach(i=>{i!==t&&i.classList.remove("expanded")}),t.classList.toggle("expanded")})}),o&&o.addEventListener("click",s=>{s.stopPropagation(),xa(a)})})}function Jm(e){let t=document.getElementById(e),a=t.parentElement.querySelector(".select-display"),n=Array.from(t.selectedOptions),o=n.some(s=>s.hasAttribute("data-all"));n.length===0||o?a.classList.remove("has-selection"):a.classList.add("has-selection"),n.length===0||o?e==="filter-status"?a.textContent="All Statuses \u25BC":e==="filter-priority"?a.textContent="All Priorities \u25BC":e==="filter-project"&&(a.textContent="All Projects \u25BC"):n.length===1?a.textContent=n[0].textContent+" \u25BC":a.textContent=`${n.length} selected \u25BC`}function Zm(e){let t=document.getElementById(e),a=t.classList.contains("active");document.querySelectorAll(".multi-select.active").forEach(n=>n.classList.remove("active")),a||(t.classList.add("active"),t.focus())}document.addEventListener("click",function(e){e.target.closest(".multi-select-wrapper")||document.querySelectorAll(".multi-select.active").forEach(t=>t.classList.remove("active"))});function us(e){return Hr(e,C,{escapeHtml:q,formatDatePretty:hn,getProjectColor:Ie,getProjectStatus:ta,getProjectStatusLabel:Gn,getTagColor:na,getPriorityLabel:ot,getStatusLabel:We,getLocale:It,t:d})}var xn=null;function Id(e=document){(e.querySelectorAll?.(".expanded-task-item")||[]).forEach(a=>{if(a.offsetParent===null)return;a.classList.remove("expanded-task-item--stacked");let n=a.querySelector(".expanded-task-meta");if(!n)return;let o=n.querySelector(".task-tags"),s=n.querySelector(".expanded-task-dates"),r=c=>c&&c.clientWidth>0&&c.scrollWidth>c.clientWidth+1;(r(a)||r(n)||r(o)||r(s))&&a.classList.add("expanded-task-item--stacked")})}function Qn(e=document){xn!==null&&cancelAnimationFrame(xn),xn=requestAnimationFrame(()=>{xn=null,Id(e)})}function Ve(){let e=ke("render","projects",{projectCount:N.length}),t=document.getElementById("projects-list");if(N.length===0){t.innerHTML=`<div class="empty-state"><h3>${d("projects.empty.title")}</h3><p>${d("projects.empty.subtitle")}</p></div>`;let o=document.getElementById("projects-list-mobile");o&&(o.innerHTML=""),ye("render",e,{projectCount:N.length,rendered:0});return}let a=new Set;t.querySelectorAll(".project-list-item.expanded").forEach(o=>{let s=o.id.replace("project-item-","");a.add(s)});let n=te.projectsSortedView||N;t.innerHTML=n.map(us).join(""),a.forEach(o=>{let s=document.getElementById(`project-item-${o}`);s&&s.classList.add("expanded")}),On(n),Qn(t),ye("render",e,{projectCount:N.length,rendered:n.length})}function Vi(e){let t=document.getElementById(`project-item-${e}`);t&&(t.classList.toggle("expanded"),Qn(t))}window.toggleProjectExpand=Vi;function On(e){let t=document.getElementById("projects-list-mobile");if(t){if(e.length===0){t.innerHTML=`
            <div class="projects-list-mobile-empty">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z" />
                </svg>
                <h3>${d("projects.empty.searchTitle")}</h3>
                <p>${d("projects.empty.searchSubtitle")}</p>
            </div>
        `;return}t.innerHTML=e.map(a=>{let n=C.filter(m=>m.projectId===a.id),o=n.filter(m=>m.status==="done").length,s=n.filter(m=>m.status==="progress").length,r=n.filter(m=>m.status==="review").length,i=n.filter(m=>m.status==="todo").length,c=n.filter(m=>m.status==="backlog").length,l=n.length,p=l>0?Math.round(o/l*100):0,u=Ie(a.id),f=ta(a.id);return`
            <div class="project-card-mobile" data-project-id="${a.id}">
                <!-- Header (always visible) -->
                <div class="project-card-header-premium">
                    <div class="project-card-header-content" data-card-action="toggle">
                        <div class="project-card-title-row">
                            <span class="project-swatch-mobile" style="background: ${u};"></span>
                            <h3 class="project-card-title-premium">${q(a.name||"Untitled Project")}</h3>
                        </div>
                        <div class="project-card-meta-premium">
                            <span class="project-status-badge-mobile ${f}">${f}</span>
                            <span class="project-card-tasks-count">${d("projects.card.tasksCount",{count:l})}</span>
                            ${p>0?`<span class="project-card-completion">${d("projects.card.percentDone",{count:p})}</span>`:""}
                        </div>
                    </div>
                    <div class="project-card-actions-premium">
                        <button class="project-card-open-btn-premium" data-action="showProjectDetails" data-param="${a.id}" title="${d("projects.openDetailsTitle")}">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                            </svg>
                        </button>
                        <svg class="project-card-chevron-premium" data-card-action="toggle" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                        </svg>
                    </div>
                </div>

                <!-- Expandable body -->
                <div class="project-card-body-premium">
                    ${a.tags&&a.tags.length>0?`
                    <div class="project-card-tags-premium" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 12px;">
                        ${a.tags.map(m=>`<span style="background-color: ${Ie(a.id)}; color: white; padding: 3px 8px; border-radius: 4px; font-size: 11px; font-weight: 500;">${q(m.toUpperCase())}</span>`).join("")}
                    </div>
                    `:""}

                    ${a.description?`
                    <div class="project-card-description-premium">
                        <div class="project-card-description-label">${d("tasks.card.description")}</div>
                        <div class="project-card-description-text">${q(a.description)}</div>
                    </div>
                    `:""}

                    <div class="project-card-footer-premium">
                        ${a.startDate?`
                        <div class="project-card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${d("projects.details.startDate")}: ${pe(a.startDate)}</span>
                        </div>
                        `:""}
                        ${a.endDate?`
                        <div class="project-card-meta-item-premium">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span>${d("tasks.endDatePrefix")}${pe(a.endDate)}</span>
                        </div>
                        `:""}
                    </div>

                    ${l>0?`
                    <div class="project-card-progress-premium">
                        <div class="project-card-progress-label">${d("projects.details.taskProgress")}</div>
                        <div class="project-card-progress-bar">
                            <div class="progress-segment done" style="width: ${o/l*100}%;"></div>
                            <div class="progress-segment progress" style="width: ${s/l*100}%;"></div>
                            <div class="progress-segment review" style="width: ${r/l*100}%;"></div>
                            <div class="progress-segment todo" style="width: ${i/l*100}%;"></div>
                            <div class="progress-segment backlog" style="width: ${c/l*100}%;"></div>
                        </div>
                        <div class="project-card-breakdown">
                            ${o>0?`<span class="breakdown-item done">${o} ${d("tasks.status.done")}</span>`:""}
                            ${s>0?`<span class="breakdown-item progress">${s} ${d("tasks.status.progress")}</span>`:""}
                            ${r>0?`<span class="breakdown-item review">${r} ${d("tasks.status.review")}</span>`:""}
                            ${i>0?`<span class="breakdown-item todo">${i} ${d("tasks.status.todo")}</span>`:""}
                            ${c>0?`<span class="breakdown-item backlog">${c} ${d("tasks.status.backlog")}</span>`:""}
                        </div>
                    </div>
                    `:""}
                </div>
            </div>
        `}).join(""),jd()}}function jd(){document.querySelectorAll(".project-card-mobile").forEach(t=>{let a=parseInt(t.dataset.projectId),n=t.querySelectorAll('[data-card-action="toggle"]'),o=t.querySelector('[data-action="showProjectDetails"]');n.forEach(s=>{s.addEventListener("click",r=>{r.stopPropagation(),document.querySelectorAll(".project-card-mobile.expanded").forEach(i=>{i!==t&&i.classList.remove("expanded")}),t.classList.toggle("expanded")})}),o&&o.addEventListener("click",s=>{s.stopPropagation(),Be(a)})})}function Fe(){let e=ke("render","tasks",{taskCount:C.length}),t=typeof kt=="function"?kt():C.slice(),a=ca(window.kanbanUpdatedFilter),n=Tr(t,{showBacklog:window.kanbanShowBacklog===!0,sortMode:De,manualTaskOrder:de,updatedCutoff:a,getTaskUpdatedTime:Pt}),o=n.byStatus,s=n.totalFiltered,r={backlog:document.getElementById("backlog-tasks"),todo:document.getElementById("todo-tasks"),progress:document.getElementById("progress-tasks"),review:document.getElementById("review-tasks"),done:document.getElementById("done-tasks")},i=n.counts,c=document.getElementById("backlog-count"),l=document.getElementById("todo-count"),p=document.getElementById("progress-count"),u=document.getElementById("review-count"),f=document.getElementById("done-count");c&&(c.textContent=i.backlog),l&&(l.textContent=i.todo),p&&(p.textContent=i.progress),u&&(u.textContent=i.review),f&&(f.textContent=i.done);let m={escapeHtml:q,formatDate:pe,getProjectColor:Ie,getTagColor:na,getPriorityLabel:ot,projects:N,selectedCards:te.selectedCards,showProjects:window.kanbanShowProjects!==!1,showNoDate:window.kanbanShowNoDate!==!1,noProjectText:d("tasks.noProject"),noDateText:d("tasks.noDate")};["backlog","todo","progress","review","done"].forEach(g=>{let h=r[g];h&&(h.innerHTML=xr(o[g],m))}),Ad(),yt(),ye("render",e,{taskCount:C.length,filteredCount:t.length,kanbanCount:s})}function wa(){if(window.innerWidth>768)return;let e=document.getElementById("task-modal");if(!e)return;let a=e.querySelector("#task-form")?.dataset.editingTaskId;if(!a)return;let n=e.dataset.initialStartDate==="true",o=e.dataset.initialEndDate==="true",s=null;a&&(s=C.find(v=>v.id===parseInt(a,10))),s||(s={tags:window.tempTags||[],attachments:$e||[]});let r=Ur(s,{startDateWasEverSet:n,endDateWasEverSet:o}),i=e.querySelector("#tag-input"),c=i?i.closest(".form-group"):null,l=e.querySelectorAll('input[name="startDate"]'),p=null;for(let v of l){let L=v.closest(".form-group");if(L){p=L;break}}let u=e.querySelectorAll('input[name="endDate"]'),f=null;for(let v of u){let L=v.closest(".form-group");if(L){f=L;break}}let m=e.querySelector("#attachments-links-list"),g=m?m.closest(".form-group"):null;c&&(c.classList.toggle("mobile-general-field",r.tagsInGeneral),c.classList.toggle("mobile-details-field",!r.tagsInGeneral)),p&&(p.classList.toggle("mobile-general-field",r.startDateInGeneral),p.classList.toggle("mobile-details-field",!r.startDateInGeneral)),f&&(f.classList.toggle("mobile-general-field",r.endDateInGeneral),f.classList.toggle("mobile-details-field",!r.endDateInGeneral)),g&&(g.classList.toggle("mobile-general-field",r.linksInGeneral),g.classList.toggle("mobile-details-field",!r.linksInGeneral));let h=e.querySelector('.modal-tab[data-tab="details"]'),k=_r(r);console.log("\u{1F504} Reorganizing fields:",{...r,hideDetailsTab:k}),h&&(k?(console.log("\u2705 Hiding Details tab - Tags and Links both filled"),h.classList.add("hide-details-tab")):(console.log("\u{1F441}\uFE0F Showing Details tab - some dynamic fields empty"),h.classList.remove("hide-details-tab")))}var _t=null;function xa(e,t=null){let a=C.find(x=>x.id===e);if(!a)return;let n=document.getElementById("task-modal");if(!n)return;_t=t;let o=n.querySelector('.modal-tab[data-tab="general"]'),s=n.querySelector('.modal-tab[data-tab="details"]'),r=n.querySelector('.modal-tab[data-tab="history"]'),i=n.querySelector("#task-details-tab"),c=n.querySelector("#task-history-tab");o&&o.classList.add("active"),s&&s.classList.remove("active"),r&&r.classList.remove("active"),i&&i.classList.add("active"),c&&c.classList.remove("active"),document.body.classList.remove("mobile-tab-details-active"),r&&(r.style.display="");let l=n.querySelector(".modal-content");l&&(l.style.minHeight="",l.style.maxHeight="");let p=n.querySelector("h2");p&&(p.textContent="Edit Task");let u=n.querySelector(".modal-close");u&&(u.style.display="inline-block");let f=n.querySelector("#task-options-btn");f&&(f.style.display="inline-block");let m=n.querySelector("#task-footer");m&&(m.style.display="none"),Yi();let g=n.querySelector("#hidden-project"),h=n.querySelector("#project-current");if(g&&h){g.value=a.projectId||"";let x=h.querySelector(".project-text");if(x)if(a.projectId){let P=N.find(I=>I.id===a.projectId);if(P){let I=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Ie(P.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;x.innerHTML=I+q(P.name)}else x.textContent=d("tasks.project.selectPlaceholder")}else x.textContent=d("tasks.project.selectPlaceholder");to(a.projectId||"")}let k=n.querySelector('#task-form input[name="title"]');k&&(k.value=a.title||"");let v=n.querySelector("#task-description-editor");v&&(v.innerHTML=a.description||"");let L=n.querySelector("#task-description-hidden");L&&(L.value=a.description||"");let S=n.querySelector("#hidden-priority");S&&(S.value=a.priority||"medium");let j=n.querySelector("#priority-current");if(j){let x=a.priority||"medium";j.innerHTML=`<span class="priority-dot ${x}"></span> ${ot(x)} <span class="dropdown-arrow">\u25BC</span>`,qn(x)}let w=n.querySelector("#hidden-status");w&&(w.value=a.status||"todo");let D=n.querySelector("#status-current");if(D){let x=D.querySelector(".status-badge");x&&(x.className="status-badge "+(a.status||"todo"),x.textContent=We(a.status||"todo")),Wo(a.status||"todo")}let E="";typeof a.startDate=="string"&&(rt(a.startDate)?E=a.startDate:Me(a.startDate)&&(E=Ye(a.startDate)));let T="";typeof a.endDate=="string"&&(rt(a.endDate)?T=a.endDate:Me(a.endDate)&&(T=Ye(a.endDate)));let A=n.querySelector('#task-form input[name="startDate"]'),z=n.querySelector('#task-form input[name="endDate"]'),H=A?A.parentElement:null,b=z?z.parentElement:null,B=H&&H.classList.contains("date-input-wrapper")?H.querySelector("input.date-display"):null,_=b&&b.classList.contains("date-input-wrapper")?b.querySelector("input.date-display"):null,G=B&&B._flatpickr,Y=_&&_._flatpickr;G&&Y?(B&&B._flatpickr&&(A.value=E||"",E?B._flatpickr.setDate(new Date(E),!1):B._flatpickr.clear()),_&&_._flatpickr&&(z.value=T||"",T?_._flatpickr.setDate(new Date(T),!1):_._flatpickr.clear())):n.querySelectorAll('input[name="startDate"], input[name="endDate"]').forEach(P=>{P._flatpickrInstance&&(P._flatpickrInstance.destroy(),P._flatpickrInstance=null),P._wrapped=!1;let I=P.closest(".date-input-wrapper");I&&(I.parentNode.insertBefore(P,I),I.remove()),P.type="date",P.style.display=""});let K=n.querySelector("#task-form");if(K&&(K.dataset.editingTaskId=String(e)),Vt(a.attachments||[]),Ea(a.tags||[]),window.innerWidth<=768&&e){let x=Array.isArray(a.tags)&&a.tags.length>0,P=typeof a.startDate=="string"&&a.startDate.trim()!=="",I=typeof a.endDate=="string"&&a.endDate.trim()!=="",$=Array.isArray(a.attachments)&&a.attachments.some(ue=>ue.type==="link"||ue.url&&ue.type!=="file"),U=!!a.startDateWasEverSet||P,J=!!a.endDateWasEverSet||I;n.dataset.initialStartDate=U?"true":"false",n.dataset.initialEndDate=J?"true":"false";let X=n.querySelector("#tag-input"),Q=X?X.closest(".form-group"):null,V=n.querySelectorAll('input[name="startDate"]'),ae=null;for(let ue of V){let be=ue.closest(".form-group");if(be&&be.classList.contains("mobile-details-field")){ae=be;break}}let R=n.querySelectorAll('input[name="endDate"]'),ne=null;for(let ue of R){let be=ue.closest(".form-group");if(be&&be.classList.contains("mobile-details-field")){ne=be;break}}let me=n.querySelector("#attachments-links-list"),ce=me?me.closest(".form-group"):null;Q&&(x?(Q.classList.remove("mobile-details-field"),Q.classList.add("mobile-general-field")):(Q.classList.remove("mobile-general-field"),Q.classList.add("mobile-details-field"))),ae&&(U?(ae.classList.remove("mobile-details-field"),ae.classList.add("mobile-general-field")):(ae.classList.remove("mobile-general-field"),ae.classList.add("mobile-details-field"))),ne&&(J?(ne.classList.remove("mobile-details-field"),ne.classList.add("mobile-general-field")):(ne.classList.remove("mobile-general-field"),ne.classList.add("mobile-details-field"))),ce&&($?(ce.classList.remove("mobile-details-field"),ce.classList.add("mobile-general-field")):(ce.classList.remove("mobile-general-field"),ce.classList.add("mobile-details-field")));let je=x&&$;console.log("\u{1F50D} Details Tab Logic:",{hasTags:x,hasStartDate:P,hasEndDate:I,hasLinks:$,allDetailsFilled:je,tags:a.tags,startDate:a.startDate,endDate:a.endDate,attachments:a.attachments}),s&&(je?(console.log("\u2705 Hiding Details tab - all fields filled"),s.classList.add("hide-details-tab")):(console.log("\u{1F441}\uFE0F Showing Details tab - some fields empty"),s.classList.remove("hide-details-tab")))}n.classList.add("active"),$d(),setTimeout(()=>{if((!G||!Y)&&(A&&(A.value=E||""),z&&(z.value=T||""),Dt()),A){let x=A.parentElement;if(x&&x.classList.contains("date-input-wrapper")){let P=x.querySelector("input.date-display");P&&(A.value=E||"",P._flatpickr&&(E?P._flatpickr.setDate(new Date(E),!1):P._flatpickr.clear()))}}if(z){let x=z.parentElement;if(x&&x.classList.contains("date-input-wrapper")){let P=x.querySelector("input.date-display");P&&(z.value=T||"",P._flatpickr&&(T?P._flatpickr.setDate(new Date(T),!1):P._flatpickr.clear()))}}},0),setTimeout(()=>{n.querySelectorAll('input[name="startDate"], input[name="endDate"]').forEach(P=>{P.removeEventListener("change",wa),P.addEventListener("change",wa)})},50),setTimeout(()=>{let x=n.querySelector(".modal-body");x&&(x.scrollTop=0)},0)}function Cd(){let e=document.getElementById("task-form").dataset.editingTaskId;if(!e||!C.find(o=>o.id===parseInt(e)))return;document.getElementById("confirm-modal").classList.add("active");let a=document.getElementById("confirm-input");a.value="",a.focus();let n=function(o){let s=o.target.selectionStart,r=o.target.selectionEnd;o.target.value=o.target.value.toLowerCase(),o.target.setSelectionRange(s,r)};a.addEventListener("input",n),document.addEventListener("keydown",function(o){let s=document.getElementById("confirm-modal");!s||!s.classList.contains("active")||(o.key==="Escape"?(o.preventDefault(),ps()):o.key==="Enter"&&(o.preventDefault(),Wi()))})}async function Ld(){let t=document.getElementById("task-form")?.dataset.editingTaskId;if(!t)return;let a=Ys(parseInt(t,10),C,at);if(!a.task)return;C=a.tasks,at=a.taskCounter;let n=a.task;n&&n.projectId&&(Zt(n.projectId),Xt(n.projectId,"added",n),nt().catch(()=>{}));let o=document.getElementById("options-menu");o&&(o.style.display="none"),Ge("task-modal"),Xa(),Ta(),oa(),document.getElementById("project-details").classList.contains("active")&&n.projectId?Be(n.projectId):Ut(),document.getElementById("calendar-view")&&re(),Ae(),_e().catch(i=>{console.error("Failed to save duplicated task:",i),W(d("error.saveTaskFailed"))})}function ps(){document.getElementById("confirm-modal").classList.remove("active"),document.getElementById("confirm-error").classList.remove("show")}function Pd(){let e=document.getElementById("status-info-modal");e&&e.classList.add("active")}async function Wi(){let e=document.getElementById("confirm-input"),t=document.getElementById("confirm-error");if(e.value==="delete"){let n=document.getElementById("task-form").dataset.editingTaskId,o=Gs(parseInt(n,10),C);if(!o.task)return;window.historyService&&window.historyService.recordTaskDeleted(o.task);let s=o.task&&o.projectId&&document.getElementById("project-details").classList.contains("active"),r=o.projectId;C=o.tasks,r&&(Zt(r),Xt(r,"removed",o.task),nt().catch(()=>{})),ps(),Ge("task-modal"),Xa(),Ta(),oa(),s&&r?Be(r):Ut(),document.getElementById("calendar-view")&&re(),Ae(),_e().catch(c=>{console.error("Failed to save task deletion:",c),W(d("error.saveChangesFailed"))})}else t.classList.add("show"),e.focus()}function Ad(){let e=[],t=null,a=null,n=!0,o=null,s=null,r=80,i=20;function c(g){let h=g;for(;h&&h!==document.body;){let v=getComputedStyle(h).overflowY;if((v==="auto"||v==="scroll"||v==="overlay")&&h.scrollHeight>h.clientHeight)return h;h=h.parentElement}return window}function l(g,h){p(),s=setInterval(()=>{try{h===window?window.scrollBy({top:g==="down"?i:-i,left:0}):h.scrollTop+=g==="down"?i:-i}catch{}},50)}function p(){s&&(clearInterval(s),s=null)}document.querySelectorAll(".task-card").forEach(g=>{g.addEventListener("dragstart",h=>{let k=parseInt(g.dataset.taskId),v=C.find(S=>S.id===k);t=v?v.status:null,te.selectedCards.has(k)?e=Array.from(te.selectedCards):e=[k],n=e.length===1,g.classList.add("dragging"),g.style.opacity="0.5",o=document.createElement("div"),o.className="drag-placeholder active",o.setAttribute("aria-hidden","true");let L=g.offsetHeight;o.style.height=L+"px",o.style.margin="8px 0",o.style.opacity="1",document.querySelectorAll(".kanban-column").forEach(S=>{S.style.backgroundColor="var(--bg-tertiary)",S.style.border="2px dashed var(--accent-blue)"}),h.dataTransfer.effectAllowed="move";try{h.dataTransfer.setData("text/plain",String(k))}catch{}}),g.addEventListener("dragend",h=>{g.classList.remove("dragging"),g.style.opacity="1",e=[],t=null,a=null,n=!0;try{o&&o.parentNode&&o.parentNode.removeChild(o)}catch{}o=null,document.querySelectorAll(".kanban-column").forEach(k=>{k.style.backgroundColor="",k.style.border="",k.classList.remove("drag-over")}),document.querySelectorAll(".task-card").forEach(k=>{k.classList.remove("drag-over-top","drag-over-bottom")}),p()}),g.addEventListener("dragover",h=>{if(e.length===0)return;h.preventDefault();let k=parseInt(g.dataset.taskId,10);if(e.includes(k))return;let v=g.getBoundingClientRect(),L=h.clientY,S=v.top+v.height/2,j=L<S;a={card:g,isTop:j}}),g.addEventListener("dragleave",h=>{a&&a.card===g&&(a=null)}),g.addEventListener("click",h=>{let k=parseInt(g.dataset.taskId,10);if(isNaN(k))return;let v=h.ctrlKey||h.metaKey;if(h.shiftKey){h.preventDefault(),h.stopPropagation();let j=g.closest(".kanban-column")||document,w=Array.from(j.querySelectorAll(".task-card")),D=null;Number.isInteger(te.lastSelectedCardId)&&(D=w.find(H=>parseInt(H.dataset.taskId,10)===te.lastSelectedCardId)),D||(D=w.find(H=>te.selectedCards.has(parseInt(H.dataset.taskId,10)))||g);let E=w.indexOf(D),T=w.indexOf(g);if(v||xo(),E===-1||T===-1){g.classList.add("selected"),te.selectedCards.add(k),te.lastSelectedCardId=k;return}let A=Math.min(E,T),z=Math.max(E,T);for(let H=A;H<=z;H++){let b=w[H],B=parseInt(b.dataset.taskId,10);isNaN(B)||(b.classList.add("selected"),te.selectedCards.add(B))}te.lastSelectedCardId=k;return}if(v){h.preventDefault(),h.stopPropagation(),g.classList.toggle("selected"),g.classList.contains("selected")?te.selectedCards.add(k):te.selectedCards.delete(k),te.lastSelectedCardId=k;return}xa(k)})});let f=document.querySelectorAll(".kanban-column"),m=["backlog","todo","progress","review","done"];f.forEach((g,h)=>{g.addEventListener("dragover",k=>{if(k.preventDefault(),g.classList.add("drag-over"),g.style.backgroundColor="var(--hover-bg)",!o)return;let v=g.querySelector('[id$="-tasks"]');if(!v)return;let L=m[h],S=Array.from(v.querySelectorAll(".task-card:not(.dragging)")),j=k.clientY;if(o.parentNode&&o.remove(),S.length===0)v.appendChild(o);else{let w=null;for(let D of S){let E=D.getBoundingClientRect(),T=E.top+E.height/2;if(j<T){w=D;break}}w?v.insertBefore(o,w):v.appendChild(o)}try{let w=c(g),D=k.clientY,E=D,T=window.innerHeight-D;E<r?l("up",w):T<r?l("down",w):p()}catch{p()}}),g.addEventListener("dragleave",k=>{g.contains(k.relatedTarget)||(g.classList.remove("drag-over"),g.style.backgroundColor="var(--bg-tertiary)")}),g.addEventListener("drop",async k=>{if(k.preventDefault(),g.classList.remove("drag-over"),g.style.backgroundColor="var(--bg-tertiary)",e.length===0)return;let v=m[h],L=g.querySelector('[id$="-tasks"]');if(L)if(n){De!=="manual"&&(De="manual",["backlog","todo","progress","review","done"].forEach(E=>{de[E]=C.filter(T=>T.status===E).slice().sort((T,A)=>(se[A.priority]||0)-(se[T.priority]||0)).map(T=>T.id)}),yt(),Na()),Object.keys(de).forEach(E=>{Array.isArray(de[E])&&(de[E]=de[E].filter(T=>!e.includes(T)))});let S=C.filter(E=>E.status===v&&!e.includes(E.id)),j;if(Array.isArray(de[v])&&de[v].length){let E=new Set(S.map(A=>A.id));j=de[v].filter(A=>E.has(A));let T=S.filter(A=>!j.includes(A.id)).slice().sort((A,z)=>(se[z.priority]||0)-(se[A.priority]||0)).map(A=>A.id);j=j.concat(T)}else j=S.slice().sort((E,T)=>(se[T.priority]||0)-(se[E.priority]||0)).map(E=>E.id);let w=j.length;if(o&&o.parentNode===L){let E=Array.from(L.querySelectorAll(".task-card:not(.dragging)")),T=-1,A=Array.from(L.children);for(let z=0;z<A.length;z++)if(A[z]===o){T=z;break}if(T!==-1){let z=0;for(let H=0;H<T;H++)A[H].classList&&A[H].classList.contains("task-card")&&z++;w=z}}j.splice(w,0,...e),de[v]=j,e.forEach(E=>{let T=C.find(A=>A.id===E);if(T&&T.status!==v){let z=JSON.parse(JSON.stringify(T));if(T.status=v,T.updatedAt=new Date().toISOString(),F.autoSetStartDateOnStatusChange||F.autoSetEndDateOnStatusChange){let H=new Date().toISOString().split("T")[0];F.autoSetStartDateOnStatusChange&&v==="progress"&&!T.startDate&&(T.startDate=H),F.autoSetEndDateOnStatusChange&&v==="done"&&!T.endDate&&(T.endDate=H)}v==="done"&&!T.completedDate&&(T.completedDate=new Date().toISOString()),window.historyService&&window.historyService.recordTaskUpdated(z,T)}}),Na(),xo(),Ut(),document.getElementById("calendar-view")&&re();try{o&&o.parentNode&&o.parentNode.removeChild(o)}catch{}o=null,p(),_e().catch(E=>{console.error("Failed to save drag-and-drop changes:",E),W(d("error.saveTaskPositionFailed"))})}else{De!=="manual"&&(De="manual",["backlog","todo","progress","review","done"].forEach(E=>{de[E]=C.filter(T=>T.status===E).slice().sort((T,A)=>(se[A.priority]||0)-(se[T.priority]||0)).map(T=>T.id)}),yt(),Na()),Object.keys(de).forEach(E=>{Array.isArray(de[E])&&(de[E]=de[E].filter(T=>!e.includes(T)))});let S=C.filter(E=>E.status===v&&!e.includes(E.id)),j;if(Array.isArray(de[v])&&de[v].length){let E=new Set(S.map(A=>A.id));j=de[v].filter(A=>E.has(A));let T=S.filter(A=>!j.includes(A.id)).slice().sort((A,z)=>(se[z.priority]||0)-(se[A.priority]||0)).map(A=>A.id);j=j.concat(T)}else j=S.slice().sort((E,T)=>(se[T.priority]||0)-(se[E.priority]||0)).map(E=>E.id);let w=j.length;if(o&&o.parentNode===L){let E=Array.from(L.children),T=E.indexOf(o);if(T!==-1){let A=0;for(let z=0;z<T;z++)E[z].classList&&E[z].classList.contains("task-card")&&A++;w=A}}j.splice(w,0,...e),de[v]=j,e.forEach(E=>{let T=C.find(A=>A.id===E);if(T&&T.status!==v){let z=JSON.parse(JSON.stringify(T));if(T.status=v,T.updatedAt=new Date().toISOString(),F.autoSetStartDateOnStatusChange||F.autoSetEndDateOnStatusChange){let H=new Date().toISOString().split("T")[0];F.autoSetStartDateOnStatusChange&&v==="progress"&&!T.startDate&&(T.startDate=H),F.autoSetEndDateOnStatusChange&&v==="done"&&!T.endDate&&(T.endDate=H)}v==="done"&&!T.completedDate&&(T.completedDate=new Date().toISOString()),window.historyService&&window.historyService.recordTaskUpdated(z,T)}}),Na(),xo(),Ut(),document.getElementById("calendar-view")&&re();try{o&&o.parentNode&&o.parentNode.removeChild(o)}catch{}o=null,p(),_e().catch(E=>{console.error("Failed to save drag-and-drop changes:",E),W(d("error.saveTaskPositionFailed"))})}})}),document.addEventListener("dragend",()=>p())}function Bd(){let e=document.getElementById("project-modal");window.tempProjectTags=[],Ka([]),document.getElementById("project-form").dataset.editingProjectId="",e.classList.add("active"),setTimeout(()=>{document.querySelector('#project-form input[name="startDate"]').value="",document.querySelectorAll('#project-modal input[type="date"]').forEach(a=>{a._flatpickrInstance&&(a._flatpickrInstance.destroy(),a._flatpickrInstance=null,a._wrapped=!1)}),Dt()},150),setTimeout(()=>{let t=e.querySelector(".modal-body");t&&(t.scrollTop=0)},0)}function $d(){let e=document.getElementById("task-nav-prev"),t=document.getElementById("task-nav-next");if(!e||!t)return;if(!_t){e.style.display="none",t.style.display="none";return}let{taskIds:a,currentIndex:n}=_t;e.style.display="flex",t.style.display="flex",e.disabled=n<=0,t.disabled=n>=a.length-1}function Gi(e){if(!_t)return;let{taskIds:t,currentIndex:a,projectId:n}=_t,o=e==="next"?a+1:a-1;if(o<0||o>=t.length)return;let s=t[o];xa(s,{projectId:n,taskIds:t,currentIndex:o})}function si(){Gi("prev")}function ri(){Gi("next")}window.taskNavigationInitialized||(window.taskNavigationInitialized=!0,document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("task-nav-prev"),t=document.getElementById("task-nav-next");e&&e.addEventListener("click",a=>{a.stopPropagation(),si()}),t&&t.addEventListener("click",a=>{a.stopPropagation(),ri()}),document.addEventListener("keydown",a=>{let n=document.getElementById("task-modal");if(!n||!n.classList.contains("active")||!_t)return;let o=a.target;o.tagName==="INPUT"||o.tagName==="TEXTAREA"||o.isContentEditable||(a.key==="ArrowLeft"&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&!a.altKey&&(a.preventDefault(),si()),a.key==="ArrowRight"&&!a.ctrlKey&&!a.metaKey&&!a.shiftKey&&!a.altKey&&(a.preventDefault(),ri()))})}));function eo(){let e=document.getElementById("task-modal");if(!e)return;_t=null;let t=e.querySelector('.modal-tab[data-tab="general"]'),a=e.querySelector('.modal-tab[data-tab="details"]'),n=e.querySelector('.modal-tab[data-tab="history"]'),o=e.querySelector("#task-details-tab"),s=e.querySelector("#task-history-tab");t&&t.classList.add("active"),a&&a.classList.remove("active"),n&&n.classList.remove("active"),o&&o.classList.add("active"),s&&s.classList.remove("active"),document.body.classList.remove("mobile-tab-details-active"),n&&(n.style.display="none");let r=e.querySelector(".modal-content");r&&(r.style.minHeight="",r.style.maxHeight=""),setTimeout(()=>{e.querySelectorAll('input[name="startDate"], input[name="endDate"]').forEach(E=>{E._flatpickrInstance&&(E._flatpickrInstance.destroy(),E._flatpickrInstance=null),E._wrapped=!1;let T=E.closest(".date-input-wrapper");T&&(T.parentNode.insertBefore(E,T),T.remove()),E.type="date",E.style.display=""}),Dt()},150);let i=e.querySelector("h2");i&&(i.textContent="Create New Task");let c=e.querySelector(".modal-close");c&&(c.style.display="none");let l=e.querySelector("#task-options-btn");l&&(l.style.display="none");let p=e.querySelector("#task-footer");p&&(p.style.display="flex"),setTimeout(()=>{let D=e.querySelector(".modal-content"),E=e.querySelector(".modal-body"),T=e.querySelector(".modal-footer");if(D&&T){let A=D.getBoundingClientRect(),z=T.getBoundingClientRect(),H=window.getComputedStyle(D),b=window.getComputedStyle(T);console.log("=== MODAL DEBUG ==="),console.log("Viewport:",window.innerWidth,"x",window.innerHeight),console.log("Zoom:",window.devicePixelRatio*100+"%"),console.log(""),console.log("MODAL-CONTENT:"),console.log("  Position:",A.top.toFixed(1),"to",A.bottom.toFixed(1)),console.log("  Height:",A.height.toFixed(1),"/",H.height,"/",H.maxHeight),console.log("  Padding:",H.padding),console.log("  Display:",H.display),console.log("  Overflow:",H.overflow),console.log(""),console.log("MODAL-FOOTER:"),console.log("  Position:",z.top.toFixed(1),"to",z.bottom.toFixed(1)),console.log("  Height:",z.height.toFixed(1)),console.log("  Flex-shrink:",b.flexShrink),console.log("  Padding:",b.padding),console.log("");let B=z.bottom-A.bottom;B>1?console.error("\u274C FOOTER OVERFLOW:",B.toFixed(1)+"px OUTSIDE modal-content"):console.log("\u2705 Footer is inside modal-content"),console.log("==================")}},100);let u=e.querySelector("#task-form");u&&(delete u.dataset.editingTaskId,u.reset());let f=e.querySelector("#task-description-editor");f&&(f.innerHTML="");let m=e.querySelector("#task-description-hidden");m&&(m.value="");let g=e.querySelector("#hidden-project");g&&(g.value="");let h=e.querySelector("#project-current .project-text");h&&(h.textContent=d("tasks.project.selectPlaceholder")),to(""),typeof xt=="function"&&xt();let k=e.querySelector("#hidden-priority");k&&(k.value="medium");let v=e.querySelector("#priority-current");v&&(v.innerHTML=`<span class="priority-dot medium"></span> ${ot("medium")} <span class="dropdown-arrow">\u25BC</span>`,qn("medium"));let L=e.querySelector("#hidden-status");L&&(L.value="backlog");let S=e.querySelector("#status-current");if(S){let D=S.querySelector(".status-badge");D&&(D.className="status-badge backlog",D.textContent=We("backlog"))}if($e=[],window.tempTags=[],y.tags.clear(),Vt([]),Ea([]),window.innerWidth<=768){e.dataset.initialStartDate="false",e.dataset.initialEndDate="false";let D=e.querySelector(".form-group:has(#tag-input)"),E=e.querySelector('.form-group:has([name="startDate"])'),T=e.querySelector('.form-group:has([name="endDate"])'),A=e.querySelector(".form-group:has(#attachments-links-list)");D&&(D.classList.remove("mobile-general-field"),D.classList.add("mobile-details-field")),E&&(E.classList.remove("mobile-general-field"),E.classList.add("mobile-details-field")),T&&(T.classList.remove("mobile-general-field"),T.classList.add("mobile-details-field")),A&&(A.classList.remove("mobile-general-field"),A.classList.add("mobile-details-field")),a&&a.classList.remove("hide-details-tab")}let j=e.querySelector('#task-form input[name="startDate"]');if(j){let D=j._flatpickrInstance;D&&(D.clear(),D.jumpToDate(new Date)),j.value="";let E=j.parentElement?j.parentElement.querySelector("input.date-display"):null;E&&(E.value="")}let w=e.querySelector('#task-form input[name="endDate"]');if(w){let D=w._flatpickrInstance;D&&(D.clear(),D.jumpToDate(new Date)),w.value="";let E=w.parentElement?w.parentElement.querySelector("input.date-display"):null;E&&(E.value="")}e.classList.add("active"),setTimeout(()=>{let D=e.querySelector(".modal-body");D&&(D.scrollTop=0)},0),setTimeout(()=>{Dt(),vc()},100)}function Ge(e){let t=document.getElementById(e);if(t){if(e==="settings-modal"&&window.settingsFormIsDirty){_a(e);return}if(t.classList.remove("active"),e==="settings-modal"&&(typeof ka=="function"&&ka(),typeof ba=="function"&&ba()),e==="task-modal")try{let a=t.querySelector(".modal-content");a&&(a.style.minHeight="")}catch{}e==="project-modal"&&document.getElementById("project-form").reset()}}function Nd(){if(_n&&_n()){_a("task-modal");return}let e=document.getElementById("task-form");if(e&&e.dataset.editingTaskId){let t=e.querySelector("#task-description-editor");t&&ft("description",t.innerHTML)}if(e){e.reset(),delete e.dataset.editingTaskId;let t=document.querySelector("#status-current .status-badge");t&&(t.className="status-badge backlog",t.textContent=We("backlog"));let a=document.getElementById("hidden-status");a&&(a.value="backlog");let n=document.querySelector("#priority-current");n&&(n.innerHTML=`<span class="priority-dot medium"></span> ${ot("medium")} <span class="dropdown-arrow">\u25BC</span>`);let o=document.getElementById("hidden-priority");o&&(o.value="medium")}Qe=null,_t=null,Ge("task-modal")}document.getElementById("project-form").addEventListener("submit",function(e){e.preventDefault();let t=ke("projects","submit",{projectCount:N.length,tagCount:(window.tempProjectTags||[]).length}),a=new FormData(e.target),n=window.tempProjectTags||[],o=Ks({name:a.get("name"),description:a.get("description"),startDate:a.get("startDate"),endDate:a.get("endDate"),tags:n},N,pt);N=o.projects,pt=o.projectCounter;let s=o.project;window.historyService&&window.historyService.recordProjectCreated(s),Ge("project-modal"),e.target.reset(),window.tempProjectTags=[],te.projectsSortedView=null,window.location.hash="projects",ze("projects"),Ut(),nt().catch(r=>{console.error("Failed to save project:",r),W(d("error.saveProjectFailed"))}),ye("projects",t,{projectCount:N.length})});function Fd(){let e=document.createElement("div");e.className="modal active",e.id="reset-pin-modal-temp",e.innerHTML=`
        <div class="modal-content reset-pin-modal-content">
            <div class="reset-pin-modal-inner">
                <div class="reset-pin-header">
                    <div>
                        <h2 class="reset-pin-title">Reset PIN</h2>
                        <p class="reset-pin-description">Verify your current PIN to set a new one</p>
                    </div>
                </div>
                
                <form id="reset-pin-form" class="reset-pin-form">
                    <div class="reset-pin-field">
                        <label class="reset-pin-label">Current PIN</label>
                        <input
                            type="password"
                            id="current-pin-input"
                            maxlength="4"
                            placeholder="\u2022\u2022\u2022\u2022"
                            class="reset-pin-input"
                            inputmode="numeric"
                            autocomplete="off"
                            required
                        />
                        <div id="current-pin-error" class="reset-pin-error" style="display: none;"></div>
                    </div>

                    <div class="reset-pin-actions">
                        <button type="button" class="reset-pin-btn reset-pin-btn-cancel" onclick="document.getElementById('reset-pin-modal-temp').remove()">
                            Cancel
                        </button>
                        <button type="submit" class="reset-pin-btn reset-pin-btn-primary">
                            Continue
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `,document.body.appendChild(e),document.getElementById("reset-pin-form").addEventListener("submit",function(t){t.preventDefault();let a=document.getElementById("current-pin-input").value.trim(),n=document.getElementById("current-pin-error");if(n.style.display="none",n.textContent="",!a||a.length!==4){n.textContent="PIN must be 4 digits",n.style.display="block";return}if(!/^\d{4}$/.test(a)){n.textContent="PIN must contain only digits",n.style.display="block";return}document.getElementById("reset-pin-modal-temp").remove(),Md(a)}),document.getElementById("current-pin-input").focus()}function Md(e){let t=document.createElement("div");t.className="modal active",t.id="new-pin-modal-temp",t.innerHTML=`
        <div class="modal-content reset-pin-modal-content">
            <div class="reset-pin-modal-inner">
                <div class="reset-pin-header">
                    <div>
                        <h2 class="reset-pin-title">Set New PIN</h2>
                        <p class="reset-pin-description">Create your new 4-digit PIN</p>
                    </div>
                </div>
                
                <form id="new-pin-form" class="reset-pin-form">
                    <div class="reset-pin-field">
                        <label class="reset-pin-label">New PIN</label>
                        <input 
                            type="password" 
                            id="new-pin-input" 
                            maxlength="4" 
                            placeholder="\u2022\u2022\u2022\u2022"
                            class="reset-pin-input"
                            inputmode="numeric"
                            autocomplete="off"
                            required
                        />
                    </div>
                    
                    <div class="reset-pin-field">
                        <label class="reset-pin-label">Confirm PIN</label>
                        <input
                            type="password"
                            id="confirm-pin-input"
                            maxlength="4"
                            placeholder="\u2022\u2022\u2022\u2022"
                            class="reset-pin-input"
                            inputmode="numeric"
                            autocomplete="off"
                            required
                        />
                        <div id="new-pin-error" class="reset-pin-error" style="display: none;"></div>
                    </div>

                    <div class="reset-pin-actions">
                        <button type="button" class="reset-pin-btn reset-pin-btn-cancel" onclick="document.getElementById('new-pin-modal-temp').remove()">
                            Cancel
                        </button>
                        <button type="submit" class="reset-pin-btn reset-pin-btn-primary">
                            Reset PIN
                        </button>
                    </div>
                </form>
            </div>
        </div>
    `,document.body.appendChild(t),document.getElementById("new-pin-form").addEventListener("submit",function(a){a.preventDefault();let n=document.getElementById("new-pin-input").value.trim(),o=document.getElementById("confirm-pin-input").value.trim(),s=document.getElementById("new-pin-error");if(s.style.display="none",s.textContent="",!n||n.length!==4){s.textContent="New PIN must be 4 digits",s.style.display="block";return}if(!/^\d{4}$/.test(n)){s.textContent="PIN must contain only digits",s.style.display="block";return}if(n!==o){s.textContent="PINs do not match",s.style.display="block";return}Rd(e,n)}),document.getElementById("new-pin-input").focus()}async function Rd(e,t){try{let a=localStorage.getItem("authToken");if(!a){W(d("error.notLoggedInResetPin"));return}let n=await fetch("/api/auth/change-pin",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify({currentPin:e,newPin:t})}),o=await n.json();if(!n.ok){W(o.error||d("error.resetPinFailed"));return}let s=document.getElementById("new-pin-modal-temp");s&&s.remove(),Xe(d("success.resetPin")),setTimeout(()=>{window.location.hash="",location.reload()},2e3)}catch(a){console.error("PIN reset error:",a),W(d("error.resetPinError"))}}document.getElementById("settings-form").addEventListener("submit",async function(e){e.preventDefault();let t=this.querySelector(".settings-btn-save");if(t&&t.disabled&&!window.settingsFormIsDirty)return;let a=document.getElementById("user-name").value.trim();if(!a){W(d("error.userNameEmpty"));return}try{let E=window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken");if(!E)throw new Error("Missing auth token");let T=await fetch("/api/auth/change-name",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify({newName:a})}),A=await T.json().catch(()=>({}));if(!T.ok)throw new Error(A.error||"Failed to update display name");let z=window.authSystem?.getCurrentUser?.();z&&(z.name=A.name||a),ys(A.name||a,window.authSystem?.getCurrentUser?.()?.avatarDataUrl)}catch(E){console.error("Failed to save display name:",E),W(d("error.saveDisplayNameFailed"));return}let n=document.getElementById("user-email"),o=String(n?.value||"").trim().toLowerCase();if(!o||!nr(o)){W(d("error.invalidEmail"));return}try{let E=window.authSystem?.getCurrentUser?.(),T=String(E?.email||"").trim().toLowerCase();if(o&&o!==T){let A=window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken");if(!A)throw new Error("Missing auth token");let z=await fetch("/api/auth/change-email",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${A}`},body:JSON.stringify({newEmail:o})}),H=await z.json().catch(()=>({}));if(!z.ok)throw new Error(H.error||"Failed to update email");E&&(E.email=H.email||o),document.querySelectorAll(".user-email").forEach(b=>{b&&(b.textContent=H.email||o)})}}catch(E){console.error("Failed to save email:",E),W(d("error.saveEmailFailed"));return}try{if(tt.hasPendingChange){let E=window.authSystem?.getAuthToken?.()||localStorage.getItem("authToken");if(!E)throw new Error("Missing auth token");let T=await fetch("/api/auth/change-avatar",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${E}`},body:JSON.stringify({avatarDataUrl:tt.dataUrl||null})}),A=await T.json().catch(()=>({}));if(!T.ok)throw new Error(A.error||"Failed to update avatar");let z=window.authSystem?.getCurrentUser?.();z&&(z.avatarDataUrl=A.avatarDataUrl||null),Od(),ha(),tt.hasPendingChange=!1,tt.dataUrl=null}}catch(E){console.error("Failed to save avatar:",E),W(d("error.saveAvatarFailed"));return}let s=document.getElementById("auto-start-date-toggle"),r=document.getElementById("auto-end-date-toggle"),i=document.getElementById("enable-review-status-toggle"),c=document.getElementById("calendar-include-backlog-toggle"),l=document.getElementById("debug-logs-toggle"),p=document.getElementById("history-sort-order"),u=document.getElementById("language-select");F.autoSetStartDateOnStatusChange=!!s?.checked,F.autoSetEndDateOnStatusChange=!!r?.checked,F.debugLogsEnabled=!!l?.checked,yn(F.debugLogsEnabled);let f=window.enableReviewStatus,m=!!i?.checked;if(f&&!m){let E=C.filter(T=>T.status==="review");if(E.length>0){let T=document.getElementById("review-status-task-list"),A=E.slice(0,5),z=E.length>5,H=`
                    <div style="
                        color: var(--text-primary);
                        font-size: 14px;
                        line-height: 1.6;
                        margin-bottom: 16px;
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        flex-wrap: wrap;
                    ">
                        <span style="color: var(--text-secondary);">You have</span>
                        <span style="
                            color: var(--text-primary);
                            font-weight: 600;
                            font-size: 16px;
                        ">${E.length}</span>
                        <span style="color: var(--text-secondary);">${E.length===1?"task":"tasks"} with</span>
                        <span class="status-badge review" style="
                            display: inline-flex;
                            align-items: center;
                            padding: 4px 10px;
                            border-radius: 6px;
                            font-size: 11px;
                            font-weight: 600;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        ">IN REVIEW</span>
                        <span style="color: var(--text-secondary);">status</span>
                    </div>
                    <div style="margin: 20px 0;">
                        ${A.map(b=>`
                            <div style="
                                display: flex;
                                align-items: center;
                                gap: 10px;
                                padding: 8px 0;
                                color: var(--text-primary);
                                font-size: 14px;
                            ">
                                <svg width="18" height="18" viewBox="0 0 16 16" fill="none" style="flex-shrink: 0; color: var(--accent-green);">
                                    <rect x="2" y="2" width="12" height="12" rx="2" stroke="currentColor" stroke-width="1.5" fill="none"/>
                                    <path d="M5 8L7 10L11 6" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                                <span style="flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                    ${q(b.title)}
                                </span>
                            </div>
                        `).join("")}
                        ${z?`
                            <div style="
                                margin-top: 12px;
                                padding-top: 12px;
                                border-top: 1px solid var(--border-color);
                            ">
                                <button type="button" style="
                                    background: none;
                                    border: none;
                                    color: var(--accent-blue);
                                    text-decoration: none;
                                    font-size: 13px;
                                    display: inline-flex;
                                    align-items: center;
                                    gap: 6px;
                                    cursor: pointer;
                                    padding: 0;
                                    font-family: inherit;
                                " onclick="
                                    const baseUrl = window.location.href.split('#')[0];
                                    const url = baseUrl + '#tasks?status=review&view=list';
                                    window.open(url, '_blank');
                                ">
                                    <span>View all ${E.length} tasks in List view</span>
                                    <svg width="14" height="14" viewBox="0 0 16 16" fill="none" style="flex-shrink: 0;">
                                        <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    </svg>
                                </button>
                            </div>
                        `:""}
                    </div>
                    <div style="
                        color: var(--text-primary);
                        font-size: 14px;
                        line-height: 1.6;
                        margin-top: 20px;
                        padding: 16px;
                        background: var(--bg-tertiary);
                        border-radius: 8px;
                        border-left: 3px solid var(--accent-blue);
                        display: flex;
                        align-items: center;
                        gap: 8px;
                        flex-wrap: wrap;
                    ">
                        <svg width="18" height="18" viewBox="0 0 16 16" fill="none" style="flex-shrink: 0; color: var(--accent-blue);">
                            <path d="M8 2C4.68629 2 2 4.68629 2 8C2 11.3137 4.68629 14 8 14C11.3137 14 14 11.3137 14 8C14 4.68629 11.3137 2 8 2Z" stroke="currentColor" stroke-width="1.5"/>
                            <path d="M8 5V8L10 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                        </svg>
                        <span style="color: var(--text-secondary);">These tasks will be moved to</span>
                        <span class="status-badge progress" style="
                            display: inline-flex;
                            align-items: center;
                            padding: 4px 10px;
                            border-radius: 6px;
                            font-size: 11px;
                            font-weight: 600;
                            text-transform: uppercase;
                            letter-spacing: 0.5px;
                        ">IN PROGRESS</span>
                    </div>
                `;T.innerHTML=H,window.pendingReviewTaskMigration=E,window.pendingReviewStatusToggle=i,document.getElementById("review-status-confirm-modal").classList.add("active");return}}F.enableReviewStatus=m,F.calendarIncludeBacklog=!!c?.checked,F.historySortOrder=p.value,F.language=Wn(u?.value||"en"),window.enableReviewStatus=F.enableReviewStatus,localStorage.setItem("enableReviewStatus",String(F.enableReviewStatus)),ws(),gi(),F.notificationEmail=o;let g=document.getElementById("email-notifications-enabled"),h=document.getElementById("email-notifications-weekdays-only"),k=document.getElementById("email-notifications-include-start-dates"),v=document.getElementById("email-notifications-include-backlog"),L=document.getElementById("email-notification-time"),S=document.getElementById("email-notification-timezone");F.emailNotificationsEnabled=!!g?.checked,F.emailNotificationsWeekdaysOnly=!!h?.checked,F.emailNotificationsIncludeStartDates=!!k?.checked,F.emailNotificationsIncludeBacklog=!!v?.checked;let j=wo(Pa(L?.value)||"09:00",30);F.emailNotificationTime=So(j||"09:00","08:00","18:00")||"09:00",F.emailNotificationTimeZone=String(S?.value||"Atlantic/Canary"),L&&(L.value=F.emailNotificationTime),et.hasPendingChange&&(F.customWorkspaceLogo=et.dataUrl||null),is(),$i(),Rt({force:!0});let w=document.getElementById("calendar-view");w&&w.classList.contains("active")&&re(),et.hasPendingChange=!1,et.dataUrl=null;let D=document.querySelector(".user-email");D&&(D.textContent=o),Xe(d("success.settingsSaved")),window.initialSettingsFormState=null,window.settingsFormIsDirty=!1,t&&(t.classList.remove("dirty"),t.disabled=!0),Ge("settings-modal")});function ha(){let e=document.getElementById("user-avatar-preview"),t=document.getElementById("user-avatar-clear-btn"),a=document.getElementById("user-avatar-dropzone"),n=e?.closest?.(".user-avatar-input-row")||a?.closest?.(".user-avatar-input-row")||null,o=window.authSystem?.getCurrentUser?.(),s=tt.hasPendingChange?tt.dataUrl:o?.avatarDataUrl||null,r=!!s;if(e&&t&&(s?(e.style.display="block",e.style.backgroundImage=`url(${s})`,t.style.display="inline-flex"):(e.style.display="none",e.style.backgroundImage="",t.style.display="none")),a){let i=d("settings.avatarUploadAriaUpload"),c=d("settings.avatarUploadAriaChange");a.setAttribute("aria-label",r?c:i);let l=a.querySelector(".workspace-logo-dropzone-text");if(l){let p=a.dataset.defaultText||d("settings.avatarUploadDefault"),u=a.dataset.changeText||d("settings.avatarUploadChange");l.textContent=r?u:p}a.style.minHeight=r?"40px":"48px",a.style.padding=r?"10px 12px":"12px 16px"}n&&n.classList.toggle("has-avatar",r)}function Od(){let e=window.authSystem?.getCurrentUser?.();e&&ys(e.name,e.avatarDataUrl||null)}function qd(){let e=document.getElementById("workspace-logo-dropzone"),t=document.getElementById("workspace-logo-input"),a=document.getElementById("workspace-logo-clear-btn"),n=document.getElementById("workspace-logo-preview");if(!e||!t)return;let o=d("settings.logoUploadDefault");e.dataset.defaultText=o;function s(b){e.innerHTML="";let B=document.createElement("span");B.className="workspace-logo-dropzone-text",B.textContent=b,e.appendChild(B)}function r(b){b.style.display="flex",b.style.alignItems="center",b.style.justifyContent="center",b.style.gap="10px",b.style.padding="12px 16px",b.style.textAlign="center",b.style.cursor="pointer",b.style.userSelect="none",b.style.minHeight="48px",b.style.border="2px dashed var(--border)",b.style.borderRadius="10px",b.style.background="var(--bg-tertiary)",b.style.boxShadow="none",b.style.color="var(--text-muted)",b.style.fontWeight="500",b.style.transition="border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease"}function i(b,B){B?(b.style.borderColor="var(--accent-blue)",b.style.background="rgba(59, 130, 246, 0.08)",b.style.boxShadow="0 0 0 1px var(--accent-blue)"):(b.style.border="2px dashed var(--border)",b.style.background="var(--bg-tertiary)",b.style.boxShadow="none")}function c(){if(!n||!a)return;let b=n.closest(".workspace-logo-input-row")||e?.closest?.(".workspace-logo-input-row")||null,B=et.hasPendingChange?et.dataUrl:F.customWorkspaceLogo,_=!!B;if(B?(n.style.display="block",n.style.backgroundImage=`url(${B})`,a.style.display="inline-flex"):(n.style.display="none",n.style.backgroundImage="",a.style.display="none"),e){let G=d("settings.logoUploadAriaUpload"),Y=d("settings.logoUploadAriaChange");e.setAttribute("aria-label",_?Y:G);let K=e.dataset.defaultText||d("settings.logoUploadDefault"),x=e.dataset.changeText||d("settings.logoUploadChange");e.getAttribute("aria-busy")!=="true"&&!e.classList.contains("workspace-logo-uploading")&&s(_?x:K),e.style.minHeight=_?"40px":"48px",e.style.padding=_?"10px 12px":"12px 16px"}b&&b.classList.toggle("has-logo",_)}async function l(b,B){if(!b)return;if(B&&(B.preventDefault(),B.stopPropagation()),!b.type.startsWith("image/")){W(d("error.logoSelectFile"));return}let _=2048*1024;if(b.size>_){W(d("error.logoTooLarge"));return}let G=e.dataset.defaultText||d("settings.logoUploadDefault");try{e.innerHTML="";let Y=document.createElement("span");Y.className="workspace-logo-dropzone-text",Y.textContent=`Uploading ${b.name}...`,e.appendChild(Y),e.classList.add("workspace-logo-uploading"),e.setAttribute("aria-busy","true");let K=new FileReader;K.onload=function(x){let P=x.target&&x.target.result;if(!P){W(d("error.imageReadFailed")),s(G),e.classList.remove("workspace-logo-uploading"),e.removeAttribute("aria-busy");return}let I=new Image;I.onload=function(){u(P,I),s(G),e.classList.remove("workspace-logo-uploading"),e.removeAttribute("aria-busy")},I.onerror=function(){W(d("error.imageLoadFailed")),s(G),e.classList.remove("workspace-logo-uploading"),e.removeAttribute("aria-busy")},I.src=P},K.onerror=function(){W(d("error.imageReadFailed")),s(G),e.classList.remove("workspace-logo-uploading"),e.removeAttribute("aria-busy")},K.readAsDataURL(b)}catch(Y){W(d("error.logoUploadFailed",{message:Y.message})),s(G),e.classList.remove("workspace-logo-uploading"),e.removeAttribute("aria-busy")}}r(e),s(o),c();let p=0;e.addEventListener("dragenter",function(b){b.preventDefault(),p+=1,e.classList.add("workspace-logo-dragover"),i(e,!0)}),e.addEventListener("dragover",function(b){b.preventDefault(),e.classList.add("workspace-logo-dragover"),i(e,!0)}),e.addEventListener("dragleave",function(b){b.preventDefault(),p=Math.max(0,p-1),p===0&&(e.classList.remove("workspace-logo-dragover"),i(e,!1))}),e.addEventListener("drop",function(b){p=0,e.classList.remove("workspace-logo-dragover"),i(e,!1);let B=b.dataTransfer&&b.dataTransfer.files;B&&B.length>0&&l(B[0],b)}),e.addEventListener("dragend",function(){p=0,e.classList.remove("workspace-logo-dragover"),i(e,!1)}),e.addEventListener("paste",function(b){if(!b.clipboardData)return;let B=b.clipboardData.files;B&&B.length>0&&l(B[0],b)}),e.addEventListener("click",function(){t.click()}),e.addEventListener("keydown",function(b){(b.key==="Enter"||b.key===" ")&&(b.preventDefault(),t.click())}),t.addEventListener("change",function(b){let B=b.target.files;B&&B.length>0&&l(B[0],b),t.value=""}),a&&a.addEventListener("click",function(b){b.preventDefault(),et.hasPendingChange=!0,et.dataUrl=null,t&&(t.value=""),c(),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded()}),document.addEventListener("refresh-workspace-logo-ui",()=>{c()});function u(b,B,_=null){let G=document.getElementById("workspace-logo-crop-modal"),Y=document.getElementById("crop-canvas"),K=Y.getContext("2d"),x=document.getElementById("crop-modal-title"),P=G?.querySelector(".crop-instructions");M.originalImage=B,M.originalDataUrl=b,M.canvas=Y,M.ctx=K,M.onApply=_?.onApply||null,M.successMessage=_?.successMessage||null,M.shape=_?.shape||"square",M.outputMimeType=_?.outputMimeType||"image/jpeg",M.outputMaxSize=typeof _?.outputMaxSize=="number"?_.outputMaxSize:null,x&&(x.textContent=_?.title||"Crop Image to Square"),P&&_?.instructions&&(P.textContent=_.instructions),G.setAttribute("role","dialog"),G.setAttribute("aria-modal","true"),G.setAttribute("aria-labelledby","crop-modal-title"),G.classList.add("active"),requestAnimationFrame(()=>{let $=window.innerHeight*.6,U=B.width,J=B.height;if(U>600||J>$){let V=Math.min(600/U,$/J);U=Math.floor(U*V),J=Math.floor(J*V)}Y.width=U,Y.height=J,K.clearRect(0,0,Y.width,Y.height),K.drawImage(B,0,0,U,J);let X=Math.min(U,J),Q=Math.floor(X*.8);M.selection={x:Math.floor((U-Q)/2),y:Math.floor((J-Q)/2),size:Q},v(),requestAnimationFrame(()=>{requestAnimationFrame(()=>{m()})})})}function f(){document.getElementById("workspace-logo-crop-modal").classList.remove("active"),L(),M={originalImage:null,originalDataUrl:null,canvas:null,ctx:null,selection:{x:0,y:0,size:0},isDragging:!1,isResizing:!1,dragStartX:0,dragStartY:0,activeHandle:null,shape:"square",outputMimeType:"image/jpeg",outputMaxSize:null,onApply:null,successMessage:null}}function m(){let b=document.getElementById("crop-selection"),B=M.canvas;if(!B||!b)return;b.dataset.shape=M.shape||"square";let _=B.getBoundingClientRect(),G=B.closest(".crop-canvas-container")||B.parentElement,Y=G?G.getBoundingClientRect():_,K=_.left-Y.left,x=_.top-Y.top,P=B.width/_.width,I=M.selection.x/P,$=M.selection.y/P,U=M.selection.size/P;b.style.left=`${K+I}px`,b.style.top=`${x+$}px`,b.style.width=`${U}px`,b.style.height=`${U}px`,g()}function g(){let b=document.getElementById("crop-dimensions"),B=document.getElementById("crop-size-estimate");if(!b||!B)return;let _=M.canvas,G=M.originalImage;if(!_||!G)return;let Y=document.getElementById("crop-selection"),K=_.getBoundingClientRect(),x=Y?.getBoundingClientRect?.(),P=0;if(x&&K.width>0&&K.height>0){let J=G.width/K.width,X=G.height/K.height,Q=x.width*J,V=x.height*X;P=Math.max(1,Math.floor(Math.min(Q,V)))}else{let J=G.width/_.width;P=Math.max(1,Math.floor(M.selection.size*J))}b.textContent=`${P} \xD7 ${P} px`;let I=P*P*3,$=Math.floor(I/1024);B.textContent=`~${$} KB`;let U=2048;B.classList.remove("size-warning","size-error"),$>U?B.classList.add("size-error"):$>U*.8&&B.classList.add("size-warning")}async function h(){try{let b=M.canvas,B=M.originalImage,_=M.selection;if(!b||!B){W(d("error.cropInvalid"));return}let G=b.getBoundingClientRect(),K=document.getElementById("crop-selection")?.getBoundingClientRect?.(),x=0,P=0,I=0;if(K&&G.width>0&&G.height>0){let R=(K.left+K.width/2-G.left)/G.width,ne=(K.top+K.height/2-G.top)/G.height,me=R*B.width,ce=ne*B.height,je=K.width/G.width*B.width,ue=K.height/G.height*B.height;I=Math.max(1,Math.floor(Math.min(je,ue))),x=Math.floor(me-I/2),P=Math.floor(ce-I/2)}else{let R=B.width/b.width,ne=B.height/b.height;I=Math.max(1,Math.floor(_.size*Math.min(R,ne))),x=Math.floor(_.x*R),P=Math.floor(_.y*ne)}x=Math.max(0,Math.min(x,B.width-I)),P=Math.max(0,Math.min(P,B.height-I));let $=2048*1024,U=6,J=(R,ne)=>{let me=document.createElement("canvas");me.width=R,me.height=R;let ce=me.getContext("2d");if(!ce)throw new Error("Canvas context unavailable");let je=M.shape||"square";je==="circle"&&(ce.clearRect(0,0,R,R),ce.save(),ce.beginPath(),ce.arc(R/2,R/2,R/2,0,Math.PI*2),ce.closePath(),ce.clip()),ce.drawImage(B,x,P,I,I,0,0,R,R),je==="circle"&&ce.restore();let ue=M.outputMimeType||(je==="circle"?"image/png":"image/jpeg");return ue==="image/jpeg"||ue==="image/webp"?me.toDataURL(ue,ne):me.toDataURL(ue)},X=M.outputMaxSize?Math.min(I,M.outputMaxSize):I;X=Math.max(50,Math.floor(X));let Q=0,V=.92,ae=J(X,V);for(;ae.length>$*1.37&&Q<U;){let R=M.shape||"square",ne=M.outputMimeType||(R==="circle"?"image/png":"image/jpeg");ne==="image/jpeg"||ne==="image/webp"?V=Math.max(.5,V-.1):X=Math.floor(X*.85),ae=J(X,V),Q++}if(ae.length>$*1.37){W(d("error.cropTooLarge"));return}typeof M.onApply=="function"?(M.onApply(ae),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded(),f(),Xe(M.successMessage||d("success.cropApplied"))):(et.hasPendingChange=!0,et.dataUrl=ae,c(),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded(),f(),Xe(d("success.logoCroppedApplied")))}catch(b){W(d("error.cropFailed",{message:b.message})),console.error("Crop error:",b)}}function k(){let b=document.getElementById("user-avatar-dropzone"),B=document.getElementById("user-avatar-input"),_=document.getElementById("user-avatar-clear-btn");if(!b||!B)return;let G=d("settings.avatarUploadDefault");b.dataset.defaultText=G,b.dataset.changeText=d("settings.avatarUploadChange");function Y(I){b.innerHTML="";let $=document.createElement("span");$.className="workspace-logo-dropzone-text",$.textContent=I,b.appendChild($)}function K(I){I.style.display="flex",I.style.alignItems="center",I.style.justifyContent="center",I.style.gap="10px",I.style.padding="12px 16px",I.style.textAlign="center",I.style.cursor="pointer",I.style.userSelect="none",I.style.minHeight="48px",I.style.border="2px dashed var(--border)",I.style.borderRadius="10px",I.style.background="var(--bg-tertiary)",I.style.boxShadow="none",I.style.color="var(--text-muted)",I.style.fontWeight="500",I.style.transition="border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease"}function x(I,$){$?(I.style.borderColor="var(--accent-blue)",I.style.background="rgba(59, 130, 246, 0.08)",I.style.boxShadow="0 0 0 1px var(--accent-blue)"):(I.style.border="2px dashed var(--border)",I.style.background="var(--bg-tertiary)",I.style.boxShadow="none")}async function P(I,$){if(!I)return;if($&&($.preventDefault(),$.stopPropagation()),!I.type.startsWith("image/")){W(d("error.avatarSelectFile"));return}let U=2048*1024;if(I.size>U){W(d("error.avatarTooLarge"));return}let J=b.dataset.defaultText||d("settings.avatarUploadDefault");try{b.innerHTML="";let X=document.createElement("span");X.className="workspace-logo-dropzone-text",X.textContent=`Uploading ${I.name}...`,b.appendChild(X),b.setAttribute("aria-busy","true");let Q=new FileReader,V=await new Promise((R,ne)=>{Q.onload=()=>R(Q.result),Q.onerror=ne,Q.readAsDataURL(I)}),ae=new Image;ae.onload=()=>{u(V,ae,{title:"Crop Avatar",instructions:"Drag to adjust the crop area. Your avatar will be displayed as a circle.",shape:"circle",outputMimeType:"image/png",outputMaxSize:512,successMessage:"Avatar cropped and applied successfully!",onApply:R=>{tt.hasPendingChange=!0,tt.dataUrl=R,ha()}})},ae.onerror=()=>{W(d("error.imageLoadFailed"))},ae.src=V}catch(X){console.error("Avatar upload error:",X),W(d("error.avatarUploadFailed"))}finally{b.setAttribute("aria-busy","false"),Y(J)}}K(b),Y(G),b.addEventListener("click",()=>B.click()),b.addEventListener("keydown",I=>{(I.key==="Enter"||I.key===" ")&&(I.preventDefault(),B.click())}),B.addEventListener("change",I=>{let $=I.target.files&&I.target.files[0];P($,I),B.value=""}),b.addEventListener("dragenter",I=>{I.preventDefault(),x(b,!0)}),b.addEventListener("dragover",I=>{I.preventDefault(),x(b,!0)}),b.addEventListener("dragleave",I=>{I.preventDefault(),x(b,!1)}),b.addEventListener("drop",I=>{I.preventDefault(),x(b,!1);let $=I.dataTransfer?.files?.[0];P($,I)}),_&&!_.__avatarClearBound&&(_.__avatarClearBound=!0,_.addEventListener("click",()=>{tt.hasPendingChange=!0,tt.dataUrl=null,ha(),window.markSettingsDirtyIfNeeded&&window.markSettingsDirtyIfNeeded()})),ha()}function v(){let b=document.getElementById("crop-selection"),B=document.querySelectorAll(".crop-handle");b&&(b.addEventListener("mousedown",S),b.addEventListener("touchstart",E)),B.forEach(_=>{_.addEventListener("mousedown",j),_.addEventListener("touchstart",T)}),document.addEventListener("mousemove",w),document.addEventListener("mouseup",D),document.addEventListener("touchmove",A),document.addEventListener("touchend",z),document.addEventListener("keydown",H)}function L(){let b=document.getElementById("crop-selection"),B=document.querySelectorAll(".crop-handle");b&&(b.removeEventListener("mousedown",S),b.removeEventListener("touchstart",E)),B.forEach(_=>{_.removeEventListener("mousedown",j),_.removeEventListener("touchstart",T)}),document.removeEventListener("mousemove",w),document.removeEventListener("mouseup",D),document.removeEventListener("touchmove",A),document.removeEventListener("touchend",z),document.removeEventListener("keydown",H)}function S(b){b.target.classList.contains("crop-handle")||(b.preventDefault(),b.stopPropagation(),M.isDragging=!0,M.dragStartX=b.clientX,M.dragStartY=b.clientY)}function j(b){b.preventDefault(),b.stopPropagation(),M.isResizing=!0,M.dragStartX=b.clientX,M.dragStartY=b.clientY,b.target.classList.contains("crop-handle-nw")?M.activeHandle="nw":b.target.classList.contains("crop-handle-ne")?M.activeHandle="ne":b.target.classList.contains("crop-handle-sw")?M.activeHandle="sw":b.target.classList.contains("crop-handle-se")&&(M.activeHandle="se")}function w(b){if(!M.isDragging&&!M.isResizing)return;b.preventDefault();let B=M.canvas;if(!B)return;let _=B.getBoundingClientRect(),G=B.width/_.width,Y=(b.clientX-M.dragStartX)*G,K=(b.clientY-M.dragStartY)*G;if(M.isDragging){let x=M.selection.x+Y,P=M.selection.y+K;x=Math.max(0,Math.min(x,B.width-M.selection.size)),P=Math.max(0,Math.min(P,B.height-M.selection.size)),M.selection.x=x,M.selection.y=P}else if(M.isResizing){let x=(R,ne)=>Math.abs(R)>Math.abs(ne)?R:ne,I=M.selection,$=0,U=0,J=0,X=0;switch(M.activeHandle){case"se":J=x(Y,K),$=I.x,U=I.y,X=Math.min(B.width-$,B.height-U);break;case"nw":J=x(-Y,-K),$=I.x+I.size,U=I.y+I.size,X=Math.min($,U);break;case"ne":J=x(Y,-K),$=I.x,U=I.y+I.size,X=Math.min(B.width-$,U);break;case"sw":J=x(-Y,K),$=I.x+I.size,U=I.y,X=Math.min($,B.height-U);break}let Q=I.size+J;Q=Math.max(50,Math.min(Q,X));let V=I.x,ae=I.y;switch(M.activeHandle){case"se":V=$,ae=U;break;case"nw":V=$-Q,ae=U-Q;break;case"ne":V=$,ae=U-Q;break;case"sw":V=$-Q,ae=U;break}M.selection.size=Q,M.selection.x=V,M.selection.y=ae}m(),M.dragStartX=b.clientX,M.dragStartY=b.clientY}function D(b){(M.isDragging||M.isResizing)&&(b.preventDefault(),M.isDragging=!1,M.isResizing=!1,M.activeHandle=null)}function E(b){if(b.target.classList.contains("crop-handle"))return;b.preventDefault();let B=b.touches[0];M.isDragging=!0,M.dragStartX=B.clientX,M.dragStartY=B.clientY}function T(b){b.preventDefault(),b.stopPropagation();let B=b.touches[0];M.isResizing=!0,M.dragStartX=B.clientX,M.dragStartY=B.clientY,b.target.classList.contains("crop-handle-nw")?M.activeHandle="nw":b.target.classList.contains("crop-handle-ne")?M.activeHandle="ne":b.target.classList.contains("crop-handle-sw")?M.activeHandle="sw":b.target.classList.contains("crop-handle-se")&&(M.activeHandle="se")}function A(b){if(!M.isDragging&&!M.isResizing)return;b.preventDefault();let B=b.touches[0],_={clientX:B.clientX,clientY:B.clientY,preventDefault:()=>{}};w(_)}function z(b){(M.isDragging||M.isResizing)&&(b.preventDefault(),M.isDragging=!1,M.isResizing=!1,M.activeHandle=null)}function H(b){b.key==="Escape"&&f()}window.openCropModal=u,window.closeCropModal=f,window.applyCrop=h,k()}qd();window.initializeApp=Zn;window.setupUserMenus=sc;window.addEventListener("beforeunload",e=>{if(ua&&(clearTimeout(ua),$n()),Ne>0)return e.preventDefault(),e.returnValue="You have unsaved changes. Are you sure you want to leave?",e.returnValue});document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("task-modal");if(!e)return;let t=e.querySelector('#task-form input[name="title"]');t&&t.addEventListener("blur",function(o){let s=e.querySelector("#task-form");s&&s.dataset.editingTaskId&&ft("title",o.target.value)});let a=e.querySelector("#task-description-editor"),n=e.querySelector("#task-description-hidden");if(a&&n){let o="";a.addEventListener("focus",function(){o=a.innerHTML}),a.addEventListener("input",function(){n.value=a.innerHTML}),a.addEventListener("blur",function(){let s=e.querySelector("#task-form");s&&s.dataset.editingTaskId&&a.innerHTML!==o&&ft("description",a.innerHTML)})}});var Vo=!1;document.addEventListener("click",function(e){if(!e.target.closest(".color-picker-container")){if(Vo){Vo=!1;return}document.querySelectorAll(".color-picker-dropdown").forEach(t=>{t.style.display="none"})}});async function zd(){let e=document.getElementById("task-form"),t=e.dataset.editingTaskId,a=ke("tasks","submit",{editing:!!t,taskCount:C.length}),n=e.querySelector('input[name="title"]').value,o=document.getElementById("task-description-hidden").value;o=Zi(o);let s=e.querySelector('input[name="projectId"]').value||(e.querySelector('select[name="projectId"]')?e.querySelector('select[name="projectId"]').value:""),r=document.getElementById("hidden-status").value||"backlog",i=e.querySelector("#hidden-priority").value||"medium",c=(e.querySelector('input[name="startDate"]')?.value||"").trim(),l=c===""?"":c,p=(e.querySelector('input[name="endDate"]')?.value||"").trim(),u=p===""?"":p;if(t){let m=C.find(k=>k.id===parseInt(t,10)),g=m?JSON.parse(JSON.stringify(m)):null,h=Vs(parseInt(t,10),{title:n,description:o,projectId:s,startDate:l,endDate:u,priority:i,status:r},C);if(h.task){window.historyService&&g&&window.historyService.recordTaskUpdated(g,h.task);let k=h.oldProjectId;C=h.tasks;let v=h.task;if(k!==v.projectId&&(k&&(Zt(k),Xt(k,"removed",v)),v.projectId&&(Zt(v.projectId),Xt(v.projectId,"added",v)),nt().catch(()=>{})),Ge("task-modal"),document.getElementById("project-details").classList.contains("active")){let L=k||v.projectId;L&&Be(L)}else document.getElementById("projects").classList.contains("active")&&(te.projectsSortedView=null,Ve(),Ae());_e().catch(L=>{console.error("Failed to save task:",L),W(v("error.saveChangesFailed"))})}}else{let m=_s({title:n,description:o,projectId:s,startDate:l,endDate:u,priority:i,status:r,tags:window.tempTags?[...window.tempTags]:[]},C,at,$e);C=m.tasks,at=m.taskCounter;let g=m.task;$e=[],window.tempTags=[],window.historyService&&window.historyService.recordTaskCreated(g),g&&g.projectId&&(Zt(g.projectId),Xt(g.projectId,"added",g),nt().catch(()=>{})),Xa(),Ta(),oa(),Ge("task-modal"),g.projectId&&document.getElementById("project-details").classList.contains("active")?(Be(g.projectId),Ae()):document.getElementById("projects").classList.contains("active")&&(te.projectsSortedView=null,Ve(),Ae()),_e().catch(h=>{console.error("Failed to save task:",h),W(d("error.saveChangesFailed"))})}Ge("task-modal"),Ut(),document.getElementById("calendar-view")&&re(),ls(),_e().catch(m=>{console.error("Failed to save task:",m),W(d("error.saveChangesFailed"))}),ye("tasks",a,{taskCount:C.length,projectCount:N.length})}document.getElementById("task-form").addEventListener("submit",function(e){e.preventDefault(),e.stopPropagation(),zd()});function Hd(){document.body.hasAttribute("data-status-dropdown-initialized")||(document.body.setAttribute("data-status-dropdown-initialized","true"),document.addEventListener("click",Ud))}function Ud(e){if(e.target.closest("#task-options-btn")){e.preventDefault(),e.stopPropagation();let n=document.getElementById("options-menu");n&&(n.style.display=n.style.display==="block"?"none":"block");return}let t=document.getElementById("options-menu");if(t&&!e.target.closest("#task-options-btn")&&!e.target.closest("#options-menu")&&(t.style.display="none"),e.target.closest("#status-current")){e.preventDefault(),e.stopPropagation();let n=e.target.closest(".status-dropdown"),o=n.classList.contains("active");if(document.querySelectorAll(".status-dropdown.active").forEach(s=>s.classList.remove("active")),!o){n.classList.add("active");let s=document.getElementById("hidden-status");s&&Wo(s.value)}return}if(e.target.closest(".status-option")){e.preventDefault(),e.stopPropagation();let n=e.target.closest(".status-option"),o=n.dataset.status,r=n.querySelector(".status-badge").textContent.trim(),i=document.getElementById("status-current"),c=document.getElementById("hidden-status");if(i&&c){let p=i.querySelector(".status-badge");p&&(p.className=`status-badge ${o}`,p.textContent=r),c.value=o,ft("status",o)}let l=n.closest(".status-dropdown");l&&l.classList.remove("active"),setTimeout(()=>Wo(o),100);return}document.querySelectorAll(".status-dropdown.active").forEach(n=>{n.contains(e.target)||n.classList.remove("active")})}function _d(){document.body.hasAttribute("data-priority-dropdown-initialized")||(document.body.setAttribute("data-priority-dropdown-initialized","true"),document.addEventListener("click",Vd))}function Vd(e){if(e.target.closest("#priority-current")){e.preventDefault(),e.stopPropagation();let a=e.target.closest(".priority-dropdown"),n=a.classList.contains("active");if(document.querySelectorAll(".priority-dropdown.active").forEach(o=>o.classList.remove("active")),!n){a.classList.add("active");let o=document.getElementById("hidden-priority");o&&qn(o.value)}return}if(e.target.closest(".priority-option")){e.preventDefault(),e.stopPropagation();let a=e.target.closest(".priority-option"),n=a.dataset.priority,o=a.textContent.trim(),s=document.getElementById("priority-current"),r=document.getElementById("hidden-priority");s&&r&&(s.innerHTML=`<span class="priority-dot ${n}"></span> ${o} <span class="dropdown-arrow">\u25BC</span>`,r.value=n,ft("priority",n));let i=a.closest(".priority-dropdown");i&&i.classList.remove("active"),setTimeout(()=>qn(n),100);return}document.querySelectorAll(".priority-dropdown.active").forEach(a=>{a.contains(e.target)||a.classList.remove("active")})}function qn(e){let t=document.getElementById("priority-options");if(!t)return;let n=Qs.map(o=>({...o,label:ot(o.value)})).filter(o=>o.value!==e);t.innerHTML=n.map(o=>`<div class="priority-option" data-priority="${o.value}">
            <span class="priority-dot ${o.value}"></span> ${o.label}
        </div>`).join("")}function Wo(e){let t=document.getElementById("status-options");if(!t)return;let a=[{value:"backlog",label:We("backlog")},{value:"todo",label:We("todo")},{value:"progress",label:We("progress")},{value:"review",label:We("review")},{value:"done",label:We("done")}],n=a;window.enableReviewStatus===!1&&(n=a.filter(s=>s.value!=="review"));let o=n.filter(s=>s.value!==e);t.innerHTML=o.map(s=>`<div class="status-option" data-status="${s.value}">
            <span class="status-badge ${s.value}">${s.label}</span>
        </div>`).join("")}function Wd(){document.body.hasAttribute("data-project-dropdown-initialized")||(document.body.setAttribute("data-project-dropdown-initialized","true"),document.addEventListener("click",Gd))}function Gd(e){if(e.target.closest("#project-current")){e.preventDefault(),e.stopPropagation();let a=e.target.closest(".project-dropdown"),n=a.classList.contains("active");document.querySelectorAll(".project-dropdown.active").forEach(o=>o.classList.remove("active")),n||(a.classList.add("active"),Kd(a));return}if(e.target.closest(".project-option")){e.preventDefault(),e.stopPropagation();let a=e.target.closest(".project-option"),n=a.dataset.projectId,o=a.textContent.trim(),s=document.getElementById("project-current"),r=document.getElementById("hidden-project");if(s&&r){let c=s.querySelector(".project-text");if(c)if(n){let l=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Ie(parseInt(n))}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;c.innerHTML=l+q(o)}else c.textContent=o;r.value=n,ft("projectId",n),to(n)}let i=a.closest(".project-dropdown");i&&i.classList.remove("active"),xt();return}let t=document.querySelectorAll(".project-dropdown.active");t.length>0&&!e.target.closest(".project-dropdown")&&(t.forEach(a=>a.classList.remove("active")),xt())}function to(e){let t=document.getElementById("task-project-open-btn");t&&(t.style.display=e?"inline-flex":"none")}function Yd(){let e=document.getElementById("hidden-project");if(!e||!e.value)return;let t=parseInt(e.value,10);t&&(Ge("task-modal"),Be(t,"projects"))}function Yi(e){let t=e?e.querySelector(".project-options"):null,a=document.getElementById("hidden-project"),n=a&&a.value||"",o=n?`<div class="project-option" data-project-id="">${d("tasks.project.selectPlaceholder")}</div>`:"";return N&&N.length>0&&(o+=N.slice().sort((s,r)=>(s.name||"").localeCompare(r.name||"",void 0,{sensitivity:"base"})).filter(s=>n===""||String(s.id)!==String(n)).map(s=>{let r=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Ie(s.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;return`<div class="project-option" data-project-id="${s.id}">${r}${q(s.name)}</div>`}).join("")),t&&(t.innerHTML=o),o}var Pe=null,zn=null,pa=[];function Kd(e){let t=Yi(e)||"";Pe||(Pe=document.createElement("div"),Pe.className="project-options-portal",document.body.appendChild(Pe)),Pe.innerHTML=`
        <div class="project-portal-search">
            <input type="text" class="form-input" id="project-portal-search-input" placeholder="Search projects..." autocomplete="off" />
        </div>
        <div class="project-portal-options">${t}</div>
    `,Pe.style.display="block";let a=e.querySelector("#project-current");zn=a,Go(a,Pe),requestAnimationFrame(()=>Go(a,Pe)),Pe.addEventListener("click",s=>{s.stopPropagation();let r=s.target.closest(".project-option");if(!r)return;let i=r.dataset.projectId,c=r.textContent.trim(),l=document.getElementById("project-current"),p=document.getElementById("hidden-project");if(l&&p){let f=l.querySelector(".project-text");if(f)if(i){let m=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Ie(parseInt(i))}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;f.innerHTML=m+q(c)}else f.textContent=c;p.value=i,ft("projectId",i),to(i)}let u=a.closest(".project-dropdown");u&&u.classList.remove("active"),xt()},{once:!0});let n=Pe.querySelector("#project-portal-search-input");n&&(n.addEventListener("input",()=>Yu(n.value)),setTimeout(()=>n.focus(),0)),window.addEventListener("scroll",Sa,!0),window.addEventListener("resize",Sa,!0),document.addEventListener("keydown",Ji,!0);let o=e.querySelector(".project-options");o&&(o.style.display="none"),Jd(a)}function Go(e,t){let a=e.getBoundingClientRect();t.style.width=`${a.width}px`;let n=window.innerHeight,o=Math.min(t.scrollHeight,200),i=n-a.bottom<o+12?Math.max(8,a.top-o-4):a.bottom+4,c=window.innerWidth,l=t.getBoundingClientRect().width||a.width,p=a.left,u=Math.min(Math.max(8,p),Math.max(8,c-l-8));t.style.left=`${u}px`,t.style.top=`${i}px`}function xt(){Pe&&(Pe.style.display="none",Pe.innerHTML=""),document.querySelectorAll(".project-dropdown .project-options").forEach(e=>{e.style.display=""}),window.removeEventListener("scroll",Sa,!0),window.removeEventListener("resize",Sa,!0),document.removeEventListener("keydown",Ji,!0),zn=null,Ki()}function Sa(){!zn||!Pe||Pe.style.display==="none"||(document.querySelector(".project-dropdown.active")?Go(zn,Pe):xt())}function Jd(e){Ki(),pa=Zd(e),pa.forEach(t=>{t.addEventListener("scroll",Sa,{capture:!0,passive:!0})})}function Ki(){!pa||pa.length===0||(pa.forEach(e=>{e.removeEventListener("scroll",Sa,{capture:!0})}),pa=[])}function Zd(e){let t=[],a=e.parentElement;for(;a&&a!==document.body;){let n=getComputedStyle(a);/(auto|scroll|overlay)/.test(n.overflowY)&&a.scrollHeight>a.clientHeight&&t.push(a),a=a.parentElement}return t.push(document.documentElement),t.push(document.body),t}function Ji(e){e.key==="Escape"&&(xt(),document.querySelectorAll(".project-dropdown.active").forEach(t=>t.classList.remove("active")))}function Xm(e){document.execCommand(e,!1,null),document.getElementById("description-editor").focus()}function Qm(e){document.execCommand("formatBlock",!1,e),document.getElementById("description-editor").focus()}function ef(){document.execCommand("insertHTML",!1,"<hr>"),document.getElementById("description-editor").focus()}function Xd(e){document.execCommand(e,!1,null),document.getElementById("task-description-editor").focus()}function Qd(e){document.execCommand("formatBlock",!1,e),document.getElementById("task-description-editor").focus()}function eu(){let e=document.getElementById("task-description-editor");if(!e)return;let t=window.getSelection(),a=!1;if(t&&t.rangeCount){let o=t.getRangeAt(0).commonAncestorContainer,s=o.nodeType===1?o.closest?.(".check-text"):o.parentElement?.closest?.(".check-text");if(s&&e.contains(s)){let r=s.closest(".checkbox-row");if(r&&r.parentNode){let i=document.createElement("div");i.innerHTML='<div class="divider-row"><hr></div><div><br></div>';let c=i.firstChild;r.parentNode.insertBefore(c,r.nextSibling);let l=document.createRange(),p=c.nextSibling;p?(l.setStart(p,0),l.collapse(!0)):(l.selectNodeContents(e),l.collapse(!1)),t.removeAllRanges(),t.addRange(l),e.focus(),e.dispatchEvent(new Event("input")),a=!0}}}a||(document.execCommand("insertHTML",!1,'<div class="divider-row"><hr></div><div><br></div>'),document.getElementById("task-description-editor").focus())}function tu(){let e=document.getElementById("task-description-editor");if(!e)return;let t="chk-"+Date.now()+"-"+Math.floor(Math.random()*1e3),a=`<div class="checkbox-row" data-id="${t}" contenteditable="false"><button type="button" class="checkbox-toggle variant-1" aria-pressed="false" title="${d("tasks.checklist.toggle")}" contenteditable="false"></button><div class="check-text" contenteditable="true"></div></div>`;try{document.execCommand("insertHTML",!1,a)}catch{e.insertAdjacentHTML("beforeend",a)}setTimeout(()=>{let n=e.querySelector(`[data-id="${t}"] .check-text`);if(n){let o=document.createRange();o.selectNodeContents(n),o.collapse(!0);let s=window.getSelection();s.removeAllRanges(),s.addRange(o),n.focus()}e.dispatchEvent(new Event("input"))},10)}function Zi(e){if(!e)return e;let t=document.createElement("div");t.innerHTML=e;let a=/(https?:\/\/[^\s<]+)/g,n=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null),o=[];for(;n.nextNode();){let s=n.currentNode;if(!s||!s.nodeValue)continue;let r=s.parentElement;r&&r.closest("a")||(a.lastIndex=0,a.test(s.nodeValue)&&o.push(s))}return o.forEach(s=>{let r=s.nodeValue,i=0;a.lastIndex=0;let c=document.createDocumentFragment(),l;for(;(l=a.exec(r))!==null;){let p=l[0];l.index>i&&c.appendChild(document.createTextNode(r.slice(i,l.index)));let u=document.createElement("a");u.href=p,u.textContent=p,u.target="_blank",u.rel="noopener noreferrer",c.appendChild(u),i=l.index+p.length}i<r.length&&c.appendChild(document.createTextNode(r.slice(i))),s.parentNode&&s.parentNode.replaceChild(c,s)}),t.innerHTML}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("task-description-editor"),t=document.getElementById("task-description-hidden");e&&t&&(e.addEventListener("input",function(){t.value=e.innerHTML}),e.addEventListener("paste",function(c){if(!c.clipboardData)return;let l=Array.from(c.clipboardData.files||[])[0];if(!l||!l.type||!l.type.startsWith("image/"))return;c.preventDefault(),c.stopPropagation();let p=document.getElementById("attachment-file-dropzone");typeof Un=="function"&&Un(l,p).catch(u=>{console.error("Failed to upload pasted image as attachment:",u)})}),e.addEventListener("keydown",function(c){let l=window.getSelection();if((c.key==="Backspace"||c.key==="Delete")&&l&&l.rangeCount)try{let p=l.getRangeAt(0);if(!p.collapsed&&p.startContainer!==p.endContainer)return;if(p.collapsed){let u=p.startContainer;if(!(u.nodeType===1?u.closest?.(".check-text"):u.parentElement?.closest?.(".check-text"))&&c.key==="Backspace"){let m=u.nodeType===3?u.parentElement:u;if(m&&(u.nodeType===3,p.startOffset===0)){let h=m.previousSibling;for(;h&&h.nodeType!==1;)h=h.previousSibling;if(h&&h.classList&&h.classList.contains("checkbox-row")){c.preventDefault();let k=h.querySelector(".check-text");if(k){k.firstChild||k.appendChild(document.createTextNode(""));let v=(k.firstChild.nodeType===3,k.firstChild),L=v.nodeType===3?v.length:k.textContent?k.textContent.length:0,S=document.createRange();try{S.setStart(v,L)}catch{S.selectNodeContents(k),S.collapse(!1)}S.collapse(!0),l.removeAllRanges(),l.addRange(S),k.focus(),e.dispatchEvent(new Event("input"));return}}}}}else{let f=function(j){let w=j.nodeType===3?j.parentElement:j;for(;w&&w.parentElement!==e;)w=w.parentElement;return w},u=Array.from(e.childNodes),m=f(p.startContainer),g=f(p.endContainer),h=u.indexOf(m),k=u.indexOf(g);h===-1&&(h=0),k===-1&&(k=u.length-1);let v=Math.min(h,k),L=Math.max(h,k),S=!1;for(let j=v;j<=L;j++){let w=u[j];if(w&&w.classList&&w.classList.contains("checkbox-row")){let D=w.nextSibling;w.parentNode.removeChild(w),D&&D.nodeType===1&&D.tagName.toLowerCase()==="div"&&D.innerHTML.trim()==="<br>"&&D.parentNode.removeChild(D),S=!0}}if(S){c.preventDefault(),e.dispatchEvent(new Event("input"));return}}}catch{}if(c.key==="Enter"){if(!l||!l.rangeCount){c.stopPropagation();return}let u=l.getRangeAt(0).commonAncestorContainer,f=u.nodeType===1?u.closest?.(".check-text"):u.parentElement?.closest?.(".check-text");if(f&&e.contains(f)){c.preventDefault();let m=f.closest(".checkbox-row");if(!m)return;let g=l.getRangeAt(0),h=g.cloneRange();h.selectNodeContents(f),h.setEnd(g.startContainer,g.startOffset);let k=h.toString(),v=g.cloneRange();v.selectNodeContents(f),v.setStart(g.endContainer,g.endOffset);let L=v.toString();if(k.length===0&&L.length===0){let S=document.createElement("div");S.innerHTML="<br>",m.parentNode.replaceChild(S,m);let j=document.createRange();j.setStart(S,0),j.collapse(!0),l.removeAllRanges(),l.addRange(j),e.focus(),e.dispatchEvent(new Event("input"));return}if(L.length===0){let S="chk-"+Date.now()+"-"+Math.floor(Math.random()*1e3),j=document.createElement("div");j.innerHTML=`<div class="checkbox-row" data-id="${S}" contenteditable="false"><button type="button" class="checkbox-toggle variant-1" aria-pressed="false" title="${d("tasks.checklist.toggle")}" contenteditable="false"></button><div class="check-text" contenteditable="true"></div></div>`;let w=j.firstChild;if(m&&m.parentNode){m.parentNode.insertBefore(w,m.nextSibling);let D=w.querySelector(".check-text"),E=document.createRange();E.selectNodeContents(D),E.collapse(!0),l.removeAllRanges(),l.addRange(E),D.focus(),e.dispatchEvent(new Event("input"))}return}document.execCommand("insertHTML",!1,"<br><br>"),e.dispatchEvent(new Event("input"));return}c.stopPropagation();return}if((c.key==="Backspace"||c.key==="Delete")&&l&&l.rangeCount){let p=l.getRangeAt(0),u=p.commonAncestorContainer,f=u.nodeType===1?u.closest?.(".check-text"):u.parentElement?.closest?.(".check-text");if(console.log("[checkbox-editor] keydown",{key:c.key,collapsed:p.collapsed,containerNodeType:u.nodeType,containerTag:u.nodeType===1?u.tagName:null,isInCheckText:!!f}),f&&e.contains(f)){let m=f.closest(".checkbox-row");if(!m)return;let g=p.cloneRange();g.selectNodeContents(f),g.setEnd(p.startContainer,p.startOffset);let h=g.toString(),k=p.cloneRange();k.selectNodeContents(f),k.setStart(p.endContainer,p.endOffset);let v=k.toString();if(c.key==="Backspace"&&h.length===0){c.preventDefault(),console.log("[checkbox-editor] Backspace at start of checkbox row",{beforeText:h,afterText:v});let L=m.previousSibling,S=m.nextSibling;for(;L&&L.nodeType!==1;)L=L.previousSibling;m.parentNode.removeChild(m),S&&S.nodeType===1&&S.tagName.toLowerCase()==="div"&&S.innerHTML.trim()==="<br>"&&S.parentNode.removeChild(S);let j=window.getSelection(),w=document.createRange(),D=null,E=!1;if(L&&L.classList&&L.classList.contains("checkbox-row")){let T=L.querySelector(".check-text");if(T){T.firstChild||T.appendChild(document.createTextNode(""));let A=(T.firstChild.nodeType===3,T.firstChild),z=A.nodeType===3?A.length:T.textContent?T.textContent.length:0;try{w.setStart(A,z)}catch{w.selectNodeContents(T)}w.collapse(!1),E=!0,D=T,console.log("[checkbox-editor] caret moved to previous checkbox row")}}if(!E){for(;S&&S.nodeType!==1;)S=S.nextSibling;S&&S.parentNode?(w.setStart(S,0),w.collapse(!0)):(w.selectNodeContents(e),w.collapse(!1)),console.log("[checkbox-editor] caret fallback placement",{hasNext:!!S})}j.removeAllRanges(),j.addRange(w),D&&typeof D.focus=="function"?D.focus():e.focus();{let T=j.anchorNode;console.log("[checkbox-editor] final caret location",{nodeType:T?T.nodeType:null,tag:T&&T.nodeType===1?T.tagName:null,textSnippet:T&&T.textContent?T.textContent.slice(0,30):null,insideCheckboxRow:!!(T&&T.parentElement&&T.parentElement.closest(".checkbox-row"))})}e.dispatchEvent(new Event("input"));return}if(c.key==="Delete"&&v.length===0){c.preventDefault();let L=m.nextSibling;m.parentNode.removeChild(m),L&&L.nodeType===1&&L.tagName.toLowerCase()==="div"&&L.innerHTML.trim()==="<br>"&&L.parentNode.removeChild(L);let S=window.getSelection(),j=document.createRange();L?(j.setStart(L,0),j.collapse(!0)):(j.selectNodeContents(e),j.collapse(!1)),S.removeAllRanges(),S.addRange(j),e.focus(),e.dispatchEvent(new Event("input"));return}}}}),e.addEventListener("click",function(c){let l=c.target.closest(".checkbox-toggle");if(!l)return;let p=l.getAttribute("aria-pressed")==="true";l.setAttribute("aria-pressed",String(!p)),l.classList.toggle("checked",!p),l.innerText=p?"":"\u2714",e.dispatchEvent(new Event("input"))}));let a=document.getElementById("task-description-editor");a&&a.addEventListener("click",function(c){let l=c.target.closest("a");if(!l)return;let p=l.getAttribute("href");if(!p)return;let u=window.getSelection();u&&u.toString()||(c.preventDefault(),c.stopPropagation(),window.open(p,"_blank","noopener,noreferrer"))});let n=document.getElementById("attachment-url"),o=document.getElementById("attachment-name");n&&n.addEventListener("keydown",function(c){c.key==="Enter"&&(c.preventDefault(),Jo())}),o&&o.addEventListener("keydown",function(c){c.key==="Enter"&&(c.preventDefault(),Jo())});let s=document.getElementById("checklist-btn");s&&s.addEventListener("click",function(){let c=document.getElementById("task-description-editor"),l=window.getSelection();Zu(c)||tu()});let r=document.getElementById("tag-input");r&&r.addEventListener("keydown",function(c){c.key==="Enter"&&(c.preventDefault(),bc())});let i=document.getElementById("feedback-description");if(i){let c=i.getAttribute("placeholder")||"",l="Describe the issue or idea.",p=()=>typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:window.innerWidth<=768,u=()=>{i.placeholder=p()?l:c};if(u(),typeof window.matchMedia=="function"){let f=window.matchMedia("(max-width: 768px)");typeof f.addEventListener=="function"?f.addEventListener("change",u):typeof f.addListener=="function"&&f.addListener(u)}i.addEventListener("keypress",function(f){f.key==="Enter"&&(f.preventDefault(),bs())})}});function au(){let e=new Date,t=e.getMonth(),a=e.getFullYear();return{currentMonth:t,currentYear:a}}var Xi=au(),we=Xi.currentMonth,Se=Xi.currentYear;function ms(){localStorage.setItem("calendarMonth",we.toString()),localStorage.setItem("calendarYear",Se.toString())}function re(){let e=ke("render","calendar",{taskCount:C.length,month:we+1,year:Se}),t=It(),a=Hs(t),n=new Date;document.getElementById("calendar-month-year").textContent=Us(t,Se,we);let o=y.projects.size>0?new Set(Array.from(y.projects).map(l=>parseInt(l,10))):null,s=Or(Se,we,{tasks:C,projects:N,filteredProjectIds:o,includeBacklog:!!F.calendarIncludeBacklog,today:n}),r=s.isCurrentMonth;try{let l=typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:window.innerWidth<=768;l&&document.querySelectorAll(".calendar-today-btn--header").forEach(p=>{p.style.display=r?"none":"inline-flex"}),l||document.querySelectorAll(".calendar-today-btn--nav").forEach(p=>{p.style.display=r?"none":"inline-flex"})}catch{}let i=qr(s,a);document.getElementById("calendar-grid").innerHTML=i;let c=document.getElementById("project-overlay");c&&(c.style.opacity="0"),requestAnimationFrame(()=>{requestAnimationFrame(()=>{Ua()})})}var ht=0,ii=20;function Ua(){let e=ke("render","projectBars",{taskCount:C.length,projectCount:N.length});try{let t=document.getElementById("project-overlay");if(!t){console.error("[ProjectBars] No overlay element found!"),ht=0;return}t.innerHTML="",t.style.opacity="0";let a=document.getElementById("calendar-grid");if(!a){console.error("[ProjectBars] No calendar grid found!"),ht=0;return}let n=document.getElementById("calendar-view");if(!(n&&(n.classList.contains("active")||n.classList.contains("preparing")))){ht=0;return}let s=a.offsetHeight,r=a.offsetWidth,i=Array.from(a.querySelectorAll(".calendar-day"));if(i.length===0)if(ht<ii){console.warn("[ProjectBars] No day elements found, retrying in 100ms..."),ht++,setTimeout(Ua,100);return}else{console.error("[ProjectBars] Max retries reached, giving up"),ht=0;return}let c=i[0].getBoundingClientRect();if(c.width===0||c.height===0)if(ht<ii){console.warn("[ProjectBars] Elements not ready (zero dimensions), retrying in 50ms...",{firstDayRect:c}),ht++,setTimeout(Ua,50);return}else{console.error("[ProjectBars] Max retries reached, giving up"),ht=0;return}ht=0;let l=i.map((x,P)=>({element:x,index:P,gridIndex:P,day:parseInt(x.querySelector(".calendar-day-number").textContent),isOtherMonth:x.classList.contains("other-month")})).filter(x=>!x.isOtherMonth),p=y.projects.size>0?Array.from(y.projects).map(x=>parseInt(x,10)):N.map(x=>x.id),u=N.filter(x=>p.includes(x.id)),f=new Map;u.slice().sort((x,P)=>{let I=x.startDate||"",$=P.startDate||"";if(I!==$)return I.localeCompare($);let U=x.endDate||x.startDate||"",J=P.endDate||P.startDate||"";if(U!==J)return U.localeCompare(J);let X=(x.name||"").toLowerCase(),Q=(P.name||"").toLowerCase();return X!==Q?X.localeCompare(Q):(x.id||0)-(P.id||0)}).forEach((x,P)=>f.set(x.id,P));let m=l.length>0?l[0].gridIndex:-1,g=l.length>0?l[l.length-1].gridIndex:-1,h=new Map,k=new Map;u.forEach(x=>{let[P,I,$]=x.startDate.split("-").map(ne=>parseInt(ne)),U=new Date(P,I-1,$),[J,X,Q]=(x.endDate||x.startDate).split("-").map(ne=>parseInt(ne)),V=new Date(J,X-1,Q),ae=new Date(Se,we,1),R=new Date(Se,we+1,0);if(U<=R&&V>=ae){let ne=U<ae?ae:U,me=V>R?R:V,ce=ne.getDate(),je=me.getDate(),ue=l.find(Ue=>Ue.day===ce),be=l.find(Ue=>Ue.day===je);if(!ue||!be)return;let Ct=ue.gridIndex,wt=be.gridIndex,lt=Ct;for(;lt<=wt;){let Ue=Math.floor(lt/7)*7,Lt=Math.min(Ue+6,wt),sa=Math.max(lt,Ue),so=Lt,Ia=Math.floor(sa/7);h.has(Ia)||h.set(Ia,[]),h.get(Ia).push({startIndex:sa,endIndex:so,project:x}),lt=Lt+1}}});let v=ca(window.kanbanUpdatedFilter),L=typeof kt=="function"?kt():C.slice(),S=v===null?L:L.filter(x=>Pt(x)>=v),D=(!!F.calendarIncludeBacklog?S:S.filter(x=>x.status!=="backlog")).filter(x=>{let P=x.endDate&&x.endDate.length===10&&x.endDate.includes("-"),I=x.startDate&&x.startDate.length===10&&x.startDate.includes("-");return P||I}),E=new Map,T=x=>x.startDate&&x.startDate.length===10&&x.startDate.includes("-")?x.startDate:x.endDate||"";D.slice().sort((x,P)=>{let I=T(x),$=T(P);if(I!==$)return I.localeCompare($);let U=x.endDate||"",J=P.endDate||"";if(U!==J)return U.localeCompare(J);let X=(x.title||"").toLowerCase(),Q=(P.title||"").toLowerCase();return X!==Q?X.localeCompare(Q):(x.id||0)-(P.id||0)}).forEach((x,P)=>E.set(x.id,P)),D.forEach(x=>{let P,I,$=x.startDate&&x.startDate.length===10&&x.startDate.includes("-"),U=x.endDate&&x.endDate.length===10&&x.endDate.includes("-");if($){let[Q,V,ae]=x.startDate.split("-").map(R=>parseInt(R));P=new Date(Q,V-1,ae)}else if(U){let[Q,V,ae]=x.endDate.split("-").map(R=>parseInt(R));P=new Date(Q,V-1,ae)}else return;if(U){let[Q,V,ae]=x.endDate.split("-").map(R=>parseInt(R));I=new Date(Q,V-1,ae)}else if($)I=P;else return;let J=new Date(Se,we,1),X=new Date(Se,we+1,0);if(P<=X&&I>=J){let Q=P<J?J:P,V=I>X?X:I,ae=Q.getDate(),R=V.getDate(),ne=l.find(be=>be.day===ae),me=l.find(be=>be.day===R);if(!ne||!me)return;let ce=ne.gridIndex,je=me.gridIndex,ue=ce;for(;ue<=je;){let be=Math.floor(ue/7)*7,Ct=Math.min(be+6,je),wt=Math.max(ue,be),lt=Ct,Ue=Math.floor(wt/7);k.has(Ue)||k.set(Ue,[]),k.get(Ue).push({startIndex:wt,endIndex:lt,task:x}),ue=Ct+1}}});let A=18,z=3,H=20,b=4,B=a.offsetHeight,_=a.getBoundingClientRect(),G=new Map;h.forEach((x,P)=>{x.sort(($,U)=>(f.get($.project.id)??0)-(f.get(U.project.id)??0)||$.startIndex-U.startIndex||$.endIndex-U.endIndex);let I=[];x.forEach($=>{let U=I.findIndex(J=>$.startIndex>J);U===-1?(U=I.length,I.push($.endIndex)):I[U]=$.endIndex,$.track=U}),x.forEach($=>{let U=i[$.startIndex],J=i[$.endIndex];if(!U||!J)return;let X=U.getBoundingClientRect(),Q=J.getBoundingClientRect(),V=document.createElement("div");V.className="project-bar",V.style.position="absolute";let ae=6,R=X.left-_.left+ae,ne=Q.right-X.left-ae*2;R<0&&(ne+=R,R=0),R+ne>_.width&&(ne=Math.max(0,_.width-R)),ne=Math.max(0,ne),V.style.left=R+"px",V.style.width=ne+"px";let me=U.querySelector(".project-spacer"),ce=(me?me.getBoundingClientRect().top:X.top)-_.top;V.style.top=ce+$.track*(A+z)+"px",V.style.height=A+"px";let je=Ie($.project.id);V.style.background=`linear-gradient(90deg, ${je}, ${je}dd)`,V.style.textShadow="0 1px 2px rgba(0,0,0,0.3)",V.style.fontWeight="600",V.style.color="white",V.style.padding="1px 6px",V.style.fontSize="10px",V.style.display="flex",V.style.alignItems="center",V.style.boxShadow="0 1px 3px rgba(0,0,0,0.2)",V.style.pointerEvents="auto",V.style.cursor="pointer",V.style.zIndex="10",V.style.whiteSpace="nowrap",V.style.overflow="hidden",V.style.textOverflow="ellipsis";let ue=`${Se}-${String(we+1).padStart(2,"0")}-01`,be=new Date(Se,we+1,0).getDate(),Ct=`${Se}-${String(we+1).padStart(2,"0")}-${String(be).padStart(2,"0")}`,wt=$.project.startDate,lt=$.project.endDate||$.project.startDate,Ue=wt<ue&&$.startIndex===m,Lt=lt>Ct&&$.endIndex===g;Ue&&V.classList.add("continues-left"),Lt&&V.classList.add("continues-right"),V.style.borderTopLeftRadius=Ue?"0":"6px",V.style.borderBottomLeftRadius=Ue?"0":"6px",V.style.borderTopRightRadius=Lt?"0":"6px",V.style.borderBottomRightRadius=Lt?"0":"6px",V.textContent=$.project.name,V.onclick=sa=>{sa.stopPropagation(),Be($.project.id,"calendar",{month:we,year:Se})},t.appendChild(V)}),G.has(P)||G.set(P,{projectTracks:0,taskTracks:0}),G.get(P).projectTracks=I.length}),k.forEach((x,P)=>{x.sort(($,U)=>(E.get($.task.id)??0)-(E.get(U.task.id)??0)||$.startIndex-U.startIndex||$.endIndex-U.endIndex);let I=[];x.forEach($=>{let U=I.findIndex(J=>$.startIndex>J);U===-1?(U=I.length,I.push($.endIndex)):I[U]=$.endIndex,$.track=U}),x.forEach($=>{let U=$.task.startDate&&$.task.startDate.length===10&&$.task.startDate.includes("-"),J=$.task.endDate&&$.task.endDate.length===10&&$.task.endDate.includes("-"),X=i[$.startIndex],Q=i[$.endIndex];if(!X||!Q)return;let V=X.getBoundingClientRect(),ae=Q.getBoundingClientRect(),R=document.createElement("div");R.className="task-bar",R.style.position="absolute";let ne=6,me=V.left-_.left+ne,ce=ae.right-V.left-ne*2;me<0&&(ce+=me,me=0),me+ce>_.width&&(ce=Math.max(0,_.width-me)),ce=Math.max(0,ce),R.style.left=me+"px",R.style.width=ce+"px";let je=X.querySelector(".project-spacer"),ue=(je?je.getBoundingClientRect().top:V.top)-_.top,be=G.get(P)?.projectTracks||0,Ct=be*(A+z),wt=be>0?6:0;R.style.top=ue+Ct+wt+$.track*(H+b)+"px",R.style.height=H+"px";let lt=yo[$.task.priority]||"var(--accent-blue)";U?(R.style.borderLeftWidth="5px",R.style.borderLeftColor=lt):R.style.borderLeftWidth="1px",J?(R.style.borderRightWidth="5px",R.style.borderRightColor=lt):R.style.borderRightWidth="1px",R.style.color="var(--text-primary)",R.style.padding="2px 6px",R.style.fontSize="11px",R.style.fontWeight="500",R.style.display="flex",R.style.alignItems="center",R.style.boxShadow="var(--shadow-sm)",R.style.pointerEvents="auto",R.style.cursor="pointer",R.style.zIndex="11",R.style.whiteSpace="nowrap",R.style.overflow="hidden",R.style.textOverflow="ellipsis";let Ue=`${Se}-${String(we+1).padStart(2,"0")}-01`,Lt=new Date(Se,we+1,0).getDate(),sa=`${Se}-${String(we+1).padStart(2,"0")}-${String(Lt).padStart(2,"0")}`,so=U?$.task.startDate:$.task.endDate,Ia=J?$.task.endDate:$.task.startDate,ro=so<Ue&&$.startIndex===m,io=Ia>sa&&$.endIndex===g;ro&&R.classList.add("continues-left"),io&&R.classList.add("continues-right"),U&&R.classList.add("has-start-date"),J&&R.classList.add("has-end-date"),R.style.borderTopLeftRadius=ro?"0":"4px",R.style.borderBottomLeftRadius=ro?"0":"4px",R.style.borderTopRightRadius=io?"0":"4px",R.style.borderBottomRightRadius=io?"0":"4px",R.textContent=$.task.title,R.onclick=Ac=>{Ac.stopPropagation(),xa($.task.id)},t.appendChild(R)}),G.has(P)||G.set(P,{projectTracks:0,taskTracks:0}),G.get(P).taskTracks=I.length});let Y=a.querySelectorAll(".calendar-day .project-spacer"),K=new Map;Y.forEach(x=>{let P=parseInt(x.closest(".calendar-day").dataset.row,10),I=G.get(P)||{projectTracks:0,taskTracks:0},$=I.projectTracks>0?I.projectTracks*(A+z):0,U=I.taskTracks>0?I.taskTracks*(H+b):0,J=I.projectTracks>0&&I.taskTracks>0?6:0,X=$+U+J+(I.projectTracks>0||I.taskTracks>0?4:0);x.style.height=X+"px",K.set(P,X)}),t.style.opacity="1"}catch(t){console.error("[ProjectBars] Error rendering project/task bars:",t)}ye("render",e,{taskCount:C.length,projectCount:N.length})}function Qi(e){ou(e)}function nu(){let e=document.querySelector(".calendar-stage");if(!e||e.dataset.swipeReady==="true")return;e.dataset.swipeReady="true";let t=0,a=0,n=!1,o=!1;e.addEventListener("touchstart",s=>{if(s.touches.length!==1)return;let r=s.touches[0];t=r.clientX,a=r.clientY,n=!0,o=!1},{passive:!0}),e.addEventListener("touchmove",s=>{if(!n)return;let r=s.touches[0],i=r.clientX-t,c=r.clientY-a;o||(Math.abs(i)>12&&Math.abs(i)>Math.abs(c)?o=!0:Math.abs(c)>12&&(n=!1)),o&&s.preventDefault()},{passive:!1}),e.addEventListener("touchend",s=>{if(!n||(n=!1,!o))return;let r=s.changedTouches[0],i=r.clientX-t,c=r.clientY-a;if(Math.abs(i)<50||Math.abs(i)<Math.abs(c))return;let l=i<0?1:-1;Qi(l)},{passive:!0}),e.addEventListener("touchcancel",()=>{n=!1,o=!1},{passive:!0})}document.addEventListener("DOMContentLoaded",()=>{nu()});function ou(e){let t=Mr(Se,we,e);Se=t.year,we=t.month,ms(),re(),document.getElementById("calendar-view")&&re()}function su(){let e=new Date;we=e.getMonth(),Se=e.getFullYear(),ms(),re(),document.getElementById("calendar-view")&&re()}function ta(e){let t=C.filter(s=>s.projectId===e);if(t.length===0)return"planning";let a=t.every(s=>s.status==="done"),n=t.every(s=>s.status==="backlog"||s.status==="todo"),o=t.some(s=>s.status==="progress"||s.status==="review");return a?"completed":n?"planning":"active"}function ru(e){let t=ca(window.kanbanUpdatedFilter),a=typeof kt=="function"?kt():C.slice(),o=(t===null?a:a.filter(u=>Pt(u)>=t)).filter(u=>u.startDate&&u.endDate?e>=u.startDate&&e<=u.endDate:u.endDate?u.endDate===e:u.startDate?u.startDate===e:!1);F.calendarIncludeBacklog||(o=o.filter(u=>u.status!=="backlog")),o.sort((u,f)=>{let m=se[u.priority]||0;return(se[f.priority]||0)-m});let r=N.filter(u=>{let f=new Date(u.startDate),m=u.endDate?new Date(u.endDate):new Date(u.startDate),g=new Date(e);return g>=f&&g<=m});if(o.length===0&&r.length===0){let u=`No tasks or projects for ${pe(e)}. Would you like to create a new task?`;document.getElementById("calendar-create-message").textContent=u,document.getElementById("calendar-create-modal").classList.add("active"),window.pendingCalendarDate=e;return}let i=document.getElementById("day-items-modal"),c=document.getElementById("day-items-modal-title"),l=document.getElementById("day-items-modal-body");c.textContent=d("calendar.dayItemsTitle",{date:pe(e)}),window.dayItemsModalDate=e;let p="";r.length>0&&(p+='<div class="day-items-section">',p+=`<div class="day-items-section-title">\u{1F4CA} ${d("calendar.dayItemsProjects")}</div>`,r.forEach(u=>{let f=ta(u.id);p+=`
                <div class="day-item" data-action="closeDayItemsAndShowProject" data-param="${u.id}">
                    <div class="day-item-title">${q(u.name)}</div>
                    <div class="day-item-meta" style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap;">
                        <span>${pe(u.startDate)} - ${pe(u.endDate)}</span>
                        <span class="project-status-badge ${f}">${Gn(f).toUpperCase()}</span>
                    </div>
                </div>
            `}),p+="</div>"),o.length>0&&(p+='<div class="day-items-section">',p+=`<div class="day-items-section-title">\u2705 ${d("calendar.dayItemsTasks")}</div>`,o.forEach(u=>{let f="";if(u.projectId){let h=N.find(k=>k.id===u.projectId);h?f=`<span class="project-indicator" style="background-color: ${Ie(u.projectId)}; color: white; padding: 1px 6px; border-radius: 8px; font-size: 10px; margin-right: 6px; text-shadow: 0 1px 2px rgba(0,0,0,0.3); font-weight: 600;">${q(h.name)}</span>`:f=d("tasks.projectIndicatorNone")}else f=d("tasks.projectIndicatorNone");let m=`<span class="status-badge ${u.status}" style="padding: 2px 8px; font-size: 10px; font-weight: 600;">${We(u.status)}</span>`,g=ot(u.priority||"").toUpperCase();p+=`
                <div class="day-item" data-action="closeDayItemsAndOpenTask" data-param="${u.id}">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; gap: 8px;">
                        <div class="day-item-title" style="flex: 1; min-width: 0;">${q(u.title)}</div>
                        <div class="day-item-meta" style="display: flex; align-items: center; gap: 6px; flex-shrink: 0;"><span class="task-priority priority-${u.priority}">${g}</span>${m}</div>
                    </div>
                    <div style="margin-top: 8px; font-size: 11px;">${f}</div>
                </div>
            `}),p+="</div>"),l.innerHTML=p,i.classList.add("active")}function ao(){document.getElementById("day-items-modal").classList.remove("active")}function iu(e){let t=document.getElementById("day-items-modal");t&&e.target===t&&ao()}function cu(){let e=window.dayItemsModalDate;ao(),e&&(eo(),setTimeout(()=>{let t=document.getElementById("task-modal");if(!t)return;let a=t.querySelector('#task-form input[name="endDate"]');if(!a)return;let n=a.closest(".date-input-wrapper");if(!n)return;let o=n.querySelector(".date-display");!o||!o._flatpickr||(a.value=e,o._flatpickr.setDate(new Date(e),!1))},100)),window.dayItemsModalDate=null}document.addEventListener("keydown",function(e){let t=document.getElementById("day-items-modal");t&&t.classList.contains("active")&&e.key==="Escape"&&(e.preventDefault(),ao())});function fs(){document.getElementById("project-confirm-modal").classList.remove("active"),document.getElementById("delete-tasks-checkbox").checked=!1,document.getElementById("project-confirm-error").classList.remove("show"),ea=null}function _a(e){window.pendingModalToClose=e,document.getElementById("unsaved-changes-modal").classList.add("active")}function ec(){document.getElementById("unsaved-changes-modal").classList.remove("active")}function lu(){let e=window.pendingModalToClose||"task-modal";if(ec(),e==="task-modal")Qe=null;else if(e==="settings-modal"){window.initialSettingsFormState=null,window.settingsFormIsDirty=!1;let a=document.getElementById("settings-form")?.querySelector(".settings-btn-save");a&&(a.classList.remove("dirty"),a.disabled=!0)}window.pendingModalToClose=null,Ge(e)}function tc(){document.getElementById("review-status-confirm-modal").classList.remove("active"),window.pendingReviewStatusToggle&&(window.pendingReviewStatusToggle.checked=!0,window.pendingReviewStatusToggle.dispatchEvent(new Event("change",{bubbles:!0})),typeof window.markSettingsDirtyIfNeeded=="function"&&window.markSettingsDirtyIfNeeded()),window.pendingReviewTaskMigration=null,window.pendingReviewStatusToggle=null}async function du(){let e=window.pendingReviewTaskMigration?[...window.pendingReviewTaskMigration]:[];if(tc(),e&&e.length>0){let n=e.map(o=>o.id);C.forEach(o=>{n.includes(o.id)&&(o.status="progress")}),await _e()}let t=document.getElementById("enable-review-status-toggle");t&&(t.checked=!1,window.enableReviewStatus=!1,localStorage.setItem("enableReviewStatus","false"),F.enableReviewStatus=!1,await is(),ws(),Fe());let a=document.getElementById("save-settings-btn");window.initialSettingsFormState=null,window.settingsFormIsDirty=!1,a&&(a.classList.remove("dirty"),a.disabled=!0),Ge("settings-modal"),Xe(d("success.settingsSaved"))}function gs(){document.getElementById("calendar-create-modal").classList.remove("active"),window.pendingCalendarDate=null}function uu(){let e=window.pendingCalendarDate;gs(),e&&(eo(),setTimeout(()=>{let t=document.getElementById("task-modal");if(!t)return;let a=t.querySelector('#task-form input[name="endDate"]');if(!a)return;let n=a.closest(".date-input-wrapper");if(!n)return;let o=n.querySelector(".date-display");!o||!o._flatpickr||(a.value=e,o._flatpickr.setDate(new Date(e),!1))},100))}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("calendar-create-modal");e&&e.addEventListener("click",function(t){t.target===e&&gs()})});async function ac(){let e=document.getElementById("project-confirm-input"),t=document.getElementById("project-confirm-error"),a=e.value,n=document.getElementById("delete-tasks-checkbox");if(a!=="delete"){t.classList.add("show"),e.focus();return}let o=parseInt(ea,10),s=N.find(c=>c.id===o),r=n.checked;r&&(C=C.filter(c=>c.projectId!==o));let i=Zs(o,N,C,!r);N=i.projects,window.historyService&&s&&window.historyService.recordProjectDeleted(s),!r&&i.tasks&&(C=i.tasks),fs(),te.projectsSortedView=null,window.location.hash="#projects",ze("projects"),Ut(),Promise.all([nt().catch(c=>{console.error("Failed to save projects:",c),W(d("error.saveChangesFailed"))}),r?_e().catch(c=>{console.error("Failed to save tasks:",c),W(d("error.saveChangesFailed"))}):Promise.resolve()])}function Be(e,t,a){let n=ke("projects","details",{projectId:e});if(t!==void 0){if(qe=t,t==="calendar"){let D=a&&Number.isInteger(a.month)?a.month:we,E=a&&Number.isInteger(a.year)?a.year:Se;Et={month:D,year:E}}}else qe||(qe="projects");window.location.hash=`project-${e}`;let o=N.find(D=>D.id===e);if(!o){ye("projects",n,{projectId:e,found:!1});return}window.innerWidth<=768&&window.scrollTo({top:0,behavior:"smooth"}),document.querySelectorAll(".page").forEach(D=>D.classList.remove("active")),document.getElementById("project-details").classList.add("active");let s=document.querySelector(".user-menu");s&&(s.style.display="none");let r=C.filter(D=>D.projectId===e),i=r.filter(D=>D.status==="done"),c=r.filter(D=>D.status==="progress"),l=r.filter(D=>D.status==="review"),p=r.filter(D=>D.status==="todo"),u=r.filter(D=>D.status==="backlog"),f=r.length>0?Math.round(i.length/r.length*100):0,m="planning";if(r.length===0)m="planning";else{let D=r.every(A=>A.status==="done"),E=r.every(A=>A.status==="todo"),T=r.some(A=>A.status==="progress"||A.status==="review");D?m="completed":E?m="planning":(T||!E&&!D)&&(m="active")}let g=o.startDate?new Date(o.startDate):null,h=o.endDate?new Date(o.endDate):new Date,k=g&&Number.isFinite(g.getTime())&&Number.isFinite(h.getTime())?Math.ceil((h-g)/(1e3*60*60*24)):null,v=Number.isFinite(k)?d("projects.details.durationDays",{count:k}):"-",L=`
        <div class="project-details-header">
                    <div class="project-details-title">
                        <span id="project-title-display" data-action="editProjectTitle" data-param="${e}" data-param2="${q(o.name).replace(/'/g,"&#39;")}" style="font-size: 32px; font-weight: 700; color: var(--text-primary); cursor: pointer;">${q(o.name)}</span>
                        <div id="project-title-edit" style="display: none;">
                            <input type="text" id="project-title-input" class="editable-project-title" value="${q(o.name)}" style="font-size: 32px; font-weight: 700;">
                            <button class="title-edit-btn confirm" data-action="saveProjectTitle" data-param="${e}">\u2713</button>
                            <button class="title-edit-btn cancel" data-action="cancelProjectTitle">\u2715</button>
                        </div>
                        <span class="project-status-badge ${m}" data-action="showStatusInfoModal">${Gn(m).toUpperCase()}</span>
                        <button class="back-btn" data-action="${qe==="dashboard"?"backToDashboard":qe==="calendar"?"backToCalendar":"backToProjects"}" style="padding: 8px 12px; font-size: 14px; display: flex; align-items: center; gap: 6px; margin-left: 12px;">${d(qe==="dashboard"?"projects.backTo.dashboard":qe==="calendar"?"projects.backTo.calendar":"projects.backTo.projects")}</button>
                        <div style="margin-left: auto; position: relative;">
                            <button type="button" class="options-btn" id="project-options-btn" data-action="toggleProjectMenu" style="background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:20px;padding:4px;line-height:1;">\u22EF</button>
                            <div class="options-menu" id="project-options-menu" style="position:absolute;top:calc(100% + 8px);right:0;display:none;">
                                <button type="button" class="duplicate-btn" data-action="handleDuplicateProject" data-param="${e}" style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:none;border:none;color:var(--text-primary);cursor:pointer;font-size:14px;width:100%;text-align:left;border-radius:4px;">\u{1F4CB} ${d("projects.duplicate.title")}</button>
                                <button type="button" class="delete-btn" data-action="handleDeleteProject" data-param="${e}">\u{1F5D1}\uFE0F ${d("projects.delete.title")}</button>
                            </div>
                        </div>
	                    </div>

	                    <div class="modal-tabs project-details-tabs">
	                        <button type="button" class="modal-tab active" data-tab="details">${d("projects.details.tab.details")}</button>
	                        <button type="button" class="modal-tab" data-tab="history">${d("projects.details.tab.history")}</button>
	                    </div>

	                    <div class="modal-tab-content active" id="project-details-tab">
		                    <div class="project-details-description">
		                        <textarea class="editable-description" id="project-description-editor">${o.description||""}</textarea>
		                    </div>
                    <div class="project-timeline">
                        <div class="timeline-item">
                            <div class="timeline-label">${d("projects.details.startDate")}</div>
                            <input type="text" class="form-input date-display editable-date datepicker"
                                placeholder="dd/mm/yyyy" maxLength="10"
                                value="${o.startDate?pe(o.startDate):""}"
                                data-project-id="${e}" data-field="startDate">
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-label">${d("projects.details.endDate")}</div>
                                <input type="text" class="form-input date-display editable-date datepicker"
                                    placeholder="dd/mm/yyyy" maxLength="10"
                                    value="${o.endDate?pe(o.endDate):""}"
                                    data-project-id="${e}" data-field="endDate">
                        </div>
	                        <div class="timeline-item">
	                            <div class="timeline-label">${d("projects.details.duration")}</div>
	                            <div class="timeline-value">${v}</div>
	                        </div>
                        <div class="timeline-item">
                            <div class="timeline-label">${d("projects.details.created")}</div>
                            <div class="timeline-value">${pe(o.createdAt?.split("T")[0])}</div>
                        </div>
                        <div class="timeline-item" style="position: relative;">
                            <div class="timeline-label">${d("projects.details.calendarColor")}</div>
                            <div class="color-picker-container" style="position: relative;">
                                <div class="current-color" 
                                     style="background-color: ${Ie(e)}; width: 20px; height: 20px; border-radius: 4px; border: 2px solid var(--border-color); cursor: pointer; display: inline-block;"
                                     data-action="toggleProjectColorPicker" data-param="${e}">
                                </div>
                                <div class="color-picker-dropdown" id="color-picker-${e}" style="display: none; position: absolute; background: var(--bg-primary); border: 1px solid var(--border-color); border-radius: 8px; padding: 8px; margin-top: 4px; z-index: 1000; left: 0; top: 100%; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                                    <div class="color-grid" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px;">
                                        ${Ca.map(D=>`
                                            <div class="color-option" 
                                                 style="width: 24px; height: 24px; background-color: ${D}; border-radius: 4px; cursor: pointer; border: 2px solid ${D===Ie(e)?"white":"transparent"};"
                                                 data-action="updateProjectColor" data-param="${e}" data-param2="${D}">
                                            </div>
                                        `).join("")}
                                    </div>
                                    <div class="color-picker-custom" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid var(--border-light); display: flex; align-items: center; justify-content: space-between; gap: 8px; position: relative;">
                                        <span style="font-size: 12px; color: var(--text-muted);">${d("projects.details.customColor")}</span>
                                        <div 
                                            class="custom-color-swatch" 
                                            data-action="openCustomProjectColorPicker" 
                                            data-param="${e}"
                                            style="width: 24px; height: 24px; background-color: ${Ie(e)}; border-radius: 4px; cursor: pointer; border: 2px solid transparent; box-sizing: border-box;">
                                        </div>
	                                        <input 
	                                            type="color" 
	                                            id="project-color-input-${e}"
	                                            class="project-color-input" 
	                                            data-project-id="${e}"
	                                            value="${Ie(e)}"
	                                            style="position: absolute; opacity: 0; pointer-events: none; width: 0; height: 0;">
	                                    </div>
	                                </div>
	                            </div>
	                        </div>
	                        <div class="timeline-item" style="grid-column: 1 / -1;">
	                            <div class="timeline-label">${d("projects.modal.tagsLabel")}</div>
	                            <div style="margin-top: 8px;">
	                                <div id="project-details-tags-display" style="display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 8px; min-height: 28px;"></div>
	                                <div style="display: flex; gap: 8px;">
	                                    <input type="text" id="project-details-tag-input" class="form-input" placeholder="${d("projects.modal.addTagPlaceholder")}" style="flex: 1;">
	                                    <button type="button" class="btn-secondary" data-action="addProjectDetailsTag" data-param="${e}">+</button>
	                                </div>
	                            </div>
	                        </div>
	                    </div>

	                    <div class="project-progress-section">
                    <div class="progress-header">
                        <div class="progress-title">${d("projects.details.progressOverview")}</div>
                        <div class="progress-percentage">${f}%</div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" style="width: ${f}%"></div>
                    </div>
                    <div class="progress-stats">
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="backlog" title="${d("projects.details.viewBacklog")}">
                            <div class="progress-stat-number" style="color: var(--text-muted);">${u.length}</div>
                            <div class="progress-stat-label">${d("tasks.status.backlog")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="todo" title="${d("projects.details.viewTodo")}">
                            <div class="progress-stat-number" style="color: var(--text-muted);">${p.length}</div>
                            <div class="progress-stat-label">${d("tasks.status.todo")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="progress" title="${d("projects.details.viewProgress")}">
                            <div class="progress-stat-number" style="color: var(--accent-blue);">${c.length}</div>
                            <div class="progress-stat-label">${d("tasks.status.progress")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="review" title="${d("projects.details.viewReview")}">
                            <div class="progress-stat-number" style="color: var(--accent-amber);">${l.length}</div>
                            <div class="progress-stat-label">${d("tasks.status.review")}</div>
                        </div>
                        <div class="progress-stat clickable" data-action="navigateToProjectStatus" data-param="${o.id}" data-param2="done" title="${d("projects.details.viewCompleted")}">
                            <div class="progress-stat-number" style="color: var(--accent-green);">${i.length}</div>
                            <div class="progress-stat-label">${d("tasks.status.done")}</div>
                        </div>
                    </div>
                </div>
                
                <div class="project-tasks-section">
                    <div class="section-header">
                        <div class="section-title">${d("projects.details.tasksTitle",{count:r.length})}</div>
                        <button class="add-btn" data-action="openTaskModalForProject" data-param="${e}">${d("tasks.addButton")}</button>
                    </div>
                    <div id="project-tasks-list">
                        ${r.length===0?`<div class="empty-state">${d("tasks.empty.epic")}</div>`:r.sort((D,E)=>{let T=se[D.priority]||1;return(se[E.priority]||1)-T}).map(D=>`
                                        <div class="project-task-item" data-action="openTaskDetails" data-param="${D.id}">
                                            <div class="project-task-info">
                                                <div class="project-task-title">${D.title}</div>
                                                <div class="project-task-meta">${D.endDate?`${d("tasks.endDatePrefix")}${pe(D.endDate)}`:d("tasks.noDatesSet")}</div>
                                                ${D.tags&&D.tags.length>0?`
                                                    <div class="task-tags" style="margin-top: 4px;">
                                                        ${D.tags.map(E=>`<span style="background-color: ${na(E)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${q(E.toUpperCase())}</span>`).join(" ")}
                                                    </div>
                                                `:""}
                                            </div>
                                            <div class="project-task-priority">
                                                <div class="task-priority priority-${D.priority}"><span class="priority-dot ${D.priority}"></span> ${ot(D.priority)}</div>
                                            </div>
                                            <div class="project-task-status-col">
                                                <div class="status-badge ${D.status}">
                                                    ${We(D.status)}
                                                </div>
                                            </div>
                                        </div>
                            `).join("")}
                    </div>
                </div>

                </div>

	                <div class="modal-tab-content" id="project-history-tab">
	                    <div class="project-history-section">
                    <div class="section-header">
                        <div class="section-title">\u{1F4DC} ${d("projects.details.changeHistory")}</div>
                    </div>
                    <div class="history-timeline-inline" id="project-history-timeline-${e}">
                        <!-- Timeline will be populated by JavaScript -->
                    </div>
                    <div class="history-empty-inline" id="project-history-empty-${e}" style="display: none;">
                        <div style="font-size: 36px; margin-bottom: 12px; opacity: 0.3;">\u{1F4DC}</div>
                        <p style="color: var(--text-muted); text-align: center;">${d("projects.details.noChanges")}</p>
                    </div>
	                    </div>
	                </div>
	        </div>
	            `;document.getElementById("project-details-content").innerHTML=L;let S=document.getElementById("project-description-editor");if(S){let D=()=>aa(e,"description",S.value,{render:!1}),E=typeof kn=="function"?kn(D,500):D;S.addEventListener("input",E),S.addEventListener("blur",D)}pu(e);let j=document.getElementById(`project-color-input-${e}`);j&&j.addEventListener("change",D=>{td(e,D.target.value)}),setTimeout(()=>{document.querySelectorAll("input.datepicker").forEach(D=>{D._flatpickrInstance&&(D._flatpickrInstance.destroy(),delete D._flatpickrInstance)}),Dt()},50),an(o.tags||[],e);let w=document.getElementById("project-details-tag-input");w&&(w.replaceWith(w.cloneNode(!0)),document.getElementById("project-details-tag-input").addEventListener("keydown",function(E){E.key==="Enter"&&(E.preventDefault(),kc(e))})),ye("projects",n,{projectId:e,taskCount:r.length,completionPercentage:f})}function pu(e){let t=document.getElementById("project-details-content");if(!t)return;let a=t.querySelector(".project-details-tabs");if(!a)return;let n=t.querySelector("#project-details-tab"),o=t.querySelector("#project-history-tab");if(!n||!o)return;let s=r=>{a.querySelectorAll(".modal-tab").forEach(c=>c.classList.remove("active")),t.querySelectorAll(".modal-tab-content").forEach(c=>c.classList.remove("active"));let i=a.querySelector(`.modal-tab[data-tab="${r}"]`);if(i&&i.classList.add("active"),r==="history"){o.classList.add("active"),Ko(e);let c=o.querySelector(".project-history-section");c&&(c.scrollTop=0)}else n.classList.add("active")};a.querySelectorAll(".modal-tab").forEach(r=>{r.addEventListener("click",()=>{s(r.dataset.tab)})}),s("details")}function mu(e){ea=e,nc()}function nc(){let e=ea;if(!e)return;let t=C.filter(r=>r.projectId===e),a=document.getElementById("delete-tasks-checkbox"),n=a?a.closest('div[style*="margin: 16px"]'):null;n&&(t.length===0?n.style.display="none":n.style.display="block"),document.getElementById("project-confirm-modal").classList.add("active");let o=document.getElementById("project-confirm-input");o.value="",o.focus();let s=function(r){let i=r.target.selectionStart,c=r.target.selectionEnd;r.target.value=r.target.value.toLowerCase(),r.target.setSelectionRange(i,c)};o.addEventListener("input",s),document.addEventListener("keydown",function(r){let i=document.getElementById("project-confirm-modal");!i||!i.classList.contains("active")||(r.key==="Escape"?(r.preventDefault(),fs()):r.key==="Enter"&&(r.preventDefault(),ac()))})}var hs=null;function fu(e){hs=e;let t=document.getElementById("project-duplicate-modal");if(!N.find(p=>p.id===e))return;let n=C.filter(p=>p.projectId===e),o=document.getElementById("duplicate-tasks-checkbox"),s=document.getElementById("task-naming-options");n.length===0?(o&&(o.checked=!1,o.disabled=!0),s&&(s.style.display="none")):(o&&(o.checked=!0,o.disabled=!1),s&&(s.style.display="block"));let r=document.querySelector('input[name="task-naming"][value="none"]');r&&(r.checked=!0);let i=document.getElementById("task-prefix-input"),c=document.getElementById("task-suffix-input");i&&(i.value="",i.disabled=!0),c&&(c.value="",c.disabled=!0),t.classList.add("active"),o&&o.addEventListener("change",function(){s&&(s.style.display=this.checked?"block":"none")}),document.querySelectorAll('input[name="task-naming"]').forEach(p=>{p.addEventListener("change",function(){i&&(i.disabled=this.value!=="prefix"),c&&(c.disabled=this.value!=="suffix"),this.value==="prefix"&&i?setTimeout(()=>i.focus(),100):this.value==="suffix"&&c&&setTimeout(()=>c.focus(),100)})})}function oc(){document.getElementById("project-duplicate-modal").classList.remove("active"),hs=null}async function gu(){let e=hs;if(!e)return;let t=N.find(r=>r.id===e);if(!t)return;let a=document.getElementById("duplicate-tasks-checkbox"),n=a&&a.checked,o=r=>r;if(n){let r=document.querySelector('input[name="task-naming"]:checked')?.value||"none";if(r==="prefix"){let i=document.getElementById("task-prefix-input")?.value||"";i&&(o=c=>`${i}${c}`)}else if(r==="suffix"){let i=document.getElementById("task-suffix-input")?.value||"";i&&(o=c=>`${c}${i}`)}}let s={id:pt,name:`Copy - ${t.name}`,description:t.description||"",startDate:t.startDate||"",endDate:t.endDate||"",tags:t.tags?[...t.tags]:[],createdAt:new Date().toISOString()};pt++,N.push(s),n&&C.filter(i=>i.projectId===e).forEach(i=>{let c={...i,id:at,title:o(i.title),projectId:s.id,createdAt:new Date().toISOString(),tags:i.tags?[...i.tags]:[],attachments:i.attachments?JSON.parse(JSON.stringify(i.attachments)):[]};at++,C.push(c)}),window.historyService&&window.historyService.recordProjectCreated(s),oc(),te.projectsSortedView=null,Xe(n?d("projects.duplicate.successWithTasks",{name:s.name}):d("projects.duplicate.success",{name:s.name})),Promise.all([nt().catch(r=>{console.error("Failed to save projects:",r),W(d("error.saveChangesFailed"))}),n?_e().catch(r=>{console.error("Failed to save tasks:",r),W(d("error.saveChangesFailed"))}):Promise.resolve()]),Be(s.id,"projects")}function hu(){document.getElementById("project-details").classList.remove("active");let e=document.querySelector(".user-menu");e&&(e.style.display="block");try{window.location.hash="#projects"}catch{}ze("projects"),document.querySelectorAll(".nav-item").forEach(t=>t.classList.remove("active")),document.querySelector('.nav-item[data-page="projects"]').classList.add("active"),Ve()}function yu(){document.getElementById("project-details").classList.remove("active");let e=document.querySelector(".user-menu");if(e&&(e.style.display="block"),Et&&Number.isInteger(Et.month)&&Number.isInteger(Et.year)){we=Et.month,Se=Et.year;try{ms()}catch{}}Va(),re()}function vu(e){eo();let t=document.getElementById("task-modal"),a=t.querySelector("#hidden-project"),n=t.querySelector("#project-current .project-text"),o=N.find(s=>String(s.id)===String(e));if(a&&(a.value=String(e||"")),n&&o){let s=`<span style="display: inline-block; width: 10px; height: 10px; background-color: ${Ie(o.id)}; border-radius: 2px; margin-right: 8px; vertical-align: middle;"></span>`;n.innerHTML=s+q(o.name)}typeof xt=="function"&&xt(),setTimeout(()=>vc(),150)}function bu(){let e=document.getElementById("settings-modal");if(!e)return;let t=e.querySelector("#settings-form"),a=t.querySelector("#user-name"),n=t.querySelector("#auto-start-date-toggle"),o=t.querySelector("#auto-end-date-toggle"),s=t.querySelector("#enable-review-status-toggle"),r=t.querySelector("#calendar-include-backlog-toggle"),i=t.querySelector("#debug-logs-toggle"),c=t.querySelector("#history-sort-order"),l=t.querySelector("#language-select"),p=window.authSystem?.getCurrentUser();a.value=p?.name||"";let u=t.querySelector("#user-email");u.value=p?.email||F.notificationEmail||"";let f=t.querySelector("#email-notifications-enabled"),m=t.querySelector("#email-notifications-weekdays-only"),g=t.querySelector("#email-notifications-include-start-dates"),h=t.querySelector("#email-notifications-include-backlog"),k=t.querySelector("#email-notification-time"),v=t.querySelector("#email-notification-time-trigger"),L=t.querySelector("#email-notification-time-value"),S=t.querySelector("#email-notification-timezone"),j=t.querySelector("#email-notification-timezone-trigger"),w=t.querySelector("#email-notification-timezone-value"),D=t.querySelector("#email-notification-details");if(f&&(f.checked=F.emailNotificationsEnabled!==!1),m&&(m.checked=!!F.emailNotificationsWeekdaysOnly),g&&(g.checked=!!F.emailNotificationsIncludeStartDates),h&&(h.checked=!!F.emailNotificationsIncludeBacklog),k){let Y=wo(Pa(F.emailNotificationTime)||"09:00",30);k.value=So(Y||"09:00","08:00","18:00")||"09:00",L&&(L.textContent=k.value)}S&&(S.value=String(F.emailNotificationTimeZone||"Atlantic/Canary"),w&&(w.textContent=S.options?.[S.selectedIndex]?.textContent||S.value||""));let E=()=>{let Y=!!f?.checked;D&&(D.classList.toggle("is-collapsed",!Y),D.setAttribute("aria-hidden",Y?"false":"true")),m&&(m.disabled=!Y),g&&(g.disabled=!Y),k&&(k.disabled=!Y),v&&(v.disabled=!Y),S&&(S.disabled=!Y),j&&(j.disabled=!Y)};E(),n&&(n.checked=!!F.autoSetStartDateOnStatusChange),o&&(o.checked=!!F.autoSetEndDateOnStatusChange),s&&(s.checked=!!F.enableReviewStatus),r&&(r.checked=!!F.calendarIncludeBacklog),i&&(i.checked=!!F.debugLogsEnabled),c.value=F.historySortOrder,l&&(l.value=Mt());let T=t.querySelector("#workspace-logo-input");T&&(T.value=""),et.hasPendingChange=!1,et.dataUrl=null,tt.hasPendingChange=!1,tt.dataUrl=null;let A=t.querySelector("#workspace-logo-preview"),z=t.querySelector("#workspace-logo-clear-btn");A&&z&&(F.customWorkspaceLogo?(A.style.display="block",A.style.backgroundImage=`url(${F.customWorkspaceLogo})`,z.style.display="inline-flex"):(A.style.display="none",A.style.backgroundImage="",z.style.display="none"));let H=new CustomEvent("refresh-workspace-logo-ui");document.dispatchEvent(H);let b=t.querySelector("#user-avatar-input");b&&(b.value=""),ha(),window.initialSettingsFormState={userName:a.value||"",notificationEmail:u.value||"",emailNotificationsEnabled:!!f?.checked,emailNotificationsWeekdaysOnly:!!m?.checked,emailNotificationsIncludeStartDates:!!g?.checked,emailNotificationsIncludeBacklog:!!h?.checked,emailNotificationTime:k?.value||"",emailNotificationTimeZone:S?.value||"",autoSetStartDateOnStatusChange:!!F.autoSetStartDateOnStatusChange,autoSetEndDateOnStatusChange:!!F.autoSetEndDateOnStatusChange,enableReviewStatus:!!F.enableReviewStatus,calendarIncludeBacklog:!!r?.checked,debugLogsEnabled:!!i?.checked,historySortOrder:F.historySortOrder||"newest",language:Mt(),logoState:F.customWorkspaceLogo?"logo-set":"logo-none",avatarState:window.authSystem?.getCurrentUser?.()?.avatarDataUrl?"avatar-set":"avatar-none"};let B=t.querySelector(".settings-btn-save");if(B&&(B.classList.remove("dirty"),B.disabled=!0),!t.__settingsDirtyBound){t.__settingsDirtyBound=!0;let Y=()=>{if(!window.initialSettingsFormState)return;let K=et.hasPendingChange?"draft-changed":F.customWorkspaceLogo?"logo-set":"logo-none",x=tt.hasPendingChange?"draft-changed":window.authSystem?.getCurrentUser?.()?.avatarDataUrl?"avatar-set":"avatar-none",P={userName:a.value||"",notificationEmail:u.value||"",emailNotificationsEnabled:!!f?.checked,emailNotificationsWeekdaysOnly:!!m?.checked,emailNotificationsIncludeStartDates:!!g?.checked,emailNotificationsIncludeBacklog:!!h?.checked,emailNotificationTime:k?.value||"",emailNotificationTimeZone:S?.value||"",autoSetStartDateOnStatusChange:!!n?.checked,autoSetEndDateOnStatusChange:!!o?.checked,enableReviewStatus:!!s?.checked,calendarIncludeBacklog:!!r?.checked,debugLogsEnabled:!!i?.checked,historySortOrder:c.value,language:l?.value||Mt(),logoState:K,avatarState:x},I=P.userName!==window.initialSettingsFormState.userName||P.notificationEmail!==window.initialSettingsFormState.notificationEmail||P.emailNotificationsEnabled!==window.initialSettingsFormState.emailNotificationsEnabled||P.emailNotificationsWeekdaysOnly!==window.initialSettingsFormState.emailNotificationsWeekdaysOnly||P.emailNotificationsIncludeBacklog!==window.initialSettingsFormState.emailNotificationsIncludeBacklog||P.emailNotificationsIncludeStartDates!==window.initialSettingsFormState.emailNotificationsIncludeStartDates||P.emailNotificationTime!==window.initialSettingsFormState.emailNotificationTime||P.emailNotificationTimeZone!==window.initialSettingsFormState.emailNotificationTimeZone||P.autoSetStartDateOnStatusChange!==window.initialSettingsFormState.autoSetStartDateOnStatusChange||P.autoSetEndDateOnStatusChange!==window.initialSettingsFormState.autoSetEndDateOnStatusChange||P.enableReviewStatus!==window.initialSettingsFormState.enableReviewStatus||P.calendarIncludeBacklog!==window.initialSettingsFormState.calendarIncludeBacklog||P.debugLogsEnabled!==window.initialSettingsFormState.debugLogsEnabled||P.historySortOrder!==window.initialSettingsFormState.historySortOrder||P.language!==window.initialSettingsFormState.language||P.logoState!==window.initialSettingsFormState.logoState||P.avatarState!==window.initialSettingsFormState.avatarState;B&&(I?(B.classList.add("dirty"),B.disabled=!1):(B.classList.remove("dirty"),B.disabled=!0)),window.settingsFormIsDirty=I};window.markSettingsDirtyIfNeeded=Y,[a,u,f,m,h,g,k,S,n,o,s,r,i,c,l,T,b].filter(Boolean).forEach(K=>{K.addEventListener("change",Y),(K.tagName==="INPUT"&&K.type==="text"||K.type==="email")&&K.addEventListener("input",Y)}),f&&!f.__emailInputsBound&&(f.__emailInputsBound=!0,f.addEventListener("change",()=>{E()})),v&&!v.__notificationTimeBound&&(v.__notificationTimeBound=!0,v.addEventListener("click",K=>{if(K.preventDefault(),K.stopPropagation(),!!!f?.checked)return;if(Ee&&Ee.style.display!=="none"){ka();return}Xl(v,k,L)})),j&&S&&!j.__notificationTimeZoneBound&&(j.__notificationTimeZoneBound=!0,j.addEventListener("click",K=>{if(K.preventDefault(),K.stopPropagation(),!!!f?.checked)return;if(ve&&ve.style.display!=="none"){ba();return}Zl(j,S,w)})),S&&w&&!S.__timezoneValueBound&&(S.__timezoneValueBound=!0,S.addEventListener("change",()=>{w.textContent=S.options?.[S.selectedIndex]?.textContent||S.value||""}))}e.classList.add("active");let _=e.querySelector(".settings-modal-body");_&&(_.scrollTop=0);let G=e.querySelector("#reset-pin-btn");G&&!G.dataset.listenerAttached&&(G.dataset.listenerAttached="true",G.addEventListener("click",function(Y){Y.preventDefault(),Fd()}))}function tn(){let e=document.getElementById("shared-user-dropdown");e&&e.classList.remove("active")}function sc(){let e=document.getElementById("shared-user-avatar"),t=document.getElementById("shared-user-dropdown");if(e&&t){let a=e.cloneNode(!0);e.parentNode.replaceChild(a,e),a.addEventListener("click",function(n){n.stopPropagation(),Ot(),t.classList.toggle("active")}),t.addEventListener("click",function(n){n.target.closest(".dropdown-item:not(.disabled)")&&tn()})}}function ys(e,t){let a=document.querySelector(".user-name"),n=document.getElementById("shared-user-avatar");if(a&&(a.textContent=e),n){let o=e.split(" ").filter(Boolean),s="NL";o.length>0&&(o.length===1?s=o[0].slice(0,2).toUpperCase():s=(o[0][0]+o[o.length-1][0]).toUpperCase()),t?(n.classList.add("has-image"),n.style.backgroundImage=`url(${t})`,n.textContent=""):(n.classList.remove("has-image"),n.style.backgroundImage="",n.textContent=s)}}function ku(){let e=window.authSystem?.getCurrentUser();if(!e)return;ys(e.name,e.avatarDataUrl);let t=document.querySelector(".user-email");t&&(t.textContent=e.email||e.username)}function tf(){let e=document.querySelector('#task-modal [data-action="addAttachment"]');e&&(e.textContent=d("tasks.modal.addLink"))}document.addEventListener("click",function(e){e.target.closest(".user-menu")||tn(),e.target.closest(".notify-menu")||Ot()});function rc(){let t=document.documentElement.getAttribute("data-theme")==="dark"?"Nautilus_logo.png":"Nautilus_logo_light.png";document.querySelectorAll('img.logo, img[class*="boot-logo"]').forEach(a=>{a.closest(".overlay")||a.closest(".auth-overlay")||(a.src=t)})}function vs(){let e=document.getElementById("theme-text");if(!e)return;let t=document.documentElement.getAttribute("data-theme")==="dark";e.textContent=d(t?"menu.lightMode":"menu.darkMode")}function wu(){let e=document.documentElement;e.getAttribute("data-theme")==="dark"?(e.removeAttribute("data-theme"),localStorage.setItem("theme","light")):(e.setAttribute("data-theme","dark"),localStorage.setItem("theme","dark")),vs(),rc(),typeof Wa=="function"&&Wa()}var Su=localStorage.getItem("theme");Su==="dark"&&document.documentElement.setAttribute("data-theme","dark");vs();rc();var Hn=!1;document.querySelector(".resizer").addEventListener("mousedown",function(e){Hn=!0,this.classList.add("dragging"),document.body.style.cursor="col-resize",document.body.style.userSelect="none",e.preventDefault()});document.addEventListener("mousemove",function(e){if(!Hn)return;let t=document.querySelector(".sidebar"),a=e.clientX;a>=200&&a<=500&&(t.style.width=a+"px")});document.addEventListener("mouseup",function(){Hn&&(Hn=!1,document.querySelector(".resizer").classList.remove("dragging"),document.body.style.cursor="",document.body.style.userSelect="")});function aa(e,t,a,n){let s=(n||{}).render!==!1,r=a;(t==="startDate"||t==="endDate")&&Me(a)&&(r=Ye(a));let i=N.find(p=>p.id===e),c=i?JSON.parse(JSON.stringify(i)):null;if(i){let p=i[t];if((typeof p=="string"?p:p||"")===(typeof r=="string"?r:r||""))return}let l=Js(e,t,r,N);if(l.project){N=l.projects;let p=l.project;p.updatedAt=new Date().toISOString(),te.projectsSortedView=null,window.historyService&&c&&window.historyService.recordProjectUpdated(c,p),s&&Be(e),document.getElementById("calendar-view")?.classList.contains("active")&&Wa(),nt().catch(u=>{console.error("Failed to save project field:",u),W(d("error.saveChangesFailed"))})}}window.updateProjectField=aa;window.debouncedUpdateProjectField=typeof Qr=="function"?Qr:void 0;window.flushDebouncedProjectField=typeof ei=="function"?ei:void 0;function af(){document.getElementById("calendar-view")?.classList.contains("active")&&re()}function Va(){let e=document.getElementById("tasks")?.classList.contains("active")&&document.getElementById("calendar-view")?.classList.contains("active");window.location.hash!=="#calendar"&&(window.location.hash="calendar"),document.getElementById("tasks")?.classList.contains("active")||ze("tasks"),document.querySelectorAll(".nav-item").forEach(c=>c.classList.remove("active")),document.querySelector(".nav-item.calendar-nav").classList.add("active");let t=document.querySelector(".view-toggle");t&&t.classList.add("hidden");let a=document.getElementById("kanban-settings-btn")?.parentElement;a&&(a.style.display="none");let n=document.getElementById("backlog-quick-btn");n&&(n.style.display="none");let o=document.querySelector(".kanban-board"),s=document.getElementById("list-view"),r=document.getElementById("calendar-view");o&&!o.classList.contains("hidden")&&o.classList.add("hidden"),s&&s.classList.contains("active")&&s.classList.remove("active"),r&&!r.classList.contains("active")&&r.classList.add("active");try{document.querySelector(".kanban-header")?.classList.add("calendar-mode")}catch{}let i=document.querySelector("#tasks .page-title");i&&(i.textContent="Calendar"),e?Wa():re();try{yt()}catch{}}function Wa(){document.getElementById("calendar-view")?.classList.contains("active")&&requestAnimationFrame(()=>requestAnimationFrame(Ua))}function nf(){let e=!1;C.forEach(t=>{t.startDate&&Me(t.startDate)&&(t.startDate=Ye(t.startDate),e=!0),t.endDate&&Me(t.endDate)&&(t.endDate=Ye(t.endDate),e=!0)}),N.forEach(t=>{t.startDate&&Me(t.startDate)&&(t.startDate=Ye(t.startDate),e=!0),t.endDate&&Me(t.endDate)&&(t.endDate=Ye(t.endDate),e=!0)}),e&&$l()}async function bs(){let e=document.querySelector('input[name="feedback-type"]:checked'),t=e?e.value:"bug",a=document.getElementById("feedback-description").value.trim(),n=ya||"";if(!a)return;let o={id:Ht++,type:t,description:a,screenshotUrl:n,createdAt:new Date().toISOString().split("T")[0],status:"open"};oe.unshift(o),Ke.unshift(o.id),Bn++,document.getElementById("feedback-description").value="",ic(),Ae(),mt(),ns({action:"add",item:o}),Za()}document.addEventListener("DOMContentLoaded",function(){let e=document.getElementById("feedback-type-btn"),t=document.getElementById("feedback-type-group"),a=document.getElementById("feedback-type-label");vt(),window.addEventListener("online",()=>{vt(),as(0)}),window.addEventListener("offline",vt),e&&t&&(e.addEventListener("click",function(f){f.stopPropagation(),t.classList.toggle("open")}),document.querySelectorAll('input[name="feedback-type"]').forEach(f=>{f.addEventListener("change",function(){let g={bug:d("feedback.type.bugLabel"),idea:d("feedback.type.improvementOption")}[this.value]||this.closest("label").textContent.trim();a.textContent=g,t.classList.remove("open")})}),document.addEventListener("click",function(f){t.contains(f.target)||t.classList.remove("open")}));let n=document.getElementById("feedback-description");n&&(n.addEventListener("keypress",function(u){u.key==="Enter"&&(u.preventDefault(),bs())}),n.addEventListener("paste",function(u){if(!u.clipboardData)return;let f=Array.from(u.clipboardData.files||[])[0];f&&f.type&&f.type.startsWith("image/")&&(u.preventDefault(),ci(f))}));let o=document.getElementById("feedback-screenshot-url"),s=document.getElementById("feedback-screenshot-file"),r=document.getElementById("feedback-screenshot-upload"),i=typeof window.matchMedia=="function"?window.matchMedia("(max-width: 768px)").matches:window.innerWidth<=768,c=d(i?"feedback.screenshotDropzoneTap":"feedback.screenshotDropzoneDefault");o&&(o.textContent=c,o.classList.add("feedback-screenshot-dropzone"),o.dataset.defaultText=c);let l=document.getElementById("feedback-screenshot-preview");if(!l){let u=document.querySelector("#feedback .feedback-input-bar");u&&u.parentNode&&(l=document.createElement("div"),l.id="feedback-screenshot-preview",u.parentNode.insertBefore(l,u.nextSibling))}function p(u,f){if(!u||u.length===0)return;let m=u[0];if(!m.type||!m.type.startsWith("image/")){typeof W=="function"&&W(d("error.feedbackAttachImage"));return}f&&(f.preventDefault(),f.stopPropagation()),ci(m)}o&&(o.addEventListener("dragover",function(u){u.preventDefault(),o.classList.add("feedback-screenshot-dragover")}),o.addEventListener("dragleave",function(u){u.preventDefault(),o.classList.remove("feedback-screenshot-dragover")}),o.addEventListener("drop",function(u){o.classList.remove("feedback-screenshot-dragover");let f=u.dataTransfer&&u.dataTransfer.files;p(f,u)}),o.addEventListener("paste",function(u){if(!u.clipboardData)return;let f=u.clipboardData.files;f&&f.length>0&&p(f,u)}),o.addEventListener("click",function(){s&&s.click()}),o.addEventListener("keydown",function(u){(u.key==="Enter"||u.key===" ")&&(u.preventDefault(),s&&s.click())})),r&&(r.style.display="none"),s&&s.addEventListener("change",function(u){let f=u.target.files;f&&f.length>0&&p(f,u),s.value=""})});function ci(e){if(!e||!e.type||!e.type.startsWith("image/"))return;let t=new FileReader;t.onload=function(a){let n=a.target&&a.target.result;if(!n)return;ya=n;let o=document.getElementById("feedback-screenshot-url");o&&o.dataset&&(o.dataset.hasInlineImage="true");let s=document.getElementById("feedback-screenshot-preview");if(s){s.innerHTML=`
                <div class="feedback-screenshot-preview-card">
                    <div class="feedback-screenshot-thumb">
                        <img src="${n}" alt="${d("feedback.screenshotPreviewAlt")}">
                    </div>
                    <div class="feedback-screenshot-meta">
                        <div class="feedback-screenshot-title">${d("feedback.screenshotPreviewTitle")}</div>
                        <div class="feedback-screenshot-subtitle">${d("feedback.screenshotPreviewSubtitle")}</div>
                    </div>
                    <button type="button" class="feedback-screenshot-remove">${d("feedback.screenshotRemove")}</button>
                </div>
            `,s.style.display="flex";let r=s.querySelector(".feedback-screenshot-thumb");r&&typeof Ga=="function"&&(r.onclick=function(){Ga(n,"Feedback Screenshot")});let i=s.querySelector(".feedback-screenshot-remove");i&&(i.onclick=function(c){c.preventDefault(),ic()})}},t.onerror=function(){typeof W=="function"&&W(d("error.feedbackReadImage"))},t.readAsDataURL(e)}function ic(){ya="";let e=document.getElementById("feedback-screenshot-url");if(e){let a=e.dataset.defaultText||d("feedback.screenshotDropzoneDefault");e.textContent=a,e.dataset&&delete e.dataset.hasInlineImage}let t=document.getElementById("feedback-screenshot-preview");t&&(t.innerHTML="",t.style.display="none")}function Eu(e){let t=oe.find(s=>s.id===e);if(!t)return;let a=t.status,n=t.resolvedAt,o=++Bn;t.status==="open"?(t.status="done",t.resolvedAt=new Date().toISOString()):(t.status="open",delete t.resolvedAt),Ae(),mt(),ns({action:"update",item:{id:t.id,status:t.status,resolvedAt:t.resolvedAt||null}},{onError:()=>{Bn===o&&(t.status=a,n?t.resolvedAt=n:delete t.resolvedAt,Ae(),mt(),W(d("error.feedbackStatusFailed")))}}),Za()}function mt(){let e=document.getElementById("feedback-list-pending"),t=document.getElementById("feedback-list-done");if(!e||!t)return;let a={bug:"\u{1F41E}",improvement:"\u{1F4A1}",feature:"\u{1F4A1}",idea:"\u{1F4A1}"},n=oe.filter(m=>m.status==="open").sort((m,g)=>new Date(g.createdAt)-new Date(m.createdAt)),o=oe.filter(m=>m.status==="done").sort((m,g)=>new Date(g.resolvedAt||g.createdAt)-new Date(m.resolvedAt||m.createdAt)),s=Math.ceil(n.length/it);$t>s&&s>0&&($t=s);let r=($t-1)*it,i=r+it,c=n.slice(r,i),l=Math.ceil(o.length/it);Nt>l&&l>0&&(Nt=l);let p=(Nt-1)*it,u=p+it,f=o.slice(p,u);n.length===0?e.innerHTML=`<div class="empty-state" style="padding: 20px;"><p>${d("feedback.empty.pending")}</p></div>`:e.innerHTML=c.map(m=>`
            <div class="feedback-item ${m.status==="done"?"done":""}">
                <input type="checkbox" class="feedback-checkbox"
                       data-feedback-id="${m.id}"
                       ${m.status==="done"?"checked":""}>
                <span class="feedback-type-icon">${a[m.type]||"\u{1F4A1}"}</span>
                ${m.screenshotUrl?`<button type="button" class="feedback-screenshot-link" data-action="viewFeedbackScreenshot" data-param="${encodeURIComponent(m.screenshotUrl)}" title="${d("feedback.viewScreenshotTitle")}">\u{1F5BC}\uFE0F</button>`:""}
                <div class="feedback-description">${q(m.description)}</div>
                <div class="feedback-date">${pe(m.createdAt)}</div>
                <button class="feedback-delete-btn" data-action="deleteFeedbackItemWithStop" data-param="${m.id}">\u274C</button>
            </div>
        `).join(""),li("pending",n.length,s,$t),o.length===0?t.innerHTML=`<div class="empty-state" style="padding: 20px;"><p>${d("feedback.empty.done")}</p></div>`:t.innerHTML=f.map(m=>`
            <div class="feedback-item done">
                <input type="checkbox" class="feedback-checkbox"
                       data-feedback-id="${m.id}"
                       checked>
                <span class="feedback-type-icon">${a[m.type]||"\u{1F4A1}"}</span>
                ${m.screenshotUrl?`<button type="button" class="feedback-screenshot-link" data-action="viewFeedbackScreenshot" data-param="${encodeURIComponent(m.screenshotUrl)}" title="${d("feedback.viewScreenshotTitle")}">\u{1F5BC}\uFE0F</button>`:""}
                <div class="feedback-description">${q(m.description)}</div>
                <div class="feedback-date">${pe(m.createdAt)}</div>
                <button class="feedback-delete-btn" data-action="deleteFeedbackItemWithStop" data-param="${m.id}">\u274C</button>
            </div>
        `).join(""),li("done",o.length,l,Nt)}function li(e,t,a,n){let o=e==="pending"?"feedback-pagination-pending":"feedback-pagination-done",s=document.getElementById(o);if(!s)return;if(a<=1){s.innerHTML="",s.style.display="none";return}s.style.display="flex";let r=(n-1)*it+1,i=Math.min(n*it,t),c=`
        <div class="feedback-pagination-info">
            ${d("feedback.pagination.showing",{start:r,end:i,total:t})}
        </div>
        <div class="feedback-pagination-controls">
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${e}', 1)"
                ${n===1?"disabled":""}
                title="${d("feedback.pagination.first")}">
                &laquo;
            </button>
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${e}', ${n-1})"
                ${n===1?"disabled":""}
                title="${d("feedback.pagination.prev")}">
                &lsaquo;
            </button>
            <span class="feedback-pagination-page">
                ${d("feedback.pagination.pageOf",{current:n,total:a})}
            </span>
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${e}', ${n+1})"
                ${n===a?"disabled":""}
                title="${d("feedback.pagination.next")}">
                &rsaquo;
            </button>
            <button
                class="feedback-pagination-btn"
                onclick="changeFeedbackPage('${e}', ${a})"
                ${n===a?"disabled":""}
                title="${d("feedback.pagination.last")}">
                &raquo;
            </button>
        </div>
    `;s.innerHTML=c}function Du(e,t){let a=document.querySelector("#feedback .page-content"),n=document.activeElement,o=!!(n&&n.classList&&n.classList.contains("feedback-pagination-btn")),s=!!(a&&a.scrollHeight-(a.scrollTop+a.clientHeight)<80);e==="pending"?$t=t:Nt=t,mt();let r=e==="pending"?"feedback-pagination-pending":"feedback-pagination-done",c=o||s?r:e==="pending"?"feedback-list-pending":"feedback-list-done",l=document.getElementById(c);l&&requestAnimationFrame(()=>{requestAnimationFrame(()=>{l.scrollIntoView({behavior:"smooth",block:c===r?"end":"start"})})})}window.changeFeedbackPage=Du;function Tu(){document.querySelectorAll(".modal-content .modal-tab").forEach(e=>{e.addEventListener("click",t=>{let a=t.target.dataset.tab,n=t.target.closest(".modal-content");if(!n)return;try{if(!!n.closest("#task-modal")){let r=n.querySelector("#task-footer");if(r&&window.getComputedStyle(r).display==="none")if(a==="history"){let c=Math.round(n.getBoundingClientRect().height);c>0&&(n.style.minHeight=`${c}px`,n.style.maxHeight=`${c}px`)}else(a==="general"||a==="details")&&(n.style.minHeight="",n.style.maxHeight="")}}catch{}if(n.querySelectorAll(".modal-tab").forEach(s=>s.classList.remove("active")),t.target.classList.add("active"),a==="general"||a==="details"){let s=n.querySelector("#task-details-tab"),r=n.querySelector("#task-history-tab");if(s&&r){n.querySelectorAll(".modal-tab-content").forEach(i=>{i.classList.remove("active")}),s.classList.add("active"),a==="details"?document.body.classList.add("mobile-tab-details-active"):document.body.classList.remove("mobile-tab-details-active");return}}document.body.classList.remove("mobile-tab-details-active"),n.querySelectorAll(".modal-tab-content").forEach(s=>{s.classList.remove("active")});let o=n.querySelector(`#task-${a}-tab`);if(o&&(o.classList.add("active"),a==="history")){let r=document.getElementById("task-form")?.dataset.editingTaskId;r&&Yo(parseInt(r));let i=document.querySelector(".task-history-container");i&&(i.scrollTop=0)}})})}function Yo(e){if(!window.historyService||!C.find(r=>r.id===e))return;let a=window.historyService.getEntityHistory("task",e),n=document.getElementById("task-history-timeline"),o=document.getElementById("task-history-empty");if(!n)return;if(a.length===0){n.innerHTML="",o&&(o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.padding="48px 20px");return}o&&(o.style.display="none"),F.historySortOrder==="oldest"&&(a=[...a].reverse());let s=document.getElementById("history-sort-toggle");if(s)s.innerHTML=F.historySortOrder==="newest"?d("history.sort.newest"):d("history.sort.oldest");else{let r=n.parentElement;s=document.createElement("button"),s.id="history-sort-toggle",s.className="history-sort-toggle",s.innerHTML=F.historySortOrder==="newest"?d("history.sort.newest"):d("history.sort.oldest"),s.onclick=()=>cc("task",e),r.insertBefore(s,n)}n.innerHTML=a.map(r=>lc(r)).join("")}function cc(e,t){if(F.historySortOrder=F.historySortOrder==="newest"?"oldest":"newest",is(),e==="task"&&t)Yo(t);else if(e==="project"&&t)Ko(t);else{let n=document.getElementById("task-form")?.dataset.editingTaskId;n&&Yo(parseInt(n));let o=document.getElementById("project-details");if(o&&o.classList.contains("active")){let s=o.innerHTML.match(/renderProjectHistory\((\d+)\)/);s&&Ko(parseInt(s[1]))}}}function Ko(e){if(!window.historyService||!N.find(r=>r.id===e))return;let a=window.historyService.getEntityHistory("project",e),n=document.getElementById(`project-history-timeline-${e}`),o=document.getElementById(`project-history-empty-${e}`);if(!n)return;if(a.length===0){n.innerHTML="",o&&(o.style.display="flex",o.style.flexDirection="column",o.style.alignItems="center",o.style.padding="48px 20px");return}o&&(o.style.display="none"),F.historySortOrder==="oldest"&&(a=[...a].reverse());let s=document.getElementById(`project-history-sort-toggle-${e}`);if(s)s.innerHTML=F.historySortOrder==="newest"?d("history.sort.newest"):d("history.sort.oldest");else{let r=n.parentElement;s=document.createElement("button"),s.id=`project-history-sort-toggle-${e}`,s.className="history-sort-toggle",s.innerHTML=F.historySortOrder==="newest"?d("history.sort.newest"):d("history.sort.oldest"),s.onclick=()=>cc("project",e),r.insertBefore(s,n)}n.innerHTML=a.map(r=>lc(r)).join("")}function lc(e){let t={created:"\u2728",updated:"",deleted:"\u{1F5D1}\uFE0F"},a={created:"var(--accent-green)",updated:"var(--text-secondary)",deleted:"var(--accent-red)"},n=new Date(e.timestamp).toLocaleString(It(),{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",hour12:!1}),o=Object.entries(e.changes),s=o.length,r={title:d("history.field.title"),name:d("history.field.name"),description:d("history.field.description"),status:d("history.field.status"),priority:d("history.field.priority"),category:d("history.field.category"),startDate:d("history.field.startDate"),endDate:d("history.field.endDate"),link:d("history.field.link"),task:d("history.field.task"),projectId:d("history.field.projectId"),tags:d("history.field.tags"),attachments:d("history.field.attachments")};return`
        <div class="history-entry-inline">
            <div class="history-entry-header-inline">
                ${t[e.action]?`<span class="history-action-icon" style="color: ${a[e.action]};">${t[e.action]}</span>`:""}
                ${e.action==="created"||e.action==="deleted"?`<span class="history-action-label-inline" style="color: ${a[e.action]};">${e.action.charAt(0).toUpperCase()+e.action.slice(1)}</span>`:""}
                <span class="history-time-inline">${n}</span>
            </div>

            ${s>0?`
                <div class="history-changes-compact">
                    ${o.map(([i,{before:c,after:l}])=>{let p=r[i]||i;if(i==="link"||i==="task"){let m=l&&typeof l=="object"?l.action:"",g=(l&&typeof l=="object"?l.entity:null)||"task",h=l&&typeof l=="object"?l.title||l.id||d("tasks.table.task"):String(l),k=m==="removed"?"\u274C":"\u2795",v=d(m==="removed"?"history.link.removed":"history.link.added"),L=g==="task"?d("history.entity.task"):g,S=`${k} ${v} ${L} "${h}"`;return`
                                <div class="history-change-compact history-change-compact--single">
                                    <span class="change-field-label">${p}:</span>
                                    <span class="change-after-compact">${q(S)}</span>
                                </div>
                            `}if(i==="description"){let m=c?c.replace(/<[^>]*>/g,"").trim():"",g=l?l.replace(/<[^>]*>/g,"").trim():"";return`
                                <div class="history-change-description">
                                    <div class="change-field-label">${p}:</div>
                                    <div class="description-diff">
                                        ${m?`<div class="description-before"><s>${q(m)}</s></div>`:`<div class="description-before"><em style="opacity: 0.6;">${d("history.value.empty")}</em></div>`}
                                        ${g?`<div class="description-after">${q(g)}</div>`:`<div class="description-after"><em style="opacity: 0.6;">${d("history.value.empty")}</em></div>`}
                                    </div>
                                </div>
                            `}let u=di(i,c,!0),f=di(i,l,!1);return`
                            <div class="history-change-compact">
                                <span class="change-field-label">${p}:</span>
                                ${u!==null?`<span class="change-before-compact">${u}</span>`:'<span class="change-null">\u2014</span>'}
                                <span class="change-arrow-compact">${d("history.change.arrow")}</span>
                                ${f!==null?`<span class="change-after-compact">${f}</span>`:'<span class="change-null">\u2014</span>'}
                            </div>
                        `}).join("")}
                </div>
            `:""}
        </div>
    `}function di(e,t,a=!1){if(t==null)return null;if(t==="")return`<em style="opacity: 0.7;">${d("history.value.empty")}</em>`;if(e==="startDate"||e==="endDate"){let o=pe(t);return a?`<span style="opacity: 0.7;">${o}</span>`:o}if(e==="link"||e==="task"){let o=t&&typeof t=="object"?t.action:"",s=(t&&typeof t=="object"?t.entity:null)||"task",r=t&&typeof t=="object"?t.title||t.id||d("tasks.table.task"):String(t),i=o==="removed"?"\u274C":"\u2795",c=d(o==="removed"?"history.link.removed":"history.link.added"),l=s==="task"?d("history.entity.task"):s,p=`${i} ${c} ${l} "${r}"`;return a?`<span style="opacity: 0.7;">${q(p)}</span>`:q(p)}if(e==="status"){let o=We(t).toUpperCase();return`<span style="background: ${{backlog:"#4B5563",todo:"#186f95",progress:"var(--accent-blue)",review:"var(--accent-amber)",done:"var(--accent-green)"}[t]||"#4B5563"}; color: white; padding: 2px 8px; border-radius: 12px; font-size: 11.5px; font-weight: 600; text-transform: uppercase;">${q(o)}</span>`}if(e==="priority"){let o=ot(t);return`<span style="color: ${yo[t]||"var(--text-secondary)"}; font-weight: 600; font-size: 12px;">\u25CF</span> <span style="font-weight: 500;">${q(o)}</span>`}if(e==="projectId"){if(!t)return`<em style="opacity: 0.7;">${d("tasks.noProject")}</em>`;let o=N.find(r=>r.id===t),s=o?q(o.name):`#${t}`;return a?`<span style="opacity: 0.7;">${s}</span>`:s}if(e==="tags")return!Array.isArray(t)||t.length===0?`<em style="opacity: 0.7;">${d("history.value.none")}</em>`:t.slice(0,2).map(o=>`<span style="background-color: ${na(o)}; color: white; padding: 2px 6px; border-radius: 3px; font-size: 10px; font-weight: 500;">${q(o.toUpperCase())}</span>`).join(" ")+(t.length>2?" ...":"");if(e==="attachments"){if(!Array.isArray(t)||t.length===0)return`<em style="opacity: 0.7;">${d("history.value.none")}</em>`;let o=t.length===1?d("history.attachments.countSingle",{count:t.length}):d("history.attachments.countPlural",{count:t.length});return a?`<span style="opacity: 0.7;">${o}</span>`:o}if(e==="description"){let o=t.replace(/<[^>]*>/g,"").trim(),s=o.length>50?q(o.substring(0,50))+"...":q(o)||`<em>${d("history.value.empty")}</em>`;return a?`<span style="opacity: 0.7;">${s}</span>`:s}let n=q(String(t));return a?`<span style="opacity: 0.7;">${n}</span>`:n}function xu(e){let t=document.getElementById(`history-details-inline-${e}`),n=document.querySelector(`[data-action="toggleHistoryEntryInline"][data-param="${e}"]`)?.querySelector(".expand-icon-inline");if(t){let o=t.style.display!=="none";t.style.display=o?"none":"block",n&&(n.textContent=o?"\u25BC":"\u25B2")}}function of(e){let t={title:d("history.field.title"),name:d("history.field.name"),description:d("history.field.description"),status:d("history.field.status"),priority:d("history.field.priority"),category:d("history.field.category"),startDate:d("history.field.startDate"),endDate:d("history.field.endDate"),projectId:d("history.field.projectId"),tags:d("history.field.tags"),attachments:d("history.field.attachments")};return Object.entries(e).map(([a,{before:n,after:o}])=>{let s=t[a]||a,r=ui(a,n),i=ui(a,o);return`
            <div class="history-change">
                <div class="history-change-field">${s}</div>
                <div class="history-change-values">
                    <div class="history-change-before">
                        ${r!==null?`<span class="change-label">${d("history.change.beforeLabel")}</span> ${r}`:`<span class="change-label-null">${d("history.change.notSet")}</span>`}
                    </div>
                    <div class="history-change-arrow">${d("history.change.arrow")}</div>
                    <div class="history-change-after">
                        ${i!==null?`<span class="change-label">${d("history.change.afterLabel")}</span> ${i}`:`<span class="change-label-null">${d("history.change.removed")}</span>`}
                    </div>
                </div>
            </div>
        `}).join("")}function ui(e,t){if(t==null)return null;if(t==="")return`<em style="color: var(--text-muted);">${d("history.value.empty")}</em>`;if(e==="link"||e==="task"){let a=t&&typeof t=="object"?t.action:"",n=(t&&typeof t=="object"?t.entity:null)||"task",o=t&&typeof t=="object"?t.title||t.id||d("tasks.table.task"):String(t),s=a==="removed"?"\u274C":"\u2795",r=d(a==="removed"?"history.link.removed":"history.link.added"),i=n==="task"?d("history.entity.task"):n;return q(`${s} ${r} ${i} "${o}"`)}if(e==="startDate"||e==="endDate")return pe(t);if(e==="projectId"){if(!t)return`<em style="color: var(--text-muted);">${d("tasks.noProject")}</em>`;let a=N.find(n=>n.id===t);return a?q(a.name):d("history.project.fallback",{id:t})}if(e==="tags")return!Array.isArray(t)||t.length===0?`<em style="color: var(--text-muted);">${d("history.tags.none")}</em>`:t.map(a=>`<span class="history-tag">${q(a)}</span>`).join(" ");if(e==="attachments")return!Array.isArray(t)||t.length===0?`<em style="color: var(--text-muted);">${d("history.attachments.none")}</em>`:t.length===1?d("history.attachments.countSingle",{count:t.length}):d("history.attachments.countPlural",{count:t.length});if(e==="description"){let a=t.replace(/<[^>]*>/g,"").trim();return a.length>100?q(a.substring(0,100))+"...":q(a)||`<em style="color: var(--text-muted);">${d("history.value.empty")}</em>`}return q(String(t))}var za=null;function Iu(e){za=e,document.getElementById("feedback-delete-modal").classList.add("active")}function dc(){document.getElementById("feedback-delete-modal").classList.remove("active"),za=null}async function ju(){if(za!==null){let e=za;oe=oe.filter(t=>t.id!==za),Ke=Ke.filter(t=>t!==e),Bn++,dc(),Ae(),mt(),ns({action:"delete",targetId:e}),Za()}}document.addEventListener("click",function(e){let t=e.target.closest(".feedback-checkbox");if(t){let a=parseInt(t.dataset.feedbackId,10);a&&Eu(a)}});function Cu(e,t){document.getElementById("project-title-display").style.display="none",document.getElementById("project-title-edit").style.display="flex",document.getElementById("project-title-input").focus(),document.getElementById("project-title-input").select()}function Lu(e){let t=document.getElementById("project-title-input").value.trim();t?aa(e,"name",t):uc()}function uc(){document.getElementById("project-title-display").style.display="inline",document.getElementById("project-title-edit").style.display="none"}function Pu(){document.getElementById("kanban-tip").style.display="none",localStorage.setItem("kanban-tip-dismissed","true")}function Au(e){e.stopPropagation();let t=document.getElementById("project-options-menu");t&&(t.style.display=t.style.display==="block"?"none":"block")}document.addEventListener("click",function(e){let t=document.getElementById("project-options-menu");t&&!e.target.closest("#project-options-btn")&&!e.target.closest("#project-options-menu")&&(t.style.display="none")});document.addEventListener("DOMContentLoaded",function(){if(localStorage.getItem("kanban-tip-dismissed")==="true"){let e=document.getElementById("kanban-tip");e&&(e.style.display="none")}});async function Jo(){let e=document.getElementById("attachment-url"),t=document.getElementById("attachment-name"),a=e.value.trim();if(!a){e.style.border="2px solid var(--accent-red, #ef4444)",e.placeholder="URL is required",e.focus(),setTimeout(()=>{e.style.border="",e.placeholder="Paste link (Drive, Dropbox, etc.)"},2e3);return}e.style.border="";let n=document.getElementById("task-form").dataset.editingTaskId,o=t.value.trim()||"Attachment",s="\u{1F4C1}";if(!t.value.trim())try{let i=new URL(a),c=i.pathname.toLowerCase();if(i.hostname.includes("docs.google.com"))c.includes("/document/")?(o=d("tasks.attachments.googleDoc"),s="\u{1F4C4}"):c.includes("/spreadsheets/")?(o=d("tasks.attachments.googleSheet"),s="\u{1F4CA}"):c.includes("/presentation/")?(o=d("tasks.attachments.googleSlides"),s="\u{1F4D1}"):(o=d("tasks.attachments.googleDriveFile"),s="\u{1F5C2}\uFE0F");else if(i.hostname.includes("drive.google.com"))o=d("tasks.attachments.googleDriveFile"),s="\u{1F5C2}\uFE0F";else if(c.endsWith(".pdf"))o=c.split("/").pop()||d("tasks.attachments.pdf"),s="\u{1F4D5}";else if(c.endsWith(".doc")||c.endsWith(".docx"))o=c.split("/").pop()||d("tasks.attachments.word"),s="\u{1F4DD}";else if(c.endsWith(".xls")||c.endsWith(".xlsx"))o=c.split("/").pop()||d("tasks.attachments.excel"),s="\u{1F4CA}";else if(c.endsWith(".ppt")||c.endsWith(".pptx"))o=c.split("/").pop()||d("tasks.attachments.powerpoint"),s="\u{1F4D1}";else{let l=c.split("/").pop();o=l&&l.length>0?l:i.hostname,s="\u{1F4C1}"}}catch{o=a.substring(0,30),s="\u{1F4C1}"}s="\u{1F310}";let r={name:o,icon:s,type:"link",url:a,addedAt:new Date().toISOString()};if(n){let i=C.find(c=>c.id===parseInt(n));if(!i)return;i.attachments||(i.attachments=[]),i.attachments.push(r),Vt(i.attachments),wa(),_e().catch(c=>{console.error("Failed to save attachment:",c),W(d("error.attachmentSaveFailed"))})}else $e.push(r),Vt($e);e.value="",t.value=""}async function Vt(e){let t=document.getElementById("attachments-files-list"),a=document.getElementById("attachments-links-list");if(t&&a){await Bu(e,t,a);return}let n=document.getElementById("attachments-list");if(!n)return;if(!e||e.length===0){n.innerHTML=`<div style="color: var(--text-muted); font-size: 13px; padding: 8px 0;">${d("tasks.attachments.none")}</div>`;return}let o=s=>{if(!s)return"";try{let r=/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(s);return(new URL(r?s:`https://${s}`).host||s).replace(/^www\./,"")}catch{return s}};n.innerHTML=e.map((s,r)=>{let i=s.size?Math.round(s.size/1024):0,c=i>1024?`${(i/1024).toFixed(1)} MB`:`${i} KB`;if(s.type==="file"&&s.fileKey){let l=s.fileType==="image",p=`<div id="thumbnail-${s.fileKey}" class="attachment-thumb" aria-hidden="true">${s.icon}</div>`,u=l?"viewFile":"downloadFileAttachment",f=l?`data-param="${s.fileKey}" data-param2="${q(s.name)}" data-param3="${s.fileType}"`:`data-param="${s.fileKey}" data-param2="${q(s.name)}" data-param3="${s.mimeType}"`;return`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="${u}" ${f}>
                        ${p}
                        <span class="attachment-name">${q(s.name)} <span class="attachment-meta">&middot; ${c}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${r}" aria-label="${d("tasks.attachments.remove")}" title="${d("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `}else return s.type==="image"&&s.data?`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="viewImageLegacy" data-param="${s.data}" data-param2="${q(s.name)}">
                        <span class="attachment-thumb" aria-hidden="true"><img src="${s.data}" alt=""></span>
                        <span class="attachment-name">${q(s.name)} <span class="attachment-meta">&middot; ${c}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${r}" aria-label="${d("tasks.attachments.remove")}" title="${d("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `:`
                <div class="attachment-item" style="display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px; border: 1px solid var(--border);">
                    <div style="width: 40px; height: 40px; background: transparent; border-radius: 0; display: flex; align-items: center; justify-content: center; font-size: 25px; line-height: 1;">\u{1F310}</div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-size: 14px; font-weight: 500; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${q(s.name)}</div>
                        <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: none;">${q(s.url)}</div>
                    </div>
                    <div style="display: flex; gap: 6px; align-items: center;">
                        <button type="button" data-action="openUrlAttachment" data-param="${encodeURIComponent(s.url)}" style="padding: 0 12px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; height: 32px; line-height: 1; box-sizing: border-box; display: inline-flex; align-items: center; justify-content: center; appearance: none; -webkit-appearance: none;">${d("tasks.attachments.open")}</button>
                        <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${r}" aria-label="${d("tasks.attachments.removeLink")}" title="${d("tasks.attachments.removeTitle")}">&times;</button>
                    </div>
                </div>
            `}).join("");for(let s of e)if(s.type==="file"&&s.fileKey&&s.fileType==="image")try{let r=await La(s.fileKey),i=document.getElementById(`thumbnail-${s.fileKey}`);i&&r&&(i.innerHTML=`<img src="${r}" alt="${q(s.name)}">`)}catch(r){console.error("Failed to load thumbnail:",r)}}async function Bu(e,t,a){if(!t||!a)return;let n=(e||[]).map((p,u)=>({att:p,index:u})),o=n.filter(({att:p})=>p?!!(p.type==="file"||p.fileKey||p.type==="image"&&p.data):!1),s=n.filter(({att:p})=>p?!!(p.type==="link"||p.url&&p.type!=="file"):!1),r=p=>{if(!p)return"";try{let u=/^[a-zA-Z][a-zA-Z0-9+.-]*:/.test(p);return(new URL(u?p:`https://${p}`).host||p).replace(/^www\./,"")}catch{return p}},i=o.map(({att:p,index:u})=>{let f=p.size?Math.round(p.size/1024):0,m=f>1024?`${(f/1024).toFixed(1)} MB`:`${f} KB`;if(p.type==="file"&&p.fileKey){let g=p.fileType==="image",h=`<div id="thumbnail-${p.fileKey}" class="attachment-thumb" aria-hidden="true">${p.icon}</div>`,k=g?"viewFile":"downloadFileAttachment",v=g?`data-param="${p.fileKey}" data-param2="${q(p.name)}" data-param3="${p.fileType}"`:`data-param="${p.fileKey}" data-param2="${q(p.name)}" data-param3="${p.mimeType}"`;return`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="${k}" ${v}>
                        ${h}
                        <span class="attachment-name">${q(p.name)} <span class="attachment-meta">&middot; ${m}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${u}" aria-label="${d("tasks.attachments.remove")}" title="${d("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `}return p.type==="image"&&p.data?`
                <div class="attachment-item">
                    <button type="button" class="attachment-link" data-action="viewImageLegacy" data-param="${p.data}" data-param2="${q(p.name)}">
                        <span class="attachment-thumb" aria-hidden="true"><img src="${p.data}" alt=""></span>
                        <span class="attachment-name">${q(p.name)} <span class="attachment-meta">&middot; ${m}</span></span>
                    </button>
                    <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${u}" aria-label="${d("tasks.attachments.remove")}" title="${d("tasks.attachments.removeTitle")}">&times;</button>
                </div>
            `:""}).filter(Boolean).join(""),c=s.map(({att:p,index:u})=>`
        <div class="attachment-item" style="display: flex; align-items: center; gap: 12px; padding: 10px; background: var(--bg-tertiary); border-radius: 8px; margin-bottom: 8px; border: 1px solid var(--border);">
            <div style="width: 40px; height: 40px; background: transparent; border-radius: 0; display: flex; align-items: center; justify-content: center; font-size: 25px; line-height: 1;">\u{1F310}</div>
            <div style="flex: 1; min-width: 0;">
                <div style="font-size: 14px; font-weight: 500; color: var(--text-primary); overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${q(p.name)}</div>
                <div style="font-size: 12px; color: var(--text-muted); margin-top: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; display: none;">${q(p.url)}</div>
            </div>
            <div style="display: flex; gap: 6px; align-items: center;">
                <button type="button" data-action="openUrlAttachment" data-param="${encodeURIComponent(p.url)}" style="padding: 0 12px; background: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border); border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; height: 32px; line-height: 1; box-sizing: border-box; display: inline-flex; align-items: center; justify-content: center; appearance: none; -webkit-appearance: none;">${d("tasks.attachments.open")}</button>
                <button type="button" class="attachment-remove" data-action="removeAttachment" data-param="${u}" aria-label="${d("tasks.attachments.removeLink")}" title="${d("tasks.attachments.removeTitle")}">&times;</button>
            </div>
        </div>
    `).join("");!!i||!!c?(t.innerHTML=i||"",a.innerHTML=c||""):(t.innerHTML=`<div style="color: var(--text-muted); font-size: 13px; padding: 8px 0;">${d("tasks.attachments.none")}</div>`,a.innerHTML="");for(let p of e||[])if(p&&p.type==="file"&&p.fileKey&&p.fileType==="image")try{let u=await La(p.fileKey),f=document.getElementById(`thumbnail-${p.fileKey}`);f&&u&&(f.innerHTML=`<img src="${u}" alt="${q(p.name)}">`)}catch(u){console.error("Failed to load thumbnail:",u)}}async function pc(e,t,a){if(a==="image")try{let n=await La(e);Ga(n,t)}catch(n){W(d("error.attachmentLoadFailed",{message:n.message}))}}function Ga(e,t){let a=document.createElement("div");a.style.cssText=`
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        cursor: pointer;
    `,a.innerHTML=`
        <div style="max-width: 90%; max-height: 90%; display: flex; flex-direction: column; align-items: center;">
            <div style="color: white; padding: 16px; font-size: 18px; background: rgba(0,0,0,0.5); border-radius: 8px 8px 0 0; width: 100%; text-align: center;">
                ${q(t)}
            </div>
            <img src="${e}" alt="${q(t)}" style="max-width: 100%; max-height: calc(90vh - 60px); object-fit: contain; border-radius: 0 0 8px 8px;">
        </div>
    `,a.onclick=()=>a.remove(),document.body.appendChild(a)}async function mc(e,t,a){try{let n=await La(e),s=await(await fetch(n)).blob(),r=URL.createObjectURL(s),i=document.createElement("a");i.href=r,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),Xe(d("success.fileDownloaded"))}catch(n){W(d("error.fileDownloadFailed",{message:n.message}))}}async function fc(e){let t=document.getElementById("task-form").dataset.editingTaskId;if(t){let a=C.find(o=>o.id===parseInt(t));if(!a||!a.attachments)return;let n=a.attachments[e];if(n.type==="file"&&n.fileKey)try{await ko(n.fileKey),Xe(d("success.attachmentDeletedFromStorage",{name:n.name}))}catch(o){console.error("Failed to delete file from storage:",o),W(d("error.fileDeleteFailed"));return}else Xe(d("success.attachmentRemoved"));a.attachments.splice(e,1),Vt(a.attachments),wa(),_e().catch(o=>{console.error("Failed to save attachment removal:",o),W(d("error.saveChangesFailed"))})}else{let a=$e[e];if(a.type==="file"&&a.fileKey)try{await ko(a.fileKey),Xe(d("success.attachmentDeletedFromStorage",{name:a.name}))}catch(n){console.error("Failed to delete file from storage:",n),W(d("error.fileDeleteFailed"));return}else Xe(d("success.attachmentRemoved"));$e.splice(e,1),Vt($e)}}function $u(){let e=document.getElementById("attachment-file-dropzone"),t=document.getElementById("attachment-file");if(!e||!t)return;let a=window.innerWidth<=768,n=d(a?"tasks.modal.attachmentsDropzoneTap":"tasks.modal.attachmentsDropzoneDefault");e.dataset.defaultText=n;function o(l){e.innerHTML="";let p=document.createElement("span");p.className="task-attachment-dropzone-text",p.textContent=l,e.appendChild(p)}function s(l){l.style.display="flex",l.style.alignItems="center",l.style.justifyContent="center",l.style.gap="10px",l.style.padding="12px 16px",l.style.textAlign="center",l.style.cursor="pointer",l.style.userSelect="none",l.style.minHeight="48px",l.style.border="2px dashed var(--border)",l.style.borderRadius="10px",l.style.background="var(--bg-tertiary)",l.style.boxShadow="none",l.style.color="var(--text-muted)",l.style.fontWeight="500",l.style.transition="border-color 0.18s ease, background 0.18s ease, box-shadow 0.18s ease"}function r(l,p){p?(l.style.borderColor="var(--accent-blue)",l.style.background="rgba(59, 130, 246, 0.08)",l.style.boxShadow="0 0 0 1px var(--accent-blue)"):(l.style.border="2px dashed var(--border)",l.style.background="var(--bg-tertiary)",l.style.boxShadow="none")}s(e),o(n);async function i(l,p){if(!l||l.length===0)return;let u=l[0];p&&(p.preventDefault(),p.stopPropagation()),await Un(u,e)}let c=0;e.addEventListener("dragenter",function(l){l.preventDefault(),c+=1,e.classList.add("task-attachment-dragover"),r(e,!0)}),e.addEventListener("dragover",function(l){l.preventDefault(),e.classList.add("task-attachment-dragover"),r(e,!0)}),e.addEventListener("dragleave",function(l){l.preventDefault(),c=Math.max(0,c-1),c===0&&(e.classList.remove("task-attachment-dragover"),r(e,!1))}),e.addEventListener("drop",function(l){c=0,e.classList.remove("task-attachment-dragover"),r(e,!1),i(l.dataTransfer&&l.dataTransfer.files,l)}),e.addEventListener("dragend",function(){c=0,e.classList.remove("task-attachment-dragover"),r(e,!1)}),e.addEventListener("paste",function(l){if(!l.clipboardData)return;let p=l.clipboardData.files;p&&p.length>0&&i(p,l)}),e.addEventListener("click",function(){t.click()}),e.addEventListener("keydown",function(l){(l.key==="Enter"||l.key===" ")&&(l.preventDefault(),t.click())}),t.addEventListener("change",function(l){let p=l.target.files;p&&p.length>0&&i(p,l),t.value=""})}document.addEventListener("DOMContentLoaded",$u);async function Un(e,t){if(!e)return;let a=Nu(e.type||"",e.name||""),n=Fu(a);if(e.size>n){let i=Math.round(n/1048576);W(d("error.fileSizeTooLarge",{maxMB:i}));return}let o=t&&t.tagName==="BUTTON",s=o?t.textContent||"\u{1F4C1} Upload File":null,r=o?null:t?.dataset?.defaultText||d("tasks.modal.attachmentsDropzoneDefault");try{if(t)if(o)t.textContent="\u23F3 Uploading...",t.disabled=!0;else{t.innerHTML="";let u=document.createElement("span");u.className="task-attachment-dropzone-text",u.textContent=`Uploading ${e.name}...`,t.appendChild(u),t.classList.add("task-attachment-uploading"),t.setAttribute("aria-busy","true")}let i=await tr(e),c=`file_${Date.now()}_${Math.random().toString(36).substring(7)}`;await ar(c,i);let l={name:e.name,icon:Mu(a),type:"file",fileType:a,fileKey:c,mimeType:e.type,size:e.size,addedAt:new Date().toISOString()},p=document.getElementById("task-form").dataset.editingTaskId;if(p){let u=C.find(f=>f.id===parseInt(p));if(!u)return;u.attachments||(u.attachments=[]),u.attachments.push(l),Vt(u.attachments),_e().catch(f=>{console.error("Failed to save attachment:",f),W(d("error.attachmentSaveFailed"))})}else $e.push(l),Vt($e);Xe(d("success.fileUploaded"))}catch(i){W(d("error.fileUploadFailed",{message:i.message}))}finally{if(t)if(o)t.textContent=s,t.disabled=!1;else{t.innerHTML="";let i=document.createElement("span");i.className="task-attachment-dropzone-text",i.textContent=r,t.appendChild(i),t.classList.remove("task-attachment-uploading"),t.removeAttribute("aria-busy")}}}async function gc(e){let t=document.getElementById("attachment-file"),a=t&&t.files?t.files[0]:null;if(!a){W(d("error.selectFile"));return}let n=document.getElementById("attachment-file-dropzone")||e?.target||null;await Un(a,n),t&&(t.value="")}function Nu(e,t){return e.startsWith("image/")?"image":e==="application/pdf"||t.toLowerCase().endsWith(".pdf")?"pdf":e.includes("spreadsheet")||t.match(/\.(xlsx?|csv)$/i)?"spreadsheet":e.includes("document")||e.includes("word")||t.match(/\.docx?$/i)?"document":e.includes("presentation")||e.includes("powerpoint")||t.match(/\.pptx?$/i)?"presentation":"file"}function Fu(e){switch(e){case"pdf":return 20*1024*1024;case"image":case"spreadsheet":case"document":case"presentation":return 10*1024*1024;default:return 10*1024*1024}}function Mu(e){switch(e){case"image":return"\u{1F5BC}\uFE0F";case"pdf":return"\u{1F4C4}";case"spreadsheet":return"\u{1F4CA}";case"document":return"\u{1F4DD}";case"presentation":return"\u{1F4CA}";default:return"\u{1F5C2}\uFE0F"}}window.addFileAttachment=gc;window.viewFile=pc;window.viewImageLegacy=Ga;window.downloadFileAttachment=mc;window.removeAttachment=fc;window.kanbanShowBacklog=localStorage.getItem("kanbanShowBacklog")==="true";window.kanbanShowProjects=localStorage.getItem("kanbanShowProjects")!=="false";window.kanbanShowNoDate=localStorage.getItem("kanbanShowNoDate")!=="false";window.kanbanUpdatedFilter=localStorage.getItem("kanbanUpdatedFilter")||"all";window.enableReviewStatus=localStorage.getItem("enableReviewStatus")==="true";function hc(e){switch(e){case"5m":return"5m";case"30m":return"30m";case"24h":return"24h";case"week":return d("filters.updated.week");case"month":return d("filters.updated.month");default:return""}}function ks(){let e=document.querySelector(".kanban-board");if(!e)return;let t=3;window.kanbanShowBacklog===!0&&t++,window.enableReviewStatus!==!1&&t++,e.style.gridTemplateColumns=`repeat(${t}, 1fr)`}function ws(){let e=window.enableReviewStatus!==!1,t=document.getElementById("kanban-column-review");t&&(t.style.display=e?"":"none");let a=document.getElementById("filter-status-review");a&&(a.style.display=e?"":"none"),ks(),!e&&y.statuses.has("review")&&(y.statuses.delete("review"),applyFilters())}function Ru(){let e=window.kanbanShowBacklog===!0,t=document.getElementById("kanban-column-backlog");t&&(t.style.display=e?"":"none"),ks()}function Zt(e){let t=e?parseInt(e,10):null;if(!t)return null;let a=N.find(n=>n.id===t);return a?(a.updatedAt=new Date().toISOString(),a):null}function Xt(e,t,a){if(!window.historyService)return;let n=e?parseInt(e,10):null;if(!n)return;let o=N.find(s=>s.id===n);o&&(t==="added"&&window.historyService.recordProjectTaskAdded?window.historyService.recordProjectTaskAdded(o,a):t==="removed"&&window.historyService.recordProjectTaskRemoved&&window.historyService.recordProjectTaskRemoved(o,a))}function Ou(){let e=document.getElementById("btn-filter-kanban-updated");if(!e)return;let t=e.querySelector("#badge-kanban-updated");if(!t)return;for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(`${d("tasks.filters.updated")} `)),e.appendChild(t),e.appendChild(document.createTextNode(" "));let a=document.createElement("span");a.className="filter-arrow",a.textContent="\u25BC",e.appendChild(a)}function no(){try{Ou()}catch{}let e=document.getElementById("badge-kanban-updated");if(e){e.textContent=hc(window.kanbanUpdatedFilter);let t=e.closest(".filter-button");t&&(window.kanbanUpdatedFilter!=="all"?t.classList.add("active"):t.classList.remove("active"))}try{document.querySelectorAll('input[type="radio"][data-filter="kanban-updated"][name="kanban-updated-filter"]').forEach(t=>{t.checked=t.value===window.kanbanUpdatedFilter})}catch{}}function Ya(e,t={render:!0}){let n=new Set(["all","5m","30m","24h","week","month"]).has(e)?e:e==="today"?"24h":"all";window.kanbanUpdatedFilter=n;try{localStorage.setItem("kanbanUpdatedFilter",n)}catch{}no();try{Qa()}catch{}try{Oa()}catch{}if(t&&t.render===!1)return;let o=!document.querySelector(".kanban-board")?.classList.contains("hidden"),s=document.getElementById("list-view")?.classList.contains("active"),r=document.getElementById("calendar-view")?.classList.contains("active");o&&Fe(),(s||window.innerWidth<=768)&&Je(),r&&re()}function yc(e){e.stopPropagation();let t=document.getElementById("kanban-settings-panel");t.classList.contains("active")?t.classList.remove("active"):(t.classList.add("active"),document.getElementById("kanban-show-backlog").checked=window.kanbanShowBacklog===!0,document.getElementById("kanban-show-projects").checked=window.kanbanShowProjects!==!1,document.getElementById("kanban-show-no-date").checked=window.kanbanShowNoDate!==!1)}function qu(){let e=document.getElementById("kanban-show-backlog");window.kanbanShowBacklog=e.checked,localStorage.setItem("kanbanShowBacklog",e.checked);let t=document.getElementById("kanban-column-backlog");t&&(t.style.display=e.checked?"":"none"),ks(),Fe()}function zu(){let e=document.getElementById("kanban-show-projects");window.kanbanShowProjects=e.checked,localStorage.setItem("kanbanShowProjects",e.checked),Fe()}function Hu(){let e=document.getElementById("kanban-show-no-date");window.kanbanShowNoDate=e.checked,localStorage.setItem("kanbanShowNoDate",e.checked),Fe()}window.toggleKanbanSettings=yc;window.toggleKanbanBacklog=qu;window.toggleKanbanProjects=zu;window.toggleKanbanNoDate=Hu;document.addEventListener("click",e=>{let t=document.getElementById("kanban-settings-panel"),a=document.getElementById("kanban-settings-btn");t&&!t.contains(e.target)&&e.target!==a&&!a.contains(e.target)&&t.classList.remove("active")});async function ft(e,t){let n=document.getElementById("task-form")?.dataset.editingTaskId;if(!n)return;let o=C.find(f=>f.id===parseInt(n,10)),s=o?JSON.parse(JSON.stringify(o)):null,r=e==="description"?Zi(t):t;if(o){let f=o[e],m=!1;if(e==="projectId"){let g=r===""||r===null||typeof r>"u"?null:parseInt(r,10),h=typeof o.projectId=="number"?o.projectId:null;m=(Number.isNaN(g)?null:g)===h}else m=(typeof f=="string"?f:f||"")===(typeof r=="string"?r:r||"");if(m)return}let i=Ws(parseInt(n,10),e,r,C,F);if(!i.task)return;window.historyService&&s&&window.historyService.recordTaskUpdated(s,i.task);let c=i.oldProjectId;C=i.tasks;let l=i.task;if(e==="projectId"){Xa();let f=l.projectId;c!==f&&(c&&(Zt(c),Xt(c,"removed",l)),f&&(Zt(f),Xt(f,"added",l)),nt().catch(()=>{}))}e==="endDate"&&oa(),_e().catch(f=>{console.error("Failed to save task field update:",f),W(d("error.saveChangesFailed"))});let p=document.getElementById("project-details").classList.contains("active"),u=e==="startDate"||e==="endDate"||e==="projectId"||e==="status"||e==="priority"||e==="title"||e==="tags";if(u&&Wa(),!!u){if(p)if(e==="projectId"){let f=l.projectId;if(f)if(c!==f){Be(f);return}else{Be(f);return}else if(c){Be(c);return}}else{let f=c||(window.location.hash&&window.location.hash.startsWith("#project-")?parseInt(window.location.hash.replace("#project-",""),10):null);if(f){Be(f);return}}else Fe(),(window.innerWidth<=768||document.getElementById("list-view").classList.contains("active"))&&Je(),document.getElementById("projects").classList.contains("active")&&(te.projectsSortedView=null,Ve(),Ae());e==="status"&&(F.autoSetStartDateOnStatusChange||F.autoSetEndDateOnStatusChange)&&setTimeout(()=>{let f=document.getElementById("task-form");if(!f)return;let m=f.querySelector('input[name="startDate"]'),g=f.querySelector('input[name="endDate"]');if(m&&l.startDate){let h=m._flatpickrInstance;h&&h.setDate(new Date(l.startDate),!1),m.value=l.startDate;let k=m.parentElement?.querySelector("input.date-display");k&&(k.value=gn(l.startDate))}if(g&&l.endDate){let h=g._flatpickrInstance;h&&h.setDate(new Date(l.endDate),!1),g.value=l.endDate;let k=g.parentElement?.querySelector("input.date-display");k&&(k.value=gn(l.endDate))}},50)}}var Qe=null;function vc(){let e=document.getElementById("task-form");e&&(Qe={title:e.querySelector('input[name="title"]')?.value.trim()||"",description:document.getElementById("task-description-hidden")?.value.trim()||"",projectId:e.querySelector('input[name="projectId"]')?.value||e.querySelector('select[name="projectId"]')?.value||"",startDate:e.querySelector('input[name="startDate"]')?.value||"",endDate:e.querySelector('input[name="endDate"]')?.value||"",priority:e.querySelector("#hidden-priority")?.value||"medium",status:e.querySelector("#hidden-status")?.value||"backlog",tags:window.tempTags?[...window.tempTags]:[],attachments:$e?$e.length:0})}function _n(){let e=document.getElementById("task-form");if(!e||e.dataset.editingTaskId||!Qe)return!1;let t={title:e.querySelector('input[name="title"]')?.value.trim()||"",description:document.getElementById("task-description-hidden")?.value.trim()||"",projectId:e.querySelector('input[name="projectId"]')?.value||e.querySelector('select[name="projectId"]')?.value||"",startDate:e.querySelector('input[name="startDate"]')?.value||"",endDate:e.querySelector('input[name="endDate"]')?.value||"",priority:e.querySelector("#hidden-priority")?.value||"medium",status:e.querySelector("#hidden-status")?.value||"backlog",tags:window.tempTags?[...window.tempTags]:[],attachments:$e?$e.length:0};return t.title!==Qe.title||t.description!==Qe.description||t.projectId!==Qe.projectId||t.startDate!==Qe.startDate||t.endDate!==Qe.endDate||t.priority!==Qe.priority||t.status!==Qe.status||t.tags.length!==Qe.tags.length||t.attachments!==Qe.attachments}function Fo(e){let t=document.getElementById(e);!t||t.__overlayBound||(t.__overlayBound=!0,t.addEventListener("pointerdown",a=>{t.__downOnOverlay=a.target===t}),t.addEventListener("click",a=>{let n=a.target===t,o=!!t.__downOnOverlay;if(t.__downOnOverlay=!1,!(!n||!o)){if(e==="task-modal"){let s=document.getElementById("task-form");if(s&&s.dataset.editingTaskId){let r=s.querySelector("#task-description-editor");r&&ft("description",r.innerHTML)}}if(e==="task-modal"&&_n()){_a(e);return}Ge(e)}}))}document.addEventListener("DOMContentLoaded",()=>{Fo("task-modal"),Fo("project-modal"),Fo("settings-modal")});document.addEventListener("keydown",async e=>{if(e.key==="Escape"&&document.querySelectorAll(".modal.active").forEach(a=>{if(a.id==="task-modal")if(_n())_a("task-modal");else{let n=document.getElementById("task-form");if(n&&n.dataset.editingTaskId){let o=n.querySelector("#task-description-editor");o&&ft("description",o.innerHTML)}Ge(a.id)}else a.id==="settings-modal"&&window.settingsFormIsDirty?_a("settings-modal"):Ge(a.id)}),e.key==="n"||e.key==="N"){if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA"||e.target.isContentEditable)return;e.preventDefault();let t=document.getElementById("notification-dropdown"),a=document.getElementById("notification-toggle");if(!t||!a)return;if(t.classList.contains("active"))Ot();else{tn();let o=await Ha({force:!0});va(o),t.classList.add("active"),a.classList.add("active"),await qo(o)}}});async function bc(){let e=document.getElementById("tag-input"),t=e.value.trim().toLowerCase();if(!t){e.style.border="2px solid var(--accent-red, #ef4444)",setTimeout(()=>{e.style.border=""},2e3);return}let a=document.getElementById("task-form").dataset.editingTaskId;if(a){let n=C.find(r=>r.id===parseInt(a));if(!n)return;if(n.tags||(n.tags=[]),n.tags.includes(t)){e.value="";return}let o=JSON.parse(JSON.stringify(n));n.tags=[...n.tags,t],Ea(n.tags),wa(),window.historyService&&window.historyService.recordTaskUpdated(o,n),document.getElementById("project-details").classList.contains("active")&&n.projectId?Be(n.projectId):(Fe(),(window.innerWidth<=768||document.getElementById("list-view").classList.contains("active"))&&Je(),document.getElementById("projects").classList.contains("active")&&(te.projectsSortedView=null,Ve())),Ta(),oa(),_e().catch(r=>{console.error("Failed to save tag addition:",r),W(d("error.saveTagFailed"))})}else{if(window.tempTags||(window.tempTags=[]),window.tempTags.includes(t)){e.value="";return}window.tempTags=[...window.tempTags,t],Ea(window.tempTags)}e.value=""}async function Uu(e){let t=document.getElementById("task-form").dataset.editingTaskId;if(t){let a=C.find(s=>s.id===parseInt(t));if(!a||!a.tags)return;let n=JSON.parse(JSON.stringify(a));a.tags=a.tags.filter(s=>s!==e),Ea(a.tags),wa(),window.historyService&&window.historyService.recordTaskUpdated(n,a),_e().catch(s=>{console.error("Failed to save tag removal:",s),W(d("error.removeTagFailed"))}),document.getElementById("project-details").classList.contains("active")&&a.projectId?Be(a.projectId):(Fe(),(window.innerWidth<=768||document.getElementById("list-view").classList.contains("active"))&&Je(),document.getElementById("projects").classList.contains("active")&&(te.projectsSortedView=null,Ve())),Ta(),oa()}else window.tempTags||(window.tempTags=[]),window.tempTags=window.tempTags.filter(a=>a!==e),Ea(window.tempTags)}function Ea(e){let t=document.getElementById("tags-display"),a=window.innerWidth<=768;t.innerHTML=Vr(e,{isMobile:a,getTagColor:na,escapeHtml:q,noTagsText:d("tasks.tags.none")})}async function _u(){let e=document.getElementById("project-tag-input"),t=e.value.trim().toLowerCase();if(!t){e.style.border="2px solid var(--accent-red, #ef4444)",setTimeout(()=>{e.style.border=""},2e3);return}let a=document.getElementById("project-form").dataset.editingProjectId;if(a){let n=N.find(o=>o.id===parseInt(a));if(!n)return;if(n.tags||(n.tags=[]),n.tags.includes(t)){e.value="";return}n.tags=[...n.tags,t],Ka(n.tags),te.projectsSortedView=null,Ve(),nn(),nt().catch(o=>{console.error("Failed to save project tag addition:",o),W(d("error.saveTagFailed"))})}else{if(window.tempProjectTags||(window.tempProjectTags=[]),window.tempProjectTags.includes(t)){e.value="";return}window.tempProjectTags=[...window.tempProjectTags,t],Ka(window.tempProjectTags)}e.value=""}async function Vu(e){let t=document.getElementById("project-form").dataset.editingProjectId;if(t){let a=N.find(n=>n.id===parseInt(t));if(!a||!a.tags)return;a.tags=a.tags.filter(n=>n!==e),Ka(a.tags),te.projectsSortedView=null,Ve(),nn(),nt().catch(n=>{console.error("Failed to save project tag removal:",n),W(d("error.saveTagFailed"))})}else{if(!window.tempProjectTags)return;window.tempProjectTags=window.tempProjectTags.filter(a=>a!==e),Ka(window.tempProjectTags)}}function Ka(e){let t=document.getElementById("project-tags-display");if(!e||e.length===0){t.innerHTML=`<span style="color: var(--text-muted); font-size: 13px;">${d("tasks.tags.none")}</span>`;return}let a=document.getElementById("project-form")?.dataset.editingProjectId,n=a?Ie(parseInt(a)):"#6b7280",o=window.innerWidth<=768,s=o?"3px 6px":"4px 8px",r=o?"11px":"12px",i="4px",c=o?"12px":"14px",l=o?"1.2":"1.4";t.innerHTML=e.map(p=>`
            <span class="task-tag" style="background-color: ${n}; color: white; padding: ${s}; border-radius: 4px; font-size: ${r}; display: inline-flex; align-items: center; gap: ${i}; line-height: ${l};">
                ${q(p.toUpperCase())}
                <button type="button" data-action="removeProjectTag" data-param="${q(p)}" style="background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${c}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;">\xD7</button>
            </span>
        `).join("")}function an(e,t){let a=document.getElementById("project-details-tags-display");if(!a)return;if(!e||e.length===0){a.innerHTML=`<span style="color: var(--text-muted); font-size: 13px;">${d("tasks.tags.none")}</span>`;return}let n=t?Ie(t):"#6b7280",o=window.innerWidth<=768,s=o?"3px 6px":"4px 8px",r=o?"11px":"12px",i="4px",c=o?"12px":"14px",l=o?"1.2":"1.4";a.innerHTML=e.map(p=>`
            <span class="task-tag" style="background-color: ${n}; color: white; padding: ${s}; border-radius: 4px; font-size: ${r}; display: inline-flex; align-items: center; gap: ${i}; line-height: ${l};">
                ${q(p.toUpperCase())}
                <button type="button" data-action="removeProjectDetailsTag" data-param="${q(p)}" style="background: none; border: none; color: white; cursor: pointer; padding: 0; margin: 0; font-size: ${c}; line-height: 1; display: inline-flex; align-items: center; justify-content: center; width: auto; min-width: auto;">\xD7</button>
            </span>
        `).join("")}async function kc(e){let t=document.getElementById("project-details-tag-input");if(!t)return;let a=t.value.trim().toLowerCase();if(!a){t.style.border="2px solid var(--accent-red, #ef4444)",setTimeout(()=>{t.style.border=""},2e3);return}let n=N.find(o=>o.id===parseInt(e));if(n){if(n.tags||(n.tags=[]),n.tags.includes(a)){t.value="";return}n.tags=[...n.tags,a],an(n.tags,e),te.projectsSortedView=null,Ve(),nn(),nt().catch(o=>{console.error("Failed to save project tag addition:",o),W(d("error.saveTagFailed"))}),t.value=""}}async function Wu(e){let t=document.getElementById("project-title-display");if(!t)return;let a=parseInt(t.dataset.param),n=N.find(o=>o.id===a);!n||!n.tags||(n.tags=n.tags.filter(o=>o!==e),an(n.tags,a),te.projectsSortedView=null,Ve(),nn(),nt().catch(o=>{console.error("Failed to save project tag removal:",o),W(d("error.saveTagFailed"))}))}function wc(){Wr({toggleTheme:wu,showCalendarView:Va,toggleKanbanSettings:yc,openProjectModal:Bd,openTaskModal:eo,closeUserDropdown:tn,openSettingsModal:bu,openTaskModalForProject:vu,openSelectedProjectFromTask:Yd,closeModal:Ge,closeTaskModal:Nd,closeConfirmModal:ps,closeFeedbackDeleteModal:dc,closeProjectConfirmModal:fs,closeUnsavedChangesModal:ec,closeDayItemsModal:ao,closeDayItemsModalOnBackdrop:iu,openTaskDetails:xa,deleteTask:Cd,duplicateTask:Ld,confirmDelete:Wi,showProjectDetails:Be,toggleProjectExpand:Vi,toggleProjectMenu:Au,editProjectTitle:Cu,saveProjectTitle:Lu,cancelProjectTitle:uc,handleDeleteProject:mu,handleDuplicateProject:fu,toggleProjectColorPicker:Ql,updateProjectColor:ed,openCustomProjectColorPicker:ad,navigateToProjectStatus:Ec,deleteProject:nc,confirmProjectDelete:ac,closeDuplicateProjectModal:oc,confirmDuplicateProject:gu,addFeedbackItem:bs,deleteFeedbackItem:Iu,confirmFeedbackDelete:ju,toggleHistoryEntryInline:xu,formatTaskText:Xd,insertTaskHeading:Qd,insertTaskDivider:eu,sortTable:Ed,toggleSortMode:Bl,animateCalendarMonthChange:Qi,goToToday:su,showDayTasks:ru,addAttachment:Jo,addFileAttachment:gc,addTag:bc,removeTag:Uu,addProjectTag:_u,removeProjectTag:Vu,addProjectDetailsTag:kc,removeProjectDetailsTag:Wu,removeAttachment:fc,downloadFileAttachment:mc,viewFile:pc,viewImageLegacy:Ga,showErrorNotification:W,t:d,backToProjects:hu,showAllActivity:md,backToDashboard:fd,backToCalendar:yu,openUpdatesFromNotification:Di,openDueTodayFromNotification:Ti,dismissKanbanTip:Pu,confirmDiscardChanges:lu,closeReviewStatusConfirmModal:tc,confirmDisableReviewStatus:du,closeCalendarCreateModal:gs,confirmCreateTask:uu,addTaskFromDayItemsModal:cu,signOut:bd,exportDashboardData:kd,closeExportDataModal:_i,confirmExportData:wd,generateReport:Sd,getCurrentMonth:()=>we,getCurrentYear:()=>Se,showStatusInfoModal:Pd})}function Sc(){y.statuses.clear(),y.priorities.clear(),y.projects.clear(),y.tags.clear(),y.search="",y.datePresets.clear(),y.dateFrom="",y.dateTo="";let e=document.getElementById("filter-search");e&&(e.value="");let t=document.getElementById("filter-due-date"),a=document.getElementById("filter-created-date");t&&(t.value=""),a&&(a.value="");let n=document.getElementById("filter-date-global");n&&(n.value=""),document.querySelectorAll('#global-filters input[type="checkbox"]').forEach(s=>{s.checked=!1}),xe()}function Gu(e,t){ze("tasks"),window.location.hash="tasks",document.querySelectorAll(".nav-item").forEach(i=>i.classList.remove("active"));let a=document.querySelector('.nav-item[data-page="tasks"]');a&&a.classList.add("active"),y.statuses.clear(),y.priorities.clear(),y.projects.clear(),y.tags.clear(),y.dateFrom="",y.dateTo="",y.search="";let n=document.getElementById("filter-search");n&&(n.value=""),y.statuses.add(t),y.projects.add(e.toString()),document.querySelectorAll('input[type="checkbox"]').forEach(i=>i.checked=!1),document.querySelectorAll(`input[data-filter="status"][value="${t}"]`).forEach(i=>i.checked=!0),document.querySelectorAll(`input[data-filter="project"][value="${e}"]`).forEach(i=>i.checked=!0),document.querySelectorAll(".view-btn").forEach(i=>i.classList.remove("active"));let o=document.querySelector(".view-btn:nth-child(2)");o&&o.classList.add("active");let s=document.querySelector(".kanban-board"),r=document.getElementById("list-view");s&&s.classList.add("hidden"),r&&r.classList.add("active"),he(),Je()}window.filterProjectTasks=Gu;function Ec(e,t){Oi("status",t),setTimeout(()=>{let a=document.querySelector(".view-toggle");a&&a.classList.remove("hidden"),y.projects.add(e.toString());let n=document.querySelector(`input[data-filter="project"][value="${e}"]`);n&&(n.checked=!0),he(),Fe()},200)}window.navigateToProjectStatus=Ec;function sf(){window.location.hash="tasks",document.querySelectorAll(".nav-item").forEach(s=>s.classList.remove("active"));let e=document.querySelector('.nav-item[data-page="tasks"]');e&&e.classList.add("active"),ze("tasks"),document.querySelectorAll(".view-btn").forEach(s=>s.classList.remove("active"));let t=document.querySelector('.view-btn[onclick*="list"], .view-btn:nth-child(2)');t&&t.classList.add("active");let a=document.querySelector(".kanban-board"),n=document.getElementById("list-view"),o=document.getElementById("calendar-view");a&&a.classList.add("hidden"),o&&o.classList.remove("active"),n&&n.classList.add("active"),Sc(),setTimeout(()=>{Je()},100)}function Yu(e){let t=Pe&&Pe.querySelector(".project-portal-options");if(!t)return;let a=document.getElementById("hidden-project"),n=a&&a.value||"",o=(e||"").toLowerCase(),s="";n&&(s+=`<div class="project-option" data-project-id="">${d("tasks.project.selectPlaceholder")}</div>`),s+=N.slice().sort((r,i)=>(r.name||"").localeCompare(i.name||"",void 0,{sensitivity:"base"})).filter(r=>n===""||String(r.id)!==String(n)).filter(r=>!o||(r.name||"").toLowerCase().includes(o)).map(r=>`<div class="project-option" data-project-id="${r.id}">${r.name}</div>`).join(""),t.innerHTML=s}function oa(){let e=document.getElementById("filter-date-global");if(!e)return;let t=Array.from(e.options).find(n=>n.value==="no-date");if(!t)return;let a=C.some(n=>!n.endDate);t.style.display=a?"":"none"}function oo(){let e=document.getElementById("badge-project-status");if(!e)return;let t=O.statuses.size;e.textContent=t===0?"":t;let a=e.closest(".filter-button");a&&(t>0?a.classList.add("active"):a.classList.remove("active"))}function Ss(){let e=document.getElementById("badge-project-tags");if(!e)return;let t=O.tags.size;e.textContent=t===0?"":t;let a=e.closest(".filter-button");a&&(t>0?a.classList.add("active"):a.classList.remove("active"))}function nn(){let e=document.getElementById("project-tags-options");if(!e)return;let t=new Set(O.tags),a=new Set;if(N.forEach(n=>{n.tags&&n.tags.length>0&&n.tags.forEach(o=>a.add(o))}),e.innerHTML="",a.size===0){let n=document.createElement("li");n.textContent=d("filters.noOtherTags"),n.style.color="var(--text-muted)",n.style.padding="8px 12px",e.appendChild(n)}else Array.from(a).sort().forEach(n=>{let o=document.createElement("li"),s=`project-tag-${n}`,r=t.has(n)?"checked":"";o.innerHTML=`<label><input type="checkbox" id="${s}" value="${n}" data-filter="project-tags" ${r}> ${n.toUpperCase()}</label>`,e.appendChild(o)});e.querySelectorAll('input[type="checkbox"]').forEach(n=>{n.addEventListener("change",()=>{n.checked?O.tags.add(n.value):O.tags.delete(n.value),Ss(),ct()})})}function Dc(e){switch(e){case"5m":return"5m";case"30m":return"30m";case"24h":return"24h";case"week":return d("filters.updated.week");case"month":return d("filters.updated.month");default:return""}}function Tc(e){let t=Date.now();switch(e){case"5m":return t-300*1e3;case"30m":return t-1800*1e3;case"24h":return t-1440*60*1e3;case"week":return t-10080*60*1e3;case"month":return t-720*60*60*1e3;default:return null}}function xc(e){let t=e&&(e.updatedAt||e.createdAt)||"",a=new Date(t).getTime();return Number.isFinite(a)?a:0}function Ja(){let e=document.getElementById("badge-project-updated");if(e){e.textContent=Dc(O.updatedFilter);let t=e.closest(".filter-button");t&&(O.updatedFilter!=="all"?t.classList.add("active"):t.classList.remove("active"))}try{document.querySelectorAll('input[type="radio"][data-filter="project-updated"][name="project-updated-filter"]').forEach(t=>{t.checked=t.value===O.updatedFilter})}catch{}}function Ic(){let e=document.getElementById("projects-active-filters");if(!e)return;e.innerHTML="";let t=(a,n,o)=>{let s=document.createElement("span");s.className="filter-chip";let r=document.createElement("span");r.className="chip-text",r.textContent=n!=null&&n!==""?`${a}: ${n}`:a;let i=document.createElement("button");i.type="button",i.className="chip-remove",i.setAttribute("aria-label",d("filters.chip.removeAria",{label:a})),i.textContent="x",i.addEventListener("click",o),s.appendChild(r),s.appendChild(i),e.appendChild(s)};if(O.search&&t(d("filters.chip.search"),O.search,()=>{O.search="";let a=document.getElementById("projects-search");a&&(a.value="");let n=bt()||{};Qt({...n,search:""}),ct()}),O.statuses.forEach(a=>{t(d("projects.filters.status"),Gn(a),()=>{O.statuses.delete(a);let n=document.querySelector(`input[type="checkbox"][data-filter="project-status"][value="${a}"]`);n&&(n.checked=!1),oo(),ct()})}),O.updatedFilter&&O.updatedFilter!=="all"&&t(d("filters.chip.updated"),Dc(O.updatedFilter),()=>{O.updatedFilter="all",Ja();let a=bt()||{};Qt({...a,updatedFilter:"all"}),ct()}),O.taskFilter==="has-tasks"||O.taskFilter==="no-tasks"){let a=O.taskFilter==="has-tasks"?d("projects.filters.hasTasks"):d("projects.filters.noTasks");t(a,"",()=>{O.taskFilter="",document.querySelectorAll("#projects .projects-filters .pf-chip").forEach(o=>o.classList.remove("active"));let n=bt()||{};Qt({...n,filter:""}),ct()})}O.tags.forEach(a=>{t(d("projects.filters.tags"),a.toUpperCase(),()=>{O.tags.delete(a);let n=document.querySelector(`input[type="checkbox"][data-filter="project-tags"][value="${a}"]`);n&&(n.checked=!1),Ss(),ct()})})}function ct(){let e=ke("filters","projects",{totalProjects:N.length,statusCount:O.statuses.size,tagCount:O.tags.size,taskFilter:O.taskFilter||"",updatedFilter:O.updatedFilter||"all",hasSearch:!!O.search}),t=N.slice();if(O.statuses.size>0&&(t=t.filter(n=>{let o=ta(n.id);return O.statuses.has(o)})),O.taskFilter==="has-tasks"?t=t.filter(n=>C.some(o=>o.projectId===n.id)):O.taskFilter==="no-tasks"&&(t=t.filter(n=>!C.some(o=>o.projectId===n.id))),O.tags.size>0&&(t=t.filter(n=>!n.tags||n.tags.length===0?!1:Array.from(O.tags).some(o=>n.tags.includes(o)))),O.updatedFilter&&O.updatedFilter!=="all"){let n=Tc(O.updatedFilter);n!=null&&(t=t.filter(o=>xc(o)>=n))}if(O.search){let n=O.search.toLowerCase();t=t.filter(o=>((o.name||"")+" "+(o.description||"")).toLowerCase().includes(n))}let a=bt()||{search:"",filter:"",sort:"default",sortDirection:"asc",updatedFilter:"all"};a.sort&&a.sort!=="default"?Zo(a.sort,t):Zo("default",t),Vn();try{Ic()}catch{}ye("filters",e,{totalProjects:N.length,filteredCount:t.length})}function Zo(e,t){let a=t&&Array.isArray(t)?t.slice():N.slice(),o=He.direction==="desc",s=e==="name-asc"||e==="name-desc"?"name":e;if(!s||s==="default"){let c={active:0,planning:1,completed:2};a.sort((l,p)=>{let u=ta(l.id),f=ta(p.id),m=(c[u]||999)-(c[f]||999);return o?-m:m}),te.projectsSortedView=a,Ku(a);return}s==="name"?a.sort((c,l)=>{let p=(c.name||"").localeCompare(l.name||"");return o?-p:p}):s==="created-desc"?a.sort((c,l)=>{let p=new Date(l.createdAt)-new Date(c.createdAt);return o?-p:p}):s==="updated-desc"?a.sort((c,l)=>{let p=new Date(c.updatedAt||c.createdAt),f=new Date(l.updatedAt||l.createdAt)-p;return o?-f:f}):s==="tasks-desc"?a.sort((c,l)=>{let p=C.filter(u=>u.projectId===l.id).length-C.filter(u=>u.projectId===c.id).length;return o?-p:p}):s==="completion-desc"&&a.sort((c,l)=>{let p=C.filter(v=>v.projectId===c.id).length,u=C.filter(v=>v.projectId===c.id&&v.status==="done").length,f=p>0?u/p*100:0,m=C.filter(v=>v.projectId===l.id).length,g=C.filter(v=>v.projectId===l.id&&v.status==="done").length,k=(m>0?g/m*100:0)-f;return o?-k:k}),te.projectsSortedView=a;let r=document.getElementById("projects-list");if(!r)return;let i=new Set;r.querySelectorAll(".project-list-item.expanded").forEach(c=>{let l=c.id.replace("project-item-","");i.add(l)}),r.innerHTML=te.projectsSortedView.map(us).join(""),i.forEach(c=>{let l=document.getElementById(`project-item-${c}`);l&&l.classList.add("expanded")}),On(te.projectsSortedView),Qn(r)}function jc(e){return{default:d("projects.sort.statusLabel"),name:d("projects.sort.nameLabel"),"name-asc":d("projects.sort.nameLabel"),"name-desc":d("projects.sort.nameLabel"),"created-desc":d("projects.sort.newestLabel"),"updated-desc":d("projects.sort.lastUpdatedLabel"),"tasks-desc":d("projects.sort.mostTasksLabel"),"completion-desc":d("projects.sort.percentCompletedLabel")}[e]||e}function Cc(){let e=document.getElementById("projects-sort-label");if(!e)return;let t=He?.lastSort||"default",a=jc(t),n=He?.direction==="asc"?"asc":"desc";e.textContent=d("projects.sort.prefix",{label:a,direction:n});let o=document.querySelector("#projects-sort-btn .sort-label-arrow");o&&Es(o,n);try{Ds()}catch{}}function Es(e,t){e&&(e.classList.toggle("is-up",t==="asc"),e.classList.toggle("is-down",t!=="asc"),e.innerHTML='<svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 20 L6 14 H10 V4 H14 V14 H18 Z" fill="currentColor"/></svg>')}function pi(e,{toggleDirection:t=!1}={}){let a=e||"default",n=He.lastSort===a;t||n?He.direction=He.direction==="asc"?"desc":"asc":He.direction="asc",He.lastSort=a,Cc();try{Ds()}catch{}let o=bt()||{search:"",filter:"",sort:"default"};Qt({...o,sort:a,sortDirection:He.direction}),ct()}function Ds(){let e=document.getElementById("projects-sort-panel");if(!e)return;let t=He?.lastSort||"default",a=He?.direction==="asc"?"asc":"desc";e.querySelectorAll(".projects-sort-option").forEach(n=>{let o=n.dataset.sort===t;n.classList.toggle("is-active",o);let s=n.querySelector(".sort-option-indicator");s||(s=document.createElement("button"),s.type="button",s.className="sort-option-indicator",s.setAttribute("aria-label",d("projects.sort.help")),n.appendChild(s)),o&&Es(s,a),s.style.visibility=o?"visible":"hidden"})}document.addEventListener("DOMContentLoaded",()=>{let e=document.getElementById("projects-sort-btn"),t=document.getElementById("projects-sort-panel"),a=document.getElementById("projects-sort-label");if(e&&t){e.addEventListener("click",c=>{if(c.target.closest(".sort-label-arrow")){c.preventDefault(),c.stopPropagation(),pi(He?.lastSort||"default",{toggleDirection:!0});return}let p=!(e.getAttribute("aria-expanded")==="true");e.setAttribute("aria-expanded",String(p)),p?(t.setAttribute("aria-hidden","false"),t.removeAttribute("inert")):(t.contains(document.activeElement)&&e.focus(),t.setAttribute("aria-hidden","true"),t.setAttribute("inert",""));try{Ds()}catch{}c.stopPropagation()});let i=document.getElementById("projects-sort-panel");if(!i)return;i.querySelectorAll(".projects-sort-option").forEach(c=>{c.addEventListener("click",l=>{let p=c.dataset.sort||"default",u=l.target&&l.target.classList&&l.target.classList.contains("sort-option-indicator");pi(p,{toggleDirection:u||He.lastSort===p}),u?(t.removeAttribute("inert"),l.stopPropagation()):(e.setAttribute("aria-expanded","false"),t.contains(document.activeElement)&&e.focus(),t.setAttribute("aria-hidden","true"),t.setAttribute("inert",""))})}),document.addEventListener("click",()=>{e.setAttribute("aria-expanded","false"),t.contains(document.activeElement)&&e.focus(),t.setAttribute("aria-hidden","true"),t.setAttribute("inert","")})}let n=document.getElementById("group-project-status");n&&n.querySelectorAll('input[type="checkbox"][data-filter="project-status"]').forEach(c=>{c.addEventListener("change",()=>{c.checked?O.statuses.add(c.value):O.statuses.delete(c.value),oo(),ct(),Lc()})});let o=document.getElementById("projects-search");o&&o.addEventListener("input",kn(i=>{O.search=(i.target.value||"").trim(),ct();let c=bt()||{};Qt({...c,search:i.target.value})},220));let s=Array.from(document.querySelectorAll(".pf-chip"));s.forEach(i=>{i.addEventListener("click",()=>{let c=i.dataset.filter;i.classList.contains("active")?(i.classList.remove("active"),O.taskFilter=""):(s.forEach(p=>p.classList.remove("active")),i.classList.add("active"),O.taskFilter=c),ct();let l=bt()||{};Qt({...l,filter:O.taskFilter||""})})});let r=document.getElementById("btn-clear-projects");r&&r.addEventListener("click",Pc),Vn()});window.clearProjectFilters=Pc;function Lc(){let e=new URLSearchParams,t=bt()||{},a=O.search||t.search;a&&a.trim()!==""&&e.set("search",a.trim()),O.statuses.size>0&&e.set("status",Array.from(O.statuses).join(","));let n=O.taskFilter||t.filter;n&&["has-tasks","no-tasks"].includes(n)&&e.set("filter",n),t.sort&&t.sort!=="default"&&e.set("sort",t.sort),t.sortDirection&&t.sortDirection!=="asc"&&e.set("sortDirection",t.sortDirection);let o=O.updatedFilter||t.updatedFilter;o&&o!=="all"&&e.set("updatedFilter",o);let s=e.toString(),r=s?`#projects?${s}`:"#projects";window.location.hash!==r&&window.history.replaceState(null,"",r)}function Qt(e){try{localStorage.setItem("projectsViewState",JSON.stringify(e)),Lc()}catch{}}function bt(){try{let e=localStorage.getItem("projectsViewState");if(!e)return null;let t=JSON.parse(e);return!t||typeof t!="object"?null:(t.filter==="clear"&&(t.filter=""),t.filter&&t.filter!=="has-tasks"&&t.filter!=="no-tasks"&&(t.filter=""),t.updatedFilter==null&&(t.updatedFilter="all"),t.updatedFilter&&typeof t.updatedFilter=="string"&&(new Set(["all","5m","30m","24h","week","month"]).has(t.updatedFilter)||(t.updatedFilter="all")),t)}catch{return null}}function Ku(e){let t=document.getElementById("projects-list");if(!t)return;if(!e||e.length===0){t.innerHTML=`<div class="empty-state"><h3>${d("projects.empty.filteredTitle")}</h3></div>`,On([]);return}let a=new Set;t.querySelectorAll(".project-list-item.expanded").forEach(n=>{let o=n.id.replace("project-item-","");a.add(o)}),t.innerHTML=e.map(us).join(""),a.forEach(n=>{let o=document.getElementById(`project-item-${n}`);o&&o.classList.add("expanded")}),On(e)}function Ju(){let e=document.getElementById("projects-sort"),t=document.getElementById("projects-sort-btn"),a=document.getElementById("projects-sort-label"),n=document.getElementById("projects-search"),o=Array.from(document.querySelectorAll(".pf-chip")),s=bt()||{search:"",filter:"",sort:"default",sortDirection:"asc",updatedFilter:"all"},r=window.urlProjectFilters||{},i={search:r.search!==void 0?r.search:s.search,filter:r.filter!==void 0?r.filter:s.filter,sort:r.sort!==void 0?r.sort:s.sort,sortDirection:r.sortDirection!==void 0?r.sortDirection:s.sortDirection,updatedFilter:r.updatedFilter!==void 0?r.updatedFilter:s.updatedFilter};i.filter==="clear"&&(i.filter=""),i.filter&&i.filter!=="has-tasks"&&i.filter!=="no-tasks"&&(i.filter=""),r.statuses&&Array.isArray(r.statuses)&&r.statuses.length>0&&(O.statuses.clear(),r.statuses.forEach(g=>O.statuses.add(g)),document.querySelectorAll('input[type="checkbox"][data-filter="project-status"]').forEach(g=>{g.checked=O.statuses.has(g.value)}),oo()),i.search&&(O.search=i.search),i.filter&&(O.taskFilter=i.filter),window.urlProjectFilters=null;let c=i.sort||"default",l=i.sortDirection||"asc";if(c==="name-asc"?(c="name",l="asc"):c==="name-desc"&&(c="name",l="desc"),He.lastSort=c,He.direction=l,n&&(n.value=i.search||""),o&&o.length&&(o.forEach(m=>m.classList.remove("active")),i.filter&&["has-tasks","no-tasks"].includes(i.filter))){let m=o.find(g=>g.dataset.filter===i.filter);m&&m.classList.add("active")}let p=te.projectsSortedView&&te.projectsSortedView.length?te.projectsSortedView.slice():N.slice();if(n&&n.value&&n.value.trim()!==""){let m=n.value.trim().toLowerCase();p=p.filter(g=>((g.name||"")+" "+(g.description||"")).toLowerCase().includes(m))}O.statuses.size>0&&(p=p.filter(m=>{let g=ta(m.id);return O.statuses.has(g)}));let u=i.filter||O.taskFilter;if(u==="has-tasks"?p=p.filter(m=>C.some(g=>g.projectId===m.id)):u==="no-tasks"&&(p=p.filter(m=>!C.some(g=>g.projectId===m.id))),i.updatedFilter&&i.updatedFilter!=="all"){let m=Tc(i.updatedFilter);m!=null&&(p=p.filter(g=>xc(g)>=m))}if(t){let m=i.sort||"default",g=jc(m),h=He.direction==="asc"?"asc":"desc",k=d("projects.sort.prefix",{label:g,direction:h});a&&(a.textContent=k);let v=document.querySelector("#projects-sort-btn .sort-label-arrow");v&&Es(v,h)}{let m=new Set(["all","5m","30m","24h","week","month"]),g=m.has(i.updatedFilter)?i.updatedFilter:"all";O.updatedFilter=g,Ja();try{Ic()}catch{}document.querySelectorAll('input[type="radio"][data-filter="project-updated"][name="project-updated-filter"]').forEach(h=>{h.__projectUpdatedBound||(h.__projectUpdatedBound=!0,h.addEventListener("change",()=>{if(!h.checked)return;O.updatedFilter=m.has(h.value)?h.value:"all",Ja(),ct();let k=bt()||i;Qt({...k,updatedFilter:O.updatedFilter}),Vn()}))})}let f=He.lastSort||"default";Zo(f,p),Vn()}function Vn(){let e=document.getElementById("btn-clear-projects");if(!e)return;let t=O.search&&O.search.trim()!=="",a=O.statuses.size>0,n=O.taskFilter!=="",o=O.updatedFilter&&O.updatedFilter!=="all",s=O.tags.size>0,r=t||a||n||o||s;e.style.display=r?"inline-flex":"none"}function Pc(){O.search="",O.statuses.clear(),O.taskFilter="",O.updatedFilter="all",O.tags.clear();let e=document.getElementById("projects-search");e&&(e.value=""),Array.from(document.querySelectorAll(".pf-chip")).forEach(o=>o.classList.remove("active")),document.querySelectorAll('input[type="checkbox"][data-filter="project-status"]').forEach(o=>o.checked=!1),document.querySelectorAll('input[type="checkbox"][data-filter="project-tags"]').forEach(o=>o.checked=!1),document.querySelectorAll('input[type="radio"][data-filter="project-updated"][name="project-updated-filter"]').forEach(o=>o.checked=o.value==="all"),Ja(),oo(),Ss(),ct()}function Zu(e){if(!e)return!1;let t=window.getSelection();if(!t||!t.rangeCount)return!1;let a=t.getRangeAt(0),n=a.commonAncestorContainer,o=n.nodeType===1?n.closest?.(".check-text"):n.parentElement?.closest?.(".check-text");if(!o||!e.contains(o))return!1;let s=o.closest(".checkbox-row");if(!s)return!1;let r=a.cloneRange();r.selectNodeContents(o),r.setEnd(a.startContainer,a.startOffset);let i=r.toString(),c=a.cloneRange();c.selectNodeContents(o),c.setStart(a.endContainer,a.endOffset);let l=c.toString();if(i.length===0&&l.length===0){let p=document.createElement("div");p.innerHTML="<br>",s.parentNode.replaceChild(p,s);let u=document.createRange();return u.setStart(p,0),u.collapse(!0),t.removeAllRanges(),t.addRange(u),e.focus(),e.dispatchEvent(new Event("input")),!0}if(l.length===0){let p="chk-"+Date.now()+"-"+Math.floor(Math.random()*1e3),u=document.createElement("div");u.innerHTML=`<div class="checkbox-row" data-id="${p}" contenteditable="false"><button type="button" class="checkbox-toggle variant-1" aria-pressed="false" title="${d("tasks.checklist.toggle")}" contenteditable="false"></button><div class="check-text" contenteditable="true"></div></div>`;let f=u.firstChild;if(s&&s.parentNode){s.parentNode.insertBefore(f,s.nextSibling);let m=f.querySelector(".check-text"),g=document.createRange();g.selectNodeContents(m),g.collapse(!0),t.removeAllRanges(),t.addRange(g),m.focus(),e.dispatchEvent(new Event("input"))}return!0}return document.execCommand("insertHTML",!1,"<br><br>"),e.dispatchEvent(new Event("input")),!0}function mi(){let e=document.getElementById("hamburger-btn"),t=document.querySelector(".sidebar"),a=document.getElementById("sidebar-overlay");if(!e||!t||!a)return;function n(){t.classList.toggle("active"),a.classList.toggle("active"),document.body.style.overflow=t.classList.contains("active")?"hidden":""}function o(){t.classList.remove("active"),a.classList.remove("active"),document.body.style.overflow=""}e.addEventListener("click",n),a.addEventListener("click",o),t.querySelectorAll(".nav-item").forEach(r=>{r.addEventListener("click",()=>{window.innerWidth<=768&&o()})}),window.addEventListener("resize",()=>{window.innerWidth>768&&o()})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",mi):mi();window.addEventListener("resize",()=>{Qn()});var Xu=typeof window<"u"&&typeof window.__pageLoadStart=="number"?window.__pageLoadStart:performance.now(),Qu=performance.now();gt()&&console.log(`[perf] main.js: executed after ${Math.round(Qu-Xu)}ms since nav start`);wc();gt()&&Te("event-delegation-setup");document.addEventListener("DOMContentLoaded",()=>{gt()&&Te("dom-content-loaded"),typeof Zn=="function"&&Zn()});
