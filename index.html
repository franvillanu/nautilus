<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nautilus ‚Äì Research Task Manager</title>

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">

    <!-- Flatpickr -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
</head>
<body>
    <div class="app">
        <!-- User Menu - Always Visible -->
        <div class="user-menu" style="position: fixed; top: 24px; right: 32px; z-index: 2000;">
            <div class="user-avatar" id="shared-user-avatar">ML</div>
            <div class="user-dropdown" id="shared-user-dropdown">
                <div class="dropdown-header">
                    <div class="user-name">Moony Lambre</div>
                    <div class="user-email">researcher@marine.org</div>
                </div>
                <div class="dropdown-item" onclick="toggleTheme()">
                    <span>üåô</span>
                    <span id="theme-text">Dark mode</span>
                </div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-item">
                    <span>‚öôÔ∏è</span>
                    <span>Settings</span>
                </div>
                <div class="dropdown-item">
                    <span>‚ùì</span>
                    <span>Help</span>
                </div>
                <div class="dropdown-divider"></div>
                <div class="dropdown-item">
                    <span>üö™</span>
                    <span>Sign out</span>
                </div>
            </div>
        </div>        
        
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="workspace-title">
                    <div class="workspace-icon">üåä</div>
                    Nautilus
                </div>
            </div>
            <nav>
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <div class="nav-item active" data-page="dashboard">
                        <span class="nav-icon">üè†</span>
                        Dashboard
                    </div>
                    <div class="nav-item calendar-nav" onclick="showCalendarView()">
                        <span class="nav-icon">üìÖ</span>
                        Calendar
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-section-title">Work</div>
                    <div class="nav-item" data-page="projects">
                        <span class="nav-icon">üìä</span>
                        Projects
                        <span class="nav-count" id="projects-count">0</span>
                    </div>
                    <div class="nav-item" data-page="tasks">
                        <span class="nav-icon">‚úÖ</span>
                        All Tasks
                        <span class="nav-count" id="tasks-count">0</span>
                    </div>
                </div>
                <div style="margin-top: auto; padding-top: 16px; border-top: 1px solid var(--border);">
                    <div class="nav-item" data-page="feedback">
                        <span class="nav-icon">üí¨</span>
                        Feedback
                        <span class="nav-count" id="feedback-count">0</span>
                    </div>
                </div>
            </nav>
        </div>

        <div class="resizer"></div>

        <div class="main-content">
            <div class="page active" id="dashboard">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Research Dashboard</h1>
                        <p class="page-subtitle">Overview of your marine research projects</p>
                    </div>
                </div>
                <div class="page-content">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">Active Projects</div>
                                <div class="stat-icon" style="background: rgba(59, 130, 246, 0.2); color: var(--accent-blue);">üìä</div>
                            </div>
                            <div class="stat-number" id="active-projects">0</div>
                            <div class="stat-label">Research projects in progress</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">Pending Tasks</div>
                                <div class="stat-icon" style="background: rgba(245, 158, 11, 0.2); color: var(--accent-amber);">‚è≥</div>
                            </div>
                            <div class="stat-number" id="pending-tasks">0</div>
                            <div class="stat-label">Tasks awaiting completion</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-header">
                                <div class="stat-title">Completed</div>
                                <div class="stat-icon" style="background: rgba(16, 185, 129, 0.2); color: var(--accent-green);">‚úÖ</div>
                            </div>
                            <div class="stat-number" id="completed-tasks">0</div>
                            <div class="stat-label">Tasks finished this month</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="projects">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Projects</h1>
                        <p class="page-subtitle">Manage your research projects</p>
                    </div>
                </div>
                <div class="page-content">
                    <div class="projects-header">
                        <div></div>
                        <button class="add-btn" onclick="openProjectModal()">+ New Project</button>
                    </div>
                    <div class="project-grid" id="projects-list"></div>
                </div>
            </div>

            <div class="project-details-view" id="project-details">
                <div class="page-header">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 20px;">
                        <div>
                            <h1 class="page-title" id="project-detail-title">Project Details</h1>
                            <p class="page-subtitle">Epic overview and task management</p>
                        </div>
                        <button class="back-btn" onclick="backToProjects()">‚Üê Back to Projects</button>
                    </div>
                </div>
                <div class="page-content">
                    <div class="project-details-container" id="project-details-content"></div>
                </div>
            </div>

            <div class="page" id="tasks">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">All Tasks</h1>
                        <p class="page-subtitle">Manage tasks across all projects</p>
                    </div>
                </div>
                
                <div class="page-content">
                    <div id="global-filters">
                        <div class="filters-toolbar">
                            <input id="filter-search" class="filter-input" type="text" placeholder="üîç Search tasks (title or description)">

                            <div class="filter-group" id="group-status">
                                <button type="button" class="filter-button" id="btn-filter-status">
                                    Status <span class="filter-count-badge" id="badge-status">All</span> ‚ñº
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title">Status</div>
                                    <ul class="dropdown-list">
                                        <li class="select-all-row">
                                            <label>
                                                <input type="checkbox" id="status-select-all">
                                                <strong>Select / Unselect All</strong>
                                            </label>
                                        </li>
                                        <li><label><input type="checkbox" value="todo" data-filter="status"> <span class="dot todo"></span> To Do</label></li>
                                        <li><label><input type="checkbox" value="progress" data-filter="status"> <span class="dot progress"></span> In Progress</label></li>
                                        <li><label><input type="checkbox" value="review" data-filter="status"> <span class="dot review"></span> Review</label></li>
                                        <li><label><input type="checkbox" value="done" data-filter="status"> <span class="dot done"></span> Done</label></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-priority">
                                <button type="button" class="filter-button" id="btn-filter-priority">
                                    Priority <span class="filter-count-badge" id="badge-priority">All</span> ‚ñº
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title">Priority</div>
                                    <ul class="dropdown-list">
                                        <li><label><input type="checkbox" value="high" data-filter="priority"> <span class="dot high"></span> High</label></li>
                                        <li><label><input type="checkbox" value="medium" data-filter="priority"> <span class="dot medium"></span> Medium</label></li>
                                        <li><label><input type="checkbox" value="low" data-filter="priority"> <span class="dot low"></span> Low</label></li>
                                    </ul>
                                </div>
                            </div>

                            <div class="filter-group" id="group-project">
                                <button type="button" class="filter-button" id="btn-filter-project">
                                    Project <span class="filter-count-badge" id="badge-project">All</span> ‚ñº
                                </button>
                                <div class="dropdown-panel">
                                    <div class="dropdown-section-title">Project</div>
                                    <ul class="dropdown-list" id="project-options"></ul>
                                </div>
                            </div>

                            <select id="filter-date-global" class="filter-input" style="min-width: 160px;">
                                <option value="">Any time</option>
                                <option value="overdue">Overdue</option>
                                <option value="today">Today</option>
                                <option value="this-week">This week</option>
                                <option value="next-week">Next week</option>
                                <option value="this-month">This month</option>
                            </select>
                            
                            <button type="button" class="btn-clear-filters" id="btn-clear-filters" style="display:none">
                                <span class="filter-icon">‚ùå</span>
                                Clear Filters
                            </button>
                        </div>

                        <div class="active-filters" id="active-filters"></div>
                    </div>

                <div id="kanban-tip" class="info-banner" style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: rgba(59, 130, 246, 0.1); border: 1px solid var(--accent-blue); border-radius: 8px; margin-bottom: 16px; font-size: 14px;">
                    <span style="color: var(--accent-blue);">üí°</span>
                    <span style="flex: 1; color: var(--text-secondary);">
                        <strong>Tip:</strong>In the Kanban Board hold <kbd style="background: var(--bg-tertiary); padding: 2px 6px; border-radius: 4px; font-size: 12px;">Shift</kbd> and click to select multiple tasks, then drag to move them together
                    </span>
                    <button onclick="dismissKanbanTip()" style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 16px;">‚úï</button>
                </div>

                    <div class="kanban-header">
                        <div class="view-toggle">
                            <button class="view-btn active">Kanban</button>
                            <button class="view-btn">List</button>
                            <button class="view-btn">Calendar</button>
                        </div>
                        <button class="add-btn" onclick="openTaskModal()">+ Add Task</button>
                    </div>
                    
                    <div class="kanban-board">
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">üìã To Do</div>
                                <span class="column-count" id="todo-count">0</span>
                            </div>
                            <div id="todo-tasks"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">üîÑ In Progress</div>
                                <span class="column-count" id="progress-count">0</span>
                            </div>
                            <div id="progress-tasks"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">‚òëÔ∏è Review</div>
                                <span class="column-count" id="review-count">0</span>
                            </div>
                            <div id="review-tasks"></div>
                        </div>
                        <div class="kanban-column">
                            <div class="column-header">
                                <div class="column-title">‚úÖ Done</div>
                                <span class="column-count" id="done-count">0</span>
                            </div>
                            <div id="done-tasks"></div>
                        </div>
                    </div>
                    
                    <div class="list-view" id="list-view">
                        <table class="tasks-table">
                            <thead>
                                <tr>
                                    <th onclick="sortTable('title')" style="cursor: pointer;">Task <span id="sort-title">‚Üï</span></th>
                                    <th onclick="sortTable('status')" style="cursor: pointer;">Status <span id="sort-status">‚Üï</span></th>
                                    <th onclick="sortTable('priority')" style="cursor: pointer;">Priority <span id="sort-priority">‚Üï</span></th>
                                    <th onclick="sortTable('project')" style="cursor: pointer;">Project <span id="sort-project">‚Üï</span></th>
                                    <th onclick="sortTable('dueDate')" style="cursor: pointer;">Due Date <span id="sort-dueDate">‚Üï</span></th>
                                </tr>
                            </thead>
                            <tbody id="tasks-table-body"></tbody>
                        </table>
                    </div>

                    <div class="calendar-view" id="calendar-view">
                        <div class="calendar-container">
                            <div class="calendar-header">
                                <div class="calendar-nav">
                                    <button onclick="changeMonth(-1)">‚Üê</button>
                                    <span class="calendar-month-year" id="calendar-month-year">January 2024</span>
                                    <button onclick="changeMonth(1)">‚Üí</button>
                                </div>
                                <button class="calendar-today-btn" onclick="goToToday()">Today</button>
                            </div>
                            <div style="position: relative;">
                                <div class="calendar-grid" id="calendar-grid"></div>
                                <div class="project-overlay" id="project-overlay"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="page" id="feedback">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Feedback & Issues</h1>
                        <p class="page-subtitle">Report bugs and suggest features</p>
                    </div>
                </div>
                <div class="page-content">
                   <div class="feedback-input-bar">
                        <select id="feedback-type" class="feedback-type-select">
                            <option value="bug">üêû Bug</option>
                            <option value="feature">‚ú® Feature</option>
                            <option value="idea">üí° Idea</option>
                        </select>
                        <input type="text" id="feedback-description" class="feedback-input" placeholder="Describe the issue or idea...">
                        <span class="camera-divider">üì∏</span>
                        <input type="text" id="feedback-screenshot-url" class="feedback-input" placeholder="Screenshot URL" style="flex: 0 0 300px;">
                        <a href="https://imgur.com/upload" target="_blank" class="screenshot-upload-link" title="Upload to Imgur">üì§</a>
                        <button class="add-btn" onclick="addFeedbackItem()">Add</button>
                    </div>
                    
                    <div style="margin-top: 32px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <h3 style="font-size: 16px; font-weight: 600; color: var(--text-secondary);">‚è≥ Pending</h3>
                        </div>
                        <div style="height: 1px; background: var(--border); margin-bottom: 16px;"></div>
                        <div id="feedback-list-pending"></div>
                    </div>
                    
                    <div style="margin-top: 32px;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 16px;">
                            <h3 style="font-size: 16px; font-weight: 600; color: var(--text-muted);">‚úÖ Done</h3>
                        </div>
                        <div style="height: 1px; background: var(--border); margin-bottom: 16px;"></div>
                        <div id="feedback-list-done"></div>
                    </div>
                </div>
            </div>
    </div>

    <!-- Modals - Outside of all pages -->
    <div id="project-modal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">Create New Project</h2>
            <form id="project-form">
                <div class="form-group">
                    <label class="form-label">Project Name</label>
                    <input type="text" class="form-input" name="name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-textarea" name="description"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">Start Date</label>
                    <input type="date" class="form-input" name="startDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">End Date</label>
                    <input type="date" class="form-input" name="endDate">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeModal('project-modal')">Cancel</button>
                    <button type="submit" class="btn-primary">Create Project</button>
                </div>
            </form>
        </div>
    </div>

 <div id="task-modal" class="modal">
  <div class="modal-content">

    <!-- header -->
    <div class="modal-header" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;">
      <h2 style="font-size:20px;font-weight:600;margin:0;">Edit Task</h2>
      <div class="header-actions" style="display:flex;gap:8px;align-items:center;position:relative;">
        <button type="button" class="options-btn" id="task-options-btn"
                style="background:none;border:none;color:var(--text-secondary);cursor:pointer;font-size:20px;padding:4px;line-height:1;">‚ãØ</button>
        <button type="button" class="modal-close" onclick="closeModal('task-modal')"
                style="background:none;border:none;font-size:20px;cursor:pointer;">‚ùå</button>

        <!-- options menu appears under the 3 dots -->
        <div class="options-menu" id="options-menu" style="position:absolute;top:calc(100% + 8px);right:28px;display:none;">
          <button type="button" class="delete-btn" onclick="deleteTask()">üóëÔ∏è Delete Task</button>
        </div>
      </div>
    </div>

    <form id="task-form">
      <div class="modal-body">
        <!-- LEFT COLUMN -->
        <div class="modal-left">
          <div class="form-group">
            <label class="form-label">Task Title</label>
            <input type="text" class="form-input" name="title" required
                   oninput="updateTaskField('title', this.value)">
          </div>

          <div class="form-group">
            <label class="form-label">Attachments</label>
            <div id="attachments-list"></div>
            <div style="display:flex;gap:8px;margin-top:8px;">
              <input type="text" id="attachment-url" class="form-input" placeholder="Paste link (Drive, Dropbox, etc.)" style="flex:1;">
              <button type="button" class="btn-secondary" onclick="addAttachment()" style="padding:8px 16px;">Add</button>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label">Description</label>
            <div class="rich-editor">
              <div class="editor-toolbar">
                <button type="button" class="editor-btn" onclick="formatTaskText('bold')"><strong>B</strong></button>
                <button type="button" class="editor-btn" onclick="formatTaskText('italic')"><em>I</em></button>
                <button type="button" class="editor-btn" onclick="formatTaskText('underline')"><u>U</u></button>
                <span style="width:1px;height:20px;background:var(--border);margin:0 4px;"></span>
                <button type="button" class="editor-btn" onclick="formatTaskText('insertUnorderedList')">‚Ä¢ List</button>
                <button type="button" class="editor-btn" onclick="formatTaskText('insertOrderedList')">1. List</button>
                <span style="width:1px;height:20px;background:var(--border);margin:0 4px;"></span>
                <button type="button" class="editor-btn" onclick="insertTaskHeading('h1')">H1</button>
                <button type="button" class="editor-btn" onclick="insertTaskHeading('h2')">H2</button>
                <button type="button" class="editor-btn" onclick="insertTaskHeading('h3')">H3</button>
                <button type="button" class="editor-btn" onclick="insertTaskDivider()">‚îÄ</button>
              </div>
              <div class="editor-content" contenteditable="true" id="task-description-editor"
                   oninput="updateTaskField('description', this.innerHTML)"></div>
            </div>
            <textarea name="description" id="task-description-hidden" style="display:none;"></textarea>
          </div>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="modal-right">

          <!-- Status -->
          <div class="form-group" style="position:relative;">
            <label class="form-label">Status</label>
            <div class="status-dropdown">
              <button type="button" class="status-current" id="status-current">
                <span class="status-dot todo"></span>
                <span class="status-text">To Do</span>
                <span class="dropdown-arrow">‚ñº</span>
              </button>
              <div class="status-options" id="status-options">
                <!-- no inline onclick; handled by delegated JS -->
                <div class="status-option" data-status="todo">
                  <span class="status-dot todo"></span><span>To Do</span>
                </div>
                <div class="status-option" data-status="progress">
                  <span class="status-dot progress"></span><span>In Progress</span>
                </div>
                <div class="status-option" data-status="review">
                  <span class="status-dot review"></span><span>Review</span>
                </div>
                <div class="status-option" data-status="done">
                  <span class="status-dot done"></span><span>Done</span>
                </div>
              </div>
            </div>
            <input type="hidden" name="status" id="hidden-status" value="todo">
          </div>

          <!-- Priority -->
          <div class="form-group">
            <label class="form-label">Priority</label>
            <select class="form-select" name="priority" onchange="updateTaskField('priority', this.value)">
              <option value="low">üîΩ Low</option>
              <option value="medium">üî∂ Medium</option>
              <option value="high">üî∫ High</option>
            </select>
          </div>

          <!-- Project -->
          <div class="form-group">
            <label class="form-label">Project</label>
            <select class="form-select" name="projectId" id="task-project-select"
                    onchange="updateTaskField('projectId', this.value)">
              <option value="">Select a project</option>
            </select>
          </div>

          <!-- Due Date -->
          <div class="form-group">
            <label class="form-label">Due Date</label>
            <input type="date" class="form-input" name="dueDate" required>

          </div>

        <div class="modal-actions" id="task-footer" 
            style="display: flex; justify-content: flex-end; gap: 8px; margin-top: 20px;">
        <!-- Create mode -->
        <button type="button" class="btn-secondary" id="task-cancel-btn" onclick="closeModal('task-modal')">Cancel</button>
        <button type="submit" class="btn-primary" id="task-submit-btn">Create Task</button>
        </div>

        </div><!-- /modal-right -->
      </div><!-- /modal-body -->
    </form>

  </div>
</div>


    <div id="confirm-modal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-title">Delete Task</div>
            <p>This action cannot be undone. To confirm deletion, type <strong>delete</strong> below:</p>
            <input type="text" id="confirm-input" class="confirm-input" placeholder="Type delete here">
            <div class="confirm-actions">
                <button class="btn-secondary" onclick="closeConfirmModal()">Cancel</button>
                <button class="btn-secondary" onclick="confirmDelete()" style="background: var(--accent-red);">Delete</button>
            </div>
        </div>
    </div>

    <div id="feedback-delete-modal" class="modal">
        <div class="modal-content" style="max-width: 400px;">
            <h2 class="modal-title">Delete Feedback</h2>
            <p style="color: var(--text-secondary); margin-bottom: 24px;">Are you sure you want to delete this feedback?</p>
            <div class="modal-actions">
                <button type="button" class="btn-secondary" onclick="closeFeedbackDeleteModal()">Cancel</button>
                <button type="button" class="btn-primary" style="background: var(--accent-red);" onclick="confirmFeedbackDelete()">Delete</button>
            </div>
        </div>
    </div>

    <div id="project-confirm-modal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-title">Delete Project</div>
            <p>This action cannot be undone. To confirm deletion, type <strong>delete</strong> below:</p>
            <div style="margin: 16px 0; padding: 12px; background: var(--bg-tertiary); border-radius: 6px;">
                <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                    <input type="checkbox" id="delete-tasks-checkbox" style="width: 18px; height: 18px; cursor: pointer;">
                    <span style="font-size: 14px; color: var(--text-secondary);">Delete all tasks in this project</span>
                </label>
                <p style="margin: 8px 0 0 26px; font-size: 12px; color: var(--text-muted);">If unchecked, tasks will be unassigned from the project</p>
            </div>
            <input type="text" id="project-confirm-input" class="confirm-input" placeholder="Type delete here">
            <div class="confirm-actions">
                <button class="btn-secondary" onclick="closeProjectConfirmModal()">Cancel</button>
                <button class="btn-secondary" onclick="confirmProjectDelete()" style="background: var(--accent-red);">Delete</button>
            </div>
        </div>
    </div>

    <div id="status-info-modal" class="modal">
    <div class="modal-content" style="max-width: 500px;">
        <h2 class="modal-title">Project Status Logic</h2>
        <div style="margin: 24px 0; line-height: 1.8; color: var(--text-secondary);">
            <p style="margin-bottom: 16px;">Project status updates automatically based on task progress</p>
            
            <div style="margin-bottom: 12px;">
                    <strong style="color: var(--text-muted);">‚ö™ Planning</strong><br>
                All tasks are in "To Do" status
            </div>
            
            <div style="margin-bottom: 12px;">
                <strong style="color: var(--accent-blue);">üîµ Active</strong><br>
                At least one task is "In Progress" or "Review"
            </div>
            
            <div style="margin-bottom: 12px;">
                <strong style="color: var(--accent-green);">‚úÖ Completed</strong><br>
                All tasks are marked as "Done"
            </div>
        </div>
        <div class="modal-actions">
            <button type="button" class="btn-primary" onclick="closeModal('status-info-modal')">Got it</button>
        </div>
    </div>
</div>
           
    <script type="module" src="app.js"></script>
</body>
</html>